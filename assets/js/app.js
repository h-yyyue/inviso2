/******/ (function(modules) { // webpackBootstrap
/******/ 	// The module cache
/******/ 	var installedModules = {};
/******/
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/
/******/ 		// Check if module is in cache
/******/ 		if(installedModules[moduleId]) {
/******/ 			return installedModules[moduleId].exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = installedModules[moduleId] = {
/******/ 			i: moduleId,
/******/ 			l: false,
/******/ 			exports: {}
/******/ 		};
/******/
/******/ 		// Execute the module function
/******/ 		modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);
/******/
/******/ 		// Flag the module as loaded
/******/ 		module.l = true;
/******/
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/
/******/
/******/ 	// expose the modules object (__webpack_modules__)
/******/ 	__webpack_require__.m = modules;
/******/
/******/ 	// expose the module cache
/******/ 	__webpack_require__.c = installedModules;
/******/
/******/ 	// identity function for calling harmony imports with the correct context
/******/ 	__webpack_require__.i = function(value) { return value; };
/******/
/******/ 	// define getter function for harmony exports
/******/ 	__webpack_require__.d = function(exports, name, getter) {
/******/ 		if(!__webpack_require__.o(exports, name)) {
/******/ 			Object.defineProperty(exports, name, {
/******/ 				configurable: false,
/******/ 				enumerable: true,
/******/ 				get: getter
/******/ 			});
/******/ 		}
/******/ 	};
/******/
/******/ 	// getDefaultExport function for compatibility with non-harmony modules
/******/ 	__webpack_require__.n = function(module) {
/******/ 		var getter = module && module.__esModule ?
/******/ 			function getDefault() { return module['default']; } :
/******/ 			function getModuleExports() { return module; };
/******/ 		__webpack_require__.d(getter, 'a', getter);
/******/ 		return getter;
/******/ 	};
/******/
/******/ 	// Object.prototype.hasOwnProperty.call
/******/ 	__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };
/******/
/******/ 	// __webpack_public_path__
/******/ 	__webpack_require__.p = "assets/js";
/******/
/******/ 	// Load entry module and return exports
/******/ 	return __webpack_require__(__webpack_require__.s = 44);
/******/ })
/************************************************************************/
/******/ ([
/* 0 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("Object.defineProperty(exports,\"__esModule\",{value:true});var _slicedToArray=function(){function sliceIterator(arr,i){var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break;}}catch(err){_d=true;_e=err;}finally{try{if(!_n&&_i[\"return\"])_i[\"return\"]();}finally{if(_d)throw _e;}}return _arr;}return function(arr,i){if(Array.isArray(arr)){return arr;}else if(Symbol.iterator in Object(arr)){return sliceIterator(arr,i);}else{throw new TypeError(\"Invalid attempt to destructure non-iterable instance\");}};}();var _get=function get(object,property,receiver){if(object===null)object=Function.prototype;var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=Object.getPrototypeOf(object);if(parent===null){return undefined;}else{return get(parent,property,receiver);}}else if(\"value\"in desc){return desc.value;}else{var getter=desc.get;if(getter===undefined){return undefined;}return getter.call(receiver);}};var _FN;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if(\"value\"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++){arr2[i]=arr[i];}return arr2;}else{return Array.from(arr);}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");}return call&&(typeof call===\"object\"||typeof call===\"function\")?call:self;}function _inherits(subClass,superClass){if(typeof superClass!==\"function\"&&superClass!==null){throw new TypeError(\"Super expression must either be null or a function, not \"+typeof superClass);}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass;}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true});}else{obj[key]=value;}return obj;}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError(\"Cannot call a class as a function\");}}/**\n * @license\n * Copyright 2010-2022 Three.js Authors\n * SPDX-License-Identifier: MIT\n */\nvar REVISION='142';\nvar MOUSE={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2};\nvar TOUCH={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3};\nvar CullFaceNone=0;\nvar CullFaceBack=1;\nvar CullFaceFront=2;\nvar CullFaceFrontBack=3;\nvar BasicShadowMap=0;\nvar PCFShadowMap=1;\nvar PCFSoftShadowMap=2;\nvar VSMShadowMap=3;\nvar FrontSide=0;\nvar BackSide=1;\nvar DoubleSide=2;\nvar FlatShading=1;\nvar SmoothShading=2;\nvar NoBlending=0;\nvar NormalBlending=1;\nvar AdditiveBlending=2;\nvar SubtractiveBlending=3;\nvar MultiplyBlending=4;\nvar CustomBlending=5;\nvar AddEquation=100;\nvar SubtractEquation=101;\nvar ReverseSubtractEquation=102;\nvar MinEquation=103;\nvar MaxEquation=104;\nvar ZeroFactor=200;\nvar OneFactor=201;\nvar SrcColorFactor=202;\nvar OneMinusSrcColorFactor=203;\nvar SrcAlphaFactor=204;\nvar OneMinusSrcAlphaFactor=205;\nvar DstAlphaFactor=206;\nvar OneMinusDstAlphaFactor=207;\nvar DstColorFactor=208;\nvar OneMinusDstColorFactor=209;\nvar SrcAlphaSaturateFactor=210;\nvar NeverDepth=0;\nvar AlwaysDepth=1;\nvar LessDepth=2;\nvar LessEqualDepth=3;\nvar EqualDepth=4;\nvar GreaterEqualDepth=5;\nvar GreaterDepth=6;\nvar NotEqualDepth=7;\nvar MultiplyOperation=0;\nvar MixOperation=1;\nvar AddOperation=2;\nvar NoToneMapping=0;\nvar LinearToneMapping=1;\nvar ReinhardToneMapping=2;\nvar CineonToneMapping=3;\nvar ACESFilmicToneMapping=4;\nvar CustomToneMapping=5;\n\nvar UVMapping=300;\nvar CubeReflectionMapping=301;\nvar CubeRefractionMapping=302;\nvar EquirectangularReflectionMapping=303;\nvar EquirectangularRefractionMapping=304;\nvar CubeUVReflectionMapping=306;\nvar RepeatWrapping=1000;\nvar ClampToEdgeWrapping=1001;\nvar MirroredRepeatWrapping=1002;\nvar NearestFilter=1003;\nvar NearestMipmapNearestFilter=1004;\nvar NearestMipMapNearestFilter=1004;\nvar NearestMipmapLinearFilter=1005;\nvar NearestMipMapLinearFilter=1005;\nvar LinearFilter=1006;\nvar LinearMipmapNearestFilter=1007;\nvar LinearMipMapNearestFilter=1007;\nvar LinearMipmapLinearFilter=1008;\nvar LinearMipMapLinearFilter=1008;\nvar UnsignedByteType=1009;\nvar ByteType=1010;\nvar ShortType=1011;\nvar UnsignedShortType=1012;\nvar IntType=1013;\nvar UnsignedIntType=1014;\nvar FloatType=1015;\nvar HalfFloatType=1016;\nvar UnsignedShort4444Type=1017;\nvar UnsignedShort5551Type=1018;\nvar UnsignedInt248Type=1020;\nvar AlphaFormat=1021;\nvar RGBFormat=1022;\nvar RGBAFormat=1023;\nvar LuminanceFormat=1024;\nvar LuminanceAlphaFormat=1025;\nvar DepthFormat=1026;\nvar DepthStencilFormat=1027;\nvar RedFormat=1028;\nvar RedIntegerFormat=1029;\nvar RGFormat=1030;\nvar RGIntegerFormat=1031;\nvar RGBAIntegerFormat=1033;\n\nvar RGB_S3TC_DXT1_Format=33776;\nvar RGBA_S3TC_DXT1_Format=33777;\nvar RGBA_S3TC_DXT3_Format=33778;\nvar RGBA_S3TC_DXT5_Format=33779;\nvar RGB_PVRTC_4BPPV1_Format=35840;\nvar RGB_PVRTC_2BPPV1_Format=35841;\nvar RGBA_PVRTC_4BPPV1_Format=35842;\nvar RGBA_PVRTC_2BPPV1_Format=35843;\nvar RGB_ETC1_Format=36196;\nvar RGB_ETC2_Format=37492;\nvar RGBA_ETC2_EAC_Format=37496;\nvar RGBA_ASTC_4x4_Format=37808;\nvar RGBA_ASTC_5x4_Format=37809;\nvar RGBA_ASTC_5x5_Format=37810;\nvar RGBA_ASTC_6x5_Format=37811;\nvar RGBA_ASTC_6x6_Format=37812;\nvar RGBA_ASTC_8x5_Format=37813;\nvar RGBA_ASTC_8x6_Format=37814;\nvar RGBA_ASTC_8x8_Format=37815;\nvar RGBA_ASTC_10x5_Format=37816;\nvar RGBA_ASTC_10x6_Format=37817;\nvar RGBA_ASTC_10x8_Format=37818;\nvar RGBA_ASTC_10x10_Format=37819;\nvar RGBA_ASTC_12x10_Format=37820;\nvar RGBA_ASTC_12x12_Format=37821;\nvar RGBA_BPTC_Format=36492;\nvar LoopOnce=2200;\nvar LoopRepeat=2201;\nvar LoopPingPong=2202;\nvar InterpolateDiscrete=2300;\nvar InterpolateLinear=2301;\nvar InterpolateSmooth=2302;\nvar ZeroCurvatureEnding=2400;\nvar ZeroSlopeEnding=2401;\nvar WrapAroundEnding=2402;\nvar NormalAnimationBlendMode=2500;\nvar AdditiveAnimationBlendMode=2501;\nvar TrianglesDrawMode=0;\nvar TriangleStripDrawMode=1;\nvar TriangleFanDrawMode=2;\nvar LinearEncoding=3000;\nvar sRGBEncoding=3001;\nvar BasicDepthPacking=3200;\nvar RGBADepthPacking=3201;\nvar TangentSpaceNormalMap=0;\nvar ObjectSpaceNormalMap=1;\n\n// Color space string identifiers, matching CSS Color Module Level 4 and WebGPU names where available.\nvar NoColorSpace='';\nvar SRGBColorSpace='srgb';\nvar LinearSRGBColorSpace='srgb-linear';\n\nvar ZeroStencilOp=0;\nvar KeepStencilOp=7680;\nvar ReplaceStencilOp=7681;\nvar IncrementStencilOp=7682;\nvar DecrementStencilOp=7683;\nvar IncrementWrapStencilOp=34055;\nvar DecrementWrapStencilOp=34056;\nvar InvertStencilOp=5386;\n\nvar NeverStencilFunc=512;\nvar LessStencilFunc=513;\nvar EqualStencilFunc=514;\nvar LessEqualStencilFunc=515;\nvar GreaterStencilFunc=516;\nvar NotEqualStencilFunc=517;\nvar GreaterEqualStencilFunc=518;\nvar AlwaysStencilFunc=519;\n\nvar StaticDrawUsage=35044;\nvar DynamicDrawUsage=35048;\nvar StreamDrawUsage=35040;\nvar StaticReadUsage=35045;\nvar DynamicReadUsage=35049;\nvar StreamReadUsage=35041;\nvar StaticCopyUsage=35046;\nvar DynamicCopyUsage=35050;\nvar StreamCopyUsage=35042;\n\nvar GLSL1='100';\nvar GLSL3='300 es';\n\nvar _SRGBAFormat=1035;// fallback for WebGL 1\n\n/**\n * https://github.com/mrdoob/eventdispatcher.js/\n */var\n\nEventDispatcher=function(){function EventDispatcher(){_classCallCheck(this,EventDispatcher);}_createClass(EventDispatcher,[{key:'addEventListener',value:function addEventListener(\n\ntype,listener){\n\nif(this._listeners===undefined)this._listeners={};\n\nvar listeners=this._listeners;\n\nif(listeners[type]===undefined){\n\nlisteners[type]=[];\n\n}\n\nif(listeners[type].indexOf(listener)===-1){\n\nlisteners[type].push(listener);\n\n}\n\n}},{key:'hasEventListener',value:function hasEventListener(\n\ntype,listener){\n\nif(this._listeners===undefined)return false;\n\nvar listeners=this._listeners;\n\nreturn listeners[type]!==undefined&&listeners[type].indexOf(listener)!==-1;\n\n}},{key:'removeEventListener',value:function removeEventListener(\n\ntype,listener){\n\nif(this._listeners===undefined)return;\n\nvar listeners=this._listeners;\nvar listenerArray=listeners[type];\n\nif(listenerArray!==undefined){\n\nvar index=listenerArray.indexOf(listener);\n\nif(index!==-1){\n\nlistenerArray.splice(index,1);\n\n}\n\n}\n\n}},{key:'dispatchEvent',value:function dispatchEvent(\n\nevent){\n\nif(this._listeners===undefined)return;\n\nvar listeners=this._listeners;\nvar listenerArray=listeners[event.type];\n\nif(listenerArray!==undefined){\n\nevent.target=this;\n\n// Make a copy, in case listeners are removed while iterating.\nvar array=listenerArray.slice(0);\n\nfor(var i=0,l=array.length;i<l;i++){\n\narray[i].call(this,event);\n\n}\n\nevent.target=null;\n\n}\n\n}}]);return EventDispatcher;}();\n\n\n\nvar _lut=['00','01','02','03','04','05','06','07','08','09','0a','0b','0c','0d','0e','0f','10','11','12','13','14','15','16','17','18','19','1a','1b','1c','1d','1e','1f','20','21','22','23','24','25','26','27','28','29','2a','2b','2c','2d','2e','2f','30','31','32','33','34','35','36','37','38','39','3a','3b','3c','3d','3e','3f','40','41','42','43','44','45','46','47','48','49','4a','4b','4c','4d','4e','4f','50','51','52','53','54','55','56','57','58','59','5a','5b','5c','5d','5e','5f','60','61','62','63','64','65','66','67','68','69','6a','6b','6c','6d','6e','6f','70','71','72','73','74','75','76','77','78','79','7a','7b','7c','7d','7e','7f','80','81','82','83','84','85','86','87','88','89','8a','8b','8c','8d','8e','8f','90','91','92','93','94','95','96','97','98','99','9a','9b','9c','9d','9e','9f','a0','a1','a2','a3','a4','a5','a6','a7','a8','a9','aa','ab','ac','ad','ae','af','b0','b1','b2','b3','b4','b5','b6','b7','b8','b9','ba','bb','bc','bd','be','bf','c0','c1','c2','c3','c4','c5','c6','c7','c8','c9','ca','cb','cc','cd','ce','cf','d0','d1','d2','d3','d4','d5','d6','d7','d8','d9','da','db','dc','dd','de','df','e0','e1','e2','e3','e4','e5','e6','e7','e8','e9','ea','eb','ec','ed','ee','ef','f0','f1','f2','f3','f4','f5','f6','f7','f8','f9','fa','fb','fc','fd','fe','ff'];\n\nvar _seed=1234567;\n\n\nvar DEG2RAD=Math.PI/180;\nvar RAD2DEG=180/Math.PI;\n\n// http://stackoverflow.com/questions/105034/how-to-create-a-guid-uuid-in-javascript/21963136#21963136\nfunction generateUUID(){\n\nvar d0=Math.random()*0xffffffff|0;\nvar d1=Math.random()*0xffffffff|0;\nvar d2=Math.random()*0xffffffff|0;\nvar d3=Math.random()*0xffffffff|0;\nvar uuid=_lut[d0&0xff]+_lut[d0>>8&0xff]+_lut[d0>>16&0xff]+_lut[d0>>24&0xff]+'-'+\n_lut[d1&0xff]+_lut[d1>>8&0xff]+'-'+_lut[d1>>16&0x0f|0x40]+_lut[d1>>24&0xff]+'-'+\n_lut[d2&0x3f|0x80]+_lut[d2>>8&0xff]+'-'+_lut[d2>>16&0xff]+_lut[d2>>24&0xff]+\n_lut[d3&0xff]+_lut[d3>>8&0xff]+_lut[d3>>16&0xff]+_lut[d3>>24&0xff];\n\n// .toLowerCase() here flattens concatenated strings to save heap memory space.\nreturn uuid.toLowerCase();\n\n}\n\nfunction clamp(value,min,max){\n\nreturn Math.max(min,Math.min(max,value));\n\n}\n\n// compute euclidean modulo of m % n\n// https://en.wikipedia.org/wiki/Modulo_operation\nfunction euclideanModulo(n,m){\n\nreturn(n%m+m)%m;\n\n}\n\n// Linear mapping from range <a1, a2> to range <b1, b2>\nfunction mapLinear(x,a1,a2,b1,b2){\n\nreturn b1+(x-a1)*(b2-b1)/(a2-a1);\n\n}\n\n// https://www.gamedev.net/tutorials/programming/general-and-gameplay-programming/inverse-lerp-a-super-useful-yet-often-overlooked-function-r5230/\nfunction inverseLerp(x,y,value){\n\nif(x!==y){\n\nreturn(value-x)/(y-x);\n\n}else{\n\nreturn 0;\n\n}\n\n}\n\n// https://en.wikipedia.org/wiki/Linear_interpolation\nfunction lerp(x,y,t){\n\nreturn(1-t)*x+t*y;\n\n}\n\n// http://www.rorydriscoll.com/2016/03/07/frame-rate-independent-damping-using-lerp/\nfunction damp(x,y,lambda,dt){\n\nreturn lerp(x,y,1-Math.exp(-lambda*dt));\n\n}\n\n// https://www.desmos.com/calculator/vcsjnyz7x4\nfunction pingpong(x){var length=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1;\n\nreturn length-Math.abs(euclideanModulo(x,length*2)-length);\n\n}\n\n// http://en.wikipedia.org/wiki/Smoothstep\nfunction smoothstep(x,min,max){\n\nif(x<=min)return 0;\nif(x>=max)return 1;\n\nx=(x-min)/(max-min);\n\nreturn x*x*(3-2*x);\n\n}\n\nfunction smootherstep(x,min,max){\n\nif(x<=min)return 0;\nif(x>=max)return 1;\n\nx=(x-min)/(max-min);\n\nreturn x*x*x*(x*(x*6-15)+10);\n\n}\n\n// Random integer from <low, high> interval\nfunction randInt(low,high){\n\nreturn low+Math.floor(Math.random()*(high-low+1));\n\n}\n\n// Random float from <low, high> interval\nfunction randFloat(low,high){\n\nreturn low+Math.random()*(high-low);\n\n}\n\n// Random float from <-range/2, range/2> interval\nfunction randFloatSpread(range){\n\nreturn range*(0.5-Math.random());\n\n}\n\n// Deterministic pseudo-random float in the interval [ 0, 1 ]\nfunction seededRandom(s){\n\nif(s!==undefined)_seed=s;\n\n// Mulberry32 generator\n\nvar t=_seed+=0x6D2B79F5;\n\nt=Math.imul(t^t>>>15,t|1);\n\nt^=t+Math.imul(t^t>>>7,t|61);\n\nreturn((t^t>>>14)>>>0)/4294967296;\n\n}\n\nfunction degToRad(degrees){\n\nreturn degrees*DEG2RAD;\n\n}\n\nfunction radToDeg(radians){\n\nreturn radians*RAD2DEG;\n\n}\n\nfunction isPowerOfTwo(value){\n\nreturn(value&value-1)===0&&value!==0;\n\n}\n\nfunction ceilPowerOfTwo(value){\n\nreturn Math.pow(2,Math.ceil(Math.log(value)/Math.LN2));\n\n}\n\nfunction floorPowerOfTwo(value){\n\nreturn Math.pow(2,Math.floor(Math.log(value)/Math.LN2));\n\n}\n\nfunction setQuaternionFromProperEuler(q,a,b,c,order){\n\n// Intrinsic Proper Euler Angles - see https://en.wikipedia.org/wiki/Euler_angles\n\n// rotations are applied to the axes in the order specified by 'order'\n// rotation by angle 'a' is applied first, then by angle 'b', then by angle 'c'\n// angles are in radians\n\nvar cos=Math.cos;\nvar sin=Math.sin;\n\nvar c2=cos(b/2);\nvar s2=sin(b/2);\n\nvar c13=cos((a+c)/2);\nvar s13=sin((a+c)/2);\n\nvar c1_3=cos((a-c)/2);\nvar s1_3=sin((a-c)/2);\n\nvar c3_1=cos((c-a)/2);\nvar s3_1=sin((c-a)/2);\n\nswitch(order){\n\ncase'XYX':\nq.set(c2*s13,s2*c1_3,s2*s1_3,c2*c13);\nbreak;\n\ncase'YZY':\nq.set(s2*s1_3,c2*s13,s2*c1_3,c2*c13);\nbreak;\n\ncase'ZXZ':\nq.set(s2*c1_3,s2*s1_3,c2*s13,c2*c13);\nbreak;\n\ncase'XZX':\nq.set(c2*s13,s2*s3_1,s2*c3_1,c2*c13);\nbreak;\n\ncase'YXY':\nq.set(s2*c3_1,c2*s13,s2*s3_1,c2*c13);\nbreak;\n\ncase'ZYZ':\nq.set(s2*s3_1,s2*c3_1,c2*s13,c2*c13);\nbreak;\n\ndefault:\nconsole.warn('THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: '+order);}\n\n\n\n}\n\nfunction denormalize$1(value,array){\n\nswitch(array.constructor){\n\ncase Float32Array:\n\nreturn value;\n\ncase Uint16Array:\n\nreturn value/65535.0;\n\ncase Uint8Array:\n\nreturn value/255.0;\n\ncase Int16Array:\n\nreturn Math.max(value/32767.0,-1.0);\n\ncase Int8Array:\n\nreturn Math.max(value/127.0,-1.0);\n\ndefault:\n\nthrow new Error('Invalid component type.');}\n\n\n\n}\n\nfunction normalize(value,array){\n\nswitch(array.constructor){\n\ncase Float32Array:\n\nreturn value;\n\ncase Uint16Array:\n\nreturn Math.round(value*65535.0);\n\ncase Uint8Array:\n\nreturn Math.round(value*255.0);\n\ncase Int16Array:\n\nreturn Math.round(value*32767.0);\n\ncase Int8Array:\n\nreturn Math.round(value*127.0);\n\ndefault:\n\nthrow new Error('Invalid component type.');}\n\n\n\n}\n\nvar MathUtils=/*#__PURE__*/Object.freeze({\n__proto__:null,\nDEG2RAD:DEG2RAD,\nRAD2DEG:RAD2DEG,\ngenerateUUID:generateUUID,\nclamp:clamp,\neuclideanModulo:euclideanModulo,\nmapLinear:mapLinear,\ninverseLerp:inverseLerp,\nlerp:lerp,\ndamp:damp,\npingpong:pingpong,\nsmoothstep:smoothstep,\nsmootherstep:smootherstep,\nrandInt:randInt,\nrandFloat:randFloat,\nrandFloatSpread:randFloatSpread,\nseededRandom:seededRandom,\ndegToRad:degToRad,\nradToDeg:radToDeg,\nisPowerOfTwo:isPowerOfTwo,\nceilPowerOfTwo:ceilPowerOfTwo,\nfloorPowerOfTwo:floorPowerOfTwo,\nsetQuaternionFromProperEuler:setQuaternionFromProperEuler,\nnormalize:normalize,\ndenormalize:denormalize$1});var\n\n\nVector2=function(){\n\nfunction Vector2(){var x=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;var y=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;_classCallCheck(this,Vector2);\n\nVector2.prototype.isVector2=true;\n\nthis.x=x;\nthis.y=y;\n\n}_createClass(Vector2,[{key:'set',value:function set(\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nx,y){\n\nthis.x=x;\nthis.y=y;\n\nreturn this;\n\n}},{key:'setScalar',value:function setScalar(\n\nscalar){\n\nthis.x=scalar;\nthis.y=scalar;\n\nreturn this;\n\n}},{key:'setX',value:function setX(\n\nx){\n\nthis.x=x;\n\nreturn this;\n\n}},{key:'setY',value:function setY(\n\ny){\n\nthis.y=y;\n\nreturn this;\n\n}},{key:'setComponent',value:function setComponent(\n\nindex,value){\n\nswitch(index){\n\ncase 0:this.x=value;break;\ncase 1:this.y=value;break;\ndefault:throw new Error('index is out of range: '+index);}\n\n\n\nreturn this;\n\n}},{key:'getComponent',value:function getComponent(\n\nindex){\n\nswitch(index){\n\ncase 0:return this.x;\ncase 1:return this.y;\ndefault:throw new Error('index is out of range: '+index);}\n\n\n\n}},{key:'clone',value:function clone()\n\n{\n\nreturn new this.constructor(this.x,this.y);\n\n}},{key:'copy',value:function copy(\n\nv){\n\nthis.x=v.x;\nthis.y=v.y;\n\nreturn this;\n\n}},{key:'add',value:function add(\n\nv,w){\n\nif(w!==undefined){\n\nconsole.warn('THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead.');\nreturn this.addVectors(v,w);\n\n}\n\nthis.x+=v.x;\nthis.y+=v.y;\n\nreturn this;\n\n}},{key:'addScalar',value:function addScalar(\n\ns){\n\nthis.x+=s;\nthis.y+=s;\n\nreturn this;\n\n}},{key:'addVectors',value:function addVectors(\n\na,b){\n\nthis.x=a.x+b.x;\nthis.y=a.y+b.y;\n\nreturn this;\n\n}},{key:'addScaledVector',value:function addScaledVector(\n\nv,s){\n\nthis.x+=v.x*s;\nthis.y+=v.y*s;\n\nreturn this;\n\n}},{key:'sub',value:function sub(\n\nv,w){\n\nif(w!==undefined){\n\nconsole.warn('THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead.');\nreturn this.subVectors(v,w);\n\n}\n\nthis.x-=v.x;\nthis.y-=v.y;\n\nreturn this;\n\n}},{key:'subScalar',value:function subScalar(\n\ns){\n\nthis.x-=s;\nthis.y-=s;\n\nreturn this;\n\n}},{key:'subVectors',value:function subVectors(\n\na,b){\n\nthis.x=a.x-b.x;\nthis.y=a.y-b.y;\n\nreturn this;\n\n}},{key:'multiply',value:function multiply(\n\nv){\n\nthis.x*=v.x;\nthis.y*=v.y;\n\nreturn this;\n\n}},{key:'multiplyScalar',value:function multiplyScalar(\n\nscalar){\n\nthis.x*=scalar;\nthis.y*=scalar;\n\nreturn this;\n\n}},{key:'divide',value:function divide(\n\nv){\n\nthis.x/=v.x;\nthis.y/=v.y;\n\nreturn this;\n\n}},{key:'divideScalar',value:function divideScalar(\n\nscalar){\n\nreturn this.multiplyScalar(1/scalar);\n\n}},{key:'applyMatrix3',value:function applyMatrix3(\n\nm){\n\nvar x=this.x,y=this.y;\nvar e=m.elements;\n\nthis.x=e[0]*x+e[3]*y+e[6];\nthis.y=e[1]*x+e[4]*y+e[7];\n\nreturn this;\n\n}},{key:'min',value:function min(\n\nv){\n\nthis.x=Math.min(this.x,v.x);\nthis.y=Math.min(this.y,v.y);\n\nreturn this;\n\n}},{key:'max',value:function max(\n\nv){\n\nthis.x=Math.max(this.x,v.x);\nthis.y=Math.max(this.y,v.y);\n\nreturn this;\n\n}},{key:'clamp',value:function clamp(\n\nmin,max){\n\n// assumes min < max, componentwise\n\nthis.x=Math.max(min.x,Math.min(max.x,this.x));\nthis.y=Math.max(min.y,Math.min(max.y,this.y));\n\nreturn this;\n\n}},{key:'clampScalar',value:function clampScalar(\n\nminVal,maxVal){\n\nthis.x=Math.max(minVal,Math.min(maxVal,this.x));\nthis.y=Math.max(minVal,Math.min(maxVal,this.y));\n\nreturn this;\n\n}},{key:'clampLength',value:function clampLength(\n\nmin,max){\n\nvar length=this.length();\n\nreturn this.divideScalar(length||1).multiplyScalar(Math.max(min,Math.min(max,length)));\n\n}},{key:'floor',value:function floor()\n\n{\n\nthis.x=Math.floor(this.x);\nthis.y=Math.floor(this.y);\n\nreturn this;\n\n}},{key:'ceil',value:function ceil()\n\n{\n\nthis.x=Math.ceil(this.x);\nthis.y=Math.ceil(this.y);\n\nreturn this;\n\n}},{key:'round',value:function round()\n\n{\n\nthis.x=Math.round(this.x);\nthis.y=Math.round(this.y);\n\nreturn this;\n\n}},{key:'roundToZero',value:function roundToZero()\n\n{\n\nthis.x=this.x<0?Math.ceil(this.x):Math.floor(this.x);\nthis.y=this.y<0?Math.ceil(this.y):Math.floor(this.y);\n\nreturn this;\n\n}},{key:'negate',value:function negate()\n\n{\n\nthis.x=-this.x;\nthis.y=-this.y;\n\nreturn this;\n\n}},{key:'dot',value:function dot(\n\nv){\n\nreturn this.x*v.x+this.y*v.y;\n\n}},{key:'cross',value:function cross(\n\nv){\n\nreturn this.x*v.y-this.y*v.x;\n\n}},{key:'lengthSq',value:function lengthSq()\n\n{\n\nreturn this.x*this.x+this.y*this.y;\n\n}},{key:'length',value:function length()\n\n{\n\nreturn Math.sqrt(this.x*this.x+this.y*this.y);\n\n}},{key:'manhattanLength',value:function manhattanLength()\n\n{\n\nreturn Math.abs(this.x)+Math.abs(this.y);\n\n}},{key:'normalize',value:function normalize()\n\n{\n\nreturn this.divideScalar(this.length()||1);\n\n}},{key:'angle',value:function angle()\n\n{\n\n// computes the angle in radians with respect to the positive x-axis\n\nvar angle=Math.atan2(-this.y,-this.x)+Math.PI;\n\nreturn angle;\n\n}},{key:'distanceTo',value:function distanceTo(\n\nv){\n\nreturn Math.sqrt(this.distanceToSquared(v));\n\n}},{key:'distanceToSquared',value:function distanceToSquared(\n\nv){\n\nvar dx=this.x-v.x,dy=this.y-v.y;\nreturn dx*dx+dy*dy;\n\n}},{key:'manhattanDistanceTo',value:function manhattanDistanceTo(\n\nv){\n\nreturn Math.abs(this.x-v.x)+Math.abs(this.y-v.y);\n\n}},{key:'setLength',value:function setLength(\n\nlength){\n\nreturn this.normalize().multiplyScalar(length);\n\n}},{key:'lerp',value:function lerp(\n\nv,alpha){\n\nthis.x+=(v.x-this.x)*alpha;\nthis.y+=(v.y-this.y)*alpha;\n\nreturn this;\n\n}},{key:'lerpVectors',value:function lerpVectors(\n\nv1,v2,alpha){\n\nthis.x=v1.x+(v2.x-v1.x)*alpha;\nthis.y=v1.y+(v2.y-v1.y)*alpha;\n\nreturn this;\n\n}},{key:'equals',value:function equals(\n\nv){\n\nreturn v.x===this.x&&v.y===this.y;\n\n}},{key:'fromArray',value:function fromArray(\n\narray){var offset=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;\n\nthis.x=array[offset];\nthis.y=array[offset+1];\n\nreturn this;\n\n}},{key:'toArray',value:function toArray()\n\n{var array=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];var offset=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;\n\narray[offset]=this.x;\narray[offset+1]=this.y;\n\nreturn array;\n\n}},{key:'fromBufferAttribute',value:function fromBufferAttribute(\n\nattribute,index,offset){\n\nif(offset!==undefined){\n\nconsole.warn('THREE.Vector2: offset has been removed from .fromBufferAttribute().');\n\n}\n\nthis.x=attribute.getX(index);\nthis.y=attribute.getY(index);\n\nreturn this;\n\n}},{key:'rotateAround',value:function rotateAround(\n\ncenter,angle){\n\nvar c=Math.cos(angle),s=Math.sin(angle);\n\nvar x=this.x-center.x;\nvar y=this.y-center.y;\n\nthis.x=x*c-y*s+center.x;\nthis.y=x*s+y*c+center.y;\n\nreturn this;\n\n}},{key:'random',value:function random()\n\n{\n\nthis.x=Math.random();\nthis.y=Math.random();\n\nreturn this;\n\n}},{key:\n\nSymbol.iterator,value:/*#__PURE__*/regeneratorRuntime.mark(function value(){return regeneratorRuntime.wrap(function value$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return(\n\nthis.x);case 2:_context2.next=4;return(\nthis.y);case 4:case'end':return _context2.stop();}}},value,this);})},{key:'width',get:function get(){return this.x;},set:function set(value){this.x=value;}},{key:'height',get:function get(){return this.y;},set:function set(value){this.y=value;}}]);return Vector2;}();var\n\n\n\n\n\nMatrix3=function(){\n\nfunction Matrix3(){_classCallCheck(this,Matrix3);\n\nMatrix3.prototype.isMatrix3=true;\n\nthis.elements=[\n\n1,0,0,\n0,1,0,\n0,0,1];\n\n\n\nif(arguments.length>0){\n\nconsole.error('THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.');\n\n}\n\n}_createClass(Matrix3,[{key:'set',value:function set(\n\nn11,n12,n13,n21,n22,n23,n31,n32,n33){\n\nvar te=this.elements;\n\nte[0]=n11;te[1]=n21;te[2]=n31;\nte[3]=n12;te[4]=n22;te[5]=n32;\nte[6]=n13;te[7]=n23;te[8]=n33;\n\nreturn this;\n\n}},{key:'identity',value:function identity()\n\n{\n\nthis.set(\n\n1,0,0,\n0,1,0,\n0,0,1);\n\n\n\nreturn this;\n\n}},{key:'copy',value:function copy(\n\nm){\n\nvar te=this.elements;\nvar me=m.elements;\n\nte[0]=me[0];te[1]=me[1];te[2]=me[2];\nte[3]=me[3];te[4]=me[4];te[5]=me[5];\nte[6]=me[6];te[7]=me[7];te[8]=me[8];\n\nreturn this;\n\n}},{key:'extractBasis',value:function extractBasis(\n\nxAxis,yAxis,zAxis){\n\nxAxis.setFromMatrix3Column(this,0);\nyAxis.setFromMatrix3Column(this,1);\nzAxis.setFromMatrix3Column(this,2);\n\nreturn this;\n\n}},{key:'setFromMatrix4',value:function setFromMatrix4(\n\nm){\n\nvar me=m.elements;\n\nthis.set(\n\nme[0],me[4],me[8],\nme[1],me[5],me[9],\nme[2],me[6],me[10]);\n\n\n\nreturn this;\n\n}},{key:'multiply',value:function multiply(\n\nm){\n\nreturn this.multiplyMatrices(this,m);\n\n}},{key:'premultiply',value:function premultiply(\n\nm){\n\nreturn this.multiplyMatrices(m,this);\n\n}},{key:'multiplyMatrices',value:function multiplyMatrices(\n\na,b){\n\nvar ae=a.elements;\nvar be=b.elements;\nvar te=this.elements;\n\nvar a11=ae[0],a12=ae[3],a13=ae[6];\nvar a21=ae[1],a22=ae[4],a23=ae[7];\nvar a31=ae[2],a32=ae[5],a33=ae[8];\n\nvar b11=be[0],b12=be[3],b13=be[6];\nvar b21=be[1],b22=be[4],b23=be[7];\nvar b31=be[2],b32=be[5],b33=be[8];\n\nte[0]=a11*b11+a12*b21+a13*b31;\nte[3]=a11*b12+a12*b22+a13*b32;\nte[6]=a11*b13+a12*b23+a13*b33;\n\nte[1]=a21*b11+a22*b21+a23*b31;\nte[4]=a21*b12+a22*b22+a23*b32;\nte[7]=a21*b13+a22*b23+a23*b33;\n\nte[2]=a31*b11+a32*b21+a33*b31;\nte[5]=a31*b12+a32*b22+a33*b32;\nte[8]=a31*b13+a32*b23+a33*b33;\n\nreturn this;\n\n}},{key:'multiplyScalar',value:function multiplyScalar(\n\ns){\n\nvar te=this.elements;\n\nte[0]*=s;te[3]*=s;te[6]*=s;\nte[1]*=s;te[4]*=s;te[7]*=s;\nte[2]*=s;te[5]*=s;te[8]*=s;\n\nreturn this;\n\n}},{key:'determinant',value:function determinant()\n\n{\n\nvar te=this.elements;\n\nvar a=te[0],b=te[1],c=te[2],\nd=te[3],e=te[4],f=te[5],\ng=te[6],h=te[7],i=te[8];\n\nreturn a*e*i-a*f*h-b*d*i+b*f*g+c*d*h-c*e*g;\n\n}},{key:'invert',value:function invert()\n\n{\n\nvar te=this.elements,\n\nn11=te[0],n21=te[1],n31=te[2],\nn12=te[3],n22=te[4],n32=te[5],\nn13=te[6],n23=te[7],n33=te[8],\n\nt11=n33*n22-n32*n23,\nt12=n32*n13-n33*n12,\nt13=n23*n12-n22*n13,\n\ndet=n11*t11+n21*t12+n31*t13;\n\nif(det===0)return this.set(0,0,0,0,0,0,0,0,0);\n\nvar detInv=1/det;\n\nte[0]=t11*detInv;\nte[1]=(n31*n23-n33*n21)*detInv;\nte[2]=(n32*n21-n31*n22)*detInv;\n\nte[3]=t12*detInv;\nte[4]=(n33*n11-n31*n13)*detInv;\nte[5]=(n31*n12-n32*n11)*detInv;\n\nte[6]=t13*detInv;\nte[7]=(n21*n13-n23*n11)*detInv;\nte[8]=(n22*n11-n21*n12)*detInv;\n\nreturn this;\n\n}},{key:'transpose',value:function transpose()\n\n{\n\nvar tmp=void 0;\nvar m=this.elements;\n\ntmp=m[1];m[1]=m[3];m[3]=tmp;\ntmp=m[2];m[2]=m[6];m[6]=tmp;\ntmp=m[5];m[5]=m[7];m[7]=tmp;\n\nreturn this;\n\n}},{key:'getNormalMatrix',value:function getNormalMatrix(\n\nmatrix4){\n\nreturn this.setFromMatrix4(matrix4).invert().transpose();\n\n}},{key:'transposeIntoArray',value:function transposeIntoArray(\n\nr){\n\nvar m=this.elements;\n\nr[0]=m[0];\nr[1]=m[3];\nr[2]=m[6];\nr[3]=m[1];\nr[4]=m[4];\nr[5]=m[7];\nr[6]=m[2];\nr[7]=m[5];\nr[8]=m[8];\n\nreturn this;\n\n}},{key:'setUvTransform',value:function setUvTransform(\n\ntx,ty,sx,sy,rotation,cx,cy){\n\nvar c=Math.cos(rotation);\nvar s=Math.sin(rotation);\n\nthis.set(\nsx*c,sx*s,-sx*(c*cx+s*cy)+cx+tx,\n-sy*s,sy*c,-sy*(-s*cx+c*cy)+cy+ty,\n0,0,1);\n\n\nreturn this;\n\n}},{key:'scale',value:function scale(\n\nsx,sy){\n\nvar te=this.elements;\n\nte[0]*=sx;te[3]*=sx;te[6]*=sx;\nte[1]*=sy;te[4]*=sy;te[7]*=sy;\n\nreturn this;\n\n}},{key:'rotate',value:function rotate(\n\ntheta){\n\nvar c=Math.cos(theta);\nvar s=Math.sin(theta);\n\nvar te=this.elements;\n\nvar a11=te[0],a12=te[3],a13=te[6];\nvar a21=te[1],a22=te[4],a23=te[7];\n\nte[0]=c*a11+s*a21;\nte[3]=c*a12+s*a22;\nte[6]=c*a13+s*a23;\n\nte[1]=-s*a11+c*a21;\nte[4]=-s*a12+c*a22;\nte[7]=-s*a13+c*a23;\n\nreturn this;\n\n}},{key:'translate',value:function translate(\n\ntx,ty){\n\nvar te=this.elements;\n\nte[0]+=tx*te[2];te[3]+=tx*te[5];te[6]+=tx*te[8];\nte[1]+=ty*te[2];te[4]+=ty*te[5];te[7]+=ty*te[8];\n\nreturn this;\n\n}},{key:'equals',value:function equals(\n\nmatrix){\n\nvar te=this.elements;\nvar me=matrix.elements;\n\nfor(var i=0;i<9;i++){\n\nif(te[i]!==me[i])return false;\n\n}\n\nreturn true;\n\n}},{key:'fromArray',value:function fromArray(\n\narray){var offset=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;\n\nfor(var i=0;i<9;i++){\n\nthis.elements[i]=array[i+offset];\n\n}\n\nreturn this;\n\n}},{key:'toArray',value:function toArray()\n\n{var array=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];var offset=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;\n\nvar te=this.elements;\n\narray[offset]=te[0];\narray[offset+1]=te[1];\narray[offset+2]=te[2];\n\narray[offset+3]=te[3];\narray[offset+4]=te[4];\narray[offset+5]=te[5];\n\narray[offset+6]=te[6];\narray[offset+7]=te[7];\narray[offset+8]=te[8];\n\nreturn array;\n\n}},{key:'clone',value:function clone()\n\n{\n\nreturn new this.constructor().fromArray(this.elements);\n\n}}]);return Matrix3;}();\n\n\n\nfunction arrayNeedsUint32(array){\n\n// assumes larger values usually on last\n\nfor(var i=array.length-1;i>=0;--i){\n\nif(array[i]>65535)return true;\n\n}\n\nreturn false;\n\n}\n\nvar TYPED_ARRAYS={\nInt8Array:Int8Array,\nUint8Array:Uint8Array,\nUint8ClampedArray:Uint8ClampedArray,\nInt16Array:Int16Array,\nUint16Array:Uint16Array,\nInt32Array:Int32Array,\nUint32Array:Uint32Array,\nFloat32Array:Float32Array,\nFloat64Array:Float64Array};\n\n\nfunction getTypedArray(type,buffer){\n\nreturn new TYPED_ARRAYS[type](buffer);\n\n}\n\nfunction createElementNS(name){\n\nreturn document.createElementNS('http://www.w3.org/1999/xhtml',name);\n\n}\n\nfunction SRGBToLinear(c){\n\nreturn c<0.04045?c*0.0773993808:Math.pow(c*0.9478672986+0.0521327014,2.4);\n\n}\n\nfunction LinearToSRGB(c){\n\nreturn c<0.0031308?c*12.92:1.055*Math.pow(c,0.41666)-0.055;\n\n}\n\n// JavaScript RGB-to-RGB transforms, defined as\n// FN[InputColorSpace][OutputColorSpace] callback functions.\nvar FN=(_FN={},_defineProperty(_FN,\nSRGBColorSpace,_defineProperty({},LinearSRGBColorSpace,SRGBToLinear)),_defineProperty(_FN,\nLinearSRGBColorSpace,_defineProperty({},SRGBColorSpace,LinearToSRGB)),_FN);\n\n\nvar ColorManagement={\n\nlegacyMode:true,\n\nget workingColorSpace(){\n\nreturn LinearSRGBColorSpace;\n\n},\n\nset workingColorSpace(colorSpace){\n\nconsole.warn('THREE.ColorManagement: .workingColorSpace is readonly.');\n\n},\n\nconvert:function convert(color,sourceColorSpace,targetColorSpace){\n\nif(this.legacyMode||sourceColorSpace===targetColorSpace||!sourceColorSpace||!targetColorSpace){\n\nreturn color;\n\n}\n\nif(FN[sourceColorSpace]&&FN[sourceColorSpace][targetColorSpace]!==undefined){\n\nvar fn=FN[sourceColorSpace][targetColorSpace];\n\ncolor.r=fn(color.r);\ncolor.g=fn(color.g);\ncolor.b=fn(color.b);\n\nreturn color;\n\n}\n\nthrow new Error('Unsupported color space conversion.');\n\n},\n\nfromWorkingColorSpace:function fromWorkingColorSpace(color,targetColorSpace){\n\nreturn this.convert(color,this.workingColorSpace,targetColorSpace);\n\n},\n\ntoWorkingColorSpace:function toWorkingColorSpace(color,sourceColorSpace){\n\nreturn this.convert(color,sourceColorSpace,this.workingColorSpace);\n\n}};\n\n\n\nvar _colorKeywords={'aliceblue':0xF0F8FF,'antiquewhite':0xFAEBD7,'aqua':0x00FFFF,'aquamarine':0x7FFFD4,'azure':0xF0FFFF,\n'beige':0xF5F5DC,'bisque':0xFFE4C4,'black':0x000000,'blanchedalmond':0xFFEBCD,'blue':0x0000FF,'blueviolet':0x8A2BE2,\n'brown':0xA52A2A,'burlywood':0xDEB887,'cadetblue':0x5F9EA0,'chartreuse':0x7FFF00,'chocolate':0xD2691E,'coral':0xFF7F50,\n'cornflowerblue':0x6495ED,'cornsilk':0xFFF8DC,'crimson':0xDC143C,'cyan':0x00FFFF,'darkblue':0x00008B,'darkcyan':0x008B8B,\n'darkgoldenrod':0xB8860B,'darkgray':0xA9A9A9,'darkgreen':0x006400,'darkgrey':0xA9A9A9,'darkkhaki':0xBDB76B,'darkmagenta':0x8B008B,\n'darkolivegreen':0x556B2F,'darkorange':0xFF8C00,'darkorchid':0x9932CC,'darkred':0x8B0000,'darksalmon':0xE9967A,'darkseagreen':0x8FBC8F,\n'darkslateblue':0x483D8B,'darkslategray':0x2F4F4F,'darkslategrey':0x2F4F4F,'darkturquoise':0x00CED1,'darkviolet':0x9400D3,\n'deeppink':0xFF1493,'deepskyblue':0x00BFFF,'dimgray':0x696969,'dimgrey':0x696969,'dodgerblue':0x1E90FF,'firebrick':0xB22222,\n'floralwhite':0xFFFAF0,'forestgreen':0x228B22,'fuchsia':0xFF00FF,'gainsboro':0xDCDCDC,'ghostwhite':0xF8F8FF,'gold':0xFFD700,\n'goldenrod':0xDAA520,'gray':0x808080,'green':0x008000,'greenyellow':0xADFF2F,'grey':0x808080,'honeydew':0xF0FFF0,'hotpink':0xFF69B4,\n'indianred':0xCD5C5C,'indigo':0x4B0082,'ivory':0xFFFFF0,'khaki':0xF0E68C,'lavender':0xE6E6FA,'lavenderblush':0xFFF0F5,'lawngreen':0x7CFC00,\n'lemonchiffon':0xFFFACD,'lightblue':0xADD8E6,'lightcoral':0xF08080,'lightcyan':0xE0FFFF,'lightgoldenrodyellow':0xFAFAD2,'lightgray':0xD3D3D3,\n'lightgreen':0x90EE90,'lightgrey':0xD3D3D3,'lightpink':0xFFB6C1,'lightsalmon':0xFFA07A,'lightseagreen':0x20B2AA,'lightskyblue':0x87CEFA,\n'lightslategray':0x778899,'lightslategrey':0x778899,'lightsteelblue':0xB0C4DE,'lightyellow':0xFFFFE0,'lime':0x00FF00,'limegreen':0x32CD32,\n'linen':0xFAF0E6,'magenta':0xFF00FF,'maroon':0x800000,'mediumaquamarine':0x66CDAA,'mediumblue':0x0000CD,'mediumorchid':0xBA55D3,\n'mediumpurple':0x9370DB,'mediumseagreen':0x3CB371,'mediumslateblue':0x7B68EE,'mediumspringgreen':0x00FA9A,'mediumturquoise':0x48D1CC,\n'mediumvioletred':0xC71585,'midnightblue':0x191970,'mintcream':0xF5FFFA,'mistyrose':0xFFE4E1,'moccasin':0xFFE4B5,'navajowhite':0xFFDEAD,\n'navy':0x000080,'oldlace':0xFDF5E6,'olive':0x808000,'olivedrab':0x6B8E23,'orange':0xFFA500,'orangered':0xFF4500,'orchid':0xDA70D6,\n'palegoldenrod':0xEEE8AA,'palegreen':0x98FB98,'paleturquoise':0xAFEEEE,'palevioletred':0xDB7093,'papayawhip':0xFFEFD5,'peachpuff':0xFFDAB9,\n'peru':0xCD853F,'pink':0xFFC0CB,'plum':0xDDA0DD,'powderblue':0xB0E0E6,'purple':0x800080,'rebeccapurple':0x663399,'red':0xFF0000,'rosybrown':0xBC8F8F,\n'royalblue':0x4169E1,'saddlebrown':0x8B4513,'salmon':0xFA8072,'sandybrown':0xF4A460,'seagreen':0x2E8B57,'seashell':0xFFF5EE,\n'sienna':0xA0522D,'silver':0xC0C0C0,'skyblue':0x87CEEB,'slateblue':0x6A5ACD,'slategray':0x708090,'slategrey':0x708090,'snow':0xFFFAFA,\n'springgreen':0x00FF7F,'steelblue':0x4682B4,'tan':0xD2B48C,'teal':0x008080,'thistle':0xD8BFD8,'tomato':0xFF6347,'turquoise':0x40E0D0,\n'violet':0xEE82EE,'wheat':0xF5DEB3,'white':0xFFFFFF,'whitesmoke':0xF5F5F5,'yellow':0xFFFF00,'yellowgreen':0x9ACD32};\n\nvar _rgb={r:0,g:0,b:0};\nvar _hslA={h:0,s:0,l:0};\nvar _hslB={h:0,s:0,l:0};\n\nfunction hue2rgb(p,q,t){\n\nif(t<0)t+=1;\nif(t>1)t-=1;\nif(t<1/6)return p+(q-p)*6*t;\nif(t<1/2)return q;\nif(t<2/3)return p+(q-p)*6*(2/3-t);\nreturn p;\n\n}\n\nfunction toComponents(source,target){\n\ntarget.r=source.r;\ntarget.g=source.g;\ntarget.b=source.b;\n\nreturn target;\n\n}var\n\nColor=function(){\n\nfunction Color(r,g,b){_classCallCheck(this,Color);\n\nthis.isColor=true;\n\nthis.r=1;\nthis.g=1;\nthis.b=1;\n\nif(g===undefined&&b===undefined){\n\n// r is THREE.Color, hex or string\nreturn this.set(r);\n\n}\n\nreturn this.setRGB(r,g,b);\n\n}_createClass(Color,[{key:'set',value:function set(\n\nvalue){\n\nif(value&&value.isColor){\n\nthis.copy(value);\n\n}else if(typeof value==='number'){\n\nthis.setHex(value);\n\n}else if(typeof value==='string'){\n\nthis.setStyle(value);\n\n}\n\nreturn this;\n\n}},{key:'setScalar',value:function setScalar(\n\nscalar){\n\nthis.r=scalar;\nthis.g=scalar;\nthis.b=scalar;\n\nreturn this;\n\n}},{key:'setHex',value:function setHex(\n\nhex){var colorSpace=arguments.length>1&&arguments[1]!==undefined?arguments[1]:SRGBColorSpace;\n\nhex=Math.floor(hex);\n\nthis.r=(hex>>16&255)/255;\nthis.g=(hex>>8&255)/255;\nthis.b=(hex&255)/255;\n\nColorManagement.toWorkingColorSpace(this,colorSpace);\n\nreturn this;\n\n}},{key:'setRGB',value:function setRGB(\n\nr,g,b){var colorSpace=arguments.length>3&&arguments[3]!==undefined?arguments[3]:LinearSRGBColorSpace;\n\nthis.r=r;\nthis.g=g;\nthis.b=b;\n\nColorManagement.toWorkingColorSpace(this,colorSpace);\n\nreturn this;\n\n}},{key:'setHSL',value:function setHSL(\n\nh,s,l){var colorSpace=arguments.length>3&&arguments[3]!==undefined?arguments[3]:LinearSRGBColorSpace;\n\n// h,s,l ranges are in 0.0 - 1.0\nh=euclideanModulo(h,1);\ns=clamp(s,0,1);\nl=clamp(l,0,1);\n\nif(s===0){\n\nthis.r=this.g=this.b=l;\n\n}else{\n\nvar p=l<=0.5?l*(1+s):l+s-l*s;\nvar q=2*l-p;\n\nthis.r=hue2rgb(q,p,h+1/3);\nthis.g=hue2rgb(q,p,h);\nthis.b=hue2rgb(q,p,h-1/3);\n\n}\n\nColorManagement.toWorkingColorSpace(this,colorSpace);\n\nreturn this;\n\n}},{key:'setStyle',value:function setStyle(\n\nstyle){var colorSpace=arguments.length>1&&arguments[1]!==undefined?arguments[1]:SRGBColorSpace;\n\nfunction handleAlpha(string){\n\nif(string===undefined)return;\n\nif(parseFloat(string)<1){\n\nconsole.warn('THREE.Color: Alpha component of '+style+' will be ignored.');\n\n}\n\n}\n\n\nvar m=void 0;\n\nif(m=/^((?:rgb|hsl)a?)\\(([^\\)]*)\\)/.exec(style)){\n\n// rgb / hsl\n\nvar color=void 0;\nvar name=m[1];\nvar components=m[2];\n\nswitch(name){\n\ncase'rgb':\ncase'rgba':\n\nif(color=/^\\s*(\\d+)\\s*,\\s*(\\d+)\\s*,\\s*(\\d+)\\s*(?:,\\s*(\\d*\\.?\\d+)\\s*)?$/.exec(components)){\n\n// rgb(255,0,0) rgba(255,0,0,0.5)\nthis.r=Math.min(255,parseInt(color[1],10))/255;\nthis.g=Math.min(255,parseInt(color[2],10))/255;\nthis.b=Math.min(255,parseInt(color[3],10))/255;\n\nColorManagement.toWorkingColorSpace(this,colorSpace);\n\nhandleAlpha(color[4]);\n\nreturn this;\n\n}\n\nif(color=/^\\s*(\\d+)\\%\\s*,\\s*(\\d+)\\%\\s*,\\s*(\\d+)\\%\\s*(?:,\\s*(\\d*\\.?\\d+)\\s*)?$/.exec(components)){\n\n// rgb(100%,0%,0%) rgba(100%,0%,0%,0.5)\nthis.r=Math.min(100,parseInt(color[1],10))/100;\nthis.g=Math.min(100,parseInt(color[2],10))/100;\nthis.b=Math.min(100,parseInt(color[3],10))/100;\n\nColorManagement.toWorkingColorSpace(this,colorSpace);\n\nhandleAlpha(color[4]);\n\nreturn this;\n\n}\n\nbreak;\n\ncase'hsl':\ncase'hsla':\n\nif(color=/^\\s*(\\d*\\.?\\d+)\\s*,\\s*(\\d+)\\%\\s*,\\s*(\\d+)\\%\\s*(?:,\\s*(\\d*\\.?\\d+)\\s*)?$/.exec(components)){\n\n// hsl(120,50%,50%) hsla(120,50%,50%,0.5)\nvar h=parseFloat(color[1])/360;\nvar s=parseInt(color[2],10)/100;\nvar l=parseInt(color[3],10)/100;\n\nhandleAlpha(color[4]);\n\nreturn this.setHSL(h,s,l,colorSpace);\n\n}\n\nbreak;}\n\n\n\n}else if(m=/^\\#([A-Fa-f\\d]+)$/.exec(style)){\n\n// hex color\n\nvar hex=m[1];\nvar size=hex.length;\n\nif(size===3){\n\n// #ff0\nthis.r=parseInt(hex.charAt(0)+hex.charAt(0),16)/255;\nthis.g=parseInt(hex.charAt(1)+hex.charAt(1),16)/255;\nthis.b=parseInt(hex.charAt(2)+hex.charAt(2),16)/255;\n\nColorManagement.toWorkingColorSpace(this,colorSpace);\n\nreturn this;\n\n}else if(size===6){\n\n// #ff0000\nthis.r=parseInt(hex.charAt(0)+hex.charAt(1),16)/255;\nthis.g=parseInt(hex.charAt(2)+hex.charAt(3),16)/255;\nthis.b=parseInt(hex.charAt(4)+hex.charAt(5),16)/255;\n\nColorManagement.toWorkingColorSpace(this,colorSpace);\n\nreturn this;\n\n}\n\n}\n\nif(style&&style.length>0){\n\nreturn this.setColorName(style,colorSpace);\n\n}\n\nreturn this;\n\n}},{key:'setColorName',value:function setColorName(\n\nstyle){var colorSpace=arguments.length>1&&arguments[1]!==undefined?arguments[1]:SRGBColorSpace;\n\n// color keywords\nvar hex=_colorKeywords[style.toLowerCase()];\n\nif(hex!==undefined){\n\n// red\nthis.setHex(hex,colorSpace);\n\n}else{\n\n// unknown color\nconsole.warn('THREE.Color: Unknown color '+style);\n\n}\n\nreturn this;\n\n}},{key:'clone',value:function clone()\n\n{\n\nreturn new this.constructor(this.r,this.g,this.b);\n\n}},{key:'copy',value:function copy(\n\ncolor){\n\nthis.r=color.r;\nthis.g=color.g;\nthis.b=color.b;\n\nreturn this;\n\n}},{key:'copySRGBToLinear',value:function copySRGBToLinear(\n\ncolor){\n\nthis.r=SRGBToLinear(color.r);\nthis.g=SRGBToLinear(color.g);\nthis.b=SRGBToLinear(color.b);\n\nreturn this;\n\n}},{key:'copyLinearToSRGB',value:function copyLinearToSRGB(\n\ncolor){\n\nthis.r=LinearToSRGB(color.r);\nthis.g=LinearToSRGB(color.g);\nthis.b=LinearToSRGB(color.b);\n\nreturn this;\n\n}},{key:'convertSRGBToLinear',value:function convertSRGBToLinear()\n\n{\n\nthis.copySRGBToLinear(this);\n\nreturn this;\n\n}},{key:'convertLinearToSRGB',value:function convertLinearToSRGB()\n\n{\n\nthis.copyLinearToSRGB(this);\n\nreturn this;\n\n}},{key:'getHex',value:function getHex()\n\n{var colorSpace=arguments.length>0&&arguments[0]!==undefined?arguments[0]:SRGBColorSpace;\n\nColorManagement.fromWorkingColorSpace(toComponents(this,_rgb),colorSpace);\n\nreturn clamp(_rgb.r*255,0,255)<<16^clamp(_rgb.g*255,0,255)<<8^clamp(_rgb.b*255,0,255)<<0;\n\n}},{key:'getHexString',value:function getHexString()\n\n{var colorSpace=arguments.length>0&&arguments[0]!==undefined?arguments[0]:SRGBColorSpace;\n\nreturn('000000'+this.getHex(colorSpace).toString(16)).slice(-6);\n\n}},{key:'getHSL',value:function getHSL(\n\ntarget){var colorSpace=arguments.length>1&&arguments[1]!==undefined?arguments[1]:LinearSRGBColorSpace;\n\n// h,s,l ranges are in 0.0 - 1.0\n\nColorManagement.fromWorkingColorSpace(toComponents(this,_rgb),colorSpace);\n\nvar r=_rgb.r,g=_rgb.g,b=_rgb.b;\n\nvar max=Math.max(r,g,b);\nvar min=Math.min(r,g,b);\n\nvar hue=void 0,saturation=void 0;\nvar lightness=(min+max)/2.0;\n\nif(min===max){\n\nhue=0;\nsaturation=0;\n\n}else{\n\nvar delta=max-min;\n\nsaturation=lightness<=0.5?delta/(max+min):delta/(2-max-min);\n\nswitch(max){\n\ncase r:hue=(g-b)/delta+(g<b?6:0);break;\ncase g:hue=(b-r)/delta+2;break;\ncase b:hue=(r-g)/delta+4;break;}\n\n\n\nhue/=6;\n\n}\n\ntarget.h=hue;\ntarget.s=saturation;\ntarget.l=lightness;\n\nreturn target;\n\n}},{key:'getRGB',value:function getRGB(\n\ntarget){var colorSpace=arguments.length>1&&arguments[1]!==undefined?arguments[1]:LinearSRGBColorSpace;\n\nColorManagement.fromWorkingColorSpace(toComponents(this,_rgb),colorSpace);\n\ntarget.r=_rgb.r;\ntarget.g=_rgb.g;\ntarget.b=_rgb.b;\n\nreturn target;\n\n}},{key:'getStyle',value:function getStyle()\n\n{var colorSpace=arguments.length>0&&arguments[0]!==undefined?arguments[0]:SRGBColorSpace;\n\nColorManagement.fromWorkingColorSpace(toComponents(this,_rgb),colorSpace);\n\nif(colorSpace!==SRGBColorSpace){\n\n// Requires CSS Color Module Level 4 (https://www.w3.org/TR/css-color-4/).\nreturn'color('+colorSpace+' '+_rgb.r+' '+_rgb.g+' '+_rgb.b+')';\n\n}\n\nreturn'rgb('+(_rgb.r*255|0)+','+(_rgb.g*255|0)+','+(_rgb.b*255|0)+')';\n\n}},{key:'offsetHSL',value:function offsetHSL(\n\nh,s,l){\n\nthis.getHSL(_hslA);\n\n_hslA.h+=h;_hslA.s+=s;_hslA.l+=l;\n\nthis.setHSL(_hslA.h,_hslA.s,_hslA.l);\n\nreturn this;\n\n}},{key:'add',value:function add(\n\ncolor){\n\nthis.r+=color.r;\nthis.g+=color.g;\nthis.b+=color.b;\n\nreturn this;\n\n}},{key:'addColors',value:function addColors(\n\ncolor1,color2){\n\nthis.r=color1.r+color2.r;\nthis.g=color1.g+color2.g;\nthis.b=color1.b+color2.b;\n\nreturn this;\n\n}},{key:'addScalar',value:function addScalar(\n\ns){\n\nthis.r+=s;\nthis.g+=s;\nthis.b+=s;\n\nreturn this;\n\n}},{key:'sub',value:function sub(\n\ncolor){\n\nthis.r=Math.max(0,this.r-color.r);\nthis.g=Math.max(0,this.g-color.g);\nthis.b=Math.max(0,this.b-color.b);\n\nreturn this;\n\n}},{key:'multiply',value:function multiply(\n\ncolor){\n\nthis.r*=color.r;\nthis.g*=color.g;\nthis.b*=color.b;\n\nreturn this;\n\n}},{key:'multiplyScalar',value:function multiplyScalar(\n\ns){\n\nthis.r*=s;\nthis.g*=s;\nthis.b*=s;\n\nreturn this;\n\n}},{key:'lerp',value:function lerp(\n\ncolor,alpha){\n\nthis.r+=(color.r-this.r)*alpha;\nthis.g+=(color.g-this.g)*alpha;\nthis.b+=(color.b-this.b)*alpha;\n\nreturn this;\n\n}},{key:'lerpColors',value:function lerpColors(\n\ncolor1,color2,alpha){\n\nthis.r=color1.r+(color2.r-color1.r)*alpha;\nthis.g=color1.g+(color2.g-color1.g)*alpha;\nthis.b=color1.b+(color2.b-color1.b)*alpha;\n\nreturn this;\n\n}},{key:'lerpHSL',value:function lerpHSL(\n\ncolor,alpha){\n\nthis.getHSL(_hslA);\ncolor.getHSL(_hslB);\n\nvar h=lerp(_hslA.h,_hslB.h,alpha);\nvar s=lerp(_hslA.s,_hslB.s,alpha);\nvar l=lerp(_hslA.l,_hslB.l,alpha);\n\nthis.setHSL(h,s,l);\n\nreturn this;\n\n}},{key:'equals',value:function equals(\n\nc){\n\nreturn c.r===this.r&&c.g===this.g&&c.b===this.b;\n\n}},{key:'fromArray',value:function fromArray(\n\narray){var offset=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;\n\nthis.r=array[offset];\nthis.g=array[offset+1];\nthis.b=array[offset+2];\n\nreturn this;\n\n}},{key:'toArray',value:function toArray()\n\n{var array=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];var offset=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;\n\narray[offset]=this.r;\narray[offset+1]=this.g;\narray[offset+2]=this.b;\n\nreturn array;\n\n}},{key:'fromBufferAttribute',value:function fromBufferAttribute(\n\nattribute,index){\n\nthis.r=attribute.getX(index);\nthis.g=attribute.getY(index);\nthis.b=attribute.getZ(index);\n\nif(attribute.normalized===true){\n\n// assuming Uint8Array\n\nthis.r/=255;\nthis.g/=255;\nthis.b/=255;\n\n}\n\nreturn this;\n\n}},{key:'toJSON',value:function toJSON()\n\n{\n\nreturn this.getHex();\n\n}},{key:\n\nSymbol.iterator,value:/*#__PURE__*/regeneratorRuntime.mark(function value(){return regeneratorRuntime.wrap(function value$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.next=2;return(\n\nthis.r);case 2:_context3.next=4;return(\nthis.g);case 4:_context3.next=6;return(\nthis.b);case 6:case'end':return _context3.stop();}}},value,this);})}]);return Color;}();\n\n\n\n\n\nColor.NAMES=_colorKeywords;\n\nvar _canvas=void 0;var\n\nImageUtils=function(){function ImageUtils(){_classCallCheck(this,ImageUtils);}_createClass(ImageUtils,null,[{key:'getDataURL',value:function getDataURL(\n\nimage){\n\nif(/^data:/i.test(image.src)){\n\nreturn image.src;\n\n}\n\nif(typeof HTMLCanvasElement=='undefined'){\n\nreturn image.src;\n\n}\n\nvar canvas=void 0;\n\nif(image instanceof HTMLCanvasElement){\n\ncanvas=image;\n\n}else{\n\nif(_canvas===undefined)_canvas=createElementNS('canvas');\n\n_canvas.width=image.width;\n_canvas.height=image.height;\n\nvar context=_canvas.getContext('2d');\n\nif(image instanceof ImageData){\n\ncontext.putImageData(image,0,0);\n\n}else{\n\ncontext.drawImage(image,0,0,image.width,image.height);\n\n}\n\ncanvas=_canvas;\n\n}\n\nif(canvas.width>2048||canvas.height>2048){\n\nconsole.warn('THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons',image);\n\nreturn canvas.toDataURL('image/jpeg',0.6);\n\n}else{\n\nreturn canvas.toDataURL('image/png');\n\n}\n\n}},{key:'sRGBToLinear',value:function sRGBToLinear(\n\nimage){\n\nif(typeof HTMLImageElement!=='undefined'&&image instanceof HTMLImageElement||\ntypeof HTMLCanvasElement!=='undefined'&&image instanceof HTMLCanvasElement||\ntypeof ImageBitmap!=='undefined'&&image instanceof ImageBitmap){\n\nvar canvas=createElementNS('canvas');\n\ncanvas.width=image.width;\ncanvas.height=image.height;\n\nvar context=canvas.getContext('2d');\ncontext.drawImage(image,0,0,image.width,image.height);\n\nvar imageData=context.getImageData(0,0,image.width,image.height);\nvar data=imageData.data;\n\nfor(var i=0;i<data.length;i++){\n\ndata[i]=SRGBToLinear(data[i]/255)*255;\n\n}\n\ncontext.putImageData(imageData,0,0);\n\nreturn canvas;\n\n}else if(image.data){\n\nvar _data=image.data.slice(0);\n\nfor(var _i=0;_i<_data.length;_i++){\n\nif(_data instanceof Uint8Array||_data instanceof Uint8ClampedArray){\n\n_data[_i]=Math.floor(SRGBToLinear(_data[_i]/255)*255);\n\n}else{\n\n// assuming float\n\n_data[_i]=SRGBToLinear(_data[_i]);\n\n}\n\n}\n\nreturn{\ndata:_data,\nwidth:image.width,\nheight:image.height};\n\n\n}else{\n\nconsole.warn('THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied.');\nreturn image;\n\n}\n\n}}]);return ImageUtils;}();var\n\n\n\nSource=function(){\n\nfunction Source(){var data=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;_classCallCheck(this,Source);\n\nthis.isSource=true;\n\nthis.uuid=generateUUID();\n\nthis.data=data;\n\nthis.version=0;\n\n}_createClass(Source,[{key:'toJSON',value:function toJSON(\n\n\n\n\n\n\n\nmeta){\n\nvar isRootObject=meta===undefined||typeof meta==='string';\n\nif(!isRootObject&&meta.images[this.uuid]!==undefined){\n\nreturn meta.images[this.uuid];\n\n}\n\nvar output={\nuuid:this.uuid,\nurl:''};\n\n\nvar data=this.data;\n\nif(data!==null){\n\nvar url=void 0;\n\nif(Array.isArray(data)){\n\n// cube texture\n\nurl=[];\n\nfor(var i=0,l=data.length;i<l;i++){\n\nif(data[i].isDataTexture){\n\nurl.push(serializeImage(data[i].image));\n\n}else{\n\nurl.push(serializeImage(data[i]));\n\n}\n\n}\n\n}else{\n\n// texture\n\nurl=serializeImage(data);\n\n}\n\noutput.url=url;\n\n}\n\nif(!isRootObject){\n\nmeta.images[this.uuid]=output;\n\n}\n\nreturn output;\n\n}},{key:'needsUpdate',set:function set(value){if(value===true)this.version++;}}]);return Source;}();\n\n\n\nfunction serializeImage(image){\n\nif(typeof HTMLImageElement!=='undefined'&&image instanceof HTMLImageElement||\ntypeof HTMLCanvasElement!=='undefined'&&image instanceof HTMLCanvasElement||\ntypeof ImageBitmap!=='undefined'&&image instanceof ImageBitmap){\n\n// default images\n\nreturn ImageUtils.getDataURL(image);\n\n}else{\n\nif(image.data){\n\n// images of DataTexture\n\nreturn{\ndata:Array.from(image.data),\nwidth:image.width,\nheight:image.height,\ntype:image.data.constructor.name};\n\n\n}else{\n\nconsole.warn('THREE.Texture: Unable to serialize Texture.');\nreturn{};\n\n}\n\n}\n\n}\n\nvar textureId=0;var\n\nTexture=function(_EventDispatcher){_inherits(Texture,_EventDispatcher);\n\nfunction Texture(){var image=arguments.length>0&&arguments[0]!==undefined?arguments[0]:Texture.DEFAULT_IMAGE;var mapping=arguments.length>1&&arguments[1]!==undefined?arguments[1]:Texture.DEFAULT_MAPPING;var wrapS=arguments.length>2&&arguments[2]!==undefined?arguments[2]:ClampToEdgeWrapping;var wrapT=arguments.length>3&&arguments[3]!==undefined?arguments[3]:ClampToEdgeWrapping;var magFilter=arguments.length>4&&arguments[4]!==undefined?arguments[4]:LinearFilter;var minFilter=arguments.length>5&&arguments[5]!==undefined?arguments[5]:LinearMipmapLinearFilter;var format=arguments.length>6&&arguments[6]!==undefined?arguments[6]:RGBAFormat;var type=arguments.length>7&&arguments[7]!==undefined?arguments[7]:UnsignedByteType;var anisotropy=arguments.length>8&&arguments[8]!==undefined?arguments[8]:1;var encoding=arguments.length>9&&arguments[9]!==undefined?arguments[9]:LinearEncoding;_classCallCheck(this,Texture);var _this2=_possibleConstructorReturn(this,(Texture.__proto__||Object.getPrototypeOf(Texture)).call(this));\n\n\n\n_this2.isTexture=true;\n\nObject.defineProperty(_this2,'id',{value:textureId++});\n\n_this2.uuid=generateUUID();\n\n_this2.name='';\n\n_this2.source=new Source(image);\n_this2.mipmaps=[];\n\n_this2.mapping=mapping;\n\n_this2.wrapS=wrapS;\n_this2.wrapT=wrapT;\n\n_this2.magFilter=magFilter;\n_this2.minFilter=minFilter;\n\n_this2.anisotropy=anisotropy;\n\n_this2.format=format;\n_this2.internalFormat=null;\n_this2.type=type;\n\n_this2.offset=new Vector2(0,0);\n_this2.repeat=new Vector2(1,1);\n_this2.center=new Vector2(0,0);\n_this2.rotation=0;\n\n_this2.matrixAutoUpdate=true;\n_this2.matrix=new Matrix3();\n\n_this2.generateMipmaps=true;\n_this2.premultiplyAlpha=false;\n_this2.flipY=true;\n_this2.unpackAlignment=4;// valid values: 1, 2, 4, 8 (see http://www.khronos.org/opengles/sdk/docs/man/xhtml/glPixelStorei.xml)\n\n// Values of encoding !== THREE.LinearEncoding only supported on map, envMap and emissiveMap.\n//\n// Also changing the encoding after already used by a Material will not automatically make the Material\n// update. You need to explicitly call Material.needsUpdate to trigger it to recompile.\n_this2.encoding=encoding;\n\n_this2.userData={};\n\n_this2.version=0;\n_this2.onUpdate=null;\n\n_this2.isRenderTargetTexture=false;// indicates whether a texture belongs to a render target or not\n_this2.needsPMREMUpdate=false;// indicates whether this texture should be processed by PMREMGenerator or not (only relevant for render target textures)\nreturn _this2;\n}_createClass(Texture,[{key:'updateMatrix',value:function updateMatrix()\n\n\n\n\n\n\n\n\n\n\n\n\n\n{\n\nthis.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y);\n\n}},{key:'clone',value:function clone()\n\n{\n\nreturn new this.constructor().copy(this);\n\n}},{key:'copy',value:function copy(\n\nsource){\n\nthis.name=source.name;\n\nthis.source=source.source;\nthis.mipmaps=source.mipmaps.slice(0);\n\nthis.mapping=source.mapping;\n\nthis.wrapS=source.wrapS;\nthis.wrapT=source.wrapT;\n\nthis.magFilter=source.magFilter;\nthis.minFilter=source.minFilter;\n\nthis.anisotropy=source.anisotropy;\n\nthis.format=source.format;\nthis.internalFormat=source.internalFormat;\nthis.type=source.type;\n\nthis.offset.copy(source.offset);\nthis.repeat.copy(source.repeat);\nthis.center.copy(source.center);\nthis.rotation=source.rotation;\n\nthis.matrixAutoUpdate=source.matrixAutoUpdate;\nthis.matrix.copy(source.matrix);\n\nthis.generateMipmaps=source.generateMipmaps;\nthis.premultiplyAlpha=source.premultiplyAlpha;\nthis.flipY=source.flipY;\nthis.unpackAlignment=source.unpackAlignment;\nthis.encoding=source.encoding;\n\nthis.userData=JSON.parse(JSON.stringify(source.userData));\n\nthis.needsUpdate=true;\n\nreturn this;\n\n}},{key:'toJSON',value:function toJSON(\n\nmeta){\n\nvar isRootObject=meta===undefined||typeof meta==='string';\n\nif(!isRootObject&&meta.textures[this.uuid]!==undefined){\n\nreturn meta.textures[this.uuid];\n\n}\n\nvar output={\n\nmetadata:{\nversion:4.5,\ntype:'Texture',\ngenerator:'Texture.toJSON'},\n\n\nuuid:this.uuid,\nname:this.name,\n\nimage:this.source.toJSON(meta).uuid,\n\nmapping:this.mapping,\n\nrepeat:[this.repeat.x,this.repeat.y],\noffset:[this.offset.x,this.offset.y],\ncenter:[this.center.x,this.center.y],\nrotation:this.rotation,\n\nwrap:[this.wrapS,this.wrapT],\n\nformat:this.format,\ntype:this.type,\nencoding:this.encoding,\n\nminFilter:this.minFilter,\nmagFilter:this.magFilter,\nanisotropy:this.anisotropy,\n\nflipY:this.flipY,\n\npremultiplyAlpha:this.premultiplyAlpha,\nunpackAlignment:this.unpackAlignment};\n\n\n\nif(JSON.stringify(this.userData)!=='{}')output.userData=this.userData;\n\nif(!isRootObject){\n\nmeta.textures[this.uuid]=output;\n\n}\n\nreturn output;\n\n}},{key:'dispose',value:function dispose()\n\n{\n\nthis.dispatchEvent({type:'dispose'});\n\n}},{key:'transformUv',value:function transformUv(\n\nuv){\n\nif(this.mapping!==UVMapping)return uv;\n\nuv.applyMatrix3(this.matrix);\n\nif(uv.x<0||uv.x>1){\n\nswitch(this.wrapS){\n\ncase RepeatWrapping:\n\nuv.x=uv.x-Math.floor(uv.x);\nbreak;\n\ncase ClampToEdgeWrapping:\n\nuv.x=uv.x<0?0:1;\nbreak;\n\ncase MirroredRepeatWrapping:\n\nif(Math.abs(Math.floor(uv.x)%2)===1){\n\nuv.x=Math.ceil(uv.x)-uv.x;\n\n}else{\n\nuv.x=uv.x-Math.floor(uv.x);\n\n}\n\nbreak;}\n\n\n\n}\n\nif(uv.y<0||uv.y>1){\n\nswitch(this.wrapT){\n\ncase RepeatWrapping:\n\nuv.y=uv.y-Math.floor(uv.y);\nbreak;\n\ncase ClampToEdgeWrapping:\n\nuv.y=uv.y<0?0:1;\nbreak;\n\ncase MirroredRepeatWrapping:\n\nif(Math.abs(Math.floor(uv.y)%2)===1){\n\nuv.y=Math.ceil(uv.y)-uv.y;\n\n}else{\n\nuv.y=uv.y-Math.floor(uv.y);\n\n}\n\nbreak;}\n\n\n\n}\n\nif(this.flipY){\n\nuv.y=1-uv.y;\n\n}\n\nreturn uv;\n\n}},{key:'image',get:function get(){return this.source.data;},set:function set(value){this.source.data=value;}},{key:'needsUpdate',set:function set(\n\nvalue){\n\nif(value===true){\n\nthis.version++;\nthis.source.needsUpdate=true;\n\n}\n\n}}]);return Texture;}(EventDispatcher);\n\n\n\nTexture.DEFAULT_IMAGE=null;\nTexture.DEFAULT_MAPPING=UVMapping;var\n\nVector4=function(){\n\nfunction Vector4(){var x=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;var y=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var z=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var w=arguments.length>3&&arguments[3]!==undefined?arguments[3]:1;_classCallCheck(this,Vector4);\n\nVector4.prototype.isVector4=true;\n\nthis.x=x;\nthis.y=y;\nthis.z=z;\nthis.w=w;\n\n}_createClass(Vector4,[{key:'set',value:function set(\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nx,y,z,w){\n\nthis.x=x;\nthis.y=y;\nthis.z=z;\nthis.w=w;\n\nreturn this;\n\n}},{key:'setScalar',value:function setScalar(\n\nscalar){\n\nthis.x=scalar;\nthis.y=scalar;\nthis.z=scalar;\nthis.w=scalar;\n\nreturn this;\n\n}},{key:'setX',value:function setX(\n\nx){\n\nthis.x=x;\n\nreturn this;\n\n}},{key:'setY',value:function setY(\n\ny){\n\nthis.y=y;\n\nreturn this;\n\n}},{key:'setZ',value:function setZ(\n\nz){\n\nthis.z=z;\n\nreturn this;\n\n}},{key:'setW',value:function setW(\n\nw){\n\nthis.w=w;\n\nreturn this;\n\n}},{key:'setComponent',value:function setComponent(\n\nindex,value){\n\nswitch(index){\n\ncase 0:this.x=value;break;\ncase 1:this.y=value;break;\ncase 2:this.z=value;break;\ncase 3:this.w=value;break;\ndefault:throw new Error('index is out of range: '+index);}\n\n\n\nreturn this;\n\n}},{key:'getComponent',value:function getComponent(\n\nindex){\n\nswitch(index){\n\ncase 0:return this.x;\ncase 1:return this.y;\ncase 2:return this.z;\ncase 3:return this.w;\ndefault:throw new Error('index is out of range: '+index);}\n\n\n\n}},{key:'clone',value:function clone()\n\n{\n\nreturn new this.constructor(this.x,this.y,this.z,this.w);\n\n}},{key:'copy',value:function copy(\n\nv){\n\nthis.x=v.x;\nthis.y=v.y;\nthis.z=v.z;\nthis.w=v.w!==undefined?v.w:1;\n\nreturn this;\n\n}},{key:'add',value:function add(\n\nv,w){\n\nif(w!==undefined){\n\nconsole.warn('THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead.');\nreturn this.addVectors(v,w);\n\n}\n\nthis.x+=v.x;\nthis.y+=v.y;\nthis.z+=v.z;\nthis.w+=v.w;\n\nreturn this;\n\n}},{key:'addScalar',value:function addScalar(\n\ns){\n\nthis.x+=s;\nthis.y+=s;\nthis.z+=s;\nthis.w+=s;\n\nreturn this;\n\n}},{key:'addVectors',value:function addVectors(\n\na,b){\n\nthis.x=a.x+b.x;\nthis.y=a.y+b.y;\nthis.z=a.z+b.z;\nthis.w=a.w+b.w;\n\nreturn this;\n\n}},{key:'addScaledVector',value:function addScaledVector(\n\nv,s){\n\nthis.x+=v.x*s;\nthis.y+=v.y*s;\nthis.z+=v.z*s;\nthis.w+=v.w*s;\n\nreturn this;\n\n}},{key:'sub',value:function sub(\n\nv,w){\n\nif(w!==undefined){\n\nconsole.warn('THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead.');\nreturn this.subVectors(v,w);\n\n}\n\nthis.x-=v.x;\nthis.y-=v.y;\nthis.z-=v.z;\nthis.w-=v.w;\n\nreturn this;\n\n}},{key:'subScalar',value:function subScalar(\n\ns){\n\nthis.x-=s;\nthis.y-=s;\nthis.z-=s;\nthis.w-=s;\n\nreturn this;\n\n}},{key:'subVectors',value:function subVectors(\n\na,b){\n\nthis.x=a.x-b.x;\nthis.y=a.y-b.y;\nthis.z=a.z-b.z;\nthis.w=a.w-b.w;\n\nreturn this;\n\n}},{key:'multiply',value:function multiply(\n\nv){\n\nthis.x*=v.x;\nthis.y*=v.y;\nthis.z*=v.z;\nthis.w*=v.w;\n\nreturn this;\n\n}},{key:'multiplyScalar',value:function multiplyScalar(\n\nscalar){\n\nthis.x*=scalar;\nthis.y*=scalar;\nthis.z*=scalar;\nthis.w*=scalar;\n\nreturn this;\n\n}},{key:'applyMatrix4',value:function applyMatrix4(\n\nm){\n\nvar x=this.x,y=this.y,z=this.z,w=this.w;\nvar e=m.elements;\n\nthis.x=e[0]*x+e[4]*y+e[8]*z+e[12]*w;\nthis.y=e[1]*x+e[5]*y+e[9]*z+e[13]*w;\nthis.z=e[2]*x+e[6]*y+e[10]*z+e[14]*w;\nthis.w=e[3]*x+e[7]*y+e[11]*z+e[15]*w;\n\nreturn this;\n\n}},{key:'divideScalar',value:function divideScalar(\n\nscalar){\n\nreturn this.multiplyScalar(1/scalar);\n\n}},{key:'setAxisAngleFromQuaternion',value:function setAxisAngleFromQuaternion(\n\nq){\n\n// http://www.euclideanspace.com/maths/geometry/rotations/conversions/quaternionToAngle/index.htm\n\n// q is assumed to be normalized\n\nthis.w=2*Math.acos(q.w);\n\nvar s=Math.sqrt(1-q.w*q.w);\n\nif(s<0.0001){\n\nthis.x=1;\nthis.y=0;\nthis.z=0;\n\n}else{\n\nthis.x=q.x/s;\nthis.y=q.y/s;\nthis.z=q.z/s;\n\n}\n\nreturn this;\n\n}},{key:'setAxisAngleFromRotationMatrix',value:function setAxisAngleFromRotationMatrix(\n\nm){\n\n// http://www.euclideanspace.com/maths/geometry/rotations/conversions/matrixToAngle/index.htm\n\n// assumes the upper 3x3 of m is a pure rotation matrix (i.e, unscaled)\n\nvar angle=void 0,x=void 0,y=void 0,z=void 0;// variables for result\nvar epsilon=0.01,// margin to allow for rounding errors\nepsilon2=0.1,// margin to distinguish between 0 and 180 degrees\n\nte=m.elements,\n\nm11=te[0],m12=te[4],m13=te[8],\nm21=te[1],m22=te[5],m23=te[9],\nm31=te[2],m32=te[6],m33=te[10];\n\nif(Math.abs(m12-m21)<epsilon&&\nMath.abs(m13-m31)<epsilon&&\nMath.abs(m23-m32)<epsilon){\n\n// singularity found\n// first check for identity matrix which must have +1 for all terms\n// in leading diagonal and zero in other terms\n\nif(Math.abs(m12+m21)<epsilon2&&\nMath.abs(m13+m31)<epsilon2&&\nMath.abs(m23+m32)<epsilon2&&\nMath.abs(m11+m22+m33-3)<epsilon2){\n\n// this singularity is identity matrix so angle = 0\n\nthis.set(1,0,0,0);\n\nreturn this;// zero angle, arbitrary axis\n\n}\n\n// otherwise this singularity is angle = 180\n\nangle=Math.PI;\n\nvar xx=(m11+1)/2;\nvar yy=(m22+1)/2;\nvar zz=(m33+1)/2;\nvar xy=(m12+m21)/4;\nvar xz=(m13+m31)/4;\nvar yz=(m23+m32)/4;\n\nif(xx>yy&&xx>zz){\n\n// m11 is the largest diagonal term\n\nif(xx<epsilon){\n\nx=0;\ny=0.707106781;\nz=0.707106781;\n\n}else{\n\nx=Math.sqrt(xx);\ny=xy/x;\nz=xz/x;\n\n}\n\n}else if(yy>zz){\n\n// m22 is the largest diagonal term\n\nif(yy<epsilon){\n\nx=0.707106781;\ny=0;\nz=0.707106781;\n\n}else{\n\ny=Math.sqrt(yy);\nx=xy/y;\nz=yz/y;\n\n}\n\n}else{\n\n// m33 is the largest diagonal term so base result on this\n\nif(zz<epsilon){\n\nx=0.707106781;\ny=0.707106781;\nz=0;\n\n}else{\n\nz=Math.sqrt(zz);\nx=xz/z;\ny=yz/z;\n\n}\n\n}\n\nthis.set(x,y,z,angle);\n\nreturn this;// return 180 deg rotation\n\n}\n\n// as we have reached here there are no singularities so we can handle normally\n\nvar s=Math.sqrt((m32-m23)*(m32-m23)+\n(m13-m31)*(m13-m31)+\n(m21-m12)*(m21-m12));// used to normalize\n\nif(Math.abs(s)<0.001)s=1;\n\n// prevent divide by zero, should not happen if matrix is orthogonal and should be\n// caught by singularity test above, but I've left it in just in case\n\nthis.x=(m32-m23)/s;\nthis.y=(m13-m31)/s;\nthis.z=(m21-m12)/s;\nthis.w=Math.acos((m11+m22+m33-1)/2);\n\nreturn this;\n\n}},{key:'min',value:function min(\n\nv){\n\nthis.x=Math.min(this.x,v.x);\nthis.y=Math.min(this.y,v.y);\nthis.z=Math.min(this.z,v.z);\nthis.w=Math.min(this.w,v.w);\n\nreturn this;\n\n}},{key:'max',value:function max(\n\nv){\n\nthis.x=Math.max(this.x,v.x);\nthis.y=Math.max(this.y,v.y);\nthis.z=Math.max(this.z,v.z);\nthis.w=Math.max(this.w,v.w);\n\nreturn this;\n\n}},{key:'clamp',value:function clamp(\n\nmin,max){\n\n// assumes min < max, componentwise\n\nthis.x=Math.max(min.x,Math.min(max.x,this.x));\nthis.y=Math.max(min.y,Math.min(max.y,this.y));\nthis.z=Math.max(min.z,Math.min(max.z,this.z));\nthis.w=Math.max(min.w,Math.min(max.w,this.w));\n\nreturn this;\n\n}},{key:'clampScalar',value:function clampScalar(\n\nminVal,maxVal){\n\nthis.x=Math.max(minVal,Math.min(maxVal,this.x));\nthis.y=Math.max(minVal,Math.min(maxVal,this.y));\nthis.z=Math.max(minVal,Math.min(maxVal,this.z));\nthis.w=Math.max(minVal,Math.min(maxVal,this.w));\n\nreturn this;\n\n}},{key:'clampLength',value:function clampLength(\n\nmin,max){\n\nvar length=this.length();\n\nreturn this.divideScalar(length||1).multiplyScalar(Math.max(min,Math.min(max,length)));\n\n}},{key:'floor',value:function floor()\n\n{\n\nthis.x=Math.floor(this.x);\nthis.y=Math.floor(this.y);\nthis.z=Math.floor(this.z);\nthis.w=Math.floor(this.w);\n\nreturn this;\n\n}},{key:'ceil',value:function ceil()\n\n{\n\nthis.x=Math.ceil(this.x);\nthis.y=Math.ceil(this.y);\nthis.z=Math.ceil(this.z);\nthis.w=Math.ceil(this.w);\n\nreturn this;\n\n}},{key:'round',value:function round()\n\n{\n\nthis.x=Math.round(this.x);\nthis.y=Math.round(this.y);\nthis.z=Math.round(this.z);\nthis.w=Math.round(this.w);\n\nreturn this;\n\n}},{key:'roundToZero',value:function roundToZero()\n\n{\n\nthis.x=this.x<0?Math.ceil(this.x):Math.floor(this.x);\nthis.y=this.y<0?Math.ceil(this.y):Math.floor(this.y);\nthis.z=this.z<0?Math.ceil(this.z):Math.floor(this.z);\nthis.w=this.w<0?Math.ceil(this.w):Math.floor(this.w);\n\nreturn this;\n\n}},{key:'negate',value:function negate()\n\n{\n\nthis.x=-this.x;\nthis.y=-this.y;\nthis.z=-this.z;\nthis.w=-this.w;\n\nreturn this;\n\n}},{key:'dot',value:function dot(\n\nv){\n\nreturn this.x*v.x+this.y*v.y+this.z*v.z+this.w*v.w;\n\n}},{key:'lengthSq',value:function lengthSq()\n\n{\n\nreturn this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w;\n\n}},{key:'length',value:function length()\n\n{\n\nreturn Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);\n\n}},{key:'manhattanLength',value:function manhattanLength()\n\n{\n\nreturn Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w);\n\n}},{key:'normalize',value:function normalize()\n\n{\n\nreturn this.divideScalar(this.length()||1);\n\n}},{key:'setLength',value:function setLength(\n\nlength){\n\nreturn this.normalize().multiplyScalar(length);\n\n}},{key:'lerp',value:function lerp(\n\nv,alpha){\n\nthis.x+=(v.x-this.x)*alpha;\nthis.y+=(v.y-this.y)*alpha;\nthis.z+=(v.z-this.z)*alpha;\nthis.w+=(v.w-this.w)*alpha;\n\nreturn this;\n\n}},{key:'lerpVectors',value:function lerpVectors(\n\nv1,v2,alpha){\n\nthis.x=v1.x+(v2.x-v1.x)*alpha;\nthis.y=v1.y+(v2.y-v1.y)*alpha;\nthis.z=v1.z+(v2.z-v1.z)*alpha;\nthis.w=v1.w+(v2.w-v1.w)*alpha;\n\nreturn this;\n\n}},{key:'equals',value:function equals(\n\nv){\n\nreturn v.x===this.x&&v.y===this.y&&v.z===this.z&&v.w===this.w;\n\n}},{key:'fromArray',value:function fromArray(\n\narray){var offset=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;\n\nthis.x=array[offset];\nthis.y=array[offset+1];\nthis.z=array[offset+2];\nthis.w=array[offset+3];\n\nreturn this;\n\n}},{key:'toArray',value:function toArray()\n\n{var array=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];var offset=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;\n\narray[offset]=this.x;\narray[offset+1]=this.y;\narray[offset+2]=this.z;\narray[offset+3]=this.w;\n\nreturn array;\n\n}},{key:'fromBufferAttribute',value:function fromBufferAttribute(\n\nattribute,index,offset){\n\nif(offset!==undefined){\n\nconsole.warn('THREE.Vector4: offset has been removed from .fromBufferAttribute().');\n\n}\n\nthis.x=attribute.getX(index);\nthis.y=attribute.getY(index);\nthis.z=attribute.getZ(index);\nthis.w=attribute.getW(index);\n\nreturn this;\n\n}},{key:'random',value:function random()\n\n{\n\nthis.x=Math.random();\nthis.y=Math.random();\nthis.z=Math.random();\nthis.w=Math.random();\n\nreturn this;\n\n}},{key:\n\nSymbol.iterator,value:/*#__PURE__*/regeneratorRuntime.mark(function value(){return regeneratorRuntime.wrap(function value$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:_context4.next=2;return(\n\nthis.x);case 2:_context4.next=4;return(\nthis.y);case 4:_context4.next=6;return(\nthis.z);case 6:_context4.next=8;return(\nthis.w);case 8:case'end':return _context4.stop();}}},value,this);})},{key:'width',get:function get(){return this.z;},set:function set(value){this.z=value;}},{key:'height',get:function get(){return this.w;},set:function set(value){this.w=value;}}]);return Vector4;}();\n\n\n\n\n\n/*\n In options, we can specify:\n * Texture parameters for an auto-generated target texture\n * depthBuffer/stencilBuffer: Booleans to indicate if we should generate these buffers\n*/var\nWebGLRenderTarget=function(_EventDispatcher2){_inherits(WebGLRenderTarget,_EventDispatcher2);\n\nfunction WebGLRenderTarget(width,height){var options=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};_classCallCheck(this,WebGLRenderTarget);var _this3=_possibleConstructorReturn(this,(WebGLRenderTarget.__proto__||Object.getPrototypeOf(WebGLRenderTarget)).call(this));\n\n\n\n_this3.isWebGLRenderTarget=true;\n\n_this3.width=width;\n_this3.height=height;\n_this3.depth=1;\n\n_this3.scissor=new Vector4(0,0,width,height);\n_this3.scissorTest=false;\n\n_this3.viewport=new Vector4(0,0,width,height);\n\nvar image={width:width,height:height,depth:1};\n\n_this3.texture=new Texture(image,options.mapping,options.wrapS,options.wrapT,options.magFilter,options.minFilter,options.format,options.type,options.anisotropy,options.encoding);\n_this3.texture.isRenderTargetTexture=true;\n\n_this3.texture.flipY=false;\n_this3.texture.generateMipmaps=options.generateMipmaps!==undefined?options.generateMipmaps:false;\n_this3.texture.internalFormat=options.internalFormat!==undefined?options.internalFormat:null;\n_this3.texture.minFilter=options.minFilter!==undefined?options.minFilter:LinearFilter;\n\n_this3.depthBuffer=options.depthBuffer!==undefined?options.depthBuffer:true;\n_this3.stencilBuffer=options.stencilBuffer!==undefined?options.stencilBuffer:false;\n\n_this3.depthTexture=options.depthTexture!==undefined?options.depthTexture:null;\n\n_this3.samples=options.samples!==undefined?options.samples:0;return _this3;\n\n}_createClass(WebGLRenderTarget,[{key:'setSize',value:function setSize(\n\nwidth,height){var depth=arguments.length>2&&arguments[2]!==undefined?arguments[2]:1;\n\nif(this.width!==width||this.height!==height||this.depth!==depth){\n\nthis.width=width;\nthis.height=height;\nthis.depth=depth;\n\nthis.texture.image.width=width;\nthis.texture.image.height=height;\nthis.texture.image.depth=depth;\n\nthis.dispose();\n\n}\n\nthis.viewport.set(0,0,width,height);\nthis.scissor.set(0,0,width,height);\n\n}},{key:'clone',value:function clone()\n\n{\n\nreturn new this.constructor().copy(this);\n\n}},{key:'copy',value:function copy(\n\nsource){\n\nthis.width=source.width;\nthis.height=source.height;\nthis.depth=source.depth;\n\nthis.viewport.copy(source.viewport);\n\nthis.texture=source.texture.clone();\nthis.texture.isRenderTargetTexture=true;\n\n// ensure image object is not shared, see #20328\n\nvar image=Object.assign({},source.texture.image);\nthis.texture.source=new Source(image);\n\nthis.depthBuffer=source.depthBuffer;\nthis.stencilBuffer=source.stencilBuffer;\n\nif(source.depthTexture!==null)this.depthTexture=source.depthTexture.clone();\n\nthis.samples=source.samples;\n\nreturn this;\n\n}},{key:'dispose',value:function dispose()\n\n{\n\nthis.dispatchEvent({type:'dispose'});\n\n}}]);return WebGLRenderTarget;}(EventDispatcher);var\n\n\n\nDataArrayTexture=function(_Texture){_inherits(DataArrayTexture,_Texture);\n\nfunction DataArrayTexture(){var data=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;var width=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1;var height=arguments.length>2&&arguments[2]!==undefined?arguments[2]:1;var depth=arguments.length>3&&arguments[3]!==undefined?arguments[3]:1;_classCallCheck(this,DataArrayTexture);var _this4=_possibleConstructorReturn(this,(DataArrayTexture.__proto__||Object.getPrototypeOf(DataArrayTexture)).call(this,\n\nnull));\n\n_this4.isDataArrayTexture=true;\n\n_this4.image={data:data,width:width,height:height,depth:depth};\n\n_this4.magFilter=NearestFilter;\n_this4.minFilter=NearestFilter;\n\n_this4.wrapR=ClampToEdgeWrapping;\n\n_this4.generateMipmaps=false;\n_this4.flipY=false;\n_this4.unpackAlignment=1;return _this4;\n\n}return DataArrayTexture;}(Texture);var\n\n\n\nWebGLArrayRenderTarget=function(_WebGLRenderTarget){_inherits(WebGLArrayRenderTarget,_WebGLRenderTarget);\n\nfunction WebGLArrayRenderTarget(width,height,depth){_classCallCheck(this,WebGLArrayRenderTarget);var _this5=_possibleConstructorReturn(this,(WebGLArrayRenderTarget.__proto__||Object.getPrototypeOf(WebGLArrayRenderTarget)).call(this,\n\nwidth,height));\n\n_this5.isWebGLArrayRenderTarget=true;\n\n_this5.depth=depth;\n\n_this5.texture=new DataArrayTexture(null,width,height,depth);\n\n_this5.texture.isRenderTargetTexture=true;return _this5;\n\n}return WebGLArrayRenderTarget;}(WebGLRenderTarget);var\n\n\n\nData3DTexture=function(_Texture2){_inherits(Data3DTexture,_Texture2);\n\nfunction Data3DTexture(){var data=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;var width=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1;var height=arguments.length>2&&arguments[2]!==undefined?arguments[2]:1;var depth=arguments.length>3&&arguments[3]!==undefined?arguments[3]:1;_classCallCheck(this,Data3DTexture);var _this6=_possibleConstructorReturn(this,(Data3DTexture.__proto__||Object.getPrototypeOf(Data3DTexture)).call(this,\n\n\n\n\n\n\n\n\n\nnull));// We're going to add .setXXX() methods for setting properties later.\n// Users can still set in DataTexture3D directly.\n//\n//\tconst texture = new THREE.DataTexture3D( data, width, height, depth );\n// \ttexture.anisotropy = 16;\n//\n// See #14839\n_this6.isData3DTexture=true;_this6.image={data:data,width:width,height:height,depth:depth};_this6.magFilter=NearestFilter;_this6.minFilter=NearestFilter;\n\n_this6.wrapR=ClampToEdgeWrapping;\n\n_this6.generateMipmaps=false;\n_this6.flipY=false;\n_this6.unpackAlignment=1;return _this6;\n\n}return Data3DTexture;}(Texture);var\n\n\n\nWebGL3DRenderTarget=function(_WebGLRenderTarget2){_inherits(WebGL3DRenderTarget,_WebGLRenderTarget2);\n\nfunction WebGL3DRenderTarget(width,height,depth){_classCallCheck(this,WebGL3DRenderTarget);var _this7=_possibleConstructorReturn(this,(WebGL3DRenderTarget.__proto__||Object.getPrototypeOf(WebGL3DRenderTarget)).call(this,\n\nwidth,height));\n\n_this7.isWebGL3DRenderTarget=true;\n\n_this7.depth=depth;\n\n_this7.texture=new Data3DTexture(null,width,height,depth);\n\n_this7.texture.isRenderTargetTexture=true;return _this7;\n\n}return WebGL3DRenderTarget;}(WebGLRenderTarget);var\n\n\n\nWebGLMultipleRenderTargets=function(_WebGLRenderTarget3){_inherits(WebGLMultipleRenderTargets,_WebGLRenderTarget3);\n\nfunction WebGLMultipleRenderTargets(width,height,count){var options=arguments.length>3&&arguments[3]!==undefined?arguments[3]:{};_classCallCheck(this,WebGLMultipleRenderTargets);var _this8=_possibleConstructorReturn(this,(WebGLMultipleRenderTargets.__proto__||Object.getPrototypeOf(WebGLMultipleRenderTargets)).call(this,\n\nwidth,height,options));\n\n_this8.isWebGLMultipleRenderTargets=true;\n\nvar texture=_this8.texture;\n\n_this8.texture=[];\n\nfor(var i=0;i<count;i++){\n\n_this8.texture[i]=texture.clone();\n_this8.texture[i].isRenderTargetTexture=true;\n\n}return _this8;\n\n}_createClass(WebGLMultipleRenderTargets,[{key:'setSize',value:function setSize(\n\nwidth,height){var depth=arguments.length>2&&arguments[2]!==undefined?arguments[2]:1;\n\nif(this.width!==width||this.height!==height||this.depth!==depth){\n\nthis.width=width;\nthis.height=height;\nthis.depth=depth;\n\nfor(var i=0,il=this.texture.length;i<il;i++){\n\nthis.texture[i].image.width=width;\nthis.texture[i].image.height=height;\nthis.texture[i].image.depth=depth;\n\n}\n\nthis.dispose();\n\n}\n\nthis.viewport.set(0,0,width,height);\nthis.scissor.set(0,0,width,height);\n\nreturn this;\n\n}},{key:'copy',value:function copy(\n\nsource){\n\nthis.dispose();\n\nthis.width=source.width;\nthis.height=source.height;\nthis.depth=source.depth;\n\nthis.viewport.set(0,0,this.width,this.height);\nthis.scissor.set(0,0,this.width,this.height);\n\nthis.depthBuffer=source.depthBuffer;\nthis.stencilBuffer=source.stencilBuffer;\n\nif(source.depthTexture!==null)this.depthTexture=source.depthTexture.clone();\n\nthis.texture.length=0;\n\nfor(var i=0,il=source.texture.length;i<il;i++){\n\nthis.texture[i]=source.texture[i].clone();\nthis.texture[i].isRenderTargetTexture=true;\n\n}\n\nreturn this;\n\n}}]);return WebGLMultipleRenderTargets;}(WebGLRenderTarget);var\n\n\n\nQuaternion=function(){\n\nfunction Quaternion(){var x=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;var y=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var z=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var w=arguments.length>3&&arguments[3]!==undefined?arguments[3]:1;_classCallCheck(this,Quaternion);\n\nthis.isQuaternion=true;\n\nthis._x=x;\nthis._y=y;\nthis._z=z;\nthis._w=w;\n\n}_createClass(Quaternion,[{key:'set',value:function set(\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nx,y,z,w){\n\nthis._x=x;\nthis._y=y;\nthis._z=z;\nthis._w=w;\n\nthis._onChangeCallback();\n\nreturn this;\n\n}},{key:'clone',value:function clone()\n\n{\n\nreturn new this.constructor(this._x,this._y,this._z,this._w);\n\n}},{key:'copy',value:function copy(\n\nquaternion){\n\nthis._x=quaternion.x;\nthis._y=quaternion.y;\nthis._z=quaternion.z;\nthis._w=quaternion.w;\n\nthis._onChangeCallback();\n\nreturn this;\n\n}},{key:'setFromEuler',value:function setFromEuler(\n\neuler,update){\n\nif(!(euler&&euler.isEuler)){\n\nthrow new Error('THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.');\n\n}\n\nvar x=euler._x,y=euler._y,z=euler._z,order=euler._order;\n\n// http://www.mathworks.com/matlabcentral/fileexchange/\n// \t20696-function-to-convert-between-dcm-euler-angles-quaternions-and-euler-vectors/\n//\tcontent/SpinCalc.m\n\nvar cos=Math.cos;\nvar sin=Math.sin;\n\nvar c1=cos(x/2);\nvar c2=cos(y/2);\nvar c3=cos(z/2);\n\nvar s1=sin(x/2);\nvar s2=sin(y/2);\nvar s3=sin(z/2);\n\nswitch(order){\n\ncase'XYZ':\nthis._x=s1*c2*c3+c1*s2*s3;\nthis._y=c1*s2*c3-s1*c2*s3;\nthis._z=c1*c2*s3+s1*s2*c3;\nthis._w=c1*c2*c3-s1*s2*s3;\nbreak;\n\ncase'YXZ':\nthis._x=s1*c2*c3+c1*s2*s3;\nthis._y=c1*s2*c3-s1*c2*s3;\nthis._z=c1*c2*s3-s1*s2*c3;\nthis._w=c1*c2*c3+s1*s2*s3;\nbreak;\n\ncase'ZXY':\nthis._x=s1*c2*c3-c1*s2*s3;\nthis._y=c1*s2*c3+s1*c2*s3;\nthis._z=c1*c2*s3+s1*s2*c3;\nthis._w=c1*c2*c3-s1*s2*s3;\nbreak;\n\ncase'ZYX':\nthis._x=s1*c2*c3-c1*s2*s3;\nthis._y=c1*s2*c3+s1*c2*s3;\nthis._z=c1*c2*s3-s1*s2*c3;\nthis._w=c1*c2*c3+s1*s2*s3;\nbreak;\n\ncase'YZX':\nthis._x=s1*c2*c3+c1*s2*s3;\nthis._y=c1*s2*c3+s1*c2*s3;\nthis._z=c1*c2*s3-s1*s2*c3;\nthis._w=c1*c2*c3-s1*s2*s3;\nbreak;\n\ncase'XZY':\nthis._x=s1*c2*c3-c1*s2*s3;\nthis._y=c1*s2*c3-s1*c2*s3;\nthis._z=c1*c2*s3+s1*s2*c3;\nthis._w=c1*c2*c3+s1*s2*s3;\nbreak;\n\ndefault:\nconsole.warn('THREE.Quaternion: .setFromEuler() encountered an unknown order: '+order);}\n\n\n\nif(update!==false)this._onChangeCallback();\n\nreturn this;\n\n}},{key:'setFromAxisAngle',value:function setFromAxisAngle(\n\naxis,angle){\n\n// http://www.euclideanspace.com/maths/geometry/rotations/conversions/angleToQuaternion/index.htm\n\n// assumes axis is normalized\n\nvar halfAngle=angle/2,s=Math.sin(halfAngle);\n\nthis._x=axis.x*s;\nthis._y=axis.y*s;\nthis._z=axis.z*s;\nthis._w=Math.cos(halfAngle);\n\nthis._onChangeCallback();\n\nreturn this;\n\n}},{key:'setFromRotationMatrix',value:function setFromRotationMatrix(\n\nm){\n\n// http://www.euclideanspace.com/maths/geometry/rotations/conversions/matrixToQuaternion/index.htm\n\n// assumes the upper 3x3 of m is a pure rotation matrix (i.e, unscaled)\n\nvar te=m.elements,\n\nm11=te[0],m12=te[4],m13=te[8],\nm21=te[1],m22=te[5],m23=te[9],\nm31=te[2],m32=te[6],m33=te[10],\n\ntrace=m11+m22+m33;\n\nif(trace>0){\n\nvar s=0.5/Math.sqrt(trace+1.0);\n\nthis._w=0.25/s;\nthis._x=(m32-m23)*s;\nthis._y=(m13-m31)*s;\nthis._z=(m21-m12)*s;\n\n}else if(m11>m22&&m11>m33){\n\nvar _s=2.0*Math.sqrt(1.0+m11-m22-m33);\n\nthis._w=(m32-m23)/_s;\nthis._x=0.25*_s;\nthis._y=(m12+m21)/_s;\nthis._z=(m13+m31)/_s;\n\n}else if(m22>m33){\n\nvar _s2=2.0*Math.sqrt(1.0+m22-m11-m33);\n\nthis._w=(m13-m31)/_s2;\nthis._x=(m12+m21)/_s2;\nthis._y=0.25*_s2;\nthis._z=(m23+m32)/_s2;\n\n}else{\n\nvar _s3=2.0*Math.sqrt(1.0+m33-m11-m22);\n\nthis._w=(m21-m12)/_s3;\nthis._x=(m13+m31)/_s3;\nthis._y=(m23+m32)/_s3;\nthis._z=0.25*_s3;\n\n}\n\nthis._onChangeCallback();\n\nreturn this;\n\n}},{key:'setFromUnitVectors',value:function setFromUnitVectors(\n\nvFrom,vTo){\n\n// assumes direction vectors vFrom and vTo are normalized\n\nvar r=vFrom.dot(vTo)+1;\n\nif(r<Number.EPSILON){\n\n// vFrom and vTo point in opposite directions\n\nr=0;\n\nif(Math.abs(vFrom.x)>Math.abs(vFrom.z)){\n\nthis._x=-vFrom.y;\nthis._y=vFrom.x;\nthis._z=0;\nthis._w=r;\n\n}else{\n\nthis._x=0;\nthis._y=-vFrom.z;\nthis._z=vFrom.y;\nthis._w=r;\n\n}\n\n}else{\n\n// crossVectors( vFrom, vTo ); // inlined to avoid cyclic dependency on Vector3\n\nthis._x=vFrom.y*vTo.z-vFrom.z*vTo.y;\nthis._y=vFrom.z*vTo.x-vFrom.x*vTo.z;\nthis._z=vFrom.x*vTo.y-vFrom.y*vTo.x;\nthis._w=r;\n\n}\n\nreturn this.normalize();\n\n}},{key:'angleTo',value:function angleTo(\n\nq){\n\nreturn 2*Math.acos(Math.abs(clamp(this.dot(q),-1,1)));\n\n}},{key:'rotateTowards',value:function rotateTowards(\n\nq,step){\n\nvar angle=this.angleTo(q);\n\nif(angle===0)return this;\n\nvar t=Math.min(1,step/angle);\n\nthis.slerp(q,t);\n\nreturn this;\n\n}},{key:'identity',value:function identity()\n\n{\n\nreturn this.set(0,0,0,1);\n\n}},{key:'invert',value:function invert()\n\n{\n\n// quaternion is assumed to have unit length\n\nreturn this.conjugate();\n\n}},{key:'conjugate',value:function conjugate()\n\n{\n\nthis._x*=-1;\nthis._y*=-1;\nthis._z*=-1;\n\nthis._onChangeCallback();\n\nreturn this;\n\n}},{key:'dot',value:function dot(\n\nv){\n\nreturn this._x*v._x+this._y*v._y+this._z*v._z+this._w*v._w;\n\n}},{key:'lengthSq',value:function lengthSq()\n\n{\n\nreturn this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w;\n\n}},{key:'length',value:function length()\n\n{\n\nreturn Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w);\n\n}},{key:'normalize',value:function normalize()\n\n{\n\nvar l=this.length();\n\nif(l===0){\n\nthis._x=0;\nthis._y=0;\nthis._z=0;\nthis._w=1;\n\n}else{\n\nl=1/l;\n\nthis._x=this._x*l;\nthis._y=this._y*l;\nthis._z=this._z*l;\nthis._w=this._w*l;\n\n}\n\nthis._onChangeCallback();\n\nreturn this;\n\n}},{key:'multiply',value:function multiply(\n\nq,p){\n\nif(p!==undefined){\n\nconsole.warn('THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead.');\nreturn this.multiplyQuaternions(q,p);\n\n}\n\nreturn this.multiplyQuaternions(this,q);\n\n}},{key:'premultiply',value:function premultiply(\n\nq){\n\nreturn this.multiplyQuaternions(q,this);\n\n}},{key:'multiplyQuaternions',value:function multiplyQuaternions(\n\na,b){\n\n// from http://www.euclideanspace.com/maths/algebra/realNormedAlgebra/quaternions/code/index.htm\n\nvar qax=a._x,qay=a._y,qaz=a._z,qaw=a._w;\nvar qbx=b._x,qby=b._y,qbz=b._z,qbw=b._w;\n\nthis._x=qax*qbw+qaw*qbx+qay*qbz-qaz*qby;\nthis._y=qay*qbw+qaw*qby+qaz*qbx-qax*qbz;\nthis._z=qaz*qbw+qaw*qbz+qax*qby-qay*qbx;\nthis._w=qaw*qbw-qax*qbx-qay*qby-qaz*qbz;\n\nthis._onChangeCallback();\n\nreturn this;\n\n}},{key:'slerp',value:function slerp(\n\nqb,t){\n\nif(t===0)return this;\nif(t===1)return this.copy(qb);\n\nvar x=this._x,y=this._y,z=this._z,w=this._w;\n\n// http://www.euclideanspace.com/maths/algebra/realNormedAlgebra/quaternions/slerp/\n\nvar cosHalfTheta=w*qb._w+x*qb._x+y*qb._y+z*qb._z;\n\nif(cosHalfTheta<0){\n\nthis._w=-qb._w;\nthis._x=-qb._x;\nthis._y=-qb._y;\nthis._z=-qb._z;\n\ncosHalfTheta=-cosHalfTheta;\n\n}else{\n\nthis.copy(qb);\n\n}\n\nif(cosHalfTheta>=1.0){\n\nthis._w=w;\nthis._x=x;\nthis._y=y;\nthis._z=z;\n\nreturn this;\n\n}\n\nvar sqrSinHalfTheta=1.0-cosHalfTheta*cosHalfTheta;\n\nif(sqrSinHalfTheta<=Number.EPSILON){\n\nvar s=1-t;\nthis._w=s*w+t*this._w;\nthis._x=s*x+t*this._x;\nthis._y=s*y+t*this._y;\nthis._z=s*z+t*this._z;\n\nthis.normalize();\nthis._onChangeCallback();\n\nreturn this;\n\n}\n\nvar sinHalfTheta=Math.sqrt(sqrSinHalfTheta);\nvar halfTheta=Math.atan2(sinHalfTheta,cosHalfTheta);\nvar ratioA=Math.sin((1-t)*halfTheta)/sinHalfTheta,\nratioB=Math.sin(t*halfTheta)/sinHalfTheta;\n\nthis._w=w*ratioA+this._w*ratioB;\nthis._x=x*ratioA+this._x*ratioB;\nthis._y=y*ratioA+this._y*ratioB;\nthis._z=z*ratioA+this._z*ratioB;\n\nthis._onChangeCallback();\n\nreturn this;\n\n}},{key:'slerpQuaternions',value:function slerpQuaternions(\n\nqa,qb,t){\n\nreturn this.copy(qa).slerp(qb,t);\n\n}},{key:'random',value:function random()\n\n{\n\n// Derived from http://planning.cs.uiuc.edu/node198.html\n// Note, this source uses w, x, y, z ordering,\n// so we swap the order below.\n\nvar u1=Math.random();\nvar sqrt1u1=Math.sqrt(1-u1);\nvar sqrtu1=Math.sqrt(u1);\n\nvar u2=2*Math.PI*Math.random();\n\nvar u3=2*Math.PI*Math.random();\n\nreturn this.set(\nsqrt1u1*Math.cos(u2),\nsqrtu1*Math.sin(u3),\nsqrtu1*Math.cos(u3),\nsqrt1u1*Math.sin(u2));\n\n\n}},{key:'equals',value:function equals(\n\nquaternion){\n\nreturn quaternion._x===this._x&&quaternion._y===this._y&&quaternion._z===this._z&&quaternion._w===this._w;\n\n}},{key:'fromArray',value:function fromArray(\n\narray){var offset=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;\n\nthis._x=array[offset];\nthis._y=array[offset+1];\nthis._z=array[offset+2];\nthis._w=array[offset+3];\n\nthis._onChangeCallback();\n\nreturn this;\n\n}},{key:'toArray',value:function toArray()\n\n{var array=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];var offset=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;\n\narray[offset]=this._x;\narray[offset+1]=this._y;\narray[offset+2]=this._z;\narray[offset+3]=this._w;\n\nreturn array;\n\n}},{key:'fromBufferAttribute',value:function fromBufferAttribute(\n\nattribute,index){\n\nthis._x=attribute.getX(index);\nthis._y=attribute.getY(index);\nthis._z=attribute.getZ(index);\nthis._w=attribute.getW(index);\n\nreturn this;\n\n}},{key:'_onChange',value:function _onChange(\n\ncallback){\n\nthis._onChangeCallback=callback;\n\nreturn this;\n\n}},{key:'_onChangeCallback',value:function _onChangeCallback()\n\n{}},{key:\n\nSymbol.iterator,value:/*#__PURE__*/regeneratorRuntime.mark(function value(){return regeneratorRuntime.wrap(function value$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:_context5.next=2;return(\n\nthis._x);case 2:_context5.next=4;return(\nthis._y);case 4:_context5.next=6;return(\nthis._z);case 6:_context5.next=8;return(\nthis._w);case 8:case'end':return _context5.stop();}}},value,this);})},{key:'x',get:function get(){return this._x;},set:function set(value){this._x=value;this._onChangeCallback();}},{key:'y',get:function get(){return this._y;},set:function set(value){this._y=value;this._onChangeCallback();}},{key:'z',get:function get(){return this._z;},set:function set(value){this._z=value;this._onChangeCallback();}},{key:'w',get:function get(){return this._w;},set:function set(value){this._w=value;this._onChangeCallback();}}],[{key:'slerp',value:function slerp(qa,qb,qm,t){console.warn('THREE.Quaternion: Static .slerp() has been deprecated. Use qm.slerpQuaternions( qa, qb, t ) instead.');return qm.slerpQuaternions(qa,qb,t);}},{key:'slerpFlat',value:function slerpFlat(dst,dstOffset,src0,srcOffset0,src1,srcOffset1,t){// fuzz-free, array-based Quaternion SLERP operation\nvar x0=src0[srcOffset0+0],y0=src0[srcOffset0+1],z0=src0[srcOffset0+2],w0=src0[srcOffset0+3];var x1=src1[srcOffset1+0],y1=src1[srcOffset1+1],z1=src1[srcOffset1+2],w1=src1[srcOffset1+3];if(t===0){dst[dstOffset+0]=x0;dst[dstOffset+1]=y0;dst[dstOffset+2]=z0;dst[dstOffset+3]=w0;return;}if(t===1){dst[dstOffset+0]=x1;dst[dstOffset+1]=y1;dst[dstOffset+2]=z1;dst[dstOffset+3]=w1;return;}if(w0!==w1||x0!==x1||y0!==y1||z0!==z1){var s=1-t;var cos=x0*x1+y0*y1+z0*z1+w0*w1,dir=cos>=0?1:-1,sqrSin=1-cos*cos;// Skip the Slerp for tiny steps to avoid numeric problems:\nif(sqrSin>Number.EPSILON){var sin=Math.sqrt(sqrSin),len=Math.atan2(sin,cos*dir);s=Math.sin(s*len)/sin;t=Math.sin(t*len)/sin;}var tDir=t*dir;x0=x0*s+x1*tDir;y0=y0*s+y1*tDir;z0=z0*s+z1*tDir;w0=w0*s+w1*tDir;// Normalize in case we just did a lerp:\nif(s===1-t){var f=1/Math.sqrt(x0*x0+y0*y0+z0*z0+w0*w0);x0*=f;y0*=f;z0*=f;w0*=f;}}dst[dstOffset]=x0;dst[dstOffset+1]=y0;dst[dstOffset+2]=z0;dst[dstOffset+3]=w0;}},{key:'multiplyQuaternionsFlat',value:function multiplyQuaternionsFlat(dst,dstOffset,src0,srcOffset0,src1,srcOffset1){var x0=src0[srcOffset0];var y0=src0[srcOffset0+1];var z0=src0[srcOffset0+2];var w0=src0[srcOffset0+3];var x1=src1[srcOffset1];var y1=src1[srcOffset1+1];var z1=src1[srcOffset1+2];var w1=src1[srcOffset1+3];dst[dstOffset]=x0*w1+w0*x1+y0*z1-z0*y1;dst[dstOffset+1]=y0*w1+w0*y1+z0*x1-x0*z1;dst[dstOffset+2]=z0*w1+w0*z1+x0*y1-y0*x1;dst[dstOffset+3]=w0*w1-x0*x1-y0*y1-z0*z1;return dst;}}]);return Quaternion;}();var\n\n\nVector3=function(){\n\nfunction Vector3(){var x=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;var y=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var z=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;_classCallCheck(this,Vector3);\n\nVector3.prototype.isVector3=true;\n\nthis.x=x;\nthis.y=y;\nthis.z=z;\n\n}_createClass(Vector3,[{key:'set',value:function set(\n\nx,y,z){\n\nif(z===undefined)z=this.z;// sprite.scale.set(x,y)\n\nthis.x=x;\nthis.y=y;\nthis.z=z;\n\nreturn this;\n\n}},{key:'setScalar',value:function setScalar(\n\nscalar){\n\nthis.x=scalar;\nthis.y=scalar;\nthis.z=scalar;\n\nreturn this;\n\n}},{key:'setX',value:function setX(\n\nx){\n\nthis.x=x;\n\nreturn this;\n\n}},{key:'setY',value:function setY(\n\ny){\n\nthis.y=y;\n\nreturn this;\n\n}},{key:'setZ',value:function setZ(\n\nz){\n\nthis.z=z;\n\nreturn this;\n\n}},{key:'setComponent',value:function setComponent(\n\nindex,value){\n\nswitch(index){\n\ncase 0:this.x=value;break;\ncase 1:this.y=value;break;\ncase 2:this.z=value;break;\ndefault:throw new Error('index is out of range: '+index);}\n\n\n\nreturn this;\n\n}},{key:'getComponent',value:function getComponent(\n\nindex){\n\nswitch(index){\n\ncase 0:return this.x;\ncase 1:return this.y;\ncase 2:return this.z;\ndefault:throw new Error('index is out of range: '+index);}\n\n\n\n}},{key:'clone',value:function clone()\n\n{\n\nreturn new this.constructor(this.x,this.y,this.z);\n\n}},{key:'copy',value:function copy(\n\nv){\n\nthis.x=v.x;\nthis.y=v.y;\nthis.z=v.z;\n\nreturn this;\n\n}},{key:'add',value:function add(\n\nv,w){\n\nif(w!==undefined){\n\nconsole.warn('THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead.');\nreturn this.addVectors(v,w);\n\n}\n\nthis.x+=v.x;\nthis.y+=v.y;\nthis.z+=v.z;\n\nreturn this;\n\n}},{key:'addScalar',value:function addScalar(\n\ns){\n\nthis.x+=s;\nthis.y+=s;\nthis.z+=s;\n\nreturn this;\n\n}},{key:'addVectors',value:function addVectors(\n\na,b){\n\nthis.x=a.x+b.x;\nthis.y=a.y+b.y;\nthis.z=a.z+b.z;\n\nreturn this;\n\n}},{key:'addScaledVector',value:function addScaledVector(\n\nv,s){\n\nthis.x+=v.x*s;\nthis.y+=v.y*s;\nthis.z+=v.z*s;\n\nreturn this;\n\n}},{key:'sub',value:function sub(\n\nv,w){\n\nif(w!==undefined){\n\nconsole.warn('THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead.');\nreturn this.subVectors(v,w);\n\n}\n\nthis.x-=v.x;\nthis.y-=v.y;\nthis.z-=v.z;\n\nreturn this;\n\n}},{key:'subScalar',value:function subScalar(\n\ns){\n\nthis.x-=s;\nthis.y-=s;\nthis.z-=s;\n\nreturn this;\n\n}},{key:'subVectors',value:function subVectors(\n\na,b){\n\nthis.x=a.x-b.x;\nthis.y=a.y-b.y;\nthis.z=a.z-b.z;\n\nreturn this;\n\n}},{key:'multiply',value:function multiply(\n\nv,w){\n\nif(w!==undefined){\n\nconsole.warn('THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead.');\nreturn this.multiplyVectors(v,w);\n\n}\n\nthis.x*=v.x;\nthis.y*=v.y;\nthis.z*=v.z;\n\nreturn this;\n\n}},{key:'multiplyScalar',value:function multiplyScalar(\n\nscalar){\n\nthis.x*=scalar;\nthis.y*=scalar;\nthis.z*=scalar;\n\nreturn this;\n\n}},{key:'multiplyVectors',value:function multiplyVectors(\n\na,b){\n\nthis.x=a.x*b.x;\nthis.y=a.y*b.y;\nthis.z=a.z*b.z;\n\nreturn this;\n\n}},{key:'applyEuler',value:function applyEuler(\n\neuler){\n\nif(!(euler&&euler.isEuler)){\n\nconsole.error('THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order.');\n\n}\n\nreturn this.applyQuaternion(_quaternion$4.setFromEuler(euler));\n\n}},{key:'applyAxisAngle',value:function applyAxisAngle(\n\naxis,angle){\n\nreturn this.applyQuaternion(_quaternion$4.setFromAxisAngle(axis,angle));\n\n}},{key:'applyMatrix3',value:function applyMatrix3(\n\nm){\n\nvar x=this.x,y=this.y,z=this.z;\nvar e=m.elements;\n\nthis.x=e[0]*x+e[3]*y+e[6]*z;\nthis.y=e[1]*x+e[4]*y+e[7]*z;\nthis.z=e[2]*x+e[5]*y+e[8]*z;\n\nreturn this;\n\n}},{key:'applyNormalMatrix',value:function applyNormalMatrix(\n\nm){\n\nreturn this.applyMatrix3(m).normalize();\n\n}},{key:'applyMatrix4',value:function applyMatrix4(\n\nm){\n\nvar x=this.x,y=this.y,z=this.z;\nvar e=m.elements;\n\nvar w=1/(e[3]*x+e[7]*y+e[11]*z+e[15]);\n\nthis.x=(e[0]*x+e[4]*y+e[8]*z+e[12])*w;\nthis.y=(e[1]*x+e[5]*y+e[9]*z+e[13])*w;\nthis.z=(e[2]*x+e[6]*y+e[10]*z+e[14])*w;\n\nreturn this;\n\n}},{key:'applyQuaternion',value:function applyQuaternion(\n\nq){\n\nvar x=this.x,y=this.y,z=this.z;\nvar qx=q.x,qy=q.y,qz=q.z,qw=q.w;\n\n// calculate quat * vector\n\nvar ix=qw*x+qy*z-qz*y;\nvar iy=qw*y+qz*x-qx*z;\nvar iz=qw*z+qx*y-qy*x;\nvar iw=-qx*x-qy*y-qz*z;\n\n// calculate result * inverse quat\n\nthis.x=ix*qw+iw*-qx+iy*-qz-iz*-qy;\nthis.y=iy*qw+iw*-qy+iz*-qx-ix*-qz;\nthis.z=iz*qw+iw*-qz+ix*-qy-iy*-qx;\n\nreturn this;\n\n}},{key:'project',value:function project(\n\ncamera){\n\nreturn this.applyMatrix4(camera.matrixWorldInverse).applyMatrix4(camera.projectionMatrix);\n\n}},{key:'unproject',value:function unproject(\n\ncamera){\n\nreturn this.applyMatrix4(camera.projectionMatrixInverse).applyMatrix4(camera.matrixWorld);\n\n}},{key:'transformDirection',value:function transformDirection(\n\nm){\n\n// input: THREE.Matrix4 affine matrix\n// vector interpreted as a direction\n\nvar x=this.x,y=this.y,z=this.z;\nvar e=m.elements;\n\nthis.x=e[0]*x+e[4]*y+e[8]*z;\nthis.y=e[1]*x+e[5]*y+e[9]*z;\nthis.z=e[2]*x+e[6]*y+e[10]*z;\n\nreturn this.normalize();\n\n}},{key:'divide',value:function divide(\n\nv){\n\nthis.x/=v.x;\nthis.y/=v.y;\nthis.z/=v.z;\n\nreturn this;\n\n}},{key:'divideScalar',value:function divideScalar(\n\nscalar){\n\nreturn this.multiplyScalar(1/scalar);\n\n}},{key:'min',value:function min(\n\nv){\n\nthis.x=Math.min(this.x,v.x);\nthis.y=Math.min(this.y,v.y);\nthis.z=Math.min(this.z,v.z);\n\nreturn this;\n\n}},{key:'max',value:function max(\n\nv){\n\nthis.x=Math.max(this.x,v.x);\nthis.y=Math.max(this.y,v.y);\nthis.z=Math.max(this.z,v.z);\n\nreturn this;\n\n}},{key:'clamp',value:function clamp(\n\nmin,max){\n\n// assumes min < max, componentwise\n\nthis.x=Math.max(min.x,Math.min(max.x,this.x));\nthis.y=Math.max(min.y,Math.min(max.y,this.y));\nthis.z=Math.max(min.z,Math.min(max.z,this.z));\n\nreturn this;\n\n}},{key:'clampScalar',value:function clampScalar(\n\nminVal,maxVal){\n\nthis.x=Math.max(minVal,Math.min(maxVal,this.x));\nthis.y=Math.max(minVal,Math.min(maxVal,this.y));\nthis.z=Math.max(minVal,Math.min(maxVal,this.z));\n\nreturn this;\n\n}},{key:'clampLength',value:function clampLength(\n\nmin,max){\n\nvar length=this.length();\n\nreturn this.divideScalar(length||1).multiplyScalar(Math.max(min,Math.min(max,length)));\n\n}},{key:'floor',value:function floor()\n\n{\n\nthis.x=Math.floor(this.x);\nthis.y=Math.floor(this.y);\nthis.z=Math.floor(this.z);\n\nreturn this;\n\n}},{key:'ceil',value:function ceil()\n\n{\n\nthis.x=Math.ceil(this.x);\nthis.y=Math.ceil(this.y);\nthis.z=Math.ceil(this.z);\n\nreturn this;\n\n}},{key:'round',value:function round()\n\n{\n\nthis.x=Math.round(this.x);\nthis.y=Math.round(this.y);\nthis.z=Math.round(this.z);\n\nreturn this;\n\n}},{key:'roundToZero',value:function roundToZero()\n\n{\n\nthis.x=this.x<0?Math.ceil(this.x):Math.floor(this.x);\nthis.y=this.y<0?Math.ceil(this.y):Math.floor(this.y);\nthis.z=this.z<0?Math.ceil(this.z):Math.floor(this.z);\n\nreturn this;\n\n}},{key:'negate',value:function negate()\n\n{\n\nthis.x=-this.x;\nthis.y=-this.y;\nthis.z=-this.z;\n\nreturn this;\n\n}},{key:'dot',value:function dot(\n\nv){\n\nreturn this.x*v.x+this.y*v.y+this.z*v.z;\n\n}\n\n// TODO lengthSquared?\n},{key:'lengthSq',value:function lengthSq()\n{\n\nreturn this.x*this.x+this.y*this.y+this.z*this.z;\n\n}},{key:'length',value:function length()\n\n{\n\nreturn Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z);\n\n}},{key:'manhattanLength',value:function manhattanLength()\n\n{\n\nreturn Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z);\n\n}},{key:'normalize',value:function normalize()\n\n{\n\nreturn this.divideScalar(this.length()||1);\n\n}},{key:'setLength',value:function setLength(\n\nlength){\n\nreturn this.normalize().multiplyScalar(length);\n\n}},{key:'lerp',value:function lerp(\n\nv,alpha){\n\nthis.x+=(v.x-this.x)*alpha;\nthis.y+=(v.y-this.y)*alpha;\nthis.z+=(v.z-this.z)*alpha;\n\nreturn this;\n\n}},{key:'lerpVectors',value:function lerpVectors(\n\nv1,v2,alpha){\n\nthis.x=v1.x+(v2.x-v1.x)*alpha;\nthis.y=v1.y+(v2.y-v1.y)*alpha;\nthis.z=v1.z+(v2.z-v1.z)*alpha;\n\nreturn this;\n\n}},{key:'cross',value:function cross(\n\nv,w){\n\nif(w!==undefined){\n\nconsole.warn('THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead.');\nreturn this.crossVectors(v,w);\n\n}\n\nreturn this.crossVectors(this,v);\n\n}},{key:'crossVectors',value:function crossVectors(\n\na,b){\n\nvar ax=a.x,ay=a.y,az=a.z;\nvar bx=b.x,by=b.y,bz=b.z;\n\nthis.x=ay*bz-az*by;\nthis.y=az*bx-ax*bz;\nthis.z=ax*by-ay*bx;\n\nreturn this;\n\n}},{key:'projectOnVector',value:function projectOnVector(\n\nv){\n\nvar denominator=v.lengthSq();\n\nif(denominator===0)return this.set(0,0,0);\n\nvar scalar=v.dot(this)/denominator;\n\nreturn this.copy(v).multiplyScalar(scalar);\n\n}},{key:'projectOnPlane',value:function projectOnPlane(\n\nplaneNormal){\n\n_vector$c.copy(this).projectOnVector(planeNormal);\n\nreturn this.sub(_vector$c);\n\n}},{key:'reflect',value:function reflect(\n\nnormal){\n\n// reflect incident vector off plane orthogonal to normal\n// normal is assumed to have unit length\n\nreturn this.sub(_vector$c.copy(normal).multiplyScalar(2*this.dot(normal)));\n\n}},{key:'angleTo',value:function angleTo(\n\nv){\n\nvar denominator=Math.sqrt(this.lengthSq()*v.lengthSq());\n\nif(denominator===0)return Math.PI/2;\n\nvar theta=this.dot(v)/denominator;\n\n// clamp, to handle numerical problems\n\nreturn Math.acos(clamp(theta,-1,1));\n\n}},{key:'distanceTo',value:function distanceTo(\n\nv){\n\nreturn Math.sqrt(this.distanceToSquared(v));\n\n}},{key:'distanceToSquared',value:function distanceToSquared(\n\nv){\n\nvar dx=this.x-v.x,dy=this.y-v.y,dz=this.z-v.z;\n\nreturn dx*dx+dy*dy+dz*dz;\n\n}},{key:'manhattanDistanceTo',value:function manhattanDistanceTo(\n\nv){\n\nreturn Math.abs(this.x-v.x)+Math.abs(this.y-v.y)+Math.abs(this.z-v.z);\n\n}},{key:'setFromSpherical',value:function setFromSpherical(\n\ns){\n\nreturn this.setFromSphericalCoords(s.radius,s.phi,s.theta);\n\n}},{key:'setFromSphericalCoords',value:function setFromSphericalCoords(\n\nradius,phi,theta){\n\nvar sinPhiRadius=Math.sin(phi)*radius;\n\nthis.x=sinPhiRadius*Math.sin(theta);\nthis.y=Math.cos(phi)*radius;\nthis.z=sinPhiRadius*Math.cos(theta);\n\nreturn this;\n\n}},{key:'setFromCylindrical',value:function setFromCylindrical(\n\nc){\n\nreturn this.setFromCylindricalCoords(c.radius,c.theta,c.y);\n\n}},{key:'setFromCylindricalCoords',value:function setFromCylindricalCoords(\n\nradius,theta,y){\n\nthis.x=radius*Math.sin(theta);\nthis.y=y;\nthis.z=radius*Math.cos(theta);\n\nreturn this;\n\n}},{key:'setFromMatrixPosition',value:function setFromMatrixPosition(\n\nm){\n\nvar e=m.elements;\n\nthis.x=e[12];\nthis.y=e[13];\nthis.z=e[14];\n\nreturn this;\n\n}},{key:'setFromMatrixScale',value:function setFromMatrixScale(\n\nm){\n\nvar sx=this.setFromMatrixColumn(m,0).length();\nvar sy=this.setFromMatrixColumn(m,1).length();\nvar sz=this.setFromMatrixColumn(m,2).length();\n\nthis.x=sx;\nthis.y=sy;\nthis.z=sz;\n\nreturn this;\n\n}},{key:'setFromMatrixColumn',value:function setFromMatrixColumn(\n\nm,index){\n\nreturn this.fromArray(m.elements,index*4);\n\n}},{key:'setFromMatrix3Column',value:function setFromMatrix3Column(\n\nm,index){\n\nreturn this.fromArray(m.elements,index*3);\n\n}},{key:'setFromEuler',value:function setFromEuler(\n\ne){\n\nthis.x=e._x;\nthis.y=e._y;\nthis.z=e._z;\n\nreturn this;\n\n}},{key:'equals',value:function equals(\n\nv){\n\nreturn v.x===this.x&&v.y===this.y&&v.z===this.z;\n\n}},{key:'fromArray',value:function fromArray(\n\narray){var offset=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;\n\nthis.x=array[offset];\nthis.y=array[offset+1];\nthis.z=array[offset+2];\n\nreturn this;\n\n}},{key:'toArray',value:function toArray()\n\n{var array=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];var offset=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;\n\narray[offset]=this.x;\narray[offset+1]=this.y;\narray[offset+2]=this.z;\n\nreturn array;\n\n}},{key:'fromBufferAttribute',value:function fromBufferAttribute(\n\nattribute,index,offset){\n\nif(offset!==undefined){\n\nconsole.warn('THREE.Vector3: offset has been removed from .fromBufferAttribute().');\n\n}\n\nthis.x=attribute.getX(index);\nthis.y=attribute.getY(index);\nthis.z=attribute.getZ(index);\n\nreturn this;\n\n}},{key:'random',value:function random()\n\n{\n\nthis.x=Math.random();\nthis.y=Math.random();\nthis.z=Math.random();\n\nreturn this;\n\n}},{key:'randomDirection',value:function randomDirection()\n\n{\n\n// Derived from https://mathworld.wolfram.com/SpherePointPicking.html\n\nvar u=(Math.random()-0.5)*2;\nvar t=Math.random()*Math.PI*2;\nvar f=Math.sqrt(1-u**2);\n\nthis.x=f*Math.cos(t);\nthis.y=f*Math.sin(t);\nthis.z=u;\n\nreturn this;\n\n}},{key:\n\nSymbol.iterator,value:/*#__PURE__*/regeneratorRuntime.mark(function value(){return regeneratorRuntime.wrap(function value$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:_context6.next=2;return(\n\nthis.x);case 2:_context6.next=4;return(\nthis.y);case 4:_context6.next=6;return(\nthis.z);case 6:case'end':return _context6.stop();}}},value,this);})}]);return Vector3;}();\n\n\n\n\n\nvar _vector$c=/*@__PURE__*/new Vector3();\nvar _quaternion$4=/*@__PURE__*/new Quaternion();var\n\nBox3=function(){\n\nfunction Box3(){var min=arguments.length>0&&arguments[0]!==undefined?arguments[0]:new Vector3(+Infinity,+Infinity,+Infinity);var max=arguments.length>1&&arguments[1]!==undefined?arguments[1]:new Vector3(-Infinity,-Infinity,-Infinity);_classCallCheck(this,Box3);\n\nthis.isBox3=true;\n\nthis.min=min;\nthis.max=max;\n\n}_createClass(Box3,[{key:'set',value:function set(\n\nmin,max){\n\nthis.min.copy(min);\nthis.max.copy(max);\n\nreturn this;\n\n}},{key:'setFromArray',value:function setFromArray(\n\narray){\n\nvar minX=+Infinity;\nvar minY=+Infinity;\nvar minZ=+Infinity;\n\nvar maxX=-Infinity;\nvar maxY=-Infinity;\nvar maxZ=-Infinity;\n\nfor(var i=0,l=array.length;i<l;i+=3){\n\nvar x=array[i];\nvar y=array[i+1];\nvar z=array[i+2];\n\nif(x<minX)minX=x;\nif(y<minY)minY=y;\nif(z<minZ)minZ=z;\n\nif(x>maxX)maxX=x;\nif(y>maxY)maxY=y;\nif(z>maxZ)maxZ=z;\n\n}\n\nthis.min.set(minX,minY,minZ);\nthis.max.set(maxX,maxY,maxZ);\n\nreturn this;\n\n}},{key:'setFromBufferAttribute',value:function setFromBufferAttribute(\n\nattribute){\n\nvar minX=+Infinity;\nvar minY=+Infinity;\nvar minZ=+Infinity;\n\nvar maxX=-Infinity;\nvar maxY=-Infinity;\nvar maxZ=-Infinity;\n\nfor(var i=0,l=attribute.count;i<l;i++){\n\nvar x=attribute.getX(i);\nvar y=attribute.getY(i);\nvar z=attribute.getZ(i);\n\nif(x<minX)minX=x;\nif(y<minY)minY=y;\nif(z<minZ)minZ=z;\n\nif(x>maxX)maxX=x;\nif(y>maxY)maxY=y;\nif(z>maxZ)maxZ=z;\n\n}\n\nthis.min.set(minX,minY,minZ);\nthis.max.set(maxX,maxY,maxZ);\n\nreturn this;\n\n}},{key:'setFromPoints',value:function setFromPoints(\n\npoints){\n\nthis.makeEmpty();\n\nfor(var i=0,il=points.length;i<il;i++){\n\nthis.expandByPoint(points[i]);\n\n}\n\nreturn this;\n\n}},{key:'setFromCenterAndSize',value:function setFromCenterAndSize(\n\ncenter,size){\n\nvar halfSize=_vector$b.copy(size).multiplyScalar(0.5);\n\nthis.min.copy(center).sub(halfSize);\nthis.max.copy(center).add(halfSize);\n\nreturn this;\n\n}},{key:'setFromObject',value:function setFromObject(\n\nobject){var precise=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;\n\nthis.makeEmpty();\n\nreturn this.expandByObject(object,precise);\n\n}},{key:'clone',value:function clone()\n\n{\n\nreturn new this.constructor().copy(this);\n\n}},{key:'copy',value:function copy(\n\nbox){\n\nthis.min.copy(box.min);\nthis.max.copy(box.max);\n\nreturn this;\n\n}},{key:'makeEmpty',value:function makeEmpty()\n\n{\n\nthis.min.x=this.min.y=this.min.z=+Infinity;\nthis.max.x=this.max.y=this.max.z=-Infinity;\n\nreturn this;\n\n}},{key:'isEmpty',value:function isEmpty()\n\n{\n\n// this is a more robust check for empty than ( volume <= 0 ) because volume can get positive with two negative axes\n\nreturn this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z;\n\n}},{key:'getCenter',value:function getCenter(\n\ntarget){\n\nreturn this.isEmpty()?target.set(0,0,0):target.addVectors(this.min,this.max).multiplyScalar(0.5);\n\n}},{key:'getSize',value:function getSize(\n\ntarget){\n\nreturn this.isEmpty()?target.set(0,0,0):target.subVectors(this.max,this.min);\n\n}},{key:'expandByPoint',value:function expandByPoint(\n\npoint){\n\nthis.min.min(point);\nthis.max.max(point);\n\nreturn this;\n\n}},{key:'expandByVector',value:function expandByVector(\n\nvector){\n\nthis.min.sub(vector);\nthis.max.add(vector);\n\nreturn this;\n\n}},{key:'expandByScalar',value:function expandByScalar(\n\nscalar){\n\nthis.min.addScalar(-scalar);\nthis.max.addScalar(scalar);\n\nreturn this;\n\n}},{key:'expandByObject',value:function expandByObject(\n\nobject){var precise=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;\n\n// Computes the world-axis-aligned bounding box of an object (including its children),\n// accounting for both the object's, and children's, world transforms\n\nobject.updateWorldMatrix(false,false);\n\nvar geometry=object.geometry;\n\nif(geometry!==undefined){\n\nif(precise&&geometry.attributes!=undefined&&geometry.attributes.position!==undefined){\n\nvar position=geometry.attributes.position;\nfor(var i=0,l=position.count;i<l;i++){\n\n_vector$b.fromBufferAttribute(position,i).applyMatrix4(object.matrixWorld);\nthis.expandByPoint(_vector$b);\n\n}\n\n}else{\n\nif(geometry.boundingBox===null){\n\ngeometry.computeBoundingBox();\n\n}\n\n_box$3.copy(geometry.boundingBox);\n_box$3.applyMatrix4(object.matrixWorld);\n\nthis.union(_box$3);\n\n}\n\n}\n\nvar children=object.children;\n\nfor(var _i2=0,_l=children.length;_i2<_l;_i2++){\n\nthis.expandByObject(children[_i2],precise);\n\n}\n\nreturn this;\n\n}},{key:'containsPoint',value:function containsPoint(\n\npoint){\n\nreturn point.x<this.min.x||point.x>this.max.x||\npoint.y<this.min.y||point.y>this.max.y||\npoint.z<this.min.z||point.z>this.max.z?false:true;\n\n}},{key:'containsBox',value:function containsBox(\n\nbox){\n\nreturn this.min.x<=box.min.x&&box.max.x<=this.max.x&&\nthis.min.y<=box.min.y&&box.max.y<=this.max.y&&\nthis.min.z<=box.min.z&&box.max.z<=this.max.z;\n\n}},{key:'getParameter',value:function getParameter(\n\npoint,target){\n\n// This can potentially have a divide by zero if the box\n// has a size dimension of 0.\n\nreturn target.set(\n(point.x-this.min.x)/(this.max.x-this.min.x),\n(point.y-this.min.y)/(this.max.y-this.min.y),\n(point.z-this.min.z)/(this.max.z-this.min.z));\n\n\n}},{key:'intersectsBox',value:function intersectsBox(\n\nbox){\n\n// using 6 splitting planes to rule out intersections.\nreturn box.max.x<this.min.x||box.min.x>this.max.x||\nbox.max.y<this.min.y||box.min.y>this.max.y||\nbox.max.z<this.min.z||box.min.z>this.max.z?false:true;\n\n}},{key:'intersectsSphere',value:function intersectsSphere(\n\nsphere){\n\n// Find the point on the AABB closest to the sphere center.\nthis.clampPoint(sphere.center,_vector$b);\n\n// If that point is inside the sphere, the AABB and sphere intersect.\nreturn _vector$b.distanceToSquared(sphere.center)<=sphere.radius*sphere.radius;\n\n}},{key:'intersectsPlane',value:function intersectsPlane(\n\nplane){\n\n// We compute the minimum and maximum dot product values. If those values\n// are on the same side (back or front) of the plane, then there is no intersection.\n\nvar min=void 0,max=void 0;\n\nif(plane.normal.x>0){\n\nmin=plane.normal.x*this.min.x;\nmax=plane.normal.x*this.max.x;\n\n}else{\n\nmin=plane.normal.x*this.max.x;\nmax=plane.normal.x*this.min.x;\n\n}\n\nif(plane.normal.y>0){\n\nmin+=plane.normal.y*this.min.y;\nmax+=plane.normal.y*this.max.y;\n\n}else{\n\nmin+=plane.normal.y*this.max.y;\nmax+=plane.normal.y*this.min.y;\n\n}\n\nif(plane.normal.z>0){\n\nmin+=plane.normal.z*this.min.z;\nmax+=plane.normal.z*this.max.z;\n\n}else{\n\nmin+=plane.normal.z*this.max.z;\nmax+=plane.normal.z*this.min.z;\n\n}\n\nreturn min<=-plane.constant&&max>=-plane.constant;\n\n}},{key:'intersectsTriangle',value:function intersectsTriangle(\n\ntriangle){\n\nif(this.isEmpty()){\n\nreturn false;\n\n}\n\n// compute box center and extents\nthis.getCenter(_center);\n_extents.subVectors(this.max,_center);\n\n// translate triangle to aabb origin\n_v0$2.subVectors(triangle.a,_center);\n_v1$7.subVectors(triangle.b,_center);\n_v2$3.subVectors(triangle.c,_center);\n\n// compute edge vectors for triangle\n_f0.subVectors(_v1$7,_v0$2);\n_f1.subVectors(_v2$3,_v1$7);\n_f2.subVectors(_v0$2,_v2$3);\n\n// test against axes that are given by cross product combinations of the edges of the triangle and the edges of the aabb\n// make an axis testing of each of the 3 sides of the aabb against each of the 3 sides of the triangle = 9 axis of separation\n// axis_ij = u_i x f_j (u0, u1, u2 = face normals of aabb = x,y,z axes vectors since aabb is axis aligned)\nvar axes=[\n0,-_f0.z,_f0.y,0,-_f1.z,_f1.y,0,-_f2.z,_f2.y,\n_f0.z,0,-_f0.x,_f1.z,0,-_f1.x,_f2.z,0,-_f2.x,\n-_f0.y,_f0.x,0,-_f1.y,_f1.x,0,-_f2.y,_f2.x,0];\n\nif(!satForAxes(axes,_v0$2,_v1$7,_v2$3,_extents)){\n\nreturn false;\n\n}\n\n// test 3 face normals from the aabb\naxes=[1,0,0,0,1,0,0,0,1];\nif(!satForAxes(axes,_v0$2,_v1$7,_v2$3,_extents)){\n\nreturn false;\n\n}\n\n// finally testing the face normal of the triangle\n// use already existing triangle edge vectors here\n_triangleNormal.crossVectors(_f0,_f1);\naxes=[_triangleNormal.x,_triangleNormal.y,_triangleNormal.z];\n\nreturn satForAxes(axes,_v0$2,_v1$7,_v2$3,_extents);\n\n}},{key:'clampPoint',value:function clampPoint(\n\npoint,target){\n\nreturn target.copy(point).clamp(this.min,this.max);\n\n}},{key:'distanceToPoint',value:function distanceToPoint(\n\npoint){\n\nvar clampedPoint=_vector$b.copy(point).clamp(this.min,this.max);\n\nreturn clampedPoint.sub(point).length();\n\n}},{key:'getBoundingSphere',value:function getBoundingSphere(\n\ntarget){\n\nthis.getCenter(target.center);\n\ntarget.radius=this.getSize(_vector$b).length()*0.5;\n\nreturn target;\n\n}},{key:'intersect',value:function intersect(\n\nbox){\n\nthis.min.max(box.min);\nthis.max.min(box.max);\n\n// ensure that if there is no overlap, the result is fully empty, not slightly empty with non-inf/+inf values that will cause subsequence intersects to erroneously return valid values.\nif(this.isEmpty())this.makeEmpty();\n\nreturn this;\n\n}},{key:'union',value:function union(\n\nbox){\n\nthis.min.min(box.min);\nthis.max.max(box.max);\n\nreturn this;\n\n}},{key:'applyMatrix4',value:function applyMatrix4(\n\nmatrix){\n\n// transform of empty box is an empty box.\nif(this.isEmpty())return this;\n\n// NOTE: I am using a binary pattern to specify all 2^3 combinations below\n_points[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(matrix);// 000\n_points[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(matrix);// 001\n_points[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(matrix);// 010\n_points[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(matrix);// 011\n_points[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(matrix);// 100\n_points[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(matrix);// 101\n_points[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(matrix);// 110\n_points[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(matrix);// 111\n\nthis.setFromPoints(_points);\n\nreturn this;\n\n}},{key:'translate',value:function translate(\n\noffset){\n\nthis.min.add(offset);\nthis.max.add(offset);\n\nreturn this;\n\n}},{key:'equals',value:function equals(\n\nbox){\n\nreturn box.min.equals(this.min)&&box.max.equals(this.max);\n\n}}]);return Box3;}();\n\n\n\nvar _points=[\n/*@__PURE__*/new Vector3(),\n/*@__PURE__*/new Vector3(),\n/*@__PURE__*/new Vector3(),\n/*@__PURE__*/new Vector3(),\n/*@__PURE__*/new Vector3(),\n/*@__PURE__*/new Vector3(),\n/*@__PURE__*/new Vector3(),\n/*@__PURE__*/new Vector3()];\n\n\nvar _vector$b=/*@__PURE__*/new Vector3();\n\nvar _box$3=/*@__PURE__*/new Box3();\n\n// triangle centered vertices\n\nvar _v0$2=/*@__PURE__*/new Vector3();\nvar _v1$7=/*@__PURE__*/new Vector3();\nvar _v2$3=/*@__PURE__*/new Vector3();\n\n// triangle edge vectors\n\nvar _f0=/*@__PURE__*/new Vector3();\nvar _f1=/*@__PURE__*/new Vector3();\nvar _f2=/*@__PURE__*/new Vector3();\n\nvar _center=/*@__PURE__*/new Vector3();\nvar _extents=/*@__PURE__*/new Vector3();\nvar _triangleNormal=/*@__PURE__*/new Vector3();\nvar _testAxis=/*@__PURE__*/new Vector3();\n\nfunction satForAxes(axes,v0,v1,v2,extents){\n\nfor(var i=0,j=axes.length-3;i<=j;i+=3){\n\n_testAxis.fromArray(axes,i);\n// project the aabb onto the separating axis\nvar r=extents.x*Math.abs(_testAxis.x)+extents.y*Math.abs(_testAxis.y)+extents.z*Math.abs(_testAxis.z);\n// project all 3 vertices of the triangle onto the separating axis\nvar p0=v0.dot(_testAxis);\nvar p1=v1.dot(_testAxis);\nvar p2=v2.dot(_testAxis);\n// actual test, basically see if either of the most extreme of the triangle points intersects r\nif(Math.max(-Math.max(p0,p1,p2),Math.min(p0,p1,p2))>r){\n\n// points of the projected triangle are outside the projected half-length of the aabb\n// the axis is separating and we can exit\nreturn false;\n\n}\n\n}\n\nreturn true;\n\n}\n\nvar _box$2=/*@__PURE__*/new Box3();\nvar _v1$6=/*@__PURE__*/new Vector3();\nvar _toFarthestPoint=/*@__PURE__*/new Vector3();\nvar _toPoint=/*@__PURE__*/new Vector3();var\n\nSphere=function(){\n\nfunction Sphere(){var center=arguments.length>0&&arguments[0]!==undefined?arguments[0]:new Vector3();var radius=arguments.length>1&&arguments[1]!==undefined?arguments[1]:-1;_classCallCheck(this,Sphere);\n\nthis.center=center;\nthis.radius=radius;\n\n}_createClass(Sphere,[{key:'set',value:function set(\n\ncenter,radius){\n\nthis.center.copy(center);\nthis.radius=radius;\n\nreturn this;\n\n}},{key:'setFromPoints',value:function setFromPoints(\n\npoints,optionalCenter){\n\nvar center=this.center;\n\nif(optionalCenter!==undefined){\n\ncenter.copy(optionalCenter);\n\n}else{\n\n_box$2.setFromPoints(points).getCenter(center);\n\n}\n\nvar maxRadiusSq=0;\n\nfor(var i=0,il=points.length;i<il;i++){\n\nmaxRadiusSq=Math.max(maxRadiusSq,center.distanceToSquared(points[i]));\n\n}\n\nthis.radius=Math.sqrt(maxRadiusSq);\n\nreturn this;\n\n}},{key:'copy',value:function copy(\n\nsphere){\n\nthis.center.copy(sphere.center);\nthis.radius=sphere.radius;\n\nreturn this;\n\n}},{key:'isEmpty',value:function isEmpty()\n\n{\n\nreturn this.radius<0;\n\n}},{key:'makeEmpty',value:function makeEmpty()\n\n{\n\nthis.center.set(0,0,0);\nthis.radius=-1;\n\nreturn this;\n\n}},{key:'containsPoint',value:function containsPoint(\n\npoint){\n\nreturn point.distanceToSquared(this.center)<=this.radius*this.radius;\n\n}},{key:'distanceToPoint',value:function distanceToPoint(\n\npoint){\n\nreturn point.distanceTo(this.center)-this.radius;\n\n}},{key:'intersectsSphere',value:function intersectsSphere(\n\nsphere){\n\nvar radiusSum=this.radius+sphere.radius;\n\nreturn sphere.center.distanceToSquared(this.center)<=radiusSum*radiusSum;\n\n}},{key:'intersectsBox',value:function intersectsBox(\n\nbox){\n\nreturn box.intersectsSphere(this);\n\n}},{key:'intersectsPlane',value:function intersectsPlane(\n\nplane){\n\nreturn Math.abs(plane.distanceToPoint(this.center))<=this.radius;\n\n}},{key:'clampPoint',value:function clampPoint(\n\npoint,target){\n\nvar deltaLengthSq=this.center.distanceToSquared(point);\n\ntarget.copy(point);\n\nif(deltaLengthSq>this.radius*this.radius){\n\ntarget.sub(this.center).normalize();\ntarget.multiplyScalar(this.radius).add(this.center);\n\n}\n\nreturn target;\n\n}},{key:'getBoundingBox',value:function getBoundingBox(\n\ntarget){\n\nif(this.isEmpty()){\n\n// Empty sphere produces empty bounding box\ntarget.makeEmpty();\nreturn target;\n\n}\n\ntarget.set(this.center,this.center);\ntarget.expandByScalar(this.radius);\n\nreturn target;\n\n}},{key:'applyMatrix4',value:function applyMatrix4(\n\nmatrix){\n\nthis.center.applyMatrix4(matrix);\nthis.radius=this.radius*matrix.getMaxScaleOnAxis();\n\nreturn this;\n\n}},{key:'translate',value:function translate(\n\noffset){\n\nthis.center.add(offset);\n\nreturn this;\n\n}},{key:'expandByPoint',value:function expandByPoint(\n\npoint){\n\n// from https://github.com/juj/MathGeoLib/blob/2940b99b99cfe575dd45103ef20f4019dee15b54/src/Geometry/Sphere.cpp#L649-L671\n\n_toPoint.subVectors(point,this.center);\n\nvar lengthSq=_toPoint.lengthSq();\n\nif(lengthSq>this.radius*this.radius){\n\nvar length=Math.sqrt(lengthSq);\nvar missingRadiusHalf=(length-this.radius)*0.5;\n\n// Nudge this sphere towards the target point. Add half the missing distance to radius,\n// and the other half to position. This gives a tighter enclosure, instead of if\n// the whole missing distance were just added to radius.\n\nthis.center.add(_toPoint.multiplyScalar(missingRadiusHalf/length));\nthis.radius+=missingRadiusHalf;\n\n}\n\nreturn this;\n\n}},{key:'union',value:function union(\n\nsphere){\n\n// from https://github.com/juj/MathGeoLib/blob/2940b99b99cfe575dd45103ef20f4019dee15b54/src/Geometry/Sphere.cpp#L759-L769\n\n// To enclose another sphere into this sphere, we only need to enclose two points:\n// 1) Enclose the farthest point on the other sphere into this sphere.\n// 2) Enclose the opposite point of the farthest point into this sphere.\n\nif(this.center.equals(sphere.center)===true){\n\n_toFarthestPoint.set(0,0,1).multiplyScalar(sphere.radius);\n\n\n}else{\n\n_toFarthestPoint.subVectors(sphere.center,this.center).normalize().multiplyScalar(sphere.radius);\n\n}\n\nthis.expandByPoint(_v1$6.copy(sphere.center).add(_toFarthestPoint));\nthis.expandByPoint(_v1$6.copy(sphere.center).sub(_toFarthestPoint));\n\nreturn this;\n\n}},{key:'equals',value:function equals(\n\nsphere){\n\nreturn sphere.center.equals(this.center)&&sphere.radius===this.radius;\n\n}},{key:'clone',value:function clone()\n\n{\n\nreturn new this.constructor().copy(this);\n\n}}]);return Sphere;}();\n\n\n\nvar _vector$a=/*@__PURE__*/new Vector3();\nvar _segCenter=/*@__PURE__*/new Vector3();\nvar _segDir=/*@__PURE__*/new Vector3();\nvar _diff=/*@__PURE__*/new Vector3();\n\nvar _edge1=/*@__PURE__*/new Vector3();\nvar _edge2=/*@__PURE__*/new Vector3();\nvar _normal$1=/*@__PURE__*/new Vector3();var\n\nRay=function(){\n\nfunction Ray(){var origin=arguments.length>0&&arguments[0]!==undefined?arguments[0]:new Vector3();var direction=arguments.length>1&&arguments[1]!==undefined?arguments[1]:new Vector3(0,0,-1);_classCallCheck(this,Ray);\n\nthis.origin=origin;\nthis.direction=direction;\n\n}_createClass(Ray,[{key:'set',value:function set(\n\norigin,direction){\n\nthis.origin.copy(origin);\nthis.direction.copy(direction);\n\nreturn this;\n\n}},{key:'copy',value:function copy(\n\nray){\n\nthis.origin.copy(ray.origin);\nthis.direction.copy(ray.direction);\n\nreturn this;\n\n}},{key:'at',value:function at(\n\nt,target){\n\nreturn target.copy(this.direction).multiplyScalar(t).add(this.origin);\n\n}},{key:'lookAt',value:function lookAt(\n\nv){\n\nthis.direction.copy(v).sub(this.origin).normalize();\n\nreturn this;\n\n}},{key:'recast',value:function recast(\n\nt){\n\nthis.origin.copy(this.at(t,_vector$a));\n\nreturn this;\n\n}},{key:'closestPointToPoint',value:function closestPointToPoint(\n\npoint,target){\n\ntarget.subVectors(point,this.origin);\n\nvar directionDistance=target.dot(this.direction);\n\nif(directionDistance<0){\n\nreturn target.copy(this.origin);\n\n}\n\nreturn target.copy(this.direction).multiplyScalar(directionDistance).add(this.origin);\n\n}},{key:'distanceToPoint',value:function distanceToPoint(\n\npoint){\n\nreturn Math.sqrt(this.distanceSqToPoint(point));\n\n}},{key:'distanceSqToPoint',value:function distanceSqToPoint(\n\npoint){\n\nvar directionDistance=_vector$a.subVectors(point,this.origin).dot(this.direction);\n\n// point behind the ray\n\nif(directionDistance<0){\n\nreturn this.origin.distanceToSquared(point);\n\n}\n\n_vector$a.copy(this.direction).multiplyScalar(directionDistance).add(this.origin);\n\nreturn _vector$a.distanceToSquared(point);\n\n}},{key:'distanceSqToSegment',value:function distanceSqToSegment(\n\nv0,v1,optionalPointOnRay,optionalPointOnSegment){\n\n// from https://github.com/pmjoniak/GeometricTools/blob/master/GTEngine/Include/Mathematics/GteDistRaySegment.h\n// It returns the min distance between the ray and the segment\n// defined by v0 and v1\n// It can also set two optional targets :\n// - The closest point on the ray\n// - The closest point on the segment\n\n_segCenter.copy(v0).add(v1).multiplyScalar(0.5);\n_segDir.copy(v1).sub(v0).normalize();\n_diff.copy(this.origin).sub(_segCenter);\n\nvar segExtent=v0.distanceTo(v1)*0.5;\nvar a01=-this.direction.dot(_segDir);\nvar b0=_diff.dot(this.direction);\nvar b1=-_diff.dot(_segDir);\nvar c=_diff.lengthSq();\nvar det=Math.abs(1-a01*a01);\nvar s0=void 0,s1=void 0,sqrDist=void 0,extDet=void 0;\n\nif(det>0){\n\n// The ray and segment are not parallel.\n\ns0=a01*b1-b0;\ns1=a01*b0-b1;\nextDet=segExtent*det;\n\nif(s0>=0){\n\nif(s1>=-extDet){\n\nif(s1<=extDet){\n\n// region 0\n// Minimum at interior points of ray and segment.\n\nvar invDet=1/det;\ns0*=invDet;\ns1*=invDet;\nsqrDist=s0*(s0+a01*s1+2*b0)+s1*(a01*s0+s1+2*b1)+c;\n\n}else{\n\n// region 1\n\ns1=segExtent;\ns0=Math.max(0,-(a01*s1+b0));\nsqrDist=-s0*s0+s1*(s1+2*b1)+c;\n\n}\n\n}else{\n\n// region 5\n\ns1=-segExtent;\ns0=Math.max(0,-(a01*s1+b0));\nsqrDist=-s0*s0+s1*(s1+2*b1)+c;\n\n}\n\n}else{\n\nif(s1<=-extDet){\n\n// region 4\n\ns0=Math.max(0,-(-a01*segExtent+b0));\ns1=s0>0?-segExtent:Math.min(Math.max(-segExtent,-b1),segExtent);\nsqrDist=-s0*s0+s1*(s1+2*b1)+c;\n\n}else if(s1<=extDet){\n\n// region 3\n\ns0=0;\ns1=Math.min(Math.max(-segExtent,-b1),segExtent);\nsqrDist=s1*(s1+2*b1)+c;\n\n}else{\n\n// region 2\n\ns0=Math.max(0,-(a01*segExtent+b0));\ns1=s0>0?segExtent:Math.min(Math.max(-segExtent,-b1),segExtent);\nsqrDist=-s0*s0+s1*(s1+2*b1)+c;\n\n}\n\n}\n\n}else{\n\n// Ray and segment are parallel.\n\ns1=a01>0?-segExtent:segExtent;\ns0=Math.max(0,-(a01*s1+b0));\nsqrDist=-s0*s0+s1*(s1+2*b1)+c;\n\n}\n\nif(optionalPointOnRay){\n\noptionalPointOnRay.copy(this.direction).multiplyScalar(s0).add(this.origin);\n\n}\n\nif(optionalPointOnSegment){\n\noptionalPointOnSegment.copy(_segDir).multiplyScalar(s1).add(_segCenter);\n\n}\n\nreturn sqrDist;\n\n}},{key:'intersectSphere',value:function intersectSphere(\n\nsphere,target){\n\n_vector$a.subVectors(sphere.center,this.origin);\nvar tca=_vector$a.dot(this.direction);\nvar d2=_vector$a.dot(_vector$a)-tca*tca;\nvar radius2=sphere.radius*sphere.radius;\n\nif(d2>radius2)return null;\n\nvar thc=Math.sqrt(radius2-d2);\n\n// t0 = first intersect point - entrance on front of sphere\nvar t0=tca-thc;\n\n// t1 = second intersect point - exit point on back of sphere\nvar t1=tca+thc;\n\n// test to see if both t0 and t1 are behind the ray - if so, return null\nif(t0<0&&t1<0)return null;\n\n// test to see if t0 is behind the ray:\n// if it is, the ray is inside the sphere, so return the second exit point scaled by t1,\n// in order to always return an intersect point that is in front of the ray.\nif(t0<0)return this.at(t1,target);\n\n// else t0 is in front of the ray, so return the first collision point scaled by t0\nreturn this.at(t0,target);\n\n}},{key:'intersectsSphere',value:function intersectsSphere(\n\nsphere){\n\nreturn this.distanceSqToPoint(sphere.center)<=sphere.radius*sphere.radius;\n\n}},{key:'distanceToPlane',value:function distanceToPlane(\n\nplane){\n\nvar denominator=plane.normal.dot(this.direction);\n\nif(denominator===0){\n\n// line is coplanar, return origin\nif(plane.distanceToPoint(this.origin)===0){\n\nreturn 0;\n\n}\n\n// Null is preferable to undefined since undefined means.... it is undefined\n\nreturn null;\n\n}\n\nvar t=-(this.origin.dot(plane.normal)+plane.constant)/denominator;\n\n// Return if the ray never intersects the plane\n\nreturn t>=0?t:null;\n\n}},{key:'intersectPlane',value:function intersectPlane(\n\nplane,target){\n\nvar t=this.distanceToPlane(plane);\n\nif(t===null){\n\nreturn null;\n\n}\n\nreturn this.at(t,target);\n\n}},{key:'intersectsPlane',value:function intersectsPlane(\n\nplane){\n\n// check if the ray lies on the plane first\n\nvar distToPoint=plane.distanceToPoint(this.origin);\n\nif(distToPoint===0){\n\nreturn true;\n\n}\n\nvar denominator=plane.normal.dot(this.direction);\n\nif(denominator*distToPoint<0){\n\nreturn true;\n\n}\n\n// ray origin is behind the plane (and is pointing behind it)\n\nreturn false;\n\n}},{key:'intersectBox',value:function intersectBox(\n\nbox,target){\n\nvar tmin=void 0,tmax=void 0,tymin=void 0,tymax=void 0,tzmin=void 0,tzmax=void 0;\n\nvar invdirx=1/this.direction.x,\ninvdiry=1/this.direction.y,\ninvdirz=1/this.direction.z;\n\nvar origin=this.origin;\n\nif(invdirx>=0){\n\ntmin=(box.min.x-origin.x)*invdirx;\ntmax=(box.max.x-origin.x)*invdirx;\n\n}else{\n\ntmin=(box.max.x-origin.x)*invdirx;\ntmax=(box.min.x-origin.x)*invdirx;\n\n}\n\nif(invdiry>=0){\n\ntymin=(box.min.y-origin.y)*invdiry;\ntymax=(box.max.y-origin.y)*invdiry;\n\n}else{\n\ntymin=(box.max.y-origin.y)*invdiry;\ntymax=(box.min.y-origin.y)*invdiry;\n\n}\n\nif(tmin>tymax||tymin>tmax)return null;\n\n// These lines also handle the case where tmin or tmax is NaN\n// (result of 0 * Infinity). x !== x returns true if x is NaN\n\nif(tymin>tmin||tmin!==tmin)tmin=tymin;\n\nif(tymax<tmax||tmax!==tmax)tmax=tymax;\n\nif(invdirz>=0){\n\ntzmin=(box.min.z-origin.z)*invdirz;\ntzmax=(box.max.z-origin.z)*invdirz;\n\n}else{\n\ntzmin=(box.max.z-origin.z)*invdirz;\ntzmax=(box.min.z-origin.z)*invdirz;\n\n}\n\nif(tmin>tzmax||tzmin>tmax)return null;\n\nif(tzmin>tmin||tmin!==tmin)tmin=tzmin;\n\nif(tzmax<tmax||tmax!==tmax)tmax=tzmax;\n\n//return point closest to the ray (positive side)\n\nif(tmax<0)return null;\n\nreturn this.at(tmin>=0?tmin:tmax,target);\n\n}},{key:'intersectsBox',value:function intersectsBox(\n\nbox){\n\nreturn this.intersectBox(box,_vector$a)!==null;\n\n}},{key:'intersectTriangle',value:function intersectTriangle(\n\na,b,c,backfaceCulling,target){\n\n// Compute the offset origin, edges, and normal.\n\n// from https://github.com/pmjoniak/GeometricTools/blob/master/GTEngine/Include/Mathematics/GteIntrRay3Triangle3.h\n\n_edge1.subVectors(b,a);\n_edge2.subVectors(c,a);\n_normal$1.crossVectors(_edge1,_edge2);\n\n// Solve Q + t*D = b1*E1 + b2*E2 (Q = kDiff, D = ray direction,\n// E1 = kEdge1, E2 = kEdge2, N = Cross(E1,E2)) by\n//   |Dot(D,N)|*b1 = sign(Dot(D,N))*Dot(D,Cross(Q,E2))\n//   |Dot(D,N)|*b2 = sign(Dot(D,N))*Dot(D,Cross(E1,Q))\n//   |Dot(D,N)|*t = -sign(Dot(D,N))*Dot(Q,N)\nvar DdN=this.direction.dot(_normal$1);\nvar sign=void 0;\n\nif(DdN>0){\n\nif(backfaceCulling)return null;\nsign=1;\n\n}else if(DdN<0){\n\nsign=-1;\nDdN=-DdN;\n\n}else{\n\nreturn null;\n\n}\n\n_diff.subVectors(this.origin,a);\nvar DdQxE2=sign*this.direction.dot(_edge2.crossVectors(_diff,_edge2));\n\n// b1 < 0, no intersection\nif(DdQxE2<0){\n\nreturn null;\n\n}\n\nvar DdE1xQ=sign*this.direction.dot(_edge1.cross(_diff));\n\n// b2 < 0, no intersection\nif(DdE1xQ<0){\n\nreturn null;\n\n}\n\n// b1+b2 > 1, no intersection\nif(DdQxE2+DdE1xQ>DdN){\n\nreturn null;\n\n}\n\n// Line intersects triangle, check if ray does.\nvar QdN=-sign*_diff.dot(_normal$1);\n\n// t < 0, no intersection\nif(QdN<0){\n\nreturn null;\n\n}\n\n// Ray intersects triangle.\nreturn this.at(QdN/DdN,target);\n\n}},{key:'applyMatrix4',value:function applyMatrix4(\n\nmatrix4){\n\nthis.origin.applyMatrix4(matrix4);\nthis.direction.transformDirection(matrix4);\n\nreturn this;\n\n}},{key:'equals',value:function equals(\n\nray){\n\nreturn ray.origin.equals(this.origin)&&ray.direction.equals(this.direction);\n\n}},{key:'clone',value:function clone()\n\n{\n\nreturn new this.constructor().copy(this);\n\n}}]);return Ray;}();var\n\n\n\nMatrix4=function(){\n\nfunction Matrix4(){_classCallCheck(this,Matrix4);\n\nMatrix4.prototype.isMatrix4=true;\n\nthis.elements=[\n\n1,0,0,0,\n0,1,0,0,\n0,0,1,0,\n0,0,0,1];\n\n\n\nif(arguments.length>0){\n\nconsole.error('THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.');\n\n}\n\n}_createClass(Matrix4,[{key:'set',value:function set(\n\nn11,n12,n13,n14,n21,n22,n23,n24,n31,n32,n33,n34,n41,n42,n43,n44){\n\nvar te=this.elements;\n\nte[0]=n11;te[4]=n12;te[8]=n13;te[12]=n14;\nte[1]=n21;te[5]=n22;te[9]=n23;te[13]=n24;\nte[2]=n31;te[6]=n32;te[10]=n33;te[14]=n34;\nte[3]=n41;te[7]=n42;te[11]=n43;te[15]=n44;\n\nreturn this;\n\n}},{key:'identity',value:function identity()\n\n{\n\nthis.set(\n\n1,0,0,0,\n0,1,0,0,\n0,0,1,0,\n0,0,0,1);\n\n\n\nreturn this;\n\n}},{key:'clone',value:function clone()\n\n{\n\nreturn new Matrix4().fromArray(this.elements);\n\n}},{key:'copy',value:function copy(\n\nm){\n\nvar te=this.elements;\nvar me=m.elements;\n\nte[0]=me[0];te[1]=me[1];te[2]=me[2];te[3]=me[3];\nte[4]=me[4];te[5]=me[5];te[6]=me[6];te[7]=me[7];\nte[8]=me[8];te[9]=me[9];te[10]=me[10];te[11]=me[11];\nte[12]=me[12];te[13]=me[13];te[14]=me[14];te[15]=me[15];\n\nreturn this;\n\n}},{key:'copyPosition',value:function copyPosition(\n\nm){\n\nvar te=this.elements,me=m.elements;\n\nte[12]=me[12];\nte[13]=me[13];\nte[14]=me[14];\n\nreturn this;\n\n}},{key:'setFromMatrix3',value:function setFromMatrix3(\n\nm){\n\nvar me=m.elements;\n\nthis.set(\n\nme[0],me[3],me[6],0,\nme[1],me[4],me[7],0,\nme[2],me[5],me[8],0,\n0,0,0,1);\n\n\n\nreturn this;\n\n}},{key:'extractBasis',value:function extractBasis(\n\nxAxis,yAxis,zAxis){\n\nxAxis.setFromMatrixColumn(this,0);\nyAxis.setFromMatrixColumn(this,1);\nzAxis.setFromMatrixColumn(this,2);\n\nreturn this;\n\n}},{key:'makeBasis',value:function makeBasis(\n\nxAxis,yAxis,zAxis){\n\nthis.set(\nxAxis.x,yAxis.x,zAxis.x,0,\nxAxis.y,yAxis.y,zAxis.y,0,\nxAxis.z,yAxis.z,zAxis.z,0,\n0,0,0,1);\n\n\nreturn this;\n\n}},{key:'extractRotation',value:function extractRotation(\n\nm){\n\n// this method does not support reflection matrices\n\nvar te=this.elements;\nvar me=m.elements;\n\nvar scaleX=1/_v1$5.setFromMatrixColumn(m,0).length();\nvar scaleY=1/_v1$5.setFromMatrixColumn(m,1).length();\nvar scaleZ=1/_v1$5.setFromMatrixColumn(m,2).length();\n\nte[0]=me[0]*scaleX;\nte[1]=me[1]*scaleX;\nte[2]=me[2]*scaleX;\nte[3]=0;\n\nte[4]=me[4]*scaleY;\nte[5]=me[5]*scaleY;\nte[6]=me[6]*scaleY;\nte[7]=0;\n\nte[8]=me[8]*scaleZ;\nte[9]=me[9]*scaleZ;\nte[10]=me[10]*scaleZ;\nte[11]=0;\n\nte[12]=0;\nte[13]=0;\nte[14]=0;\nte[15]=1;\n\nreturn this;\n\n}},{key:'makeRotationFromEuler',value:function makeRotationFromEuler(\n\neuler){\n\nif(!(euler&&euler.isEuler)){\n\nconsole.error('THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.');\n\n}\n\nvar te=this.elements;\n\nvar x=euler.x,y=euler.y,z=euler.z;\nvar a=Math.cos(x),b=Math.sin(x);\nvar c=Math.cos(y),d=Math.sin(y);\nvar e=Math.cos(z),f=Math.sin(z);\n\nif(euler.order==='XYZ'){\n\nvar ae=a*e,af=a*f,be=b*e,bf=b*f;\n\nte[0]=c*e;\nte[4]=-c*f;\nte[8]=d;\n\nte[1]=af+be*d;\nte[5]=ae-bf*d;\nte[9]=-b*c;\n\nte[2]=bf-ae*d;\nte[6]=be+af*d;\nte[10]=a*c;\n\n}else if(euler.order==='YXZ'){\n\nvar ce=c*e,cf=c*f,de=d*e,df=d*f;\n\nte[0]=ce+df*b;\nte[4]=de*b-cf;\nte[8]=a*d;\n\nte[1]=a*f;\nte[5]=a*e;\nte[9]=-b;\n\nte[2]=cf*b-de;\nte[6]=df+ce*b;\nte[10]=a*c;\n\n}else if(euler.order==='ZXY'){\n\nvar _ce=c*e,_cf=c*f,_de=d*e,_df=d*f;\n\nte[0]=_ce-_df*b;\nte[4]=-a*f;\nte[8]=_de+_cf*b;\n\nte[1]=_cf+_de*b;\nte[5]=a*e;\nte[9]=_df-_ce*b;\n\nte[2]=-a*d;\nte[6]=b;\nte[10]=a*c;\n\n}else if(euler.order==='ZYX'){\n\nvar _ae=a*e,_af=a*f,_be=b*e,_bf=b*f;\n\nte[0]=c*e;\nte[4]=_be*d-_af;\nte[8]=_ae*d+_bf;\n\nte[1]=c*f;\nte[5]=_bf*d+_ae;\nte[9]=_af*d-_be;\n\nte[2]=-d;\nte[6]=b*c;\nte[10]=a*c;\n\n}else if(euler.order==='YZX'){\n\nvar ac=a*c,ad=a*d,bc=b*c,bd=b*d;\n\nte[0]=c*e;\nte[4]=bd-ac*f;\nte[8]=bc*f+ad;\n\nte[1]=f;\nte[5]=a*e;\nte[9]=-b*e;\n\nte[2]=-d*e;\nte[6]=ad*f+bc;\nte[10]=ac-bd*f;\n\n}else if(euler.order==='XZY'){\n\nvar _ac=a*c,_ad=a*d,_bc=b*c,_bd=b*d;\n\nte[0]=c*e;\nte[4]=-f;\nte[8]=d*e;\n\nte[1]=_ac*f+_bd;\nte[5]=a*e;\nte[9]=_ad*f-_bc;\n\nte[2]=_bc*f-_ad;\nte[6]=b*e;\nte[10]=_bd*f+_ac;\n\n}\n\n// bottom row\nte[3]=0;\nte[7]=0;\nte[11]=0;\n\n// last column\nte[12]=0;\nte[13]=0;\nte[14]=0;\nte[15]=1;\n\nreturn this;\n\n}},{key:'makeRotationFromQuaternion',value:function makeRotationFromQuaternion(\n\nq){\n\nreturn this.compose(_zero,q,_one);\n\n}},{key:'lookAt',value:function lookAt(\n\neye,target,up){\n\nvar te=this.elements;\n\n_z.subVectors(eye,target);\n\nif(_z.lengthSq()===0){\n\n// eye and target are in the same position\n\n_z.z=1;\n\n}\n\n_z.normalize();\n_x.crossVectors(up,_z);\n\nif(_x.lengthSq()===0){\n\n// up and z are parallel\n\nif(Math.abs(up.z)===1){\n\n_z.x+=0.0001;\n\n}else{\n\n_z.z+=0.0001;\n\n}\n\n_z.normalize();\n_x.crossVectors(up,_z);\n\n}\n\n_x.normalize();\n_y.crossVectors(_z,_x);\n\nte[0]=_x.x;te[4]=_y.x;te[8]=_z.x;\nte[1]=_x.y;te[5]=_y.y;te[9]=_z.y;\nte[2]=_x.z;te[6]=_y.z;te[10]=_z.z;\n\nreturn this;\n\n}},{key:'multiply',value:function multiply(\n\nm,n){\n\nif(n!==undefined){\n\nconsole.warn('THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead.');\nreturn this.multiplyMatrices(m,n);\n\n}\n\nreturn this.multiplyMatrices(this,m);\n\n}},{key:'premultiply',value:function premultiply(\n\nm){\n\nreturn this.multiplyMatrices(m,this);\n\n}},{key:'multiplyMatrices',value:function multiplyMatrices(\n\na,b){\n\nvar ae=a.elements;\nvar be=b.elements;\nvar te=this.elements;\n\nvar a11=ae[0],a12=ae[4],a13=ae[8],a14=ae[12];\nvar a21=ae[1],a22=ae[5],a23=ae[9],a24=ae[13];\nvar a31=ae[2],a32=ae[6],a33=ae[10],a34=ae[14];\nvar a41=ae[3],a42=ae[7],a43=ae[11],a44=ae[15];\n\nvar b11=be[0],b12=be[4],b13=be[8],b14=be[12];\nvar b21=be[1],b22=be[5],b23=be[9],b24=be[13];\nvar b31=be[2],b32=be[6],b33=be[10],b34=be[14];\nvar b41=be[3],b42=be[7],b43=be[11],b44=be[15];\n\nte[0]=a11*b11+a12*b21+a13*b31+a14*b41;\nte[4]=a11*b12+a12*b22+a13*b32+a14*b42;\nte[8]=a11*b13+a12*b23+a13*b33+a14*b43;\nte[12]=a11*b14+a12*b24+a13*b34+a14*b44;\n\nte[1]=a21*b11+a22*b21+a23*b31+a24*b41;\nte[5]=a21*b12+a22*b22+a23*b32+a24*b42;\nte[9]=a21*b13+a22*b23+a23*b33+a24*b43;\nte[13]=a21*b14+a22*b24+a23*b34+a24*b44;\n\nte[2]=a31*b11+a32*b21+a33*b31+a34*b41;\nte[6]=a31*b12+a32*b22+a33*b32+a34*b42;\nte[10]=a31*b13+a32*b23+a33*b33+a34*b43;\nte[14]=a31*b14+a32*b24+a33*b34+a34*b44;\n\nte[3]=a41*b11+a42*b21+a43*b31+a44*b41;\nte[7]=a41*b12+a42*b22+a43*b32+a44*b42;\nte[11]=a41*b13+a42*b23+a43*b33+a44*b43;\nte[15]=a41*b14+a42*b24+a43*b34+a44*b44;\n\nreturn this;\n\n}},{key:'multiplyScalar',value:function multiplyScalar(\n\ns){\n\nvar te=this.elements;\n\nte[0]*=s;te[4]*=s;te[8]*=s;te[12]*=s;\nte[1]*=s;te[5]*=s;te[9]*=s;te[13]*=s;\nte[2]*=s;te[6]*=s;te[10]*=s;te[14]*=s;\nte[3]*=s;te[7]*=s;te[11]*=s;te[15]*=s;\n\nreturn this;\n\n}},{key:'determinant',value:function determinant()\n\n{\n\nvar te=this.elements;\n\nvar n11=te[0],n12=te[4],n13=te[8],n14=te[12];\nvar n21=te[1],n22=te[5],n23=te[9],n24=te[13];\nvar n31=te[2],n32=te[6],n33=te[10],n34=te[14];\nvar n41=te[3],n42=te[7],n43=te[11],n44=te[15];\n\n//TODO: make this more efficient\n//( based on http://www.euclideanspace.com/maths/algebra/matrix/functions/inverse/fourD/index.htm )\n\nreturn(\nn41*(\n+n14*n23*n32-\nn13*n24*n32-\nn14*n22*n33+\nn12*n24*n33+\nn13*n22*n34-\nn12*n23*n34)+\n\nn42*(\n+n11*n23*n34-\nn11*n24*n33+\nn14*n21*n33-\nn13*n21*n34+\nn13*n24*n31-\nn14*n23*n31)+\n\nn43*(\n+n11*n24*n32-\nn11*n22*n34-\nn14*n21*n32+\nn12*n21*n34+\nn14*n22*n31-\nn12*n24*n31)+\n\nn44*(\n-n13*n22*n31-\nn11*n23*n32+\nn11*n22*n33+\nn13*n21*n32-\nn12*n21*n33+\nn12*n23*n31));\n\n\n\n\n}},{key:'transpose',value:function transpose()\n\n{\n\nvar te=this.elements;\nvar tmp=void 0;\n\ntmp=te[1];te[1]=te[4];te[4]=tmp;\ntmp=te[2];te[2]=te[8];te[8]=tmp;\ntmp=te[6];te[6]=te[9];te[9]=tmp;\n\ntmp=te[3];te[3]=te[12];te[12]=tmp;\ntmp=te[7];te[7]=te[13];te[13]=tmp;\ntmp=te[11];te[11]=te[14];te[14]=tmp;\n\nreturn this;\n\n}},{key:'setPosition',value:function setPosition(\n\nx,y,z){\n\nvar te=this.elements;\n\nif(x.isVector3){\n\nte[12]=x.x;\nte[13]=x.y;\nte[14]=x.z;\n\n}else{\n\nte[12]=x;\nte[13]=y;\nte[14]=z;\n\n}\n\nreturn this;\n\n}},{key:'invert',value:function invert()\n\n{\n\n// based on http://www.euclideanspace.com/maths/algebra/matrix/functions/inverse/fourD/index.htm\nvar te=this.elements,\n\nn11=te[0],n21=te[1],n31=te[2],n41=te[3],\nn12=te[4],n22=te[5],n32=te[6],n42=te[7],\nn13=te[8],n23=te[9],n33=te[10],n43=te[11],\nn14=te[12],n24=te[13],n34=te[14],n44=te[15],\n\nt11=n23*n34*n42-n24*n33*n42+n24*n32*n43-n22*n34*n43-n23*n32*n44+n22*n33*n44,\nt12=n14*n33*n42-n13*n34*n42-n14*n32*n43+n12*n34*n43+n13*n32*n44-n12*n33*n44,\nt13=n13*n24*n42-n14*n23*n42+n14*n22*n43-n12*n24*n43-n13*n22*n44+n12*n23*n44,\nt14=n14*n23*n32-n13*n24*n32-n14*n22*n33+n12*n24*n33+n13*n22*n34-n12*n23*n34;\n\nvar det=n11*t11+n21*t12+n31*t13+n41*t14;\n\nif(det===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);\n\nvar detInv=1/det;\n\nte[0]=t11*detInv;\nte[1]=(n24*n33*n41-n23*n34*n41-n24*n31*n43+n21*n34*n43+n23*n31*n44-n21*n33*n44)*detInv;\nte[2]=(n22*n34*n41-n24*n32*n41+n24*n31*n42-n21*n34*n42-n22*n31*n44+n21*n32*n44)*detInv;\nte[3]=(n23*n32*n41-n22*n33*n41-n23*n31*n42+n21*n33*n42+n22*n31*n43-n21*n32*n43)*detInv;\n\nte[4]=t12*detInv;\nte[5]=(n13*n34*n41-n14*n33*n41+n14*n31*n43-n11*n34*n43-n13*n31*n44+n11*n33*n44)*detInv;\nte[6]=(n14*n32*n41-n12*n34*n41-n14*n31*n42+n11*n34*n42+n12*n31*n44-n11*n32*n44)*detInv;\nte[7]=(n12*n33*n41-n13*n32*n41+n13*n31*n42-n11*n33*n42-n12*n31*n43+n11*n32*n43)*detInv;\n\nte[8]=t13*detInv;\nte[9]=(n14*n23*n41-n13*n24*n41-n14*n21*n43+n11*n24*n43+n13*n21*n44-n11*n23*n44)*detInv;\nte[10]=(n12*n24*n41-n14*n22*n41+n14*n21*n42-n11*n24*n42-n12*n21*n44+n11*n22*n44)*detInv;\nte[11]=(n13*n22*n41-n12*n23*n41-n13*n21*n42+n11*n23*n42+n12*n21*n43-n11*n22*n43)*detInv;\n\nte[12]=t14*detInv;\nte[13]=(n13*n24*n31-n14*n23*n31+n14*n21*n33-n11*n24*n33-n13*n21*n34+n11*n23*n34)*detInv;\nte[14]=(n14*n22*n31-n12*n24*n31-n14*n21*n32+n11*n24*n32+n12*n21*n34-n11*n22*n34)*detInv;\nte[15]=(n12*n23*n31-n13*n22*n31+n13*n21*n32-n11*n23*n32-n12*n21*n33+n11*n22*n33)*detInv;\n\nreturn this;\n\n}},{key:'scale',value:function scale(\n\nv){\n\nvar te=this.elements;\nvar x=v.x,y=v.y,z=v.z;\n\nte[0]*=x;te[4]*=y;te[8]*=z;\nte[1]*=x;te[5]*=y;te[9]*=z;\nte[2]*=x;te[6]*=y;te[10]*=z;\nte[3]*=x;te[7]*=y;te[11]*=z;\n\nreturn this;\n\n}},{key:'getMaxScaleOnAxis',value:function getMaxScaleOnAxis()\n\n{\n\nvar te=this.elements;\n\nvar scaleXSq=te[0]*te[0]+te[1]*te[1]+te[2]*te[2];\nvar scaleYSq=te[4]*te[4]+te[5]*te[5]+te[6]*te[6];\nvar scaleZSq=te[8]*te[8]+te[9]*te[9]+te[10]*te[10];\n\nreturn Math.sqrt(Math.max(scaleXSq,scaleYSq,scaleZSq));\n\n}},{key:'makeTranslation',value:function makeTranslation(\n\nx,y,z){\n\nthis.set(\n\n1,0,0,x,\n0,1,0,y,\n0,0,1,z,\n0,0,0,1);\n\n\n\nreturn this;\n\n}},{key:'makeRotationX',value:function makeRotationX(\n\ntheta){\n\nvar c=Math.cos(theta),s=Math.sin(theta);\n\nthis.set(\n\n1,0,0,0,\n0,c,-s,0,\n0,s,c,0,\n0,0,0,1);\n\n\n\nreturn this;\n\n}},{key:'makeRotationY',value:function makeRotationY(\n\ntheta){\n\nvar c=Math.cos(theta),s=Math.sin(theta);\n\nthis.set(\n\nc,0,s,0,\n0,1,0,0,\n-s,0,c,0,\n0,0,0,1);\n\n\n\nreturn this;\n\n}},{key:'makeRotationZ',value:function makeRotationZ(\n\ntheta){\n\nvar c=Math.cos(theta),s=Math.sin(theta);\n\nthis.set(\n\nc,-s,0,0,\ns,c,0,0,\n0,0,1,0,\n0,0,0,1);\n\n\n\nreturn this;\n\n}},{key:'makeRotationAxis',value:function makeRotationAxis(\n\naxis,angle){\n\n// Based on http://www.gamedev.net/reference/articles/article1199.asp\n\nvar c=Math.cos(angle);\nvar s=Math.sin(angle);\nvar t=1-c;\nvar x=axis.x,y=axis.y,z=axis.z;\nvar tx=t*x,ty=t*y;\n\nthis.set(\n\ntx*x+c,tx*y-s*z,tx*z+s*y,0,\ntx*y+s*z,ty*y+c,ty*z-s*x,0,\ntx*z-s*y,ty*z+s*x,t*z*z+c,0,\n0,0,0,1);\n\n\n\nreturn this;\n\n}},{key:'makeScale',value:function makeScale(\n\nx,y,z){\n\nthis.set(\n\nx,0,0,0,\n0,y,0,0,\n0,0,z,0,\n0,0,0,1);\n\n\n\nreturn this;\n\n}},{key:'makeShear',value:function makeShear(\n\nxy,xz,yx,yz,zx,zy){\n\nthis.set(\n\n1,yx,zx,0,\nxy,1,zy,0,\nxz,yz,1,0,\n0,0,0,1);\n\n\n\nreturn this;\n\n}},{key:'compose',value:function compose(\n\nposition,quaternion,scale){\n\nvar te=this.elements;\n\nvar x=quaternion._x,y=quaternion._y,z=quaternion._z,w=quaternion._w;\nvar x2=x+x,y2=y+y,z2=z+z;\nvar xx=x*x2,xy=x*y2,xz=x*z2;\nvar yy=y*y2,yz=y*z2,zz=z*z2;\nvar wx=w*x2,wy=w*y2,wz=w*z2;\n\nvar sx=scale.x,sy=scale.y,sz=scale.z;\n\nte[0]=(1-(yy+zz))*sx;\nte[1]=(xy+wz)*sx;\nte[2]=(xz-wy)*sx;\nte[3]=0;\n\nte[4]=(xy-wz)*sy;\nte[5]=(1-(xx+zz))*sy;\nte[6]=(yz+wx)*sy;\nte[7]=0;\n\nte[8]=(xz+wy)*sz;\nte[9]=(yz-wx)*sz;\nte[10]=(1-(xx+yy))*sz;\nte[11]=0;\n\nte[12]=position.x;\nte[13]=position.y;\nte[14]=position.z;\nte[15]=1;\n\nreturn this;\n\n}},{key:'decompose',value:function decompose(\n\nposition,quaternion,scale){\n\nvar te=this.elements;\n\nvar sx=_v1$5.set(te[0],te[1],te[2]).length();\nvar sy=_v1$5.set(te[4],te[5],te[6]).length();\nvar sz=_v1$5.set(te[8],te[9],te[10]).length();\n\n// if determine is negative, we need to invert one scale\nvar det=this.determinant();\nif(det<0)sx=-sx;\n\nposition.x=te[12];\nposition.y=te[13];\nposition.z=te[14];\n\n// scale the rotation part\n_m1$2.copy(this);\n\nvar invSX=1/sx;\nvar invSY=1/sy;\nvar invSZ=1/sz;\n\n_m1$2.elements[0]*=invSX;\n_m1$2.elements[1]*=invSX;\n_m1$2.elements[2]*=invSX;\n\n_m1$2.elements[4]*=invSY;\n_m1$2.elements[5]*=invSY;\n_m1$2.elements[6]*=invSY;\n\n_m1$2.elements[8]*=invSZ;\n_m1$2.elements[9]*=invSZ;\n_m1$2.elements[10]*=invSZ;\n\nquaternion.setFromRotationMatrix(_m1$2);\n\nscale.x=sx;\nscale.y=sy;\nscale.z=sz;\n\nreturn this;\n\n}},{key:'makePerspective',value:function makePerspective(\n\nleft,right,top,bottom,near,far){\n\nif(far===undefined){\n\nconsole.warn('THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.');\n\n}\n\nvar te=this.elements;\nvar x=2*near/(right-left);\nvar y=2*near/(top-bottom);\n\nvar a=(right+left)/(right-left);\nvar b=(top+bottom)/(top-bottom);\nvar c=-(far+near)/(far-near);\nvar d=-2*far*near/(far-near);\n\nte[0]=x;te[4]=0;te[8]=a;te[12]=0;\nte[1]=0;te[5]=y;te[9]=b;te[13]=0;\nte[2]=0;te[6]=0;te[10]=c;te[14]=d;\nte[3]=0;te[7]=0;te[11]=-1;te[15]=0;\n\nreturn this;\n\n}},{key:'makeOrthographic',value:function makeOrthographic(\n\nleft,right,top,bottom,near,far){\n\nvar te=this.elements;\nvar w=1.0/(right-left);\nvar h=1.0/(top-bottom);\nvar p=1.0/(far-near);\n\nvar x=(right+left)*w;\nvar y=(top+bottom)*h;\nvar z=(far+near)*p;\n\nte[0]=2*w;te[4]=0;te[8]=0;te[12]=-x;\nte[1]=0;te[5]=2*h;te[9]=0;te[13]=-y;\nte[2]=0;te[6]=0;te[10]=-2*p;te[14]=-z;\nte[3]=0;te[7]=0;te[11]=0;te[15]=1;\n\nreturn this;\n\n}},{key:'equals',value:function equals(\n\nmatrix){\n\nvar te=this.elements;\nvar me=matrix.elements;\n\nfor(var i=0;i<16;i++){\n\nif(te[i]!==me[i])return false;\n\n}\n\nreturn true;\n\n}},{key:'fromArray',value:function fromArray(\n\narray){var offset=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;\n\nfor(var i=0;i<16;i++){\n\nthis.elements[i]=array[i+offset];\n\n}\n\nreturn this;\n\n}},{key:'toArray',value:function toArray()\n\n{var array=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];var offset=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;\n\nvar te=this.elements;\n\narray[offset]=te[0];\narray[offset+1]=te[1];\narray[offset+2]=te[2];\narray[offset+3]=te[3];\n\narray[offset+4]=te[4];\narray[offset+5]=te[5];\narray[offset+6]=te[6];\narray[offset+7]=te[7];\n\narray[offset+8]=te[8];\narray[offset+9]=te[9];\narray[offset+10]=te[10];\narray[offset+11]=te[11];\n\narray[offset+12]=te[12];\narray[offset+13]=te[13];\narray[offset+14]=te[14];\narray[offset+15]=te[15];\n\nreturn array;\n\n}}]);return Matrix4;}();\n\n\n\nvar _v1$5=/*@__PURE__*/new Vector3();\nvar _m1$2=/*@__PURE__*/new Matrix4();\nvar _zero=/*@__PURE__*/new Vector3(0,0,0);\nvar _one=/*@__PURE__*/new Vector3(1,1,1);\nvar _x=/*@__PURE__*/new Vector3();\nvar _y=/*@__PURE__*/new Vector3();\nvar _z=/*@__PURE__*/new Vector3();\n\nvar _matrix$1=/*@__PURE__*/new Matrix4();\nvar _quaternion$3=/*@__PURE__*/new Quaternion();var\n\nEuler=function(){\n\nfunction Euler(){var x=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;var y=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var z=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var order=arguments.length>3&&arguments[3]!==undefined?arguments[3]:Euler.DefaultOrder;_classCallCheck(this,Euler);\n\nthis.isEuler=true;\n\nthis._x=x;\nthis._y=y;\nthis._z=z;\nthis._order=order;\n\n}_createClass(Euler,[{key:'set',value:function set(\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nx,y,z){var order=arguments.length>3&&arguments[3]!==undefined?arguments[3]:this._order;\n\nthis._x=x;\nthis._y=y;\nthis._z=z;\nthis._order=order;\n\nthis._onChangeCallback();\n\nreturn this;\n\n}},{key:'clone',value:function clone()\n\n{\n\nreturn new this.constructor(this._x,this._y,this._z,this._order);\n\n}},{key:'copy',value:function copy(\n\neuler){\n\nthis._x=euler._x;\nthis._y=euler._y;\nthis._z=euler._z;\nthis._order=euler._order;\n\nthis._onChangeCallback();\n\nreturn this;\n\n}},{key:'setFromRotationMatrix',value:function setFromRotationMatrix(\n\nm){var order=arguments.length>1&&arguments[1]!==undefined?arguments[1]:this._order;var update=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;\n\n// assumes the upper 3x3 of m is a pure rotation matrix (i.e, unscaled)\n\nvar te=m.elements;\nvar m11=te[0],m12=te[4],m13=te[8];\nvar m21=te[1],m22=te[5],m23=te[9];\nvar m31=te[2],m32=te[6],m33=te[10];\n\nswitch(order){\n\ncase'XYZ':\n\nthis._y=Math.asin(clamp(m13,-1,1));\n\nif(Math.abs(m13)<0.9999999){\n\nthis._x=Math.atan2(-m23,m33);\nthis._z=Math.atan2(-m12,m11);\n\n}else{\n\nthis._x=Math.atan2(m32,m22);\nthis._z=0;\n\n}\n\nbreak;\n\ncase'YXZ':\n\nthis._x=Math.asin(-clamp(m23,-1,1));\n\nif(Math.abs(m23)<0.9999999){\n\nthis._y=Math.atan2(m13,m33);\nthis._z=Math.atan2(m21,m22);\n\n}else{\n\nthis._y=Math.atan2(-m31,m11);\nthis._z=0;\n\n}\n\nbreak;\n\ncase'ZXY':\n\nthis._x=Math.asin(clamp(m32,-1,1));\n\nif(Math.abs(m32)<0.9999999){\n\nthis._y=Math.atan2(-m31,m33);\nthis._z=Math.atan2(-m12,m22);\n\n}else{\n\nthis._y=0;\nthis._z=Math.atan2(m21,m11);\n\n}\n\nbreak;\n\ncase'ZYX':\n\nthis._y=Math.asin(-clamp(m31,-1,1));\n\nif(Math.abs(m31)<0.9999999){\n\nthis._x=Math.atan2(m32,m33);\nthis._z=Math.atan2(m21,m11);\n\n}else{\n\nthis._x=0;\nthis._z=Math.atan2(-m12,m22);\n\n}\n\nbreak;\n\ncase'YZX':\n\nthis._z=Math.asin(clamp(m21,-1,1));\n\nif(Math.abs(m21)<0.9999999){\n\nthis._x=Math.atan2(-m23,m22);\nthis._y=Math.atan2(-m31,m11);\n\n}else{\n\nthis._x=0;\nthis._y=Math.atan2(m13,m33);\n\n}\n\nbreak;\n\ncase'XZY':\n\nthis._z=Math.asin(-clamp(m12,-1,1));\n\nif(Math.abs(m12)<0.9999999){\n\nthis._x=Math.atan2(m32,m22);\nthis._y=Math.atan2(m13,m11);\n\n}else{\n\nthis._x=Math.atan2(-m23,m33);\nthis._y=0;\n\n}\n\nbreak;\n\ndefault:\n\nconsole.warn('THREE.Euler: .setFromRotationMatrix() encountered an unknown order: '+order);}\n\n\n\nthis._order=order;\n\nif(update===true)this._onChangeCallback();\n\nreturn this;\n\n}},{key:'setFromQuaternion',value:function setFromQuaternion(\n\nq,order,update){\n\n_matrix$1.makeRotationFromQuaternion(q);\n\nreturn this.setFromRotationMatrix(_matrix$1,order,update);\n\n}},{key:'setFromVector3',value:function setFromVector3(\n\nv){var order=arguments.length>1&&arguments[1]!==undefined?arguments[1]:this._order;\n\nreturn this.set(v.x,v.y,v.z,order);\n\n}},{key:'reorder',value:function reorder(\n\nnewOrder){\n\n// WARNING: this discards revolution information -bhouston\n\n_quaternion$3.setFromEuler(this);\n\nreturn this.setFromQuaternion(_quaternion$3,newOrder);\n\n}},{key:'equals',value:function equals(\n\neuler){\n\nreturn euler._x===this._x&&euler._y===this._y&&euler._z===this._z&&euler._order===this._order;\n\n}},{key:'fromArray',value:function fromArray(\n\narray){\n\nthis._x=array[0];\nthis._y=array[1];\nthis._z=array[2];\nif(array[3]!==undefined)this._order=array[3];\n\nthis._onChangeCallback();\n\nreturn this;\n\n}},{key:'toArray',value:function toArray()\n\n{var array=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];var offset=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;\n\narray[offset]=this._x;\narray[offset+1]=this._y;\narray[offset+2]=this._z;\narray[offset+3]=this._order;\n\nreturn array;\n\n}},{key:'_onChange',value:function _onChange(\n\ncallback){\n\nthis._onChangeCallback=callback;\n\nreturn this;\n\n}},{key:'_onChangeCallback',value:function _onChangeCallback()\n\n{}},{key:\n\nSymbol.iterator,value:/*#__PURE__*/regeneratorRuntime.mark(function value(){return regeneratorRuntime.wrap(function value$(_context7){while(1){switch(_context7.prev=_context7.next){case 0:_context7.next=2;return(\n\nthis._x);case 2:_context7.next=4;return(\nthis._y);case 4:_context7.next=6;return(\nthis._z);case 6:_context7.next=8;return(\nthis._order);case 8:case'end':return _context7.stop();}}},value,this);})\n\n\n\n// @deprecated since r138, 02cf0df1cb4575d5842fef9c85bb5a89fe020d53\n},{key:'toVector3',value:function toVector3()\n{\n\nconsole.error('THREE.Euler: .toVector3() has been removed. Use Vector3.setFromEuler() instead');\n\n}},{key:'x',get:function get(){return this._x;},set:function set(value){this._x=value;this._onChangeCallback();}},{key:'y',get:function get(){return this._y;},set:function set(value){this._y=value;this._onChangeCallback();}},{key:'z',get:function get(){return this._z;},set:function set(value){this._z=value;this._onChangeCallback();}},{key:'order',get:function get(){return this._order;},set:function set(value){this._order=value;this._onChangeCallback();}}]);return Euler;}();\n\n\n\nEuler.DefaultOrder='XYZ';\nEuler.RotationOrders=['XYZ','YZX','ZXY','XZY','YXZ','ZYX'];var\n\nLayers=function(){\n\nfunction Layers(){_classCallCheck(this,Layers);\n\nthis.mask=1|0;\n\n}_createClass(Layers,[{key:'set',value:function set(\n\nchannel){\n\nthis.mask=(1<<channel|0)>>>0;\n\n}},{key:'enable',value:function enable(\n\nchannel){\n\nthis.mask|=1<<channel|0;\n\n}},{key:'enableAll',value:function enableAll()\n\n{\n\nthis.mask=0xffffffff|0;\n\n}},{key:'toggle',value:function toggle(\n\nchannel){\n\nthis.mask^=1<<channel|0;\n\n}},{key:'disable',value:function disable(\n\nchannel){\n\nthis.mask&=~(1<<channel|0);\n\n}},{key:'disableAll',value:function disableAll()\n\n{\n\nthis.mask=0;\n\n}},{key:'test',value:function test(\n\nlayers){\n\nreturn(this.mask&layers.mask)!==0;\n\n}},{key:'isEnabled',value:function isEnabled(\n\nchannel){\n\nreturn(this.mask&(1<<channel|0))!==0;\n\n}}]);return Layers;}();\n\n\n\nvar _object3DId=0;\n\nvar _v1$4=/*@__PURE__*/new Vector3();\nvar _q1=/*@__PURE__*/new Quaternion();\nvar _m1$1=/*@__PURE__*/new Matrix4();\nvar _target=/*@__PURE__*/new Vector3();\n\nvar _position$3=/*@__PURE__*/new Vector3();\nvar _scale$2=/*@__PURE__*/new Vector3();\nvar _quaternion$2=/*@__PURE__*/new Quaternion();\n\nvar _xAxis=/*@__PURE__*/new Vector3(1,0,0);\nvar _yAxis=/*@__PURE__*/new Vector3(0,1,0);\nvar _zAxis=/*@__PURE__*/new Vector3(0,0,1);\n\nvar _addedEvent={type:'added'};\nvar _removedEvent={type:'removed'};var\n\nObject3D=function(_EventDispatcher3){_inherits(Object3D,_EventDispatcher3);\n\nfunction Object3D(){_classCallCheck(this,Object3D);var _this9=_possibleConstructorReturn(this,(Object3D.__proto__||Object.getPrototypeOf(Object3D)).call(this));\n\n\n\n_this9.isObject3D=true;\n\nObject.defineProperty(_this9,'id',{value:_object3DId++});\n\n_this9.uuid=generateUUID();\n\n_this9.name='';\n_this9.type='Object3D';\n\n_this9.parent=null;\n_this9.children=[];\n\n_this9.up=Object3D.DefaultUp.clone();\n\nvar position=new Vector3();\nvar rotation=new Euler();\nvar quaternion=new Quaternion();\nvar scale=new Vector3(1,1,1);\n\nfunction onRotationChange(){\n\nquaternion.setFromEuler(rotation,false);\n\n}\n\nfunction onQuaternionChange(){\n\nrotation.setFromQuaternion(quaternion,undefined,false);\n\n}\n\nrotation._onChange(onRotationChange);\nquaternion._onChange(onQuaternionChange);\n\nObject.defineProperties(_this9,{\nposition:{\nconfigurable:true,\nenumerable:true,\nvalue:position},\n\nrotation:{\nconfigurable:true,\nenumerable:true,\nvalue:rotation},\n\nquaternion:{\nconfigurable:true,\nenumerable:true,\nvalue:quaternion},\n\nscale:{\nconfigurable:true,\nenumerable:true,\nvalue:scale},\n\nmodelViewMatrix:{\nvalue:new Matrix4()},\n\nnormalMatrix:{\nvalue:new Matrix3()}});\n\n\n\n_this9.matrix=new Matrix4();\n_this9.matrixWorld=new Matrix4();\n\n_this9.matrixAutoUpdate=Object3D.DefaultMatrixAutoUpdate;\n_this9.matrixWorldNeedsUpdate=false;\n\n_this9.layers=new Layers();\n_this9.visible=true;\n\n_this9.castShadow=false;\n_this9.receiveShadow=false;\n\n_this9.frustumCulled=true;\n_this9.renderOrder=0;\n\n_this9.animations=[];\n\n_this9.userData={};return _this9;\n\n}_createClass(Object3D,[{key:'onBeforeRender',value:function onBeforeRender()\n\n/* renderer, scene, camera, geometry, material, group */{}},{key:'onAfterRender',value:function onAfterRender()\n\n/* renderer, scene, camera, geometry, material, group */{}},{key:'applyMatrix4',value:function applyMatrix4(\n\nmatrix){\n\nif(this.matrixAutoUpdate)this.updateMatrix();\n\nthis.matrix.premultiply(matrix);\n\nthis.matrix.decompose(this.position,this.quaternion,this.scale);\n\n}},{key:'applyQuaternion',value:function applyQuaternion(\n\nq){\n\nthis.quaternion.premultiply(q);\n\nreturn this;\n\n}},{key:'setRotationFromAxisAngle',value:function setRotationFromAxisAngle(\n\naxis,angle){\n\n// assumes axis is normalized\n\nthis.quaternion.setFromAxisAngle(axis,angle);\n\n}},{key:'setRotationFromEuler',value:function setRotationFromEuler(\n\neuler){\n\nthis.quaternion.setFromEuler(euler,true);\n\n}},{key:'setRotationFromMatrix',value:function setRotationFromMatrix(\n\nm){\n\n// assumes the upper 3x3 of m is a pure rotation matrix (i.e, unscaled)\n\nthis.quaternion.setFromRotationMatrix(m);\n\n}},{key:'setRotationFromQuaternion',value:function setRotationFromQuaternion(\n\nq){\n\n// assumes q is normalized\n\nthis.quaternion.copy(q);\n\n}},{key:'rotateOnAxis',value:function rotateOnAxis(\n\naxis,angle){\n\n// rotate object on axis in object space\n// axis is assumed to be normalized\n\n_q1.setFromAxisAngle(axis,angle);\n\nthis.quaternion.multiply(_q1);\n\nreturn this;\n\n}},{key:'rotateOnWorldAxis',value:function rotateOnWorldAxis(\n\naxis,angle){\n\n// rotate object on axis in world space\n// axis is assumed to be normalized\n// method assumes no rotated parent\n\n_q1.setFromAxisAngle(axis,angle);\n\nthis.quaternion.premultiply(_q1);\n\nreturn this;\n\n}},{key:'rotateX',value:function rotateX(\n\nangle){\n\nreturn this.rotateOnAxis(_xAxis,angle);\n\n}},{key:'rotateY',value:function rotateY(\n\nangle){\n\nreturn this.rotateOnAxis(_yAxis,angle);\n\n}},{key:'rotateZ',value:function rotateZ(\n\nangle){\n\nreturn this.rotateOnAxis(_zAxis,angle);\n\n}},{key:'translateOnAxis',value:function translateOnAxis(\n\naxis,distance){\n\n// translate object by distance along axis in object space\n// axis is assumed to be normalized\n\n_v1$4.copy(axis).applyQuaternion(this.quaternion);\n\nthis.position.add(_v1$4.multiplyScalar(distance));\n\nreturn this;\n\n}},{key:'translateX',value:function translateX(\n\ndistance){\n\nreturn this.translateOnAxis(_xAxis,distance);\n\n}},{key:'translateY',value:function translateY(\n\ndistance){\n\nreturn this.translateOnAxis(_yAxis,distance);\n\n}},{key:'translateZ',value:function translateZ(\n\ndistance){\n\nreturn this.translateOnAxis(_zAxis,distance);\n\n}},{key:'localToWorld',value:function localToWorld(\n\nvector){\n\nreturn vector.applyMatrix4(this.matrixWorld);\n\n}},{key:'worldToLocal',value:function worldToLocal(\n\nvector){\n\nreturn vector.applyMatrix4(_m1$1.copy(this.matrixWorld).invert());\n\n}},{key:'lookAt',value:function lookAt(\n\nx,y,z){\n\n// This method does not support objects having non-uniformly-scaled parent(s)\n\nif(x.isVector3){\n\n_target.copy(x);\n\n}else{\n\n_target.set(x,y,z);\n\n}\n\nvar parent=this.parent;\n\nthis.updateWorldMatrix(true,false);\n\n_position$3.setFromMatrixPosition(this.matrixWorld);\n\nif(this.isCamera||this.isLight){\n\n_m1$1.lookAt(_position$3,_target,this.up);\n\n}else{\n\n_m1$1.lookAt(_target,_position$3,this.up);\n\n}\n\nthis.quaternion.setFromRotationMatrix(_m1$1);\n\nif(parent){\n\n_m1$1.extractRotation(parent.matrixWorld);\n_q1.setFromRotationMatrix(_m1$1);\nthis.quaternion.premultiply(_q1.invert());\n\n}\n\n}},{key:'add',value:function add(\n\nobject){\n\nif(arguments.length>1){\n\nfor(var i=0;i<arguments.length;i++){\n\nthis.add(arguments[i]);\n\n}\n\nreturn this;\n\n}\n\nif(object===this){\n\nconsole.error('THREE.Object3D.add: object can\\'t be added as a child of itself.',object);\nreturn this;\n\n}\n\nif(object&&object.isObject3D){\n\nif(object.parent!==null){\n\nobject.parent.remove(object);\n\n}\n\nobject.parent=this;\nthis.children.push(object);\n\nobject.dispatchEvent(_addedEvent);\n\n}else{\n\nconsole.error('THREE.Object3D.add: object not an instance of THREE.Object3D.',object);\n\n}\n\nreturn this;\n\n}},{key:'remove',value:function remove(\n\nobject){\n\nif(arguments.length>1){\n\nfor(var i=0;i<arguments.length;i++){\n\nthis.remove(arguments[i]);\n\n}\n\nreturn this;\n\n}\n\nvar index=this.children.indexOf(object);\n\nif(index!==-1){\n\nobject.parent=null;\nthis.children.splice(index,1);\n\nobject.dispatchEvent(_removedEvent);\n\n}\n\nreturn this;\n\n}},{key:'removeFromParent',value:function removeFromParent()\n\n{\n\nvar parent=this.parent;\n\nif(parent!==null){\n\nparent.remove(this);\n\n}\n\nreturn this;\n\n}},{key:'clear',value:function clear()\n\n{\n\nfor(var i=0;i<this.children.length;i++){\n\nvar object=this.children[i];\n\nobject.parent=null;\n\nobject.dispatchEvent(_removedEvent);\n\n}\n\nthis.children.length=0;\n\nreturn this;\n\n\n}},{key:'attach',value:function attach(\n\nobject){\n\n// adds object as a child of this, while maintaining the object's world transform\n\n// Note: This method does not support scene graphs having non-uniformly-scaled nodes(s)\n\nthis.updateWorldMatrix(true,false);\n\n_m1$1.copy(this.matrixWorld).invert();\n\nif(object.parent!==null){\n\nobject.parent.updateWorldMatrix(true,false);\n\n_m1$1.multiply(object.parent.matrixWorld);\n\n}\n\nobject.applyMatrix4(_m1$1);\n\nthis.add(object);\n\nobject.updateWorldMatrix(false,true);\n\nreturn this;\n\n}},{key:'getObjectById',value:function getObjectById(\n\nid){\n\nreturn this.getObjectByProperty('id',id);\n\n}},{key:'getObjectByName',value:function getObjectByName(\n\nname){\n\nreturn this.getObjectByProperty('name',name);\n\n}},{key:'getObjectByProperty',value:function getObjectByProperty(\n\nname,value){\n\nif(this[name]===value)return this;\n\nfor(var i=0,l=this.children.length;i<l;i++){\n\nvar child=this.children[i];\nvar object=child.getObjectByProperty(name,value);\n\nif(object!==undefined){\n\nreturn object;\n\n}\n\n}\n\nreturn undefined;\n\n}},{key:'getWorldPosition',value:function getWorldPosition(\n\ntarget){\n\nthis.updateWorldMatrix(true,false);\n\nreturn target.setFromMatrixPosition(this.matrixWorld);\n\n}},{key:'getWorldQuaternion',value:function getWorldQuaternion(\n\ntarget){\n\nthis.updateWorldMatrix(true,false);\n\nthis.matrixWorld.decompose(_position$3,target,_scale$2);\n\nreturn target;\n\n}},{key:'getWorldScale',value:function getWorldScale(\n\ntarget){\n\nthis.updateWorldMatrix(true,false);\n\nthis.matrixWorld.decompose(_position$3,_quaternion$2,target);\n\nreturn target;\n\n}},{key:'getWorldDirection',value:function getWorldDirection(\n\ntarget){\n\nthis.updateWorldMatrix(true,false);\n\nvar e=this.matrixWorld.elements;\n\nreturn target.set(e[8],e[9],e[10]).normalize();\n\n}},{key:'raycast',value:function raycast()\n\n/* raycaster, intersects */{}},{key:'traverse',value:function traverse(\n\ncallback){\n\ncallback(this);\n\nvar children=this.children;\n\nfor(var i=0,l=children.length;i<l;i++){\n\nchildren[i].traverse(callback);\n\n}\n\n}},{key:'traverseVisible',value:function traverseVisible(\n\ncallback){\n\nif(this.visible===false)return;\n\ncallback(this);\n\nvar children=this.children;\n\nfor(var i=0,l=children.length;i<l;i++){\n\nchildren[i].traverseVisible(callback);\n\n}\n\n}},{key:'traverseAncestors',value:function traverseAncestors(\n\ncallback){\n\nvar parent=this.parent;\n\nif(parent!==null){\n\ncallback(parent);\n\nparent.traverseAncestors(callback);\n\n}\n\n}},{key:'updateMatrix',value:function updateMatrix()\n\n{\n\nthis.matrix.compose(this.position,this.quaternion,this.scale);\n\nthis.matrixWorldNeedsUpdate=true;\n\n}},{key:'updateMatrixWorld',value:function updateMatrixWorld(\n\nforce){\n\nif(this.matrixAutoUpdate)this.updateMatrix();\n\nif(this.matrixWorldNeedsUpdate||force){\n\nif(this.parent===null){\n\nthis.matrixWorld.copy(this.matrix);\n\n}else{\n\nthis.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix);\n\n}\n\nthis.matrixWorldNeedsUpdate=false;\n\nforce=true;\n\n}\n\n// update children\n\nvar children=this.children;\n\nfor(var i=0,l=children.length;i<l;i++){\n\nchildren[i].updateMatrixWorld(force);\n\n}\n\n}},{key:'updateWorldMatrix',value:function updateWorldMatrix(\n\nupdateParents,updateChildren){\n\nvar parent=this.parent;\n\nif(updateParents===true&&parent!==null){\n\nparent.updateWorldMatrix(true,false);\n\n}\n\nif(this.matrixAutoUpdate)this.updateMatrix();\n\nif(this.parent===null){\n\nthis.matrixWorld.copy(this.matrix);\n\n}else{\n\nthis.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix);\n\n}\n\n// update children\n\nif(updateChildren===true){\n\nvar children=this.children;\n\nfor(var i=0,l=children.length;i<l;i++){\n\nchildren[i].updateWorldMatrix(false,true);\n\n}\n\n}\n\n}},{key:'toJSON',value:function toJSON(\n\nmeta){\n\n// meta is a string when called from JSON.stringify\nvar isRootObject=meta===undefined||typeof meta==='string';\n\nvar output={};\n\n// meta is a hash used to collect geometries, materials.\n// not providing it implies that this is the root object\n// being serialized.\nif(isRootObject){\n\n// initialize meta obj\nmeta={\ngeometries:{},\nmaterials:{},\ntextures:{},\nimages:{},\nshapes:{},\nskeletons:{},\nanimations:{},\nnodes:{}};\n\n\noutput.metadata={\nversion:4.5,\ntype:'Object',\ngenerator:'Object3D.toJSON'};\n\n\n}\n\n// standard Object3D serialization\n\nvar object={};\n\nobject.uuid=this.uuid;\nobject.type=this.type;\n\nif(this.name!=='')object.name=this.name;\nif(this.castShadow===true)object.castShadow=true;\nif(this.receiveShadow===true)object.receiveShadow=true;\nif(this.visible===false)object.visible=false;\nif(this.frustumCulled===false)object.frustumCulled=false;\nif(this.renderOrder!==0)object.renderOrder=this.renderOrder;\nif(JSON.stringify(this.userData)!=='{}')object.userData=this.userData;\n\nobject.layers=this.layers.mask;\nobject.matrix=this.matrix.toArray();\n\nif(this.matrixAutoUpdate===false)object.matrixAutoUpdate=false;\n\n// object specific properties\n\nif(this.isInstancedMesh){\n\nobject.type='InstancedMesh';\nobject.count=this.count;\nobject.instanceMatrix=this.instanceMatrix.toJSON();\nif(this.instanceColor!==null)object.instanceColor=this.instanceColor.toJSON();\n\n}\n\n//\n\nfunction serialize(library,element){\n\nif(library[element.uuid]===undefined){\n\nlibrary[element.uuid]=element.toJSON(meta);\n\n}\n\nreturn element.uuid;\n\n}\n\nif(this.isScene){\n\nif(this.background){\n\nif(this.background.isColor){\n\nobject.background=this.background.toJSON();\n\n}else if(this.background.isTexture){\n\nobject.background=this.background.toJSON(meta).uuid;\n\n}\n\n}\n\nif(this.environment&&this.environment.isTexture){\n\nobject.environment=this.environment.toJSON(meta).uuid;\n\n}\n\n}else if(this.isMesh||this.isLine||this.isPoints){\n\nobject.geometry=serialize(meta.geometries,this.geometry);\n\nvar parameters=this.geometry.parameters;\n\nif(parameters!==undefined&&parameters.shapes!==undefined){\n\nvar shapes=parameters.shapes;\n\nif(Array.isArray(shapes)){\n\nfor(var i=0,l=shapes.length;i<l;i++){\n\nvar shape=shapes[i];\n\nserialize(meta.shapes,shape);\n\n}\n\n}else{\n\nserialize(meta.shapes,shapes);\n\n}\n\n}\n\n}\n\nif(this.isSkinnedMesh){\n\nobject.bindMode=this.bindMode;\nobject.bindMatrix=this.bindMatrix.toArray();\n\nif(this.skeleton!==undefined){\n\nserialize(meta.skeletons,this.skeleton);\n\nobject.skeleton=this.skeleton.uuid;\n\n}\n\n}\n\nif(this.material!==undefined){\n\nif(Array.isArray(this.material)){\n\nvar uuids=[];\n\nfor(var _i3=0,_l2=this.material.length;_i3<_l2;_i3++){\n\nuuids.push(serialize(meta.materials,this.material[_i3]));\n\n}\n\nobject.material=uuids;\n\n}else{\n\nobject.material=serialize(meta.materials,this.material);\n\n}\n\n}\n\n//\n\nif(this.children.length>0){\n\nobject.children=[];\n\nfor(var _i4=0;_i4<this.children.length;_i4++){\n\nobject.children.push(this.children[_i4].toJSON(meta).object);\n\n}\n\n}\n\n//\n\nif(this.animations.length>0){\n\nobject.animations=[];\n\nfor(var _i5=0;_i5<this.animations.length;_i5++){\n\nvar animation=this.animations[_i5];\n\nobject.animations.push(serialize(meta.animations,animation));\n\n}\n\n}\n\nif(isRootObject){\n\nvar geometries=extractFromCache(meta.geometries);\nvar materials=extractFromCache(meta.materials);\nvar textures=extractFromCache(meta.textures);\nvar images=extractFromCache(meta.images);\nvar _shapes=extractFromCache(meta.shapes);\nvar skeletons=extractFromCache(meta.skeletons);\nvar animations=extractFromCache(meta.animations);\nvar nodes=extractFromCache(meta.nodes);\n\nif(geometries.length>0)output.geometries=geometries;\nif(materials.length>0)output.materials=materials;\nif(textures.length>0)output.textures=textures;\nif(images.length>0)output.images=images;\nif(_shapes.length>0)output.shapes=_shapes;\nif(skeletons.length>0)output.skeletons=skeletons;\nif(animations.length>0)output.animations=animations;\nif(nodes.length>0)output.nodes=nodes;\n\n}\n\noutput.object=object;\n\nreturn output;\n\n// extract data from the cache hash\n// remove metadata on each item\n// and return as array\nfunction extractFromCache(cache){\n\nvar values=[];\nfor(var key in cache){\n\nvar data=cache[key];\ndelete data.metadata;\nvalues.push(data);\n\n}\n\nreturn values;\n\n}\n\n}},{key:'clone',value:function clone(\n\nrecursive){\n\nreturn new this.constructor().copy(this,recursive);\n\n}},{key:'copy',value:function copy(\n\nsource){var recursive=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;\n\nthis.name=source.name;\n\nthis.up.copy(source.up);\n\nthis.position.copy(source.position);\nthis.rotation.order=source.rotation.order;\nthis.quaternion.copy(source.quaternion);\nthis.scale.copy(source.scale);\n\nthis.matrix.copy(source.matrix);\nthis.matrixWorld.copy(source.matrixWorld);\n\nthis.matrixAutoUpdate=source.matrixAutoUpdate;\nthis.matrixWorldNeedsUpdate=source.matrixWorldNeedsUpdate;\n\nthis.layers.mask=source.layers.mask;\nthis.visible=source.visible;\n\nthis.castShadow=source.castShadow;\nthis.receiveShadow=source.receiveShadow;\n\nthis.frustumCulled=source.frustumCulled;\nthis.renderOrder=source.renderOrder;\n\nthis.userData=JSON.parse(JSON.stringify(source.userData));\n\nif(recursive===true){\n\nfor(var i=0;i<source.children.length;i++){\n\nvar child=source.children[i];\nthis.add(child.clone());\n\n}\n\n}\n\nreturn this;\n\n}}]);return Object3D;}(EventDispatcher);\n\n\n\nObject3D.DefaultUp=/*@__PURE__*/new Vector3(0,1,0);\nObject3D.DefaultMatrixAutoUpdate=true;\n\nvar _v0$1=/*@__PURE__*/new Vector3();\nvar _v1$3=/*@__PURE__*/new Vector3();\nvar _v2$2=/*@__PURE__*/new Vector3();\nvar _v3$1=/*@__PURE__*/new Vector3();\n\nvar _vab=/*@__PURE__*/new Vector3();\nvar _vac=/*@__PURE__*/new Vector3();\nvar _vbc=/*@__PURE__*/new Vector3();\nvar _vap=/*@__PURE__*/new Vector3();\nvar _vbp=/*@__PURE__*/new Vector3();\nvar _vcp=/*@__PURE__*/new Vector3();var\n\nTriangle=function(){\n\nfunction Triangle(){var a=arguments.length>0&&arguments[0]!==undefined?arguments[0]:new Vector3();var b=arguments.length>1&&arguments[1]!==undefined?arguments[1]:new Vector3();var c=arguments.length>2&&arguments[2]!==undefined?arguments[2]:new Vector3();_classCallCheck(this,Triangle);\n\nthis.a=a;\nthis.b=b;\nthis.c=c;\n\n}_createClass(Triangle,[{key:'set',value:function set(\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\na,b,c){\n\nthis.a.copy(a);\nthis.b.copy(b);\nthis.c.copy(c);\n\nreturn this;\n\n}},{key:'setFromPointsAndIndices',value:function setFromPointsAndIndices(\n\npoints,i0,i1,i2){\n\nthis.a.copy(points[i0]);\nthis.b.copy(points[i1]);\nthis.c.copy(points[i2]);\n\nreturn this;\n\n}},{key:'setFromAttributeAndIndices',value:function setFromAttributeAndIndices(\n\nattribute,i0,i1,i2){\n\nthis.a.fromBufferAttribute(attribute,i0);\nthis.b.fromBufferAttribute(attribute,i1);\nthis.c.fromBufferAttribute(attribute,i2);\n\nreturn this;\n\n}},{key:'clone',value:function clone()\n\n{\n\nreturn new this.constructor().copy(this);\n\n}},{key:'copy',value:function copy(\n\ntriangle){\n\nthis.a.copy(triangle.a);\nthis.b.copy(triangle.b);\nthis.c.copy(triangle.c);\n\nreturn this;\n\n}},{key:'getArea',value:function getArea()\n\n{\n\n_v0$1.subVectors(this.c,this.b);\n_v1$3.subVectors(this.a,this.b);\n\nreturn _v0$1.cross(_v1$3).length()*0.5;\n\n}},{key:'getMidpoint',value:function getMidpoint(\n\ntarget){\n\nreturn target.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3);\n\n}},{key:'getNormal',value:function getNormal(\n\ntarget){\n\nreturn Triangle.getNormal(this.a,this.b,this.c,target);\n\n}},{key:'getPlane',value:function getPlane(\n\ntarget){\n\nreturn target.setFromCoplanarPoints(this.a,this.b,this.c);\n\n}},{key:'getBarycoord',value:function getBarycoord(\n\npoint,target){\n\nreturn Triangle.getBarycoord(point,this.a,this.b,this.c,target);\n\n}},{key:'getUV',value:function getUV(\n\npoint,uv1,uv2,uv3,target){\n\nreturn Triangle.getUV(point,this.a,this.b,this.c,uv1,uv2,uv3,target);\n\n}},{key:'containsPoint',value:function containsPoint(\n\npoint){\n\nreturn Triangle.containsPoint(point,this.a,this.b,this.c);\n\n}},{key:'isFrontFacing',value:function isFrontFacing(\n\ndirection){\n\nreturn Triangle.isFrontFacing(this.a,this.b,this.c,direction);\n\n}},{key:'intersectsBox',value:function intersectsBox(\n\nbox){\n\nreturn box.intersectsTriangle(this);\n\n}},{key:'closestPointToPoint',value:function closestPointToPoint(\n\np,target){\n\nvar a=this.a,b=this.b,c=this.c;\nvar v=void 0,w=void 0;\n\n// algorithm thanks to Real-Time Collision Detection by Christer Ericson,\n// published by Morgan Kaufmann Publishers, (c) 2005 Elsevier Inc.,\n// under the accompanying license; see chapter 5.1.5 for detailed explanation.\n// basically, we're distinguishing which of the voronoi regions of the triangle\n// the point lies in with the minimum amount of redundant computation.\n\n_vab.subVectors(b,a);\n_vac.subVectors(c,a);\n_vap.subVectors(p,a);\nvar d1=_vab.dot(_vap);\nvar d2=_vac.dot(_vap);\nif(d1<=0&&d2<=0){\n\n// vertex region of A; barycentric coords (1, 0, 0)\nreturn target.copy(a);\n\n}\n\n_vbp.subVectors(p,b);\nvar d3=_vab.dot(_vbp);\nvar d4=_vac.dot(_vbp);\nif(d3>=0&&d4<=d3){\n\n// vertex region of B; barycentric coords (0, 1, 0)\nreturn target.copy(b);\n\n}\n\nvar vc=d1*d4-d3*d2;\nif(vc<=0&&d1>=0&&d3<=0){\n\nv=d1/(d1-d3);\n// edge region of AB; barycentric coords (1-v, v, 0)\nreturn target.copy(a).addScaledVector(_vab,v);\n\n}\n\n_vcp.subVectors(p,c);\nvar d5=_vab.dot(_vcp);\nvar d6=_vac.dot(_vcp);\nif(d6>=0&&d5<=d6){\n\n// vertex region of C; barycentric coords (0, 0, 1)\nreturn target.copy(c);\n\n}\n\nvar vb=d5*d2-d1*d6;\nif(vb<=0&&d2>=0&&d6<=0){\n\nw=d2/(d2-d6);\n// edge region of AC; barycentric coords (1-w, 0, w)\nreturn target.copy(a).addScaledVector(_vac,w);\n\n}\n\nvar va=d3*d6-d5*d4;\nif(va<=0&&d4-d3>=0&&d5-d6>=0){\n\n_vbc.subVectors(c,b);\nw=(d4-d3)/(d4-d3+(d5-d6));\n// edge region of BC; barycentric coords (0, 1-w, w)\nreturn target.copy(b).addScaledVector(_vbc,w);// edge region of BC\n\n}\n\n// face region\nvar denom=1/(va+vb+vc);\n// u = va * denom\nv=vb*denom;\nw=vc*denom;\n\nreturn target.copy(a).addScaledVector(_vab,v).addScaledVector(_vac,w);\n\n}},{key:'equals',value:function equals(\n\ntriangle){\n\nreturn triangle.a.equals(this.a)&&triangle.b.equals(this.b)&&triangle.c.equals(this.c);\n\n}}],[{key:'getNormal',value:function getNormal(a,b,c,target){target.subVectors(c,b);_v0$1.subVectors(a,b);target.cross(_v0$1);var targetLengthSq=target.lengthSq();if(targetLengthSq>0){return target.multiplyScalar(1/Math.sqrt(targetLengthSq));}return target.set(0,0,0);}// static/instance method to calculate barycentric coordinates\n// based on: http://www.blackpawn.com/texts/pointinpoly/default.html\n},{key:'getBarycoord',value:function getBarycoord(point,a,b,c,target){_v0$1.subVectors(c,a);_v1$3.subVectors(b,a);_v2$2.subVectors(point,a);var dot00=_v0$1.dot(_v0$1);var dot01=_v0$1.dot(_v1$3);var dot02=_v0$1.dot(_v2$2);var dot11=_v1$3.dot(_v1$3);var dot12=_v1$3.dot(_v2$2);var denom=dot00*dot11-dot01*dot01;// collinear or singular triangle\nif(denom===0){// arbitrary location outside of triangle?\n// not sure if this is the best idea, maybe should be returning undefined\nreturn target.set(-2,-1,-1);}var invDenom=1/denom;var u=(dot11*dot02-dot01*dot12)*invDenom;var v=(dot00*dot12-dot01*dot02)*invDenom;// barycentric coordinates must always sum to 1\nreturn target.set(1-u-v,v,u);}},{key:'containsPoint',value:function containsPoint(point,a,b,c){this.getBarycoord(point,a,b,c,_v3$1);return _v3$1.x>=0&&_v3$1.y>=0&&_v3$1.x+_v3$1.y<=1;}},{key:'getUV',value:function getUV(point,p1,p2,p3,uv1,uv2,uv3,target){this.getBarycoord(point,p1,p2,p3,_v3$1);target.set(0,0);target.addScaledVector(uv1,_v3$1.x);target.addScaledVector(uv2,_v3$1.y);target.addScaledVector(uv3,_v3$1.z);return target;}},{key:'isFrontFacing',value:function isFrontFacing(a,b,c,direction){_v0$1.subVectors(c,b);_v1$3.subVectors(a,b);// strictly front facing\nreturn _v0$1.cross(_v1$3).dot(direction)<0?true:false;}}]);return Triangle;}();var materialId=0;var Material=function(_EventDispatcher4){_inherits(Material,_EventDispatcher4);\nfunction Material(){_classCallCheck(this,Material);var _this10=_possibleConstructorReturn(this,(Material.__proto__||Object.getPrototypeOf(Material)).call(this));\n\n\n\n_this10.isMaterial=true;\n\nObject.defineProperty(_this10,'id',{value:materialId++});\n\n_this10.uuid=generateUUID();\n\n_this10.name='';\n_this10.type='Material';\n\n_this10.blending=NormalBlending;\n_this10.side=FrontSide;\n_this10.vertexColors=false;\n\n_this10.opacity=1;\n_this10.transparent=false;\n\n_this10.blendSrc=SrcAlphaFactor;\n_this10.blendDst=OneMinusSrcAlphaFactor;\n_this10.blendEquation=AddEquation;\n_this10.blendSrcAlpha=null;\n_this10.blendDstAlpha=null;\n_this10.blendEquationAlpha=null;\n\n_this10.depthFunc=LessEqualDepth;\n_this10.depthTest=true;\n_this10.depthWrite=true;\n\n_this10.stencilWriteMask=0xff;\n_this10.stencilFunc=AlwaysStencilFunc;\n_this10.stencilRef=0;\n_this10.stencilFuncMask=0xff;\n_this10.stencilFail=KeepStencilOp;\n_this10.stencilZFail=KeepStencilOp;\n_this10.stencilZPass=KeepStencilOp;\n_this10.stencilWrite=false;\n\n_this10.clippingPlanes=null;\n_this10.clipIntersection=false;\n_this10.clipShadows=false;\n\n_this10.shadowSide=null;\n\n_this10.colorWrite=true;\n\n_this10.precision=null;// override the renderer's default precision for this material\n\n_this10.polygonOffset=false;\n_this10.polygonOffsetFactor=0;\n_this10.polygonOffsetUnits=0;\n\n_this10.dithering=false;\n\n_this10.alphaToCoverage=false;\n_this10.premultipliedAlpha=false;\n\n_this10.visible=true;\n\n_this10.toneMapped=true;\n\n_this10.userData={};\n\n_this10.version=0;\n\n_this10._alphaTest=0;return _this10;\n\n}_createClass(Material,[{key:'onBuild',value:function onBuild()\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n/* shaderobject, renderer */{}},{key:'onBeforeRender',value:function onBeforeRender()\n\n/* renderer, scene, camera, geometry, object, group */{}},{key:'onBeforeCompile',value:function onBeforeCompile()\n\n/* shaderobject, renderer */{}},{key:'customProgramCacheKey',value:function customProgramCacheKey()\n\n{\n\nreturn this.onBeforeCompile.toString();\n\n}},{key:'setValues',value:function setValues(\n\nvalues){\n\nif(values===undefined)return;\n\nfor(var key in values){\n\nvar newValue=values[key];\n\nif(newValue===undefined){\n\nconsole.warn('THREE.Material: \\''+key+'\\' parameter is undefined.');\ncontinue;\n\n}\n\n// for backward compatibility if shading is set in the constructor\nif(key==='shading'){\n\nconsole.warn('THREE.'+this.type+': .shading has been removed. Use the boolean .flatShading instead.');\nthis.flatShading=newValue===FlatShading?true:false;\ncontinue;\n\n}\n\nvar currentValue=this[key];\n\nif(currentValue===undefined){\n\nconsole.warn('THREE.'+this.type+': \\''+key+'\\' is not a property of this material.');\ncontinue;\n\n}\n\nif(currentValue&&currentValue.isColor){\n\ncurrentValue.set(newValue);\n\n}else if(currentValue&&currentValue.isVector3&&newValue&&newValue.isVector3){\n\ncurrentValue.copy(newValue);\n\n}else{\n\nthis[key]=newValue;\n\n}\n\n}\n\n}},{key:'toJSON',value:function toJSON(\n\nmeta){\n\nvar isRootObject=meta===undefined||typeof meta==='string';\n\nif(isRootObject){\n\nmeta={\ntextures:{},\nimages:{}};\n\n\n}\n\nvar data={\nmetadata:{\nversion:4.5,\ntype:'Material',\ngenerator:'Material.toJSON'}};\n\n\n\n// standard Material serialization\ndata.uuid=this.uuid;\ndata.type=this.type;\n\nif(this.name!=='')data.name=this.name;\n\nif(this.color&&this.color.isColor)data.color=this.color.getHex();\n\nif(this.roughness!==undefined)data.roughness=this.roughness;\nif(this.metalness!==undefined)data.metalness=this.metalness;\n\nif(this.sheen!==undefined)data.sheen=this.sheen;\nif(this.sheenColor&&this.sheenColor.isColor)data.sheenColor=this.sheenColor.getHex();\nif(this.sheenRoughness!==undefined)data.sheenRoughness=this.sheenRoughness;\nif(this.emissive&&this.emissive.isColor)data.emissive=this.emissive.getHex();\nif(this.emissiveIntensity&&this.emissiveIntensity!==1)data.emissiveIntensity=this.emissiveIntensity;\n\nif(this.specular&&this.specular.isColor)data.specular=this.specular.getHex();\nif(this.specularIntensity!==undefined)data.specularIntensity=this.specularIntensity;\nif(this.specularColor&&this.specularColor.isColor)data.specularColor=this.specularColor.getHex();\nif(this.shininess!==undefined)data.shininess=this.shininess;\nif(this.clearcoat!==undefined)data.clearcoat=this.clearcoat;\nif(this.clearcoatRoughness!==undefined)data.clearcoatRoughness=this.clearcoatRoughness;\n\nif(this.clearcoatMap&&this.clearcoatMap.isTexture){\n\ndata.clearcoatMap=this.clearcoatMap.toJSON(meta).uuid;\n\n}\n\nif(this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture){\n\ndata.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(meta).uuid;\n\n}\n\nif(this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture){\n\ndata.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(meta).uuid;\ndata.clearcoatNormalScale=this.clearcoatNormalScale.toArray();\n\n}\n\nif(this.iridescence!==undefined)data.iridescence=this.iridescence;\nif(this.iridescenceIOR!==undefined)data.iridescenceIOR=this.iridescenceIOR;\nif(this.iridescenceThicknessRange!==undefined)data.iridescenceThicknessRange=this.iridescenceThicknessRange;\n\nif(this.iridescenceMap&&this.iridescenceMap.isTexture){\n\ndata.iridescenceMap=this.iridescenceMap.toJSON(meta).uuid;\n\n}\n\nif(this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture){\n\ndata.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(meta).uuid;\n\n}\n\nif(this.map&&this.map.isTexture)data.map=this.map.toJSON(meta).uuid;\nif(this.matcap&&this.matcap.isTexture)data.matcap=this.matcap.toJSON(meta).uuid;\nif(this.alphaMap&&this.alphaMap.isTexture)data.alphaMap=this.alphaMap.toJSON(meta).uuid;\n\nif(this.lightMap&&this.lightMap.isTexture){\n\ndata.lightMap=this.lightMap.toJSON(meta).uuid;\ndata.lightMapIntensity=this.lightMapIntensity;\n\n}\n\nif(this.aoMap&&this.aoMap.isTexture){\n\ndata.aoMap=this.aoMap.toJSON(meta).uuid;\ndata.aoMapIntensity=this.aoMapIntensity;\n\n}\n\nif(this.bumpMap&&this.bumpMap.isTexture){\n\ndata.bumpMap=this.bumpMap.toJSON(meta).uuid;\ndata.bumpScale=this.bumpScale;\n\n}\n\nif(this.normalMap&&this.normalMap.isTexture){\n\ndata.normalMap=this.normalMap.toJSON(meta).uuid;\ndata.normalMapType=this.normalMapType;\ndata.normalScale=this.normalScale.toArray();\n\n}\n\nif(this.displacementMap&&this.displacementMap.isTexture){\n\ndata.displacementMap=this.displacementMap.toJSON(meta).uuid;\ndata.displacementScale=this.displacementScale;\ndata.displacementBias=this.displacementBias;\n\n}\n\nif(this.roughnessMap&&this.roughnessMap.isTexture)data.roughnessMap=this.roughnessMap.toJSON(meta).uuid;\nif(this.metalnessMap&&this.metalnessMap.isTexture)data.metalnessMap=this.metalnessMap.toJSON(meta).uuid;\n\nif(this.emissiveMap&&this.emissiveMap.isTexture)data.emissiveMap=this.emissiveMap.toJSON(meta).uuid;\nif(this.specularMap&&this.specularMap.isTexture)data.specularMap=this.specularMap.toJSON(meta).uuid;\nif(this.specularIntensityMap&&this.specularIntensityMap.isTexture)data.specularIntensityMap=this.specularIntensityMap.toJSON(meta).uuid;\nif(this.specularColorMap&&this.specularColorMap.isTexture)data.specularColorMap=this.specularColorMap.toJSON(meta).uuid;\n\nif(this.envMap&&this.envMap.isTexture){\n\ndata.envMap=this.envMap.toJSON(meta).uuid;\n\nif(this.combine!==undefined)data.combine=this.combine;\n\n}\n\nif(this.envMapIntensity!==undefined)data.envMapIntensity=this.envMapIntensity;\nif(this.reflectivity!==undefined)data.reflectivity=this.reflectivity;\nif(this.refractionRatio!==undefined)data.refractionRatio=this.refractionRatio;\n\nif(this.gradientMap&&this.gradientMap.isTexture){\n\ndata.gradientMap=this.gradientMap.toJSON(meta).uuid;\n\n}\n\nif(this.transmission!==undefined)data.transmission=this.transmission;\nif(this.transmissionMap&&this.transmissionMap.isTexture)data.transmissionMap=this.transmissionMap.toJSON(meta).uuid;\nif(this.thickness!==undefined)data.thickness=this.thickness;\nif(this.thicknessMap&&this.thicknessMap.isTexture)data.thicknessMap=this.thicknessMap.toJSON(meta).uuid;\nif(this.attenuationDistance!==undefined)data.attenuationDistance=this.attenuationDistance;\nif(this.attenuationColor!==undefined)data.attenuationColor=this.attenuationColor.getHex();\n\nif(this.size!==undefined)data.size=this.size;\nif(this.shadowSide!==null)data.shadowSide=this.shadowSide;\nif(this.sizeAttenuation!==undefined)data.sizeAttenuation=this.sizeAttenuation;\n\nif(this.blending!==NormalBlending)data.blending=this.blending;\nif(this.side!==FrontSide)data.side=this.side;\nif(this.vertexColors)data.vertexColors=true;\n\nif(this.opacity<1)data.opacity=this.opacity;\nif(this.transparent===true)data.transparent=this.transparent;\n\ndata.depthFunc=this.depthFunc;\ndata.depthTest=this.depthTest;\ndata.depthWrite=this.depthWrite;\ndata.colorWrite=this.colorWrite;\n\ndata.stencilWrite=this.stencilWrite;\ndata.stencilWriteMask=this.stencilWriteMask;\ndata.stencilFunc=this.stencilFunc;\ndata.stencilRef=this.stencilRef;\ndata.stencilFuncMask=this.stencilFuncMask;\ndata.stencilFail=this.stencilFail;\ndata.stencilZFail=this.stencilZFail;\ndata.stencilZPass=this.stencilZPass;\n\n// rotation (SpriteMaterial)\nif(this.rotation!==undefined&&this.rotation!==0)data.rotation=this.rotation;\n\nif(this.polygonOffset===true)data.polygonOffset=true;\nif(this.polygonOffsetFactor!==0)data.polygonOffsetFactor=this.polygonOffsetFactor;\nif(this.polygonOffsetUnits!==0)data.polygonOffsetUnits=this.polygonOffsetUnits;\n\nif(this.linewidth!==undefined&&this.linewidth!==1)data.linewidth=this.linewidth;\nif(this.dashSize!==undefined)data.dashSize=this.dashSize;\nif(this.gapSize!==undefined)data.gapSize=this.gapSize;\nif(this.scale!==undefined)data.scale=this.scale;\n\nif(this.dithering===true)data.dithering=true;\n\nif(this.alphaTest>0)data.alphaTest=this.alphaTest;\nif(this.alphaToCoverage===true)data.alphaToCoverage=this.alphaToCoverage;\nif(this.premultipliedAlpha===true)data.premultipliedAlpha=this.premultipliedAlpha;\n\nif(this.wireframe===true)data.wireframe=this.wireframe;\nif(this.wireframeLinewidth>1)data.wireframeLinewidth=this.wireframeLinewidth;\nif(this.wireframeLinecap!=='round')data.wireframeLinecap=this.wireframeLinecap;\nif(this.wireframeLinejoin!=='round')data.wireframeLinejoin=this.wireframeLinejoin;\n\nif(this.flatShading===true)data.flatShading=this.flatShading;\n\nif(this.visible===false)data.visible=false;\n\nif(this.toneMapped===false)data.toneMapped=false;\n\nif(this.fog===false)data.fog=false;\n\nif(JSON.stringify(this.userData)!=='{}')data.userData=this.userData;\n\n// TODO: Copied from Object3D.toJSON\n\nfunction extractFromCache(cache){\n\nvar values=[];\n\nfor(var key in cache){\n\nvar _data2=cache[key];\ndelete _data2.metadata;\nvalues.push(_data2);\n\n}\n\nreturn values;\n\n}\n\nif(isRootObject){\n\nvar textures=extractFromCache(meta.textures);\nvar images=extractFromCache(meta.images);\n\nif(textures.length>0)data.textures=textures;\nif(images.length>0)data.images=images;\n\n}\n\nreturn data;\n\n}},{key:'clone',value:function clone()\n\n{\n\nreturn new this.constructor().copy(this);\n\n}},{key:'copy',value:function copy(\n\nsource){\n\nthis.name=source.name;\n\nthis.blending=source.blending;\nthis.side=source.side;\nthis.vertexColors=source.vertexColors;\n\nthis.opacity=source.opacity;\nthis.transparent=source.transparent;\n\nthis.blendSrc=source.blendSrc;\nthis.blendDst=source.blendDst;\nthis.blendEquation=source.blendEquation;\nthis.blendSrcAlpha=source.blendSrcAlpha;\nthis.blendDstAlpha=source.blendDstAlpha;\nthis.blendEquationAlpha=source.blendEquationAlpha;\n\nthis.depthFunc=source.depthFunc;\nthis.depthTest=source.depthTest;\nthis.depthWrite=source.depthWrite;\n\nthis.stencilWriteMask=source.stencilWriteMask;\nthis.stencilFunc=source.stencilFunc;\nthis.stencilRef=source.stencilRef;\nthis.stencilFuncMask=source.stencilFuncMask;\nthis.stencilFail=source.stencilFail;\nthis.stencilZFail=source.stencilZFail;\nthis.stencilZPass=source.stencilZPass;\nthis.stencilWrite=source.stencilWrite;\n\nvar srcPlanes=source.clippingPlanes;\nvar dstPlanes=null;\n\nif(srcPlanes!==null){\n\nvar n=srcPlanes.length;\ndstPlanes=new Array(n);\n\nfor(var i=0;i!==n;++i){\n\ndstPlanes[i]=srcPlanes[i].clone();\n\n}\n\n}\n\nthis.clippingPlanes=dstPlanes;\nthis.clipIntersection=source.clipIntersection;\nthis.clipShadows=source.clipShadows;\n\nthis.shadowSide=source.shadowSide;\n\nthis.colorWrite=source.colorWrite;\n\nthis.precision=source.precision;\n\nthis.polygonOffset=source.polygonOffset;\nthis.polygonOffsetFactor=source.polygonOffsetFactor;\nthis.polygonOffsetUnits=source.polygonOffsetUnits;\n\nthis.dithering=source.dithering;\n\nthis.alphaTest=source.alphaTest;\nthis.alphaToCoverage=source.alphaToCoverage;\nthis.premultipliedAlpha=source.premultipliedAlpha;\n\nthis.visible=source.visible;\n\nthis.toneMapped=source.toneMapped;\n\nthis.userData=JSON.parse(JSON.stringify(source.userData));\n\nreturn this;\n\n}},{key:'dispose',value:function dispose()\n\n{\n\nthis.dispatchEvent({type:'dispose'});\n\n}},{key:'alphaTest',get:function get(){return this._alphaTest;},set:function set(value){if(this._alphaTest>0!==value>0){this.version++;}this._alphaTest=value;}},{key:'needsUpdate',set:function set(\n\nvalue){\n\nif(value===true)this.version++;\n\n}}]);return Material;}(EventDispatcher);var\n\n\n\nMeshBasicMaterial=function(_Material){_inherits(MeshBasicMaterial,_Material);\n\nfunction MeshBasicMaterial(parameters){_classCallCheck(this,MeshBasicMaterial);var _this11=_possibleConstructorReturn(this,(MeshBasicMaterial.__proto__||Object.getPrototypeOf(MeshBasicMaterial)).call(this));\n\n\n\n_this11.isMeshBasicMaterial=true;\n\n_this11.type='MeshBasicMaterial';\n\n_this11.color=new Color(0xffffff);// emissive\n\n_this11.map=null;\n\n_this11.lightMap=null;\n_this11.lightMapIntensity=1.0;\n\n_this11.aoMap=null;\n_this11.aoMapIntensity=1.0;\n\n_this11.specularMap=null;\n\n_this11.alphaMap=null;\n\n_this11.envMap=null;\n_this11.combine=MultiplyOperation;\n_this11.reflectivity=1;\n_this11.refractionRatio=0.98;\n\n_this11.wireframe=false;\n_this11.wireframeLinewidth=1;\n_this11.wireframeLinecap='round';\n_this11.wireframeLinejoin='round';\n\n_this11.fog=true;\n\n_this11.setValues(parameters);return _this11;\n\n}_createClass(MeshBasicMaterial,[{key:'copy',value:function copy(\n\nsource){\n\n_get(MeshBasicMaterial.prototype.__proto__||Object.getPrototypeOf(MeshBasicMaterial.prototype),'copy',this).call(this,source);\n\nthis.color.copy(source.color);\n\nthis.map=source.map;\n\nthis.lightMap=source.lightMap;\nthis.lightMapIntensity=source.lightMapIntensity;\n\nthis.aoMap=source.aoMap;\nthis.aoMapIntensity=source.aoMapIntensity;\n\nthis.specularMap=source.specularMap;\n\nthis.alphaMap=source.alphaMap;\n\nthis.envMap=source.envMap;\nthis.combine=source.combine;\nthis.reflectivity=source.reflectivity;\nthis.refractionRatio=source.refractionRatio;\n\nthis.wireframe=source.wireframe;\nthis.wireframeLinewidth=source.wireframeLinewidth;\nthis.wireframeLinecap=source.wireframeLinecap;\nthis.wireframeLinejoin=source.wireframeLinejoin;\n\nthis.fog=source.fog;\n\nreturn this;\n\n}}]);return MeshBasicMaterial;}(Material);\n\n\n\nvar _vector$9=/*@__PURE__*/new Vector3();\nvar _vector2$1=/*@__PURE__*/new Vector2();var\n\nBufferAttribute=function(){\n\nfunction BufferAttribute(array,itemSize,normalized){_classCallCheck(this,BufferAttribute);\n\nif(Array.isArray(array)){\n\nthrow new TypeError('THREE.BufferAttribute: array should be a Typed Array.');\n\n}\n\nthis.isBufferAttribute=true;\n\nthis.name='';\n\nthis.array=array;\nthis.itemSize=itemSize;\nthis.count=array!==undefined?array.length/itemSize:0;\nthis.normalized=normalized===true;\n\nthis.usage=StaticDrawUsage;\nthis.updateRange={offset:0,count:-1};\n\nthis.version=0;\n\n}_createClass(BufferAttribute,[{key:'onUploadCallback',value:function onUploadCallback()\n\n{}},{key:'setUsage',value:function setUsage(\n\n\n\n\n\n\n\nvalue){\n\nthis.usage=value;\n\nreturn this;\n\n}},{key:'copy',value:function copy(\n\nsource){\n\nthis.name=source.name;\nthis.array=new source.array.constructor(source.array);\nthis.itemSize=source.itemSize;\nthis.count=source.count;\nthis.normalized=source.normalized;\n\nthis.usage=source.usage;\n\nreturn this;\n\n}},{key:'copyAt',value:function copyAt(\n\nindex1,attribute,index2){\n\nindex1*=this.itemSize;\nindex2*=attribute.itemSize;\n\nfor(var i=0,l=this.itemSize;i<l;i++){\n\nthis.array[index1+i]=attribute.array[index2+i];\n\n}\n\nreturn this;\n\n}},{key:'copyArray',value:function copyArray(\n\narray){\n\nthis.array.set(array);\n\nreturn this;\n\n}},{key:'copyColorsArray',value:function copyColorsArray(\n\ncolors){\n\nvar array=this.array;\nvar offset=0;\n\nfor(var i=0,l=colors.length;i<l;i++){\n\nvar color=colors[i];\n\nif(color===undefined){\n\nconsole.warn('THREE.BufferAttribute.copyColorsArray(): color is undefined',i);\ncolor=new Color();\n\n}\n\narray[offset++]=color.r;\narray[offset++]=color.g;\narray[offset++]=color.b;\n\n}\n\nreturn this;\n\n}},{key:'copyVector2sArray',value:function copyVector2sArray(\n\nvectors){\n\nvar array=this.array;\nvar offset=0;\n\nfor(var i=0,l=vectors.length;i<l;i++){\n\nvar vector=vectors[i];\n\nif(vector===undefined){\n\nconsole.warn('THREE.BufferAttribute.copyVector2sArray(): vector is undefined',i);\nvector=new Vector2();\n\n}\n\narray[offset++]=vector.x;\narray[offset++]=vector.y;\n\n}\n\nreturn this;\n\n}},{key:'copyVector3sArray',value:function copyVector3sArray(\n\nvectors){\n\nvar array=this.array;\nvar offset=0;\n\nfor(var i=0,l=vectors.length;i<l;i++){\n\nvar vector=vectors[i];\n\nif(vector===undefined){\n\nconsole.warn('THREE.BufferAttribute.copyVector3sArray(): vector is undefined',i);\nvector=new Vector3();\n\n}\n\narray[offset++]=vector.x;\narray[offset++]=vector.y;\narray[offset++]=vector.z;\n\n}\n\nreturn this;\n\n}},{key:'copyVector4sArray',value:function copyVector4sArray(\n\nvectors){\n\nvar array=this.array;\nvar offset=0;\n\nfor(var i=0,l=vectors.length;i<l;i++){\n\nvar vector=vectors[i];\n\nif(vector===undefined){\n\nconsole.warn('THREE.BufferAttribute.copyVector4sArray(): vector is undefined',i);\nvector=new Vector4();\n\n}\n\narray[offset++]=vector.x;\narray[offset++]=vector.y;\narray[offset++]=vector.z;\narray[offset++]=vector.w;\n\n}\n\nreturn this;\n\n}},{key:'applyMatrix3',value:function applyMatrix3(\n\nm){\n\nif(this.itemSize===2){\n\nfor(var i=0,l=this.count;i<l;i++){\n\n_vector2$1.fromBufferAttribute(this,i);\n_vector2$1.applyMatrix3(m);\n\nthis.setXY(i,_vector2$1.x,_vector2$1.y);\n\n}\n\n}else if(this.itemSize===3){\n\nfor(var _i6=0,_l3=this.count;_i6<_l3;_i6++){\n\n_vector$9.fromBufferAttribute(this,_i6);\n_vector$9.applyMatrix3(m);\n\nthis.setXYZ(_i6,_vector$9.x,_vector$9.y,_vector$9.z);\n\n}\n\n}\n\nreturn this;\n\n}},{key:'applyMatrix4',value:function applyMatrix4(\n\nm){\n\nfor(var i=0,l=this.count;i<l;i++){\n\n_vector$9.fromBufferAttribute(this,i);\n\n_vector$9.applyMatrix4(m);\n\nthis.setXYZ(i,_vector$9.x,_vector$9.y,_vector$9.z);\n\n}\n\nreturn this;\n\n}},{key:'applyNormalMatrix',value:function applyNormalMatrix(\n\nm){\n\nfor(var i=0,l=this.count;i<l;i++){\n\n_vector$9.fromBufferAttribute(this,i);\n\n_vector$9.applyNormalMatrix(m);\n\nthis.setXYZ(i,_vector$9.x,_vector$9.y,_vector$9.z);\n\n}\n\nreturn this;\n\n}},{key:'transformDirection',value:function transformDirection(\n\nm){\n\nfor(var i=0,l=this.count;i<l;i++){\n\n_vector$9.fromBufferAttribute(this,i);\n\n_vector$9.transformDirection(m);\n\nthis.setXYZ(i,_vector$9.x,_vector$9.y,_vector$9.z);\n\n}\n\nreturn this;\n\n}},{key:'set',value:function set(\n\nvalue){var offset=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;\n\nthis.array.set(value,offset);\n\nreturn this;\n\n}},{key:'getX',value:function getX(\n\nindex){\n\nreturn this.array[index*this.itemSize];\n\n}},{key:'setX',value:function setX(\n\nindex,x){\n\nthis.array[index*this.itemSize]=x;\n\nreturn this;\n\n}},{key:'getY',value:function getY(\n\nindex){\n\nreturn this.array[index*this.itemSize+1];\n\n}},{key:'setY',value:function setY(\n\nindex,y){\n\nthis.array[index*this.itemSize+1]=y;\n\nreturn this;\n\n}},{key:'getZ',value:function getZ(\n\nindex){\n\nreturn this.array[index*this.itemSize+2];\n\n}},{key:'setZ',value:function setZ(\n\nindex,z){\n\nthis.array[index*this.itemSize+2]=z;\n\nreturn this;\n\n}},{key:'getW',value:function getW(\n\nindex){\n\nreturn this.array[index*this.itemSize+3];\n\n}},{key:'setW',value:function setW(\n\nindex,w){\n\nthis.array[index*this.itemSize+3]=w;\n\nreturn this;\n\n}},{key:'setXY',value:function setXY(\n\nindex,x,y){\n\nindex*=this.itemSize;\n\nthis.array[index+0]=x;\nthis.array[index+1]=y;\n\nreturn this;\n\n}},{key:'setXYZ',value:function setXYZ(\n\nindex,x,y,z){\n\nindex*=this.itemSize;\n\nthis.array[index+0]=x;\nthis.array[index+1]=y;\nthis.array[index+2]=z;\n\nreturn this;\n\n}},{key:'setXYZW',value:function setXYZW(\n\nindex,x,y,z,w){\n\nindex*=this.itemSize;\n\nthis.array[index+0]=x;\nthis.array[index+1]=y;\nthis.array[index+2]=z;\nthis.array[index+3]=w;\n\nreturn this;\n\n}},{key:'onUpload',value:function onUpload(\n\ncallback){\n\nthis.onUploadCallback=callback;\n\nreturn this;\n\n}},{key:'clone',value:function clone()\n\n{\n\nreturn new this.constructor(this.array,this.itemSize).copy(this);\n\n}},{key:'toJSON',value:function toJSON()\n\n{\n\nvar data={\nitemSize:this.itemSize,\ntype:this.array.constructor.name,\narray:Array.from(this.array),\nnormalized:this.normalized};\n\n\nif(this.name!=='')data.name=this.name;\nif(this.usage!==StaticDrawUsage)data.usage=this.usage;\nif(this.updateRange.offset!==0||this.updateRange.count!==-1)data.updateRange=this.updateRange;\n\nreturn data;\n\n}},{key:'needsUpdate',set:function set(value){if(value===true)this.version++;}}]);return BufferAttribute;}();\n\n\n\n//\nvar\nInt8BufferAttribute=function(_BufferAttribute){_inherits(Int8BufferAttribute,_BufferAttribute);\n\nfunction Int8BufferAttribute(array,itemSize,normalized){_classCallCheck(this,Int8BufferAttribute);return _possibleConstructorReturn(this,(Int8BufferAttribute.__proto__||Object.getPrototypeOf(Int8BufferAttribute)).call(this,\n\nnew Int8Array(array),itemSize,normalized));\n\n}return Int8BufferAttribute;}(BufferAttribute);var\n\n\n\nUint8BufferAttribute=function(_BufferAttribute2){_inherits(Uint8BufferAttribute,_BufferAttribute2);\n\nfunction Uint8BufferAttribute(array,itemSize,normalized){_classCallCheck(this,Uint8BufferAttribute);return _possibleConstructorReturn(this,(Uint8BufferAttribute.__proto__||Object.getPrototypeOf(Uint8BufferAttribute)).call(this,\n\nnew Uint8Array(array),itemSize,normalized));\n\n}return Uint8BufferAttribute;}(BufferAttribute);var\n\n\n\nUint8ClampedBufferAttribute=function(_BufferAttribute3){_inherits(Uint8ClampedBufferAttribute,_BufferAttribute3);\n\nfunction Uint8ClampedBufferAttribute(array,itemSize,normalized){_classCallCheck(this,Uint8ClampedBufferAttribute);return _possibleConstructorReturn(this,(Uint8ClampedBufferAttribute.__proto__||Object.getPrototypeOf(Uint8ClampedBufferAttribute)).call(this,\n\nnew Uint8ClampedArray(array),itemSize,normalized));\n\n}return Uint8ClampedBufferAttribute;}(BufferAttribute);var\n\n\n\nInt16BufferAttribute=function(_BufferAttribute4){_inherits(Int16BufferAttribute,_BufferAttribute4);\n\nfunction Int16BufferAttribute(array,itemSize,normalized){_classCallCheck(this,Int16BufferAttribute);return _possibleConstructorReturn(this,(Int16BufferAttribute.__proto__||Object.getPrototypeOf(Int16BufferAttribute)).call(this,\n\nnew Int16Array(array),itemSize,normalized));\n\n}return Int16BufferAttribute;}(BufferAttribute);var\n\n\n\nUint16BufferAttribute=function(_BufferAttribute5){_inherits(Uint16BufferAttribute,_BufferAttribute5);\n\nfunction Uint16BufferAttribute(array,itemSize,normalized){_classCallCheck(this,Uint16BufferAttribute);return _possibleConstructorReturn(this,(Uint16BufferAttribute.__proto__||Object.getPrototypeOf(Uint16BufferAttribute)).call(this,\n\nnew Uint16Array(array),itemSize,normalized));\n\n}return Uint16BufferAttribute;}(BufferAttribute);var\n\n\n\nInt32BufferAttribute=function(_BufferAttribute6){_inherits(Int32BufferAttribute,_BufferAttribute6);\n\nfunction Int32BufferAttribute(array,itemSize,normalized){_classCallCheck(this,Int32BufferAttribute);return _possibleConstructorReturn(this,(Int32BufferAttribute.__proto__||Object.getPrototypeOf(Int32BufferAttribute)).call(this,\n\nnew Int32Array(array),itemSize,normalized));\n\n}return Int32BufferAttribute;}(BufferAttribute);var\n\n\n\nUint32BufferAttribute=function(_BufferAttribute7){_inherits(Uint32BufferAttribute,_BufferAttribute7);\n\nfunction Uint32BufferAttribute(array,itemSize,normalized){_classCallCheck(this,Uint32BufferAttribute);return _possibleConstructorReturn(this,(Uint32BufferAttribute.__proto__||Object.getPrototypeOf(Uint32BufferAttribute)).call(this,\n\nnew Uint32Array(array),itemSize,normalized));\n\n}return Uint32BufferAttribute;}(BufferAttribute);var\n\n\n\nFloat16BufferAttribute=function(_BufferAttribute8){_inherits(Float16BufferAttribute,_BufferAttribute8);\n\nfunction Float16BufferAttribute(array,itemSize,normalized){_classCallCheck(this,Float16BufferAttribute);var _this19=_possibleConstructorReturn(this,(Float16BufferAttribute.__proto__||Object.getPrototypeOf(Float16BufferAttribute)).call(this,\n\nnew Uint16Array(array),itemSize,normalized));\n\n_this19.isFloat16BufferAttribute=true;return _this19;\n\n}return Float16BufferAttribute;}(BufferAttribute);var\n\n\n\n\nFloat32BufferAttribute=function(_BufferAttribute9){_inherits(Float32BufferAttribute,_BufferAttribute9);\n\nfunction Float32BufferAttribute(array,itemSize,normalized){_classCallCheck(this,Float32BufferAttribute);return _possibleConstructorReturn(this,(Float32BufferAttribute.__proto__||Object.getPrototypeOf(Float32BufferAttribute)).call(this,\n\nnew Float32Array(array),itemSize,normalized));\n\n}return Float32BufferAttribute;}(BufferAttribute);var\n\n\n\nFloat64BufferAttribute=function(_BufferAttribute10){_inherits(Float64BufferAttribute,_BufferAttribute10);\n\nfunction Float64BufferAttribute(array,itemSize,normalized){_classCallCheck(this,Float64BufferAttribute);return _possibleConstructorReturn(this,(Float64BufferAttribute.__proto__||Object.getPrototypeOf(Float64BufferAttribute)).call(this,\n\nnew Float64Array(array),itemSize,normalized));\n\n}return Float64BufferAttribute;}(BufferAttribute);\n\n\n\nvar _id$1=0;\n\nvar _m1=/*@__PURE__*/new Matrix4();\nvar _obj=/*@__PURE__*/new Object3D();\nvar _offset=/*@__PURE__*/new Vector3();\nvar _box$1=/*@__PURE__*/new Box3();\nvar _boxMorphTargets=/*@__PURE__*/new Box3();\nvar _vector$8=/*@__PURE__*/new Vector3();var\n\nBufferGeometry=function(_EventDispatcher5){_inherits(BufferGeometry,_EventDispatcher5);\n\nfunction BufferGeometry(){_classCallCheck(this,BufferGeometry);var _this22=_possibleConstructorReturn(this,(BufferGeometry.__proto__||Object.getPrototypeOf(BufferGeometry)).call(this));\n\n\n\n_this22.isBufferGeometry=true;\n\nObject.defineProperty(_this22,'id',{value:_id$1++});\n\n_this22.uuid=generateUUID();\n\n_this22.name='';\n_this22.type='BufferGeometry';\n\n_this22.index=null;\n_this22.attributes={};\n\n_this22.morphAttributes={};\n_this22.morphTargetsRelative=false;\n\n_this22.groups=[];\n\n_this22.boundingBox=null;\n_this22.boundingSphere=null;\n\n_this22.drawRange={start:0,count:Infinity};\n\n_this22.userData={};return _this22;\n\n}_createClass(BufferGeometry,[{key:'getIndex',value:function getIndex()\n\n{\n\nreturn this.index;\n\n}},{key:'setIndex',value:function setIndex(\n\nindex){\n\nif(Array.isArray(index)){\n\nthis.index=new(arrayNeedsUint32(index)?Uint32BufferAttribute:Uint16BufferAttribute)(index,1);\n\n}else{\n\nthis.index=index;\n\n}\n\nreturn this;\n\n}},{key:'getAttribute',value:function getAttribute(\n\nname){\n\nreturn this.attributes[name];\n\n}},{key:'setAttribute',value:function setAttribute(\n\nname,attribute){\n\nthis.attributes[name]=attribute;\n\nreturn this;\n\n}},{key:'deleteAttribute',value:function deleteAttribute(\n\nname){\n\ndelete this.attributes[name];\n\nreturn this;\n\n}},{key:'hasAttribute',value:function hasAttribute(\n\nname){\n\nreturn this.attributes[name]!==undefined;\n\n}},{key:'addGroup',value:function addGroup(\n\nstart,count){var materialIndex=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;\n\nthis.groups.push({\n\nstart:start,\ncount:count,\nmaterialIndex:materialIndex});\n\n\n\n}},{key:'clearGroups',value:function clearGroups()\n\n{\n\nthis.groups=[];\n\n}},{key:'setDrawRange',value:function setDrawRange(\n\nstart,count){\n\nthis.drawRange.start=start;\nthis.drawRange.count=count;\n\n}},{key:'applyMatrix4',value:function applyMatrix4(\n\nmatrix){\n\nvar position=this.attributes.position;\n\nif(position!==undefined){\n\nposition.applyMatrix4(matrix);\n\nposition.needsUpdate=true;\n\n}\n\nvar normal=this.attributes.normal;\n\nif(normal!==undefined){\n\nvar normalMatrix=new Matrix3().getNormalMatrix(matrix);\n\nnormal.applyNormalMatrix(normalMatrix);\n\nnormal.needsUpdate=true;\n\n}\n\nvar tangent=this.attributes.tangent;\n\nif(tangent!==undefined){\n\ntangent.transformDirection(matrix);\n\ntangent.needsUpdate=true;\n\n}\n\nif(this.boundingBox!==null){\n\nthis.computeBoundingBox();\n\n}\n\nif(this.boundingSphere!==null){\n\nthis.computeBoundingSphere();\n\n}\n\nreturn this;\n\n}},{key:'applyQuaternion',value:function applyQuaternion(\n\nq){\n\n_m1.makeRotationFromQuaternion(q);\n\nthis.applyMatrix4(_m1);\n\nreturn this;\n\n}},{key:'rotateX',value:function rotateX(\n\nangle){\n\n// rotate geometry around world x-axis\n\n_m1.makeRotationX(angle);\n\nthis.applyMatrix4(_m1);\n\nreturn this;\n\n}},{key:'rotateY',value:function rotateY(\n\nangle){\n\n// rotate geometry around world y-axis\n\n_m1.makeRotationY(angle);\n\nthis.applyMatrix4(_m1);\n\nreturn this;\n\n}},{key:'rotateZ',value:function rotateZ(\n\nangle){\n\n// rotate geometry around world z-axis\n\n_m1.makeRotationZ(angle);\n\nthis.applyMatrix4(_m1);\n\nreturn this;\n\n}},{key:'translate',value:function translate(\n\nx,y,z){\n\n// translate geometry\n\n_m1.makeTranslation(x,y,z);\n\nthis.applyMatrix4(_m1);\n\nreturn this;\n\n}},{key:'scale',value:function scale(\n\nx,y,z){\n\n// scale geometry\n\n_m1.makeScale(x,y,z);\n\nthis.applyMatrix4(_m1);\n\nreturn this;\n\n}},{key:'lookAt',value:function lookAt(\n\nvector){\n\n_obj.lookAt(vector);\n\n_obj.updateMatrix();\n\nthis.applyMatrix4(_obj.matrix);\n\nreturn this;\n\n}},{key:'center',value:function center()\n\n{\n\nthis.computeBoundingBox();\n\nthis.boundingBox.getCenter(_offset).negate();\n\nthis.translate(_offset.x,_offset.y,_offset.z);\n\nreturn this;\n\n}},{key:'setFromPoints',value:function setFromPoints(\n\npoints){\n\nvar position=[];\n\nfor(var i=0,l=points.length;i<l;i++){\n\nvar point=points[i];\nposition.push(point.x,point.y,point.z||0);\n\n}\n\nthis.setAttribute('position',new Float32BufferAttribute(position,3));\n\nreturn this;\n\n}},{key:'computeBoundingBox',value:function computeBoundingBox()\n\n{\n\nif(this.boundingBox===null){\n\nthis.boundingBox=new Box3();\n\n}\n\nvar position=this.attributes.position;\nvar morphAttributesPosition=this.morphAttributes.position;\n\nif(position&&position.isGLBufferAttribute){\n\nconsole.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set \"mesh.frustumCulled\" to \"false\".',this);\n\nthis.boundingBox.set(\nnew Vector3(-Infinity,-Infinity,-Infinity),\nnew Vector3(+Infinity,+Infinity,+Infinity));\n\n\nreturn;\n\n}\n\nif(position!==undefined){\n\nthis.boundingBox.setFromBufferAttribute(position);\n\n// process morph attributes if present\n\nif(morphAttributesPosition){\n\nfor(var i=0,il=morphAttributesPosition.length;i<il;i++){\n\nvar morphAttribute=morphAttributesPosition[i];\n_box$1.setFromBufferAttribute(morphAttribute);\n\nif(this.morphTargetsRelative){\n\n_vector$8.addVectors(this.boundingBox.min,_box$1.min);\nthis.boundingBox.expandByPoint(_vector$8);\n\n_vector$8.addVectors(this.boundingBox.max,_box$1.max);\nthis.boundingBox.expandByPoint(_vector$8);\n\n}else{\n\nthis.boundingBox.expandByPoint(_box$1.min);\nthis.boundingBox.expandByPoint(_box$1.max);\n\n}\n\n}\n\n}\n\n}else{\n\nthis.boundingBox.makeEmpty();\n\n}\n\nif(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z)){\n\nconsole.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The \"position\" attribute is likely to have NaN values.',this);\n\n}\n\n}},{key:'computeBoundingSphere',value:function computeBoundingSphere()\n\n{\n\nif(this.boundingSphere===null){\n\nthis.boundingSphere=new Sphere();\n\n}\n\nvar position=this.attributes.position;\nvar morphAttributesPosition=this.morphAttributes.position;\n\nif(position&&position.isGLBufferAttribute){\n\nconsole.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set \"mesh.frustumCulled\" to \"false\".',this);\n\nthis.boundingSphere.set(new Vector3(),Infinity);\n\nreturn;\n\n}\n\nif(position){\n\n// first, find the center of the bounding sphere\n\nvar center=this.boundingSphere.center;\n\n_box$1.setFromBufferAttribute(position);\n\n// process morph attributes if present\n\nif(morphAttributesPosition){\n\nfor(var i=0,il=morphAttributesPosition.length;i<il;i++){\n\nvar morphAttribute=morphAttributesPosition[i];\n_boxMorphTargets.setFromBufferAttribute(morphAttribute);\n\nif(this.morphTargetsRelative){\n\n_vector$8.addVectors(_box$1.min,_boxMorphTargets.min);\n_box$1.expandByPoint(_vector$8);\n\n_vector$8.addVectors(_box$1.max,_boxMorphTargets.max);\n_box$1.expandByPoint(_vector$8);\n\n}else{\n\n_box$1.expandByPoint(_boxMorphTargets.min);\n_box$1.expandByPoint(_boxMorphTargets.max);\n\n}\n\n}\n\n}\n\n_box$1.getCenter(center);\n\n// second, try to find a boundingSphere with a radius smaller than the\n// boundingSphere of the boundingBox: sqrt(3) smaller in the best case\n\nvar maxRadiusSq=0;\n\nfor(var _i7=0,_il=position.count;_i7<_il;_i7++){\n\n_vector$8.fromBufferAttribute(position,_i7);\n\nmaxRadiusSq=Math.max(maxRadiusSq,center.distanceToSquared(_vector$8));\n\n}\n\n// process morph attributes if present\n\nif(morphAttributesPosition){\n\nfor(var _i8=0,_il2=morphAttributesPosition.length;_i8<_il2;_i8++){\n\nvar _morphAttribute=morphAttributesPosition[_i8];\nvar morphTargetsRelative=this.morphTargetsRelative;\n\nfor(var j=0,jl=_morphAttribute.count;j<jl;j++){\n\n_vector$8.fromBufferAttribute(_morphAttribute,j);\n\nif(morphTargetsRelative){\n\n_offset.fromBufferAttribute(position,j);\n_vector$8.add(_offset);\n\n}\n\nmaxRadiusSq=Math.max(maxRadiusSq,center.distanceToSquared(_vector$8));\n\n}\n\n}\n\n}\n\nthis.boundingSphere.radius=Math.sqrt(maxRadiusSq);\n\nif(isNaN(this.boundingSphere.radius)){\n\nconsole.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The \"position\" attribute is likely to have NaN values.',this);\n\n}\n\n}\n\n}},{key:'computeTangents',value:function computeTangents()\n\n{\n\nvar index=this.index;\nvar attributes=this.attributes;\n\n// based on http://www.terathon.com/code/tangent.html\n// (per vertex tangents)\n\nif(index===null||\nattributes.position===undefined||\nattributes.normal===undefined||\nattributes.uv===undefined){\n\nconsole.error('THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)');\nreturn;\n\n}\n\nvar indices=index.array;\nvar positions=attributes.position.array;\nvar normals=attributes.normal.array;\nvar uvs=attributes.uv.array;\n\nvar nVertices=positions.length/3;\n\nif(this.hasAttribute('tangent')===false){\n\nthis.setAttribute('tangent',new BufferAttribute(new Float32Array(4*nVertices),4));\n\n}\n\nvar tangents=this.getAttribute('tangent').array;\n\nvar tan1=[],tan2=[];\n\nfor(var i=0;i<nVertices;i++){\n\ntan1[i]=new Vector3();\ntan2[i]=new Vector3();\n\n}\n\nvar vA=new Vector3(),\nvB=new Vector3(),\nvC=new Vector3(),\n\nuvA=new Vector2(),\nuvB=new Vector2(),\nuvC=new Vector2(),\n\nsdir=new Vector3(),\ntdir=new Vector3();\n\nfunction handleTriangle(a,b,c){\n\nvA.fromArray(positions,a*3);\nvB.fromArray(positions,b*3);\nvC.fromArray(positions,c*3);\n\nuvA.fromArray(uvs,a*2);\nuvB.fromArray(uvs,b*2);\nuvC.fromArray(uvs,c*2);\n\nvB.sub(vA);\nvC.sub(vA);\n\nuvB.sub(uvA);\nuvC.sub(uvA);\n\nvar r=1.0/(uvB.x*uvC.y-uvC.x*uvB.y);\n\n// silently ignore degenerate uv triangles having coincident or colinear vertices\n\nif(!isFinite(r))return;\n\nsdir.copy(vB).multiplyScalar(uvC.y).addScaledVector(vC,-uvB.y).multiplyScalar(r);\ntdir.copy(vC).multiplyScalar(uvB.x).addScaledVector(vB,-uvC.x).multiplyScalar(r);\n\ntan1[a].add(sdir);\ntan1[b].add(sdir);\ntan1[c].add(sdir);\n\ntan2[a].add(tdir);\ntan2[b].add(tdir);\ntan2[c].add(tdir);\n\n}\n\nvar groups=this.groups;\n\nif(groups.length===0){\n\ngroups=[{\nstart:0,\ncount:indices.length}];\n\n\n}\n\nfor(var _i9=0,il=groups.length;_i9<il;++_i9){\n\nvar group=groups[_i9];\n\nvar start=group.start;\nvar count=group.count;\n\nfor(var j=start,jl=start+count;j<jl;j+=3){\n\nhandleTriangle(\nindices[j+0],\nindices[j+1],\nindices[j+2]);\n\n\n}\n\n}\n\nvar tmp=new Vector3(),tmp2=new Vector3();\nvar n=new Vector3(),n2=new Vector3();\n\nfunction handleVertex(v){\n\nn.fromArray(normals,v*3);\nn2.copy(n);\n\nvar t=tan1[v];\n\n// Gram-Schmidt orthogonalize\n\ntmp.copy(t);\ntmp.sub(n.multiplyScalar(n.dot(t))).normalize();\n\n// Calculate handedness\n\ntmp2.crossVectors(n2,t);\nvar test=tmp2.dot(tan2[v]);\nvar w=test<0.0?-1.0:1.0;\n\ntangents[v*4]=tmp.x;\ntangents[v*4+1]=tmp.y;\ntangents[v*4+2]=tmp.z;\ntangents[v*4+3]=w;\n\n}\n\nfor(var _i10=0,_il3=groups.length;_i10<_il3;++_i10){\n\nvar _group=groups[_i10];\n\nvar _start2=_group.start;\nvar _count=_group.count;\n\nfor(var _j=_start2,_jl=_start2+_count;_j<_jl;_j+=3){\n\nhandleVertex(indices[_j+0]);\nhandleVertex(indices[_j+1]);\nhandleVertex(indices[_j+2]);\n\n}\n\n}\n\n}},{key:'computeVertexNormals',value:function computeVertexNormals()\n\n{\n\nvar index=this.index;\nvar positionAttribute=this.getAttribute('position');\n\nif(positionAttribute!==undefined){\n\nvar normalAttribute=this.getAttribute('normal');\n\nif(normalAttribute===undefined){\n\nnormalAttribute=new BufferAttribute(new Float32Array(positionAttribute.count*3),3);\nthis.setAttribute('normal',normalAttribute);\n\n}else{\n\n// reset existing normals to zero\n\nfor(var i=0,il=normalAttribute.count;i<il;i++){\n\nnormalAttribute.setXYZ(i,0,0,0);\n\n}\n\n}\n\nvar pA=new Vector3(),pB=new Vector3(),pC=new Vector3();\nvar nA=new Vector3(),nB=new Vector3(),nC=new Vector3();\nvar cb=new Vector3(),ab=new Vector3();\n\n// indexed elements\n\nif(index){\n\nfor(var _i11=0,_il4=index.count;_i11<_il4;_i11+=3){\n\nvar vA=index.getX(_i11+0);\nvar vB=index.getX(_i11+1);\nvar vC=index.getX(_i11+2);\n\npA.fromBufferAttribute(positionAttribute,vA);\npB.fromBufferAttribute(positionAttribute,vB);\npC.fromBufferAttribute(positionAttribute,vC);\n\ncb.subVectors(pC,pB);\nab.subVectors(pA,pB);\ncb.cross(ab);\n\nnA.fromBufferAttribute(normalAttribute,vA);\nnB.fromBufferAttribute(normalAttribute,vB);\nnC.fromBufferAttribute(normalAttribute,vC);\n\nnA.add(cb);\nnB.add(cb);\nnC.add(cb);\n\nnormalAttribute.setXYZ(vA,nA.x,nA.y,nA.z);\nnormalAttribute.setXYZ(vB,nB.x,nB.y,nB.z);\nnormalAttribute.setXYZ(vC,nC.x,nC.y,nC.z);\n\n}\n\n}else{\n\n// non-indexed elements (unconnected triangle soup)\n\nfor(var _i12=0,_il5=positionAttribute.count;_i12<_il5;_i12+=3){\n\npA.fromBufferAttribute(positionAttribute,_i12+0);\npB.fromBufferAttribute(positionAttribute,_i12+1);\npC.fromBufferAttribute(positionAttribute,_i12+2);\n\ncb.subVectors(pC,pB);\nab.subVectors(pA,pB);\ncb.cross(ab);\n\nnormalAttribute.setXYZ(_i12+0,cb.x,cb.y,cb.z);\nnormalAttribute.setXYZ(_i12+1,cb.x,cb.y,cb.z);\nnormalAttribute.setXYZ(_i12+2,cb.x,cb.y,cb.z);\n\n}\n\n}\n\nthis.normalizeNormals();\n\nnormalAttribute.needsUpdate=true;\n\n}\n\n}},{key:'merge',value:function merge(\n\ngeometry,offset){\n\nif(!(geometry&&geometry.isBufferGeometry)){\n\nconsole.error('THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.',geometry);\nreturn;\n\n}\n\nif(offset===undefined){\n\noffset=0;\n\nconsole.warn(\n'THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. '+\n'Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge.');\n\n\n}\n\nvar attributes=this.attributes;\n\nfor(var key in attributes){\n\nif(geometry.attributes[key]===undefined)continue;\n\nvar attribute1=attributes[key];\nvar attributeArray1=attribute1.array;\n\nvar attribute2=geometry.attributes[key];\nvar attributeArray2=attribute2.array;\n\nvar attributeOffset=attribute2.itemSize*offset;\nvar length=Math.min(attributeArray2.length,attributeArray1.length-attributeOffset);\n\nfor(var i=0,j=attributeOffset;i<length;i++,j++){\n\nattributeArray1[j]=attributeArray2[i];\n\n}\n\n}\n\nreturn this;\n\n}},{key:'normalizeNormals',value:function normalizeNormals()\n\n{\n\nvar normals=this.attributes.normal;\n\nfor(var i=0,il=normals.count;i<il;i++){\n\n_vector$8.fromBufferAttribute(normals,i);\n\n_vector$8.normalize();\n\nnormals.setXYZ(i,_vector$8.x,_vector$8.y,_vector$8.z);\n\n}\n\n}},{key:'toNonIndexed',value:function toNonIndexed()\n\n{\n\nfunction convertBufferAttribute(attribute,indices){\n\nvar array=attribute.array;\nvar itemSize=attribute.itemSize;\nvar normalized=attribute.normalized;\n\nvar array2=new array.constructor(indices.length*itemSize);\n\nvar index=0,index2=0;\n\nfor(var i=0,l=indices.length;i<l;i++){\n\nif(attribute.isInterleavedBufferAttribute){\n\nindex=indices[i]*attribute.data.stride+attribute.offset;\n\n}else{\n\nindex=indices[i]*itemSize;\n\n}\n\nfor(var j=0;j<itemSize;j++){\n\narray2[index2++]=array[index++];\n\n}\n\n}\n\nreturn new BufferAttribute(array2,itemSize,normalized);\n\n}\n\n//\n\nif(this.index===null){\n\nconsole.warn('THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed.');\nreturn this;\n\n}\n\nvar geometry2=new BufferGeometry();\n\nvar indices=this.index.array;\nvar attributes=this.attributes;\n\n// attributes\n\nfor(var name in attributes){\n\nvar attribute=attributes[name];\n\nvar newAttribute=convertBufferAttribute(attribute,indices);\n\ngeometry2.setAttribute(name,newAttribute);\n\n}\n\n// morph attributes\n\nvar morphAttributes=this.morphAttributes;\n\nfor(var _name in morphAttributes){\n\nvar morphArray=[];\nvar morphAttribute=morphAttributes[_name];// morphAttribute: array of Float32BufferAttributes\n\nfor(var i=0,il=morphAttribute.length;i<il;i++){\n\nvar _attribute=morphAttribute[i];\n\nvar _newAttribute=convertBufferAttribute(_attribute,indices);\n\nmorphArray.push(_newAttribute);\n\n}\n\ngeometry2.morphAttributes[_name]=morphArray;\n\n}\n\ngeometry2.morphTargetsRelative=this.morphTargetsRelative;\n\n// groups\n\nvar groups=this.groups;\n\nfor(var _i13=0,l=groups.length;_i13<l;_i13++){\n\nvar group=groups[_i13];\ngeometry2.addGroup(group.start,group.count,group.materialIndex);\n\n}\n\nreturn geometry2;\n\n}},{key:'toJSON',value:function toJSON()\n\n{\n\nvar data={\nmetadata:{\nversion:4.5,\ntype:'BufferGeometry',\ngenerator:'BufferGeometry.toJSON'}};\n\n\n\n// standard BufferGeometry serialization\n\ndata.uuid=this.uuid;\ndata.type=this.type;\nif(this.name!=='')data.name=this.name;\nif(Object.keys(this.userData).length>0)data.userData=this.userData;\n\nif(this.parameters!==undefined){\n\nvar parameters=this.parameters;\n\nfor(var key in parameters){\n\nif(parameters[key]!==undefined)data[key]=parameters[key];\n\n}\n\nreturn data;\n\n}\n\n// for simplicity the code assumes attributes are not shared across geometries, see #15811\n\ndata.data={attributes:{}};\n\nvar index=this.index;\n\nif(index!==null){\n\ndata.data.index={\ntype:index.array.constructor.name,\narray:Array.prototype.slice.call(index.array)};\n\n\n}\n\nvar attributes=this.attributes;\n\nfor(var _key in attributes){\n\nvar attribute=attributes[_key];\n\ndata.data.attributes[_key]=attribute.toJSON(data.data);\n\n}\n\nvar morphAttributes={};\nvar hasMorphAttributes=false;\n\nfor(var _key2 in this.morphAttributes){\n\nvar attributeArray=this.morphAttributes[_key2];\n\nvar array=[];\n\nfor(var i=0,il=attributeArray.length;i<il;i++){\n\nvar _attribute2=attributeArray[i];\n\narray.push(_attribute2.toJSON(data.data));\n\n}\n\nif(array.length>0){\n\nmorphAttributes[_key2]=array;\n\nhasMorphAttributes=true;\n\n}\n\n}\n\nif(hasMorphAttributes){\n\ndata.data.morphAttributes=morphAttributes;\ndata.data.morphTargetsRelative=this.morphTargetsRelative;\n\n}\n\nvar groups=this.groups;\n\nif(groups.length>0){\n\ndata.data.groups=JSON.parse(JSON.stringify(groups));\n\n}\n\nvar boundingSphere=this.boundingSphere;\n\nif(boundingSphere!==null){\n\ndata.data.boundingSphere={\ncenter:boundingSphere.center.toArray(),\nradius:boundingSphere.radius};\n\n\n}\n\nreturn data;\n\n}},{key:'clone',value:function clone()\n\n{\n\nreturn new this.constructor().copy(this);\n\n}},{key:'copy',value:function copy(\n\nsource){\n\n// reset\n\nthis.index=null;\nthis.attributes={};\nthis.morphAttributes={};\nthis.groups=[];\nthis.boundingBox=null;\nthis.boundingSphere=null;\n\n// used for storing cloned, shared data\n\nvar data={};\n\n// name\n\nthis.name=source.name;\n\n// index\n\nvar index=source.index;\n\nif(index!==null){\n\nthis.setIndex(index.clone(data));\n\n}\n\n// attributes\n\nvar attributes=source.attributes;\n\nfor(var name in attributes){\n\nvar attribute=attributes[name];\nthis.setAttribute(name,attribute.clone(data));\n\n}\n\n// morph attributes\n\nvar morphAttributes=source.morphAttributes;\n\nfor(var _name2 in morphAttributes){\n\nvar array=[];\nvar morphAttribute=morphAttributes[_name2];// morphAttribute: array of Float32BufferAttributes\n\nfor(var i=0,l=morphAttribute.length;i<l;i++){\n\narray.push(morphAttribute[i].clone(data));\n\n}\n\nthis.morphAttributes[_name2]=array;\n\n}\n\nthis.morphTargetsRelative=source.morphTargetsRelative;\n\n// groups\n\nvar groups=source.groups;\n\nfor(var _i14=0,_l4=groups.length;_i14<_l4;_i14++){\n\nvar group=groups[_i14];\nthis.addGroup(group.start,group.count,group.materialIndex);\n\n}\n\n// bounding box\n\nvar boundingBox=source.boundingBox;\n\nif(boundingBox!==null){\n\nthis.boundingBox=boundingBox.clone();\n\n}\n\n// bounding sphere\n\nvar boundingSphere=source.boundingSphere;\n\nif(boundingSphere!==null){\n\nthis.boundingSphere=boundingSphere.clone();\n\n}\n\n// draw range\n\nthis.drawRange.start=source.drawRange.start;\nthis.drawRange.count=source.drawRange.count;\n\n// user data\n\nthis.userData=source.userData;\n\n// geometry generator parameters\n\nif(source.parameters!==undefined)this.parameters=Object.assign({},source.parameters);\n\nreturn this;\n\n}},{key:'dispose',value:function dispose()\n\n{\n\nthis.dispatchEvent({type:'dispose'});\n\n}}]);return BufferGeometry;}(EventDispatcher);\n\n\n\nvar _inverseMatrix$2=/*@__PURE__*/new Matrix4();\nvar _ray$2=/*@__PURE__*/new Ray();\nvar _sphere$3=/*@__PURE__*/new Sphere();\n\nvar _vA$1=/*@__PURE__*/new Vector3();\nvar _vB$1=/*@__PURE__*/new Vector3();\nvar _vC$1=/*@__PURE__*/new Vector3();\n\nvar _tempA=/*@__PURE__*/new Vector3();\nvar _tempB=/*@__PURE__*/new Vector3();\nvar _tempC=/*@__PURE__*/new Vector3();\n\nvar _morphA=/*@__PURE__*/new Vector3();\nvar _morphB=/*@__PURE__*/new Vector3();\nvar _morphC=/*@__PURE__*/new Vector3();\n\nvar _uvA$1=/*@__PURE__*/new Vector2();\nvar _uvB$1=/*@__PURE__*/new Vector2();\nvar _uvC$1=/*@__PURE__*/new Vector2();\n\nvar _intersectionPoint=/*@__PURE__*/new Vector3();\nvar _intersectionPointWorld=/*@__PURE__*/new Vector3();var\n\nMesh=function(_Object3D){_inherits(Mesh,_Object3D);\n\nfunction Mesh(){var geometry=arguments.length>0&&arguments[0]!==undefined?arguments[0]:new BufferGeometry();var material=arguments.length>1&&arguments[1]!==undefined?arguments[1]:new MeshBasicMaterial();_classCallCheck(this,Mesh);var _this23=_possibleConstructorReturn(this,(Mesh.__proto__||Object.getPrototypeOf(Mesh)).call(this));\n\n\n\n_this23.isMesh=true;\n\n_this23.type='Mesh';\n\n_this23.geometry=geometry;\n_this23.material=material;\n\n_this23.updateMorphTargets();return _this23;\n\n}_createClass(Mesh,[{key:'copy',value:function copy(\n\nsource,recursive){\n\n_get(Mesh.prototype.__proto__||Object.getPrototypeOf(Mesh.prototype),'copy',this).call(this,source,recursive);\n\nif(source.morphTargetInfluences!==undefined){\n\nthis.morphTargetInfluences=source.morphTargetInfluences.slice();\n\n}\n\nif(source.morphTargetDictionary!==undefined){\n\nthis.morphTargetDictionary=Object.assign({},source.morphTargetDictionary);\n\n}\n\nthis.material=source.material;\nthis.geometry=source.geometry;\n\nreturn this;\n\n}},{key:'updateMorphTargets',value:function updateMorphTargets()\n\n{\n\nvar geometry=this.geometry;\n\nvar morphAttributes=geometry.morphAttributes;\nvar keys=Object.keys(morphAttributes);\n\nif(keys.length>0){\n\nvar morphAttribute=morphAttributes[keys[0]];\n\nif(morphAttribute!==undefined){\n\nthis.morphTargetInfluences=[];\nthis.morphTargetDictionary={};\n\nfor(var m=0,ml=morphAttribute.length;m<ml;m++){\n\nvar name=morphAttribute[m].name||String(m);\n\nthis.morphTargetInfluences.push(0);\nthis.morphTargetDictionary[name]=m;\n\n}\n\n}\n\n}\n\n}},{key:'raycast',value:function raycast(\n\nraycaster,intersects){\n\nvar geometry=this.geometry;\nvar material=this.material;\nvar matrixWorld=this.matrixWorld;\n\nif(material===undefined)return;\n\n// Checking boundingSphere distance to ray\n\nif(geometry.boundingSphere===null)geometry.computeBoundingSphere();\n\n_sphere$3.copy(geometry.boundingSphere);\n_sphere$3.applyMatrix4(matrixWorld);\n\nif(raycaster.ray.intersectsSphere(_sphere$3)===false)return;\n\n//\n\n_inverseMatrix$2.copy(matrixWorld).invert();\n_ray$2.copy(raycaster.ray).applyMatrix4(_inverseMatrix$2);\n\n// Check boundingBox before continuing\n\nif(geometry.boundingBox!==null){\n\nif(_ray$2.intersectsBox(geometry.boundingBox)===false)return;\n\n}\n\nvar intersection=void 0;\n\nvar index=geometry.index;\nvar position=geometry.attributes.position;\nvar morphPosition=geometry.morphAttributes.position;\nvar morphTargetsRelative=geometry.morphTargetsRelative;\nvar uv=geometry.attributes.uv;\nvar uv2=geometry.attributes.uv2;\nvar groups=geometry.groups;\nvar drawRange=geometry.drawRange;\n\nif(index!==null){\n\n// indexed buffer geometry\n\nif(Array.isArray(material)){\n\nfor(var i=0,il=groups.length;i<il;i++){\n\nvar group=groups[i];\nvar groupMaterial=material[group.materialIndex];\n\nvar start=Math.max(group.start,drawRange.start);\nvar end=Math.min(index.count,Math.min(group.start+group.count,drawRange.start+drawRange.count));\n\nfor(var j=start,jl=end;j<jl;j+=3){\n\nvar a=index.getX(j);\nvar b=index.getX(j+1);\nvar c=index.getX(j+2);\n\nintersection=checkBufferGeometryIntersection(this,groupMaterial,raycaster,_ray$2,position,morphPosition,morphTargetsRelative,uv,uv2,a,b,c);\n\nif(intersection){\n\nintersection.faceIndex=Math.floor(j/3);// triangle number in indexed buffer semantics\nintersection.face.materialIndex=group.materialIndex;\nintersects.push(intersection);\n\n}\n\n}\n\n}\n\n}else{\n\nvar _start3=Math.max(0,drawRange.start);\nvar _end2=Math.min(index.count,drawRange.start+drawRange.count);\n\nfor(var _i15=_start3,_il6=_end2;_i15<_il6;_i15+=3){\n\nvar _a=index.getX(_i15);\nvar _b=index.getX(_i15+1);\nvar _c=index.getX(_i15+2);\n\nintersection=checkBufferGeometryIntersection(this,material,raycaster,_ray$2,position,morphPosition,morphTargetsRelative,uv,uv2,_a,_b,_c);\n\nif(intersection){\n\nintersection.faceIndex=Math.floor(_i15/3);// triangle number in indexed buffer semantics\nintersects.push(intersection);\n\n}\n\n}\n\n}\n\n}else if(position!==undefined){\n\n// non-indexed buffer geometry\n\nif(Array.isArray(material)){\n\nfor(var _i16=0,_il7=groups.length;_i16<_il7;_i16++){\n\nvar _group2=groups[_i16];\nvar _groupMaterial=material[_group2.materialIndex];\n\nvar _start4=Math.max(_group2.start,drawRange.start);\nvar _end3=Math.min(position.count,Math.min(_group2.start+_group2.count,drawRange.start+drawRange.count));\n\nfor(var _j2=_start4,_jl2=_end3;_j2<_jl2;_j2+=3){\n\nvar _a2=_j2;\nvar _b2=_j2+1;\nvar _c2=_j2+2;\n\nintersection=checkBufferGeometryIntersection(this,_groupMaterial,raycaster,_ray$2,position,morphPosition,morphTargetsRelative,uv,uv2,_a2,_b2,_c2);\n\nif(intersection){\n\nintersection.faceIndex=Math.floor(_j2/3);// triangle number in non-indexed buffer semantics\nintersection.face.materialIndex=_group2.materialIndex;\nintersects.push(intersection);\n\n}\n\n}\n\n}\n\n}else{\n\nvar _start5=Math.max(0,drawRange.start);\nvar _end4=Math.min(position.count,drawRange.start+drawRange.count);\n\nfor(var _i17=_start5,_il8=_end4;_i17<_il8;_i17+=3){\n\nvar _a3=_i17;\nvar _b3=_i17+1;\nvar _c3=_i17+2;\n\nintersection=checkBufferGeometryIntersection(this,material,raycaster,_ray$2,position,morphPosition,morphTargetsRelative,uv,uv2,_a3,_b3,_c3);\n\nif(intersection){\n\nintersection.faceIndex=Math.floor(_i17/3);// triangle number in non-indexed buffer semantics\nintersects.push(intersection);\n\n}\n\n}\n\n}\n\n}\n\n}}]);return Mesh;}(Object3D);\n\n\n\nfunction checkIntersection(object,material,raycaster,ray,pA,pB,pC,point){\n\nvar intersect=void 0;\n\nif(material.side===BackSide){\n\nintersect=ray.intersectTriangle(pC,pB,pA,true,point);\n\n}else{\n\nintersect=ray.intersectTriangle(pA,pB,pC,material.side!==DoubleSide,point);\n\n}\n\nif(intersect===null)return null;\n\n_intersectionPointWorld.copy(point);\n_intersectionPointWorld.applyMatrix4(object.matrixWorld);\n\nvar distance=raycaster.ray.origin.distanceTo(_intersectionPointWorld);\n\nif(distance<raycaster.near||distance>raycaster.far)return null;\n\nreturn{\ndistance:distance,\npoint:_intersectionPointWorld.clone(),\nobject:object};\n\n\n}\n\nfunction checkBufferGeometryIntersection(object,material,raycaster,ray,position,morphPosition,morphTargetsRelative,uv,uv2,a,b,c){\n\n_vA$1.fromBufferAttribute(position,a);\n_vB$1.fromBufferAttribute(position,b);\n_vC$1.fromBufferAttribute(position,c);\n\nvar morphInfluences=object.morphTargetInfluences;\n\nif(morphPosition&&morphInfluences){\n\n_morphA.set(0,0,0);\n_morphB.set(0,0,0);\n_morphC.set(0,0,0);\n\nfor(var i=0,il=morphPosition.length;i<il;i++){\n\nvar influence=morphInfluences[i];\nvar morphAttribute=morphPosition[i];\n\nif(influence===0)continue;\n\n_tempA.fromBufferAttribute(morphAttribute,a);\n_tempB.fromBufferAttribute(morphAttribute,b);\n_tempC.fromBufferAttribute(morphAttribute,c);\n\nif(morphTargetsRelative){\n\n_morphA.addScaledVector(_tempA,influence);\n_morphB.addScaledVector(_tempB,influence);\n_morphC.addScaledVector(_tempC,influence);\n\n}else{\n\n_morphA.addScaledVector(_tempA.sub(_vA$1),influence);\n_morphB.addScaledVector(_tempB.sub(_vB$1),influence);\n_morphC.addScaledVector(_tempC.sub(_vC$1),influence);\n\n}\n\n}\n\n_vA$1.add(_morphA);\n_vB$1.add(_morphB);\n_vC$1.add(_morphC);\n\n}\n\nif(object.isSkinnedMesh){\n\nobject.boneTransform(a,_vA$1);\nobject.boneTransform(b,_vB$1);\nobject.boneTransform(c,_vC$1);\n\n}\n\nvar intersection=checkIntersection(object,material,raycaster,ray,_vA$1,_vB$1,_vC$1,_intersectionPoint);\n\nif(intersection){\n\nif(uv){\n\n_uvA$1.fromBufferAttribute(uv,a);\n_uvB$1.fromBufferAttribute(uv,b);\n_uvC$1.fromBufferAttribute(uv,c);\n\nintersection.uv=Triangle.getUV(_intersectionPoint,_vA$1,_vB$1,_vC$1,_uvA$1,_uvB$1,_uvC$1,new Vector2());\n\n}\n\nif(uv2){\n\n_uvA$1.fromBufferAttribute(uv2,a);\n_uvB$1.fromBufferAttribute(uv2,b);\n_uvC$1.fromBufferAttribute(uv2,c);\n\nintersection.uv2=Triangle.getUV(_intersectionPoint,_vA$1,_vB$1,_vC$1,_uvA$1,_uvB$1,_uvC$1,new Vector2());\n\n}\n\nvar face={\na:a,\nb:b,\nc:c,\nnormal:new Vector3(),\nmaterialIndex:0};\n\n\nTriangle.getNormal(_vA$1,_vB$1,_vC$1,face.normal);\n\nintersection.face=face;\n\n}\n\nreturn intersection;\n\n}var\n\nBoxGeometry=function(_BufferGeometry){_inherits(BoxGeometry,_BufferGeometry);\n\nfunction BoxGeometry(){var width=arguments.length>0&&arguments[0]!==undefined?arguments[0]:1;var height=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1;var depth=arguments.length>2&&arguments[2]!==undefined?arguments[2]:1;var widthSegments=arguments.length>3&&arguments[3]!==undefined?arguments[3]:1;var heightSegments=arguments.length>4&&arguments[4]!==undefined?arguments[4]:1;var depthSegments=arguments.length>5&&arguments[5]!==undefined?arguments[5]:1;_classCallCheck(this,BoxGeometry);var _this24=_possibleConstructorReturn(this,(BoxGeometry.__proto__||Object.getPrototypeOf(BoxGeometry)).call(this));\n\n\n\n_this24.type='BoxGeometry';\n\n_this24.parameters={\nwidth:width,\nheight:height,\ndepth:depth,\nwidthSegments:widthSegments,\nheightSegments:heightSegments,\ndepthSegments:depthSegments};\n\n\nvar scope=_this24;\n\n// segments\n\nwidthSegments=Math.floor(widthSegments);\nheightSegments=Math.floor(heightSegments);\ndepthSegments=Math.floor(depthSegments);\n\n// buffers\n\nvar indices=[];\nvar vertices=[];\nvar normals=[];\nvar uvs=[];\n\n// helper variables\n\nvar numberOfVertices=0;\nvar groupStart=0;\n\n// build each side of the box geometry\n\nbuildPlane('z','y','x',-1,-1,depth,height,width,depthSegments,heightSegments,0);// px\nbuildPlane('z','y','x',1,-1,depth,height,-width,depthSegments,heightSegments,1);// nx\nbuildPlane('x','z','y',1,1,width,depth,height,widthSegments,depthSegments,2);// py\nbuildPlane('x','z','y',1,-1,width,depth,-height,widthSegments,depthSegments,3);// ny\nbuildPlane('x','y','z',1,-1,width,height,depth,widthSegments,heightSegments,4);// pz\nbuildPlane('x','y','z',-1,-1,width,height,-depth,widthSegments,heightSegments,5);// nz\n\n// build geometry\n\n_this24.setIndex(indices);\n_this24.setAttribute('position',new Float32BufferAttribute(vertices,3));\n_this24.setAttribute('normal',new Float32BufferAttribute(normals,3));\n_this24.setAttribute('uv',new Float32BufferAttribute(uvs,2));\n\nfunction buildPlane(u,v,w,udir,vdir,width,height,depth,gridX,gridY,materialIndex){\n\nvar segmentWidth=width/gridX;\nvar segmentHeight=height/gridY;\n\nvar widthHalf=width/2;\nvar heightHalf=height/2;\nvar depthHalf=depth/2;\n\nvar gridX1=gridX+1;\nvar gridY1=gridY+1;\n\nvar vertexCounter=0;\nvar groupCount=0;\n\nvar vector=new Vector3();\n\n// generate vertices, normals and uvs\n\nfor(var iy=0;iy<gridY1;iy++){\n\nvar y=iy*segmentHeight-heightHalf;\n\nfor(var ix=0;ix<gridX1;ix++){\n\nvar x=ix*segmentWidth-widthHalf;\n\n// set values to correct vector component\n\nvector[u]=x*udir;\nvector[v]=y*vdir;\nvector[w]=depthHalf;\n\n// now apply vector to vertex buffer\n\nvertices.push(vector.x,vector.y,vector.z);\n\n// set values to correct vector component\n\nvector[u]=0;\nvector[v]=0;\nvector[w]=depth>0?1:-1;\n\n// now apply vector to normal buffer\n\nnormals.push(vector.x,vector.y,vector.z);\n\n// uvs\n\nuvs.push(ix/gridX);\nuvs.push(1-iy/gridY);\n\n// counters\n\nvertexCounter+=1;\n\n}\n\n}\n\n// indices\n\n// 1. you need three indices to draw a single face\n// 2. a single segment consists of two faces\n// 3. so we need to generate six (2*3) indices per segment\n\nfor(var _iy=0;_iy<gridY;_iy++){\n\nfor(var _ix=0;_ix<gridX;_ix++){\n\nvar a=numberOfVertices+_ix+gridX1*_iy;\nvar b=numberOfVertices+_ix+gridX1*(_iy+1);\nvar c=numberOfVertices+(_ix+1)+gridX1*(_iy+1);\nvar d=numberOfVertices+(_ix+1)+gridX1*_iy;\n\n// faces\n\nindices.push(a,b,d);\nindices.push(b,c,d);\n\n// increase counter\n\ngroupCount+=6;\n\n}\n\n}\n\n// add a group to the geometry. this will ensure multi material support\n\nscope.addGroup(groupStart,groupCount,materialIndex);\n\n// calculate new start value for groups\n\ngroupStart+=groupCount;\n\n// update total number of vertices\n\nnumberOfVertices+=vertexCounter;\n\n}return _this24;\n\n}_createClass(BoxGeometry,null,[{key:'fromJSON',value:function fromJSON(\n\ndata){\n\nreturn new BoxGeometry(data.width,data.height,data.depth,data.widthSegments,data.heightSegments,data.depthSegments);\n\n}}]);return BoxGeometry;}(BufferGeometry);\n\n\n\n/**\n * Uniform Utilities\n */\n\nfunction cloneUniforms(src){\n\nvar dst={};\n\nfor(var u in src){\n\ndst[u]={};\n\nfor(var p in src[u]){\n\nvar property=src[u][p];\n\nif(property&&(property.isColor||\nproperty.isMatrix3||property.isMatrix4||\nproperty.isVector2||property.isVector3||property.isVector4||\nproperty.isTexture||property.isQuaternion)){\n\ndst[u][p]=property.clone();\n\n}else if(Array.isArray(property)){\n\ndst[u][p]=property.slice();\n\n}else{\n\ndst[u][p]=property;\n\n}\n\n}\n\n}\n\nreturn dst;\n\n}\n\nfunction mergeUniforms(uniforms){\n\nvar merged={};\n\nfor(var u=0;u<uniforms.length;u++){\n\nvar _tmp=cloneUniforms(uniforms[u]);\n\nfor(var p in _tmp){\n\nmerged[p]=_tmp[p];\n\n}\n\n}\n\nreturn merged;\n\n}\n\n// Legacy\n\nvar UniformsUtils={clone:cloneUniforms,merge:mergeUniforms};\n\nvar default_vertex=\"void main() {\\n\\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\\n}\";\n\nvar default_fragment=\"void main() {\\n\\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\\n}\";var\n\nShaderMaterial=function(_Material2){_inherits(ShaderMaterial,_Material2);\n\nfunction ShaderMaterial(parameters){_classCallCheck(this,ShaderMaterial);var _this25=_possibleConstructorReturn(this,(ShaderMaterial.__proto__||Object.getPrototypeOf(ShaderMaterial)).call(this));\n\n\n\n_this25.isShaderMaterial=true;\n\n_this25.type='ShaderMaterial';\n\n_this25.defines={};\n_this25.uniforms={};\n\n_this25.vertexShader=default_vertex;\n_this25.fragmentShader=default_fragment;\n\n_this25.linewidth=1;\n\n_this25.wireframe=false;\n_this25.wireframeLinewidth=1;\n\n_this25.fog=false;// set to use scene fog\n_this25.lights=false;// set to use scene lights\n_this25.clipping=false;// set to use user-defined clipping planes\n\n_this25.extensions={\nderivatives:false,// set to use derivatives\nfragDepth:false,// set to use fragment depth values\ndrawBuffers:false,// set to use draw buffers\nshaderTextureLOD:false// set to use shader texture LOD\n};\n\n// When rendered geometry doesn't include these attributes but the material does,\n// use these default values in WebGL. This avoids errors when buffer data is missing.\n_this25.defaultAttributeValues={\n'color':[1,1,1],\n'uv':[0,0],\n'uv2':[0,0]};\n\n\n_this25.index0AttributeName=undefined;\n_this25.uniformsNeedUpdate=false;\n\n_this25.glslVersion=null;\n\nif(parameters!==undefined){\n\nif(parameters.attributes!==undefined){\n\nconsole.error('THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead.');\n\n}\n\n_this25.setValues(parameters);\n\n}return _this25;\n\n}_createClass(ShaderMaterial,[{key:'copy',value:function copy(\n\nsource){\n\n_get(ShaderMaterial.prototype.__proto__||Object.getPrototypeOf(ShaderMaterial.prototype),'copy',this).call(this,source);\n\nthis.fragmentShader=source.fragmentShader;\nthis.vertexShader=source.vertexShader;\n\nthis.uniforms=cloneUniforms(source.uniforms);\n\nthis.defines=Object.assign({},source.defines);\n\nthis.wireframe=source.wireframe;\nthis.wireframeLinewidth=source.wireframeLinewidth;\n\nthis.fog=source.fog;\nthis.lights=source.lights;\nthis.clipping=source.clipping;\n\nthis.extensions=Object.assign({},source.extensions);\n\nthis.glslVersion=source.glslVersion;\n\nreturn this;\n\n}},{key:'toJSON',value:function toJSON(\n\nmeta){\n\nvar data=_get(ShaderMaterial.prototype.__proto__||Object.getPrototypeOf(ShaderMaterial.prototype),'toJSON',this).call(this,meta);\n\ndata.glslVersion=this.glslVersion;\ndata.uniforms={};\n\nfor(var name in this.uniforms){\n\nvar uniform=this.uniforms[name];\nvar _value=uniform.value;\n\nif(_value&&_value.isTexture){\n\ndata.uniforms[name]={\ntype:'t',\nvalue:_value.toJSON(meta).uuid};\n\n\n}else if(_value&&_value.isColor){\n\ndata.uniforms[name]={\ntype:'c',\nvalue:_value.getHex()};\n\n\n}else if(_value&&_value.isVector2){\n\ndata.uniforms[name]={\ntype:'v2',\nvalue:_value.toArray()};\n\n\n}else if(_value&&_value.isVector3){\n\ndata.uniforms[name]={\ntype:'v3',\nvalue:_value.toArray()};\n\n\n}else if(_value&&_value.isVector4){\n\ndata.uniforms[name]={\ntype:'v4',\nvalue:_value.toArray()};\n\n\n}else if(_value&&_value.isMatrix3){\n\ndata.uniforms[name]={\ntype:'m3',\nvalue:_value.toArray()};\n\n\n}else if(_value&&_value.isMatrix4){\n\ndata.uniforms[name]={\ntype:'m4',\nvalue:_value.toArray()};\n\n\n}else{\n\ndata.uniforms[name]={\nvalue:_value};\n\n\n// note: the array variants v2v, v3v, v4v, m4v and tv are not supported so far\n\n}\n\n}\n\nif(Object.keys(this.defines).length>0)data.defines=this.defines;\n\ndata.vertexShader=this.vertexShader;\ndata.fragmentShader=this.fragmentShader;\n\nvar extensions={};\n\nfor(var key in this.extensions){\n\nif(this.extensions[key]===true)extensions[key]=true;\n\n}\n\nif(Object.keys(extensions).length>0)data.extensions=extensions;\n\nreturn data;\n\n}}]);return ShaderMaterial;}(Material);var\n\n\n\nCamera=function(_Object3D2){_inherits(Camera,_Object3D2);\n\nfunction Camera(){_classCallCheck(this,Camera);var _this26=_possibleConstructorReturn(this,(Camera.__proto__||Object.getPrototypeOf(Camera)).call(this));\n\n\n\n_this26.isCamera=true;\n\n_this26.type='Camera';\n\n_this26.matrixWorldInverse=new Matrix4();\n\n_this26.projectionMatrix=new Matrix4();\n_this26.projectionMatrixInverse=new Matrix4();return _this26;\n\n}_createClass(Camera,[{key:'copy',value:function copy(\n\nsource,recursive){\n\n_get(Camera.prototype.__proto__||Object.getPrototypeOf(Camera.prototype),'copy',this).call(this,source,recursive);\n\nthis.matrixWorldInverse.copy(source.matrixWorldInverse);\n\nthis.projectionMatrix.copy(source.projectionMatrix);\nthis.projectionMatrixInverse.copy(source.projectionMatrixInverse);\n\nreturn this;\n\n}},{key:'getWorldDirection',value:function getWorldDirection(\n\ntarget){\n\nthis.updateWorldMatrix(true,false);\n\nvar e=this.matrixWorld.elements;\n\nreturn target.set(-e[8],-e[9],-e[10]).normalize();\n\n}},{key:'updateMatrixWorld',value:function updateMatrixWorld(\n\nforce){\n\n_get(Camera.prototype.__proto__||Object.getPrototypeOf(Camera.prototype),'updateMatrixWorld',this).call(this,force);\n\nthis.matrixWorldInverse.copy(this.matrixWorld).invert();\n\n}},{key:'updateWorldMatrix',value:function updateWorldMatrix(\n\nupdateParents,updateChildren){\n\n_get(Camera.prototype.__proto__||Object.getPrototypeOf(Camera.prototype),'updateWorldMatrix',this).call(this,updateParents,updateChildren);\n\nthis.matrixWorldInverse.copy(this.matrixWorld).invert();\n\n}},{key:'clone',value:function clone()\n\n{\n\nreturn new this.constructor().copy(this);\n\n}}]);return Camera;}(Object3D);var\n\n\n\nPerspectiveCamera=function(_Camera){_inherits(PerspectiveCamera,_Camera);\n\nfunction PerspectiveCamera(){var fov=arguments.length>0&&arguments[0]!==undefined?arguments[0]:50;var aspect=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1;var near=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0.1;var far=arguments.length>3&&arguments[3]!==undefined?arguments[3]:2000;_classCallCheck(this,PerspectiveCamera);var _this27=_possibleConstructorReturn(this,(PerspectiveCamera.__proto__||Object.getPrototypeOf(PerspectiveCamera)).call(this));\n\n\n\n_this27.isPerspectiveCamera=true;\n\n_this27.type='PerspectiveCamera';\n\n_this27.fov=fov;\n_this27.zoom=1;\n\n_this27.near=near;\n_this27.far=far;\n_this27.focus=10;\n\n_this27.aspect=aspect;\n_this27.view=null;\n\n_this27.filmGauge=35;// width of the film (default in millimeters)\n_this27.filmOffset=0;// horizontal film offset (same unit as gauge)\n\n_this27.updateProjectionMatrix();return _this27;\n\n}_createClass(PerspectiveCamera,[{key:'copy',value:function copy(\n\nsource,recursive){\n\n_get(PerspectiveCamera.prototype.__proto__||Object.getPrototypeOf(PerspectiveCamera.prototype),'copy',this).call(this,source,recursive);\n\nthis.fov=source.fov;\nthis.zoom=source.zoom;\n\nthis.near=source.near;\nthis.far=source.far;\nthis.focus=source.focus;\n\nthis.aspect=source.aspect;\nthis.view=source.view===null?null:Object.assign({},source.view);\n\nthis.filmGauge=source.filmGauge;\nthis.filmOffset=source.filmOffset;\n\nreturn this;\n\n}\n\n/**\n\t * Sets the FOV by focal length in respect to the current .filmGauge.\n\t *\n\t * The default film gauge is 35, so that the focal length can be specified for\n\t * a 35mm (full frame) camera.\n\t *\n\t * Values for focal length and film gauge must have the same unit.\n\t */},{key:'setFocalLength',value:function setFocalLength(\nfocalLength){\n\n/** see {@link http://www.bobatkins.com/photography/technical/field_of_view.html} */\nvar vExtentSlope=0.5*this.getFilmHeight()/focalLength;\n\nthis.fov=RAD2DEG*2*Math.atan(vExtentSlope);\nthis.updateProjectionMatrix();\n\n}\n\n/**\n\t * Calculates the focal length from the current .fov and .filmGauge.\n\t */},{key:'getFocalLength',value:function getFocalLength()\n{\n\nvar vExtentSlope=Math.tan(DEG2RAD*0.5*this.fov);\n\nreturn 0.5*this.getFilmHeight()/vExtentSlope;\n\n}},{key:'getEffectiveFOV',value:function getEffectiveFOV()\n\n{\n\nreturn RAD2DEG*2*Math.atan(\nMath.tan(DEG2RAD*0.5*this.fov)/this.zoom);\n\n}},{key:'getFilmWidth',value:function getFilmWidth()\n\n{\n\n// film not completely covered in portrait format (aspect < 1)\nreturn this.filmGauge*Math.min(this.aspect,1);\n\n}},{key:'getFilmHeight',value:function getFilmHeight()\n\n{\n\n// film not completely covered in landscape format (aspect > 1)\nreturn this.filmGauge/Math.max(this.aspect,1);\n\n}\n\n/**\n\t * Sets an offset in a larger frustum. This is useful for multi-window or\n\t * multi-monitor/multi-machine setups.\n\t *\n\t * For example, if you have 3x2 monitors and each monitor is 1920x1080 and\n\t * the monitors are in grid like this\n\t *\n\t *   +---+---+---+\n\t *   | A | B | C |\n\t *   +---+---+---+\n\t *   | D | E | F |\n\t *   +---+---+---+\n\t *\n\t * then for each monitor you would call it like this\n\t *\n\t *   const w = 1920;\n\t *   const h = 1080;\n\t *   const fullWidth = w * 3;\n\t *   const fullHeight = h * 2;\n\t *\n\t *   --A--\n\t *   camera.setViewOffset( fullWidth, fullHeight, w * 0, h * 0, w, h );\n\t *   --B--\n\t *   camera.setViewOffset( fullWidth, fullHeight, w * 1, h * 0, w, h );\n\t *   --C--\n\t *   camera.setViewOffset( fullWidth, fullHeight, w * 2, h * 0, w, h );\n\t *   --D--\n\t *   camera.setViewOffset( fullWidth, fullHeight, w * 0, h * 1, w, h );\n\t *   --E--\n\t *   camera.setViewOffset( fullWidth, fullHeight, w * 1, h * 1, w, h );\n\t *   --F--\n\t *   camera.setViewOffset( fullWidth, fullHeight, w * 2, h * 1, w, h );\n\t *\n\t *   Note there is no reason monitors have to be the same size or in a grid.\n\t */},{key:'setViewOffset',value:function setViewOffset(\nfullWidth,fullHeight,x,y,width,height){\n\nthis.aspect=fullWidth/fullHeight;\n\nif(this.view===null){\n\nthis.view={\nenabled:true,\nfullWidth:1,\nfullHeight:1,\noffsetX:0,\noffsetY:0,\nwidth:1,\nheight:1};\n\n\n}\n\nthis.view.enabled=true;\nthis.view.fullWidth=fullWidth;\nthis.view.fullHeight=fullHeight;\nthis.view.offsetX=x;\nthis.view.offsetY=y;\nthis.view.width=width;\nthis.view.height=height;\n\nthis.updateProjectionMatrix();\n\n}},{key:'clearViewOffset',value:function clearViewOffset()\n\n{\n\nif(this.view!==null){\n\nthis.view.enabled=false;\n\n}\n\nthis.updateProjectionMatrix();\n\n}},{key:'updateProjectionMatrix',value:function updateProjectionMatrix()\n\n{\n\nvar near=this.near;\nvar top=near*Math.tan(DEG2RAD*0.5*this.fov)/this.zoom;\nvar height=2*top;\nvar width=this.aspect*height;\nvar left=-0.5*width;\nvar view=this.view;\n\nif(this.view!==null&&this.view.enabled){\n\nvar fullWidth=view.fullWidth,\nfullHeight=view.fullHeight;\n\nleft+=view.offsetX*width/fullWidth;\ntop-=view.offsetY*height/fullHeight;\nwidth*=view.width/fullWidth;\nheight*=view.height/fullHeight;\n\n}\n\nvar skew=this.filmOffset;\nif(skew!==0)left+=near*skew/this.getFilmWidth();\n\nthis.projectionMatrix.makePerspective(left,left+width,top,top-height,near,this.far);\n\nthis.projectionMatrixInverse.copy(this.projectionMatrix).invert();\n\n}},{key:'toJSON',value:function toJSON(\n\nmeta){\n\nvar data=_get(PerspectiveCamera.prototype.__proto__||Object.getPrototypeOf(PerspectiveCamera.prototype),'toJSON',this).call(this,meta);\n\ndata.object.fov=this.fov;\ndata.object.zoom=this.zoom;\n\ndata.object.near=this.near;\ndata.object.far=this.far;\ndata.object.focus=this.focus;\n\ndata.object.aspect=this.aspect;\n\nif(this.view!==null)data.object.view=Object.assign({},this.view);\n\ndata.object.filmGauge=this.filmGauge;\ndata.object.filmOffset=this.filmOffset;\n\nreturn data;\n\n}}]);return PerspectiveCamera;}(Camera);\n\n\n\nvar fov=90,aspect=1;var\n\nCubeCamera=function(_Object3D3){_inherits(CubeCamera,_Object3D3);\n\nfunction CubeCamera(near,far,renderTarget){_classCallCheck(this,CubeCamera);var _this28=_possibleConstructorReturn(this,(CubeCamera.__proto__||Object.getPrototypeOf(CubeCamera)).call(this));\n\n\n\n_this28.type='CubeCamera';\n\nif(renderTarget.isWebGLCubeRenderTarget!==true){\n\nconsole.error('THREE.CubeCamera: The constructor now expects an instance of WebGLCubeRenderTarget as third parameter.');\nreturn _possibleConstructorReturn(_this28);\n\n}\n\n_this28.renderTarget=renderTarget;\n\nvar cameraPX=new PerspectiveCamera(fov,aspect,near,far);\ncameraPX.layers=_this28.layers;\ncameraPX.up.set(0,-1,0);\ncameraPX.lookAt(new Vector3(1,0,0));\n_this28.add(cameraPX);\n\nvar cameraNX=new PerspectiveCamera(fov,aspect,near,far);\ncameraNX.layers=_this28.layers;\ncameraNX.up.set(0,-1,0);\ncameraNX.lookAt(new Vector3(-1,0,0));\n_this28.add(cameraNX);\n\nvar cameraPY=new PerspectiveCamera(fov,aspect,near,far);\ncameraPY.layers=_this28.layers;\ncameraPY.up.set(0,0,1);\ncameraPY.lookAt(new Vector3(0,1,0));\n_this28.add(cameraPY);\n\nvar cameraNY=new PerspectiveCamera(fov,aspect,near,far);\ncameraNY.layers=_this28.layers;\ncameraNY.up.set(0,0,-1);\ncameraNY.lookAt(new Vector3(0,-1,0));\n_this28.add(cameraNY);\n\nvar cameraPZ=new PerspectiveCamera(fov,aspect,near,far);\ncameraPZ.layers=_this28.layers;\ncameraPZ.up.set(0,-1,0);\ncameraPZ.lookAt(new Vector3(0,0,1));\n_this28.add(cameraPZ);\n\nvar cameraNZ=new PerspectiveCamera(fov,aspect,near,far);\ncameraNZ.layers=_this28.layers;\ncameraNZ.up.set(0,-1,0);\ncameraNZ.lookAt(new Vector3(0,0,-1));\n_this28.add(cameraNZ);return _this28;\n\n}_createClass(CubeCamera,[{key:'update',value:function update(\n\nrenderer,scene){\n\nif(this.parent===null)this.updateMatrixWorld();\n\nvar renderTarget=this.renderTarget;var _children=_slicedToArray(\n\nthis.children,6),cameraPX=_children[0],cameraNX=_children[1],cameraPY=_children[2],cameraNY=_children[3],cameraPZ=_children[4],cameraNZ=_children[5];\n\nvar currentRenderTarget=renderer.getRenderTarget();\n\nvar currentToneMapping=renderer.toneMapping;\nvar currentXrEnabled=renderer.xr.enabled;\n\nrenderer.toneMapping=NoToneMapping;\nrenderer.xr.enabled=false;\n\nvar generateMipmaps=renderTarget.texture.generateMipmaps;\n\nrenderTarget.texture.generateMipmaps=false;\n\nrenderer.setRenderTarget(renderTarget,0);\nrenderer.render(scene,cameraPX);\n\nrenderer.setRenderTarget(renderTarget,1);\nrenderer.render(scene,cameraNX);\n\nrenderer.setRenderTarget(renderTarget,2);\nrenderer.render(scene,cameraPY);\n\nrenderer.setRenderTarget(renderTarget,3);\nrenderer.render(scene,cameraNY);\n\nrenderer.setRenderTarget(renderTarget,4);\nrenderer.render(scene,cameraPZ);\n\nrenderTarget.texture.generateMipmaps=generateMipmaps;\n\nrenderer.setRenderTarget(renderTarget,5);\nrenderer.render(scene,cameraNZ);\n\nrenderer.setRenderTarget(currentRenderTarget);\n\nrenderer.toneMapping=currentToneMapping;\nrenderer.xr.enabled=currentXrEnabled;\n\nrenderTarget.texture.needsPMREMUpdate=true;\n\n}}]);return CubeCamera;}(Object3D);var\n\n\n\nCubeTexture=function(_Texture3){_inherits(CubeTexture,_Texture3);\n\nfunction CubeTexture(images,mapping,wrapS,wrapT,magFilter,minFilter,format,type,anisotropy,encoding){_classCallCheck(this,CubeTexture);\n\nimages=images!==undefined?images:[];\nmapping=mapping!==undefined?mapping:CubeReflectionMapping;var _this29=_possibleConstructorReturn(this,(CubeTexture.__proto__||Object.getPrototypeOf(CubeTexture)).call(this,\n\nimages,mapping,wrapS,wrapT,magFilter,minFilter,format,type,anisotropy,encoding));\n\n_this29.isCubeTexture=true;\n\n_this29.flipY=false;return _this29;\n\n}_createClass(CubeTexture,[{key:'images',get:function get()\n\n{\n\nreturn this.image;\n\n},set:function set(\n\nvalue){\n\nthis.image=value;\n\n}}]);return CubeTexture;}(Texture);var\n\n\n\nWebGLCubeRenderTarget=function(_WebGLRenderTarget4){_inherits(WebGLCubeRenderTarget,_WebGLRenderTarget4);\n\nfunction WebGLCubeRenderTarget(size){var options=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};_classCallCheck(this,WebGLCubeRenderTarget);var _this30=_possibleConstructorReturn(this,(WebGLCubeRenderTarget.__proto__||Object.getPrototypeOf(WebGLCubeRenderTarget)).call(this,\n\nsize,size,options));\n\n_this30.isWebGLCubeRenderTarget=true;\n\nvar image={width:size,height:size,depth:1};\nvar images=[image,image,image,image,image,image];\n\n_this30.texture=new CubeTexture(images,options.mapping,options.wrapS,options.wrapT,options.magFilter,options.minFilter,options.format,options.type,options.anisotropy,options.encoding);\n\n// By convention -- likely based on the RenderMan spec from the 1990's -- cube maps are specified by WebGL (and three.js)\n// in a coordinate system in which positive-x is to the right when looking up the positive-z axis -- in other words,\n// in a left-handed coordinate system. By continuing this convention, preexisting cube maps continued to render correctly.\n\n// three.js uses a right-handed coordinate system. So environment maps used in three.js appear to have px and nx swapped\n// and the flag isRenderTargetTexture controls this conversion. The flip is not required when using WebGLCubeRenderTarget.texture\n// as a cube texture (this is detected when isRenderTargetTexture is set to true for cube textures).\n\n_this30.texture.isRenderTargetTexture=true;\n\n_this30.texture.generateMipmaps=options.generateMipmaps!==undefined?options.generateMipmaps:false;\n_this30.texture.minFilter=options.minFilter!==undefined?options.minFilter:LinearFilter;return _this30;\n\n}_createClass(WebGLCubeRenderTarget,[{key:'fromEquirectangularTexture',value:function fromEquirectangularTexture(\n\nrenderer,texture){\n\nthis.texture.type=texture.type;\nthis.texture.encoding=texture.encoding;\n\nthis.texture.generateMipmaps=texture.generateMipmaps;\nthis.texture.minFilter=texture.minFilter;\nthis.texture.magFilter=texture.magFilter;\n\nvar shader={\n\nuniforms:{\ntEquirect:{value:null}},\n\n\nvertexShader:/* glsl */'\\n\\n\\t\\t\\t\\tvarying vec3 vWorldDirection;\\n\\n\\t\\t\\t\\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\\n\\n\\t\\t\\t\\t\\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\\n\\n\\t\\t\\t\\t}\\n\\n\\t\\t\\t\\tvoid main() {\\n\\n\\t\\t\\t\\t\\tvWorldDirection = transformDirection( position, modelMatrix );\\n\\n\\t\\t\\t\\t\\t#include <begin_vertex>\\n\\t\\t\\t\\t\\t#include <project_vertex>\\n\\n\\t\\t\\t\\t}\\n\\t\\t\\t',\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nfragmentShader:/* glsl */'\\n\\n\\t\\t\\t\\tuniform sampler2D tEquirect;\\n\\n\\t\\t\\t\\tvarying vec3 vWorldDirection;\\n\\n\\t\\t\\t\\t#include <common>\\n\\n\\t\\t\\t\\tvoid main() {\\n\\n\\t\\t\\t\\t\\tvec3 direction = normalize( vWorldDirection );\\n\\n\\t\\t\\t\\t\\tvec2 sampleUV = equirectUv( direction );\\n\\n\\t\\t\\t\\t\\tgl_FragColor = texture2D( tEquirect, sampleUV );\\n\\n\\t\\t\\t\\t}\\n\\t\\t\\t'};\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nvar geometry=new BoxGeometry(5,5,5);\n\nvar material=new ShaderMaterial({\n\nname:'CubemapFromEquirect',\n\nuniforms:cloneUniforms(shader.uniforms),\nvertexShader:shader.vertexShader,\nfragmentShader:shader.fragmentShader,\nside:BackSide,\nblending:NoBlending});\n\n\n\nmaterial.uniforms.tEquirect.value=texture;\n\nvar mesh=new Mesh(geometry,material);\n\nvar currentMinFilter=texture.minFilter;\n\n// Avoid blurred poles\nif(texture.minFilter===LinearMipmapLinearFilter)texture.minFilter=LinearFilter;\n\nvar camera=new CubeCamera(1,10,this);\ncamera.update(renderer,mesh);\n\ntexture.minFilter=currentMinFilter;\n\nmesh.geometry.dispose();\nmesh.material.dispose();\n\nreturn this;\n\n}},{key:'clear',value:function clear(\n\nrenderer,color,depth,stencil){\n\nvar currentRenderTarget=renderer.getRenderTarget();\n\nfor(var i=0;i<6;i++){\n\nrenderer.setRenderTarget(this,i);\n\nrenderer.clear(color,depth,stencil);\n\n}\n\nrenderer.setRenderTarget(currentRenderTarget);\n\n}}]);return WebGLCubeRenderTarget;}(WebGLRenderTarget);\n\n\n\nvar _vector1=/*@__PURE__*/new Vector3();\nvar _vector2=/*@__PURE__*/new Vector3();\nvar _normalMatrix=/*@__PURE__*/new Matrix3();var\n\nPlane=function(){\n\nfunction Plane(){var normal=arguments.length>0&&arguments[0]!==undefined?arguments[0]:new Vector3(1,0,0);var constant=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;_classCallCheck(this,Plane);\n\nthis.isPlane=true;\n\n// normal is assumed to be normalized\n\nthis.normal=normal;\nthis.constant=constant;\n\n}_createClass(Plane,[{key:'set',value:function set(\n\nnormal,constant){\n\nthis.normal.copy(normal);\nthis.constant=constant;\n\nreturn this;\n\n}},{key:'setComponents',value:function setComponents(\n\nx,y,z,w){\n\nthis.normal.set(x,y,z);\nthis.constant=w;\n\nreturn this;\n\n}},{key:'setFromNormalAndCoplanarPoint',value:function setFromNormalAndCoplanarPoint(\n\nnormal,point){\n\nthis.normal.copy(normal);\nthis.constant=-point.dot(this.normal);\n\nreturn this;\n\n}},{key:'setFromCoplanarPoints',value:function setFromCoplanarPoints(\n\na,b,c){\n\nvar normal=_vector1.subVectors(c,b).cross(_vector2.subVectors(a,b)).normalize();\n\n// Q: should an error be thrown if normal is zero (e.g. degenerate plane)?\n\nthis.setFromNormalAndCoplanarPoint(normal,a);\n\nreturn this;\n\n}},{key:'copy',value:function copy(\n\nplane){\n\nthis.normal.copy(plane.normal);\nthis.constant=plane.constant;\n\nreturn this;\n\n}},{key:'normalize',value:function normalize()\n\n{\n\n// Note: will lead to a divide by zero if the plane is invalid.\n\nvar inverseNormalLength=1.0/this.normal.length();\nthis.normal.multiplyScalar(inverseNormalLength);\nthis.constant*=inverseNormalLength;\n\nreturn this;\n\n}},{key:'negate',value:function negate()\n\n{\n\nthis.constant*=-1;\nthis.normal.negate();\n\nreturn this;\n\n}},{key:'distanceToPoint',value:function distanceToPoint(\n\npoint){\n\nreturn this.normal.dot(point)+this.constant;\n\n}},{key:'distanceToSphere',value:function distanceToSphere(\n\nsphere){\n\nreturn this.distanceToPoint(sphere.center)-sphere.radius;\n\n}},{key:'projectPoint',value:function projectPoint(\n\npoint,target){\n\nreturn target.copy(this.normal).multiplyScalar(-this.distanceToPoint(point)).add(point);\n\n}},{key:'intersectLine',value:function intersectLine(\n\nline,target){\n\nvar direction=line.delta(_vector1);\n\nvar denominator=this.normal.dot(direction);\n\nif(denominator===0){\n\n// line is coplanar, return origin\nif(this.distanceToPoint(line.start)===0){\n\nreturn target.copy(line.start);\n\n}\n\n// Unsure if this is the correct method to handle this case.\nreturn null;\n\n}\n\nvar t=-(line.start.dot(this.normal)+this.constant)/denominator;\n\nif(t<0||t>1){\n\nreturn null;\n\n}\n\nreturn target.copy(direction).multiplyScalar(t).add(line.start);\n\n}},{key:'intersectsLine',value:function intersectsLine(\n\nline){\n\n// Note: this tests if a line intersects the plane, not whether it (or its end-points) are coplanar with it.\n\nvar startSign=this.distanceToPoint(line.start);\nvar endSign=this.distanceToPoint(line.end);\n\nreturn startSign<0&&endSign>0||endSign<0&&startSign>0;\n\n}},{key:'intersectsBox',value:function intersectsBox(\n\nbox){\n\nreturn box.intersectsPlane(this);\n\n}},{key:'intersectsSphere',value:function intersectsSphere(\n\nsphere){\n\nreturn sphere.intersectsPlane(this);\n\n}},{key:'coplanarPoint',value:function coplanarPoint(\n\ntarget){\n\nreturn target.copy(this.normal).multiplyScalar(-this.constant);\n\n}},{key:'applyMatrix4',value:function applyMatrix4(\n\nmatrix,optionalNormalMatrix){\n\nvar normalMatrix=optionalNormalMatrix||_normalMatrix.getNormalMatrix(matrix);\n\nvar referencePoint=this.coplanarPoint(_vector1).applyMatrix4(matrix);\n\nvar normal=this.normal.applyMatrix3(normalMatrix).normalize();\n\nthis.constant=-referencePoint.dot(normal);\n\nreturn this;\n\n}},{key:'translate',value:function translate(\n\noffset){\n\nthis.constant-=offset.dot(this.normal);\n\nreturn this;\n\n}},{key:'equals',value:function equals(\n\nplane){\n\nreturn plane.normal.equals(this.normal)&&plane.constant===this.constant;\n\n}},{key:'clone',value:function clone()\n\n{\n\nreturn new this.constructor().copy(this);\n\n}}]);return Plane;}();\n\n\n\nvar _sphere$2=/*@__PURE__*/new Sphere();\nvar _vector$7=/*@__PURE__*/new Vector3();var\n\nFrustum=function(){\n\nfunction Frustum(){var p0=arguments.length>0&&arguments[0]!==undefined?arguments[0]:new Plane();var p1=arguments.length>1&&arguments[1]!==undefined?arguments[1]:new Plane();var p2=arguments.length>2&&arguments[2]!==undefined?arguments[2]:new Plane();var p3=arguments.length>3&&arguments[3]!==undefined?arguments[3]:new Plane();var p4=arguments.length>4&&arguments[4]!==undefined?arguments[4]:new Plane();var p5=arguments.length>5&&arguments[5]!==undefined?arguments[5]:new Plane();_classCallCheck(this,Frustum);\n\nthis.planes=[p0,p1,p2,p3,p4,p5];\n\n}_createClass(Frustum,[{key:'set',value:function set(\n\np0,p1,p2,p3,p4,p5){\n\nvar planes=this.planes;\n\nplanes[0].copy(p0);\nplanes[1].copy(p1);\nplanes[2].copy(p2);\nplanes[3].copy(p3);\nplanes[4].copy(p4);\nplanes[5].copy(p5);\n\nreturn this;\n\n}},{key:'copy',value:function copy(\n\nfrustum){\n\nvar planes=this.planes;\n\nfor(var i=0;i<6;i++){\n\nplanes[i].copy(frustum.planes[i]);\n\n}\n\nreturn this;\n\n}},{key:'setFromProjectionMatrix',value:function setFromProjectionMatrix(\n\nm){\n\nvar planes=this.planes;\nvar me=m.elements;\nvar me0=me[0],me1=me[1],me2=me[2],me3=me[3];\nvar me4=me[4],me5=me[5],me6=me[6],me7=me[7];\nvar me8=me[8],me9=me[9],me10=me[10],me11=me[11];\nvar me12=me[12],me13=me[13],me14=me[14],me15=me[15];\n\nplanes[0].setComponents(me3-me0,me7-me4,me11-me8,me15-me12).normalize();\nplanes[1].setComponents(me3+me0,me7+me4,me11+me8,me15+me12).normalize();\nplanes[2].setComponents(me3+me1,me7+me5,me11+me9,me15+me13).normalize();\nplanes[3].setComponents(me3-me1,me7-me5,me11-me9,me15-me13).normalize();\nplanes[4].setComponents(me3-me2,me7-me6,me11-me10,me15-me14).normalize();\nplanes[5].setComponents(me3+me2,me7+me6,me11+me10,me15+me14).normalize();\n\nreturn this;\n\n}},{key:'intersectsObject',value:function intersectsObject(\n\nobject){\n\nvar geometry=object.geometry;\n\nif(geometry.boundingSphere===null)geometry.computeBoundingSphere();\n\n_sphere$2.copy(geometry.boundingSphere).applyMatrix4(object.matrixWorld);\n\nreturn this.intersectsSphere(_sphere$2);\n\n}},{key:'intersectsSprite',value:function intersectsSprite(\n\nsprite){\n\n_sphere$2.center.set(0,0,0);\n_sphere$2.radius=0.7071067811865476;\n_sphere$2.applyMatrix4(sprite.matrixWorld);\n\nreturn this.intersectsSphere(_sphere$2);\n\n}},{key:'intersectsSphere',value:function intersectsSphere(\n\nsphere){\n\nvar planes=this.planes;\nvar center=sphere.center;\nvar negRadius=-sphere.radius;\n\nfor(var i=0;i<6;i++){\n\nvar distance=planes[i].distanceToPoint(center);\n\nif(distance<negRadius){\n\nreturn false;\n\n}\n\n}\n\nreturn true;\n\n}},{key:'intersectsBox',value:function intersectsBox(\n\nbox){\n\nvar planes=this.planes;\n\nfor(var i=0;i<6;i++){\n\nvar plane=planes[i];\n\n// corner at max distance\n\n_vector$7.x=plane.normal.x>0?box.max.x:box.min.x;\n_vector$7.y=plane.normal.y>0?box.max.y:box.min.y;\n_vector$7.z=plane.normal.z>0?box.max.z:box.min.z;\n\nif(plane.distanceToPoint(_vector$7)<0){\n\nreturn false;\n\n}\n\n}\n\nreturn true;\n\n}},{key:'containsPoint',value:function containsPoint(\n\npoint){\n\nvar planes=this.planes;\n\nfor(var i=0;i<6;i++){\n\nif(planes[i].distanceToPoint(point)<0){\n\nreturn false;\n\n}\n\n}\n\nreturn true;\n\n}},{key:'clone',value:function clone()\n\n{\n\nreturn new this.constructor().copy(this);\n\n}}]);return Frustum;}();\n\n\n\nfunction WebGLAnimation(){\n\nvar context=null;\nvar isAnimating=false;\nvar animationLoop=null;\nvar requestId=null;\n\nfunction onAnimationFrame(time,frame){\n\nanimationLoop(time,frame);\n\nrequestId=context.requestAnimationFrame(onAnimationFrame);\n\n}\n\nreturn{\n\nstart:function start(){\n\nif(isAnimating===true)return;\nif(animationLoop===null)return;\n\nrequestId=context.requestAnimationFrame(onAnimationFrame);\n\nisAnimating=true;\n\n},\n\nstop:function stop(){\n\ncontext.cancelAnimationFrame(requestId);\n\nisAnimating=false;\n\n},\n\nsetAnimationLoop:function setAnimationLoop(callback){\n\nanimationLoop=callback;\n\n},\n\nsetContext:function setContext(value){\n\ncontext=value;\n\n}};\n\n\n\n}\n\nfunction WebGLAttributes(gl,capabilities){\n\nvar isWebGL2=capabilities.isWebGL2;\n\nvar buffers=new WeakMap();\n\nfunction createBuffer(attribute,bufferType){\n\nvar array=attribute.array;\nvar usage=attribute.usage;\n\nvar buffer=gl.createBuffer();\n\ngl.bindBuffer(bufferType,buffer);\ngl.bufferData(bufferType,array,usage);\n\nattribute.onUploadCallback();\n\nvar type=void 0;\n\nif(array instanceof Float32Array){\n\ntype=5126;\n\n}else if(array instanceof Uint16Array){\n\nif(attribute.isFloat16BufferAttribute){\n\nif(isWebGL2){\n\ntype=5131;\n\n}else{\n\nthrow new Error('THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.');\n\n}\n\n}else{\n\ntype=5123;\n\n}\n\n}else if(array instanceof Int16Array){\n\ntype=5122;\n\n}else if(array instanceof Uint32Array){\n\ntype=5125;\n\n}else if(array instanceof Int32Array){\n\ntype=5124;\n\n}else if(array instanceof Int8Array){\n\ntype=5120;\n\n}else if(array instanceof Uint8Array){\n\ntype=5121;\n\n}else if(array instanceof Uint8ClampedArray){\n\ntype=5121;\n\n}else{\n\nthrow new Error('THREE.WebGLAttributes: Unsupported buffer data format: '+array);\n\n}\n\nreturn{\nbuffer:buffer,\ntype:type,\nbytesPerElement:array.BYTES_PER_ELEMENT,\nversion:attribute.version};\n\n\n}\n\nfunction updateBuffer(buffer,attribute,bufferType){\n\nvar array=attribute.array;\nvar updateRange=attribute.updateRange;\n\ngl.bindBuffer(bufferType,buffer);\n\nif(updateRange.count===-1){\n\n// Not using update ranges\n\ngl.bufferSubData(bufferType,0,array);\n\n}else{\n\nif(isWebGL2){\n\ngl.bufferSubData(bufferType,updateRange.offset*array.BYTES_PER_ELEMENT,\narray,updateRange.offset,updateRange.count);\n\n}else{\n\ngl.bufferSubData(bufferType,updateRange.offset*array.BYTES_PER_ELEMENT,\narray.subarray(updateRange.offset,updateRange.offset+updateRange.count));\n\n}\n\nupdateRange.count=-1;// reset range\n\n}\n\n}\n\n//\n\nfunction get(attribute){\n\nif(attribute.isInterleavedBufferAttribute)attribute=attribute.data;\n\nreturn buffers.get(attribute);\n\n}\n\nfunction remove(attribute){\n\nif(attribute.isInterleavedBufferAttribute)attribute=attribute.data;\n\nvar data=buffers.get(attribute);\n\nif(data){\n\ngl.deleteBuffer(data.buffer);\n\nbuffers.delete(attribute);\n\n}\n\n}\n\nfunction update(attribute,bufferType){\n\nif(attribute.isGLBufferAttribute){\n\nvar cached=buffers.get(attribute);\n\nif(!cached||cached.version<attribute.version){\n\nbuffers.set(attribute,{\nbuffer:attribute.buffer,\ntype:attribute.type,\nbytesPerElement:attribute.elementSize,\nversion:attribute.version});\n\n\n}\n\nreturn;\n\n}\n\nif(attribute.isInterleavedBufferAttribute)attribute=attribute.data;\n\nvar data=buffers.get(attribute);\n\nif(data===undefined){\n\nbuffers.set(attribute,createBuffer(attribute,bufferType));\n\n}else if(data.version<attribute.version){\n\nupdateBuffer(data.buffer,attribute,bufferType);\n\ndata.version=attribute.version;\n\n}\n\n}\n\nreturn{\n\nget:get,\nremove:remove,\nupdate:update};\n\n\n\n}var\n\nPlaneGeometry=function(_BufferGeometry2){_inherits(PlaneGeometry,_BufferGeometry2);\n\nfunction PlaneGeometry(){var width=arguments.length>0&&arguments[0]!==undefined?arguments[0]:1;var height=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1;var widthSegments=arguments.length>2&&arguments[2]!==undefined?arguments[2]:1;var heightSegments=arguments.length>3&&arguments[3]!==undefined?arguments[3]:1;_classCallCheck(this,PlaneGeometry);var _this31=_possibleConstructorReturn(this,(PlaneGeometry.__proto__||Object.getPrototypeOf(PlaneGeometry)).call(this));\n\n\n_this31.type='PlaneGeometry';\n\n_this31.parameters={\nwidth:width,\nheight:height,\nwidthSegments:widthSegments,\nheightSegments:heightSegments};\n\n\nvar width_half=width/2;\nvar height_half=height/2;\n\nvar gridX=Math.floor(widthSegments);\nvar gridY=Math.floor(heightSegments);\n\nvar gridX1=gridX+1;\nvar gridY1=gridY+1;\n\nvar segment_width=width/gridX;\nvar segment_height=height/gridY;\n\n//\n\nvar indices=[];\nvar vertices=[];\nvar normals=[];\nvar uvs=[];\n\nfor(var iy=0;iy<gridY1;iy++){\n\nvar y=iy*segment_height-height_half;\n\nfor(var ix=0;ix<gridX1;ix++){\n\nvar x=ix*segment_width-width_half;\n\nvertices.push(x,-y,0);\n\nnormals.push(0,0,1);\n\nuvs.push(ix/gridX);\nuvs.push(1-iy/gridY);\n\n}\n\n}\n\nfor(var _iy2=0;_iy2<gridY;_iy2++){\n\nfor(var _ix2=0;_ix2<gridX;_ix2++){\n\nvar a=_ix2+gridX1*_iy2;\nvar b=_ix2+gridX1*(_iy2+1);\nvar c=_ix2+1+gridX1*(_iy2+1);\nvar d=_ix2+1+gridX1*_iy2;\n\nindices.push(a,b,d);\nindices.push(b,c,d);\n\n}\n\n}\n\n_this31.setIndex(indices);\n_this31.setAttribute('position',new Float32BufferAttribute(vertices,3));\n_this31.setAttribute('normal',new Float32BufferAttribute(normals,3));\n_this31.setAttribute('uv',new Float32BufferAttribute(uvs,2));return _this31;\n\n}_createClass(PlaneGeometry,null,[{key:'fromJSON',value:function fromJSON(\n\ndata){\n\nreturn new PlaneGeometry(data.width,data.height,data.widthSegments,data.heightSegments);\n\n}}]);return PlaneGeometry;}(BufferGeometry);\n\n\n\nvar alphamap_fragment=\"#ifdef USE_ALPHAMAP\\n\\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\\n#endif\";\n\nvar alphamap_pars_fragment=\"#ifdef USE_ALPHAMAP\\n\\tuniform sampler2D alphaMap;\\n#endif\";\n\nvar alphatest_fragment=\"#ifdef USE_ALPHATEST\\n\\tif ( diffuseColor.a < alphaTest ) discard;\\n#endif\";\n\nvar alphatest_pars_fragment=\"#ifdef USE_ALPHATEST\\n\\tuniform float alphaTest;\\n#endif\";\n\nvar aomap_fragment=\"#ifdef USE_AOMAP\\n\\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\\n\\treflectedLight.indirectDiffuse *= ambientOcclusion;\\n\\t#if defined( USE_ENVMAP ) && defined( STANDARD )\\n\\t\\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\\n\\t\\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );\\n\\t#endif\\n#endif\";\n\nvar aomap_pars_fragment=\"#ifdef USE_AOMAP\\n\\tuniform sampler2D aoMap;\\n\\tuniform float aoMapIntensity;\\n#endif\";\n\nvar begin_vertex=\"vec3 transformed = vec3( position );\";\n\nvar beginnormal_vertex=\"vec3 objectNormal = vec3( normal );\\n#ifdef USE_TANGENT\\n\\tvec3 objectTangent = vec3( tangent.xyz );\\n#endif\";\n\nvar bsdfs=\"vec3 BRDF_Lambert( const in vec3 diffuseColor ) {\\n\\treturn RECIPROCAL_PI * diffuseColor;\\n}\\nvec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {\\n\\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\\n\\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\\n}\\nfloat F_Schlick( const in float f0, const in float f90, const in float dotVH ) {\\n\\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\\n\\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\\n}\\nvec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {\\n    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );\\n    float x2 = x * x;\\n    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );\\n    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );\\n}\\nfloat V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\\n\\tfloat a2 = pow2( alpha );\\n\\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\\n\\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\\n\\treturn 0.5 / max( gv + gl, EPSILON );\\n}\\nfloat D_GGX( const in float alpha, const in float dotNH ) {\\n\\tfloat a2 = pow2( alpha );\\n\\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\\n\\treturn RECIPROCAL_PI * a2 / pow2( denom );\\n}\\nvec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness ) {\\n\\tfloat alpha = pow2( roughness );\\n\\tvec3 halfDir = normalize( lightDir + viewDir );\\n\\tfloat dotNL = saturate( dot( normal, lightDir ) );\\n\\tfloat dotNV = saturate( dot( normal, viewDir ) );\\n\\tfloat dotNH = saturate( dot( normal, halfDir ) );\\n\\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\\n\\tvec3 F = F_Schlick( f0, f90, dotVH );\\n\\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\\n\\tfloat D = D_GGX( alpha, dotNH );\\n\\treturn F * ( V * D );\\n}\\n#ifdef USE_IRIDESCENCE\\nvec3 BRDF_GGX_Iridescence( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float iridescence, const in vec3 iridescenceFresnel, const in float roughness ) {\\n\\tfloat alpha = pow2( roughness );\\n\\tvec3 halfDir = normalize( lightDir + viewDir );\\n\\tfloat dotNL = saturate( dot( normal, lightDir ) );\\n\\tfloat dotNV = saturate( dot( normal, viewDir ) );\\n\\tfloat dotNH = saturate( dot( normal, halfDir ) );\\n\\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\\n\\tvec3 F = mix(F_Schlick( f0, f90, dotVH ), iridescenceFresnel, iridescence);\\n\\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\\n\\tfloat D = D_GGX( alpha, dotNH );\\n\\treturn F * ( V * D );\\n}\\n#endif\\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\\n\\tconst float LUT_SIZE = 64.0;\\n\\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\\n\\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\\n\\tfloat dotNV = saturate( dot( N, V ) );\\n\\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\\n\\tuv = uv * LUT_SCALE + LUT_BIAS;\\n\\treturn uv;\\n}\\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\\n\\tfloat l = length( f );\\n\\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\\n}\\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\\n\\tfloat x = dot( v1, v2 );\\n\\tfloat y = abs( x );\\n\\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\\n\\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\\n\\tfloat v = a / b;\\n\\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\\n\\treturn cross( v1, v2 ) * theta_sintheta;\\n}\\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\\n\\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\\n\\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\\n\\tvec3 lightNormal = cross( v1, v2 );\\n\\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\\n\\tvec3 T1, T2;\\n\\tT1 = normalize( V - N * dot( V, N ) );\\n\\tT2 = - cross( N, T1 );\\n\\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\\n\\tvec3 coords[ 4 ];\\n\\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\\n\\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\\n\\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\\n\\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\\n\\tcoords[ 0 ] = normalize( coords[ 0 ] );\\n\\tcoords[ 1 ] = normalize( coords[ 1 ] );\\n\\tcoords[ 2 ] = normalize( coords[ 2 ] );\\n\\tcoords[ 3 ] = normalize( coords[ 3 ] );\\n\\tvec3 vectorFormFactor = vec3( 0.0 );\\n\\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\\n\\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\\n\\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\\n\\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\\n\\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\\n\\treturn vec3( result );\\n}\\nfloat G_BlinnPhong_Implicit( ) {\\n\\treturn 0.25;\\n}\\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\\n\\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\\n}\\nvec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {\\n\\tvec3 halfDir = normalize( lightDir + viewDir );\\n\\tfloat dotNH = saturate( dot( normal, halfDir ) );\\n\\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\\n\\tvec3 F = F_Schlick( specularColor, 1.0, dotVH );\\n\\tfloat G = G_BlinnPhong_Implicit( );\\n\\tfloat D = D_BlinnPhong( shininess, dotNH );\\n\\treturn F * ( G * D );\\n}\\n#if defined( USE_SHEEN )\\nfloat D_Charlie( float roughness, float dotNH ) {\\n\\tfloat alpha = pow2( roughness );\\n\\tfloat invAlpha = 1.0 / alpha;\\n\\tfloat cos2h = dotNH * dotNH;\\n\\tfloat sin2h = max( 1.0 - cos2h, 0.0078125 );\\n\\treturn ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );\\n}\\nfloat V_Neubelt( float dotNV, float dotNL ) {\\n\\treturn saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );\\n}\\nvec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {\\n\\tvec3 halfDir = normalize( lightDir + viewDir );\\n\\tfloat dotNL = saturate( dot( normal, lightDir ) );\\n\\tfloat dotNV = saturate( dot( normal, viewDir ) );\\n\\tfloat dotNH = saturate( dot( normal, halfDir ) );\\n\\tfloat D = D_Charlie( sheenRoughness, dotNH );\\n\\tfloat V = V_Neubelt( dotNV, dotNL );\\n\\treturn sheenColor * ( D * V );\\n}\\n#endif\";\n\nvar iridescence_fragment=\"#ifdef USE_IRIDESCENCE\\nconst mat3 XYZ_TO_REC709 = mat3(\\n    3.2404542, -0.9692660,  0.0556434,\\n   -1.5371385,  1.8760108, -0.2040259,\\n   -0.4985314,  0.0415560,  1.0572252\\n);\\nvec3 Fresnel0ToIor( vec3 fresnel0 ) {\\n   vec3 sqrtF0 = sqrt( fresnel0 );\\n   return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );\\n}\\nvec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {\\n   return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );\\n}\\nfloat IorToFresnel0( float transmittedIor, float incidentIor ) {\\n   return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));\\n}\\nvec3 evalSensitivity( float OPD, vec3 shift ) {\\n   float phase = 2.0 * PI * OPD * 1.0e-9;\\n   vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );\\n   vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );\\n   vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );\\n   vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( -pow2( phase ) * var );\\n   xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[0] ) * exp( -4.5282e+09 * pow2( phase ) );\\n   xyz /= 1.0685e-7;\\n   vec3 srgb = XYZ_TO_REC709 * xyz;\\n   return srgb;\\n}\\nvec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {\\n   vec3 I;\\n   float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );\\n   float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );\\n   float cosTheta2Sq = 1.0 - sinTheta2Sq;\\n   if ( cosTheta2Sq < 0.0 ) {\\n       return vec3( 1.0 );\\n   }\\n   float cosTheta2 = sqrt( cosTheta2Sq );\\n   float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );\\n   float R12 = F_Schlick( R0, 1.0, cosTheta1 );\\n   float R21 = R12;\\n   float T121 = 1.0 - R12;\\n   float phi12 = 0.0;\\n   if ( iridescenceIOR < outsideIOR ) phi12 = PI;\\n   float phi21 = PI - phi12;\\n   vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );   vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );\\n   vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );\\n   vec3 phi23 = vec3( 0.0 );\\n   if ( baseIOR[0] < iridescenceIOR ) phi23[0] = PI;\\n   if ( baseIOR[1] < iridescenceIOR ) phi23[1] = PI;\\n   if ( baseIOR[2] < iridescenceIOR ) phi23[2] = PI;\\n   float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;\\n   vec3 phi = vec3( phi21 ) + phi23;\\n   vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );\\n   vec3 r123 = sqrt( R123 );\\n   vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );\\n   vec3 C0 = R12 + Rs;\\n   I = C0;\\n   vec3 Cm = Rs - T121;\\n   for ( int m = 1; m <= 2; ++m ) {\\n       Cm *= r123;\\n       vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );\\n       I += Cm * Sm;\\n   }\\n   return max( I, vec3( 0.0 ) );\\n}\\n#endif\";\n\nvar bumpmap_pars_fragment=\"#ifdef USE_BUMPMAP\\n\\tuniform sampler2D bumpMap;\\n\\tuniform float bumpScale;\\n\\tvec2 dHdxy_fwd() {\\n\\t\\tvec2 dSTdx = dFdx( vUv );\\n\\t\\tvec2 dSTdy = dFdy( vUv );\\n\\t\\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\\n\\t\\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\\n\\t\\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\\n\\t\\treturn vec2( dBx, dBy );\\n\\t}\\n\\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\\n\\t\\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\\n\\t\\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\\n\\t\\tvec3 vN = surf_norm;\\n\\t\\tvec3 R1 = cross( vSigmaY, vN );\\n\\t\\tvec3 R2 = cross( vN, vSigmaX );\\n\\t\\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\\n\\t\\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\\n\\t\\treturn normalize( abs( fDet ) * surf_norm - vGrad );\\n\\t}\\n#endif\";\n\nvar clipping_planes_fragment=\"#if NUM_CLIPPING_PLANES > 0\\n\\tvec4 plane;\\n\\t#pragma unroll_loop_start\\n\\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\\n\\t\\tplane = clippingPlanes[ i ];\\n\\t\\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\\n\\t}\\n\\t#pragma unroll_loop_end\\n\\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\\n\\t\\tbool clipped = true;\\n\\t\\t#pragma unroll_loop_start\\n\\t\\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\\n\\t\\t\\tplane = clippingPlanes[ i ];\\n\\t\\t\\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\\n\\t\\t}\\n\\t\\t#pragma unroll_loop_end\\n\\t\\tif ( clipped ) discard;\\n\\t#endif\\n#endif\";\n\nvar clipping_planes_pars_fragment=\"#if NUM_CLIPPING_PLANES > 0\\n\\tvarying vec3 vClipPosition;\\n\\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\\n#endif\";\n\nvar clipping_planes_pars_vertex=\"#if NUM_CLIPPING_PLANES > 0\\n\\tvarying vec3 vClipPosition;\\n#endif\";\n\nvar clipping_planes_vertex=\"#if NUM_CLIPPING_PLANES > 0\\n\\tvClipPosition = - mvPosition.xyz;\\n#endif\";\n\nvar color_fragment=\"#if defined( USE_COLOR_ALPHA )\\n\\tdiffuseColor *= vColor;\\n#elif defined( USE_COLOR )\\n\\tdiffuseColor.rgb *= vColor;\\n#endif\";\n\nvar color_pars_fragment=\"#if defined( USE_COLOR_ALPHA )\\n\\tvarying vec4 vColor;\\n#elif defined( USE_COLOR )\\n\\tvarying vec3 vColor;\\n#endif\";\n\nvar color_pars_vertex=\"#if defined( USE_COLOR_ALPHA )\\n\\tvarying vec4 vColor;\\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\\n\\tvarying vec3 vColor;\\n#endif\";\n\nvar color_vertex=\"#if defined( USE_COLOR_ALPHA )\\n\\tvColor = vec4( 1.0 );\\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\\n\\tvColor = vec3( 1.0 );\\n#endif\\n#ifdef USE_COLOR\\n\\tvColor *= color;\\n#endif\\n#ifdef USE_INSTANCING_COLOR\\n\\tvColor.xyz *= instanceColor.xyz;\\n#endif\";\n\nvar common=\"#define PI 3.141592653589793\\n#define PI2 6.283185307179586\\n#define PI_HALF 1.5707963267948966\\n#define RECIPROCAL_PI 0.3183098861837907\\n#define RECIPROCAL_PI2 0.15915494309189535\\n#define EPSILON 1e-6\\n#ifndef saturate\\n#define saturate( a ) clamp( a, 0.0, 1.0 )\\n#endif\\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\\nfloat pow2( const in float x ) { return x*x; }\\nvec3 pow2( const in vec3 x ) { return x*x; }\\nfloat pow3( const in float x ) { return x*x*x; }\\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\\nfloat max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }\\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\\nhighp float rand( const in vec2 uv ) {\\n\\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\\n\\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\\n\\treturn fract( sin( sn ) * c );\\n}\\n#ifdef HIGH_PRECISION\\n\\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\\n#else\\n\\tfloat precisionSafeLength( vec3 v ) {\\n\\t\\tfloat maxComponent = max3( abs( v ) );\\n\\t\\treturn length( v / maxComponent ) * maxComponent;\\n\\t}\\n#endif\\nstruct IncidentLight {\\n\\tvec3 color;\\n\\tvec3 direction;\\n\\tbool visible;\\n};\\nstruct ReflectedLight {\\n\\tvec3 directDiffuse;\\n\\tvec3 directSpecular;\\n\\tvec3 indirectDiffuse;\\n\\tvec3 indirectSpecular;\\n};\\nstruct GeometricContext {\\n\\tvec3 position;\\n\\tvec3 normal;\\n\\tvec3 viewDir;\\n#ifdef USE_CLEARCOAT\\n\\tvec3 clearcoatNormal;\\n#endif\\n};\\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\\n\\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\\n}\\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\\n\\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\\n}\\nmat3 transposeMat3( const in mat3 m ) {\\n\\tmat3 tmp;\\n\\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\\n\\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\\n\\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\\n\\treturn tmp;\\n}\\nfloat linearToRelativeLuminance( const in vec3 color ) {\\n\\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\\n\\treturn dot( weights, color.rgb );\\n}\\nbool isPerspectiveMatrix( mat4 m ) {\\n\\treturn m[ 2 ][ 3 ] == - 1.0;\\n}\\nvec2 equirectUv( in vec3 dir ) {\\n\\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\\n\\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\\n\\treturn vec2( u, v );\\n}\";\n\nvar cube_uv_reflection_fragment=\"#ifdef ENVMAP_TYPE_CUBE_UV\\n\\t#define cubeUV_minMipLevel 4.0\\n\\t#define cubeUV_minTileSize 16.0\\n\\tfloat getFace( vec3 direction ) {\\n\\t\\tvec3 absDirection = abs( direction );\\n\\t\\tfloat face = - 1.0;\\n\\t\\tif ( absDirection.x > absDirection.z ) {\\n\\t\\t\\tif ( absDirection.x > absDirection.y )\\n\\t\\t\\t\\tface = direction.x > 0.0 ? 0.0 : 3.0;\\n\\t\\t\\telse\\n\\t\\t\\t\\tface = direction.y > 0.0 ? 1.0 : 4.0;\\n\\t\\t} else {\\n\\t\\t\\tif ( absDirection.z > absDirection.y )\\n\\t\\t\\t\\tface = direction.z > 0.0 ? 2.0 : 5.0;\\n\\t\\t\\telse\\n\\t\\t\\t\\tface = direction.y > 0.0 ? 1.0 : 4.0;\\n\\t\\t}\\n\\t\\treturn face;\\n\\t}\\n\\tvec2 getUV( vec3 direction, float face ) {\\n\\t\\tvec2 uv;\\n\\t\\tif ( face == 0.0 ) {\\n\\t\\t\\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\\n\\t\\t} else if ( face == 1.0 ) {\\n\\t\\t\\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\\n\\t\\t} else if ( face == 2.0 ) {\\n\\t\\t\\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\\n\\t\\t} else if ( face == 3.0 ) {\\n\\t\\t\\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\\n\\t\\t} else if ( face == 4.0 ) {\\n\\t\\t\\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\\n\\t\\t} else {\\n\\t\\t\\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\\n\\t\\t}\\n\\t\\treturn 0.5 * ( uv + 1.0 );\\n\\t}\\n\\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\\n\\t\\tfloat face = getFace( direction );\\n\\t\\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\\n\\t\\tmipInt = max( mipInt, cubeUV_minMipLevel );\\n\\t\\tfloat faceSize = exp2( mipInt );\\n\\t\\tvec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;\\n\\t\\tif ( face > 2.0 ) {\\n\\t\\t\\tuv.y += faceSize;\\n\\t\\t\\tface -= 3.0;\\n\\t\\t}\\n\\t\\tuv.x += face * faceSize;\\n\\t\\tuv.x += filterInt * 3.0 * cubeUV_minTileSize;\\n\\t\\tuv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );\\n\\t\\tuv.x *= CUBEUV_TEXEL_WIDTH;\\n\\t\\tuv.y *= CUBEUV_TEXEL_HEIGHT;\\n\\t\\t#ifdef texture2DGradEXT\\n\\t\\t\\treturn texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;\\n\\t\\t#else\\n\\t\\t\\treturn texture2D( envMap, uv ).rgb;\\n\\t\\t#endif\\n\\t}\\n\\t#define r0 1.0\\n\\t#define v0 0.339\\n\\t#define m0 - 2.0\\n\\t#define r1 0.8\\n\\t#define v1 0.276\\n\\t#define m1 - 1.0\\n\\t#define r4 0.4\\n\\t#define v4 0.046\\n\\t#define m4 2.0\\n\\t#define r5 0.305\\n\\t#define v5 0.016\\n\\t#define m5 3.0\\n\\t#define r6 0.21\\n\\t#define v6 0.0038\\n\\t#define m6 4.0\\n\\tfloat roughnessToMip( float roughness ) {\\n\\t\\tfloat mip = 0.0;\\n\\t\\tif ( roughness >= r1 ) {\\n\\t\\t\\tmip = ( r0 - roughness ) * ( m1 - m0 ) / ( r0 - r1 ) + m0;\\n\\t\\t} else if ( roughness >= r4 ) {\\n\\t\\t\\tmip = ( r1 - roughness ) * ( m4 - m1 ) / ( r1 - r4 ) + m1;\\n\\t\\t} else if ( roughness >= r5 ) {\\n\\t\\t\\tmip = ( r4 - roughness ) * ( m5 - m4 ) / ( r4 - r5 ) + m4;\\n\\t\\t} else if ( roughness >= r6 ) {\\n\\t\\t\\tmip = ( r5 - roughness ) * ( m6 - m5 ) / ( r5 - r6 ) + m5;\\n\\t\\t} else {\\n\\t\\t\\tmip = - 2.0 * log2( 1.16 * roughness );\\t\\t}\\n\\t\\treturn mip;\\n\\t}\\n\\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\\n\\t\\tfloat mip = clamp( roughnessToMip( roughness ), m0, CUBEUV_MAX_MIP );\\n\\t\\tfloat mipF = fract( mip );\\n\\t\\tfloat mipInt = floor( mip );\\n\\t\\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\\n\\t\\tif ( mipF == 0.0 ) {\\n\\t\\t\\treturn vec4( color0, 1.0 );\\n\\t\\t} else {\\n\\t\\t\\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\\n\\t\\t\\treturn vec4( mix( color0, color1, mipF ), 1.0 );\\n\\t\\t}\\n\\t}\\n#endif\";\n\nvar defaultnormal_vertex=\"vec3 transformedNormal = objectNormal;\\n#ifdef USE_INSTANCING\\n\\tmat3 m = mat3( instanceMatrix );\\n\\ttransformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\\n\\ttransformedNormal = m * transformedNormal;\\n#endif\\ntransformedNormal = normalMatrix * transformedNormal;\\n#ifdef FLIP_SIDED\\n\\ttransformedNormal = - transformedNormal;\\n#endif\\n#ifdef USE_TANGENT\\n\\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\\n\\t#ifdef FLIP_SIDED\\n\\t\\ttransformedTangent = - transformedTangent;\\n\\t#endif\\n#endif\";\n\nvar displacementmap_pars_vertex=\"#ifdef USE_DISPLACEMENTMAP\\n\\tuniform sampler2D displacementMap;\\n\\tuniform float displacementScale;\\n\\tuniform float displacementBias;\\n#endif\";\n\nvar displacementmap_vertex=\"#ifdef USE_DISPLACEMENTMAP\\n\\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );\\n#endif\";\n\nvar emissivemap_fragment=\"#ifdef USE_EMISSIVEMAP\\n\\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\\n\\ttotalEmissiveRadiance *= emissiveColor.rgb;\\n#endif\";\n\nvar emissivemap_pars_fragment=\"#ifdef USE_EMISSIVEMAP\\n\\tuniform sampler2D emissiveMap;\\n#endif\";\n\nvar encodings_fragment=\"gl_FragColor = linearToOutputTexel( gl_FragColor );\";\n\nvar encodings_pars_fragment=\"vec4 LinearToLinear( in vec4 value ) {\\n\\treturn value;\\n}\\nvec4 LinearTosRGB( in vec4 value ) {\\n\\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\\n}\";\n\nvar envmap_fragment=\"#ifdef USE_ENVMAP\\n\\t#ifdef ENV_WORLDPOS\\n\\t\\tvec3 cameraToFrag;\\n\\t\\tif ( isOrthographic ) {\\n\\t\\t\\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\\n\\t\\t} else {\\n\\t\\t\\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\\n\\t\\t}\\n\\t\\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\\n\\t\\t#ifdef ENVMAP_MODE_REFLECTION\\n\\t\\t\\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\\n\\t\\t#else\\n\\t\\t\\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\\n\\t\\t#endif\\n\\t#else\\n\\t\\tvec3 reflectVec = vReflect;\\n\\t#endif\\n\\t#ifdef ENVMAP_TYPE_CUBE\\n\\t\\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\\n\\t#elif defined( ENVMAP_TYPE_CUBE_UV )\\n\\t\\tvec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );\\n\\t#else\\n\\t\\tvec4 envColor = vec4( 0.0 );\\n\\t#endif\\n\\t#ifdef ENVMAP_BLENDING_MULTIPLY\\n\\t\\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\\n\\t#elif defined( ENVMAP_BLENDING_MIX )\\n\\t\\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\\n\\t#elif defined( ENVMAP_BLENDING_ADD )\\n\\t\\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\\n\\t#endif\\n#endif\";\n\nvar envmap_common_pars_fragment=\"#ifdef USE_ENVMAP\\n\\tuniform float envMapIntensity;\\n\\tuniform float flipEnvMap;\\n\\t#ifdef ENVMAP_TYPE_CUBE\\n\\t\\tuniform samplerCube envMap;\\n\\t#else\\n\\t\\tuniform sampler2D envMap;\\n\\t#endif\\n\\t\\n#endif\";\n\nvar envmap_pars_fragment=\"#ifdef USE_ENVMAP\\n\\tuniform float reflectivity;\\n\\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\\n\\t\\t#define ENV_WORLDPOS\\n\\t#endif\\n\\t#ifdef ENV_WORLDPOS\\n\\t\\tvarying vec3 vWorldPosition;\\n\\t\\tuniform float refractionRatio;\\n\\t#else\\n\\t\\tvarying vec3 vReflect;\\n\\t#endif\\n#endif\";\n\nvar envmap_pars_vertex=\"#ifdef USE_ENVMAP\\n\\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )\\n\\t\\t#define ENV_WORLDPOS\\n\\t#endif\\n\\t#ifdef ENV_WORLDPOS\\n\\t\\t\\n\\t\\tvarying vec3 vWorldPosition;\\n\\t#else\\n\\t\\tvarying vec3 vReflect;\\n\\t\\tuniform float refractionRatio;\\n\\t#endif\\n#endif\";\n\nvar envmap_vertex=\"#ifdef USE_ENVMAP\\n\\t#ifdef ENV_WORLDPOS\\n\\t\\tvWorldPosition = worldPosition.xyz;\\n\\t#else\\n\\t\\tvec3 cameraToVertex;\\n\\t\\tif ( isOrthographic ) {\\n\\t\\t\\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\\n\\t\\t} else {\\n\\t\\t\\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\\n\\t\\t}\\n\\t\\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\\n\\t\\t#ifdef ENVMAP_MODE_REFLECTION\\n\\t\\t\\tvReflect = reflect( cameraToVertex, worldNormal );\\n\\t\\t#else\\n\\t\\t\\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\\n\\t\\t#endif\\n\\t#endif\\n#endif\";\n\nvar fog_vertex=\"#ifdef USE_FOG\\n\\tvFogDepth = - mvPosition.z;\\n#endif\";\n\nvar fog_pars_vertex=\"#ifdef USE_FOG\\n\\tvarying float vFogDepth;\\n#endif\";\n\nvar fog_fragment=\"#ifdef USE_FOG\\n\\t#ifdef FOG_EXP2\\n\\t\\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );\\n\\t#else\\n\\t\\tfloat fogFactor = smoothstep( fogNear, fogFar, vFogDepth );\\n\\t#endif\\n\\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\\n#endif\";\n\nvar fog_pars_fragment=\"#ifdef USE_FOG\\n\\tuniform vec3 fogColor;\\n\\tvarying float vFogDepth;\\n\\t#ifdef FOG_EXP2\\n\\t\\tuniform float fogDensity;\\n\\t#else\\n\\t\\tuniform float fogNear;\\n\\t\\tuniform float fogFar;\\n\\t#endif\\n#endif\";\n\nvar gradientmap_pars_fragment=\"#ifdef USE_GRADIENTMAP\\n\\tuniform sampler2D gradientMap;\\n#endif\\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\\n\\tfloat dotNL = dot( normal, lightDirection );\\n\\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\\n\\t#ifdef USE_GRADIENTMAP\\n\\t\\treturn vec3( texture2D( gradientMap, coord ).r );\\n\\t#else\\n\\t\\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\\n\\t#endif\\n}\";\n\nvar lightmap_fragment=\"#ifdef USE_LIGHTMAP\\n\\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\\n\\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\\n\\treflectedLight.indirectDiffuse += lightMapIrradiance;\\n#endif\";\n\nvar lightmap_pars_fragment=\"#ifdef USE_LIGHTMAP\\n\\tuniform sampler2D lightMap;\\n\\tuniform float lightMapIntensity;\\n#endif\";\n\nvar lights_lambert_vertex=\"vec3 diffuse = vec3( 1.0 );\\nGeometricContext geometry;\\ngeometry.position = mvPosition.xyz;\\ngeometry.normal = normalize( transformedNormal );\\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );\\nGeometricContext backGeometry;\\nbackGeometry.position = geometry.position;\\nbackGeometry.normal = -geometry.normal;\\nbackGeometry.viewDir = geometry.viewDir;\\nvLightFront = vec3( 0.0 );\\nvIndirectFront = vec3( 0.0 );\\n#ifdef DOUBLE_SIDED\\n\\tvLightBack = vec3( 0.0 );\\n\\tvIndirectBack = vec3( 0.0 );\\n#endif\\nIncidentLight directLight;\\nfloat dotNL;\\nvec3 directLightColor_Diffuse;\\nvIndirectFront += getAmbientLightIrradiance( ambientLightColor );\\nvIndirectFront += getLightProbeIrradiance( lightProbe, geometry.normal );\\n#ifdef DOUBLE_SIDED\\n\\tvIndirectBack += getAmbientLightIrradiance( ambientLightColor );\\n\\tvIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry.normal );\\n#endif\\n#if NUM_POINT_LIGHTS > 0\\n\\t#pragma unroll_loop_start\\n\\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\\n\\t\\tgetPointLightInfo( pointLights[ i ], geometry, directLight );\\n\\t\\tdotNL = dot( geometry.normal, directLight.direction );\\n\\t\\tdirectLightColor_Diffuse = directLight.color;\\n\\t\\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\\n\\t\\t#ifdef DOUBLE_SIDED\\n\\t\\t\\tvLightBack += saturate( - dotNL ) * directLightColor_Diffuse;\\n\\t\\t#endif\\n\\t}\\n\\t#pragma unroll_loop_end\\n#endif\\n#if NUM_SPOT_LIGHTS > 0\\n\\t#pragma unroll_loop_start\\n\\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\\n\\t\\tgetSpotLightInfo( spotLights[ i ], geometry, directLight );\\n\\t\\tdotNL = dot( geometry.normal, directLight.direction );\\n\\t\\tdirectLightColor_Diffuse = directLight.color;\\n\\t\\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\\n\\t\\t#ifdef DOUBLE_SIDED\\n\\t\\t\\tvLightBack += saturate( - dotNL ) * directLightColor_Diffuse;\\n\\t\\t#endif\\n\\t}\\n\\t#pragma unroll_loop_end\\n#endif\\n#if NUM_DIR_LIGHTS > 0\\n\\t#pragma unroll_loop_start\\n\\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\\n\\t\\tgetDirectionalLightInfo( directionalLights[ i ], geometry, directLight );\\n\\t\\tdotNL = dot( geometry.normal, directLight.direction );\\n\\t\\tdirectLightColor_Diffuse = directLight.color;\\n\\t\\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\\n\\t\\t#ifdef DOUBLE_SIDED\\n\\t\\t\\tvLightBack += saturate( - dotNL ) * directLightColor_Diffuse;\\n\\t\\t#endif\\n\\t}\\n\\t#pragma unroll_loop_end\\n#endif\\n#if NUM_HEMI_LIGHTS > 0\\n\\t#pragma unroll_loop_start\\n\\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\\n\\t\\tvIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );\\n\\t\\t#ifdef DOUBLE_SIDED\\n\\t\\t\\tvIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry.normal );\\n\\t\\t#endif\\n\\t}\\n\\t#pragma unroll_loop_end\\n#endif\";\n\nvar lights_pars_begin=\"uniform bool receiveShadow;\\nuniform vec3 ambientLightColor;\\nuniform vec3 lightProbe[ 9 ];\\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\\n\\tfloat x = normal.x, y = normal.y, z = normal.z;\\n\\tvec3 result = shCoefficients[ 0 ] * 0.886227;\\n\\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\\n\\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\\n\\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\\n\\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\\n\\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\\n\\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\\n\\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\\n\\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\\n\\treturn result;\\n}\\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {\\n\\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\\n\\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\\n\\treturn irradiance;\\n}\\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\\n\\tvec3 irradiance = ambientLightColor;\\n\\treturn irradiance;\\n}\\nfloat getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\\n\\t#if defined ( PHYSICALLY_CORRECT_LIGHTS )\\n\\t\\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\\n\\t\\tif ( cutoffDistance > 0.0 ) {\\n\\t\\t\\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\\n\\t\\t}\\n\\t\\treturn distanceFalloff;\\n\\t#else\\n\\t\\tif ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\\n\\t\\t\\treturn pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );\\n\\t\\t}\\n\\t\\treturn 1.0;\\n\\t#endif\\n}\\nfloat getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {\\n\\treturn smoothstep( coneCosine, penumbraCosine, angleCosine );\\n}\\n#if NUM_DIR_LIGHTS > 0\\n\\tstruct DirectionalLight {\\n\\t\\tvec3 direction;\\n\\t\\tvec3 color;\\n\\t};\\n\\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\\n\\tvoid getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {\\n\\t\\tlight.color = directionalLight.color;\\n\\t\\tlight.direction = directionalLight.direction;\\n\\t\\tlight.visible = true;\\n\\t}\\n#endif\\n#if NUM_POINT_LIGHTS > 0\\n\\tstruct PointLight {\\n\\t\\tvec3 position;\\n\\t\\tvec3 color;\\n\\t\\tfloat distance;\\n\\t\\tfloat decay;\\n\\t};\\n\\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\\n\\tvoid getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {\\n\\t\\tvec3 lVector = pointLight.position - geometry.position;\\n\\t\\tlight.direction = normalize( lVector );\\n\\t\\tfloat lightDistance = length( lVector );\\n\\t\\tlight.color = pointLight.color;\\n\\t\\tlight.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );\\n\\t\\tlight.visible = ( light.color != vec3( 0.0 ) );\\n\\t}\\n#endif\\n#if NUM_SPOT_LIGHTS > 0\\n\\tstruct SpotLight {\\n\\t\\tvec3 position;\\n\\t\\tvec3 direction;\\n\\t\\tvec3 color;\\n\\t\\tfloat distance;\\n\\t\\tfloat decay;\\n\\t\\tfloat coneCos;\\n\\t\\tfloat penumbraCos;\\n\\t};\\n\\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\\n\\tvoid getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {\\n\\t\\tvec3 lVector = spotLight.position - geometry.position;\\n\\t\\tlight.direction = normalize( lVector );\\n\\t\\tfloat angleCos = dot( light.direction, spotLight.direction );\\n\\t\\tfloat spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );\\n\\t\\tif ( spotAttenuation > 0.0 ) {\\n\\t\\t\\tfloat lightDistance = length( lVector );\\n\\t\\t\\tlight.color = spotLight.color * spotAttenuation;\\n\\t\\t\\tlight.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );\\n\\t\\t\\tlight.visible = ( light.color != vec3( 0.0 ) );\\n\\t\\t} else {\\n\\t\\t\\tlight.color = vec3( 0.0 );\\n\\t\\t\\tlight.visible = false;\\n\\t\\t}\\n\\t}\\n#endif\\n#if NUM_RECT_AREA_LIGHTS > 0\\n\\tstruct RectAreaLight {\\n\\t\\tvec3 color;\\n\\t\\tvec3 position;\\n\\t\\tvec3 halfWidth;\\n\\t\\tvec3 halfHeight;\\n\\t};\\n\\tuniform sampler2D ltc_1;\\tuniform sampler2D ltc_2;\\n\\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\\n#endif\\n#if NUM_HEMI_LIGHTS > 0\\n\\tstruct HemisphereLight {\\n\\t\\tvec3 direction;\\n\\t\\tvec3 skyColor;\\n\\t\\tvec3 groundColor;\\n\\t};\\n\\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\\n\\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {\\n\\t\\tfloat dotNL = dot( normal, hemiLight.direction );\\n\\t\\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\\n\\t\\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\\n\\t\\treturn irradiance;\\n\\t}\\n#endif\";\n\nvar envmap_physical_pars_fragment=\"#if defined( USE_ENVMAP )\\n\\tvec3 getIBLIrradiance( const in vec3 normal ) {\\n\\t\\t#if defined( ENVMAP_TYPE_CUBE_UV )\\n\\t\\t\\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\\n\\t\\t\\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\\n\\t\\t\\treturn PI * envMapColor.rgb * envMapIntensity;\\n\\t\\t#else\\n\\t\\t\\treturn vec3( 0.0 );\\n\\t\\t#endif\\n\\t}\\n\\tvec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {\\n\\t\\t#if defined( ENVMAP_TYPE_CUBE_UV )\\n\\t\\t\\tvec3 reflectVec = reflect( - viewDir, normal );\\n\\t\\t\\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\\n\\t\\t\\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\\n\\t\\t\\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\\n\\t\\t\\treturn envMapColor.rgb * envMapIntensity;\\n\\t\\t#else\\n\\t\\t\\treturn vec3( 0.0 );\\n\\t\\t#endif\\n\\t}\\n#endif\";\n\nvar lights_toon_fragment=\"ToonMaterial material;\\nmaterial.diffuseColor = diffuseColor.rgb;\";\n\nvar lights_toon_pars_fragment=\"varying vec3 vViewPosition;\\nstruct ToonMaterial {\\n\\tvec3 diffuseColor;\\n};\\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\\n\\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\\n\\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\\n}\\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\\n\\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\\n}\\n#define RE_Direct\\t\\t\\t\\tRE_Direct_Toon\\n#define RE_IndirectDiffuse\\t\\tRE_IndirectDiffuse_Toon\\n#define Material_LightProbeLOD( material )\\t(0)\";\n\nvar lights_phong_fragment=\"BlinnPhongMaterial material;\\nmaterial.diffuseColor = diffuseColor.rgb;\\nmaterial.specularColor = specular;\\nmaterial.specularShininess = shininess;\\nmaterial.specularStrength = specularStrength;\";\n\nvar lights_phong_pars_fragment=\"varying vec3 vViewPosition;\\nstruct BlinnPhongMaterial {\\n\\tvec3 diffuseColor;\\n\\tvec3 specularColor;\\n\\tfloat specularShininess;\\n\\tfloat specularStrength;\\n};\\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\\n\\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\\n\\tvec3 irradiance = dotNL * directLight.color;\\n\\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\\n\\treflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;\\n}\\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\\n\\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\\n}\\n#define RE_Direct\\t\\t\\t\\tRE_Direct_BlinnPhong\\n#define RE_IndirectDiffuse\\t\\tRE_IndirectDiffuse_BlinnPhong\\n#define Material_LightProbeLOD( material )\\t(0)\";\n\nvar lights_physical_fragment=\"PhysicalMaterial material;\\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\\nmaterial.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;\\nmaterial.roughness = min( material.roughness, 1.0 );\\n#ifdef IOR\\n\\t#ifdef SPECULAR\\n\\t\\tfloat specularIntensityFactor = specularIntensity;\\n\\t\\tvec3 specularColorFactor = specularColor;\\n\\t\\t#ifdef USE_SPECULARINTENSITYMAP\\n\\t\\t\\tspecularIntensityFactor *= texture2D( specularIntensityMap, vUv ).a;\\n\\t\\t#endif\\n\\t\\t#ifdef USE_SPECULARCOLORMAP\\n\\t\\t\\tspecularColorFactor *= texture2D( specularColorMap, vUv ).rgb;\\n\\t\\t#endif\\n\\t\\tmaterial.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );\\n\\t#else\\n\\t\\tfloat specularIntensityFactor = 1.0;\\n\\t\\tvec3 specularColorFactor = vec3( 1.0 );\\n\\t\\tmaterial.specularF90 = 1.0;\\n\\t#endif\\n\\tmaterial.specularColor = mix( min( pow2( ( ior - 1.0 ) / ( ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );\\n#else\\n\\tmaterial.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );\\n\\tmaterial.specularF90 = 1.0;\\n#endif\\n#ifdef USE_CLEARCOAT\\n\\tmaterial.clearcoat = clearcoat;\\n\\tmaterial.clearcoatRoughness = clearcoatRoughness;\\n\\tmaterial.clearcoatF0 = vec3( 0.04 );\\n\\tmaterial.clearcoatF90 = 1.0;\\n\\t#ifdef USE_CLEARCOATMAP\\n\\t\\tmaterial.clearcoat *= texture2D( clearcoatMap, vUv ).x;\\n\\t#endif\\n\\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\\n\\t\\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;\\n\\t#endif\\n\\tmaterial.clearcoat = saturate( material.clearcoat );\\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\\n\\tmaterial.clearcoatRoughness += geometryRoughness;\\n\\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\\n#endif\\n#ifdef USE_IRIDESCENCE\\n\\tmaterial.iridescence = iridescence;\\n\\tmaterial.iridescenceIOR = iridescenceIOR;\\n\\t#ifdef USE_IRIDESCENCEMAP\\n\\t\\tmaterial.iridescence *= texture2D( iridescenceMap, vUv ).r;\\n\\t#endif\\n\\t#ifdef USE_IRIDESCENCE_THICKNESSMAP\\n\\t\\tmaterial.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vUv ).g + iridescenceThicknessMinimum;\\n\\t#else\\n\\t\\tmaterial.iridescenceThickness = iridescenceThicknessMaximum;\\n\\t#endif\\n#endif\\n#ifdef USE_SHEEN\\n\\tmaterial.sheenColor = sheenColor;\\n\\t#ifdef USE_SHEENCOLORMAP\\n\\t\\tmaterial.sheenColor *= texture2D( sheenColorMap, vUv ).rgb;\\n\\t#endif\\n\\tmaterial.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );\\n\\t#ifdef USE_SHEENROUGHNESSMAP\\n\\t\\tmaterial.sheenRoughness *= texture2D( sheenRoughnessMap, vUv ).a;\\n\\t#endif\\n#endif\";\n\nvar lights_physical_pars_fragment=\"struct PhysicalMaterial {\\n\\tvec3 diffuseColor;\\n\\tfloat roughness;\\n\\tvec3 specularColor;\\n\\tfloat specularF90;\\n\\t#ifdef USE_CLEARCOAT\\n\\t\\tfloat clearcoat;\\n\\t\\tfloat clearcoatRoughness;\\n\\t\\tvec3 clearcoatF0;\\n\\t\\tfloat clearcoatF90;\\n\\t#endif\\n\\t#ifdef USE_IRIDESCENCE\\n\\t\\tfloat iridescence;\\n\\t\\tfloat iridescenceIOR;\\n\\t\\tfloat iridescenceThickness;\\n\\t\\tvec3 iridescenceFresnel;\\n\\t\\tvec3 iridescenceF0;\\n\\t#endif\\n\\t#ifdef USE_SHEEN\\n\\t\\tvec3 sheenColor;\\n\\t\\tfloat sheenRoughness;\\n\\t#endif\\n};\\nvec3 clearcoatSpecular = vec3( 0.0 );\\nvec3 sheenSpecular = vec3( 0.0 );\\nfloat IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness) {\\n\\tfloat dotNV = saturate( dot( normal, viewDir ) );\\n\\tfloat r2 = roughness * roughness;\\n\\tfloat a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;\\n\\tfloat b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;\\n\\tfloat DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );\\n\\treturn saturate( DG * RECIPROCAL_PI );\\n}\\nvec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\\n\\tfloat dotNV = saturate( dot( normal, viewDir ) );\\n\\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\\n\\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\\n\\tvec4 r = roughness * c0 + c1;\\n\\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\\n\\tvec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;\\n\\treturn fab;\\n}\\nvec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {\\n\\tvec2 fab = DFGApprox( normal, viewDir, roughness );\\n\\treturn specularColor * fab.x + specularF90 * fab.y;\\n}\\n#ifdef USE_IRIDESCENCE\\nvoid computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\\n#else\\nvoid computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\\n#endif\\n\\tvec2 fab = DFGApprox( normal, viewDir, roughness );\\n\\t#ifdef USE_IRIDESCENCE\\n\\t\\tvec3 Fr = mix( specularColor, iridescenceF0, iridescence );\\n\\t#else\\n\\t\\tvec3 Fr = specularColor;\\n\\t#endif\\n\\tvec3 FssEss = Fr * fab.x + specularF90 * fab.y;\\n\\tfloat Ess = fab.x + fab.y;\\n\\tfloat Ems = 1.0 - Ess;\\n\\tvec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;\\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\\n\\tsingleScatter += FssEss;\\n\\tmultiScatter += Fms * Ems;\\n}\\n#if NUM_RECT_AREA_LIGHTS > 0\\n\\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\\n\\t\\tvec3 normal = geometry.normal;\\n\\t\\tvec3 viewDir = geometry.viewDir;\\n\\t\\tvec3 position = geometry.position;\\n\\t\\tvec3 lightPos = rectAreaLight.position;\\n\\t\\tvec3 halfWidth = rectAreaLight.halfWidth;\\n\\t\\tvec3 halfHeight = rectAreaLight.halfHeight;\\n\\t\\tvec3 lightColor = rectAreaLight.color;\\n\\t\\tfloat roughness = material.roughness;\\n\\t\\tvec3 rectCoords[ 4 ];\\n\\t\\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\\t\\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\\n\\t\\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\\n\\t\\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\\n\\t\\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\\n\\t\\tvec4 t1 = texture2D( ltc_1, uv );\\n\\t\\tvec4 t2 = texture2D( ltc_2, uv );\\n\\t\\tmat3 mInv = mat3(\\n\\t\\t\\tvec3( t1.x, 0, t1.y ),\\n\\t\\t\\tvec3(    0, 1,    0 ),\\n\\t\\t\\tvec3( t1.z, 0, t1.w )\\n\\t\\t);\\n\\t\\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\\n\\t\\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\\n\\t\\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\\n\\t}\\n#endif\\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\\n\\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\\n\\tvec3 irradiance = dotNL * directLight.color;\\n\\t#ifdef USE_CLEARCOAT\\n\\t\\tfloat dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\\n\\t\\tvec3 ccIrradiance = dotNLcc * directLight.color;\\n\\t\\tclearcoatSpecular += ccIrradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\\n\\t#endif\\n\\t#ifdef USE_SHEEN\\n\\t\\tsheenSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );\\n\\t#endif\\n\\t#ifdef USE_IRIDESCENCE\\n\\t\\treflectedLight.directSpecular += irradiance * BRDF_GGX_Iridescence( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness );\\n\\t#else\\n\\t\\treflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness );\\n\\t#endif\\n\\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\\n}\\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\\n\\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\\n}\\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\\n\\t#ifdef USE_CLEARCOAT\\n\\t\\tclearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\\n\\t#endif\\n\\t#ifdef USE_SHEEN\\n\\t\\tsheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF( geometry.normal, geometry.viewDir, material.sheenRoughness );\\n\\t#endif\\n\\tvec3 singleScattering = vec3( 0.0 );\\n\\tvec3 multiScattering = vec3( 0.0 );\\n\\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\\n\\t#ifdef USE_IRIDESCENCE\\n\\t\\tcomputeMultiscatteringIridescence( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );\\n\\t#else\\n\\t\\tcomputeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );\\n\\t#endif\\n\\tvec3 totalScattering = singleScattering + multiScattering;\\n\\tvec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );\\n\\treflectedLight.indirectSpecular += radiance * singleScattering;\\n\\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\\n\\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\\n}\\n#define RE_Direct\\t\\t\\t\\tRE_Direct_Physical\\n#define RE_Direct_RectArea\\t\\tRE_Direct_RectArea_Physical\\n#define RE_IndirectDiffuse\\t\\tRE_IndirectDiffuse_Physical\\n#define RE_IndirectSpecular\\t\\tRE_IndirectSpecular_Physical\\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\\n\\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\\n}\";\n\nvar lights_fragment_begin=\"\\nGeometricContext geometry;\\ngeometry.position = - vViewPosition;\\ngeometry.normal = normal;\\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\\n#ifdef USE_CLEARCOAT\\n\\tgeometry.clearcoatNormal = clearcoatNormal;\\n#endif\\n#ifdef USE_IRIDESCENCE\\nfloat dotNVi = saturate( dot( normal, geometry.viewDir ) );\\nif ( material.iridescenceThickness == 0.0 ) {\\n\\tmaterial.iridescence = 0.0;\\n} else {\\n\\tmaterial.iridescence = saturate( material.iridescence );\\n}\\nif ( material.iridescence > 0.0 ) {\\n\\tmaterial.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );\\n\\tmaterial.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );\\n}\\n#endif\\nIncidentLight directLight;\\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\\n\\tPointLight pointLight;\\n\\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\\n\\tPointLightShadow pointLightShadow;\\n\\t#endif\\n\\t#pragma unroll_loop_start\\n\\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\\n\\t\\tpointLight = pointLights[ i ];\\n\\t\\tgetPointLightInfo( pointLight, geometry, directLight );\\n\\t\\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\\n\\t\\tpointLightShadow = pointLightShadows[ i ];\\n\\t\\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\\n\\t\\t#endif\\n\\t\\tRE_Direct( directLight, geometry, material, reflectedLight );\\n\\t}\\n\\t#pragma unroll_loop_end\\n#endif\\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\\n\\tSpotLight spotLight;\\n\\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\\n\\tSpotLightShadow spotLightShadow;\\n\\t#endif\\n\\t#pragma unroll_loop_start\\n\\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\\n\\t\\tspotLight = spotLights[ i ];\\n\\t\\tgetSpotLightInfo( spotLight, geometry, directLight );\\n\\t\\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\\n\\t\\tspotLightShadow = spotLightShadows[ i ];\\n\\t\\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\\n\\t\\t#endif\\n\\t\\tRE_Direct( directLight, geometry, material, reflectedLight );\\n\\t}\\n\\t#pragma unroll_loop_end\\n#endif\\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\\n\\tDirectionalLight directionalLight;\\n\\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\\n\\tDirectionalLightShadow directionalLightShadow;\\n\\t#endif\\n\\t#pragma unroll_loop_start\\n\\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\\n\\t\\tdirectionalLight = directionalLights[ i ];\\n\\t\\tgetDirectionalLightInfo( directionalLight, geometry, directLight );\\n\\t\\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\\n\\t\\tdirectionalLightShadow = directionalLightShadows[ i ];\\n\\t\\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\\n\\t\\t#endif\\n\\t\\tRE_Direct( directLight, geometry, material, reflectedLight );\\n\\t}\\n\\t#pragma unroll_loop_end\\n#endif\\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\\n\\tRectAreaLight rectAreaLight;\\n\\t#pragma unroll_loop_start\\n\\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\\n\\t\\trectAreaLight = rectAreaLights[ i ];\\n\\t\\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\\n\\t}\\n\\t#pragma unroll_loop_end\\n#endif\\n#if defined( RE_IndirectDiffuse )\\n\\tvec3 iblIrradiance = vec3( 0.0 );\\n\\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\\n\\tirradiance += getLightProbeIrradiance( lightProbe, geometry.normal );\\n\\t#if ( NUM_HEMI_LIGHTS > 0 )\\n\\t\\t#pragma unroll_loop_start\\n\\t\\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\\n\\t\\t\\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );\\n\\t\\t}\\n\\t\\t#pragma unroll_loop_end\\n\\t#endif\\n#endif\\n#if defined( RE_IndirectSpecular )\\n\\tvec3 radiance = vec3( 0.0 );\\n\\tvec3 clearcoatRadiance = vec3( 0.0 );\\n#endif\";\n\nvar lights_fragment_maps=\"#if defined( RE_IndirectDiffuse )\\n\\t#ifdef USE_LIGHTMAP\\n\\t\\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\\n\\t\\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\\n\\t\\tirradiance += lightMapIrradiance;\\n\\t#endif\\n\\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\\n\\t\\tiblIrradiance += getIBLIrradiance( geometry.normal );\\n\\t#endif\\n#endif\\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\\n\\tradiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );\\n\\t#ifdef USE_CLEARCOAT\\n\\t\\tclearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );\\n\\t#endif\\n#endif\";\n\nvar lights_fragment_end=\"#if defined( RE_IndirectDiffuse )\\n\\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\\n#endif\\n#if defined( RE_IndirectSpecular )\\n\\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\\n#endif\";\n\nvar logdepthbuf_fragment=\"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\\n\\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\\n#endif\";\n\nvar logdepthbuf_pars_fragment=\"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\\n\\tuniform float logDepthBufFC;\\n\\tvarying float vFragDepth;\\n\\tvarying float vIsPerspective;\\n#endif\";\n\nvar logdepthbuf_pars_vertex=\"#ifdef USE_LOGDEPTHBUF\\n\\t#ifdef USE_LOGDEPTHBUF_EXT\\n\\t\\tvarying float vFragDepth;\\n\\t\\tvarying float vIsPerspective;\\n\\t#else\\n\\t\\tuniform float logDepthBufFC;\\n\\t#endif\\n#endif\";\n\nvar logdepthbuf_vertex=\"#ifdef USE_LOGDEPTHBUF\\n\\t#ifdef USE_LOGDEPTHBUF_EXT\\n\\t\\tvFragDepth = 1.0 + gl_Position.w;\\n\\t\\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\\n\\t#else\\n\\t\\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\\n\\t\\t\\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\\n\\t\\t\\tgl_Position.z *= gl_Position.w;\\n\\t\\t}\\n\\t#endif\\n#endif\";\n\nvar map_fragment=\"#ifdef USE_MAP\\n\\tvec4 sampledDiffuseColor = texture2D( map, vUv );\\n\\t#ifdef DECODE_VIDEO_TEXTURE\\n\\t\\tsampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );\\n\\t#endif\\n\\tdiffuseColor *= sampledDiffuseColor;\\n#endif\";\n\nvar map_pars_fragment=\"#ifdef USE_MAP\\n\\tuniform sampler2D map;\\n#endif\";\n\nvar map_particle_fragment=\"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\\n\\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\\n#endif\\n#ifdef USE_MAP\\n\\tdiffuseColor *= texture2D( map, uv );\\n#endif\\n#ifdef USE_ALPHAMAP\\n\\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\\n#endif\";\n\nvar map_particle_pars_fragment=\"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\\n\\tuniform mat3 uvTransform;\\n#endif\\n#ifdef USE_MAP\\n\\tuniform sampler2D map;\\n#endif\\n#ifdef USE_ALPHAMAP\\n\\tuniform sampler2D alphaMap;\\n#endif\";\n\nvar metalnessmap_fragment=\"float metalnessFactor = metalness;\\n#ifdef USE_METALNESSMAP\\n\\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\\n\\tmetalnessFactor *= texelMetalness.b;\\n#endif\";\n\nvar metalnessmap_pars_fragment=\"#ifdef USE_METALNESSMAP\\n\\tuniform sampler2D metalnessMap;\\n#endif\";\n\nvar morphcolor_vertex=\"#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )\\n\\tvColor *= morphTargetBaseInfluence;\\n\\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\\n\\t\\t#if defined( USE_COLOR_ALPHA )\\n\\t\\t\\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];\\n\\t\\t#elif defined( USE_COLOR )\\n\\t\\t\\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];\\n\\t\\t#endif\\n\\t}\\n#endif\";\n\nvar morphnormal_vertex=\"#ifdef USE_MORPHNORMALS\\n\\tobjectNormal *= morphTargetBaseInfluence;\\n\\t#ifdef MORPHTARGETS_TEXTURE\\n\\t\\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\\n\\t\\t\\tif ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];\\n\\t\\t}\\n\\t#else\\n\\t\\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\\n\\t\\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\\n\\t\\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\\n\\t\\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\\n\\t#endif\\n#endif\";\n\nvar morphtarget_pars_vertex=\"#ifdef USE_MORPHTARGETS\\n\\tuniform float morphTargetBaseInfluence;\\n\\t#ifdef MORPHTARGETS_TEXTURE\\n\\t\\tuniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];\\n\\t\\tuniform sampler2DArray morphTargetsTexture;\\n\\t\\tuniform ivec2 morphTargetsTextureSize;\\n\\t\\tvec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {\\n\\t\\t\\tint texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;\\n\\t\\t\\tint y = texelIndex / morphTargetsTextureSize.x;\\n\\t\\t\\tint x = texelIndex - y * morphTargetsTextureSize.x;\\n\\t\\t\\tivec3 morphUV = ivec3( x, y, morphTargetIndex );\\n\\t\\t\\treturn texelFetch( morphTargetsTexture, morphUV, 0 );\\n\\t\\t}\\n\\t#else\\n\\t\\t#ifndef USE_MORPHNORMALS\\n\\t\\t\\tuniform float morphTargetInfluences[ 8 ];\\n\\t\\t#else\\n\\t\\t\\tuniform float morphTargetInfluences[ 4 ];\\n\\t\\t#endif\\n\\t#endif\\n#endif\";\n\nvar morphtarget_vertex=\"#ifdef USE_MORPHTARGETS\\n\\ttransformed *= morphTargetBaseInfluence;\\n\\t#ifdef MORPHTARGETS_TEXTURE\\n\\t\\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\\n\\t\\t\\tif ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];\\n\\t\\t}\\n\\t#else\\n\\t\\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\\n\\t\\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\\n\\t\\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\\n\\t\\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\\n\\t\\t#ifndef USE_MORPHNORMALS\\n\\t\\t\\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\\n\\t\\t\\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\\n\\t\\t\\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\\n\\t\\t\\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\\n\\t\\t#endif\\n\\t#endif\\n#endif\";\n\nvar normal_fragment_begin=\"float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\\n#ifdef FLAT_SHADED\\n\\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\\n\\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\\n\\tvec3 normal = normalize( cross( fdx, fdy ) );\\n#else\\n\\tvec3 normal = normalize( vNormal );\\n\\t#ifdef DOUBLE_SIDED\\n\\t\\tnormal = normal * faceDirection;\\n\\t#endif\\n\\t#ifdef USE_TANGENT\\n\\t\\tvec3 tangent = normalize( vTangent );\\n\\t\\tvec3 bitangent = normalize( vBitangent );\\n\\t\\t#ifdef DOUBLE_SIDED\\n\\t\\t\\ttangent = tangent * faceDirection;\\n\\t\\t\\tbitangent = bitangent * faceDirection;\\n\\t\\t#endif\\n\\t\\t#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )\\n\\t\\t\\tmat3 vTBN = mat3( tangent, bitangent, normal );\\n\\t\\t#endif\\n\\t#endif\\n#endif\\nvec3 geometryNormal = normal;\";\n\nvar normal_fragment_maps=\"#ifdef OBJECTSPACE_NORMALMAP\\n\\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\\n\\t#ifdef FLIP_SIDED\\n\\t\\tnormal = - normal;\\n\\t#endif\\n\\t#ifdef DOUBLE_SIDED\\n\\t\\tnormal = normal * faceDirection;\\n\\t#endif\\n\\tnormal = normalize( normalMatrix * normal );\\n#elif defined( TANGENTSPACE_NORMALMAP )\\n\\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\\n\\tmapN.xy *= normalScale;\\n\\t#ifdef USE_TANGENT\\n\\t\\tnormal = normalize( vTBN * mapN );\\n\\t#else\\n\\t\\tnormal = perturbNormal2Arb( - vViewPosition, normal, mapN, faceDirection );\\n\\t#endif\\n#elif defined( USE_BUMPMAP )\\n\\tnormal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\\n#endif\";\n\nvar normal_pars_fragment=\"#ifndef FLAT_SHADED\\n\\tvarying vec3 vNormal;\\n\\t#ifdef USE_TANGENT\\n\\t\\tvarying vec3 vTangent;\\n\\t\\tvarying vec3 vBitangent;\\n\\t#endif\\n#endif\";\n\nvar normal_pars_vertex=\"#ifndef FLAT_SHADED\\n\\tvarying vec3 vNormal;\\n\\t#ifdef USE_TANGENT\\n\\t\\tvarying vec3 vTangent;\\n\\t\\tvarying vec3 vBitangent;\\n\\t#endif\\n#endif\";\n\nvar normal_vertex=\"#ifndef FLAT_SHADED\\n\\tvNormal = normalize( transformedNormal );\\n\\t#ifdef USE_TANGENT\\n\\t\\tvTangent = normalize( transformedTangent );\\n\\t\\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\\n\\t#endif\\n#endif\";\n\nvar normalmap_pars_fragment=\"#ifdef USE_NORMALMAP\\n\\tuniform sampler2D normalMap;\\n\\tuniform vec2 normalScale;\\n#endif\\n#ifdef OBJECTSPACE_NORMALMAP\\n\\tuniform mat3 normalMatrix;\\n#endif\\n#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )\\n\\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {\\n\\t\\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\\n\\t\\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\\n\\t\\tvec2 st0 = dFdx( vUv.st );\\n\\t\\tvec2 st1 = dFdy( vUv.st );\\n\\t\\tvec3 N = surf_norm;\\n\\t\\tvec3 q1perp = cross( q1, N );\\n\\t\\tvec3 q0perp = cross( N, q0 );\\n\\t\\tvec3 T = q1perp * st0.x + q0perp * st1.x;\\n\\t\\tvec3 B = q1perp * st0.y + q0perp * st1.y;\\n\\t\\tfloat det = max( dot( T, T ), dot( B, B ) );\\n\\t\\tfloat scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );\\n\\t\\treturn normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );\\n\\t}\\n#endif\";\n\nvar clearcoat_normal_fragment_begin=\"#ifdef USE_CLEARCOAT\\n\\tvec3 clearcoatNormal = geometryNormal;\\n#endif\";\n\nvar clearcoat_normal_fragment_maps=\"#ifdef USE_CLEARCOAT_NORMALMAP\\n\\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;\\n\\tclearcoatMapN.xy *= clearcoatNormalScale;\\n\\t#ifdef USE_TANGENT\\n\\t\\tclearcoatNormal = normalize( vTBN * clearcoatMapN );\\n\\t#else\\n\\t\\tclearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );\\n\\t#endif\\n#endif\";\n\nvar clearcoat_pars_fragment=\"#ifdef USE_CLEARCOATMAP\\n\\tuniform sampler2D clearcoatMap;\\n#endif\\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\\n\\tuniform sampler2D clearcoatRoughnessMap;\\n#endif\\n#ifdef USE_CLEARCOAT_NORMALMAP\\n\\tuniform sampler2D clearcoatNormalMap;\\n\\tuniform vec2 clearcoatNormalScale;\\n#endif\";\n\nvar iridescence_pars_fragment=\"#ifdef USE_IRIDESCENCEMAP\\n\\tuniform sampler2D iridescenceMap;\\n#endif\\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\\n\\tuniform sampler2D iridescenceThicknessMap;\\n#endif\";\n\nvar output_fragment=\"#ifdef OPAQUE\\ndiffuseColor.a = 1.0;\\n#endif\\n#ifdef USE_TRANSMISSION\\ndiffuseColor.a *= transmissionAlpha + 0.1;\\n#endif\\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );\";\n\nvar packing=\"vec3 packNormalToRGB( const in vec3 normal ) {\\n\\treturn normalize( normal ) * 0.5 + 0.5;\\n}\\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\\n\\treturn 2.0 * rgb.xyz - 1.0;\\n}\\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\\nconst float ShiftRight8 = 1. / 256.;\\nvec4 packDepthToRGBA( const in float v ) {\\n\\tvec4 r = vec4( fract( v * PackFactors ), v );\\n\\tr.yzw -= r.xyz * ShiftRight8;\\treturn r * PackUpscale;\\n}\\nfloat unpackRGBAToDepth( const in vec4 v ) {\\n\\treturn dot( v, UnpackFactors );\\n}\\nvec4 pack2HalfToRGBA( vec2 v ) {\\n\\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );\\n\\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );\\n}\\nvec2 unpackRGBATo2Half( vec4 v ) {\\n\\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\\n}\\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\\n\\treturn ( viewZ + near ) / ( near - far );\\n}\\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\\n\\treturn linearClipZ * ( near - far ) - near;\\n}\\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\\n\\treturn ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );\\n}\\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\\n\\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\\n}\";\n\nvar premultiplied_alpha_fragment=\"#ifdef PREMULTIPLIED_ALPHA\\n\\tgl_FragColor.rgb *= gl_FragColor.a;\\n#endif\";\n\nvar project_vertex=\"vec4 mvPosition = vec4( transformed, 1.0 );\\n#ifdef USE_INSTANCING\\n\\tmvPosition = instanceMatrix * mvPosition;\\n#endif\\nmvPosition = modelViewMatrix * mvPosition;\\ngl_Position = projectionMatrix * mvPosition;\";\n\nvar dithering_fragment=\"#ifdef DITHERING\\n\\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\\n#endif\";\n\nvar dithering_pars_fragment=\"#ifdef DITHERING\\n\\tvec3 dithering( vec3 color ) {\\n\\t\\tfloat grid_position = rand( gl_FragCoord.xy );\\n\\t\\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\\n\\t\\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\\n\\t\\treturn color + dither_shift_RGB;\\n\\t}\\n#endif\";\n\nvar roughnessmap_fragment=\"float roughnessFactor = roughness;\\n#ifdef USE_ROUGHNESSMAP\\n\\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\\n\\troughnessFactor *= texelRoughness.g;\\n#endif\";\n\nvar roughnessmap_pars_fragment=\"#ifdef USE_ROUGHNESSMAP\\n\\tuniform sampler2D roughnessMap;\\n#endif\";\n\nvar shadowmap_pars_fragment=\"#ifdef USE_SHADOWMAP\\n\\t#if NUM_DIR_LIGHT_SHADOWS > 0\\n\\t\\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\\n\\t\\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\\n\\t\\tstruct DirectionalLightShadow {\\n\\t\\t\\tfloat shadowBias;\\n\\t\\t\\tfloat shadowNormalBias;\\n\\t\\t\\tfloat shadowRadius;\\n\\t\\t\\tvec2 shadowMapSize;\\n\\t\\t};\\n\\t\\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\\n\\t#endif\\n\\t#if NUM_SPOT_LIGHT_SHADOWS > 0\\n\\t\\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\\n\\t\\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\\n\\t\\tstruct SpotLightShadow {\\n\\t\\t\\tfloat shadowBias;\\n\\t\\t\\tfloat shadowNormalBias;\\n\\t\\t\\tfloat shadowRadius;\\n\\t\\t\\tvec2 shadowMapSize;\\n\\t\\t};\\n\\t\\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\\n\\t#endif\\n\\t#if NUM_POINT_LIGHT_SHADOWS > 0\\n\\t\\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\\n\\t\\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\\n\\t\\tstruct PointLightShadow {\\n\\t\\t\\tfloat shadowBias;\\n\\t\\t\\tfloat shadowNormalBias;\\n\\t\\t\\tfloat shadowRadius;\\n\\t\\t\\tvec2 shadowMapSize;\\n\\t\\t\\tfloat shadowCameraNear;\\n\\t\\t\\tfloat shadowCameraFar;\\n\\t\\t};\\n\\t\\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\\n\\t#endif\\n\\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\\n\\t\\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\\n\\t}\\n\\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\\n\\t\\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\\n\\t}\\n\\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\\n\\t\\tfloat occlusion = 1.0;\\n\\t\\tvec2 distribution = texture2DDistribution( shadow, uv );\\n\\t\\tfloat hard_shadow = step( compare , distribution.x );\\n\\t\\tif (hard_shadow != 1.0 ) {\\n\\t\\t\\tfloat distance = compare - distribution.x ;\\n\\t\\t\\tfloat variance = max( 0.00000, distribution.y * distribution.y );\\n\\t\\t\\tfloat softness_probability = variance / (variance + distance * distance );\\t\\t\\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\\t\\t\\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\\n\\t\\t}\\n\\t\\treturn occlusion;\\n\\t}\\n\\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\\n\\t\\tfloat shadow = 1.0;\\n\\t\\tshadowCoord.xyz /= shadowCoord.w;\\n\\t\\tshadowCoord.z += shadowBias;\\n\\t\\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\\n\\t\\tbool inFrustum = all( inFrustumVec );\\n\\t\\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\\n\\t\\tbool frustumTest = all( frustumTestVec );\\n\\t\\tif ( frustumTest ) {\\n\\t\\t#if defined( SHADOWMAP_TYPE_PCF )\\n\\t\\t\\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\\n\\t\\t\\tfloat dx0 = - texelSize.x * shadowRadius;\\n\\t\\t\\tfloat dy0 = - texelSize.y * shadowRadius;\\n\\t\\t\\tfloat dx1 = + texelSize.x * shadowRadius;\\n\\t\\t\\tfloat dy1 = + texelSize.y * shadowRadius;\\n\\t\\t\\tfloat dx2 = dx0 / 2.0;\\n\\t\\t\\tfloat dy2 = dy0 / 2.0;\\n\\t\\t\\tfloat dx3 = dx1 / 2.0;\\n\\t\\t\\tfloat dy3 = dy1 / 2.0;\\n\\t\\t\\tshadow = (\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\\n\\t\\t\\t) * ( 1.0 / 17.0 );\\n\\t\\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\\n\\t\\t\\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\\n\\t\\t\\tfloat dx = texelSize.x;\\n\\t\\t\\tfloat dy = texelSize.y;\\n\\t\\t\\tvec2 uv = shadowCoord.xy;\\n\\t\\t\\tvec2 f = fract( uv * shadowMapSize + 0.5 );\\n\\t\\t\\tuv -= f * texelSize;\\n\\t\\t\\tshadow = (\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\\n\\t\\t\\t\\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), \\n\\t\\t\\t\\t\\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\\n\\t\\t\\t\\t\\t f.x ) +\\n\\t\\t\\t\\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), \\n\\t\\t\\t\\t\\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\\n\\t\\t\\t\\t\\t f.x ) +\\n\\t\\t\\t\\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), \\n\\t\\t\\t\\t\\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\\n\\t\\t\\t\\t\\t f.y ) +\\n\\t\\t\\t\\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), \\n\\t\\t\\t\\t\\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\\n\\t\\t\\t\\t\\t f.y ) +\\n\\t\\t\\t\\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), \\n\\t\\t\\t\\t\\t\\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\\n\\t\\t\\t\\t\\t\\t  f.x ),\\n\\t\\t\\t\\t\\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), \\n\\t\\t\\t\\t\\t\\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\\n\\t\\t\\t\\t\\t\\t  f.x ),\\n\\t\\t\\t\\t\\t f.y )\\n\\t\\t\\t) * ( 1.0 / 9.0 );\\n\\t\\t#elif defined( SHADOWMAP_TYPE_VSM )\\n\\t\\t\\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\\n\\t\\t#else\\n\\t\\t\\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\\n\\t\\t#endif\\n\\t\\t}\\n\\t\\treturn shadow;\\n\\t}\\n\\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\\n\\t\\tvec3 absV = abs( v );\\n\\t\\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\\n\\t\\tabsV *= scaleToCube;\\n\\t\\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\\n\\t\\tvec2 planar = v.xy;\\n\\t\\tfloat almostATexel = 1.5 * texelSizeY;\\n\\t\\tfloat almostOne = 1.0 - almostATexel;\\n\\t\\tif ( absV.z >= almostOne ) {\\n\\t\\t\\tif ( v.z > 0.0 )\\n\\t\\t\\t\\tplanar.x = 4.0 - v.x;\\n\\t\\t} else if ( absV.x >= almostOne ) {\\n\\t\\t\\tfloat signX = sign( v.x );\\n\\t\\t\\tplanar.x = v.z * signX + 2.0 * signX;\\n\\t\\t} else if ( absV.y >= almostOne ) {\\n\\t\\t\\tfloat signY = sign( v.y );\\n\\t\\t\\tplanar.x = v.x + 2.0 * signY + 2.0;\\n\\t\\t\\tplanar.y = v.z * signY - 2.0;\\n\\t\\t}\\n\\t\\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\\n\\t}\\n\\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\\n\\t\\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\\n\\t\\tvec3 lightToPosition = shadowCoord.xyz;\\n\\t\\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\\t\\tdp += shadowBias;\\n\\t\\tvec3 bd3D = normalize( lightToPosition );\\n\\t\\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\\n\\t\\t\\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\\n\\t\\t\\treturn (\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\\n\\t\\t\\t) * ( 1.0 / 9.0 );\\n\\t\\t#else\\n\\t\\t\\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\\n\\t\\t#endif\\n\\t}\\n#endif\";\n\nvar shadowmap_pars_vertex=\"#ifdef USE_SHADOWMAP\\n\\t#if NUM_DIR_LIGHT_SHADOWS > 0\\n\\t\\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\\n\\t\\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\\n\\t\\tstruct DirectionalLightShadow {\\n\\t\\t\\tfloat shadowBias;\\n\\t\\t\\tfloat shadowNormalBias;\\n\\t\\t\\tfloat shadowRadius;\\n\\t\\t\\tvec2 shadowMapSize;\\n\\t\\t};\\n\\t\\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\\n\\t#endif\\n\\t#if NUM_SPOT_LIGHT_SHADOWS > 0\\n\\t\\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];\\n\\t\\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\\n\\t\\tstruct SpotLightShadow {\\n\\t\\t\\tfloat shadowBias;\\n\\t\\t\\tfloat shadowNormalBias;\\n\\t\\t\\tfloat shadowRadius;\\n\\t\\t\\tvec2 shadowMapSize;\\n\\t\\t};\\n\\t\\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\\n\\t#endif\\n\\t#if NUM_POINT_LIGHT_SHADOWS > 0\\n\\t\\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\\n\\t\\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\\n\\t\\tstruct PointLightShadow {\\n\\t\\t\\tfloat shadowBias;\\n\\t\\t\\tfloat shadowNormalBias;\\n\\t\\t\\tfloat shadowRadius;\\n\\t\\t\\tvec2 shadowMapSize;\\n\\t\\t\\tfloat shadowCameraNear;\\n\\t\\t\\tfloat shadowCameraFar;\\n\\t\\t};\\n\\t\\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\\n\\t#endif\\n#endif\";\n\nvar shadowmap_vertex=\"#ifdef USE_SHADOWMAP\\n\\t#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0\\n\\t\\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\\n\\t\\tvec4 shadowWorldPosition;\\n\\t#endif\\n\\t#if NUM_DIR_LIGHT_SHADOWS > 0\\n\\t#pragma unroll_loop_start\\n\\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\\n\\t\\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\\n\\t\\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\\n\\t}\\n\\t#pragma unroll_loop_end\\n\\t#endif\\n\\t#if NUM_SPOT_LIGHT_SHADOWS > 0\\n\\t#pragma unroll_loop_start\\n\\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\\n\\t\\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias, 0 );\\n\\t\\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * shadowWorldPosition;\\n\\t}\\n\\t#pragma unroll_loop_end\\n\\t#endif\\n\\t#if NUM_POINT_LIGHT_SHADOWS > 0\\n\\t#pragma unroll_loop_start\\n\\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\\n\\t\\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\\n\\t\\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\\n\\t}\\n\\t#pragma unroll_loop_end\\n\\t#endif\\n#endif\";\n\nvar shadowmask_pars_fragment=\"float getShadowMask() {\\n\\tfloat shadow = 1.0;\\n\\t#ifdef USE_SHADOWMAP\\n\\t#if NUM_DIR_LIGHT_SHADOWS > 0\\n\\tDirectionalLightShadow directionalLight;\\n\\t#pragma unroll_loop_start\\n\\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\\n\\t\\tdirectionalLight = directionalLightShadows[ i ];\\n\\t\\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\\n\\t}\\n\\t#pragma unroll_loop_end\\n\\t#endif\\n\\t#if NUM_SPOT_LIGHT_SHADOWS > 0\\n\\tSpotLightShadow spotLight;\\n\\t#pragma unroll_loop_start\\n\\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\\n\\t\\tspotLight = spotLightShadows[ i ];\\n\\t\\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\\n\\t}\\n\\t#pragma unroll_loop_end\\n\\t#endif\\n\\t#if NUM_POINT_LIGHT_SHADOWS > 0\\n\\tPointLightShadow pointLight;\\n\\t#pragma unroll_loop_start\\n\\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\\n\\t\\tpointLight = pointLightShadows[ i ];\\n\\t\\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\\n\\t}\\n\\t#pragma unroll_loop_end\\n\\t#endif\\n\\t#endif\\n\\treturn shadow;\\n}\";\n\nvar skinbase_vertex=\"#ifdef USE_SKINNING\\n\\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\\n\\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\\n\\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\\n\\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\\n#endif\";\n\nvar skinning_pars_vertex=\"#ifdef USE_SKINNING\\n\\tuniform mat4 bindMatrix;\\n\\tuniform mat4 bindMatrixInverse;\\n\\tuniform highp sampler2D boneTexture;\\n\\tuniform int boneTextureSize;\\n\\tmat4 getBoneMatrix( const in float i ) {\\n\\t\\tfloat j = i * 4.0;\\n\\t\\tfloat x = mod( j, float( boneTextureSize ) );\\n\\t\\tfloat y = floor( j / float( boneTextureSize ) );\\n\\t\\tfloat dx = 1.0 / float( boneTextureSize );\\n\\t\\tfloat dy = 1.0 / float( boneTextureSize );\\n\\t\\ty = dy * ( y + 0.5 );\\n\\t\\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\\n\\t\\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\\n\\t\\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\\n\\t\\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\\n\\t\\tmat4 bone = mat4( v1, v2, v3, v4 );\\n\\t\\treturn bone;\\n\\t}\\n#endif\";\n\nvar skinning_vertex=\"#ifdef USE_SKINNING\\n\\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\\n\\tvec4 skinned = vec4( 0.0 );\\n\\tskinned += boneMatX * skinVertex * skinWeight.x;\\n\\tskinned += boneMatY * skinVertex * skinWeight.y;\\n\\tskinned += boneMatZ * skinVertex * skinWeight.z;\\n\\tskinned += boneMatW * skinVertex * skinWeight.w;\\n\\ttransformed = ( bindMatrixInverse * skinned ).xyz;\\n#endif\";\n\nvar skinnormal_vertex=\"#ifdef USE_SKINNING\\n\\tmat4 skinMatrix = mat4( 0.0 );\\n\\tskinMatrix += skinWeight.x * boneMatX;\\n\\tskinMatrix += skinWeight.y * boneMatY;\\n\\tskinMatrix += skinWeight.z * boneMatZ;\\n\\tskinMatrix += skinWeight.w * boneMatW;\\n\\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\\n\\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\\n\\t#ifdef USE_TANGENT\\n\\t\\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\\n\\t#endif\\n#endif\";\n\nvar specularmap_fragment=\"float specularStrength;\\n#ifdef USE_SPECULARMAP\\n\\tvec4 texelSpecular = texture2D( specularMap, vUv );\\n\\tspecularStrength = texelSpecular.r;\\n#else\\n\\tspecularStrength = 1.0;\\n#endif\";\n\nvar specularmap_pars_fragment=\"#ifdef USE_SPECULARMAP\\n\\tuniform sampler2D specularMap;\\n#endif\";\n\nvar tonemapping_fragment=\"#if defined( TONE_MAPPING )\\n\\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\\n#endif\";\n\nvar tonemapping_pars_fragment=\"#ifndef saturate\\n#define saturate( a ) clamp( a, 0.0, 1.0 )\\n#endif\\nuniform float toneMappingExposure;\\nvec3 LinearToneMapping( vec3 color ) {\\n\\treturn toneMappingExposure * color;\\n}\\nvec3 ReinhardToneMapping( vec3 color ) {\\n\\tcolor *= toneMappingExposure;\\n\\treturn saturate( color / ( vec3( 1.0 ) + color ) );\\n}\\nvec3 OptimizedCineonToneMapping( vec3 color ) {\\n\\tcolor *= toneMappingExposure;\\n\\tcolor = max( vec3( 0.0 ), color - 0.004 );\\n\\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\\n}\\nvec3 RRTAndODTFit( vec3 v ) {\\n\\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\\n\\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\\n\\treturn a / b;\\n}\\nvec3 ACESFilmicToneMapping( vec3 color ) {\\n\\tconst mat3 ACESInputMat = mat3(\\n\\t\\tvec3( 0.59719, 0.07600, 0.02840 ),\\t\\tvec3( 0.35458, 0.90834, 0.13383 ),\\n\\t\\tvec3( 0.04823, 0.01566, 0.83777 )\\n\\t);\\n\\tconst mat3 ACESOutputMat = mat3(\\n\\t\\tvec3(  1.60475, -0.10208, -0.00327 ),\\t\\tvec3( -0.53108,  1.10813, -0.07276 ),\\n\\t\\tvec3( -0.07367, -0.00605,  1.07602 )\\n\\t);\\n\\tcolor *= toneMappingExposure / 0.6;\\n\\tcolor = ACESInputMat * color;\\n\\tcolor = RRTAndODTFit( color );\\n\\tcolor = ACESOutputMat * color;\\n\\treturn saturate( color );\\n}\\nvec3 CustomToneMapping( vec3 color ) { return color; }\";\n\nvar transmission_fragment=\"#ifdef USE_TRANSMISSION\\n\\tfloat transmissionAlpha = 1.0;\\n\\tfloat transmissionFactor = transmission;\\n\\tfloat thicknessFactor = thickness;\\n\\t#ifdef USE_TRANSMISSIONMAP\\n\\t\\ttransmissionFactor *= texture2D( transmissionMap, vUv ).r;\\n\\t#endif\\n\\t#ifdef USE_THICKNESSMAP\\n\\t\\tthicknessFactor *= texture2D( thicknessMap, vUv ).g;\\n\\t#endif\\n\\tvec3 pos = vWorldPosition;\\n\\tvec3 v = normalize( cameraPosition - pos );\\n\\tvec3 n = inverseTransformDirection( normal, viewMatrix );\\n\\tvec4 transmission = getIBLVolumeRefraction(\\n\\t\\tn, v, roughnessFactor, material.diffuseColor, material.specularColor, material.specularF90,\\n\\t\\tpos, modelMatrix, viewMatrix, projectionMatrix, ior, thicknessFactor,\\n\\t\\tattenuationColor, attenuationDistance );\\n\\ttotalDiffuse = mix( totalDiffuse, transmission.rgb, transmissionFactor );\\n\\ttransmissionAlpha = mix( transmissionAlpha, transmission.a, transmissionFactor );\\n#endif\";\n\nvar transmission_pars_fragment=\"#ifdef USE_TRANSMISSION\\n\\tuniform float transmission;\\n\\tuniform float thickness;\\n\\tuniform float attenuationDistance;\\n\\tuniform vec3 attenuationColor;\\n\\t#ifdef USE_TRANSMISSIONMAP\\n\\t\\tuniform sampler2D transmissionMap;\\n\\t#endif\\n\\t#ifdef USE_THICKNESSMAP\\n\\t\\tuniform sampler2D thicknessMap;\\n\\t#endif\\n\\tuniform vec2 transmissionSamplerSize;\\n\\tuniform sampler2D transmissionSamplerMap;\\n\\tuniform mat4 modelMatrix;\\n\\tuniform mat4 projectionMatrix;\\n\\tvarying vec3 vWorldPosition;\\n\\tvec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {\\n\\t\\tvec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );\\n\\t\\tvec3 modelScale;\\n\\t\\tmodelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\\n\\t\\tmodelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\\n\\t\\tmodelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\\n\\t\\treturn normalize( refractionVector ) * thickness * modelScale;\\n\\t}\\n\\tfloat applyIorToRoughness( const in float roughness, const in float ior ) {\\n\\t\\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\\n\\t}\\n\\tvec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {\\n\\t\\tfloat framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\\n\\t\\t#ifdef texture2DLodEXT\\n\\t\\t\\treturn texture2DLodEXT( transmissionSamplerMap, fragCoord.xy, framebufferLod );\\n\\t\\t#else\\n\\t\\t\\treturn texture2D( transmissionSamplerMap, fragCoord.xy, framebufferLod );\\n\\t\\t#endif\\n\\t}\\n\\tvec3 applyVolumeAttenuation( const in vec3 radiance, const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {\\n\\t\\tif ( attenuationDistance == 0.0 ) {\\n\\t\\t\\treturn radiance;\\n\\t\\t} else {\\n\\t\\t\\tvec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;\\n\\t\\t\\tvec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );\\t\\t\\treturn transmittance * radiance;\\n\\t\\t}\\n\\t}\\n\\tvec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,\\n\\t\\tconst in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,\\n\\t\\tconst in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,\\n\\t\\tconst in vec3 attenuationColor, const in float attenuationDistance ) {\\n\\t\\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\\n\\t\\tvec3 refractedRayExit = position + transmissionRay;\\n\\t\\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\\n\\t\\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\\n\\t\\trefractionCoords += 1.0;\\n\\t\\trefractionCoords /= 2.0;\\n\\t\\tvec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );\\n\\t\\tvec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );\\n\\t\\tvec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );\\n\\t\\treturn vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );\\n\\t}\\n#endif\";\n\nvar uv_pars_fragment=\"#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )\\n\\tvarying vec2 vUv;\\n#endif\";\n\nvar uv_pars_vertex=\"#ifdef USE_UV\\n\\t#ifdef UVS_VERTEX_ONLY\\n\\t\\tvec2 vUv;\\n\\t#else\\n\\t\\tvarying vec2 vUv;\\n\\t#endif\\n\\tuniform mat3 uvTransform;\\n#endif\";\n\nvar uv_vertex=\"#ifdef USE_UV\\n\\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\\n#endif\";\n\nvar uv2_pars_fragment=\"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\\n\\tvarying vec2 vUv2;\\n#endif\";\n\nvar uv2_pars_vertex=\"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\\n\\tattribute vec2 uv2;\\n\\tvarying vec2 vUv2;\\n\\tuniform mat3 uv2Transform;\\n#endif\";\n\nvar uv2_vertex=\"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\\n\\tvUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;\\n#endif\";\n\nvar worldpos_vertex=\"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION )\\n\\tvec4 worldPosition = vec4( transformed, 1.0 );\\n\\t#ifdef USE_INSTANCING\\n\\t\\tworldPosition = instanceMatrix * worldPosition;\\n\\t#endif\\n\\tworldPosition = modelMatrix * worldPosition;\\n#endif\";\n\nvar vertex$g=\"varying vec2 vUv;\\nuniform mat3 uvTransform;\\nvoid main() {\\n\\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\\n\\tgl_Position = vec4( position.xy, 1.0, 1.0 );\\n}\";\n\nvar fragment$g=\"uniform sampler2D t2D;\\nvarying vec2 vUv;\\nvoid main() {\\n\\tgl_FragColor = texture2D( t2D, vUv );\\n\\t#ifdef DECODE_VIDEO_TEXTURE\\n\\t\\tgl_FragColor = vec4( mix( pow( gl_FragColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), gl_FragColor.rgb * 0.0773993808, vec3( lessThanEqual( gl_FragColor.rgb, vec3( 0.04045 ) ) ) ), gl_FragColor.w );\\n\\t#endif\\n\\t#include <tonemapping_fragment>\\n\\t#include <encodings_fragment>\\n}\";\n\nvar vertex$f=\"varying vec3 vWorldDirection;\\n#include <common>\\nvoid main() {\\n\\tvWorldDirection = transformDirection( position, modelMatrix );\\n\\t#include <begin_vertex>\\n\\t#include <project_vertex>\\n\\tgl_Position.z = gl_Position.w;\\n}\";\n\nvar fragment$f=\"#include <envmap_common_pars_fragment>\\nuniform float opacity;\\nvarying vec3 vWorldDirection;\\n#include <cube_uv_reflection_fragment>\\nvoid main() {\\n\\tvec3 vReflect = vWorldDirection;\\n\\t#include <envmap_fragment>\\n\\tgl_FragColor = envColor;\\n\\tgl_FragColor.a *= opacity;\\n\\t#include <tonemapping_fragment>\\n\\t#include <encodings_fragment>\\n}\";\n\nvar vertex$e=\"#include <common>\\n#include <uv_pars_vertex>\\n#include <displacementmap_pars_vertex>\\n#include <morphtarget_pars_vertex>\\n#include <skinning_pars_vertex>\\n#include <logdepthbuf_pars_vertex>\\n#include <clipping_planes_pars_vertex>\\nvarying vec2 vHighPrecisionZW;\\nvoid main() {\\n\\t#include <uv_vertex>\\n\\t#include <skinbase_vertex>\\n\\t#ifdef USE_DISPLACEMENTMAP\\n\\t\\t#include <beginnormal_vertex>\\n\\t\\t#include <morphnormal_vertex>\\n\\t\\t#include <skinnormal_vertex>\\n\\t#endif\\n\\t#include <begin_vertex>\\n\\t#include <morphtarget_vertex>\\n\\t#include <skinning_vertex>\\n\\t#include <displacementmap_vertex>\\n\\t#include <project_vertex>\\n\\t#include <logdepthbuf_vertex>\\n\\t#include <clipping_planes_vertex>\\n\\tvHighPrecisionZW = gl_Position.zw;\\n}\";\n\nvar fragment$e=\"#if DEPTH_PACKING == 3200\\n\\tuniform float opacity;\\n#endif\\n#include <common>\\n#include <packing>\\n#include <uv_pars_fragment>\\n#include <map_pars_fragment>\\n#include <alphamap_pars_fragment>\\n#include <alphatest_pars_fragment>\\n#include <logdepthbuf_pars_fragment>\\n#include <clipping_planes_pars_fragment>\\nvarying vec2 vHighPrecisionZW;\\nvoid main() {\\n\\t#include <clipping_planes_fragment>\\n\\tvec4 diffuseColor = vec4( 1.0 );\\n\\t#if DEPTH_PACKING == 3200\\n\\t\\tdiffuseColor.a = opacity;\\n\\t#endif\\n\\t#include <map_fragment>\\n\\t#include <alphamap_fragment>\\n\\t#include <alphatest_fragment>\\n\\t#include <logdepthbuf_fragment>\\n\\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\\n\\t#if DEPTH_PACKING == 3200\\n\\t\\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\\n\\t#elif DEPTH_PACKING == 3201\\n\\t\\tgl_FragColor = packDepthToRGBA( fragCoordZ );\\n\\t#endif\\n}\";\n\nvar vertex$d=\"#define DISTANCE\\nvarying vec3 vWorldPosition;\\n#include <common>\\n#include <uv_pars_vertex>\\n#include <displacementmap_pars_vertex>\\n#include <morphtarget_pars_vertex>\\n#include <skinning_pars_vertex>\\n#include <clipping_planes_pars_vertex>\\nvoid main() {\\n\\t#include <uv_vertex>\\n\\t#include <skinbase_vertex>\\n\\t#ifdef USE_DISPLACEMENTMAP\\n\\t\\t#include <beginnormal_vertex>\\n\\t\\t#include <morphnormal_vertex>\\n\\t\\t#include <skinnormal_vertex>\\n\\t#endif\\n\\t#include <begin_vertex>\\n\\t#include <morphtarget_vertex>\\n\\t#include <skinning_vertex>\\n\\t#include <displacementmap_vertex>\\n\\t#include <project_vertex>\\n\\t#include <worldpos_vertex>\\n\\t#include <clipping_planes_vertex>\\n\\tvWorldPosition = worldPosition.xyz;\\n}\";\n\nvar fragment$d=\"#define DISTANCE\\nuniform vec3 referencePosition;\\nuniform float nearDistance;\\nuniform float farDistance;\\nvarying vec3 vWorldPosition;\\n#include <common>\\n#include <packing>\\n#include <uv_pars_fragment>\\n#include <map_pars_fragment>\\n#include <alphamap_pars_fragment>\\n#include <alphatest_pars_fragment>\\n#include <clipping_planes_pars_fragment>\\nvoid main () {\\n\\t#include <clipping_planes_fragment>\\n\\tvec4 diffuseColor = vec4( 1.0 );\\n\\t#include <map_fragment>\\n\\t#include <alphamap_fragment>\\n\\t#include <alphatest_fragment>\\n\\tfloat dist = length( vWorldPosition - referencePosition );\\n\\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\\n\\tdist = saturate( dist );\\n\\tgl_FragColor = packDepthToRGBA( dist );\\n}\";\n\nvar vertex$c=\"varying vec3 vWorldDirection;\\n#include <common>\\nvoid main() {\\n\\tvWorldDirection = transformDirection( position, modelMatrix );\\n\\t#include <begin_vertex>\\n\\t#include <project_vertex>\\n}\";\n\nvar fragment$c=\"uniform sampler2D tEquirect;\\nvarying vec3 vWorldDirection;\\n#include <common>\\nvoid main() {\\n\\tvec3 direction = normalize( vWorldDirection );\\n\\tvec2 sampleUV = equirectUv( direction );\\n\\tgl_FragColor = texture2D( tEquirect, sampleUV );\\n\\t#include <tonemapping_fragment>\\n\\t#include <encodings_fragment>\\n}\";\n\nvar vertex$b=\"uniform float scale;\\nattribute float lineDistance;\\nvarying float vLineDistance;\\n#include <common>\\n#include <color_pars_vertex>\\n#include <fog_pars_vertex>\\n#include <morphtarget_pars_vertex>\\n#include <logdepthbuf_pars_vertex>\\n#include <clipping_planes_pars_vertex>\\nvoid main() {\\n\\tvLineDistance = scale * lineDistance;\\n\\t#include <color_vertex>\\n\\t#include <morphcolor_vertex>\\n\\t#include <begin_vertex>\\n\\t#include <morphtarget_vertex>\\n\\t#include <project_vertex>\\n\\t#include <logdepthbuf_vertex>\\n\\t#include <clipping_planes_vertex>\\n\\t#include <fog_vertex>\\n}\";\n\nvar fragment$b=\"uniform vec3 diffuse;\\nuniform float opacity;\\nuniform float dashSize;\\nuniform float totalSize;\\nvarying float vLineDistance;\\n#include <common>\\n#include <color_pars_fragment>\\n#include <fog_pars_fragment>\\n#include <logdepthbuf_pars_fragment>\\n#include <clipping_planes_pars_fragment>\\nvoid main() {\\n\\t#include <clipping_planes_fragment>\\n\\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\\n\\t\\tdiscard;\\n\\t}\\n\\tvec3 outgoingLight = vec3( 0.0 );\\n\\tvec4 diffuseColor = vec4( diffuse, opacity );\\n\\t#include <logdepthbuf_fragment>\\n\\t#include <color_fragment>\\n\\toutgoingLight = diffuseColor.rgb;\\n\\t#include <output_fragment>\\n\\t#include <tonemapping_fragment>\\n\\t#include <encodings_fragment>\\n\\t#include <fog_fragment>\\n\\t#include <premultiplied_alpha_fragment>\\n}\";\n\nvar vertex$a=\"#include <common>\\n#include <uv_pars_vertex>\\n#include <uv2_pars_vertex>\\n#include <envmap_pars_vertex>\\n#include <color_pars_vertex>\\n#include <fog_pars_vertex>\\n#include <morphtarget_pars_vertex>\\n#include <skinning_pars_vertex>\\n#include <logdepthbuf_pars_vertex>\\n#include <clipping_planes_pars_vertex>\\nvoid main() {\\n\\t#include <uv_vertex>\\n\\t#include <uv2_vertex>\\n\\t#include <color_vertex>\\n\\t#include <morphcolor_vertex>\\n\\t#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\\n\\t\\t#include <beginnormal_vertex>\\n\\t\\t#include <morphnormal_vertex>\\n\\t\\t#include <skinbase_vertex>\\n\\t\\t#include <skinnormal_vertex>\\n\\t\\t#include <defaultnormal_vertex>\\n\\t#endif\\n\\t#include <begin_vertex>\\n\\t#include <morphtarget_vertex>\\n\\t#include <skinning_vertex>\\n\\t#include <project_vertex>\\n\\t#include <logdepthbuf_vertex>\\n\\t#include <clipping_planes_vertex>\\n\\t#include <worldpos_vertex>\\n\\t#include <envmap_vertex>\\n\\t#include <fog_vertex>\\n}\";\n\nvar fragment$a=\"uniform vec3 diffuse;\\nuniform float opacity;\\n#ifndef FLAT_SHADED\\n\\tvarying vec3 vNormal;\\n#endif\\n#include <common>\\n#include <dithering_pars_fragment>\\n#include <color_pars_fragment>\\n#include <uv_pars_fragment>\\n#include <uv2_pars_fragment>\\n#include <map_pars_fragment>\\n#include <alphamap_pars_fragment>\\n#include <alphatest_pars_fragment>\\n#include <aomap_pars_fragment>\\n#include <lightmap_pars_fragment>\\n#include <envmap_common_pars_fragment>\\n#include <envmap_pars_fragment>\\n#include <cube_uv_reflection_fragment>\\n#include <fog_pars_fragment>\\n#include <specularmap_pars_fragment>\\n#include <logdepthbuf_pars_fragment>\\n#include <clipping_planes_pars_fragment>\\nvoid main() {\\n\\t#include <clipping_planes_fragment>\\n\\tvec4 diffuseColor = vec4( diffuse, opacity );\\n\\t#include <logdepthbuf_fragment>\\n\\t#include <map_fragment>\\n\\t#include <color_fragment>\\n\\t#include <alphamap_fragment>\\n\\t#include <alphatest_fragment>\\n\\t#include <specularmap_fragment>\\n\\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\\n\\t#ifdef USE_LIGHTMAP\\n\\t\\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\\n\\t\\treflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;\\n\\t#else\\n\\t\\treflectedLight.indirectDiffuse += vec3( 1.0 );\\n\\t#endif\\n\\t#include <aomap_fragment>\\n\\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\\n\\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\\n\\t#include <envmap_fragment>\\n\\t#include <output_fragment>\\n\\t#include <tonemapping_fragment>\\n\\t#include <encodings_fragment>\\n\\t#include <fog_fragment>\\n\\t#include <premultiplied_alpha_fragment>\\n\\t#include <dithering_fragment>\\n}\";\n\nvar vertex$9=\"#define LAMBERT\\nvarying vec3 vLightFront;\\nvarying vec3 vIndirectFront;\\n#ifdef DOUBLE_SIDED\\n\\tvarying vec3 vLightBack;\\n\\tvarying vec3 vIndirectBack;\\n#endif\\n#include <common>\\n#include <uv_pars_vertex>\\n#include <uv2_pars_vertex>\\n#include <envmap_pars_vertex>\\n#include <bsdfs>\\n#include <lights_pars_begin>\\n#include <color_pars_vertex>\\n#include <fog_pars_vertex>\\n#include <morphtarget_pars_vertex>\\n#include <skinning_pars_vertex>\\n#include <shadowmap_pars_vertex>\\n#include <logdepthbuf_pars_vertex>\\n#include <clipping_planes_pars_vertex>\\nvoid main() {\\n\\t#include <uv_vertex>\\n\\t#include <uv2_vertex>\\n\\t#include <color_vertex>\\n\\t#include <morphcolor_vertex>\\n\\t#include <beginnormal_vertex>\\n\\t#include <morphnormal_vertex>\\n\\t#include <skinbase_vertex>\\n\\t#include <skinnormal_vertex>\\n\\t#include <defaultnormal_vertex>\\n\\t#include <begin_vertex>\\n\\t#include <morphtarget_vertex>\\n\\t#include <skinning_vertex>\\n\\t#include <project_vertex>\\n\\t#include <logdepthbuf_vertex>\\n\\t#include <clipping_planes_vertex>\\n\\t#include <worldpos_vertex>\\n\\t#include <envmap_vertex>\\n\\t#include <lights_lambert_vertex>\\n\\t#include <shadowmap_vertex>\\n\\t#include <fog_vertex>\\n}\";\n\nvar fragment$9=\"uniform vec3 diffuse;\\nuniform vec3 emissive;\\nuniform float opacity;\\nvarying vec3 vLightFront;\\nvarying vec3 vIndirectFront;\\n#ifdef DOUBLE_SIDED\\n\\tvarying vec3 vLightBack;\\n\\tvarying vec3 vIndirectBack;\\n#endif\\n#include <common>\\n#include <packing>\\n#include <dithering_pars_fragment>\\n#include <color_pars_fragment>\\n#include <uv_pars_fragment>\\n#include <uv2_pars_fragment>\\n#include <map_pars_fragment>\\n#include <alphamap_pars_fragment>\\n#include <alphatest_pars_fragment>\\n#include <aomap_pars_fragment>\\n#include <lightmap_pars_fragment>\\n#include <emissivemap_pars_fragment>\\n#include <envmap_common_pars_fragment>\\n#include <envmap_pars_fragment>\\n#include <cube_uv_reflection_fragment>\\n#include <bsdfs>\\n#include <lights_pars_begin>\\n#include <fog_pars_fragment>\\n#include <shadowmap_pars_fragment>\\n#include <shadowmask_pars_fragment>\\n#include <specularmap_pars_fragment>\\n#include <logdepthbuf_pars_fragment>\\n#include <clipping_planes_pars_fragment>\\nvoid main() {\\n\\t#include <clipping_planes_fragment>\\n\\tvec4 diffuseColor = vec4( diffuse, opacity );\\n\\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\\n\\tvec3 totalEmissiveRadiance = emissive;\\n\\t#include <logdepthbuf_fragment>\\n\\t#include <map_fragment>\\n\\t#include <color_fragment>\\n\\t#include <alphamap_fragment>\\n\\t#include <alphatest_fragment>\\n\\t#include <specularmap_fragment>\\n\\t#include <emissivemap_fragment>\\n\\t#ifdef DOUBLE_SIDED\\n\\t\\treflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;\\n\\t#else\\n\\t\\treflectedLight.indirectDiffuse += vIndirectFront;\\n\\t#endif\\n\\t#include <lightmap_fragment>\\n\\treflectedLight.indirectDiffuse *= BRDF_Lambert( diffuseColor.rgb );\\n\\t#ifdef DOUBLE_SIDED\\n\\t\\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\\n\\t#else\\n\\t\\treflectedLight.directDiffuse = vLightFront;\\n\\t#endif\\n\\treflectedLight.directDiffuse *= BRDF_Lambert( diffuseColor.rgb ) * getShadowMask();\\n\\t#include <aomap_fragment>\\n\\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\\n\\t#include <envmap_fragment>\\n\\t#include <output_fragment>\\n\\t#include <tonemapping_fragment>\\n\\t#include <encodings_fragment>\\n\\t#include <fog_fragment>\\n\\t#include <premultiplied_alpha_fragment>\\n\\t#include <dithering_fragment>\\n}\";\n\nvar vertex$8=\"#define MATCAP\\nvarying vec3 vViewPosition;\\n#include <common>\\n#include <uv_pars_vertex>\\n#include <color_pars_vertex>\\n#include <displacementmap_pars_vertex>\\n#include <fog_pars_vertex>\\n#include <normal_pars_vertex>\\n#include <morphtarget_pars_vertex>\\n#include <skinning_pars_vertex>\\n#include <logdepthbuf_pars_vertex>\\n#include <clipping_planes_pars_vertex>\\nvoid main() {\\n\\t#include <uv_vertex>\\n\\t#include <color_vertex>\\n\\t#include <morphcolor_vertex>\\n\\t#include <beginnormal_vertex>\\n\\t#include <morphnormal_vertex>\\n\\t#include <skinbase_vertex>\\n\\t#include <skinnormal_vertex>\\n\\t#include <defaultnormal_vertex>\\n\\t#include <normal_vertex>\\n\\t#include <begin_vertex>\\n\\t#include <morphtarget_vertex>\\n\\t#include <skinning_vertex>\\n\\t#include <displacementmap_vertex>\\n\\t#include <project_vertex>\\n\\t#include <logdepthbuf_vertex>\\n\\t#include <clipping_planes_vertex>\\n\\t#include <fog_vertex>\\n\\tvViewPosition = - mvPosition.xyz;\\n}\";\n\nvar fragment$8=\"#define MATCAP\\nuniform vec3 diffuse;\\nuniform float opacity;\\nuniform sampler2D matcap;\\nvarying vec3 vViewPosition;\\n#include <common>\\n#include <dithering_pars_fragment>\\n#include <color_pars_fragment>\\n#include <uv_pars_fragment>\\n#include <map_pars_fragment>\\n#include <alphamap_pars_fragment>\\n#include <alphatest_pars_fragment>\\n#include <fog_pars_fragment>\\n#include <normal_pars_fragment>\\n#include <bumpmap_pars_fragment>\\n#include <normalmap_pars_fragment>\\n#include <logdepthbuf_pars_fragment>\\n#include <clipping_planes_pars_fragment>\\nvoid main() {\\n\\t#include <clipping_planes_fragment>\\n\\tvec4 diffuseColor = vec4( diffuse, opacity );\\n\\t#include <logdepthbuf_fragment>\\n\\t#include <map_fragment>\\n\\t#include <color_fragment>\\n\\t#include <alphamap_fragment>\\n\\t#include <alphatest_fragment>\\n\\t#include <normal_fragment_begin>\\n\\t#include <normal_fragment_maps>\\n\\tvec3 viewDir = normalize( vViewPosition );\\n\\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\\n\\tvec3 y = cross( viewDir, x );\\n\\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\\n\\t#ifdef USE_MATCAP\\n\\t\\tvec4 matcapColor = texture2D( matcap, uv );\\n\\t#else\\n\\t\\tvec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );\\n\\t#endif\\n\\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\\n\\t#include <output_fragment>\\n\\t#include <tonemapping_fragment>\\n\\t#include <encodings_fragment>\\n\\t#include <fog_fragment>\\n\\t#include <premultiplied_alpha_fragment>\\n\\t#include <dithering_fragment>\\n}\";\n\nvar vertex$7=\"#define NORMAL\\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\\n\\tvarying vec3 vViewPosition;\\n#endif\\n#include <common>\\n#include <uv_pars_vertex>\\n#include <displacementmap_pars_vertex>\\n#include <normal_pars_vertex>\\n#include <morphtarget_pars_vertex>\\n#include <skinning_pars_vertex>\\n#include <logdepthbuf_pars_vertex>\\n#include <clipping_planes_pars_vertex>\\nvoid main() {\\n\\t#include <uv_vertex>\\n\\t#include <beginnormal_vertex>\\n\\t#include <morphnormal_vertex>\\n\\t#include <skinbase_vertex>\\n\\t#include <skinnormal_vertex>\\n\\t#include <defaultnormal_vertex>\\n\\t#include <normal_vertex>\\n\\t#include <begin_vertex>\\n\\t#include <morphtarget_vertex>\\n\\t#include <skinning_vertex>\\n\\t#include <displacementmap_vertex>\\n\\t#include <project_vertex>\\n\\t#include <logdepthbuf_vertex>\\n\\t#include <clipping_planes_vertex>\\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\\n\\tvViewPosition = - mvPosition.xyz;\\n#endif\\n}\";\n\nvar fragment$7=\"#define NORMAL\\nuniform float opacity;\\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\\n\\tvarying vec3 vViewPosition;\\n#endif\\n#include <packing>\\n#include <uv_pars_fragment>\\n#include <normal_pars_fragment>\\n#include <bumpmap_pars_fragment>\\n#include <normalmap_pars_fragment>\\n#include <logdepthbuf_pars_fragment>\\n#include <clipping_planes_pars_fragment>\\nvoid main() {\\n\\t#include <clipping_planes_fragment>\\n\\t#include <logdepthbuf_fragment>\\n\\t#include <normal_fragment_begin>\\n\\t#include <normal_fragment_maps>\\n\\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\\n\\t#ifdef OPAQUE\\n\\t\\tgl_FragColor.a = 1.0;\\n\\t#endif\\n}\";\n\nvar vertex$6=\"#define PHONG\\nvarying vec3 vViewPosition;\\n#include <common>\\n#include <uv_pars_vertex>\\n#include <uv2_pars_vertex>\\n#include <displacementmap_pars_vertex>\\n#include <envmap_pars_vertex>\\n#include <color_pars_vertex>\\n#include <fog_pars_vertex>\\n#include <normal_pars_vertex>\\n#include <morphtarget_pars_vertex>\\n#include <skinning_pars_vertex>\\n#include <shadowmap_pars_vertex>\\n#include <logdepthbuf_pars_vertex>\\n#include <clipping_planes_pars_vertex>\\nvoid main() {\\n\\t#include <uv_vertex>\\n\\t#include <uv2_vertex>\\n\\t#include <color_vertex>\\n\\t#include <morphcolor_vertex>\\n\\t#include <beginnormal_vertex>\\n\\t#include <morphnormal_vertex>\\n\\t#include <skinbase_vertex>\\n\\t#include <skinnormal_vertex>\\n\\t#include <defaultnormal_vertex>\\n\\t#include <normal_vertex>\\n\\t#include <begin_vertex>\\n\\t#include <morphtarget_vertex>\\n\\t#include <skinning_vertex>\\n\\t#include <displacementmap_vertex>\\n\\t#include <project_vertex>\\n\\t#include <logdepthbuf_vertex>\\n\\t#include <clipping_planes_vertex>\\n\\tvViewPosition = - mvPosition.xyz;\\n\\t#include <worldpos_vertex>\\n\\t#include <envmap_vertex>\\n\\t#include <shadowmap_vertex>\\n\\t#include <fog_vertex>\\n}\";\n\nvar fragment$6=\"#define PHONG\\nuniform vec3 diffuse;\\nuniform vec3 emissive;\\nuniform vec3 specular;\\nuniform float shininess;\\nuniform float opacity;\\n#include <common>\\n#include <packing>\\n#include <dithering_pars_fragment>\\n#include <color_pars_fragment>\\n#include <uv_pars_fragment>\\n#include <uv2_pars_fragment>\\n#include <map_pars_fragment>\\n#include <alphamap_pars_fragment>\\n#include <alphatest_pars_fragment>\\n#include <aomap_pars_fragment>\\n#include <lightmap_pars_fragment>\\n#include <emissivemap_pars_fragment>\\n#include <envmap_common_pars_fragment>\\n#include <envmap_pars_fragment>\\n#include <cube_uv_reflection_fragment>\\n#include <fog_pars_fragment>\\n#include <bsdfs>\\n#include <lights_pars_begin>\\n#include <normal_pars_fragment>\\n#include <lights_phong_pars_fragment>\\n#include <shadowmap_pars_fragment>\\n#include <bumpmap_pars_fragment>\\n#include <normalmap_pars_fragment>\\n#include <specularmap_pars_fragment>\\n#include <logdepthbuf_pars_fragment>\\n#include <clipping_planes_pars_fragment>\\nvoid main() {\\n\\t#include <clipping_planes_fragment>\\n\\tvec4 diffuseColor = vec4( diffuse, opacity );\\n\\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\\n\\tvec3 totalEmissiveRadiance = emissive;\\n\\t#include <logdepthbuf_fragment>\\n\\t#include <map_fragment>\\n\\t#include <color_fragment>\\n\\t#include <alphamap_fragment>\\n\\t#include <alphatest_fragment>\\n\\t#include <specularmap_fragment>\\n\\t#include <normal_fragment_begin>\\n\\t#include <normal_fragment_maps>\\n\\t#include <emissivemap_fragment>\\n\\t#include <lights_phong_fragment>\\n\\t#include <lights_fragment_begin>\\n\\t#include <lights_fragment_maps>\\n\\t#include <lights_fragment_end>\\n\\t#include <aomap_fragment>\\n\\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\\n\\t#include <envmap_fragment>\\n\\t#include <output_fragment>\\n\\t#include <tonemapping_fragment>\\n\\t#include <encodings_fragment>\\n\\t#include <fog_fragment>\\n\\t#include <premultiplied_alpha_fragment>\\n\\t#include <dithering_fragment>\\n}\";\n\nvar vertex$5=\"#define STANDARD\\nvarying vec3 vViewPosition;\\n#ifdef USE_TRANSMISSION\\n\\tvarying vec3 vWorldPosition;\\n#endif\\n#include <common>\\n#include <uv_pars_vertex>\\n#include <uv2_pars_vertex>\\n#include <displacementmap_pars_vertex>\\n#include <color_pars_vertex>\\n#include <fog_pars_vertex>\\n#include <normal_pars_vertex>\\n#include <morphtarget_pars_vertex>\\n#include <skinning_pars_vertex>\\n#include <shadowmap_pars_vertex>\\n#include <logdepthbuf_pars_vertex>\\n#include <clipping_planes_pars_vertex>\\nvoid main() {\\n\\t#include <uv_vertex>\\n\\t#include <uv2_vertex>\\n\\t#include <color_vertex>\\n\\t#include <morphcolor_vertex>\\n\\t#include <beginnormal_vertex>\\n\\t#include <morphnormal_vertex>\\n\\t#include <skinbase_vertex>\\n\\t#include <skinnormal_vertex>\\n\\t#include <defaultnormal_vertex>\\n\\t#include <normal_vertex>\\n\\t#include <begin_vertex>\\n\\t#include <morphtarget_vertex>\\n\\t#include <skinning_vertex>\\n\\t#include <displacementmap_vertex>\\n\\t#include <project_vertex>\\n\\t#include <logdepthbuf_vertex>\\n\\t#include <clipping_planes_vertex>\\n\\tvViewPosition = - mvPosition.xyz;\\n\\t#include <worldpos_vertex>\\n\\t#include <shadowmap_vertex>\\n\\t#include <fog_vertex>\\n#ifdef USE_TRANSMISSION\\n\\tvWorldPosition = worldPosition.xyz;\\n#endif\\n}\";\n\nvar fragment$5=\"#define STANDARD\\n#ifdef PHYSICAL\\n\\t#define IOR\\n\\t#define SPECULAR\\n#endif\\nuniform vec3 diffuse;\\nuniform vec3 emissive;\\nuniform float roughness;\\nuniform float metalness;\\nuniform float opacity;\\n#ifdef IOR\\n\\tuniform float ior;\\n#endif\\n#ifdef SPECULAR\\n\\tuniform float specularIntensity;\\n\\tuniform vec3 specularColor;\\n\\t#ifdef USE_SPECULARINTENSITYMAP\\n\\t\\tuniform sampler2D specularIntensityMap;\\n\\t#endif\\n\\t#ifdef USE_SPECULARCOLORMAP\\n\\t\\tuniform sampler2D specularColorMap;\\n\\t#endif\\n#endif\\n#ifdef USE_CLEARCOAT\\n\\tuniform float clearcoat;\\n\\tuniform float clearcoatRoughness;\\n#endif\\n#ifdef USE_IRIDESCENCE\\n\\tuniform float iridescence;\\n\\tuniform float iridescenceIOR;\\n\\tuniform float iridescenceThicknessMinimum;\\n\\tuniform float iridescenceThicknessMaximum;\\n#endif\\n#ifdef USE_SHEEN\\n\\tuniform vec3 sheenColor;\\n\\tuniform float sheenRoughness;\\n\\t#ifdef USE_SHEENCOLORMAP\\n\\t\\tuniform sampler2D sheenColorMap;\\n\\t#endif\\n\\t#ifdef USE_SHEENROUGHNESSMAP\\n\\t\\tuniform sampler2D sheenRoughnessMap;\\n\\t#endif\\n#endif\\nvarying vec3 vViewPosition;\\n#include <common>\\n#include <packing>\\n#include <dithering_pars_fragment>\\n#include <color_pars_fragment>\\n#include <uv_pars_fragment>\\n#include <uv2_pars_fragment>\\n#include <map_pars_fragment>\\n#include <alphamap_pars_fragment>\\n#include <alphatest_pars_fragment>\\n#include <aomap_pars_fragment>\\n#include <lightmap_pars_fragment>\\n#include <emissivemap_pars_fragment>\\n#include <bsdfs>\\n#include <iridescence_fragment>\\n#include <cube_uv_reflection_fragment>\\n#include <envmap_common_pars_fragment>\\n#include <envmap_physical_pars_fragment>\\n#include <fog_pars_fragment>\\n#include <lights_pars_begin>\\n#include <normal_pars_fragment>\\n#include <lights_physical_pars_fragment>\\n#include <transmission_pars_fragment>\\n#include <shadowmap_pars_fragment>\\n#include <bumpmap_pars_fragment>\\n#include <normalmap_pars_fragment>\\n#include <clearcoat_pars_fragment>\\n#include <iridescence_pars_fragment>\\n#include <roughnessmap_pars_fragment>\\n#include <metalnessmap_pars_fragment>\\n#include <logdepthbuf_pars_fragment>\\n#include <clipping_planes_pars_fragment>\\nvoid main() {\\n\\t#include <clipping_planes_fragment>\\n\\tvec4 diffuseColor = vec4( diffuse, opacity );\\n\\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\\n\\tvec3 totalEmissiveRadiance = emissive;\\n\\t#include <logdepthbuf_fragment>\\n\\t#include <map_fragment>\\n\\t#include <color_fragment>\\n\\t#include <alphamap_fragment>\\n\\t#include <alphatest_fragment>\\n\\t#include <roughnessmap_fragment>\\n\\t#include <metalnessmap_fragment>\\n\\t#include <normal_fragment_begin>\\n\\t#include <normal_fragment_maps>\\n\\t#include <clearcoat_normal_fragment_begin>\\n\\t#include <clearcoat_normal_fragment_maps>\\n\\t#include <emissivemap_fragment>\\n\\t#include <lights_physical_fragment>\\n\\t#include <lights_fragment_begin>\\n\\t#include <lights_fragment_maps>\\n\\t#include <lights_fragment_end>\\n\\t#include <aomap_fragment>\\n\\tvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\\n\\tvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\\n\\t#include <transmission_fragment>\\n\\tvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\\n\\t#ifdef USE_SHEEN\\n\\t\\tfloat sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );\\n\\t\\toutgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;\\n\\t#endif\\n\\t#ifdef USE_CLEARCOAT\\n\\t\\tfloat dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\\n\\t\\tvec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\\n\\t\\toutgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;\\n\\t#endif\\n\\t#include <output_fragment>\\n\\t#include <tonemapping_fragment>\\n\\t#include <encodings_fragment>\\n\\t#include <fog_fragment>\\n\\t#include <premultiplied_alpha_fragment>\\n\\t#include <dithering_fragment>\\n}\";\n\nvar vertex$4=\"#define TOON\\nvarying vec3 vViewPosition;\\n#include <common>\\n#include <uv_pars_vertex>\\n#include <uv2_pars_vertex>\\n#include <displacementmap_pars_vertex>\\n#include <color_pars_vertex>\\n#include <fog_pars_vertex>\\n#include <normal_pars_vertex>\\n#include <morphtarget_pars_vertex>\\n#include <skinning_pars_vertex>\\n#include <shadowmap_pars_vertex>\\n#include <logdepthbuf_pars_vertex>\\n#include <clipping_planes_pars_vertex>\\nvoid main() {\\n\\t#include <uv_vertex>\\n\\t#include <uv2_vertex>\\n\\t#include <color_vertex>\\n\\t#include <morphcolor_vertex>\\n\\t#include <beginnormal_vertex>\\n\\t#include <morphnormal_vertex>\\n\\t#include <skinbase_vertex>\\n\\t#include <skinnormal_vertex>\\n\\t#include <defaultnormal_vertex>\\n\\t#include <normal_vertex>\\n\\t#include <begin_vertex>\\n\\t#include <morphtarget_vertex>\\n\\t#include <skinning_vertex>\\n\\t#include <displacementmap_vertex>\\n\\t#include <project_vertex>\\n\\t#include <logdepthbuf_vertex>\\n\\t#include <clipping_planes_vertex>\\n\\tvViewPosition = - mvPosition.xyz;\\n\\t#include <worldpos_vertex>\\n\\t#include <shadowmap_vertex>\\n\\t#include <fog_vertex>\\n}\";\n\nvar fragment$4=\"#define TOON\\nuniform vec3 diffuse;\\nuniform vec3 emissive;\\nuniform float opacity;\\n#include <common>\\n#include <packing>\\n#include <dithering_pars_fragment>\\n#include <color_pars_fragment>\\n#include <uv_pars_fragment>\\n#include <uv2_pars_fragment>\\n#include <map_pars_fragment>\\n#include <alphamap_pars_fragment>\\n#include <alphatest_pars_fragment>\\n#include <aomap_pars_fragment>\\n#include <lightmap_pars_fragment>\\n#include <emissivemap_pars_fragment>\\n#include <gradientmap_pars_fragment>\\n#include <fog_pars_fragment>\\n#include <bsdfs>\\n#include <lights_pars_begin>\\n#include <normal_pars_fragment>\\n#include <lights_toon_pars_fragment>\\n#include <shadowmap_pars_fragment>\\n#include <bumpmap_pars_fragment>\\n#include <normalmap_pars_fragment>\\n#include <logdepthbuf_pars_fragment>\\n#include <clipping_planes_pars_fragment>\\nvoid main() {\\n\\t#include <clipping_planes_fragment>\\n\\tvec4 diffuseColor = vec4( diffuse, opacity );\\n\\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\\n\\tvec3 totalEmissiveRadiance = emissive;\\n\\t#include <logdepthbuf_fragment>\\n\\t#include <map_fragment>\\n\\t#include <color_fragment>\\n\\t#include <alphamap_fragment>\\n\\t#include <alphatest_fragment>\\n\\t#include <normal_fragment_begin>\\n\\t#include <normal_fragment_maps>\\n\\t#include <emissivemap_fragment>\\n\\t#include <lights_toon_fragment>\\n\\t#include <lights_fragment_begin>\\n\\t#include <lights_fragment_maps>\\n\\t#include <lights_fragment_end>\\n\\t#include <aomap_fragment>\\n\\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\\n\\t#include <output_fragment>\\n\\t#include <tonemapping_fragment>\\n\\t#include <encodings_fragment>\\n\\t#include <fog_fragment>\\n\\t#include <premultiplied_alpha_fragment>\\n\\t#include <dithering_fragment>\\n}\";\n\nvar vertex$3=\"uniform float size;\\nuniform float scale;\\n#include <common>\\n#include <color_pars_vertex>\\n#include <fog_pars_vertex>\\n#include <morphtarget_pars_vertex>\\n#include <logdepthbuf_pars_vertex>\\n#include <clipping_planes_pars_vertex>\\nvoid main() {\\n\\t#include <color_vertex>\\n\\t#include <morphcolor_vertex>\\n\\t#include <begin_vertex>\\n\\t#include <morphtarget_vertex>\\n\\t#include <project_vertex>\\n\\tgl_PointSize = size;\\n\\t#ifdef USE_SIZEATTENUATION\\n\\t\\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\\n\\t\\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\\n\\t#endif\\n\\t#include <logdepthbuf_vertex>\\n\\t#include <clipping_planes_vertex>\\n\\t#include <worldpos_vertex>\\n\\t#include <fog_vertex>\\n}\";\n\nvar fragment$3=\"uniform vec3 diffuse;\\nuniform float opacity;\\n#include <common>\\n#include <color_pars_fragment>\\n#include <map_particle_pars_fragment>\\n#include <alphatest_pars_fragment>\\n#include <fog_pars_fragment>\\n#include <logdepthbuf_pars_fragment>\\n#include <clipping_planes_pars_fragment>\\nvoid main() {\\n\\t#include <clipping_planes_fragment>\\n\\tvec3 outgoingLight = vec3( 0.0 );\\n\\tvec4 diffuseColor = vec4( diffuse, opacity );\\n\\t#include <logdepthbuf_fragment>\\n\\t#include <map_particle_fragment>\\n\\t#include <color_fragment>\\n\\t#include <alphatest_fragment>\\n\\toutgoingLight = diffuseColor.rgb;\\n\\t#include <output_fragment>\\n\\t#include <tonemapping_fragment>\\n\\t#include <encodings_fragment>\\n\\t#include <fog_fragment>\\n\\t#include <premultiplied_alpha_fragment>\\n}\";\n\nvar vertex$2=\"#include <common>\\n#include <fog_pars_vertex>\\n#include <morphtarget_pars_vertex>\\n#include <skinning_pars_vertex>\\n#include <shadowmap_pars_vertex>\\nvoid main() {\\n\\t#include <beginnormal_vertex>\\n\\t#include <morphnormal_vertex>\\n\\t#include <skinbase_vertex>\\n\\t#include <skinnormal_vertex>\\n\\t#include <defaultnormal_vertex>\\n\\t#include <begin_vertex>\\n\\t#include <morphtarget_vertex>\\n\\t#include <skinning_vertex>\\n\\t#include <project_vertex>\\n\\t#include <worldpos_vertex>\\n\\t#include <shadowmap_vertex>\\n\\t#include <fog_vertex>\\n}\";\n\nvar fragment$2=\"uniform vec3 color;\\nuniform float opacity;\\n#include <common>\\n#include <packing>\\n#include <fog_pars_fragment>\\n#include <bsdfs>\\n#include <lights_pars_begin>\\n#include <shadowmap_pars_fragment>\\n#include <shadowmask_pars_fragment>\\nvoid main() {\\n\\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\\n\\t#include <tonemapping_fragment>\\n\\t#include <encodings_fragment>\\n\\t#include <fog_fragment>\\n}\";\n\nvar vertex$1=\"uniform float rotation;\\nuniform vec2 center;\\n#include <common>\\n#include <uv_pars_vertex>\\n#include <fog_pars_vertex>\\n#include <logdepthbuf_pars_vertex>\\n#include <clipping_planes_pars_vertex>\\nvoid main() {\\n\\t#include <uv_vertex>\\n\\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\\n\\tvec2 scale;\\n\\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\\n\\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\\n\\t#ifndef USE_SIZEATTENUATION\\n\\t\\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\\n\\t\\tif ( isPerspective ) scale *= - mvPosition.z;\\n\\t#endif\\n\\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\\n\\tvec2 rotatedPosition;\\n\\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\\n\\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\\n\\tmvPosition.xy += rotatedPosition;\\n\\tgl_Position = projectionMatrix * mvPosition;\\n\\t#include <logdepthbuf_vertex>\\n\\t#include <clipping_planes_vertex>\\n\\t#include <fog_vertex>\\n}\";\n\nvar fragment$1=\"uniform vec3 diffuse;\\nuniform float opacity;\\n#include <common>\\n#include <uv_pars_fragment>\\n#include <map_pars_fragment>\\n#include <alphamap_pars_fragment>\\n#include <alphatest_pars_fragment>\\n#include <fog_pars_fragment>\\n#include <logdepthbuf_pars_fragment>\\n#include <clipping_planes_pars_fragment>\\nvoid main() {\\n\\t#include <clipping_planes_fragment>\\n\\tvec3 outgoingLight = vec3( 0.0 );\\n\\tvec4 diffuseColor = vec4( diffuse, opacity );\\n\\t#include <logdepthbuf_fragment>\\n\\t#include <map_fragment>\\n\\t#include <alphamap_fragment>\\n\\t#include <alphatest_fragment>\\n\\toutgoingLight = diffuseColor.rgb;\\n\\t#include <output_fragment>\\n\\t#include <tonemapping_fragment>\\n\\t#include <encodings_fragment>\\n\\t#include <fog_fragment>\\n}\";\n\nvar ShaderChunk={\nalphamap_fragment:alphamap_fragment,\nalphamap_pars_fragment:alphamap_pars_fragment,\nalphatest_fragment:alphatest_fragment,\nalphatest_pars_fragment:alphatest_pars_fragment,\naomap_fragment:aomap_fragment,\naomap_pars_fragment:aomap_pars_fragment,\nbegin_vertex:begin_vertex,\nbeginnormal_vertex:beginnormal_vertex,\nbsdfs:bsdfs,\niridescence_fragment:iridescence_fragment,\nbumpmap_pars_fragment:bumpmap_pars_fragment,\nclipping_planes_fragment:clipping_planes_fragment,\nclipping_planes_pars_fragment:clipping_planes_pars_fragment,\nclipping_planes_pars_vertex:clipping_planes_pars_vertex,\nclipping_planes_vertex:clipping_planes_vertex,\ncolor_fragment:color_fragment,\ncolor_pars_fragment:color_pars_fragment,\ncolor_pars_vertex:color_pars_vertex,\ncolor_vertex:color_vertex,\ncommon:common,\ncube_uv_reflection_fragment:cube_uv_reflection_fragment,\ndefaultnormal_vertex:defaultnormal_vertex,\ndisplacementmap_pars_vertex:displacementmap_pars_vertex,\ndisplacementmap_vertex:displacementmap_vertex,\nemissivemap_fragment:emissivemap_fragment,\nemissivemap_pars_fragment:emissivemap_pars_fragment,\nencodings_fragment:encodings_fragment,\nencodings_pars_fragment:encodings_pars_fragment,\nenvmap_fragment:envmap_fragment,\nenvmap_common_pars_fragment:envmap_common_pars_fragment,\nenvmap_pars_fragment:envmap_pars_fragment,\nenvmap_pars_vertex:envmap_pars_vertex,\nenvmap_physical_pars_fragment:envmap_physical_pars_fragment,\nenvmap_vertex:envmap_vertex,\nfog_vertex:fog_vertex,\nfog_pars_vertex:fog_pars_vertex,\nfog_fragment:fog_fragment,\nfog_pars_fragment:fog_pars_fragment,\ngradientmap_pars_fragment:gradientmap_pars_fragment,\nlightmap_fragment:lightmap_fragment,\nlightmap_pars_fragment:lightmap_pars_fragment,\nlights_lambert_vertex:lights_lambert_vertex,\nlights_pars_begin:lights_pars_begin,\nlights_toon_fragment:lights_toon_fragment,\nlights_toon_pars_fragment:lights_toon_pars_fragment,\nlights_phong_fragment:lights_phong_fragment,\nlights_phong_pars_fragment:lights_phong_pars_fragment,\nlights_physical_fragment:lights_physical_fragment,\nlights_physical_pars_fragment:lights_physical_pars_fragment,\nlights_fragment_begin:lights_fragment_begin,\nlights_fragment_maps:lights_fragment_maps,\nlights_fragment_end:lights_fragment_end,\nlogdepthbuf_fragment:logdepthbuf_fragment,\nlogdepthbuf_pars_fragment:logdepthbuf_pars_fragment,\nlogdepthbuf_pars_vertex:logdepthbuf_pars_vertex,\nlogdepthbuf_vertex:logdepthbuf_vertex,\nmap_fragment:map_fragment,\nmap_pars_fragment:map_pars_fragment,\nmap_particle_fragment:map_particle_fragment,\nmap_particle_pars_fragment:map_particle_pars_fragment,\nmetalnessmap_fragment:metalnessmap_fragment,\nmetalnessmap_pars_fragment:metalnessmap_pars_fragment,\nmorphcolor_vertex:morphcolor_vertex,\nmorphnormal_vertex:morphnormal_vertex,\nmorphtarget_pars_vertex:morphtarget_pars_vertex,\nmorphtarget_vertex:morphtarget_vertex,\nnormal_fragment_begin:normal_fragment_begin,\nnormal_fragment_maps:normal_fragment_maps,\nnormal_pars_fragment:normal_pars_fragment,\nnormal_pars_vertex:normal_pars_vertex,\nnormal_vertex:normal_vertex,\nnormalmap_pars_fragment:normalmap_pars_fragment,\nclearcoat_normal_fragment_begin:clearcoat_normal_fragment_begin,\nclearcoat_normal_fragment_maps:clearcoat_normal_fragment_maps,\nclearcoat_pars_fragment:clearcoat_pars_fragment,\niridescence_pars_fragment:iridescence_pars_fragment,\noutput_fragment:output_fragment,\npacking:packing,\npremultiplied_alpha_fragment:premultiplied_alpha_fragment,\nproject_vertex:project_vertex,\ndithering_fragment:dithering_fragment,\ndithering_pars_fragment:dithering_pars_fragment,\nroughnessmap_fragment:roughnessmap_fragment,\nroughnessmap_pars_fragment:roughnessmap_pars_fragment,\nshadowmap_pars_fragment:shadowmap_pars_fragment,\nshadowmap_pars_vertex:shadowmap_pars_vertex,\nshadowmap_vertex:shadowmap_vertex,\nshadowmask_pars_fragment:shadowmask_pars_fragment,\nskinbase_vertex:skinbase_vertex,\nskinning_pars_vertex:skinning_pars_vertex,\nskinning_vertex:skinning_vertex,\nskinnormal_vertex:skinnormal_vertex,\nspecularmap_fragment:specularmap_fragment,\nspecularmap_pars_fragment:specularmap_pars_fragment,\ntonemapping_fragment:tonemapping_fragment,\ntonemapping_pars_fragment:tonemapping_pars_fragment,\ntransmission_fragment:transmission_fragment,\ntransmission_pars_fragment:transmission_pars_fragment,\nuv_pars_fragment:uv_pars_fragment,\nuv_pars_vertex:uv_pars_vertex,\nuv_vertex:uv_vertex,\nuv2_pars_fragment:uv2_pars_fragment,\nuv2_pars_vertex:uv2_pars_vertex,\nuv2_vertex:uv2_vertex,\nworldpos_vertex:worldpos_vertex,\n\nbackground_vert:vertex$g,\nbackground_frag:fragment$g,\ncube_vert:vertex$f,\ncube_frag:fragment$f,\ndepth_vert:vertex$e,\ndepth_frag:fragment$e,\ndistanceRGBA_vert:vertex$d,\ndistanceRGBA_frag:fragment$d,\nequirect_vert:vertex$c,\nequirect_frag:fragment$c,\nlinedashed_vert:vertex$b,\nlinedashed_frag:fragment$b,\nmeshbasic_vert:vertex$a,\nmeshbasic_frag:fragment$a,\nmeshlambert_vert:vertex$9,\nmeshlambert_frag:fragment$9,\nmeshmatcap_vert:vertex$8,\nmeshmatcap_frag:fragment$8,\nmeshnormal_vert:vertex$7,\nmeshnormal_frag:fragment$7,\nmeshphong_vert:vertex$6,\nmeshphong_frag:fragment$6,\nmeshphysical_vert:vertex$5,\nmeshphysical_frag:fragment$5,\nmeshtoon_vert:vertex$4,\nmeshtoon_frag:fragment$4,\npoints_vert:vertex$3,\npoints_frag:fragment$3,\nshadow_vert:vertex$2,\nshadow_frag:fragment$2,\nsprite_vert:vertex$1,\nsprite_frag:fragment$1};\n\n\n/**\n * Uniforms library for shared webgl shaders\n */\n\nvar UniformsLib={\n\ncommon:{\n\ndiffuse:{value:/*@__PURE__*/new Color(0xffffff)},\nopacity:{value:1.0},\n\nmap:{value:null},\nuvTransform:{value:/*@__PURE__*/new Matrix3()},\nuv2Transform:{value:/*@__PURE__*/new Matrix3()},\n\nalphaMap:{value:null},\nalphaTest:{value:0}},\n\n\n\nspecularmap:{\n\nspecularMap:{value:null}},\n\n\n\nenvmap:{\n\nenvMap:{value:null},\nflipEnvMap:{value:-1},\nreflectivity:{value:1.0},// basic, lambert, phong\nior:{value:1.5},// physical\nrefractionRatio:{value:0.98// basic, lambert, phong\n}},\n\n\naomap:{\n\naoMap:{value:null},\naoMapIntensity:{value:1}},\n\n\n\nlightmap:{\n\nlightMap:{value:null},\nlightMapIntensity:{value:1}},\n\n\n\nemissivemap:{\n\nemissiveMap:{value:null}},\n\n\n\nbumpmap:{\n\nbumpMap:{value:null},\nbumpScale:{value:1}},\n\n\n\nnormalmap:{\n\nnormalMap:{value:null},\nnormalScale:{value:/*@__PURE__*/new Vector2(1,1)}},\n\n\n\ndisplacementmap:{\n\ndisplacementMap:{value:null},\ndisplacementScale:{value:1},\ndisplacementBias:{value:0}},\n\n\n\nroughnessmap:{\n\nroughnessMap:{value:null}},\n\n\n\nmetalnessmap:{\n\nmetalnessMap:{value:null}},\n\n\n\ngradientmap:{\n\ngradientMap:{value:null}},\n\n\n\nfog:{\n\nfogDensity:{value:0.00025},\nfogNear:{value:1},\nfogFar:{value:2000},\nfogColor:{value:/*@__PURE__*/new Color(0xffffff)}},\n\n\n\nlights:{\n\nambientLightColor:{value:[]},\n\nlightProbe:{value:[]},\n\ndirectionalLights:{value:[],properties:{\ndirection:{},\ncolor:{}}},\n\n\ndirectionalLightShadows:{value:[],properties:{\nshadowBias:{},\nshadowNormalBias:{},\nshadowRadius:{},\nshadowMapSize:{}}},\n\n\ndirectionalShadowMap:{value:[]},\ndirectionalShadowMatrix:{value:[]},\n\nspotLights:{value:[],properties:{\ncolor:{},\nposition:{},\ndirection:{},\ndistance:{},\nconeCos:{},\npenumbraCos:{},\ndecay:{}}},\n\n\nspotLightShadows:{value:[],properties:{\nshadowBias:{},\nshadowNormalBias:{},\nshadowRadius:{},\nshadowMapSize:{}}},\n\n\nspotShadowMap:{value:[]},\nspotShadowMatrix:{value:[]},\n\npointLights:{value:[],properties:{\ncolor:{},\nposition:{},\ndecay:{},\ndistance:{}}},\n\n\npointLightShadows:{value:[],properties:{\nshadowBias:{},\nshadowNormalBias:{},\nshadowRadius:{},\nshadowMapSize:{},\nshadowCameraNear:{},\nshadowCameraFar:{}}},\n\n\npointShadowMap:{value:[]},\npointShadowMatrix:{value:[]},\n\nhemisphereLights:{value:[],properties:{\ndirection:{},\nskyColor:{},\ngroundColor:{}}},\n\n\n// TODO (abelnation): RectAreaLight BRDF data needs to be moved from example to main src\nrectAreaLights:{value:[],properties:{\ncolor:{},\nposition:{},\nwidth:{},\nheight:{}}},\n\n\nltc_1:{value:null},\nltc_2:{value:null}},\n\n\n\npoints:{\n\ndiffuse:{value:/*@__PURE__*/new Color(0xffffff)},\nopacity:{value:1.0},\nsize:{value:1.0},\nscale:{value:1.0},\nmap:{value:null},\nalphaMap:{value:null},\nalphaTest:{value:0},\nuvTransform:{value:/*@__PURE__*/new Matrix3()}},\n\n\n\nsprite:{\n\ndiffuse:{value:/*@__PURE__*/new Color(0xffffff)},\nopacity:{value:1.0},\ncenter:{value:/*@__PURE__*/new Vector2(0.5,0.5)},\nrotation:{value:0.0},\nmap:{value:null},\nalphaMap:{value:null},\nalphaTest:{value:0},\nuvTransform:{value:/*@__PURE__*/new Matrix3()}}};\n\n\n\n\n\nvar ShaderLib={\n\nbasic:{\n\nuniforms:/*@__PURE__*/mergeUniforms([\nUniformsLib.common,\nUniformsLib.specularmap,\nUniformsLib.envmap,\nUniformsLib.aomap,\nUniformsLib.lightmap,\nUniformsLib.fog]),\n\n\nvertexShader:ShaderChunk.meshbasic_vert,\nfragmentShader:ShaderChunk.meshbasic_frag},\n\n\n\nlambert:{\n\nuniforms:/*@__PURE__*/mergeUniforms([\nUniformsLib.common,\nUniformsLib.specularmap,\nUniformsLib.envmap,\nUniformsLib.aomap,\nUniformsLib.lightmap,\nUniformsLib.emissivemap,\nUniformsLib.fog,\nUniformsLib.lights,\n{\nemissive:{value:/*@__PURE__*/new Color(0x000000)}}]),\n\n\n\nvertexShader:ShaderChunk.meshlambert_vert,\nfragmentShader:ShaderChunk.meshlambert_frag},\n\n\n\nphong:{\n\nuniforms:/*@__PURE__*/mergeUniforms([\nUniformsLib.common,\nUniformsLib.specularmap,\nUniformsLib.envmap,\nUniformsLib.aomap,\nUniformsLib.lightmap,\nUniformsLib.emissivemap,\nUniformsLib.bumpmap,\nUniformsLib.normalmap,\nUniformsLib.displacementmap,\nUniformsLib.fog,\nUniformsLib.lights,\n{\nemissive:{value:/*@__PURE__*/new Color(0x000000)},\nspecular:{value:/*@__PURE__*/new Color(0x111111)},\nshininess:{value:30}}]),\n\n\n\nvertexShader:ShaderChunk.meshphong_vert,\nfragmentShader:ShaderChunk.meshphong_frag},\n\n\n\nstandard:{\n\nuniforms:/*@__PURE__*/mergeUniforms([\nUniformsLib.common,\nUniformsLib.envmap,\nUniformsLib.aomap,\nUniformsLib.lightmap,\nUniformsLib.emissivemap,\nUniformsLib.bumpmap,\nUniformsLib.normalmap,\nUniformsLib.displacementmap,\nUniformsLib.roughnessmap,\nUniformsLib.metalnessmap,\nUniformsLib.fog,\nUniformsLib.lights,\n{\nemissive:{value:/*@__PURE__*/new Color(0x000000)},\nroughness:{value:1.0},\nmetalness:{value:0.0},\nenvMapIntensity:{value:1// temporary\n}}]),\n\n\nvertexShader:ShaderChunk.meshphysical_vert,\nfragmentShader:ShaderChunk.meshphysical_frag},\n\n\n\ntoon:{\n\nuniforms:/*@__PURE__*/mergeUniforms([\nUniformsLib.common,\nUniformsLib.aomap,\nUniformsLib.lightmap,\nUniformsLib.emissivemap,\nUniformsLib.bumpmap,\nUniformsLib.normalmap,\nUniformsLib.displacementmap,\nUniformsLib.gradientmap,\nUniformsLib.fog,\nUniformsLib.lights,\n{\nemissive:{value:/*@__PURE__*/new Color(0x000000)}}]),\n\n\n\nvertexShader:ShaderChunk.meshtoon_vert,\nfragmentShader:ShaderChunk.meshtoon_frag},\n\n\n\nmatcap:{\n\nuniforms:/*@__PURE__*/mergeUniforms([\nUniformsLib.common,\nUniformsLib.bumpmap,\nUniformsLib.normalmap,\nUniformsLib.displacementmap,\nUniformsLib.fog,\n{\nmatcap:{value:null}}]),\n\n\n\nvertexShader:ShaderChunk.meshmatcap_vert,\nfragmentShader:ShaderChunk.meshmatcap_frag},\n\n\n\npoints:{\n\nuniforms:/*@__PURE__*/mergeUniforms([\nUniformsLib.points,\nUniformsLib.fog]),\n\n\nvertexShader:ShaderChunk.points_vert,\nfragmentShader:ShaderChunk.points_frag},\n\n\n\ndashed:{\n\nuniforms:/*@__PURE__*/mergeUniforms([\nUniformsLib.common,\nUniformsLib.fog,\n{\nscale:{value:1},\ndashSize:{value:1},\ntotalSize:{value:2}}]),\n\n\n\nvertexShader:ShaderChunk.linedashed_vert,\nfragmentShader:ShaderChunk.linedashed_frag},\n\n\n\ndepth:{\n\nuniforms:/*@__PURE__*/mergeUniforms([\nUniformsLib.common,\nUniformsLib.displacementmap]),\n\n\nvertexShader:ShaderChunk.depth_vert,\nfragmentShader:ShaderChunk.depth_frag},\n\n\n\nnormal:{\n\nuniforms:/*@__PURE__*/mergeUniforms([\nUniformsLib.common,\nUniformsLib.bumpmap,\nUniformsLib.normalmap,\nUniformsLib.displacementmap,\n{\nopacity:{value:1.0}}]),\n\n\n\nvertexShader:ShaderChunk.meshnormal_vert,\nfragmentShader:ShaderChunk.meshnormal_frag},\n\n\n\nsprite:{\n\nuniforms:/*@__PURE__*/mergeUniforms([\nUniformsLib.sprite,\nUniformsLib.fog]),\n\n\nvertexShader:ShaderChunk.sprite_vert,\nfragmentShader:ShaderChunk.sprite_frag},\n\n\n\nbackground:{\n\nuniforms:{\nuvTransform:{value:/*@__PURE__*/new Matrix3()},\nt2D:{value:null}},\n\n\nvertexShader:ShaderChunk.background_vert,\nfragmentShader:ShaderChunk.background_frag},\n\n\n\ncube:{\n\nuniforms:/*@__PURE__*/mergeUniforms([\nUniformsLib.envmap,\n{\nopacity:{value:1.0}}]),\n\n\n\nvertexShader:ShaderChunk.cube_vert,\nfragmentShader:ShaderChunk.cube_frag},\n\n\n\nequirect:{\n\nuniforms:{\ntEquirect:{value:null}},\n\n\nvertexShader:ShaderChunk.equirect_vert,\nfragmentShader:ShaderChunk.equirect_frag},\n\n\n\ndistanceRGBA:{\n\nuniforms:/*@__PURE__*/mergeUniforms([\nUniformsLib.common,\nUniformsLib.displacementmap,\n{\nreferencePosition:{value:/*@__PURE__*/new Vector3()},\nnearDistance:{value:1},\nfarDistance:{value:1000}}]),\n\n\n\nvertexShader:ShaderChunk.distanceRGBA_vert,\nfragmentShader:ShaderChunk.distanceRGBA_frag},\n\n\n\nshadow:{\n\nuniforms:/*@__PURE__*/mergeUniforms([\nUniformsLib.lights,\nUniformsLib.fog,\n{\ncolor:{value:/*@__PURE__*/new Color(0x00000)},\nopacity:{value:1.0}}]),\n\n\n\nvertexShader:ShaderChunk.shadow_vert,\nfragmentShader:ShaderChunk.shadow_frag}};\n\n\n\n\n\nShaderLib.physical={\n\nuniforms:/*@__PURE__*/mergeUniforms([\nShaderLib.standard.uniforms,\n{\nclearcoat:{value:0},\nclearcoatMap:{value:null},\nclearcoatRoughness:{value:0},\nclearcoatRoughnessMap:{value:null},\nclearcoatNormalScale:{value:/*@__PURE__*/new Vector2(1,1)},\nclearcoatNormalMap:{value:null},\niridescence:{value:0},\niridescenceMap:{value:null},\niridescenceIOR:{value:1.3},\niridescenceThicknessMinimum:{value:100},\niridescenceThicknessMaximum:{value:400},\niridescenceThicknessMap:{value:null},\nsheen:{value:0},\nsheenColor:{value:/*@__PURE__*/new Color(0x000000)},\nsheenColorMap:{value:null},\nsheenRoughness:{value:1},\nsheenRoughnessMap:{value:null},\ntransmission:{value:0},\ntransmissionMap:{value:null},\ntransmissionSamplerSize:{value:/*@__PURE__*/new Vector2()},\ntransmissionSamplerMap:{value:null},\nthickness:{value:0},\nthicknessMap:{value:null},\nattenuationDistance:{value:0},\nattenuationColor:{value:/*@__PURE__*/new Color(0x000000)},\nspecularIntensity:{value:1},\nspecularIntensityMap:{value:null},\nspecularColor:{value:/*@__PURE__*/new Color(1,1,1)},\nspecularColorMap:{value:null}}]),\n\n\n\nvertexShader:ShaderChunk.meshphysical_vert,\nfragmentShader:ShaderChunk.meshphysical_frag};\n\n\n\nfunction WebGLBackground(renderer,cubemaps,state,objects,alpha,premultipliedAlpha){\n\nvar clearColor=new Color(0x000000);\nvar clearAlpha=alpha===true?0:1;\n\nvar planeMesh=void 0;\nvar boxMesh=void 0;\n\nvar currentBackground=null;\nvar currentBackgroundVersion=0;\nvar currentTonemapping=null;\n\nfunction render(renderList,scene){\n\nvar forceClear=false;\nvar background=scene.isScene===true?scene.background:null;\n\nif(background&&background.isTexture){\n\nbackground=cubemaps.get(background);\n\n}\n\n// Ignore background in AR\n// TODO: Reconsider this.\n\nvar xr=renderer.xr;\nvar session=xr.getSession&&xr.getSession();\n\nif(session&&session.environmentBlendMode==='additive'){\n\nbackground=null;\n\n}\n\nif(background===null){\n\nsetClear(clearColor,clearAlpha);\n\n}else if(background&&background.isColor){\n\nsetClear(background,1);\nforceClear=true;\n\n}\n\nif(renderer.autoClear||forceClear){\n\nrenderer.clear(renderer.autoClearColor,renderer.autoClearDepth,renderer.autoClearStencil);\n\n}\n\nif(background&&(background.isCubeTexture||background.mapping===CubeUVReflectionMapping)){\n\nif(boxMesh===undefined){\n\nboxMesh=new Mesh(\nnew BoxGeometry(1,1,1),\nnew ShaderMaterial({\nname:'BackgroundCubeMaterial',\nuniforms:cloneUniforms(ShaderLib.cube.uniforms),\nvertexShader:ShaderLib.cube.vertexShader,\nfragmentShader:ShaderLib.cube.fragmentShader,\nside:BackSide,\ndepthTest:false,\ndepthWrite:false,\nfog:false}));\n\n\n\nboxMesh.geometry.deleteAttribute('normal');\nboxMesh.geometry.deleteAttribute('uv');\n\nboxMesh.onBeforeRender=function(renderer,scene,camera){\n\nthis.matrixWorld.copyPosition(camera.matrixWorld);\n\n};\n\n// enable code injection for non-built-in material\nObject.defineProperty(boxMesh.material,'envMap',{\n\nget:function get(){\n\nreturn this.uniforms.envMap.value;\n\n}});\n\n\n\nobjects.update(boxMesh);\n\n}\n\nboxMesh.material.uniforms.envMap.value=background;\nboxMesh.material.uniforms.flipEnvMap.value=background.isCubeTexture&&background.isRenderTargetTexture===false?-1:1;\n\nif(currentBackground!==background||\ncurrentBackgroundVersion!==background.version||\ncurrentTonemapping!==renderer.toneMapping){\n\nboxMesh.material.needsUpdate=true;\n\ncurrentBackground=background;\ncurrentBackgroundVersion=background.version;\ncurrentTonemapping=renderer.toneMapping;\n\n}\n\nboxMesh.layers.enableAll();\n\n// push to the pre-sorted opaque render list\nrenderList.unshift(boxMesh,boxMesh.geometry,boxMesh.material,0,0,null);\n\n}else if(background&&background.isTexture){\n\nif(planeMesh===undefined){\n\nplaneMesh=new Mesh(\nnew PlaneGeometry(2,2),\nnew ShaderMaterial({\nname:'BackgroundMaterial',\nuniforms:cloneUniforms(ShaderLib.background.uniforms),\nvertexShader:ShaderLib.background.vertexShader,\nfragmentShader:ShaderLib.background.fragmentShader,\nside:FrontSide,\ndepthTest:false,\ndepthWrite:false,\nfog:false}));\n\n\n\nplaneMesh.geometry.deleteAttribute('normal');\n\n// enable code injection for non-built-in material\nObject.defineProperty(planeMesh.material,'map',{\n\nget:function get(){\n\nreturn this.uniforms.t2D.value;\n\n}});\n\n\n\nobjects.update(planeMesh);\n\n}\n\nplaneMesh.material.uniforms.t2D.value=background;\n\nif(background.matrixAutoUpdate===true){\n\nbackground.updateMatrix();\n\n}\n\nplaneMesh.material.uniforms.uvTransform.value.copy(background.matrix);\n\nif(currentBackground!==background||\ncurrentBackgroundVersion!==background.version||\ncurrentTonemapping!==renderer.toneMapping){\n\nplaneMesh.material.needsUpdate=true;\n\ncurrentBackground=background;\ncurrentBackgroundVersion=background.version;\ncurrentTonemapping=renderer.toneMapping;\n\n}\n\nplaneMesh.layers.enableAll();\n\n// push to the pre-sorted opaque render list\nrenderList.unshift(planeMesh,planeMesh.geometry,planeMesh.material,0,0,null);\n\n}\n\n}\n\nfunction setClear(color,alpha){\n\nstate.buffers.color.setClear(color.r,color.g,color.b,alpha,premultipliedAlpha);\n\n}\n\nreturn{\n\ngetClearColor:function getClearColor(){\n\nreturn clearColor;\n\n},\nsetClearColor:function setClearColor(color){var alpha=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1;\n\nclearColor.set(color);\nclearAlpha=alpha;\nsetClear(clearColor,clearAlpha);\n\n},\ngetClearAlpha:function getClearAlpha(){\n\nreturn clearAlpha;\n\n},\nsetClearAlpha:function setClearAlpha(alpha){\n\nclearAlpha=alpha;\nsetClear(clearColor,clearAlpha);\n\n},\nrender:render};\n\n\n\n}\n\nfunction WebGLBindingStates(gl,extensions,attributes,capabilities){\n\nvar maxVertexAttributes=gl.getParameter(34921);\n\nvar extension=capabilities.isWebGL2?null:extensions.get('OES_vertex_array_object');\nvar vaoAvailable=capabilities.isWebGL2||extension!==null;\n\nvar bindingStates={};\n\nvar defaultState=createBindingState(null);\nvar currentState=defaultState;\nvar forceUpdate=false;\n\nfunction setup(object,material,program,geometry,index){\n\nvar updateBuffers=false;\n\nif(vaoAvailable){\n\nvar state=getBindingState(geometry,program,material);\n\nif(currentState!==state){\n\ncurrentState=state;\nbindVertexArrayObject(currentState.object);\n\n}\n\nupdateBuffers=needsUpdate(object,geometry,program,index);\n\nif(updateBuffers)saveCache(object,geometry,program,index);\n\n}else{\n\nvar wireframe=material.wireframe===true;\n\nif(currentState.geometry!==geometry.id||\ncurrentState.program!==program.id||\ncurrentState.wireframe!==wireframe){\n\ncurrentState.geometry=geometry.id;\ncurrentState.program=program.id;\ncurrentState.wireframe=wireframe;\n\nupdateBuffers=true;\n\n}\n\n}\n\nif(index!==null){\n\nattributes.update(index,34963);\n\n}\n\nif(updateBuffers||forceUpdate){\n\nforceUpdate=false;\n\nsetupVertexAttributes(object,material,program,geometry);\n\nif(index!==null){\n\ngl.bindBuffer(34963,attributes.get(index).buffer);\n\n}\n\n}\n\n}\n\nfunction createVertexArrayObject(){\n\nif(capabilities.isWebGL2)return gl.createVertexArray();\n\nreturn extension.createVertexArrayOES();\n\n}\n\nfunction bindVertexArrayObject(vao){\n\nif(capabilities.isWebGL2)return gl.bindVertexArray(vao);\n\nreturn extension.bindVertexArrayOES(vao);\n\n}\n\nfunction deleteVertexArrayObject(vao){\n\nif(capabilities.isWebGL2)return gl.deleteVertexArray(vao);\n\nreturn extension.deleteVertexArrayOES(vao);\n\n}\n\nfunction getBindingState(geometry,program,material){\n\nvar wireframe=material.wireframe===true;\n\nvar programMap=bindingStates[geometry.id];\n\nif(programMap===undefined){\n\nprogramMap={};\nbindingStates[geometry.id]=programMap;\n\n}\n\nvar stateMap=programMap[program.id];\n\nif(stateMap===undefined){\n\nstateMap={};\nprogramMap[program.id]=stateMap;\n\n}\n\nvar state=stateMap[wireframe];\n\nif(state===undefined){\n\nstate=createBindingState(createVertexArrayObject());\nstateMap[wireframe]=state;\n\n}\n\nreturn state;\n\n}\n\nfunction createBindingState(vao){\n\nvar newAttributes=[];\nvar enabledAttributes=[];\nvar attributeDivisors=[];\n\nfor(var i=0;i<maxVertexAttributes;i++){\n\nnewAttributes[i]=0;\nenabledAttributes[i]=0;\nattributeDivisors[i]=0;\n\n}\n\nreturn{\n\n// for backward compatibility on non-VAO support browser\ngeometry:null,\nprogram:null,\nwireframe:false,\n\nnewAttributes:newAttributes,\nenabledAttributes:enabledAttributes,\nattributeDivisors:attributeDivisors,\nobject:vao,\nattributes:{},\nindex:null};\n\n\n\n}\n\nfunction needsUpdate(object,geometry,program,index){\n\nvar cachedAttributes=currentState.attributes;\nvar geometryAttributes=geometry.attributes;\n\nvar attributesNum=0;\n\nvar programAttributes=program.getAttributes();\n\nfor(var name in programAttributes){\n\nvar programAttribute=programAttributes[name];\n\nif(programAttribute.location>=0){\n\nvar cachedAttribute=cachedAttributes[name];\nvar geometryAttribute=geometryAttributes[name];\n\nif(geometryAttribute===undefined){\n\nif(name==='instanceMatrix'&&object.instanceMatrix)geometryAttribute=object.instanceMatrix;\nif(name==='instanceColor'&&object.instanceColor)geometryAttribute=object.instanceColor;\n\n}\n\nif(cachedAttribute===undefined)return true;\n\nif(cachedAttribute.attribute!==geometryAttribute)return true;\n\nif(geometryAttribute&&cachedAttribute.data!==geometryAttribute.data)return true;\n\nattributesNum++;\n\n}\n\n}\n\nif(currentState.attributesNum!==attributesNum)return true;\n\nif(currentState.index!==index)return true;\n\nreturn false;\n\n}\n\nfunction saveCache(object,geometry,program,index){\n\nvar cache={};\nvar attributes=geometry.attributes;\nvar attributesNum=0;\n\nvar programAttributes=program.getAttributes();\n\nfor(var name in programAttributes){\n\nvar programAttribute=programAttributes[name];\n\nif(programAttribute.location>=0){\n\nvar attribute=attributes[name];\n\nif(attribute===undefined){\n\nif(name==='instanceMatrix'&&object.instanceMatrix)attribute=object.instanceMatrix;\nif(name==='instanceColor'&&object.instanceColor)attribute=object.instanceColor;\n\n}\n\nvar data={};\ndata.attribute=attribute;\n\nif(attribute&&attribute.data){\n\ndata.data=attribute.data;\n\n}\n\ncache[name]=data;\n\nattributesNum++;\n\n}\n\n}\n\ncurrentState.attributes=cache;\ncurrentState.attributesNum=attributesNum;\n\ncurrentState.index=index;\n\n}\n\nfunction initAttributes(){\n\nvar newAttributes=currentState.newAttributes;\n\nfor(var i=0,il=newAttributes.length;i<il;i++){\n\nnewAttributes[i]=0;\n\n}\n\n}\n\nfunction enableAttribute(attribute){\n\nenableAttributeAndDivisor(attribute,0);\n\n}\n\nfunction enableAttributeAndDivisor(attribute,meshPerAttribute){\n\nvar newAttributes=currentState.newAttributes;\nvar enabledAttributes=currentState.enabledAttributes;\nvar attributeDivisors=currentState.attributeDivisors;\n\nnewAttributes[attribute]=1;\n\nif(enabledAttributes[attribute]===0){\n\ngl.enableVertexAttribArray(attribute);\nenabledAttributes[attribute]=1;\n\n}\n\nif(attributeDivisors[attribute]!==meshPerAttribute){\n\nvar _extension=capabilities.isWebGL2?gl:extensions.get('ANGLE_instanced_arrays');\n\n_extension[capabilities.isWebGL2?'vertexAttribDivisor':'vertexAttribDivisorANGLE'](attribute,meshPerAttribute);\nattributeDivisors[attribute]=meshPerAttribute;\n\n}\n\n}\n\nfunction disableUnusedAttributes(){\n\nvar newAttributes=currentState.newAttributes;\nvar enabledAttributes=currentState.enabledAttributes;\n\nfor(var i=0,il=enabledAttributes.length;i<il;i++){\n\nif(enabledAttributes[i]!==newAttributes[i]){\n\ngl.disableVertexAttribArray(i);\nenabledAttributes[i]=0;\n\n}\n\n}\n\n}\n\nfunction vertexAttribPointer(index,size,type,normalized,stride,offset){\n\nif(capabilities.isWebGL2===true&&(type===5124||type===5125)){\n\ngl.vertexAttribIPointer(index,size,type,stride,offset);\n\n}else{\n\ngl.vertexAttribPointer(index,size,type,normalized,stride,offset);\n\n}\n\n}\n\nfunction setupVertexAttributes(object,material,program,geometry){\n\nif(capabilities.isWebGL2===false&&(object.isInstancedMesh||geometry.isInstancedBufferGeometry)){\n\nif(extensions.get('ANGLE_instanced_arrays')===null)return;\n\n}\n\ninitAttributes();\n\nvar geometryAttributes=geometry.attributes;\n\nvar programAttributes=program.getAttributes();\n\nvar materialDefaultAttributeValues=material.defaultAttributeValues;\n\nfor(var name in programAttributes){\n\nvar programAttribute=programAttributes[name];\n\nif(programAttribute.location>=0){\n\nvar geometryAttribute=geometryAttributes[name];\n\nif(geometryAttribute===undefined){\n\nif(name==='instanceMatrix'&&object.instanceMatrix)geometryAttribute=object.instanceMatrix;\nif(name==='instanceColor'&&object.instanceColor)geometryAttribute=object.instanceColor;\n\n}\n\nif(geometryAttribute!==undefined){\n\nvar normalized=geometryAttribute.normalized;\nvar size=geometryAttribute.itemSize;\n\nvar attribute=attributes.get(geometryAttribute);\n\n// TODO Attribute may not be available on context restore\n\nif(attribute===undefined)continue;\n\nvar buffer=attribute.buffer;\nvar type=attribute.type;\nvar bytesPerElement=attribute.bytesPerElement;\n\nif(geometryAttribute.isInterleavedBufferAttribute){\n\nvar data=geometryAttribute.data;\nvar stride=data.stride;\nvar offset=geometryAttribute.offset;\n\nif(data.isInstancedInterleavedBuffer){\n\nfor(var i=0;i<programAttribute.locationSize;i++){\n\nenableAttributeAndDivisor(programAttribute.location+i,data.meshPerAttribute);\n\n}\n\nif(object.isInstancedMesh!==true&&geometry._maxInstanceCount===undefined){\n\ngeometry._maxInstanceCount=data.meshPerAttribute*data.count;\n\n}\n\n}else{\n\nfor(var _i18=0;_i18<programAttribute.locationSize;_i18++){\n\nenableAttribute(programAttribute.location+_i18);\n\n}\n\n}\n\ngl.bindBuffer(34962,buffer);\n\nfor(var _i19=0;_i19<programAttribute.locationSize;_i19++){\n\nvertexAttribPointer(\nprogramAttribute.location+_i19,\nsize/programAttribute.locationSize,\ntype,\nnormalized,\nstride*bytesPerElement,\n(offset+size/programAttribute.locationSize*_i19)*bytesPerElement);\n\n\n}\n\n}else{\n\nif(geometryAttribute.isInstancedBufferAttribute){\n\nfor(var _i20=0;_i20<programAttribute.locationSize;_i20++){\n\nenableAttributeAndDivisor(programAttribute.location+_i20,geometryAttribute.meshPerAttribute);\n\n}\n\nif(object.isInstancedMesh!==true&&geometry._maxInstanceCount===undefined){\n\ngeometry._maxInstanceCount=geometryAttribute.meshPerAttribute*geometryAttribute.count;\n\n}\n\n}else{\n\nfor(var _i21=0;_i21<programAttribute.locationSize;_i21++){\n\nenableAttribute(programAttribute.location+_i21);\n\n}\n\n}\n\ngl.bindBuffer(34962,buffer);\n\nfor(var _i22=0;_i22<programAttribute.locationSize;_i22++){\n\nvertexAttribPointer(\nprogramAttribute.location+_i22,\nsize/programAttribute.locationSize,\ntype,\nnormalized,\nsize*bytesPerElement,\nsize/programAttribute.locationSize*_i22*bytesPerElement);\n\n\n}\n\n}\n\n}else if(materialDefaultAttributeValues!==undefined){\n\nvar _value2=materialDefaultAttributeValues[name];\n\nif(_value2!==undefined){\n\nswitch(_value2.length){\n\ncase 2:\ngl.vertexAttrib2fv(programAttribute.location,_value2);\nbreak;\n\ncase 3:\ngl.vertexAttrib3fv(programAttribute.location,_value2);\nbreak;\n\ncase 4:\ngl.vertexAttrib4fv(programAttribute.location,_value2);\nbreak;\n\ndefault:\ngl.vertexAttrib1fv(programAttribute.location,_value2);}\n\n\n\n}\n\n}\n\n}\n\n}\n\ndisableUnusedAttributes();\n\n}\n\nfunction dispose(){\n\nreset();\n\nfor(var geometryId in bindingStates){\n\nvar programMap=bindingStates[geometryId];\n\nfor(var programId in programMap){\n\nvar stateMap=programMap[programId];\n\nfor(var wireframe in stateMap){\n\ndeleteVertexArrayObject(stateMap[wireframe].object);\n\ndelete stateMap[wireframe];\n\n}\n\ndelete programMap[programId];\n\n}\n\ndelete bindingStates[geometryId];\n\n}\n\n}\n\nfunction releaseStatesOfGeometry(geometry){\n\nif(bindingStates[geometry.id]===undefined)return;\n\nvar programMap=bindingStates[geometry.id];\n\nfor(var programId in programMap){\n\nvar stateMap=programMap[programId];\n\nfor(var wireframe in stateMap){\n\ndeleteVertexArrayObject(stateMap[wireframe].object);\n\ndelete stateMap[wireframe];\n\n}\n\ndelete programMap[programId];\n\n}\n\ndelete bindingStates[geometry.id];\n\n}\n\nfunction releaseStatesOfProgram(program){\n\nfor(var geometryId in bindingStates){\n\nvar programMap=bindingStates[geometryId];\n\nif(programMap[program.id]===undefined)continue;\n\nvar stateMap=programMap[program.id];\n\nfor(var wireframe in stateMap){\n\ndeleteVertexArrayObject(stateMap[wireframe].object);\n\ndelete stateMap[wireframe];\n\n}\n\ndelete programMap[program.id];\n\n}\n\n}\n\nfunction reset(){\n\nresetDefaultState();\nforceUpdate=true;\n\nif(currentState===defaultState)return;\n\ncurrentState=defaultState;\nbindVertexArrayObject(currentState.object);\n\n}\n\n// for backward-compatibility\n\nfunction resetDefaultState(){\n\ndefaultState.geometry=null;\ndefaultState.program=null;\ndefaultState.wireframe=false;\n\n}\n\nreturn{\n\nsetup:setup,\nreset:reset,\nresetDefaultState:resetDefaultState,\ndispose:dispose,\nreleaseStatesOfGeometry:releaseStatesOfGeometry,\nreleaseStatesOfProgram:releaseStatesOfProgram,\n\ninitAttributes:initAttributes,\nenableAttribute:enableAttribute,\ndisableUnusedAttributes:disableUnusedAttributes};\n\n\n\n}\n\nfunction WebGLBufferRenderer(gl,extensions,info,capabilities){\n\nvar isWebGL2=capabilities.isWebGL2;\n\nvar mode=void 0;\n\nfunction setMode(value){\n\nmode=value;\n\n}\n\nfunction render(start,count){\n\ngl.drawArrays(mode,start,count);\n\ninfo.update(count,mode,1);\n\n}\n\nfunction renderInstances(start,count,primcount){\n\nif(primcount===0)return;\n\nvar extension=void 0,methodName=void 0;\n\nif(isWebGL2){\n\nextension=gl;\nmethodName='drawArraysInstanced';\n\n}else{\n\nextension=extensions.get('ANGLE_instanced_arrays');\nmethodName='drawArraysInstancedANGLE';\n\nif(extension===null){\n\nconsole.error('THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.');\nreturn;\n\n}\n\n}\n\nextension[methodName](mode,start,count,primcount);\n\ninfo.update(count,mode,primcount);\n\n}\n\n//\n\nthis.setMode=setMode;\nthis.render=render;\nthis.renderInstances=renderInstances;\n\n}\n\nfunction WebGLCapabilities(gl,extensions,parameters){\n\nvar maxAnisotropy=void 0;\n\nfunction getMaxAnisotropy(){\n\nif(maxAnisotropy!==undefined)return maxAnisotropy;\n\nif(extensions.has('EXT_texture_filter_anisotropic')===true){\n\nvar extension=extensions.get('EXT_texture_filter_anisotropic');\n\nmaxAnisotropy=gl.getParameter(extension.MAX_TEXTURE_MAX_ANISOTROPY_EXT);\n\n}else{\n\nmaxAnisotropy=0;\n\n}\n\nreturn maxAnisotropy;\n\n}\n\nfunction getMaxPrecision(precision){\n\nif(precision==='highp'){\n\nif(gl.getShaderPrecisionFormat(35633,36338).precision>0&&\ngl.getShaderPrecisionFormat(35632,36338).precision>0){\n\nreturn'highp';\n\n}\n\nprecision='mediump';\n\n}\n\nif(precision==='mediump'){\n\nif(gl.getShaderPrecisionFormat(35633,36337).precision>0&&\ngl.getShaderPrecisionFormat(35632,36337).precision>0){\n\nreturn'mediump';\n\n}\n\n}\n\nreturn'lowp';\n\n}\n\nvar isWebGL2=typeof WebGL2RenderingContext!=='undefined'&&gl instanceof WebGL2RenderingContext||\ntypeof WebGL2ComputeRenderingContext!=='undefined'&&gl instanceof WebGL2ComputeRenderingContext;\n\nvar precision=parameters.precision!==undefined?parameters.precision:'highp';\nvar maxPrecision=getMaxPrecision(precision);\n\nif(maxPrecision!==precision){\n\nconsole.warn('THREE.WebGLRenderer:',precision,'not supported, using',maxPrecision,'instead.');\nprecision=maxPrecision;\n\n}\n\nvar drawBuffers=isWebGL2||extensions.has('WEBGL_draw_buffers');\n\nvar logarithmicDepthBuffer=parameters.logarithmicDepthBuffer===true;\n\nvar maxTextures=gl.getParameter(34930);\nvar maxVertexTextures=gl.getParameter(35660);\nvar maxTextureSize=gl.getParameter(3379);\nvar maxCubemapSize=gl.getParameter(34076);\n\nvar maxAttributes=gl.getParameter(34921);\nvar maxVertexUniforms=gl.getParameter(36347);\nvar maxVaryings=gl.getParameter(36348);\nvar maxFragmentUniforms=gl.getParameter(36349);\n\nvar vertexTextures=maxVertexTextures>0;\nvar floatFragmentTextures=isWebGL2||extensions.has('OES_texture_float');\nvar floatVertexTextures=vertexTextures&&floatFragmentTextures;\n\nvar maxSamples=isWebGL2?gl.getParameter(36183):0;\n\nreturn{\n\nisWebGL2:isWebGL2,\n\ndrawBuffers:drawBuffers,\n\ngetMaxAnisotropy:getMaxAnisotropy,\ngetMaxPrecision:getMaxPrecision,\n\nprecision:precision,\nlogarithmicDepthBuffer:logarithmicDepthBuffer,\n\nmaxTextures:maxTextures,\nmaxVertexTextures:maxVertexTextures,\nmaxTextureSize:maxTextureSize,\nmaxCubemapSize:maxCubemapSize,\n\nmaxAttributes:maxAttributes,\nmaxVertexUniforms:maxVertexUniforms,\nmaxVaryings:maxVaryings,\nmaxFragmentUniforms:maxFragmentUniforms,\n\nvertexTextures:vertexTextures,\nfloatFragmentTextures:floatFragmentTextures,\nfloatVertexTextures:floatVertexTextures,\n\nmaxSamples:maxSamples};\n\n\n\n}\n\nfunction WebGLClipping(properties){\n\nvar scope=this;\n\nvar globalState=null,\nnumGlobalPlanes=0,\nlocalClippingEnabled=false,\nrenderingShadows=false;\n\nvar plane=new Plane(),\nviewNormalMatrix=new Matrix3(),\n\nuniform={value:null,needsUpdate:false};\n\nthis.uniform=uniform;\nthis.numPlanes=0;\nthis.numIntersection=0;\n\nthis.init=function(planes,enableLocalClipping,camera){\n\nvar enabled=\nplanes.length!==0||\nenableLocalClipping||\n// enable state of previous frame - the clipping code has to\n// run another frame in order to reset the state:\nnumGlobalPlanes!==0||\nlocalClippingEnabled;\n\nlocalClippingEnabled=enableLocalClipping;\n\nglobalState=projectPlanes(planes,camera,0);\nnumGlobalPlanes=planes.length;\n\nreturn enabled;\n\n};\n\nthis.beginShadows=function(){\n\nrenderingShadows=true;\nprojectPlanes(null);\n\n};\n\nthis.endShadows=function(){\n\nrenderingShadows=false;\nresetGlobalState();\n\n};\n\nthis.setState=function(material,camera,useCache){\n\nvar planes=material.clippingPlanes,\nclipIntersection=material.clipIntersection,\nclipShadows=material.clipShadows;\n\nvar materialProperties=properties.get(material);\n\nif(!localClippingEnabled||planes===null||planes.length===0||renderingShadows&&!clipShadows){\n\n// there's no local clipping\n\nif(renderingShadows){\n\n// there's no global clipping\n\nprojectPlanes(null);\n\n}else{\n\nresetGlobalState();\n\n}\n\n}else{\n\nvar nGlobal=renderingShadows?0:numGlobalPlanes,\nlGlobal=nGlobal*4;\n\nvar dstArray=materialProperties.clippingState||null;\n\nuniform.value=dstArray;// ensure unique state\n\ndstArray=projectPlanes(planes,camera,lGlobal,useCache);\n\nfor(var i=0;i!==lGlobal;++i){\n\ndstArray[i]=globalState[i];\n\n}\n\nmaterialProperties.clippingState=dstArray;\nthis.numIntersection=clipIntersection?this.numPlanes:0;\nthis.numPlanes+=nGlobal;\n\n}\n\n\n};\n\nfunction resetGlobalState(){\n\nif(uniform.value!==globalState){\n\nuniform.value=globalState;\nuniform.needsUpdate=numGlobalPlanes>0;\n\n}\n\nscope.numPlanes=numGlobalPlanes;\nscope.numIntersection=0;\n\n}\n\nfunction projectPlanes(planes,camera,dstOffset,skipTransform){\n\nvar nPlanes=planes!==null?planes.length:0;\nvar dstArray=null;\n\nif(nPlanes!==0){\n\ndstArray=uniform.value;\n\nif(skipTransform!==true||dstArray===null){\n\nvar flatSize=dstOffset+nPlanes*4,\nviewMatrix=camera.matrixWorldInverse;\n\nviewNormalMatrix.getNormalMatrix(viewMatrix);\n\nif(dstArray===null||dstArray.length<flatSize){\n\ndstArray=new Float32Array(flatSize);\n\n}\n\nfor(var i=0,i4=dstOffset;i!==nPlanes;++i,i4+=4){\n\nplane.copy(planes[i]).applyMatrix4(viewMatrix,viewNormalMatrix);\n\nplane.normal.toArray(dstArray,i4);\ndstArray[i4+3]=plane.constant;\n\n}\n\n}\n\nuniform.value=dstArray;\nuniform.needsUpdate=true;\n\n}\n\nscope.numPlanes=nPlanes;\nscope.numIntersection=0;\n\nreturn dstArray;\n\n}\n\n}\n\nfunction WebGLCubeMaps(renderer){\n\nvar cubemaps=new WeakMap();\n\nfunction mapTextureMapping(texture,mapping){\n\nif(mapping===EquirectangularReflectionMapping){\n\ntexture.mapping=CubeReflectionMapping;\n\n}else if(mapping===EquirectangularRefractionMapping){\n\ntexture.mapping=CubeRefractionMapping;\n\n}\n\nreturn texture;\n\n}\n\nfunction get(texture){\n\nif(texture&&texture.isTexture&&texture.isRenderTargetTexture===false){\n\nvar mapping=texture.mapping;\n\nif(mapping===EquirectangularReflectionMapping||mapping===EquirectangularRefractionMapping){\n\nif(cubemaps.has(texture)){\n\nvar cubemap=cubemaps.get(texture).texture;\nreturn mapTextureMapping(cubemap,texture.mapping);\n\n}else{\n\nvar image=texture.image;\n\nif(image&&image.height>0){\n\nvar renderTarget=new WebGLCubeRenderTarget(image.height/2);\nrenderTarget.fromEquirectangularTexture(renderer,texture);\ncubemaps.set(texture,renderTarget);\n\ntexture.addEventListener('dispose',onTextureDispose);\n\nreturn mapTextureMapping(renderTarget.texture,texture.mapping);\n\n}else{\n\n// image not yet ready. try the conversion next frame\n\nreturn null;\n\n}\n\n}\n\n}\n\n}\n\nreturn texture;\n\n}\n\nfunction onTextureDispose(event){\n\nvar texture=event.target;\n\ntexture.removeEventListener('dispose',onTextureDispose);\n\nvar cubemap=cubemaps.get(texture);\n\nif(cubemap!==undefined){\n\ncubemaps.delete(texture);\ncubemap.dispose();\n\n}\n\n}\n\nfunction dispose(){\n\ncubemaps=new WeakMap();\n\n}\n\nreturn{\nget:get,\ndispose:dispose};\n\n\n}var\n\nOrthographicCamera=function(_Camera2){_inherits(OrthographicCamera,_Camera2);\n\nfunction OrthographicCamera(){var left=arguments.length>0&&arguments[0]!==undefined?arguments[0]:-1;var right=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1;var top=arguments.length>2&&arguments[2]!==undefined?arguments[2]:1;var bottom=arguments.length>3&&arguments[3]!==undefined?arguments[3]:-1;var near=arguments.length>4&&arguments[4]!==undefined?arguments[4]:0.1;var far=arguments.length>5&&arguments[5]!==undefined?arguments[5]:2000;_classCallCheck(this,OrthographicCamera);var _this32=_possibleConstructorReturn(this,(OrthographicCamera.__proto__||Object.getPrototypeOf(OrthographicCamera)).call(this));\n\n\n\n_this32.isOrthographicCamera=true;\n\n_this32.type='OrthographicCamera';\n\n_this32.zoom=1;\n_this32.view=null;\n\n_this32.left=left;\n_this32.right=right;\n_this32.top=top;\n_this32.bottom=bottom;\n\n_this32.near=near;\n_this32.far=far;\n\n_this32.updateProjectionMatrix();return _this32;\n\n}_createClass(OrthographicCamera,[{key:'copy',value:function copy(\n\nsource,recursive){\n\n_get(OrthographicCamera.prototype.__proto__||Object.getPrototypeOf(OrthographicCamera.prototype),'copy',this).call(this,source,recursive);\n\nthis.left=source.left;\nthis.right=source.right;\nthis.top=source.top;\nthis.bottom=source.bottom;\nthis.near=source.near;\nthis.far=source.far;\n\nthis.zoom=source.zoom;\nthis.view=source.view===null?null:Object.assign({},source.view);\n\nreturn this;\n\n}},{key:'setViewOffset',value:function setViewOffset(\n\nfullWidth,fullHeight,x,y,width,height){\n\nif(this.view===null){\n\nthis.view={\nenabled:true,\nfullWidth:1,\nfullHeight:1,\noffsetX:0,\noffsetY:0,\nwidth:1,\nheight:1};\n\n\n}\n\nthis.view.enabled=true;\nthis.view.fullWidth=fullWidth;\nthis.view.fullHeight=fullHeight;\nthis.view.offsetX=x;\nthis.view.offsetY=y;\nthis.view.width=width;\nthis.view.height=height;\n\nthis.updateProjectionMatrix();\n\n}},{key:'clearViewOffset',value:function clearViewOffset()\n\n{\n\nif(this.view!==null){\n\nthis.view.enabled=false;\n\n}\n\nthis.updateProjectionMatrix();\n\n}},{key:'updateProjectionMatrix',value:function updateProjectionMatrix()\n\n{\n\nvar dx=(this.right-this.left)/(2*this.zoom);\nvar dy=(this.top-this.bottom)/(2*this.zoom);\nvar cx=(this.right+this.left)/2;\nvar cy=(this.top+this.bottom)/2;\n\nvar left=cx-dx;\nvar right=cx+dx;\nvar top=cy+dy;\nvar bottom=cy-dy;\n\nif(this.view!==null&&this.view.enabled){\n\nvar scaleW=(this.right-this.left)/this.view.fullWidth/this.zoom;\nvar scaleH=(this.top-this.bottom)/this.view.fullHeight/this.zoom;\n\nleft+=scaleW*this.view.offsetX;\nright=left+scaleW*this.view.width;\ntop-=scaleH*this.view.offsetY;\nbottom=top-scaleH*this.view.height;\n\n}\n\nthis.projectionMatrix.makeOrthographic(left,right,top,bottom,this.near,this.far);\n\nthis.projectionMatrixInverse.copy(this.projectionMatrix).invert();\n\n}},{key:'toJSON',value:function toJSON(\n\nmeta){\n\nvar data=_get(OrthographicCamera.prototype.__proto__||Object.getPrototypeOf(OrthographicCamera.prototype),'toJSON',this).call(this,meta);\n\ndata.object.zoom=this.zoom;\ndata.object.left=this.left;\ndata.object.right=this.right;\ndata.object.top=this.top;\ndata.object.bottom=this.bottom;\ndata.object.near=this.near;\ndata.object.far=this.far;\n\nif(this.view!==null)data.object.view=Object.assign({},this.view);\n\nreturn data;\n\n}}]);return OrthographicCamera;}(Camera);\n\n\n\nvar LOD_MIN=4;\n\n// The standard deviations (radians) associated with the extra mips. These are\n// chosen to approximate a Trowbridge-Reitz distribution function times the\n// geometric shadowing function. These sigma values squared must match the\n// variance #defines in cube_uv_reflection_fragment.glsl.js.\nvar EXTRA_LOD_SIGMA=[0.125,0.215,0.35,0.446,0.526,0.582];\n\n// The maximum length of the blur for loop. Smaller sigmas will use fewer\n// samples and exit early, but not recompile the shader.\nvar MAX_SAMPLES=20;\n\nvar _flatCamera=/*@__PURE__*/new OrthographicCamera();\nvar _clearColor=/*@__PURE__*/new Color();\nvar _oldTarget=null;\n\n// Golden Ratio\nvar PHI=(1+Math.sqrt(5))/2;\nvar INV_PHI=1/PHI;\n\n// Vertices of a dodecahedron (except the opposites, which represent the\n// same axis), used as axis directions evenly spread on a sphere.\nvar _axisDirections=[\n/*@__PURE__*/new Vector3(1,1,1),\n/*@__PURE__*/new Vector3(-1,1,1),\n/*@__PURE__*/new Vector3(1,1,-1),\n/*@__PURE__*/new Vector3(-1,1,-1),\n/*@__PURE__*/new Vector3(0,PHI,INV_PHI),\n/*@__PURE__*/new Vector3(0,PHI,-INV_PHI),\n/*@__PURE__*/new Vector3(INV_PHI,0,PHI),\n/*@__PURE__*/new Vector3(-INV_PHI,0,PHI),\n/*@__PURE__*/new Vector3(PHI,INV_PHI,0),\n/*@__PURE__*/new Vector3(-PHI,INV_PHI,0)];\n\n/**\n * This class generates a Prefiltered, Mipmapped Radiance Environment Map\n * (PMREM) from a cubeMap environment texture. This allows different levels of\n * blur to be quickly accessed based on material roughness. It is packed into a\n * special CubeUV format that allows us to perform custom interpolation so that\n * we can support nonlinear formats such as RGBE. Unlike a traditional mipmap\n * chain, it only goes down to the LOD_MIN level (above), and then creates extra\n * even more filtered 'mips' at the same LOD_MIN resolution, associated with\n * higher roughness levels. In this way we maintain resolution to smoothly\n * interpolate diffuse lighting while limiting sampling computation.\n *\n * Paper: Fast, Accurate Image-Based Lighting\n * https://drive.google.com/file/d/15y8r_UpKlU9SvV4ILb0C3qCPecS8pvLz/view\n*/var\n\nPMREMGenerator=function(){\n\nfunction PMREMGenerator(renderer){_classCallCheck(this,PMREMGenerator);\n\nthis._renderer=renderer;\nthis._pingPongRenderTarget=null;\n\nthis._lodMax=0;\nthis._cubeSize=0;\nthis._lodPlanes=[];\nthis._sizeLods=[];\nthis._sigmas=[];\n\nthis._blurMaterial=null;\nthis._cubemapMaterial=null;\nthis._equirectMaterial=null;\n\nthis._compileMaterial(this._blurMaterial);\n\n}\n\n/**\n\t * Generates a PMREM from a supplied Scene, which can be faster than using an\n\t * image if networking bandwidth is low. Optional sigma specifies a blur radius\n\t * in radians to be applied to the scene before PMREM generation. Optional near\n\t * and far planes ensure the scene is rendered in its entirety (the cubeCamera\n\t * is placed at the origin).\n\t */_createClass(PMREMGenerator,[{key:'fromScene',value:function fromScene(\nscene){var sigma=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var near=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0.1;var far=arguments.length>3&&arguments[3]!==undefined?arguments[3]:100;\n\n_oldTarget=this._renderer.getRenderTarget();\n\nthis._setSize(256);\n\nvar cubeUVRenderTarget=this._allocateTargets();\ncubeUVRenderTarget.depthBuffer=true;\n\nthis._sceneToCubeUV(scene,near,far,cubeUVRenderTarget);\n\nif(sigma>0){\n\nthis._blur(cubeUVRenderTarget,0,0,sigma);\n\n}\n\nthis._applyPMREM(cubeUVRenderTarget);\nthis._cleanup(cubeUVRenderTarget);\n\nreturn cubeUVRenderTarget;\n\n}\n\n/**\n\t * Generates a PMREM from an equirectangular texture, which can be either LDR\n\t * or HDR. The ideal input image size is 1k (1024 x 512),\n\t * as this matches best with the 256 x 256 cubemap output.\n\t */},{key:'fromEquirectangular',value:function fromEquirectangular(\nequirectangular){var renderTarget=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;\n\nreturn this._fromTexture(equirectangular,renderTarget);\n\n}\n\n/**\n\t * Generates a PMREM from an cubemap texture, which can be either LDR\n\t * or HDR. The ideal input cube size is 256 x 256,\n\t * as this matches best with the 256 x 256 cubemap output.\n\t */},{key:'fromCubemap',value:function fromCubemap(\ncubemap){var renderTarget=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;\n\nreturn this._fromTexture(cubemap,renderTarget);\n\n}\n\n/**\n\t * Pre-compiles the cubemap shader. You can get faster start-up by invoking this method during\n\t * your texture's network fetch for increased concurrency.\n\t */},{key:'compileCubemapShader',value:function compileCubemapShader()\n{\n\nif(this._cubemapMaterial===null){\n\nthis._cubemapMaterial=_getCubemapMaterial();\nthis._compileMaterial(this._cubemapMaterial);\n\n}\n\n}\n\n/**\n\t * Pre-compiles the equirectangular shader. You can get faster start-up by invoking this method during\n\t * your texture's network fetch for increased concurrency.\n\t */},{key:'compileEquirectangularShader',value:function compileEquirectangularShader()\n{\n\nif(this._equirectMaterial===null){\n\nthis._equirectMaterial=_getEquirectMaterial();\nthis._compileMaterial(this._equirectMaterial);\n\n}\n\n}\n\n/**\n\t * Disposes of the PMREMGenerator's internal memory. Note that PMREMGenerator is a static class,\n\t * so you should not need more than one PMREMGenerator object. If you do, calling dispose() on\n\t * one of them will cause any others to also become unusable.\n\t */},{key:'dispose',value:function dispose()\n{\n\nthis._dispose();\n\nif(this._cubemapMaterial!==null)this._cubemapMaterial.dispose();\nif(this._equirectMaterial!==null)this._equirectMaterial.dispose();\n\n}\n\n// private interface\n},{key:'_setSize',value:function _setSize(\ncubeSize){\n\nthis._lodMax=Math.floor(Math.log2(cubeSize));\nthis._cubeSize=Math.pow(2,this._lodMax);\n\n}},{key:'_dispose',value:function _dispose()\n\n{\n\nif(this._blurMaterial!==null)this._blurMaterial.dispose();\n\nif(this._pingPongRenderTarget!==null)this._pingPongRenderTarget.dispose();\n\nfor(var i=0;i<this._lodPlanes.length;i++){\n\nthis._lodPlanes[i].dispose();\n\n}\n\n}},{key:'_cleanup',value:function _cleanup(\n\noutputTarget){\n\nthis._renderer.setRenderTarget(_oldTarget);\noutputTarget.scissorTest=false;\n_setViewport(outputTarget,0,0,outputTarget.width,outputTarget.height);\n\n}},{key:'_fromTexture',value:function _fromTexture(\n\ntexture,renderTarget){\n\nif(texture.mapping===CubeReflectionMapping||texture.mapping===CubeRefractionMapping){\n\nthis._setSize(texture.image.length===0?16:texture.image[0].width||texture.image[0].image.width);\n\n}else{// Equirectangular\n\nthis._setSize(texture.image.width/4);\n\n}\n\n_oldTarget=this._renderer.getRenderTarget();\n\nvar cubeUVRenderTarget=renderTarget||this._allocateTargets();\nthis._textureToCubeUV(texture,cubeUVRenderTarget);\nthis._applyPMREM(cubeUVRenderTarget);\nthis._cleanup(cubeUVRenderTarget);\n\nreturn cubeUVRenderTarget;\n\n}},{key:'_allocateTargets',value:function _allocateTargets()\n\n{\n\nvar width=3*Math.max(this._cubeSize,16*7);\nvar height=4*this._cubeSize;\n\nvar params={\nmagFilter:LinearFilter,\nminFilter:LinearFilter,\ngenerateMipmaps:false,\ntype:HalfFloatType,\nformat:RGBAFormat,\nencoding:LinearEncoding,\ndepthBuffer:false};\n\n\nvar cubeUVRenderTarget=_createRenderTarget(width,height,params);\n\nif(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==width){\n\nif(this._pingPongRenderTarget!==null){\n\nthis._dispose();\n\n}\n\nthis._pingPongRenderTarget=_createRenderTarget(width,height,params);var\n\n_lodMax=this._lodMax;var _createPlanes2=\n_createPlanes(_lodMax);this._sizeLods=_createPlanes2.sizeLods;this._lodPlanes=_createPlanes2.lodPlanes;this._sigmas=_createPlanes2.sigmas;\n\nthis._blurMaterial=_getBlurShader(_lodMax,width,height);\n\n}\n\nreturn cubeUVRenderTarget;\n\n}},{key:'_compileMaterial',value:function _compileMaterial(\n\nmaterial){\n\nvar tmpMesh=new Mesh(this._lodPlanes[0],material);\nthis._renderer.compile(tmpMesh,_flatCamera);\n\n}},{key:'_sceneToCubeUV',value:function _sceneToCubeUV(\n\nscene,near,far,cubeUVRenderTarget){\n\nvar fov=90;\nvar aspect=1;\nvar cubeCamera=new PerspectiveCamera(fov,aspect,near,far);\nvar upSign=[1,-1,1,1,1,1];\nvar forwardSign=[1,1,1,-1,-1,-1];\nvar renderer=this._renderer;\n\nvar originalAutoClear=renderer.autoClear;\nvar toneMapping=renderer.toneMapping;\nrenderer.getClearColor(_clearColor);\n\nrenderer.toneMapping=NoToneMapping;\nrenderer.autoClear=false;\n\nvar backgroundMaterial=new MeshBasicMaterial({\nname:'PMREM.Background',\nside:BackSide,\ndepthWrite:false,\ndepthTest:false});\n\n\nvar backgroundBox=new Mesh(new BoxGeometry(),backgroundMaterial);\n\nvar useSolidColor=false;\nvar background=scene.background;\n\nif(background){\n\nif(background.isColor){\n\nbackgroundMaterial.color.copy(background);\nscene.background=null;\nuseSolidColor=true;\n\n}\n\n}else{\n\nbackgroundMaterial.color.copy(_clearColor);\nuseSolidColor=true;\n\n}\n\nfor(var i=0;i<6;i++){\n\nvar col=i%3;\n\nif(col===0){\n\ncubeCamera.up.set(0,upSign[i],0);\ncubeCamera.lookAt(forwardSign[i],0,0);\n\n}else if(col===1){\n\ncubeCamera.up.set(0,0,upSign[i]);\ncubeCamera.lookAt(0,forwardSign[i],0);\n\n}else{\n\ncubeCamera.up.set(0,upSign[i],0);\ncubeCamera.lookAt(0,0,forwardSign[i]);\n\n}\n\nvar size=this._cubeSize;\n\n_setViewport(cubeUVRenderTarget,col*size,i>2?size:0,size,size);\n\nrenderer.setRenderTarget(cubeUVRenderTarget);\n\nif(useSolidColor){\n\nrenderer.render(backgroundBox,cubeCamera);\n\n}\n\nrenderer.render(scene,cubeCamera);\n\n}\n\nbackgroundBox.geometry.dispose();\nbackgroundBox.material.dispose();\n\nrenderer.toneMapping=toneMapping;\nrenderer.autoClear=originalAutoClear;\nscene.background=background;\n\n}},{key:'_textureToCubeUV',value:function _textureToCubeUV(\n\ntexture,cubeUVRenderTarget){\n\nvar renderer=this._renderer;\n\nvar isCubeTexture=texture.mapping===CubeReflectionMapping||texture.mapping===CubeRefractionMapping;\n\nif(isCubeTexture){\n\nif(this._cubemapMaterial===null){\n\nthis._cubemapMaterial=_getCubemapMaterial();\n\n}\n\nthis._cubemapMaterial.uniforms.flipEnvMap.value=texture.isRenderTargetTexture===false?-1:1;\n\n}else{\n\nif(this._equirectMaterial===null){\n\nthis._equirectMaterial=_getEquirectMaterial();\n\n}\n\n}\n\nvar material=isCubeTexture?this._cubemapMaterial:this._equirectMaterial;\nvar mesh=new Mesh(this._lodPlanes[0],material);\n\nvar uniforms=material.uniforms;\n\nuniforms['envMap'].value=texture;\n\nvar size=this._cubeSize;\n\n_setViewport(cubeUVRenderTarget,0,0,3*size,2*size);\n\nrenderer.setRenderTarget(cubeUVRenderTarget);\nrenderer.render(mesh,_flatCamera);\n\n}},{key:'_applyPMREM',value:function _applyPMREM(\n\ncubeUVRenderTarget){\n\nvar renderer=this._renderer;\nvar autoClear=renderer.autoClear;\nrenderer.autoClear=false;\n\nfor(var i=1;i<this._lodPlanes.length;i++){\n\nvar sigma=Math.sqrt(this._sigmas[i]*this._sigmas[i]-this._sigmas[i-1]*this._sigmas[i-1]);\n\nvar poleAxis=_axisDirections[(i-1)%_axisDirections.length];\n\nthis._blur(cubeUVRenderTarget,i-1,i,sigma,poleAxis);\n\n}\n\nrenderer.autoClear=autoClear;\n\n}\n\n/**\n\t * This is a two-pass Gaussian blur for a cubemap. Normally this is done\n\t * vertically and horizontally, but this breaks down on a cube. Here we apply\n\t * the blur latitudinally (around the poles), and then longitudinally (towards\n\t * the poles) to approximate the orthogonally-separable blur. It is least\n\t * accurate at the poles, but still does a decent job.\n\t */},{key:'_blur',value:function _blur(\ncubeUVRenderTarget,lodIn,lodOut,sigma,poleAxis){\n\nvar pingPongRenderTarget=this._pingPongRenderTarget;\n\nthis._halfBlur(\ncubeUVRenderTarget,\npingPongRenderTarget,\nlodIn,\nlodOut,\nsigma,\n'latitudinal',\npoleAxis);\n\nthis._halfBlur(\npingPongRenderTarget,\ncubeUVRenderTarget,\nlodOut,\nlodOut,\nsigma,\n'longitudinal',\npoleAxis);\n\n}},{key:'_halfBlur',value:function _halfBlur(\n\ntargetIn,targetOut,lodIn,lodOut,sigmaRadians,direction,poleAxis){\n\nvar renderer=this._renderer;\nvar blurMaterial=this._blurMaterial;\n\nif(direction!=='latitudinal'&&direction!=='longitudinal'){\n\nconsole.error(\n'blur direction must be either latitudinal or longitudinal!');\n\n}\n\n// Number of standard deviations at which to cut off the discrete approximation.\nvar STANDARD_DEVIATIONS=3;\n\nvar blurMesh=new Mesh(this._lodPlanes[lodOut],blurMaterial);\nvar blurUniforms=blurMaterial.uniforms;\n\nvar pixels=this._sizeLods[lodIn]-1;\nvar radiansPerPixel=isFinite(sigmaRadians)?Math.PI/(2*pixels):2*Math.PI/(2*MAX_SAMPLES-1);\nvar sigmaPixels=sigmaRadians/radiansPerPixel;\nvar samples=isFinite(sigmaRadians)?1+Math.floor(STANDARD_DEVIATIONS*sigmaPixels):MAX_SAMPLES;\n\nif(samples>MAX_SAMPLES){\n\nconsole.warn('sigmaRadians, '+\nsigmaRadians+', is too large and will clip, as it requested '+\nsamples+' samples when the maximum is set to '+MAX_SAMPLES);\n\n}\n\nvar weights=[];\nvar sum=0;\n\nfor(var i=0;i<MAX_SAMPLES;++i){\n\nvar _x131=i/sigmaPixels;\nvar weight=Math.exp(-_x131*_x131/2);\nweights.push(weight);\n\nif(i===0){\n\nsum+=weight;\n\n}else if(i<samples){\n\nsum+=2*weight;\n\n}\n\n}\n\nfor(var _i23=0;_i23<weights.length;_i23++){\n\nweights[_i23]=weights[_i23]/sum;\n\n}\n\nblurUniforms['envMap'].value=targetIn.texture;\nblurUniforms['samples'].value=samples;\nblurUniforms['weights'].value=weights;\nblurUniforms['latitudinal'].value=direction==='latitudinal';\n\nif(poleAxis){\n\nblurUniforms['poleAxis'].value=poleAxis;\n\n}var\n\n_lodMax=this._lodMax;\nblurUniforms['dTheta'].value=radiansPerPixel;\nblurUniforms['mipInt'].value=_lodMax-lodIn;\n\nvar outputSize=this._sizeLods[lodOut];\nvar x=3*outputSize*(lodOut>_lodMax-LOD_MIN?lodOut-_lodMax+LOD_MIN:0);\nvar y=4*(this._cubeSize-outputSize);\n\n_setViewport(targetOut,x,y,3*outputSize,2*outputSize);\nrenderer.setRenderTarget(targetOut);\nrenderer.render(blurMesh,_flatCamera);\n\n}}]);return PMREMGenerator;}();\n\n\n\n\n\nfunction _createPlanes(lodMax){\n\nvar lodPlanes=[];\nvar sizeLods=[];\nvar sigmas=[];\n\nvar lod=lodMax;\n\nvar totalLods=lodMax-LOD_MIN+1+EXTRA_LOD_SIGMA.length;\n\nfor(var i=0;i<totalLods;i++){\n\nvar sizeLod=Math.pow(2,lod);\nsizeLods.push(sizeLod);\nvar sigma=1.0/sizeLod;\n\nif(i>lodMax-LOD_MIN){\n\nsigma=EXTRA_LOD_SIGMA[i-lodMax+LOD_MIN-1];\n\n}else if(i===0){\n\nsigma=0;\n\n}\n\nsigmas.push(sigma);\n\nvar texelSize=1.0/(sizeLod-2);\nvar min=-texelSize;\nvar max=1+texelSize;\nvar uv1=[min,min,max,min,max,max,min,min,max,max,min,max];\n\nvar cubeFaces=6;\nvar _vertices=6;\nvar positionSize=3;\nvar uvSize=2;\nvar faceIndexSize=1;\n\nvar position=new Float32Array(positionSize*_vertices*cubeFaces);\nvar uv=new Float32Array(uvSize*_vertices*cubeFaces);\nvar faceIndex=new Float32Array(faceIndexSize*_vertices*cubeFaces);\n\nfor(var face=0;face<cubeFaces;face++){\n\nvar x=face%3*2/3-1;\nvar y=face>2?0:-1;\nvar coordinates=[\nx,y,0,\nx+2/3,y,0,\nx+2/3,y+1,0,\nx,y,0,\nx+2/3,y+1,0,\nx,y+1,0];\n\nposition.set(coordinates,positionSize*_vertices*face);\nuv.set(uv1,uvSize*_vertices*face);\nvar fill=[face,face,face,face,face,face];\nfaceIndex.set(fill,faceIndexSize*_vertices*face);\n\n}\n\nvar planes=new BufferGeometry();\nplanes.setAttribute('position',new BufferAttribute(position,positionSize));\nplanes.setAttribute('uv',new BufferAttribute(uv,uvSize));\nplanes.setAttribute('faceIndex',new BufferAttribute(faceIndex,faceIndexSize));\nlodPlanes.push(planes);\n\nif(lod>LOD_MIN){\n\nlod--;\n\n}\n\n}\n\nreturn{lodPlanes:lodPlanes,sizeLods:sizeLods,sigmas:sigmas};\n\n}\n\nfunction _createRenderTarget(width,height,params){\n\nvar cubeUVRenderTarget=new WebGLRenderTarget(width,height,params);\ncubeUVRenderTarget.texture.mapping=CubeUVReflectionMapping;\ncubeUVRenderTarget.texture.name='PMREM.cubeUv';\ncubeUVRenderTarget.scissorTest=true;\nreturn cubeUVRenderTarget;\n\n}\n\nfunction _setViewport(target,x,y,width,height){\n\ntarget.viewport.set(x,y,width,height);\ntarget.scissor.set(x,y,width,height);\n\n}\n\nfunction _getBlurShader(lodMax,width,height){\n\nvar weights=new Float32Array(MAX_SAMPLES);\nvar poleAxis=new Vector3(0,1,0);\nvar shaderMaterial=new ShaderMaterial({\n\nname:'SphericalGaussianBlur',\n\ndefines:{\n'n':MAX_SAMPLES,\n'CUBEUV_TEXEL_WIDTH':1.0/width,\n'CUBEUV_TEXEL_HEIGHT':1.0/height,\n'CUBEUV_MAX_MIP':lodMax+'.0'},\n\n\nuniforms:{\n'envMap':{value:null},\n'samples':{value:1},\n'weights':{value:weights},\n'latitudinal':{value:false},\n'dTheta':{value:0},\n'mipInt':{value:0},\n'poleAxis':{value:poleAxis}},\n\n\nvertexShader:_getCommonVertexShader(),\n\nfragmentShader:/* glsl */'\\n\\n\\t\\t\\tprecision mediump float;\\n\\t\\t\\tprecision mediump int;\\n\\n\\t\\t\\tvarying vec3 vOutputDirection;\\n\\n\\t\\t\\tuniform sampler2D envMap;\\n\\t\\t\\tuniform int samples;\\n\\t\\t\\tuniform float weights[ n ];\\n\\t\\t\\tuniform bool latitudinal;\\n\\t\\t\\tuniform float dTheta;\\n\\t\\t\\tuniform float mipInt;\\n\\t\\t\\tuniform vec3 poleAxis;\\n\\n\\t\\t\\t#define ENVMAP_TYPE_CUBE_UV\\n\\t\\t\\t#include <cube_uv_reflection_fragment>\\n\\n\\t\\t\\tvec3 getSample( float theta, vec3 axis ) {\\n\\n\\t\\t\\t\\tfloat cosTheta = cos( theta );\\n\\t\\t\\t\\t// Rodrigues\\' axis-angle rotation\\n\\t\\t\\t\\tvec3 sampleDirection = vOutputDirection * cosTheta\\n\\t\\t\\t\\t\\t+ cross( axis, vOutputDirection ) * sin( theta )\\n\\t\\t\\t\\t\\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\\n\\n\\t\\t\\t\\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\\n\\n\\t\\t\\t}\\n\\n\\t\\t\\tvoid main() {\\n\\n\\t\\t\\t\\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\\n\\n\\t\\t\\t\\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\\n\\n\\t\\t\\t\\t\\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\\n\\n\\t\\t\\t\\t}\\n\\n\\t\\t\\t\\taxis = normalize( axis );\\n\\n\\t\\t\\t\\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\\n\\t\\t\\t\\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\\n\\n\\t\\t\\t\\tfor ( int i = 1; i < n; i++ ) {\\n\\n\\t\\t\\t\\t\\tif ( i >= samples ) {\\n\\n\\t\\t\\t\\t\\t\\tbreak;\\n\\n\\t\\t\\t\\t\\t}\\n\\n\\t\\t\\t\\t\\tfloat theta = dTheta * float( i );\\n\\t\\t\\t\\t\\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\\n\\t\\t\\t\\t\\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\\n\\n\\t\\t\\t\\t}\\n\\n\\t\\t\\t}\\n\\t\\t',\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nblending:NoBlending,\ndepthTest:false,\ndepthWrite:false});\n\n\n\nreturn shaderMaterial;\n\n}\n\nfunction _getEquirectMaterial(){\n\nreturn new ShaderMaterial({\n\nname:'EquirectangularToCubeUV',\n\nuniforms:{\n'envMap':{value:null}},\n\n\nvertexShader:_getCommonVertexShader(),\n\nfragmentShader:/* glsl */'\\n\\n\\t\\t\\tprecision mediump float;\\n\\t\\t\\tprecision mediump int;\\n\\n\\t\\t\\tvarying vec3 vOutputDirection;\\n\\n\\t\\t\\tuniform sampler2D envMap;\\n\\n\\t\\t\\t#include <common>\\n\\n\\t\\t\\tvoid main() {\\n\\n\\t\\t\\t\\tvec3 outputDirection = normalize( vOutputDirection );\\n\\t\\t\\t\\tvec2 uv = equirectUv( outputDirection );\\n\\n\\t\\t\\t\\tgl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );\\n\\n\\t\\t\\t}\\n\\t\\t',\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nblending:NoBlending,\ndepthTest:false,\ndepthWrite:false});\n\n\n\n}\n\nfunction _getCubemapMaterial(){\n\nreturn new ShaderMaterial({\n\nname:'CubemapToCubeUV',\n\nuniforms:{\n'envMap':{value:null},\n'flipEnvMap':{value:-1}},\n\n\nvertexShader:_getCommonVertexShader(),\n\nfragmentShader:/* glsl */'\\n\\n\\t\\t\\tprecision mediump float;\\n\\t\\t\\tprecision mediump int;\\n\\n\\t\\t\\tuniform float flipEnvMap;\\n\\n\\t\\t\\tvarying vec3 vOutputDirection;\\n\\n\\t\\t\\tuniform samplerCube envMap;\\n\\n\\t\\t\\tvoid main() {\\n\\n\\t\\t\\t\\tgl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );\\n\\n\\t\\t\\t}\\n\\t\\t',\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nblending:NoBlending,\ndepthTest:false,\ndepthWrite:false});\n\n\n\n}\n\nfunction _getCommonVertexShader(){\n\nreturn(/* glsl */'\\n\\n\\t\\tprecision mediump float;\\n\\t\\tprecision mediump int;\\n\\n\\t\\tattribute float faceIndex;\\n\\n\\t\\tvarying vec3 vOutputDirection;\\n\\n\\t\\t// RH coordinate system; PMREM face-indexing convention\\n\\t\\tvec3 getDirection( vec2 uv, float face ) {\\n\\n\\t\\t\\tuv = 2.0 * uv - 1.0;\\n\\n\\t\\t\\tvec3 direction = vec3( uv, 1.0 );\\n\\n\\t\\t\\tif ( face == 0.0 ) {\\n\\n\\t\\t\\t\\tdirection = direction.zyx; // ( 1, v, u ) pos x\\n\\n\\t\\t\\t} else if ( face == 1.0 ) {\\n\\n\\t\\t\\t\\tdirection = direction.xzy;\\n\\t\\t\\t\\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\\n\\n\\t\\t\\t} else if ( face == 2.0 ) {\\n\\n\\t\\t\\t\\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\\n\\n\\t\\t\\t} else if ( face == 3.0 ) {\\n\\n\\t\\t\\t\\tdirection = direction.zyx;\\n\\t\\t\\t\\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\\n\\n\\t\\t\\t} else if ( face == 4.0 ) {\\n\\n\\t\\t\\t\\tdirection = direction.xzy;\\n\\t\\t\\t\\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\\n\\n\\t\\t\\t} else if ( face == 5.0 ) {\\n\\n\\t\\t\\t\\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\\n\\n\\t\\t\\t}\\n\\n\\t\\t\\treturn direction;\\n\\n\\t\\t}\\n\\n\\t\\tvoid main() {\\n\\n\\t\\t\\tvOutputDirection = getDirection( uv, faceIndex );\\n\\t\\t\\tgl_Position = vec4( position, 1.0 );\\n\\n\\t\\t}\\n\\t');\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n}\n\nfunction WebGLCubeUVMaps(renderer){\n\nvar cubeUVmaps=new WeakMap();\n\nvar pmremGenerator=null;\n\nfunction get(texture){\n\nif(texture&&texture.isTexture){\n\nvar mapping=texture.mapping;\n\nvar isEquirectMap=mapping===EquirectangularReflectionMapping||mapping===EquirectangularRefractionMapping;\nvar isCubeMap=mapping===CubeReflectionMapping||mapping===CubeRefractionMapping;\n\n// equirect/cube map to cubeUV conversion\n\nif(isEquirectMap||isCubeMap){\n\nif(texture.isRenderTargetTexture&&texture.needsPMREMUpdate===true){\n\ntexture.needsPMREMUpdate=false;\n\nvar renderTarget=cubeUVmaps.get(texture);\n\nif(pmremGenerator===null)pmremGenerator=new PMREMGenerator(renderer);\n\nrenderTarget=isEquirectMap?pmremGenerator.fromEquirectangular(texture,renderTarget):pmremGenerator.fromCubemap(texture,renderTarget);\ncubeUVmaps.set(texture,renderTarget);\n\nreturn renderTarget.texture;\n\n}else{\n\nif(cubeUVmaps.has(texture)){\n\nreturn cubeUVmaps.get(texture).texture;\n\n}else{\n\nvar image=texture.image;\n\nif(isEquirectMap&&image&&image.height>0||isCubeMap&&image&&isCubeTextureComplete(image)){\n\nif(pmremGenerator===null)pmremGenerator=new PMREMGenerator(renderer);\n\nvar _renderTarget=isEquirectMap?pmremGenerator.fromEquirectangular(texture):pmremGenerator.fromCubemap(texture);\ncubeUVmaps.set(texture,_renderTarget);\n\ntexture.addEventListener('dispose',onTextureDispose);\n\nreturn _renderTarget.texture;\n\n}else{\n\n// image not yet ready. try the conversion next frame\n\nreturn null;\n\n}\n\n}\n\n}\n\n}\n\n}\n\nreturn texture;\n\n}\n\nfunction isCubeTextureComplete(image){\n\nvar count=0;\nvar length=6;\n\nfor(var i=0;i<length;i++){\n\nif(image[i]!==undefined)count++;\n\n}\n\nreturn count===length;\n\n\n}\n\nfunction onTextureDispose(event){\n\nvar texture=event.target;\n\ntexture.removeEventListener('dispose',onTextureDispose);\n\nvar cubemapUV=cubeUVmaps.get(texture);\n\nif(cubemapUV!==undefined){\n\ncubeUVmaps.delete(texture);\ncubemapUV.dispose();\n\n}\n\n}\n\nfunction dispose(){\n\ncubeUVmaps=new WeakMap();\n\nif(pmremGenerator!==null){\n\npmremGenerator.dispose();\npmremGenerator=null;\n\n}\n\n}\n\nreturn{\nget:get,\ndispose:dispose};\n\n\n}\n\nfunction WebGLExtensions(gl){\n\nvar extensions={};\n\nfunction getExtension(name){\n\nif(extensions[name]!==undefined){\n\nreturn extensions[name];\n\n}\n\nvar extension=void 0;\n\nswitch(name){\n\ncase'WEBGL_depth_texture':\nextension=gl.getExtension('WEBGL_depth_texture')||gl.getExtension('MOZ_WEBGL_depth_texture')||gl.getExtension('WEBKIT_WEBGL_depth_texture');\nbreak;\n\ncase'EXT_texture_filter_anisotropic':\nextension=gl.getExtension('EXT_texture_filter_anisotropic')||gl.getExtension('MOZ_EXT_texture_filter_anisotropic')||gl.getExtension('WEBKIT_EXT_texture_filter_anisotropic');\nbreak;\n\ncase'WEBGL_compressed_texture_s3tc':\nextension=gl.getExtension('WEBGL_compressed_texture_s3tc')||gl.getExtension('MOZ_WEBGL_compressed_texture_s3tc')||gl.getExtension('WEBKIT_WEBGL_compressed_texture_s3tc');\nbreak;\n\ncase'WEBGL_compressed_texture_pvrtc':\nextension=gl.getExtension('WEBGL_compressed_texture_pvrtc')||gl.getExtension('WEBKIT_WEBGL_compressed_texture_pvrtc');\nbreak;\n\ndefault:\nextension=gl.getExtension(name);}\n\n\n\nextensions[name]=extension;\n\nreturn extension;\n\n}\n\nreturn{\n\nhas:function has(name){\n\nreturn getExtension(name)!==null;\n\n},\n\ninit:function init(capabilities){\n\nif(capabilities.isWebGL2){\n\ngetExtension('EXT_color_buffer_float');\n\n}else{\n\ngetExtension('WEBGL_depth_texture');\ngetExtension('OES_texture_float');\ngetExtension('OES_texture_half_float');\ngetExtension('OES_texture_half_float_linear');\ngetExtension('OES_standard_derivatives');\ngetExtension('OES_element_index_uint');\ngetExtension('OES_vertex_array_object');\ngetExtension('ANGLE_instanced_arrays');\n\n}\n\ngetExtension('OES_texture_float_linear');\ngetExtension('EXT_color_buffer_half_float');\ngetExtension('WEBGL_multisampled_render_to_texture');\n\n},\n\nget:function get(name){\n\nvar extension=getExtension(name);\n\nif(extension===null){\n\nconsole.warn('THREE.WebGLRenderer: '+name+' extension not supported.');\n\n}\n\nreturn extension;\n\n}};\n\n\n\n}\n\nfunction WebGLGeometries(gl,attributes,info,bindingStates){\n\nvar geometries={};\nvar wireframeAttributes=new WeakMap();\n\nfunction onGeometryDispose(event){\n\nvar geometry=event.target;\n\nif(geometry.index!==null){\n\nattributes.remove(geometry.index);\n\n}\n\nfor(var name in geometry.attributes){\n\nattributes.remove(geometry.attributes[name]);\n\n}\n\ngeometry.removeEventListener('dispose',onGeometryDispose);\n\ndelete geometries[geometry.id];\n\nvar attribute=wireframeAttributes.get(geometry);\n\nif(attribute){\n\nattributes.remove(attribute);\nwireframeAttributes.delete(geometry);\n\n}\n\nbindingStates.releaseStatesOfGeometry(geometry);\n\nif(geometry.isInstancedBufferGeometry===true){\n\ndelete geometry._maxInstanceCount;\n\n}\n\n//\n\ninfo.memory.geometries--;\n\n}\n\nfunction get(object,geometry){\n\nif(geometries[geometry.id]===true)return geometry;\n\ngeometry.addEventListener('dispose',onGeometryDispose);\n\ngeometries[geometry.id]=true;\n\ninfo.memory.geometries++;\n\nreturn geometry;\n\n}\n\nfunction update(geometry){\n\nvar geometryAttributes=geometry.attributes;\n\n// Updating index buffer in VAO now. See WebGLBindingStates.\n\nfor(var name in geometryAttributes){\n\nattributes.update(geometryAttributes[name],34962);\n\n}\n\n// morph targets\n\nvar morphAttributes=geometry.morphAttributes;\n\nfor(var _name3 in morphAttributes){\n\nvar array=morphAttributes[_name3];\n\nfor(var i=0,l=array.length;i<l;i++){\n\nattributes.update(array[i],34962);\n\n}\n\n}\n\n}\n\nfunction updateWireframeAttribute(geometry){\n\nvar indices=[];\n\nvar geometryIndex=geometry.index;\nvar geometryPosition=geometry.attributes.position;\nvar version=0;\n\nif(geometryIndex!==null){\n\nvar array=geometryIndex.array;\nversion=geometryIndex.version;\n\nfor(var i=0,l=array.length;i<l;i+=3){\n\nvar a=array[i+0];\nvar b=array[i+1];\nvar c=array[i+2];\n\nindices.push(a,b,b,c,c,a);\n\n}\n\n}else{\n\nvar _array=geometryPosition.array;\nversion=geometryPosition.version;\n\nfor(var _i24=0,_l5=_array.length/3-1;_i24<_l5;_i24+=3){\n\nvar _a4=_i24+0;\nvar _b4=_i24+1;\nvar _c4=_i24+2;\n\nindices.push(_a4,_b4,_b4,_c4,_c4,_a4);\n\n}\n\n}\n\nvar attribute=new(arrayNeedsUint32(indices)?Uint32BufferAttribute:Uint16BufferAttribute)(indices,1);\nattribute.version=version;\n\n// Updating index buffer in VAO now. See WebGLBindingStates\n\n//\n\nvar previousAttribute=wireframeAttributes.get(geometry);\n\nif(previousAttribute)attributes.remove(previousAttribute);\n\n//\n\nwireframeAttributes.set(geometry,attribute);\n\n}\n\nfunction getWireframeAttribute(geometry){\n\nvar currentAttribute=wireframeAttributes.get(geometry);\n\nif(currentAttribute){\n\nvar geometryIndex=geometry.index;\n\nif(geometryIndex!==null){\n\n// if the attribute is obsolete, create a new one\n\nif(currentAttribute.version<geometryIndex.version){\n\nupdateWireframeAttribute(geometry);\n\n}\n\n}\n\n}else{\n\nupdateWireframeAttribute(geometry);\n\n}\n\nreturn wireframeAttributes.get(geometry);\n\n}\n\nreturn{\n\nget:get,\nupdate:update,\n\ngetWireframeAttribute:getWireframeAttribute};\n\n\n\n}\n\nfunction WebGLIndexedBufferRenderer(gl,extensions,info,capabilities){\n\nvar isWebGL2=capabilities.isWebGL2;\n\nvar mode=void 0;\n\nfunction setMode(value){\n\nmode=value;\n\n}\n\nvar type=void 0,bytesPerElement=void 0;\n\nfunction setIndex(value){\n\ntype=value.type;\nbytesPerElement=value.bytesPerElement;\n\n}\n\nfunction render(start,count){\n\ngl.drawElements(mode,count,type,start*bytesPerElement);\n\ninfo.update(count,mode,1);\n\n}\n\nfunction renderInstances(start,count,primcount){\n\nif(primcount===0)return;\n\nvar extension=void 0,methodName=void 0;\n\nif(isWebGL2){\n\nextension=gl;\nmethodName='drawElementsInstanced';\n\n}else{\n\nextension=extensions.get('ANGLE_instanced_arrays');\nmethodName='drawElementsInstancedANGLE';\n\nif(extension===null){\n\nconsole.error('THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.');\nreturn;\n\n}\n\n}\n\nextension[methodName](mode,count,type,start*bytesPerElement,primcount);\n\ninfo.update(count,mode,primcount);\n\n}\n\n//\n\nthis.setMode=setMode;\nthis.setIndex=setIndex;\nthis.render=render;\nthis.renderInstances=renderInstances;\n\n}\n\nfunction WebGLInfo(gl){\n\nvar memory={\ngeometries:0,\ntextures:0};\n\n\nvar render={\nframe:0,\ncalls:0,\ntriangles:0,\npoints:0,\nlines:0};\n\n\nfunction update(count,mode,instanceCount){\n\nrender.calls++;\n\nswitch(mode){\n\ncase 4:\nrender.triangles+=instanceCount*(count/3);\nbreak;\n\ncase 1:\nrender.lines+=instanceCount*(count/2);\nbreak;\n\ncase 3:\nrender.lines+=instanceCount*(count-1);\nbreak;\n\ncase 2:\nrender.lines+=instanceCount*count;\nbreak;\n\ncase 0:\nrender.points+=instanceCount*count;\nbreak;\n\ndefault:\nconsole.error('THREE.WebGLInfo: Unknown draw mode:',mode);\nbreak;}\n\n\n\n}\n\nfunction reset(){\n\nrender.frame++;\nrender.calls=0;\nrender.triangles=0;\nrender.points=0;\nrender.lines=0;\n\n}\n\nreturn{\nmemory:memory,\nrender:render,\nprograms:null,\nautoReset:true,\nreset:reset,\nupdate:update};\n\n\n}\n\nfunction numericalSort(a,b){\n\nreturn a[0]-b[0];\n\n}\n\nfunction absNumericalSort(a,b){\n\nreturn Math.abs(b[1])-Math.abs(a[1]);\n\n}\n\nfunction denormalize(morph,attribute){\n\nvar denominator=1;\nvar array=attribute.isInterleavedBufferAttribute?attribute.data.array:attribute.array;\n\nif(array instanceof Int8Array)denominator=127;else\nif(array instanceof Uint8Array)denominator=255;else\nif(array instanceof Uint16Array)denominator=65535;else\nif(array instanceof Int16Array)denominator=32767;else\nif(array instanceof Int32Array)denominator=2147483647;else\nconsole.error('THREE.WebGLMorphtargets: Unsupported morph attribute data type: ',array);\n\nmorph.divideScalar(denominator);\n\n}\n\nfunction WebGLMorphtargets(gl,capabilities,textures){\n\nvar influencesList={};\nvar morphInfluences=new Float32Array(8);\nvar morphTextures=new WeakMap();\nvar morph=new Vector4();\n\nvar workInfluences=[];\n\nfor(var i=0;i<8;i++){\n\nworkInfluences[i]=[i,0];\n\n}\n\nfunction update(object,geometry,material,program){\n\nvar objectInfluences=object.morphTargetInfluences;\n\nif(capabilities.isWebGL2===true){\n\n// instead of using attributes, the WebGL 2 code path encodes morph targets\n// into an array of data textures. Each layer represents a single morph target.\n\nvar morphAttribute=geometry.morphAttributes.position||geometry.morphAttributes.normal||geometry.morphAttributes.color;\nvar morphTargetsCount=morphAttribute!==undefined?morphAttribute.length:0;\n\nvar entry=morphTextures.get(geometry);\n\nif(entry===undefined||entry.count!==morphTargetsCount){var\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\ndisposeTexture=function disposeTexture(){\n\n_texture.dispose();\n\nmorphTextures.delete(geometry);\n\ngeometry.removeEventListener('dispose',disposeTexture);\n\n};if(entry!==undefined)entry.texture.dispose();var hasMorphPosition=geometry.morphAttributes.position!==undefined;var hasMorphNormals=geometry.morphAttributes.normal!==undefined;var hasMorphColors=geometry.morphAttributes.color!==undefined;var morphTargets=geometry.morphAttributes.position||[];var morphNormals=geometry.morphAttributes.normal||[];var morphColors=geometry.morphAttributes.color||[];var vertexDataCount=0;if(hasMorphPosition===true)vertexDataCount=1;if(hasMorphNormals===true)vertexDataCount=2;if(hasMorphColors===true)vertexDataCount=3;var width=geometry.attributes.position.count*vertexDataCount;var height=1;if(width>capabilities.maxTextureSize){height=Math.ceil(width/capabilities.maxTextureSize);width=capabilities.maxTextureSize;}var buffer=new Float32Array(width*height*4*morphTargetsCount);var _texture=new DataArrayTexture(buffer,width,height,morphTargetsCount);_texture.type=FloatType;_texture.needsUpdate=true;// fill buffer\nvar vertexDataStride=vertexDataCount*4;for(var _i25=0;_i25<morphTargetsCount;_i25++){var morphTarget=morphTargets[_i25];var morphNormal=morphNormals[_i25];var morphColor=morphColors[_i25];var offset=width*height*4*_i25;for(var j=0;j<morphTarget.count;j++){var stride=j*vertexDataStride;if(hasMorphPosition===true){morph.fromBufferAttribute(morphTarget,j);if(morphTarget.normalized===true)denormalize(morph,morphTarget);buffer[offset+stride+0]=morph.x;buffer[offset+stride+1]=morph.y;buffer[offset+stride+2]=morph.z;buffer[offset+stride+3]=0;}if(hasMorphNormals===true){morph.fromBufferAttribute(morphNormal,j);if(morphNormal.normalized===true)denormalize(morph,morphNormal);buffer[offset+stride+4]=morph.x;buffer[offset+stride+5]=morph.y;buffer[offset+stride+6]=morph.z;buffer[offset+stride+7]=0;}if(hasMorphColors===true){morph.fromBufferAttribute(morphColor,j);if(morphColor.normalized===true)denormalize(morph,morphColor);buffer[offset+stride+8]=morph.x;buffer[offset+stride+9]=morph.y;buffer[offset+stride+10]=morph.z;buffer[offset+stride+11]=morphColor.itemSize===4?morph.w:1;}}}entry={count:morphTargetsCount,texture:_texture,size:new Vector2(width,height)};morphTextures.set(geometry,entry);\ngeometry.addEventListener('dispose',disposeTexture);\n\n}\n\n//\n\nvar morphInfluencesSum=0;\n\nfor(var _i26=0;_i26<objectInfluences.length;_i26++){\n\nmorphInfluencesSum+=objectInfluences[_i26];\n\n}\n\nvar morphBaseInfluence=geometry.morphTargetsRelative?1:1-morphInfluencesSum;\n\nprogram.getUniforms().setValue(gl,'morphTargetBaseInfluence',morphBaseInfluence);\nprogram.getUniforms().setValue(gl,'morphTargetInfluences',objectInfluences);\n\nprogram.getUniforms().setValue(gl,'morphTargetsTexture',entry.texture,textures);\nprogram.getUniforms().setValue(gl,'morphTargetsTextureSize',entry.size);\n\n\n}else{\n\n// When object doesn't have morph target influences defined, we treat it as a 0-length array\n// This is important to make sure we set up morphTargetBaseInfluence / morphTargetInfluences\n\nvar length=objectInfluences===undefined?0:objectInfluences.length;\n\nvar influences=influencesList[geometry.id];\n\nif(influences===undefined||influences.length!==length){\n\n// initialise list\n\ninfluences=[];\n\nfor(var _i27=0;_i27<length;_i27++){\n\ninfluences[_i27]=[_i27,0];\n\n}\n\ninfluencesList[geometry.id]=influences;\n\n}\n\n// Collect influences\n\nfor(var _i28=0;_i28<length;_i28++){\n\nvar influence=influences[_i28];\n\ninfluence[0]=_i28;\ninfluence[1]=objectInfluences[_i28];\n\n}\n\ninfluences.sort(absNumericalSort);\n\nfor(var _i29=0;_i29<8;_i29++){\n\nif(_i29<length&&influences[_i29][1]){\n\nworkInfluences[_i29][0]=influences[_i29][0];\nworkInfluences[_i29][1]=influences[_i29][1];\n\n}else{\n\nworkInfluences[_i29][0]=Number.MAX_SAFE_INTEGER;\nworkInfluences[_i29][1]=0;\n\n}\n\n}\n\nworkInfluences.sort(numericalSort);\n\nvar _morphTargets=geometry.morphAttributes.position;\nvar _morphNormals=geometry.morphAttributes.normal;\n\nvar _morphInfluencesSum=0;\n\nfor(var _i30=0;_i30<8;_i30++){\n\nvar _influence=workInfluences[_i30];\nvar index=_influence[0];\nvar _value3=_influence[1];\n\nif(index!==Number.MAX_SAFE_INTEGER&&_value3){\n\nif(_morphTargets&&geometry.getAttribute('morphTarget'+_i30)!==_morphTargets[index]){\n\ngeometry.setAttribute('morphTarget'+_i30,_morphTargets[index]);\n\n}\n\nif(_morphNormals&&geometry.getAttribute('morphNormal'+_i30)!==_morphNormals[index]){\n\ngeometry.setAttribute('morphNormal'+_i30,_morphNormals[index]);\n\n}\n\nmorphInfluences[_i30]=_value3;\n_morphInfluencesSum+=_value3;\n\n}else{\n\nif(_morphTargets&&geometry.hasAttribute('morphTarget'+_i30)===true){\n\ngeometry.deleteAttribute('morphTarget'+_i30);\n\n}\n\nif(_morphNormals&&geometry.hasAttribute('morphNormal'+_i30)===true){\n\ngeometry.deleteAttribute('morphNormal'+_i30);\n\n}\n\nmorphInfluences[_i30]=0;\n\n}\n\n}\n\n// GLSL shader uses formula baseinfluence * base + sum(target * influence)\n// This allows us to switch between absolute morphs and relative morphs without changing shader code\n// When baseinfluence = 1 - sum(influence), the above is equivalent to sum((target - base) * influence)\nvar _morphBaseInfluence=geometry.morphTargetsRelative?1:1-_morphInfluencesSum;\n\nprogram.getUniforms().setValue(gl,'morphTargetBaseInfluence',_morphBaseInfluence);\nprogram.getUniforms().setValue(gl,'morphTargetInfluences',morphInfluences);\n\n}\n\n}\n\nreturn{\n\nupdate:update};\n\n\n\n}\n\nfunction WebGLObjects(gl,geometries,attributes,info){\n\nvar updateMap=new WeakMap();\n\nfunction update(object){\n\nvar frame=info.render.frame;\n\nvar geometry=object.geometry;\nvar buffergeometry=geometries.get(object,geometry);\n\n// Update once per frame\n\nif(updateMap.get(buffergeometry)!==frame){\n\ngeometries.update(buffergeometry);\n\nupdateMap.set(buffergeometry,frame);\n\n}\n\nif(object.isInstancedMesh){\n\nif(object.hasEventListener('dispose',onInstancedMeshDispose)===false){\n\nobject.addEventListener('dispose',onInstancedMeshDispose);\n\n}\n\nattributes.update(object.instanceMatrix,34962);\n\nif(object.instanceColor!==null){\n\nattributes.update(object.instanceColor,34962);\n\n}\n\n}\n\nreturn buffergeometry;\n\n}\n\nfunction dispose(){\n\nupdateMap=new WeakMap();\n\n}\n\nfunction onInstancedMeshDispose(event){\n\nvar instancedMesh=event.target;\n\ninstancedMesh.removeEventListener('dispose',onInstancedMeshDispose);\n\nattributes.remove(instancedMesh.instanceMatrix);\n\nif(instancedMesh.instanceColor!==null)attributes.remove(instancedMesh.instanceColor);\n\n}\n\nreturn{\n\nupdate:update,\ndispose:dispose};\n\n\n\n}\n\n/**\n * Uniforms of a program.\n * Those form a tree structure with a special top-level container for the root,\n * which you get by calling 'new WebGLUniforms( gl, program )'.\n *\n *\n * Properties of inner nodes including the top-level container:\n *\n * .seq - array of nested uniforms\n * .map - nested uniforms by name\n *\n *\n * Methods of all nodes except the top-level container:\n *\n * .setValue( gl, value, [textures] )\n *\n * \t\tuploads a uniform value(s)\n *  \tthe 'textures' parameter is needed for sampler uniforms\n *\n *\n * Static methods of the top-level container (textures factorizations):\n *\n * .upload( gl, seq, values, textures )\n *\n * \t\tsets uniforms in 'seq' to 'values[id].value'\n *\n * .seqWithValue( seq, values ) : filteredSeq\n *\n * \t\tfilters 'seq' entries with corresponding entry in values\n *\n *\n * Methods of the top-level container (textures factorizations):\n *\n * .setValue( gl, name, value, textures )\n *\n * \t\tsets uniform with  name 'name' to 'value'\n *\n * .setOptional( gl, obj, prop )\n *\n * \t\tlike .set for an optional property of the object\n *\n */\n\nvar emptyTexture=/*@__PURE__*/new Texture();\nvar emptyArrayTexture=/*@__PURE__*/new DataArrayTexture();\nvar empty3dTexture=/*@__PURE__*/new Data3DTexture();\nvar emptyCubeTexture=/*@__PURE__*/new CubeTexture();\n\n// --- Utilities ---\n\n// Array Caches (provide typed arrays for temporary by size)\n\nvar arrayCacheF32=[];\nvar arrayCacheI32=[];\n\n// Float32Array caches used for uploading Matrix uniforms\n\nvar mat4array=new Float32Array(16);\nvar mat3array=new Float32Array(9);\nvar mat2array=new Float32Array(4);\n\n// Flattening for arrays of vectors and matrices\n\nfunction flatten(array,nBlocks,blockSize){\n\nvar firstElem=array[0];\n\nif(firstElem<=0||firstElem>0)return array;\n// unoptimized: ! isNaN( firstElem )\n// see http://jacksondunstan.com/articles/983\n\nvar n=nBlocks*blockSize;\nvar r=arrayCacheF32[n];\n\nif(r===undefined){\n\nr=new Float32Array(n);\narrayCacheF32[n]=r;\n\n}\n\nif(nBlocks!==0){\n\nfirstElem.toArray(r,0);\n\nfor(var i=1,offset=0;i!==nBlocks;++i){\n\noffset+=blockSize;\narray[i].toArray(r,offset);\n\n}\n\n}\n\nreturn r;\n\n}\n\nfunction arraysEqual(a,b){\n\nif(a.length!==b.length)return false;\n\nfor(var i=0,l=a.length;i<l;i++){\n\nif(a[i]!==b[i])return false;\n\n}\n\nreturn true;\n\n}\n\nfunction copyArray(a,b){\n\nfor(var i=0,l=b.length;i<l;i++){\n\na[i]=b[i];\n\n}\n\n}\n\n// Texture unit allocation\n\nfunction allocTexUnits(textures,n){\n\nvar r=arrayCacheI32[n];\n\nif(r===undefined){\n\nr=new Int32Array(n);\narrayCacheI32[n]=r;\n\n}\n\nfor(var i=0;i!==n;++i){\n\nr[i]=textures.allocateTextureUnit();\n\n}\n\nreturn r;\n\n}\n\n// --- Setters ---\n\n// Note: Defining these methods externally, because they come in a bunch\n// and this way their names minify.\n\n// Single scalar\n\nfunction setValueV1f(gl,v){\n\nvar cache=this.cache;\n\nif(cache[0]===v)return;\n\ngl.uniform1f(this.addr,v);\n\ncache[0]=v;\n\n}\n\n// Single float vector (from flat array or THREE.VectorN)\n\nfunction setValueV2f(gl,v){\n\nvar cache=this.cache;\n\nif(v.x!==undefined){\n\nif(cache[0]!==v.x||cache[1]!==v.y){\n\ngl.uniform2f(this.addr,v.x,v.y);\n\ncache[0]=v.x;\ncache[1]=v.y;\n\n}\n\n}else{\n\nif(arraysEqual(cache,v))return;\n\ngl.uniform2fv(this.addr,v);\n\ncopyArray(cache,v);\n\n}\n\n}\n\nfunction setValueV3f(gl,v){\n\nvar cache=this.cache;\n\nif(v.x!==undefined){\n\nif(cache[0]!==v.x||cache[1]!==v.y||cache[2]!==v.z){\n\ngl.uniform3f(this.addr,v.x,v.y,v.z);\n\ncache[0]=v.x;\ncache[1]=v.y;\ncache[2]=v.z;\n\n}\n\n}else if(v.r!==undefined){\n\nif(cache[0]!==v.r||cache[1]!==v.g||cache[2]!==v.b){\n\ngl.uniform3f(this.addr,v.r,v.g,v.b);\n\ncache[0]=v.r;\ncache[1]=v.g;\ncache[2]=v.b;\n\n}\n\n}else{\n\nif(arraysEqual(cache,v))return;\n\ngl.uniform3fv(this.addr,v);\n\ncopyArray(cache,v);\n\n}\n\n}\n\nfunction setValueV4f(gl,v){\n\nvar cache=this.cache;\n\nif(v.x!==undefined){\n\nif(cache[0]!==v.x||cache[1]!==v.y||cache[2]!==v.z||cache[3]!==v.w){\n\ngl.uniform4f(this.addr,v.x,v.y,v.z,v.w);\n\ncache[0]=v.x;\ncache[1]=v.y;\ncache[2]=v.z;\ncache[3]=v.w;\n\n}\n\n}else{\n\nif(arraysEqual(cache,v))return;\n\ngl.uniform4fv(this.addr,v);\n\ncopyArray(cache,v);\n\n}\n\n}\n\n// Single matrix (from flat array or THREE.MatrixN)\n\nfunction setValueM2(gl,v){\n\nvar cache=this.cache;\nvar elements=v.elements;\n\nif(elements===undefined){\n\nif(arraysEqual(cache,v))return;\n\ngl.uniformMatrix2fv(this.addr,false,v);\n\ncopyArray(cache,v);\n\n}else{\n\nif(arraysEqual(cache,elements))return;\n\nmat2array.set(elements);\n\ngl.uniformMatrix2fv(this.addr,false,mat2array);\n\ncopyArray(cache,elements);\n\n}\n\n}\n\nfunction setValueM3(gl,v){\n\nvar cache=this.cache;\nvar elements=v.elements;\n\nif(elements===undefined){\n\nif(arraysEqual(cache,v))return;\n\ngl.uniformMatrix3fv(this.addr,false,v);\n\ncopyArray(cache,v);\n\n}else{\n\nif(arraysEqual(cache,elements))return;\n\nmat3array.set(elements);\n\ngl.uniformMatrix3fv(this.addr,false,mat3array);\n\ncopyArray(cache,elements);\n\n}\n\n}\n\nfunction setValueM4(gl,v){\n\nvar cache=this.cache;\nvar elements=v.elements;\n\nif(elements===undefined){\n\nif(arraysEqual(cache,v))return;\n\ngl.uniformMatrix4fv(this.addr,false,v);\n\ncopyArray(cache,v);\n\n}else{\n\nif(arraysEqual(cache,elements))return;\n\nmat4array.set(elements);\n\ngl.uniformMatrix4fv(this.addr,false,mat4array);\n\ncopyArray(cache,elements);\n\n}\n\n}\n\n// Single integer / boolean\n\nfunction setValueV1i(gl,v){\n\nvar cache=this.cache;\n\nif(cache[0]===v)return;\n\ngl.uniform1i(this.addr,v);\n\ncache[0]=v;\n\n}\n\n// Single integer / boolean vector (from flat array)\n\nfunction setValueV2i(gl,v){\n\nvar cache=this.cache;\n\nif(arraysEqual(cache,v))return;\n\ngl.uniform2iv(this.addr,v);\n\ncopyArray(cache,v);\n\n}\n\nfunction setValueV3i(gl,v){\n\nvar cache=this.cache;\n\nif(arraysEqual(cache,v))return;\n\ngl.uniform3iv(this.addr,v);\n\ncopyArray(cache,v);\n\n}\n\nfunction setValueV4i(gl,v){\n\nvar cache=this.cache;\n\nif(arraysEqual(cache,v))return;\n\ngl.uniform4iv(this.addr,v);\n\ncopyArray(cache,v);\n\n}\n\n// Single unsigned integer\n\nfunction setValueV1ui(gl,v){\n\nvar cache=this.cache;\n\nif(cache[0]===v)return;\n\ngl.uniform1ui(this.addr,v);\n\ncache[0]=v;\n\n}\n\n// Single unsigned integer vector (from flat array)\n\nfunction setValueV2ui(gl,v){\n\nvar cache=this.cache;\n\nif(arraysEqual(cache,v))return;\n\ngl.uniform2uiv(this.addr,v);\n\ncopyArray(cache,v);\n\n}\n\nfunction setValueV3ui(gl,v){\n\nvar cache=this.cache;\n\nif(arraysEqual(cache,v))return;\n\ngl.uniform3uiv(this.addr,v);\n\ncopyArray(cache,v);\n\n}\n\nfunction setValueV4ui(gl,v){\n\nvar cache=this.cache;\n\nif(arraysEqual(cache,v))return;\n\ngl.uniform4uiv(this.addr,v);\n\ncopyArray(cache,v);\n\n}\n\n\n// Single texture (2D / Cube)\n\nfunction setValueT1(gl,v,textures){\n\nvar cache=this.cache;\nvar unit=textures.allocateTextureUnit();\n\nif(cache[0]!==unit){\n\ngl.uniform1i(this.addr,unit);\ncache[0]=unit;\n\n}\n\ntextures.setTexture2D(v||emptyTexture,unit);\n\n}\n\nfunction setValueT3D1(gl,v,textures){\n\nvar cache=this.cache;\nvar unit=textures.allocateTextureUnit();\n\nif(cache[0]!==unit){\n\ngl.uniform1i(this.addr,unit);\ncache[0]=unit;\n\n}\n\ntextures.setTexture3D(v||empty3dTexture,unit);\n\n}\n\nfunction setValueT6(gl,v,textures){\n\nvar cache=this.cache;\nvar unit=textures.allocateTextureUnit();\n\nif(cache[0]!==unit){\n\ngl.uniform1i(this.addr,unit);\ncache[0]=unit;\n\n}\n\ntextures.setTextureCube(v||emptyCubeTexture,unit);\n\n}\n\nfunction setValueT2DArray1(gl,v,textures){\n\nvar cache=this.cache;\nvar unit=textures.allocateTextureUnit();\n\nif(cache[0]!==unit){\n\ngl.uniform1i(this.addr,unit);\ncache[0]=unit;\n\n}\n\ntextures.setTexture2DArray(v||emptyArrayTexture,unit);\n\n}\n\n// Helper to pick the right setter for the singular case\n\nfunction getSingularSetter(type){\n\nswitch(type){\n\ncase 0x1406:return setValueV1f;// FLOAT\ncase 0x8b50:return setValueV2f;// _VEC2\ncase 0x8b51:return setValueV3f;// _VEC3\ncase 0x8b52:return setValueV4f;// _VEC4\n\ncase 0x8b5a:return setValueM2;// _MAT2\ncase 0x8b5b:return setValueM3;// _MAT3\ncase 0x8b5c:return setValueM4;// _MAT4\n\ncase 0x1404:case 0x8b56:return setValueV1i;// INT, BOOL\ncase 0x8b53:case 0x8b57:return setValueV2i;// _VEC2\ncase 0x8b54:case 0x8b58:return setValueV3i;// _VEC3\ncase 0x8b55:case 0x8b59:return setValueV4i;// _VEC4\n\ncase 0x1405:return setValueV1ui;// UINT\ncase 0x8dc6:return setValueV2ui;// _VEC2\ncase 0x8dc7:return setValueV3ui;// _VEC3\ncase 0x8dc8:return setValueV4ui;// _VEC4\n\ncase 0x8b5e:// SAMPLER_2D\ncase 0x8d66:// SAMPLER_EXTERNAL_OES\ncase 0x8dca:// INT_SAMPLER_2D\ncase 0x8dd2:// UNSIGNED_INT_SAMPLER_2D\ncase 0x8b62:// SAMPLER_2D_SHADOW\nreturn setValueT1;\n\ncase 0x8b5f:// SAMPLER_3D\ncase 0x8dcb:// INT_SAMPLER_3D\ncase 0x8dd3:// UNSIGNED_INT_SAMPLER_3D\nreturn setValueT3D1;\n\ncase 0x8b60:// SAMPLER_CUBE\ncase 0x8dcc:// INT_SAMPLER_CUBE\ncase 0x8dd4:// UNSIGNED_INT_SAMPLER_CUBE\ncase 0x8dc5:// SAMPLER_CUBE_SHADOW\nreturn setValueT6;\n\ncase 0x8dc1:// SAMPLER_2D_ARRAY\ncase 0x8dcf:// INT_SAMPLER_2D_ARRAY\ncase 0x8dd7:// UNSIGNED_INT_SAMPLER_2D_ARRAY\ncase 0x8dc4:// SAMPLER_2D_ARRAY_SHADOW\nreturn setValueT2DArray1;}\n\n\n\n}\n\n\n// Array of scalars\n\nfunction setValueV1fArray(gl,v){\n\ngl.uniform1fv(this.addr,v);\n\n}\n\n// Array of vectors (from flat array or array of THREE.VectorN)\n\nfunction setValueV2fArray(gl,v){\n\nvar data=flatten(v,this.size,2);\n\ngl.uniform2fv(this.addr,data);\n\n}\n\nfunction setValueV3fArray(gl,v){\n\nvar data=flatten(v,this.size,3);\n\ngl.uniform3fv(this.addr,data);\n\n}\n\nfunction setValueV4fArray(gl,v){\n\nvar data=flatten(v,this.size,4);\n\ngl.uniform4fv(this.addr,data);\n\n}\n\n// Array of matrices (from flat array or array of THREE.MatrixN)\n\nfunction setValueM2Array(gl,v){\n\nvar data=flatten(v,this.size,4);\n\ngl.uniformMatrix2fv(this.addr,false,data);\n\n}\n\nfunction setValueM3Array(gl,v){\n\nvar data=flatten(v,this.size,9);\n\ngl.uniformMatrix3fv(this.addr,false,data);\n\n}\n\nfunction setValueM4Array(gl,v){\n\nvar data=flatten(v,this.size,16);\n\ngl.uniformMatrix4fv(this.addr,false,data);\n\n}\n\n// Array of integer / boolean\n\nfunction setValueV1iArray(gl,v){\n\ngl.uniform1iv(this.addr,v);\n\n}\n\n// Array of integer / boolean vectors (from flat array)\n\nfunction setValueV2iArray(gl,v){\n\ngl.uniform2iv(this.addr,v);\n\n}\n\nfunction setValueV3iArray(gl,v){\n\ngl.uniform3iv(this.addr,v);\n\n}\n\nfunction setValueV4iArray(gl,v){\n\ngl.uniform4iv(this.addr,v);\n\n}\n\n// Array of unsigned integer\n\nfunction setValueV1uiArray(gl,v){\n\ngl.uniform1uiv(this.addr,v);\n\n}\n\n// Array of unsigned integer vectors (from flat array)\n\nfunction setValueV2uiArray(gl,v){\n\ngl.uniform2uiv(this.addr,v);\n\n}\n\nfunction setValueV3uiArray(gl,v){\n\ngl.uniform3uiv(this.addr,v);\n\n}\n\nfunction setValueV4uiArray(gl,v){\n\ngl.uniform4uiv(this.addr,v);\n\n}\n\n\n// Array of textures (2D / 3D / Cube / 2DArray)\n\nfunction setValueT1Array(gl,v,textures){\n\nvar n=v.length;\n\nvar units=allocTexUnits(textures,n);\n\ngl.uniform1iv(this.addr,units);\n\nfor(var i=0;i!==n;++i){\n\ntextures.setTexture2D(v[i]||emptyTexture,units[i]);\n\n}\n\n}\n\nfunction setValueT3DArray(gl,v,textures){\n\nvar n=v.length;\n\nvar units=allocTexUnits(textures,n);\n\ngl.uniform1iv(this.addr,units);\n\nfor(var i=0;i!==n;++i){\n\ntextures.setTexture3D(v[i]||empty3dTexture,units[i]);\n\n}\n\n}\n\nfunction setValueT6Array(gl,v,textures){\n\nvar n=v.length;\n\nvar units=allocTexUnits(textures,n);\n\ngl.uniform1iv(this.addr,units);\n\nfor(var i=0;i!==n;++i){\n\ntextures.setTextureCube(v[i]||emptyCubeTexture,units[i]);\n\n}\n\n}\n\nfunction setValueT2DArrayArray(gl,v,textures){\n\nvar n=v.length;\n\nvar units=allocTexUnits(textures,n);\n\ngl.uniform1iv(this.addr,units);\n\nfor(var i=0;i!==n;++i){\n\ntextures.setTexture2DArray(v[i]||emptyArrayTexture,units[i]);\n\n}\n\n}\n\n\n// Helper to pick the right setter for a pure (bottom-level) array\n\nfunction getPureArraySetter(type){\n\nswitch(type){\n\ncase 0x1406:return setValueV1fArray;// FLOAT\ncase 0x8b50:return setValueV2fArray;// _VEC2\ncase 0x8b51:return setValueV3fArray;// _VEC3\ncase 0x8b52:return setValueV4fArray;// _VEC4\n\ncase 0x8b5a:return setValueM2Array;// _MAT2\ncase 0x8b5b:return setValueM3Array;// _MAT3\ncase 0x8b5c:return setValueM4Array;// _MAT4\n\ncase 0x1404:case 0x8b56:return setValueV1iArray;// INT, BOOL\ncase 0x8b53:case 0x8b57:return setValueV2iArray;// _VEC2\ncase 0x8b54:case 0x8b58:return setValueV3iArray;// _VEC3\ncase 0x8b55:case 0x8b59:return setValueV4iArray;// _VEC4\n\ncase 0x1405:return setValueV1uiArray;// UINT\ncase 0x8dc6:return setValueV2uiArray;// _VEC2\ncase 0x8dc7:return setValueV3uiArray;// _VEC3\ncase 0x8dc8:return setValueV4uiArray;// _VEC4\n\ncase 0x8b5e:// SAMPLER_2D\ncase 0x8d66:// SAMPLER_EXTERNAL_OES\ncase 0x8dca:// INT_SAMPLER_2D\ncase 0x8dd2:// UNSIGNED_INT_SAMPLER_2D\ncase 0x8b62:// SAMPLER_2D_SHADOW\nreturn setValueT1Array;\n\ncase 0x8b5f:// SAMPLER_3D\ncase 0x8dcb:// INT_SAMPLER_3D\ncase 0x8dd3:// UNSIGNED_INT_SAMPLER_3D\nreturn setValueT3DArray;\n\ncase 0x8b60:// SAMPLER_CUBE\ncase 0x8dcc:// INT_SAMPLER_CUBE\ncase 0x8dd4:// UNSIGNED_INT_SAMPLER_CUBE\ncase 0x8dc5:// SAMPLER_CUBE_SHADOW\nreturn setValueT6Array;\n\ncase 0x8dc1:// SAMPLER_2D_ARRAY\ncase 0x8dcf:// INT_SAMPLER_2D_ARRAY\ncase 0x8dd7:// UNSIGNED_INT_SAMPLER_2D_ARRAY\ncase 0x8dc4:// SAMPLER_2D_ARRAY_SHADOW\nreturn setValueT2DArrayArray;}\n\n\n\n}\n\n// --- Uniform Classes ---\nvar\nSingleUniform=\n\nfunction SingleUniform(id,activeInfo,addr){_classCallCheck(this,SingleUniform);\n\nthis.id=id;\nthis.addr=addr;\nthis.cache=[];\nthis.setValue=getSingularSetter(activeInfo.type);\n\n// this.path = activeInfo.name; // DEBUG\n\n};var\n\n\n\nPureArrayUniform=\n\nfunction PureArrayUniform(id,activeInfo,addr){_classCallCheck(this,PureArrayUniform);\n\nthis.id=id;\nthis.addr=addr;\nthis.cache=[];\nthis.size=activeInfo.size;\nthis.setValue=getPureArraySetter(activeInfo.type);\n\n// this.path = activeInfo.name; // DEBUG\n\n};var\n\n\n\nStructuredUniform=function(){\n\nfunction StructuredUniform(id){_classCallCheck(this,StructuredUniform);\n\nthis.id=id;\n\nthis.seq=[];\nthis.map={};\n\n}_createClass(StructuredUniform,[{key:'setValue',value:function setValue(\n\ngl,value,textures){\n\nvar seq=this.seq;\n\nfor(var i=0,n=seq.length;i!==n;++i){\n\nvar u=seq[i];\nu.setValue(gl,value[u.id],textures);\n\n}\n\n}}]);return StructuredUniform;}();\n\n\n\n// --- Top-level ---\n\n// Parser - builds up the property tree from the path strings\n\nvar RePathPart=/(\\w+)(\\])?(\\[|\\.)?/g;\n\n// extracts\n// \t- the identifier (member name or array index)\n//  - followed by an optional right bracket (found when array index)\n//  - followed by an optional left bracket or dot (type of subscript)\n//\n// Note: These portions can be read in a non-overlapping fashion and\n// allow straightforward parsing of the hierarchy that WebGL encodes\n// in the uniform names.\n\nfunction addUniform(container,uniformObject){\n\ncontainer.seq.push(uniformObject);\ncontainer.map[uniformObject.id]=uniformObject;\n\n}\n\nfunction parseUniform(activeInfo,addr,container){\n\nvar path=activeInfo.name,\npathLength=path.length;\n\n// reset RegExp object, because of the early exit of a previous run\nRePathPart.lastIndex=0;\n\nwhile(true){\n\nvar match=RePathPart.exec(path),\nmatchEnd=RePathPart.lastIndex;\n\nvar id=match[1];\nvar idIsIndex=match[2]===']',\nsubscript=match[3];\n\nif(idIsIndex)id=id|0;// convert to integer\n\nif(subscript===undefined||subscript==='['&&matchEnd+2===pathLength){\n\n// bare name or \"pure\" bottom-level array \"[0]\" suffix\n\naddUniform(container,subscript===undefined?\nnew SingleUniform(id,activeInfo,addr):\nnew PureArrayUniform(id,activeInfo,addr));\n\nbreak;\n\n}else{\n\n// step into inner node / create it in case it doesn't exist\n\nvar map=container.map;\nvar next=map[id];\n\nif(next===undefined){\n\nnext=new StructuredUniform(id);\naddUniform(container,next);\n\n}\n\ncontainer=next;\n\n}\n\n}\n\n}\n\n// Root Container\nvar\nWebGLUniforms=function(){\n\nfunction WebGLUniforms(gl,program){_classCallCheck(this,WebGLUniforms);\n\nthis.seq=[];\nthis.map={};\n\nvar n=gl.getProgramParameter(program,35718);\n\nfor(var i=0;i<n;++i){\n\nvar info=gl.getActiveUniform(program,i),\naddr=gl.getUniformLocation(program,info.name);\n\nparseUniform(info,addr,this);\n\n}\n\n}_createClass(WebGLUniforms,[{key:'setValue',value:function setValue(\n\ngl,name,value,textures){\n\nvar u=this.map[name];\n\nif(u!==undefined)u.setValue(gl,value,textures);\n\n}},{key:'setOptional',value:function setOptional(\n\ngl,object,name){\n\nvar v=object[name];\n\nif(v!==undefined)this.setValue(gl,name,v);\n\n}}],[{key:'upload',value:function upload(\n\ngl,seq,values,textures){\n\nfor(var i=0,_n2=seq.length;i!==_n2;++i){\n\nvar u=seq[i],\nv=values[u.id];\n\nif(v.needsUpdate!==false){\n\n// note: always updating when .needsUpdate is undefined\nu.setValue(gl,v.value,textures);\n\n}\n\n}\n\n}},{key:'seqWithValue',value:function seqWithValue(\n\nseq,values){\n\nvar r=[];\n\nfor(var i=0,_n3=seq.length;i!==_n3;++i){\n\nvar u=seq[i];\nif(u.id in values)r.push(u);\n\n}\n\nreturn r;\n\n}}]);return WebGLUniforms;}();\n\n\n\nfunction WebGLShader(gl,type,string){\n\nvar shader=gl.createShader(type);\n\ngl.shaderSource(shader,string);\ngl.compileShader(shader);\n\nreturn shader;\n\n}\n\nvar programIdCount=0;\n\nfunction handleSource(string,errorLine){\n\nvar lines=string.split('\\n');\nvar lines2=[];\n\nvar from=Math.max(errorLine-6,0);\nvar to=Math.min(errorLine+6,lines.length);\n\nfor(var i=from;i<to;i++){\n\nvar line=i+1;\nlines2.push((line===errorLine?'>':' ')+' '+line+': '+lines[i]);\n\n}\n\nreturn lines2.join('\\n');\n\n}\n\nfunction getEncodingComponents(encoding){\n\nswitch(encoding){\n\ncase LinearEncoding:\nreturn['Linear','( value )'];\ncase sRGBEncoding:\nreturn['sRGB','( value )'];\ndefault:\nconsole.warn('THREE.WebGLProgram: Unsupported encoding:',encoding);\nreturn['Linear','( value )'];}\n\n\n\n}\n\nfunction getShaderErrors(gl,shader,type){\n\nvar status=gl.getShaderParameter(shader,35713);\nvar errors=gl.getShaderInfoLog(shader).trim();\n\nif(status&&errors==='')return'';\n\nvar errorMatches=/ERROR: 0:(\\d+)/.exec(errors);\nif(errorMatches){\n\n// --enable-privileged-webgl-extension\n// console.log( '**' + type + '**', gl.getExtension( 'WEBGL_debug_shaders' ).getTranslatedShaderSource( shader ) );\n\nvar errorLine=parseInt(errorMatches[1]);\nreturn type.toUpperCase()+'\\n\\n'+errors+'\\n\\n'+handleSource(gl.getShaderSource(shader),errorLine);\n\n}else{\n\nreturn errors;\n\n}\n\n}\n\nfunction getTexelEncodingFunction(functionName,encoding){\n\nvar components=getEncodingComponents(encoding);\nreturn'vec4 '+functionName+'( vec4 value ) { return LinearTo'+components[0]+components[1]+'; }';\n\n}\n\nfunction getToneMappingFunction(functionName,toneMapping){\n\nvar toneMappingName=void 0;\n\nswitch(toneMapping){\n\ncase LinearToneMapping:\ntoneMappingName='Linear';\nbreak;\n\ncase ReinhardToneMapping:\ntoneMappingName='Reinhard';\nbreak;\n\ncase CineonToneMapping:\ntoneMappingName='OptimizedCineon';\nbreak;\n\ncase ACESFilmicToneMapping:\ntoneMappingName='ACESFilmic';\nbreak;\n\ncase CustomToneMapping:\ntoneMappingName='Custom';\nbreak;\n\ndefault:\nconsole.warn('THREE.WebGLProgram: Unsupported toneMapping:',toneMapping);\ntoneMappingName='Linear';}\n\n\n\nreturn'vec3 '+functionName+'( vec3 color ) { return '+toneMappingName+'ToneMapping( color ); }';\n\n}\n\nfunction generateExtensions(parameters){\n\nvar chunks=[\nparameters.extensionDerivatives||!!parameters.envMapCubeUVHeight||parameters.bumpMap||parameters.tangentSpaceNormalMap||parameters.clearcoatNormalMap||parameters.flatShading||parameters.shaderID==='physical'?'#extension GL_OES_standard_derivatives : enable':'',\n(parameters.extensionFragDepth||parameters.logarithmicDepthBuffer)&&parameters.rendererExtensionFragDepth?'#extension GL_EXT_frag_depth : enable':'',\nparameters.extensionDrawBuffers&&parameters.rendererExtensionDrawBuffers?'#extension GL_EXT_draw_buffers : require':'',\n(parameters.extensionShaderTextureLOD||parameters.envMap||parameters.transmission)&&parameters.rendererExtensionShaderTextureLod?'#extension GL_EXT_shader_texture_lod : enable':''];\n\n\nreturn chunks.filter(filterEmptyLine).join('\\n');\n\n}\n\nfunction generateDefines(defines){\n\nvar chunks=[];\n\nfor(var name in defines){\n\nvar _value4=defines[name];\n\nif(_value4===false)continue;\n\nchunks.push('#define '+name+' '+_value4);\n\n}\n\nreturn chunks.join('\\n');\n\n}\n\nfunction fetchAttributeLocations(gl,program){\n\nvar attributes={};\n\nvar n=gl.getProgramParameter(program,35721);\n\nfor(var i=0;i<n;i++){\n\nvar info=gl.getActiveAttrib(program,i);\nvar name=info.name;\n\nvar locationSize=1;\nif(info.type===35674)locationSize=2;\nif(info.type===35675)locationSize=3;\nif(info.type===35676)locationSize=4;\n\n// console.log( 'THREE.WebGLProgram: ACTIVE VERTEX ATTRIBUTE:', name, i );\n\nattributes[name]={\ntype:info.type,\nlocation:gl.getAttribLocation(program,name),\nlocationSize:locationSize};\n\n\n}\n\nreturn attributes;\n\n}\n\nfunction filterEmptyLine(string){\n\nreturn string!=='';\n\n}\n\nfunction replaceLightNums(string,parameters){\n\nreturn string.\nreplace(/NUM_DIR_LIGHTS/g,parameters.numDirLights).\nreplace(/NUM_SPOT_LIGHTS/g,parameters.numSpotLights).\nreplace(/NUM_RECT_AREA_LIGHTS/g,parameters.numRectAreaLights).\nreplace(/NUM_POINT_LIGHTS/g,parameters.numPointLights).\nreplace(/NUM_HEMI_LIGHTS/g,parameters.numHemiLights).\nreplace(/NUM_DIR_LIGHT_SHADOWS/g,parameters.numDirLightShadows).\nreplace(/NUM_SPOT_LIGHT_SHADOWS/g,parameters.numSpotLightShadows).\nreplace(/NUM_POINT_LIGHT_SHADOWS/g,parameters.numPointLightShadows);\n\n}\n\nfunction replaceClippingPlaneNums(string,parameters){\n\nreturn string.\nreplace(/NUM_CLIPPING_PLANES/g,parameters.numClippingPlanes).\nreplace(/UNION_CLIPPING_PLANES/g,parameters.numClippingPlanes-parameters.numClipIntersection);\n\n}\n\n// Resolve Includes\n\nvar includePattern=/^[ \\t]*#include +<([\\w\\d./]+)>/gm;\n\nfunction resolveIncludes(string){\n\nreturn string.replace(includePattern,includeReplacer);\n\n}\n\nfunction includeReplacer(match,include){\n\nvar string=ShaderChunk[include];\n\nif(string===undefined){\n\nthrow new Error('Can not resolve #include <'+include+'>');\n\n}\n\nreturn resolveIncludes(string);\n\n}\n\n// Unroll Loops\n\nvar deprecatedUnrollLoopPattern=/#pragma unroll_loop[\\s]+?for \\( int i \\= (\\d+)\\; i < (\\d+)\\; i \\+\\+ \\) \\{([\\s\\S]+?)(?=\\})\\}/g;\nvar unrollLoopPattern=/#pragma unroll_loop_start\\s+for\\s*\\(\\s*int\\s+i\\s*=\\s*(\\d+)\\s*;\\s*i\\s*<\\s*(\\d+)\\s*;\\s*i\\s*\\+\\+\\s*\\)\\s*{([\\s\\S]+?)}\\s+#pragma unroll_loop_end/g;\n\nfunction unrollLoops(string){\n\nreturn string.\nreplace(unrollLoopPattern,loopReplacer).\nreplace(deprecatedUnrollLoopPattern,deprecatedLoopReplacer);\n\n}\n\nfunction deprecatedLoopReplacer(match,start,end,snippet){\n\nconsole.warn('WebGLProgram: #pragma unroll_loop shader syntax is deprecated. Please use #pragma unroll_loop_start syntax instead.');\nreturn loopReplacer(match,start,end,snippet);\n\n}\n\nfunction loopReplacer(match,start,end,snippet){\n\nvar string='';\n\nfor(var i=parseInt(start);i<parseInt(end);i++){\n\nstring+=snippet.\nreplace(/\\[\\s*i\\s*\\]/g,'[ '+i+' ]').\nreplace(/UNROLLED_LOOP_INDEX/g,i);\n\n}\n\nreturn string;\n\n}\n\n//\n\nfunction generatePrecision(parameters){\n\nvar precisionstring='precision '+parameters.precision+' float;\\nprecision '+parameters.precision+' int;';\n\nif(parameters.precision==='highp'){\n\nprecisionstring+='\\n#define HIGH_PRECISION';\n\n}else if(parameters.precision==='mediump'){\n\nprecisionstring+='\\n#define MEDIUM_PRECISION';\n\n}else if(parameters.precision==='lowp'){\n\nprecisionstring+='\\n#define LOW_PRECISION';\n\n}\n\nreturn precisionstring;\n\n}\n\nfunction generateShadowMapTypeDefine(parameters){\n\nvar shadowMapTypeDefine='SHADOWMAP_TYPE_BASIC';\n\nif(parameters.shadowMapType===PCFShadowMap){\n\nshadowMapTypeDefine='SHADOWMAP_TYPE_PCF';\n\n}else if(parameters.shadowMapType===PCFSoftShadowMap){\n\nshadowMapTypeDefine='SHADOWMAP_TYPE_PCF_SOFT';\n\n}else if(parameters.shadowMapType===VSMShadowMap){\n\nshadowMapTypeDefine='SHADOWMAP_TYPE_VSM';\n\n}\n\nreturn shadowMapTypeDefine;\n\n}\n\nfunction generateEnvMapTypeDefine(parameters){\n\nvar envMapTypeDefine='ENVMAP_TYPE_CUBE';\n\nif(parameters.envMap){\n\nswitch(parameters.envMapMode){\n\ncase CubeReflectionMapping:\ncase CubeRefractionMapping:\nenvMapTypeDefine='ENVMAP_TYPE_CUBE';\nbreak;\n\ncase CubeUVReflectionMapping:\nenvMapTypeDefine='ENVMAP_TYPE_CUBE_UV';\nbreak;}\n\n\n\n}\n\nreturn envMapTypeDefine;\n\n}\n\nfunction generateEnvMapModeDefine(parameters){\n\nvar envMapModeDefine='ENVMAP_MODE_REFLECTION';\n\nif(parameters.envMap){\n\nswitch(parameters.envMapMode){\n\ncase CubeRefractionMapping:\n\nenvMapModeDefine='ENVMAP_MODE_REFRACTION';\nbreak;}\n\n\n\n}\n\nreturn envMapModeDefine;\n\n}\n\nfunction generateEnvMapBlendingDefine(parameters){\n\nvar envMapBlendingDefine='ENVMAP_BLENDING_NONE';\n\nif(parameters.envMap){\n\nswitch(parameters.combine){\n\ncase MultiplyOperation:\nenvMapBlendingDefine='ENVMAP_BLENDING_MULTIPLY';\nbreak;\n\ncase MixOperation:\nenvMapBlendingDefine='ENVMAP_BLENDING_MIX';\nbreak;\n\ncase AddOperation:\nenvMapBlendingDefine='ENVMAP_BLENDING_ADD';\nbreak;}\n\n\n\n}\n\nreturn envMapBlendingDefine;\n\n}\n\nfunction generateCubeUVSize(parameters){\n\nvar imageHeight=parameters.envMapCubeUVHeight;\n\nif(imageHeight===null)return null;\n\nvar maxMip=Math.log2(imageHeight)-2;\n\nvar texelHeight=1.0/imageHeight;\n\nvar texelWidth=1.0/(3*Math.max(Math.pow(2,maxMip),7*16));\n\nreturn{texelWidth:texelWidth,texelHeight:texelHeight,maxMip:maxMip};\n\n}\n\nfunction WebGLProgram(renderer,cacheKey,parameters,bindingStates){\n\n// TODO Send this event to Three.js DevTools\n// console.log( 'WebGLProgram', cacheKey );\n\nvar gl=renderer.getContext();\n\nvar defines=parameters.defines;\n\nvar vertexShader=parameters.vertexShader;\nvar fragmentShader=parameters.fragmentShader;\n\nvar shadowMapTypeDefine=generateShadowMapTypeDefine(parameters);\nvar envMapTypeDefine=generateEnvMapTypeDefine(parameters);\nvar envMapModeDefine=generateEnvMapModeDefine(parameters);\nvar envMapBlendingDefine=generateEnvMapBlendingDefine(parameters);\nvar envMapCubeUVSize=generateCubeUVSize(parameters);\n\nvar customExtensions=parameters.isWebGL2?'':generateExtensions(parameters);\n\nvar customDefines=generateDefines(defines);\n\nvar program=gl.createProgram();\n\nvar prefixVertex=void 0,prefixFragment=void 0;\nvar versionString=parameters.glslVersion?'#version '+parameters.glslVersion+'\\n':'';\n\nif(parameters.isRawShaderMaterial){\n\nprefixVertex=[\n\ncustomDefines].\n\nfilter(filterEmptyLine).join('\\n');\n\nif(prefixVertex.length>0){\n\nprefixVertex+='\\n';\n\n}\n\nprefixFragment=[\n\ncustomExtensions,\ncustomDefines].\n\nfilter(filterEmptyLine).join('\\n');\n\nif(prefixFragment.length>0){\n\nprefixFragment+='\\n';\n\n}\n\n}else{\n\nprefixVertex=[\n\ngeneratePrecision(parameters),\n\n'#define SHADER_NAME '+parameters.shaderName,\n\ncustomDefines,\n\nparameters.instancing?'#define USE_INSTANCING':'',\nparameters.instancingColor?'#define USE_INSTANCING_COLOR':'',\n\nparameters.supportsVertexTextures?'#define VERTEX_TEXTURES':'',\n\nparameters.useFog&&parameters.fog?'#define USE_FOG':'',\nparameters.useFog&&parameters.fogExp2?'#define FOG_EXP2':'',\n\nparameters.map?'#define USE_MAP':'',\nparameters.envMap?'#define USE_ENVMAP':'',\nparameters.envMap?'#define '+envMapModeDefine:'',\nparameters.lightMap?'#define USE_LIGHTMAP':'',\nparameters.aoMap?'#define USE_AOMAP':'',\nparameters.emissiveMap?'#define USE_EMISSIVEMAP':'',\nparameters.bumpMap?'#define USE_BUMPMAP':'',\nparameters.normalMap?'#define USE_NORMALMAP':'',\nparameters.normalMap&&parameters.objectSpaceNormalMap?'#define OBJECTSPACE_NORMALMAP':'',\nparameters.normalMap&&parameters.tangentSpaceNormalMap?'#define TANGENTSPACE_NORMALMAP':'',\n\nparameters.clearcoatMap?'#define USE_CLEARCOATMAP':'',\nparameters.clearcoatRoughnessMap?'#define USE_CLEARCOAT_ROUGHNESSMAP':'',\nparameters.clearcoatNormalMap?'#define USE_CLEARCOAT_NORMALMAP':'',\n\nparameters.iridescenceMap?'#define USE_IRIDESCENCEMAP':'',\nparameters.iridescenceThicknessMap?'#define USE_IRIDESCENCE_THICKNESSMAP':'',\n\nparameters.displacementMap&&parameters.supportsVertexTextures?'#define USE_DISPLACEMENTMAP':'',\n\nparameters.specularMap?'#define USE_SPECULARMAP':'',\nparameters.specularIntensityMap?'#define USE_SPECULARINTENSITYMAP':'',\nparameters.specularColorMap?'#define USE_SPECULARCOLORMAP':'',\n\nparameters.roughnessMap?'#define USE_ROUGHNESSMAP':'',\nparameters.metalnessMap?'#define USE_METALNESSMAP':'',\nparameters.alphaMap?'#define USE_ALPHAMAP':'',\n\nparameters.transmission?'#define USE_TRANSMISSION':'',\nparameters.transmissionMap?'#define USE_TRANSMISSIONMAP':'',\nparameters.thicknessMap?'#define USE_THICKNESSMAP':'',\n\nparameters.sheenColorMap?'#define USE_SHEENCOLORMAP':'',\nparameters.sheenRoughnessMap?'#define USE_SHEENROUGHNESSMAP':'',\n\nparameters.vertexTangents?'#define USE_TANGENT':'',\nparameters.vertexColors?'#define USE_COLOR':'',\nparameters.vertexAlphas?'#define USE_COLOR_ALPHA':'',\nparameters.vertexUvs?'#define USE_UV':'',\nparameters.uvsVertexOnly?'#define UVS_VERTEX_ONLY':'',\n\nparameters.flatShading?'#define FLAT_SHADED':'',\n\nparameters.skinning?'#define USE_SKINNING':'',\n\nparameters.morphTargets?'#define USE_MORPHTARGETS':'',\nparameters.morphNormals&&parameters.flatShading===false?'#define USE_MORPHNORMALS':'',\nparameters.morphColors&&parameters.isWebGL2?'#define USE_MORPHCOLORS':'',\nparameters.morphTargetsCount>0&&parameters.isWebGL2?'#define MORPHTARGETS_TEXTURE':'',\nparameters.morphTargetsCount>0&&parameters.isWebGL2?'#define MORPHTARGETS_TEXTURE_STRIDE '+parameters.morphTextureStride:'',\nparameters.morphTargetsCount>0&&parameters.isWebGL2?'#define MORPHTARGETS_COUNT '+parameters.morphTargetsCount:'',\nparameters.doubleSided?'#define DOUBLE_SIDED':'',\nparameters.flipSided?'#define FLIP_SIDED':'',\n\nparameters.shadowMapEnabled?'#define USE_SHADOWMAP':'',\nparameters.shadowMapEnabled?'#define '+shadowMapTypeDefine:'',\n\nparameters.sizeAttenuation?'#define USE_SIZEATTENUATION':'',\n\nparameters.logarithmicDepthBuffer?'#define USE_LOGDEPTHBUF':'',\nparameters.logarithmicDepthBuffer&&parameters.rendererExtensionFragDepth?'#define USE_LOGDEPTHBUF_EXT':'',\n\n'uniform mat4 modelMatrix;',\n'uniform mat4 modelViewMatrix;',\n'uniform mat4 projectionMatrix;',\n'uniform mat4 viewMatrix;',\n'uniform mat3 normalMatrix;',\n'uniform vec3 cameraPosition;',\n'uniform bool isOrthographic;',\n\n'#ifdef USE_INSTANCING',\n\n'\tattribute mat4 instanceMatrix;',\n\n'#endif',\n\n'#ifdef USE_INSTANCING_COLOR',\n\n'\tattribute vec3 instanceColor;',\n\n'#endif',\n\n'attribute vec3 position;',\n'attribute vec3 normal;',\n'attribute vec2 uv;',\n\n'#ifdef USE_TANGENT',\n\n'\tattribute vec4 tangent;',\n\n'#endif',\n\n'#if defined( USE_COLOR_ALPHA )',\n\n'\tattribute vec4 color;',\n\n'#elif defined( USE_COLOR )',\n\n'\tattribute vec3 color;',\n\n'#endif',\n\n'#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )',\n\n'\tattribute vec3 morphTarget0;',\n'\tattribute vec3 morphTarget1;',\n'\tattribute vec3 morphTarget2;',\n'\tattribute vec3 morphTarget3;',\n\n'\t#ifdef USE_MORPHNORMALS',\n\n'\t\tattribute vec3 morphNormal0;',\n'\t\tattribute vec3 morphNormal1;',\n'\t\tattribute vec3 morphNormal2;',\n'\t\tattribute vec3 morphNormal3;',\n\n'\t#else',\n\n'\t\tattribute vec3 morphTarget4;',\n'\t\tattribute vec3 morphTarget5;',\n'\t\tattribute vec3 morphTarget6;',\n'\t\tattribute vec3 morphTarget7;',\n\n'\t#endif',\n\n'#endif',\n\n'#ifdef USE_SKINNING',\n\n'\tattribute vec4 skinIndex;',\n'\tattribute vec4 skinWeight;',\n\n'#endif',\n\n'\\n'].\n\nfilter(filterEmptyLine).join('\\n');\n\nprefixFragment=[\n\ncustomExtensions,\n\ngeneratePrecision(parameters),\n\n'#define SHADER_NAME '+parameters.shaderName,\n\ncustomDefines,\n\nparameters.useFog&&parameters.fog?'#define USE_FOG':'',\nparameters.useFog&&parameters.fogExp2?'#define FOG_EXP2':'',\n\nparameters.map?'#define USE_MAP':'',\nparameters.matcap?'#define USE_MATCAP':'',\nparameters.envMap?'#define USE_ENVMAP':'',\nparameters.envMap?'#define '+envMapTypeDefine:'',\nparameters.envMap?'#define '+envMapModeDefine:'',\nparameters.envMap?'#define '+envMapBlendingDefine:'',\nenvMapCubeUVSize?'#define CUBEUV_TEXEL_WIDTH '+envMapCubeUVSize.texelWidth:'',\nenvMapCubeUVSize?'#define CUBEUV_TEXEL_HEIGHT '+envMapCubeUVSize.texelHeight:'',\nenvMapCubeUVSize?'#define CUBEUV_MAX_MIP '+envMapCubeUVSize.maxMip+'.0':'',\nparameters.lightMap?'#define USE_LIGHTMAP':'',\nparameters.aoMap?'#define USE_AOMAP':'',\nparameters.emissiveMap?'#define USE_EMISSIVEMAP':'',\nparameters.bumpMap?'#define USE_BUMPMAP':'',\nparameters.normalMap?'#define USE_NORMALMAP':'',\nparameters.normalMap&&parameters.objectSpaceNormalMap?'#define OBJECTSPACE_NORMALMAP':'',\nparameters.normalMap&&parameters.tangentSpaceNormalMap?'#define TANGENTSPACE_NORMALMAP':'',\n\nparameters.clearcoat?'#define USE_CLEARCOAT':'',\nparameters.clearcoatMap?'#define USE_CLEARCOATMAP':'',\nparameters.clearcoatRoughnessMap?'#define USE_CLEARCOAT_ROUGHNESSMAP':'',\nparameters.clearcoatNormalMap?'#define USE_CLEARCOAT_NORMALMAP':'',\n\nparameters.iridescence?'#define USE_IRIDESCENCE':'',\nparameters.iridescenceMap?'#define USE_IRIDESCENCEMAP':'',\nparameters.iridescenceThicknessMap?'#define USE_IRIDESCENCE_THICKNESSMAP':'',\n\nparameters.specularMap?'#define USE_SPECULARMAP':'',\nparameters.specularIntensityMap?'#define USE_SPECULARINTENSITYMAP':'',\nparameters.specularColorMap?'#define USE_SPECULARCOLORMAP':'',\nparameters.roughnessMap?'#define USE_ROUGHNESSMAP':'',\nparameters.metalnessMap?'#define USE_METALNESSMAP':'',\n\nparameters.alphaMap?'#define USE_ALPHAMAP':'',\nparameters.alphaTest?'#define USE_ALPHATEST':'',\n\nparameters.sheen?'#define USE_SHEEN':'',\nparameters.sheenColorMap?'#define USE_SHEENCOLORMAP':'',\nparameters.sheenRoughnessMap?'#define USE_SHEENROUGHNESSMAP':'',\n\nparameters.transmission?'#define USE_TRANSMISSION':'',\nparameters.transmissionMap?'#define USE_TRANSMISSIONMAP':'',\nparameters.thicknessMap?'#define USE_THICKNESSMAP':'',\n\nparameters.decodeVideoTexture?'#define DECODE_VIDEO_TEXTURE':'',\n\nparameters.vertexTangents?'#define USE_TANGENT':'',\nparameters.vertexColors||parameters.instancingColor?'#define USE_COLOR':'',\nparameters.vertexAlphas?'#define USE_COLOR_ALPHA':'',\nparameters.vertexUvs?'#define USE_UV':'',\nparameters.uvsVertexOnly?'#define UVS_VERTEX_ONLY':'',\n\nparameters.gradientMap?'#define USE_GRADIENTMAP':'',\n\nparameters.flatShading?'#define FLAT_SHADED':'',\n\nparameters.doubleSided?'#define DOUBLE_SIDED':'',\nparameters.flipSided?'#define FLIP_SIDED':'',\n\nparameters.shadowMapEnabled?'#define USE_SHADOWMAP':'',\nparameters.shadowMapEnabled?'#define '+shadowMapTypeDefine:'',\n\nparameters.premultipliedAlpha?'#define PREMULTIPLIED_ALPHA':'',\n\nparameters.physicallyCorrectLights?'#define PHYSICALLY_CORRECT_LIGHTS':'',\n\nparameters.logarithmicDepthBuffer?'#define USE_LOGDEPTHBUF':'',\nparameters.logarithmicDepthBuffer&&parameters.rendererExtensionFragDepth?'#define USE_LOGDEPTHBUF_EXT':'',\n\n'uniform mat4 viewMatrix;',\n'uniform vec3 cameraPosition;',\n'uniform bool isOrthographic;',\n\nparameters.toneMapping!==NoToneMapping?'#define TONE_MAPPING':'',\nparameters.toneMapping!==NoToneMapping?ShaderChunk['tonemapping_pars_fragment']:'',// this code is required here because it is used by the toneMapping() function defined below\nparameters.toneMapping!==NoToneMapping?getToneMappingFunction('toneMapping',parameters.toneMapping):'',\n\nparameters.dithering?'#define DITHERING':'',\nparameters.opaque?'#define OPAQUE':'',\n\nShaderChunk['encodings_pars_fragment'],// this code is required here because it is used by the various encoding/decoding function defined below\ngetTexelEncodingFunction('linearToOutputTexel',parameters.outputEncoding),\n\nparameters.useDepthPacking?'#define DEPTH_PACKING '+parameters.depthPacking:'',\n\n'\\n'].\n\nfilter(filterEmptyLine).join('\\n');\n\n}\n\nvertexShader=resolveIncludes(vertexShader);\nvertexShader=replaceLightNums(vertexShader,parameters);\nvertexShader=replaceClippingPlaneNums(vertexShader,parameters);\n\nfragmentShader=resolveIncludes(fragmentShader);\nfragmentShader=replaceLightNums(fragmentShader,parameters);\nfragmentShader=replaceClippingPlaneNums(fragmentShader,parameters);\n\nvertexShader=unrollLoops(vertexShader);\nfragmentShader=unrollLoops(fragmentShader);\n\nif(parameters.isWebGL2&&parameters.isRawShaderMaterial!==true){\n\n// GLSL 3.0 conversion for built-in materials and ShaderMaterial\n\nversionString='#version 300 es\\n';\n\nprefixVertex=[\n'precision mediump sampler2DArray;',\n'#define attribute in',\n'#define varying out',\n'#define texture2D texture'].\njoin('\\n')+'\\n'+prefixVertex;\n\nprefixFragment=[\n'#define varying in',\nparameters.glslVersion===GLSL3?'':'layout(location = 0) out highp vec4 pc_fragColor;',\nparameters.glslVersion===GLSL3?'':'#define gl_FragColor pc_fragColor',\n'#define gl_FragDepthEXT gl_FragDepth',\n'#define texture2D texture',\n'#define textureCube texture',\n'#define texture2DProj textureProj',\n'#define texture2DLodEXT textureLod',\n'#define texture2DProjLodEXT textureProjLod',\n'#define textureCubeLodEXT textureLod',\n'#define texture2DGradEXT textureGrad',\n'#define texture2DProjGradEXT textureProjGrad',\n'#define textureCubeGradEXT textureGrad'].\njoin('\\n')+'\\n'+prefixFragment;\n\n}\n\nvar vertexGlsl=versionString+prefixVertex+vertexShader;\nvar fragmentGlsl=versionString+prefixFragment+fragmentShader;\n\n// console.log( '*VERTEX*', vertexGlsl );\n// console.log( '*FRAGMENT*', fragmentGlsl );\n\nvar glVertexShader=WebGLShader(gl,35633,vertexGlsl);\nvar glFragmentShader=WebGLShader(gl,35632,fragmentGlsl);\n\ngl.attachShader(program,glVertexShader);\ngl.attachShader(program,glFragmentShader);\n\n// Force a particular attribute to index 0.\n\nif(parameters.index0AttributeName!==undefined){\n\ngl.bindAttribLocation(program,0,parameters.index0AttributeName);\n\n}else if(parameters.morphTargets===true){\n\n// programs with morphTargets displace position out of attribute 0\ngl.bindAttribLocation(program,0,'position');\n\n}\n\ngl.linkProgram(program);\n\n// check for link errors\nif(renderer.debug.checkShaderErrors){\n\nvar programLog=gl.getProgramInfoLog(program).trim();\nvar vertexLog=gl.getShaderInfoLog(glVertexShader).trim();\nvar fragmentLog=gl.getShaderInfoLog(glFragmentShader).trim();\n\nvar runnable=true;\nvar haveDiagnostics=true;\n\nif(gl.getProgramParameter(program,35714)===false){\n\nrunnable=false;\n\nvar vertexErrors=getShaderErrors(gl,glVertexShader,'vertex');\nvar fragmentErrors=getShaderErrors(gl,glFragmentShader,'fragment');\n\nconsole.error(\n'THREE.WebGLProgram: Shader Error '+gl.getError()+' - '+\n'VALIDATE_STATUS '+gl.getProgramParameter(program,35715)+'\\n\\n'+\n'Program Info Log: '+programLog+'\\n'+\nvertexErrors+'\\n'+\nfragmentErrors);\n\n\n}else if(programLog!==''){\n\nconsole.warn('THREE.WebGLProgram: Program Info Log:',programLog);\n\n}else if(vertexLog===''||fragmentLog===''){\n\nhaveDiagnostics=false;\n\n}\n\nif(haveDiagnostics){\n\nthis.diagnostics={\n\nrunnable:runnable,\n\nprogramLog:programLog,\n\nvertexShader:{\n\nlog:vertexLog,\nprefix:prefixVertex},\n\n\n\nfragmentShader:{\n\nlog:fragmentLog,\nprefix:prefixFragment}};\n\n\n\n\n\n}\n\n}\n\n// Clean up\n\n// Crashes in iOS9 and iOS10. #18402\n// gl.detachShader( program, glVertexShader );\n// gl.detachShader( program, glFragmentShader );\n\ngl.deleteShader(glVertexShader);\ngl.deleteShader(glFragmentShader);\n\n// set up caching for uniform locations\n\nvar cachedUniforms=void 0;\n\nthis.getUniforms=function(){\n\nif(cachedUniforms===undefined){\n\ncachedUniforms=new WebGLUniforms(gl,program);\n\n}\n\nreturn cachedUniforms;\n\n};\n\n// set up caching for attribute locations\n\nvar cachedAttributes=void 0;\n\nthis.getAttributes=function(){\n\nif(cachedAttributes===undefined){\n\ncachedAttributes=fetchAttributeLocations(gl,program);\n\n}\n\nreturn cachedAttributes;\n\n};\n\n// free resource\n\nthis.destroy=function(){\n\nbindingStates.releaseStatesOfProgram(this);\n\ngl.deleteProgram(program);\nthis.program=undefined;\n\n};\n\n//\n\nthis.name=parameters.shaderName;\nthis.id=programIdCount++;\nthis.cacheKey=cacheKey;\nthis.usedTimes=1;\nthis.program=program;\nthis.vertexShader=glVertexShader;\nthis.fragmentShader=glFragmentShader;\n\nreturn this;\n\n}\n\nvar _id=0;var\n\nWebGLShaderCache=function(){\n\nfunction WebGLShaderCache(){_classCallCheck(this,WebGLShaderCache);\n\nthis.shaderCache=new Map();\nthis.materialCache=new Map();\n\n}_createClass(WebGLShaderCache,[{key:'update',value:function update(\n\nmaterial){\n\nvar vertexShader=material.vertexShader;\nvar fragmentShader=material.fragmentShader;\n\nvar vertexShaderStage=this._getShaderStage(vertexShader);\nvar fragmentShaderStage=this._getShaderStage(fragmentShader);\n\nvar materialShaders=this._getShaderCacheForMaterial(material);\n\nif(materialShaders.has(vertexShaderStage)===false){\n\nmaterialShaders.add(vertexShaderStage);\nvertexShaderStage.usedTimes++;\n\n}\n\nif(materialShaders.has(fragmentShaderStage)===false){\n\nmaterialShaders.add(fragmentShaderStage);\nfragmentShaderStage.usedTimes++;\n\n}\n\nreturn this;\n\n}},{key:'remove',value:function remove(\n\nmaterial){\n\nvar materialShaders=this.materialCache.get(material);var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{\n\nfor(var _iterator=materialShaders[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var shaderStage=_step.value;\n\nshaderStage.usedTimes--;\n\nif(shaderStage.usedTimes===0)this.shaderCache.delete(shaderStage.code);\n\n}}catch(err){_didIteratorError=true;_iteratorError=err;}finally{try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return();}}finally{if(_didIteratorError){throw _iteratorError;}}}\n\nthis.materialCache.delete(material);\n\nreturn this;\n\n}},{key:'getVertexShaderID',value:function getVertexShaderID(\n\nmaterial){\n\nreturn this._getShaderStage(material.vertexShader).id;\n\n}},{key:'getFragmentShaderID',value:function getFragmentShaderID(\n\nmaterial){\n\nreturn this._getShaderStage(material.fragmentShader).id;\n\n}},{key:'dispose',value:function dispose()\n\n{\n\nthis.shaderCache.clear();\nthis.materialCache.clear();\n\n}},{key:'_getShaderCacheForMaterial',value:function _getShaderCacheForMaterial(\n\nmaterial){\n\nvar cache=this.materialCache;\n\nif(cache.has(material)===false){\n\ncache.set(material,new Set());\n\n}\n\nreturn cache.get(material);\n\n}},{key:'_getShaderStage',value:function _getShaderStage(\n\ncode){\n\nvar cache=this.shaderCache;\n\nif(cache.has(code)===false){\n\nvar stage=new WebGLShaderStage(code);\ncache.set(code,stage);\n\n}\n\nreturn cache.get(code);\n\n}}]);return WebGLShaderCache;}();var\n\n\n\nWebGLShaderStage=\n\nfunction WebGLShaderStage(code){_classCallCheck(this,WebGLShaderStage);\n\nthis.id=_id++;\n\nthis.code=code;\nthis.usedTimes=0;\n\n};\n\n\n\nfunction WebGLPrograms(renderer,cubemaps,cubeuvmaps,extensions,capabilities,bindingStates,clipping){\n\nvar _programLayers=new Layers();\nvar _customShaders=new WebGLShaderCache();\nvar programs=[];\n\nvar isWebGL2=capabilities.isWebGL2;\nvar logarithmicDepthBuffer=capabilities.logarithmicDepthBuffer;\nvar vertexTextures=capabilities.vertexTextures;\nvar precision=capabilities.precision;\n\nvar shaderIDs={\nMeshDepthMaterial:'depth',\nMeshDistanceMaterial:'distanceRGBA',\nMeshNormalMaterial:'normal',\nMeshBasicMaterial:'basic',\nMeshLambertMaterial:'lambert',\nMeshPhongMaterial:'phong',\nMeshToonMaterial:'toon',\nMeshStandardMaterial:'physical',\nMeshPhysicalMaterial:'physical',\nMeshMatcapMaterial:'matcap',\nLineBasicMaterial:'basic',\nLineDashedMaterial:'dashed',\nPointsMaterial:'points',\nShadowMaterial:'shadow',\nSpriteMaterial:'sprite'};\n\n\nfunction getParameters(material,lights,shadows,scene,object){\n\nvar fog=scene.fog;\nvar geometry=object.geometry;\nvar environment=material.isMeshStandardMaterial?scene.environment:null;\n\nvar envMap=(material.isMeshStandardMaterial?cubeuvmaps:cubemaps).get(material.envMap||environment);\nvar envMapCubeUVHeight=!!envMap&&envMap.mapping===CubeUVReflectionMapping?envMap.image.height:null;\n\nvar shaderID=shaderIDs[material.type];\n\n// heuristics to create shader parameters according to lights in the scene\n// (not to blow over maxLights budget)\n\nif(material.precision!==null){\n\nprecision=capabilities.getMaxPrecision(material.precision);\n\nif(precision!==material.precision){\n\nconsole.warn('THREE.WebGLProgram.getParameters:',material.precision,'not supported, using',precision,'instead.');\n\n}\n\n}\n\n//\n\nvar morphAttribute=geometry.morphAttributes.position||geometry.morphAttributes.normal||geometry.morphAttributes.color;\nvar morphTargetsCount=morphAttribute!==undefined?morphAttribute.length:0;\n\nvar morphTextureStride=0;\n\nif(geometry.morphAttributes.position!==undefined)morphTextureStride=1;\nif(geometry.morphAttributes.normal!==undefined)morphTextureStride=2;\nif(geometry.morphAttributes.color!==undefined)morphTextureStride=3;\n\n//\n\nvar vertexShader=void 0,fragmentShader=void 0;\nvar customVertexShaderID=void 0,customFragmentShaderID=void 0;\n\nif(shaderID){\n\nvar shader=ShaderLib[shaderID];\n\nvertexShader=shader.vertexShader;\nfragmentShader=shader.fragmentShader;\n\n}else{\n\nvertexShader=material.vertexShader;\nfragmentShader=material.fragmentShader;\n\n_customShaders.update(material);\n\ncustomVertexShaderID=_customShaders.getVertexShaderID(material);\ncustomFragmentShaderID=_customShaders.getFragmentShaderID(material);\n\n}\n\nvar currentRenderTarget=renderer.getRenderTarget();\n\nvar useAlphaTest=material.alphaTest>0;\nvar useClearcoat=material.clearcoat>0;\nvar useIridescence=material.iridescence>0;\n\nvar parameters={\n\nisWebGL2:isWebGL2,\n\nshaderID:shaderID,\nshaderName:material.type,\n\nvertexShader:vertexShader,\nfragmentShader:fragmentShader,\ndefines:material.defines,\n\ncustomVertexShaderID:customVertexShaderID,\ncustomFragmentShaderID:customFragmentShaderID,\n\nisRawShaderMaterial:material.isRawShaderMaterial===true,\nglslVersion:material.glslVersion,\n\nprecision:precision,\n\ninstancing:object.isInstancedMesh===true,\ninstancingColor:object.isInstancedMesh===true&&object.instanceColor!==null,\n\nsupportsVertexTextures:vertexTextures,\noutputEncoding:currentRenderTarget===null?renderer.outputEncoding:currentRenderTarget.isXRRenderTarget===true?currentRenderTarget.texture.encoding:LinearEncoding,\nmap:!!material.map,\nmatcap:!!material.matcap,\nenvMap:!!envMap,\nenvMapMode:envMap&&envMap.mapping,\nenvMapCubeUVHeight:envMapCubeUVHeight,\nlightMap:!!material.lightMap,\naoMap:!!material.aoMap,\nemissiveMap:!!material.emissiveMap,\nbumpMap:!!material.bumpMap,\nnormalMap:!!material.normalMap,\nobjectSpaceNormalMap:material.normalMapType===ObjectSpaceNormalMap,\ntangentSpaceNormalMap:material.normalMapType===TangentSpaceNormalMap,\n\ndecodeVideoTexture:!!material.map&&material.map.isVideoTexture===true&&material.map.encoding===sRGBEncoding,\n\nclearcoat:useClearcoat,\nclearcoatMap:useClearcoat&&!!material.clearcoatMap,\nclearcoatRoughnessMap:useClearcoat&&!!material.clearcoatRoughnessMap,\nclearcoatNormalMap:useClearcoat&&!!material.clearcoatNormalMap,\n\niridescence:useIridescence,\niridescenceMap:useIridescence&&!!material.iridescenceMap,\niridescenceThicknessMap:useIridescence&&!!material.iridescenceThicknessMap,\n\ndisplacementMap:!!material.displacementMap,\nroughnessMap:!!material.roughnessMap,\nmetalnessMap:!!material.metalnessMap,\nspecularMap:!!material.specularMap,\nspecularIntensityMap:!!material.specularIntensityMap,\nspecularColorMap:!!material.specularColorMap,\n\nopaque:material.transparent===false&&material.blending===NormalBlending,\n\nalphaMap:!!material.alphaMap,\nalphaTest:useAlphaTest,\n\ngradientMap:!!material.gradientMap,\n\nsheen:material.sheen>0,\nsheenColorMap:!!material.sheenColorMap,\nsheenRoughnessMap:!!material.sheenRoughnessMap,\n\ntransmission:material.transmission>0,\ntransmissionMap:!!material.transmissionMap,\nthicknessMap:!!material.thicknessMap,\n\ncombine:material.combine,\n\nvertexTangents:!!material.normalMap&&!!geometry.attributes.tangent,\nvertexColors:material.vertexColors,\nvertexAlphas:material.vertexColors===true&&!!geometry.attributes.color&&geometry.attributes.color.itemSize===4,\nvertexUvs:!!material.map||!!material.bumpMap||!!material.normalMap||!!material.specularMap||!!material.alphaMap||!!material.emissiveMap||!!material.roughnessMap||!!material.metalnessMap||!!material.clearcoatMap||!!material.clearcoatRoughnessMap||!!material.clearcoatNormalMap||!!material.iridescenceMap||!!material.iridescenceThicknessMap||!!material.displacementMap||!!material.transmissionMap||!!material.thicknessMap||!!material.specularIntensityMap||!!material.specularColorMap||!!material.sheenColorMap||!!material.sheenRoughnessMap,\nuvsVertexOnly:!(!!material.map||!!material.bumpMap||!!material.normalMap||!!material.specularMap||!!material.alphaMap||!!material.emissiveMap||!!material.roughnessMap||!!material.metalnessMap||!!material.clearcoatNormalMap||!!material.iridescenceMap||!!material.iridescenceThicknessMap||material.transmission>0||!!material.transmissionMap||!!material.thicknessMap||!!material.specularIntensityMap||!!material.specularColorMap||material.sheen>0||!!material.sheenColorMap||!!material.sheenRoughnessMap)&&!!material.displacementMap,\n\nfog:!!fog,\nuseFog:material.fog===true,\nfogExp2:fog&&fog.isFogExp2,\n\nflatShading:!!material.flatShading,\n\nsizeAttenuation:material.sizeAttenuation,\nlogarithmicDepthBuffer:logarithmicDepthBuffer,\n\nskinning:object.isSkinnedMesh===true,\n\nmorphTargets:geometry.morphAttributes.position!==undefined,\nmorphNormals:geometry.morphAttributes.normal!==undefined,\nmorphColors:geometry.morphAttributes.color!==undefined,\nmorphTargetsCount:morphTargetsCount,\nmorphTextureStride:morphTextureStride,\n\nnumDirLights:lights.directional.length,\nnumPointLights:lights.point.length,\nnumSpotLights:lights.spot.length,\nnumRectAreaLights:lights.rectArea.length,\nnumHemiLights:lights.hemi.length,\n\nnumDirLightShadows:lights.directionalShadowMap.length,\nnumPointLightShadows:lights.pointShadowMap.length,\nnumSpotLightShadows:lights.spotShadowMap.length,\n\nnumClippingPlanes:clipping.numPlanes,\nnumClipIntersection:clipping.numIntersection,\n\ndithering:material.dithering,\n\nshadowMapEnabled:renderer.shadowMap.enabled&&shadows.length>0,\nshadowMapType:renderer.shadowMap.type,\n\ntoneMapping:material.toneMapped?renderer.toneMapping:NoToneMapping,\nphysicallyCorrectLights:renderer.physicallyCorrectLights,\n\npremultipliedAlpha:material.premultipliedAlpha,\n\ndoubleSided:material.side===DoubleSide,\nflipSided:material.side===BackSide,\n\nuseDepthPacking:!!material.depthPacking,\ndepthPacking:material.depthPacking||0,\n\nindex0AttributeName:material.index0AttributeName,\n\nextensionDerivatives:material.extensions&&material.extensions.derivatives,\nextensionFragDepth:material.extensions&&material.extensions.fragDepth,\nextensionDrawBuffers:material.extensions&&material.extensions.drawBuffers,\nextensionShaderTextureLOD:material.extensions&&material.extensions.shaderTextureLOD,\n\nrendererExtensionFragDepth:isWebGL2||extensions.has('EXT_frag_depth'),\nrendererExtensionDrawBuffers:isWebGL2||extensions.has('WEBGL_draw_buffers'),\nrendererExtensionShaderTextureLod:isWebGL2||extensions.has('EXT_shader_texture_lod'),\n\ncustomProgramCacheKey:material.customProgramCacheKey()};\n\n\n\nreturn parameters;\n\n}\n\nfunction getProgramCacheKey(parameters){\n\nvar array=[];\n\nif(parameters.shaderID){\n\narray.push(parameters.shaderID);\n\n}else{\n\narray.push(parameters.customVertexShaderID);\narray.push(parameters.customFragmentShaderID);\n\n}\n\nif(parameters.defines!==undefined){\n\nfor(var name in parameters.defines){\n\narray.push(name);\narray.push(parameters.defines[name]);\n\n}\n\n}\n\nif(parameters.isRawShaderMaterial===false){\n\ngetProgramCacheKeyParameters(array,parameters);\ngetProgramCacheKeyBooleans(array,parameters);\narray.push(renderer.outputEncoding);\n\n}\n\narray.push(parameters.customProgramCacheKey);\n\nreturn array.join();\n\n}\n\nfunction getProgramCacheKeyParameters(array,parameters){\n\narray.push(parameters.precision);\narray.push(parameters.outputEncoding);\narray.push(parameters.envMapMode);\narray.push(parameters.envMapCubeUVHeight);\narray.push(parameters.combine);\narray.push(parameters.vertexUvs);\narray.push(parameters.fogExp2);\narray.push(parameters.sizeAttenuation);\narray.push(parameters.morphTargetsCount);\narray.push(parameters.morphAttributeCount);\narray.push(parameters.numDirLights);\narray.push(parameters.numPointLights);\narray.push(parameters.numSpotLights);\narray.push(parameters.numHemiLights);\narray.push(parameters.numRectAreaLights);\narray.push(parameters.numDirLightShadows);\narray.push(parameters.numPointLightShadows);\narray.push(parameters.numSpotLightShadows);\narray.push(parameters.shadowMapType);\narray.push(parameters.toneMapping);\narray.push(parameters.numClippingPlanes);\narray.push(parameters.numClipIntersection);\narray.push(parameters.depthPacking);\n\n}\n\nfunction getProgramCacheKeyBooleans(array,parameters){\n\n_programLayers.disableAll();\n\nif(parameters.isWebGL2)\n_programLayers.enable(0);\nif(parameters.supportsVertexTextures)\n_programLayers.enable(1);\nif(parameters.instancing)\n_programLayers.enable(2);\nif(parameters.instancingColor)\n_programLayers.enable(3);\nif(parameters.map)\n_programLayers.enable(4);\nif(parameters.matcap)\n_programLayers.enable(5);\nif(parameters.envMap)\n_programLayers.enable(6);\nif(parameters.lightMap)\n_programLayers.enable(7);\nif(parameters.aoMap)\n_programLayers.enable(8);\nif(parameters.emissiveMap)\n_programLayers.enable(9);\nif(parameters.bumpMap)\n_programLayers.enable(10);\nif(parameters.normalMap)\n_programLayers.enable(11);\nif(parameters.objectSpaceNormalMap)\n_programLayers.enable(12);\nif(parameters.tangentSpaceNormalMap)\n_programLayers.enable(13);\nif(parameters.clearcoat)\n_programLayers.enable(14);\nif(parameters.clearcoatMap)\n_programLayers.enable(15);\nif(parameters.clearcoatRoughnessMap)\n_programLayers.enable(16);\nif(parameters.clearcoatNormalMap)\n_programLayers.enable(17);\nif(parameters.iridescence)\n_programLayers.enable(18);\nif(parameters.iridescenceMap)\n_programLayers.enable(19);\nif(parameters.iridescenceThicknessMap)\n_programLayers.enable(20);\nif(parameters.displacementMap)\n_programLayers.enable(21);\nif(parameters.specularMap)\n_programLayers.enable(22);\nif(parameters.roughnessMap)\n_programLayers.enable(23);\nif(parameters.metalnessMap)\n_programLayers.enable(24);\nif(parameters.gradientMap)\n_programLayers.enable(25);\nif(parameters.alphaMap)\n_programLayers.enable(26);\nif(parameters.alphaTest)\n_programLayers.enable(27);\nif(parameters.vertexColors)\n_programLayers.enable(28);\nif(parameters.vertexAlphas)\n_programLayers.enable(29);\nif(parameters.vertexUvs)\n_programLayers.enable(30);\nif(parameters.vertexTangents)\n_programLayers.enable(31);\nif(parameters.uvsVertexOnly)\n_programLayers.enable(32);\nif(parameters.fog)\n_programLayers.enable(33);\n\narray.push(_programLayers.mask);\n_programLayers.disableAll();\n\nif(parameters.useFog)\n_programLayers.enable(0);\nif(parameters.flatShading)\n_programLayers.enable(1);\nif(parameters.logarithmicDepthBuffer)\n_programLayers.enable(2);\nif(parameters.skinning)\n_programLayers.enable(3);\nif(parameters.morphTargets)\n_programLayers.enable(4);\nif(parameters.morphNormals)\n_programLayers.enable(5);\nif(parameters.morphColors)\n_programLayers.enable(6);\nif(parameters.premultipliedAlpha)\n_programLayers.enable(7);\nif(parameters.shadowMapEnabled)\n_programLayers.enable(8);\nif(parameters.physicallyCorrectLights)\n_programLayers.enable(9);\nif(parameters.doubleSided)\n_programLayers.enable(10);\nif(parameters.flipSided)\n_programLayers.enable(11);\nif(parameters.useDepthPacking)\n_programLayers.enable(12);\nif(parameters.dithering)\n_programLayers.enable(13);\nif(parameters.specularIntensityMap)\n_programLayers.enable(14);\nif(parameters.specularColorMap)\n_programLayers.enable(15);\nif(parameters.transmission)\n_programLayers.enable(16);\nif(parameters.transmissionMap)\n_programLayers.enable(17);\nif(parameters.thicknessMap)\n_programLayers.enable(18);\nif(parameters.sheen)\n_programLayers.enable(19);\nif(parameters.sheenColorMap)\n_programLayers.enable(20);\nif(parameters.sheenRoughnessMap)\n_programLayers.enable(21);\nif(parameters.decodeVideoTexture)\n_programLayers.enable(22);\nif(parameters.opaque)\n_programLayers.enable(23);\n\narray.push(_programLayers.mask);\n\n}\n\nfunction getUniforms(material){\n\nvar shaderID=shaderIDs[material.type];\nvar uniforms=void 0;\n\nif(shaderID){\n\nvar shader=ShaderLib[shaderID];\nuniforms=UniformsUtils.clone(shader.uniforms);\n\n}else{\n\nuniforms=material.uniforms;\n\n}\n\nreturn uniforms;\n\n}\n\nfunction acquireProgram(parameters,cacheKey){\n\nvar program=void 0;\n\n// Check if code has been already compiled\nfor(var p=0,pl=programs.length;p<pl;p++){\n\nvar preexistingProgram=programs[p];\n\nif(preexistingProgram.cacheKey===cacheKey){\n\nprogram=preexistingProgram;\n++program.usedTimes;\n\nbreak;\n\n}\n\n}\n\nif(program===undefined){\n\nprogram=new WebGLProgram(renderer,cacheKey,parameters,bindingStates);\nprograms.push(program);\n\n}\n\nreturn program;\n\n}\n\nfunction releaseProgram(program){\n\nif(--program.usedTimes===0){\n\n// Remove from unordered set\nvar i=programs.indexOf(program);\nprograms[i]=programs[programs.length-1];\nprograms.pop();\n\n// Free WebGL resources\nprogram.destroy();\n\n}\n\n}\n\nfunction releaseShaderCache(material){\n\n_customShaders.remove(material);\n\n}\n\nfunction dispose(){\n\n_customShaders.dispose();\n\n}\n\nreturn{\ngetParameters:getParameters,\ngetProgramCacheKey:getProgramCacheKey,\ngetUniforms:getUniforms,\nacquireProgram:acquireProgram,\nreleaseProgram:releaseProgram,\nreleaseShaderCache:releaseShaderCache,\n// Exposed for resource monitoring & error feedback via renderer.info:\nprograms:programs,\ndispose:dispose};\n\n\n}\n\nfunction WebGLProperties(){\n\nvar properties=new WeakMap();\n\nfunction get(object){\n\nvar map=properties.get(object);\n\nif(map===undefined){\n\nmap={};\nproperties.set(object,map);\n\n}\n\nreturn map;\n\n}\n\nfunction remove(object){\n\nproperties.delete(object);\n\n}\n\nfunction update(object,key,value){\n\nproperties.get(object)[key]=value;\n\n}\n\nfunction dispose(){\n\nproperties=new WeakMap();\n\n}\n\nreturn{\nget:get,\nremove:remove,\nupdate:update,\ndispose:dispose};\n\n\n}\n\nfunction painterSortStable(a,b){\n\nif(a.groupOrder!==b.groupOrder){\n\nreturn a.groupOrder-b.groupOrder;\n\n}else if(a.renderOrder!==b.renderOrder){\n\nreturn a.renderOrder-b.renderOrder;\n\n}else if(a.material.id!==b.material.id){\n\nreturn a.material.id-b.material.id;\n\n}else if(a.z!==b.z){\n\nreturn a.z-b.z;\n\n}else{\n\nreturn a.id-b.id;\n\n}\n\n}\n\nfunction reversePainterSortStable(a,b){\n\nif(a.groupOrder!==b.groupOrder){\n\nreturn a.groupOrder-b.groupOrder;\n\n}else if(a.renderOrder!==b.renderOrder){\n\nreturn a.renderOrder-b.renderOrder;\n\n}else if(a.z!==b.z){\n\nreturn b.z-a.z;\n\n}else{\n\nreturn a.id-b.id;\n\n}\n\n}\n\n\nfunction WebGLRenderList(){\n\nvar renderItems=[];\nvar renderItemsIndex=0;\n\nvar opaque=[];\nvar transmissive=[];\nvar transparent=[];\n\nfunction init(){\n\nrenderItemsIndex=0;\n\nopaque.length=0;\ntransmissive.length=0;\ntransparent.length=0;\n\n}\n\nfunction getNextRenderItem(object,geometry,material,groupOrder,z,group){\n\nvar renderItem=renderItems[renderItemsIndex];\n\nif(renderItem===undefined){\n\nrenderItem={\nid:object.id,\nobject:object,\ngeometry:geometry,\nmaterial:material,\ngroupOrder:groupOrder,\nrenderOrder:object.renderOrder,\nz:z,\ngroup:group};\n\n\nrenderItems[renderItemsIndex]=renderItem;\n\n}else{\n\nrenderItem.id=object.id;\nrenderItem.object=object;\nrenderItem.geometry=geometry;\nrenderItem.material=material;\nrenderItem.groupOrder=groupOrder;\nrenderItem.renderOrder=object.renderOrder;\nrenderItem.z=z;\nrenderItem.group=group;\n\n}\n\nrenderItemsIndex++;\n\nreturn renderItem;\n\n}\n\nfunction push(object,geometry,material,groupOrder,z,group){\n\nvar renderItem=getNextRenderItem(object,geometry,material,groupOrder,z,group);\n\nif(material.transmission>0.0){\n\ntransmissive.push(renderItem);\n\n}else if(material.transparent===true){\n\ntransparent.push(renderItem);\n\n}else{\n\nopaque.push(renderItem);\n\n}\n\n}\n\nfunction unshift(object,geometry,material,groupOrder,z,group){\n\nvar renderItem=getNextRenderItem(object,geometry,material,groupOrder,z,group);\n\nif(material.transmission>0.0){\n\ntransmissive.unshift(renderItem);\n\n}else if(material.transparent===true){\n\ntransparent.unshift(renderItem);\n\n}else{\n\nopaque.unshift(renderItem);\n\n}\n\n}\n\nfunction sort(customOpaqueSort,customTransparentSort){\n\nif(opaque.length>1)opaque.sort(customOpaqueSort||painterSortStable);\nif(transmissive.length>1)transmissive.sort(customTransparentSort||reversePainterSortStable);\nif(transparent.length>1)transparent.sort(customTransparentSort||reversePainterSortStable);\n\n}\n\nfunction finish(){\n\n// Clear references from inactive renderItems in the list\n\nfor(var i=renderItemsIndex,il=renderItems.length;i<il;i++){\n\nvar renderItem=renderItems[i];\n\nif(renderItem.id===null)break;\n\nrenderItem.id=null;\nrenderItem.object=null;\nrenderItem.geometry=null;\nrenderItem.material=null;\nrenderItem.group=null;\n\n}\n\n}\n\nreturn{\n\nopaque:opaque,\ntransmissive:transmissive,\ntransparent:transparent,\n\ninit:init,\npush:push,\nunshift:unshift,\nfinish:finish,\n\nsort:sort};\n\n\n}\n\nfunction WebGLRenderLists(){\n\nvar lists=new WeakMap();\n\nfunction get(scene,renderCallDepth){\n\nvar list=void 0;\n\nif(lists.has(scene)===false){\n\nlist=new WebGLRenderList();\nlists.set(scene,[list]);\n\n}else{\n\nif(renderCallDepth>=lists.get(scene).length){\n\nlist=new WebGLRenderList();\nlists.get(scene).push(list);\n\n}else{\n\nlist=lists.get(scene)[renderCallDepth];\n\n}\n\n}\n\nreturn list;\n\n}\n\nfunction dispose(){\n\nlists=new WeakMap();\n\n}\n\nreturn{\nget:get,\ndispose:dispose};\n\n\n}\n\nfunction UniformsCache(){\n\nvar lights={};\n\nreturn{\n\nget:function get(light){\n\nif(lights[light.id]!==undefined){\n\nreturn lights[light.id];\n\n}\n\nvar uniforms=void 0;\n\nswitch(light.type){\n\ncase'DirectionalLight':\nuniforms={\ndirection:new Vector3(),\ncolor:new Color()};\n\nbreak;\n\ncase'SpotLight':\nuniforms={\nposition:new Vector3(),\ndirection:new Vector3(),\ncolor:new Color(),\ndistance:0,\nconeCos:0,\npenumbraCos:0,\ndecay:0};\n\nbreak;\n\ncase'PointLight':\nuniforms={\nposition:new Vector3(),\ncolor:new Color(),\ndistance:0,\ndecay:0};\n\nbreak;\n\ncase'HemisphereLight':\nuniforms={\ndirection:new Vector3(),\nskyColor:new Color(),\ngroundColor:new Color()};\n\nbreak;\n\ncase'RectAreaLight':\nuniforms={\ncolor:new Color(),\nposition:new Vector3(),\nhalfWidth:new Vector3(),\nhalfHeight:new Vector3()};\n\nbreak;}\n\n\n\nlights[light.id]=uniforms;\n\nreturn uniforms;\n\n}};\n\n\n\n}\n\nfunction ShadowUniformsCache(){\n\nvar lights={};\n\nreturn{\n\nget:function get(light){\n\nif(lights[light.id]!==undefined){\n\nreturn lights[light.id];\n\n}\n\nvar uniforms=void 0;\n\nswitch(light.type){\n\ncase'DirectionalLight':\nuniforms={\nshadowBias:0,\nshadowNormalBias:0,\nshadowRadius:1,\nshadowMapSize:new Vector2()};\n\nbreak;\n\ncase'SpotLight':\nuniforms={\nshadowBias:0,\nshadowNormalBias:0,\nshadowRadius:1,\nshadowMapSize:new Vector2()};\n\nbreak;\n\ncase'PointLight':\nuniforms={\nshadowBias:0,\nshadowNormalBias:0,\nshadowRadius:1,\nshadowMapSize:new Vector2(),\nshadowCameraNear:1,\nshadowCameraFar:1000};\n\nbreak;\n\n// TODO (abelnation): set RectAreaLight shadow uniforms\n}\n\n\nlights[light.id]=uniforms;\n\nreturn uniforms;\n\n}};\n\n\n\n}\n\n\n\nvar nextVersion=0;\n\nfunction shadowCastingLightsFirst(lightA,lightB){\n\nreturn(lightB.castShadow?1:0)-(lightA.castShadow?1:0);\n\n}\n\nfunction WebGLLights(extensions,capabilities){\n\nvar cache=new UniformsCache();\n\nvar shadowCache=ShadowUniformsCache();\n\nvar state={\n\nversion:0,\n\nhash:{\ndirectionalLength:-1,\npointLength:-1,\nspotLength:-1,\nrectAreaLength:-1,\nhemiLength:-1,\n\nnumDirectionalShadows:-1,\nnumPointShadows:-1,\nnumSpotShadows:-1},\n\n\nambient:[0,0,0],\nprobe:[],\ndirectional:[],\ndirectionalShadow:[],\ndirectionalShadowMap:[],\ndirectionalShadowMatrix:[],\nspot:[],\nspotShadow:[],\nspotShadowMap:[],\nspotShadowMatrix:[],\nrectArea:[],\nrectAreaLTC1:null,\nrectAreaLTC2:null,\npoint:[],\npointShadow:[],\npointShadowMap:[],\npointShadowMatrix:[],\nhemi:[]};\n\n\n\nfor(var i=0;i<9;i++){state.probe.push(new Vector3());}\n\nvar vector3=new Vector3();\nvar matrix4=new Matrix4();\nvar matrix42=new Matrix4();\n\nfunction setup(lights,physicallyCorrectLights){\n\nvar r=0,g=0,b=0;\n\nfor(var _i31=0;_i31<9;_i31++){state.probe[_i31].set(0,0,0);}\n\nvar directionalLength=0;\nvar pointLength=0;\nvar spotLength=0;\nvar rectAreaLength=0;\nvar hemiLength=0;\n\nvar numDirectionalShadows=0;\nvar numPointShadows=0;\nvar numSpotShadows=0;\n\nlights.sort(shadowCastingLightsFirst);\n\n// artist-friendly light intensity scaling factor\nvar scaleFactor=physicallyCorrectLights!==true?Math.PI:1;\n\nfor(var _i32=0,l=lights.length;_i32<l;_i32++){\n\nvar light=lights[_i32];\n\nvar color=light.color;\nvar intensity=light.intensity;\nvar distance=light.distance;\n\nvar shadowMap=light.shadow&&light.shadow.map?light.shadow.map.texture:null;\n\nif(light.isAmbientLight){\n\nr+=color.r*intensity*scaleFactor;\ng+=color.g*intensity*scaleFactor;\nb+=color.b*intensity*scaleFactor;\n\n}else if(light.isLightProbe){\n\nfor(var j=0;j<9;j++){\n\nstate.probe[j].addScaledVector(light.sh.coefficients[j],intensity);\n\n}\n\n}else if(light.isDirectionalLight){\n\nvar uniforms=cache.get(light);\n\nuniforms.color.copy(light.color).multiplyScalar(light.intensity*scaleFactor);\n\nif(light.castShadow){\n\nvar shadow=light.shadow;\n\nvar shadowUniforms=shadowCache.get(light);\n\nshadowUniforms.shadowBias=shadow.bias;\nshadowUniforms.shadowNormalBias=shadow.normalBias;\nshadowUniforms.shadowRadius=shadow.radius;\nshadowUniforms.shadowMapSize=shadow.mapSize;\n\nstate.directionalShadow[directionalLength]=shadowUniforms;\nstate.directionalShadowMap[directionalLength]=shadowMap;\nstate.directionalShadowMatrix[directionalLength]=light.shadow.matrix;\n\nnumDirectionalShadows++;\n\n}\n\nstate.directional[directionalLength]=uniforms;\n\ndirectionalLength++;\n\n}else if(light.isSpotLight){\n\nvar _uniforms=cache.get(light);\n\n_uniforms.position.setFromMatrixPosition(light.matrixWorld);\n\n_uniforms.color.copy(color).multiplyScalar(intensity*scaleFactor);\n_uniforms.distance=distance;\n\n_uniforms.coneCos=Math.cos(light.angle);\n_uniforms.penumbraCos=Math.cos(light.angle*(1-light.penumbra));\n_uniforms.decay=light.decay;\n\nif(light.castShadow){\n\nvar _shadow=light.shadow;\n\nvar _shadowUniforms=shadowCache.get(light);\n\n_shadowUniforms.shadowBias=_shadow.bias;\n_shadowUniforms.shadowNormalBias=_shadow.normalBias;\n_shadowUniforms.shadowRadius=_shadow.radius;\n_shadowUniforms.shadowMapSize=_shadow.mapSize;\n\nstate.spotShadow[spotLength]=_shadowUniforms;\nstate.spotShadowMap[spotLength]=shadowMap;\nstate.spotShadowMatrix[spotLength]=light.shadow.matrix;\n\nnumSpotShadows++;\n\n}\n\nstate.spot[spotLength]=_uniforms;\n\nspotLength++;\n\n}else if(light.isRectAreaLight){\n\nvar _uniforms2=cache.get(light);\n\n// (a) intensity is the total visible light emitted\n//uniforms.color.copy( color ).multiplyScalar( intensity / ( light.width * light.height * Math.PI ) );\n\n// (b) intensity is the brightness of the light\n_uniforms2.color.copy(color).multiplyScalar(intensity);\n\n_uniforms2.halfWidth.set(light.width*0.5,0.0,0.0);\n_uniforms2.halfHeight.set(0.0,light.height*0.5,0.0);\n\nstate.rectArea[rectAreaLength]=_uniforms2;\n\nrectAreaLength++;\n\n}else if(light.isPointLight){\n\nvar _uniforms3=cache.get(light);\n\n_uniforms3.color.copy(light.color).multiplyScalar(light.intensity*scaleFactor);\n_uniforms3.distance=light.distance;\n_uniforms3.decay=light.decay;\n\nif(light.castShadow){\n\nvar _shadow2=light.shadow;\n\nvar _shadowUniforms2=shadowCache.get(light);\n\n_shadowUniforms2.shadowBias=_shadow2.bias;\n_shadowUniforms2.shadowNormalBias=_shadow2.normalBias;\n_shadowUniforms2.shadowRadius=_shadow2.radius;\n_shadowUniforms2.shadowMapSize=_shadow2.mapSize;\n_shadowUniforms2.shadowCameraNear=_shadow2.camera.near;\n_shadowUniforms2.shadowCameraFar=_shadow2.camera.far;\n\nstate.pointShadow[pointLength]=_shadowUniforms2;\nstate.pointShadowMap[pointLength]=shadowMap;\nstate.pointShadowMatrix[pointLength]=light.shadow.matrix;\n\nnumPointShadows++;\n\n}\n\nstate.point[pointLength]=_uniforms3;\n\npointLength++;\n\n}else if(light.isHemisphereLight){\n\nvar _uniforms4=cache.get(light);\n\n_uniforms4.skyColor.copy(light.color).multiplyScalar(intensity*scaleFactor);\n_uniforms4.groundColor.copy(light.groundColor).multiplyScalar(intensity*scaleFactor);\n\nstate.hemi[hemiLength]=_uniforms4;\n\nhemiLength++;\n\n}\n\n}\n\nif(rectAreaLength>0){\n\nif(capabilities.isWebGL2){\n\n// WebGL 2\n\nstate.rectAreaLTC1=UniformsLib.LTC_FLOAT_1;\nstate.rectAreaLTC2=UniformsLib.LTC_FLOAT_2;\n\n}else{\n\n// WebGL 1\n\nif(extensions.has('OES_texture_float_linear')===true){\n\nstate.rectAreaLTC1=UniformsLib.LTC_FLOAT_1;\nstate.rectAreaLTC2=UniformsLib.LTC_FLOAT_2;\n\n}else if(extensions.has('OES_texture_half_float_linear')===true){\n\nstate.rectAreaLTC1=UniformsLib.LTC_HALF_1;\nstate.rectAreaLTC2=UniformsLib.LTC_HALF_2;\n\n}else{\n\nconsole.error('THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.');\n\n}\n\n}\n\n}\n\nstate.ambient[0]=r;\nstate.ambient[1]=g;\nstate.ambient[2]=b;\n\nvar hash=state.hash;\n\nif(hash.directionalLength!==directionalLength||\nhash.pointLength!==pointLength||\nhash.spotLength!==spotLength||\nhash.rectAreaLength!==rectAreaLength||\nhash.hemiLength!==hemiLength||\nhash.numDirectionalShadows!==numDirectionalShadows||\nhash.numPointShadows!==numPointShadows||\nhash.numSpotShadows!==numSpotShadows){\n\nstate.directional.length=directionalLength;\nstate.spot.length=spotLength;\nstate.rectArea.length=rectAreaLength;\nstate.point.length=pointLength;\nstate.hemi.length=hemiLength;\n\nstate.directionalShadow.length=numDirectionalShadows;\nstate.directionalShadowMap.length=numDirectionalShadows;\nstate.pointShadow.length=numPointShadows;\nstate.pointShadowMap.length=numPointShadows;\nstate.spotShadow.length=numSpotShadows;\nstate.spotShadowMap.length=numSpotShadows;\nstate.directionalShadowMatrix.length=numDirectionalShadows;\nstate.pointShadowMatrix.length=numPointShadows;\nstate.spotShadowMatrix.length=numSpotShadows;\n\nhash.directionalLength=directionalLength;\nhash.pointLength=pointLength;\nhash.spotLength=spotLength;\nhash.rectAreaLength=rectAreaLength;\nhash.hemiLength=hemiLength;\n\nhash.numDirectionalShadows=numDirectionalShadows;\nhash.numPointShadows=numPointShadows;\nhash.numSpotShadows=numSpotShadows;\n\nstate.version=nextVersion++;\n\n}\n\n}\n\nfunction setupView(lights,camera){\n\nvar directionalLength=0;\nvar pointLength=0;\nvar spotLength=0;\nvar rectAreaLength=0;\nvar hemiLength=0;\n\nvar viewMatrix=camera.matrixWorldInverse;\n\nfor(var _i33=0,l=lights.length;_i33<l;_i33++){\n\nvar light=lights[_i33];\n\nif(light.isDirectionalLight){\n\nvar uniforms=state.directional[directionalLength];\n\nuniforms.direction.setFromMatrixPosition(light.matrixWorld);\nvector3.setFromMatrixPosition(light.target.matrixWorld);\nuniforms.direction.sub(vector3);\nuniforms.direction.transformDirection(viewMatrix);\n\ndirectionalLength++;\n\n}else if(light.isSpotLight){\n\nvar _uniforms5=state.spot[spotLength];\n\n_uniforms5.position.setFromMatrixPosition(light.matrixWorld);\n_uniforms5.position.applyMatrix4(viewMatrix);\n\n_uniforms5.direction.setFromMatrixPosition(light.matrixWorld);\nvector3.setFromMatrixPosition(light.target.matrixWorld);\n_uniforms5.direction.sub(vector3);\n_uniforms5.direction.transformDirection(viewMatrix);\n\nspotLength++;\n\n}else if(light.isRectAreaLight){\n\nvar _uniforms6=state.rectArea[rectAreaLength];\n\n_uniforms6.position.setFromMatrixPosition(light.matrixWorld);\n_uniforms6.position.applyMatrix4(viewMatrix);\n\n// extract local rotation of light to derive width/height half vectors\nmatrix42.identity();\nmatrix4.copy(light.matrixWorld);\nmatrix4.premultiply(viewMatrix);\nmatrix42.extractRotation(matrix4);\n\n_uniforms6.halfWidth.set(light.width*0.5,0.0,0.0);\n_uniforms6.halfHeight.set(0.0,light.height*0.5,0.0);\n\n_uniforms6.halfWidth.applyMatrix4(matrix42);\n_uniforms6.halfHeight.applyMatrix4(matrix42);\n\nrectAreaLength++;\n\n}else if(light.isPointLight){\n\nvar _uniforms7=state.point[pointLength];\n\n_uniforms7.position.setFromMatrixPosition(light.matrixWorld);\n_uniforms7.position.applyMatrix4(viewMatrix);\n\npointLength++;\n\n}else if(light.isHemisphereLight){\n\nvar _uniforms8=state.hemi[hemiLength];\n\n_uniforms8.direction.setFromMatrixPosition(light.matrixWorld);\n_uniforms8.direction.transformDirection(viewMatrix);\n\nhemiLength++;\n\n}\n\n}\n\n}\n\nreturn{\nsetup:setup,\nsetupView:setupView,\nstate:state};\n\n\n}\n\nfunction WebGLRenderState(extensions,capabilities){\n\nvar lights=new WebGLLights(extensions,capabilities);\n\nvar lightsArray=[];\nvar shadowsArray=[];\n\nfunction init(){\n\nlightsArray.length=0;\nshadowsArray.length=0;\n\n}\n\nfunction pushLight(light){\n\nlightsArray.push(light);\n\n}\n\nfunction pushShadow(shadowLight){\n\nshadowsArray.push(shadowLight);\n\n}\n\nfunction setupLights(physicallyCorrectLights){\n\nlights.setup(lightsArray,physicallyCorrectLights);\n\n}\n\nfunction setupLightsView(camera){\n\nlights.setupView(lightsArray,camera);\n\n}\n\nvar state={\nlightsArray:lightsArray,\nshadowsArray:shadowsArray,\n\nlights:lights};\n\n\nreturn{\ninit:init,\nstate:state,\nsetupLights:setupLights,\nsetupLightsView:setupLightsView,\n\npushLight:pushLight,\npushShadow:pushShadow};\n\n\n}\n\nfunction WebGLRenderStates(extensions,capabilities){\n\nvar renderStates=new WeakMap();\n\nfunction get(scene){var renderCallDepth=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;\n\nvar renderState=void 0;\n\nif(renderStates.has(scene)===false){\n\nrenderState=new WebGLRenderState(extensions,capabilities);\nrenderStates.set(scene,[renderState]);\n\n}else{\n\nif(renderCallDepth>=renderStates.get(scene).length){\n\nrenderState=new WebGLRenderState(extensions,capabilities);\nrenderStates.get(scene).push(renderState);\n\n}else{\n\nrenderState=renderStates.get(scene)[renderCallDepth];\n\n}\n\n}\n\nreturn renderState;\n\n}\n\nfunction dispose(){\n\nrenderStates=new WeakMap();\n\n}\n\nreturn{\nget:get,\ndispose:dispose};\n\n\n}var\n\nMeshDepthMaterial=function(_Material3){_inherits(MeshDepthMaterial,_Material3);\n\nfunction MeshDepthMaterial(parameters){_classCallCheck(this,MeshDepthMaterial);var _this33=_possibleConstructorReturn(this,(MeshDepthMaterial.__proto__||Object.getPrototypeOf(MeshDepthMaterial)).call(this));\n\n\n\n_this33.isMeshDepthMaterial=true;\n\n_this33.type='MeshDepthMaterial';\n\n_this33.depthPacking=BasicDepthPacking;\n\n_this33.map=null;\n\n_this33.alphaMap=null;\n\n_this33.displacementMap=null;\n_this33.displacementScale=1;\n_this33.displacementBias=0;\n\n_this33.wireframe=false;\n_this33.wireframeLinewidth=1;\n\n_this33.setValues(parameters);return _this33;\n\n}_createClass(MeshDepthMaterial,[{key:'copy',value:function copy(\n\nsource){\n\n_get(MeshDepthMaterial.prototype.__proto__||Object.getPrototypeOf(MeshDepthMaterial.prototype),'copy',this).call(this,source);\n\nthis.depthPacking=source.depthPacking;\n\nthis.map=source.map;\n\nthis.alphaMap=source.alphaMap;\n\nthis.displacementMap=source.displacementMap;\nthis.displacementScale=source.displacementScale;\nthis.displacementBias=source.displacementBias;\n\nthis.wireframe=source.wireframe;\nthis.wireframeLinewidth=source.wireframeLinewidth;\n\nreturn this;\n\n}}]);return MeshDepthMaterial;}(Material);var\n\n\n\nMeshDistanceMaterial=function(_Material4){_inherits(MeshDistanceMaterial,_Material4);\n\nfunction MeshDistanceMaterial(parameters){_classCallCheck(this,MeshDistanceMaterial);var _this34=_possibleConstructorReturn(this,(MeshDistanceMaterial.__proto__||Object.getPrototypeOf(MeshDistanceMaterial)).call(this));\n\n\n\n_this34.isMeshDistanceMaterial=true;\n\n_this34.type='MeshDistanceMaterial';\n\n_this34.referencePosition=new Vector3();\n_this34.nearDistance=1;\n_this34.farDistance=1000;\n\n_this34.map=null;\n\n_this34.alphaMap=null;\n\n_this34.displacementMap=null;\n_this34.displacementScale=1;\n_this34.displacementBias=0;\n\n_this34.setValues(parameters);return _this34;\n\n}_createClass(MeshDistanceMaterial,[{key:'copy',value:function copy(\n\nsource){\n\n_get(MeshDistanceMaterial.prototype.__proto__||Object.getPrototypeOf(MeshDistanceMaterial.prototype),'copy',this).call(this,source);\n\nthis.referencePosition.copy(source.referencePosition);\nthis.nearDistance=source.nearDistance;\nthis.farDistance=source.farDistance;\n\nthis.map=source.map;\n\nthis.alphaMap=source.alphaMap;\n\nthis.displacementMap=source.displacementMap;\nthis.displacementScale=source.displacementScale;\nthis.displacementBias=source.displacementBias;\n\nreturn this;\n\n}}]);return MeshDistanceMaterial;}(Material);\n\n\n\nvar vertex=\"void main() {\\n\\tgl_Position = vec4( position, 1.0 );\\n}\";\n\nvar fragment=\"uniform sampler2D shadow_pass;\\nuniform vec2 resolution;\\nuniform float radius;\\n#include <packing>\\nvoid main() {\\n\\tconst float samples = float( VSM_SAMPLES );\\n\\tfloat mean = 0.0;\\n\\tfloat squared_mean = 0.0;\\n\\tfloat uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );\\n\\tfloat uvStart = samples <= 1.0 ? 0.0 : - 1.0;\\n\\tfor ( float i = 0.0; i < samples; i ++ ) {\\n\\t\\tfloat uvOffset = uvStart + i * uvStride;\\n\\t\\t#ifdef HORIZONTAL_PASS\\n\\t\\t\\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );\\n\\t\\t\\tmean += distribution.x;\\n\\t\\t\\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\\n\\t\\t#else\\n\\t\\t\\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );\\n\\t\\t\\tmean += depth;\\n\\t\\t\\tsquared_mean += depth * depth;\\n\\t\\t#endif\\n\\t}\\n\\tmean = mean / samples;\\n\\tsquared_mean = squared_mean / samples;\\n\\tfloat std_dev = sqrt( squared_mean - mean * mean );\\n\\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\\n}\";\n\nfunction WebGLShadowMap(_renderer,_objects,_capabilities){\n\nvar _frustum=new Frustum();\n\nvar _shadowMapSize=new Vector2(),\n_viewportSize=new Vector2(),\n\n_viewport=new Vector4(),\n\n_depthMaterial=new MeshDepthMaterial({depthPacking:RGBADepthPacking}),\n_distanceMaterial=new MeshDistanceMaterial(),\n\n_materialCache={},\n\n_maxTextureSize=_capabilities.maxTextureSize;\n\nvar shadowSide={0:BackSide,1:FrontSide,2:DoubleSide};\n\nvar shadowMaterialVertical=new ShaderMaterial({\ndefines:{\nVSM_SAMPLES:8},\n\nuniforms:{\nshadow_pass:{value:null},\nresolution:{value:new Vector2()},\nradius:{value:4.0}},\n\n\nvertexShader:vertex,\nfragmentShader:fragment});\n\n\n\nvar shadowMaterialHorizontal=shadowMaterialVertical.clone();\nshadowMaterialHorizontal.defines.HORIZONTAL_PASS=1;\n\nvar fullScreenTri=new BufferGeometry();\nfullScreenTri.setAttribute(\n'position',\nnew BufferAttribute(\nnew Float32Array([-1,-1,0.5,3,-1,0.5,-1,3,0.5]),\n3));\n\n\n\nvar fullScreenMesh=new Mesh(fullScreenTri,shadowMaterialVertical);\n\nvar scope=this;\n\nthis.enabled=false;\n\nthis.autoUpdate=true;\nthis.needsUpdate=false;\n\nthis.type=PCFShadowMap;\n\nthis.render=function(lights,scene,camera){\n\nif(scope.enabled===false)return;\nif(scope.autoUpdate===false&&scope.needsUpdate===false)return;\n\nif(lights.length===0)return;\n\nvar currentRenderTarget=_renderer.getRenderTarget();\nvar activeCubeFace=_renderer.getActiveCubeFace();\nvar activeMipmapLevel=_renderer.getActiveMipmapLevel();\n\nvar _state=_renderer.state;\n\n// Set GL state for depth map.\n_state.setBlending(NoBlending);\n_state.buffers.color.setClear(1,1,1,1);\n_state.buffers.depth.setTest(true);\n_state.setScissorTest(false);\n\n// render depth map\n\nfor(var i=0,il=lights.length;i<il;i++){\n\nvar light=lights[i];\nvar shadow=light.shadow;\n\nif(shadow===undefined){\n\nconsole.warn('THREE.WebGLShadowMap:',light,'has no shadow.');\ncontinue;\n\n}\n\nif(shadow.autoUpdate===false&&shadow.needsUpdate===false)continue;\n\n_shadowMapSize.copy(shadow.mapSize);\n\nvar shadowFrameExtents=shadow.getFrameExtents();\n\n_shadowMapSize.multiply(shadowFrameExtents);\n\n_viewportSize.copy(shadow.mapSize);\n\nif(_shadowMapSize.x>_maxTextureSize||_shadowMapSize.y>_maxTextureSize){\n\nif(_shadowMapSize.x>_maxTextureSize){\n\n_viewportSize.x=Math.floor(_maxTextureSize/shadowFrameExtents.x);\n_shadowMapSize.x=_viewportSize.x*shadowFrameExtents.x;\nshadow.mapSize.x=_viewportSize.x;\n\n}\n\nif(_shadowMapSize.y>_maxTextureSize){\n\n_viewportSize.y=Math.floor(_maxTextureSize/shadowFrameExtents.y);\n_shadowMapSize.y=_viewportSize.y*shadowFrameExtents.y;\nshadow.mapSize.y=_viewportSize.y;\n\n}\n\n}\n\nif(shadow.map===null){\n\nvar pars=this.type!==VSMShadowMap?{minFilter:NearestFilter,magFilter:NearestFilter}:{};\n\nshadow.map=new WebGLRenderTarget(_shadowMapSize.x,_shadowMapSize.y,pars);\nshadow.map.texture.name=light.name+'.shadowMap';\n\nshadow.camera.updateProjectionMatrix();\n\n}\n\n_renderer.setRenderTarget(shadow.map);\n_renderer.clear();\n\nvar viewportCount=shadow.getViewportCount();\n\nfor(var vp=0;vp<viewportCount;vp++){\n\nvar viewport=shadow.getViewport(vp);\n\n_viewport.set(\n_viewportSize.x*viewport.x,\n_viewportSize.y*viewport.y,\n_viewportSize.x*viewport.z,\n_viewportSize.y*viewport.w);\n\n\n_state.viewport(_viewport);\n\nshadow.updateMatrices(light,vp);\n\n_frustum=shadow.getFrustum();\n\nrenderObject(scene,camera,shadow.camera,light,this.type);\n\n}\n\n// do blur pass for VSM\n\nif(shadow.isPointLightShadow!==true&&this.type===VSMShadowMap){\n\nVSMPass(shadow,camera);\n\n}\n\nshadow.needsUpdate=false;\n\n}\n\nscope.needsUpdate=false;\n\n_renderer.setRenderTarget(currentRenderTarget,activeCubeFace,activeMipmapLevel);\n\n};\n\nfunction VSMPass(shadow,camera){\n\nvar geometry=_objects.update(fullScreenMesh);\n\nif(shadowMaterialVertical.defines.VSM_SAMPLES!==shadow.blurSamples){\n\nshadowMaterialVertical.defines.VSM_SAMPLES=shadow.blurSamples;\nshadowMaterialHorizontal.defines.VSM_SAMPLES=shadow.blurSamples;\n\nshadowMaterialVertical.needsUpdate=true;\nshadowMaterialHorizontal.needsUpdate=true;\n\n}\n\nif(shadow.mapPass===null){\n\nshadow.mapPass=new WebGLRenderTarget(_shadowMapSize.x,_shadowMapSize.y);\n\n}\n\n// vertical pass\n\nshadowMaterialVertical.uniforms.shadow_pass.value=shadow.map.texture;\nshadowMaterialVertical.uniforms.resolution.value=shadow.mapSize;\nshadowMaterialVertical.uniforms.radius.value=shadow.radius;\n_renderer.setRenderTarget(shadow.mapPass);\n_renderer.clear();\n_renderer.renderBufferDirect(camera,null,geometry,shadowMaterialVertical,fullScreenMesh,null);\n\n// horizontal pass\n\nshadowMaterialHorizontal.uniforms.shadow_pass.value=shadow.mapPass.texture;\nshadowMaterialHorizontal.uniforms.resolution.value=shadow.mapSize;\nshadowMaterialHorizontal.uniforms.radius.value=shadow.radius;\n_renderer.setRenderTarget(shadow.map);\n_renderer.clear();\n_renderer.renderBufferDirect(camera,null,geometry,shadowMaterialHorizontal,fullScreenMesh,null);\n\n}\n\nfunction getDepthMaterial(object,material,light,shadowCameraNear,shadowCameraFar,type){\n\nvar result=null;\n\nvar customMaterial=light.isPointLight===true?object.customDistanceMaterial:object.customDepthMaterial;\n\nif(customMaterial!==undefined){\n\nresult=customMaterial;\n\n}else{\n\nresult=light.isPointLight===true?_distanceMaterial:_depthMaterial;\n\n}\n\nif(_renderer.localClippingEnabled&&material.clipShadows===true&&Array.isArray(material.clippingPlanes)&&material.clippingPlanes.length!==0||\nmaterial.displacementMap&&material.displacementScale!==0||\nmaterial.alphaMap&&material.alphaTest>0){\n\n// in this case we need a unique material instance reflecting the\n// appropriate state\n\nvar keyA=result.uuid,keyB=material.uuid;\n\nvar materialsForVariant=_materialCache[keyA];\n\nif(materialsForVariant===undefined){\n\nmaterialsForVariant={};\n_materialCache[keyA]=materialsForVariant;\n\n}\n\nvar cachedMaterial=materialsForVariant[keyB];\n\nif(cachedMaterial===undefined){\n\ncachedMaterial=result.clone();\nmaterialsForVariant[keyB]=cachedMaterial;\n\n}\n\nresult=cachedMaterial;\n\n}\n\nresult.visible=material.visible;\nresult.wireframe=material.wireframe;\n\nif(type===VSMShadowMap){\n\nresult.side=material.shadowSide!==null?material.shadowSide:material.side;\n\n}else{\n\nresult.side=material.shadowSide!==null?material.shadowSide:shadowSide[material.side];\n\n}\n\nresult.alphaMap=material.alphaMap;\nresult.alphaTest=material.alphaTest;\n\nresult.clipShadows=material.clipShadows;\nresult.clippingPlanes=material.clippingPlanes;\nresult.clipIntersection=material.clipIntersection;\n\nresult.displacementMap=material.displacementMap;\nresult.displacementScale=material.displacementScale;\nresult.displacementBias=material.displacementBias;\n\nresult.wireframeLinewidth=material.wireframeLinewidth;\nresult.linewidth=material.linewidth;\n\nif(light.isPointLight===true&&result.isMeshDistanceMaterial===true){\n\nresult.referencePosition.setFromMatrixPosition(light.matrixWorld);\nresult.nearDistance=shadowCameraNear;\nresult.farDistance=shadowCameraFar;\n\n}\n\nreturn result;\n\n}\n\nfunction renderObject(object,camera,shadowCamera,light,type){\n\nif(object.visible===false)return;\n\nvar visible=object.layers.test(camera.layers);\n\nif(visible&&(object.isMesh||object.isLine||object.isPoints)){\n\nif((object.castShadow||object.receiveShadow&&type===VSMShadowMap)&&(!object.frustumCulled||_frustum.intersectsObject(object))){\n\nobject.modelViewMatrix.multiplyMatrices(shadowCamera.matrixWorldInverse,object.matrixWorld);\n\nvar geometry=_objects.update(object);\nvar material=object.material;\n\nif(Array.isArray(material)){\n\nvar groups=geometry.groups;\n\nfor(var k=0,kl=groups.length;k<kl;k++){\n\nvar group=groups[k];\nvar groupMaterial=material[group.materialIndex];\n\nif(groupMaterial&&groupMaterial.visible){\n\nvar depthMaterial=getDepthMaterial(object,groupMaterial,light,shadowCamera.near,shadowCamera.far,type);\n\n_renderer.renderBufferDirect(shadowCamera,null,geometry,depthMaterial,object,group);\n\n}\n\n}\n\n}else if(material.visible){\n\nvar _depthMaterial2=getDepthMaterial(object,material,light,shadowCamera.near,shadowCamera.far,type);\n\n_renderer.renderBufferDirect(shadowCamera,null,geometry,_depthMaterial2,object,null);\n\n}\n\n}\n\n}\n\nvar children=object.children;\n\nfor(var i=0,l=children.length;i<l;i++){\n\nrenderObject(children[i],camera,shadowCamera,light,type);\n\n}\n\n}\n\n}\n\nfunction WebGLState(gl,extensions,capabilities){var _equationToGL,_factorToGL;\n\nvar isWebGL2=capabilities.isWebGL2;\n\nfunction ColorBuffer(){\n\nvar locked=false;\n\nvar color=new Vector4();\nvar currentColorMask=null;\nvar currentColorClear=new Vector4(0,0,0,0);\n\nreturn{\n\nsetMask:function setMask(colorMask){\n\nif(currentColorMask!==colorMask&&!locked){\n\ngl.colorMask(colorMask,colorMask,colorMask,colorMask);\ncurrentColorMask=colorMask;\n\n}\n\n},\n\nsetLocked:function setLocked(lock){\n\nlocked=lock;\n\n},\n\nsetClear:function setClear(r,g,b,a,premultipliedAlpha){\n\nif(premultipliedAlpha===true){\n\nr*=a;g*=a;b*=a;\n\n}\n\ncolor.set(r,g,b,a);\n\nif(currentColorClear.equals(color)===false){\n\ngl.clearColor(r,g,b,a);\ncurrentColorClear.copy(color);\n\n}\n\n},\n\nreset:function reset(){\n\nlocked=false;\n\ncurrentColorMask=null;\ncurrentColorClear.set(-1,0,0,0);// set to invalid state\n\n}};\n\n\n\n}\n\nfunction DepthBuffer(){\n\nvar locked=false;\n\nvar currentDepthMask=null;\nvar currentDepthFunc=null;\nvar currentDepthClear=null;\n\nreturn{\n\nsetTest:function setTest(depthTest){\n\nif(depthTest){\n\nenable(2929);\n\n}else{\n\ndisable(2929);\n\n}\n\n},\n\nsetMask:function setMask(depthMask){\n\nif(currentDepthMask!==depthMask&&!locked){\n\ngl.depthMask(depthMask);\ncurrentDepthMask=depthMask;\n\n}\n\n},\n\nsetFunc:function setFunc(depthFunc){\n\nif(currentDepthFunc!==depthFunc){\n\nif(depthFunc){\n\nswitch(depthFunc){\n\ncase NeverDepth:\n\ngl.depthFunc(512);\nbreak;\n\ncase AlwaysDepth:\n\ngl.depthFunc(519);\nbreak;\n\ncase LessDepth:\n\ngl.depthFunc(513);\nbreak;\n\ncase LessEqualDepth:\n\ngl.depthFunc(515);\nbreak;\n\ncase EqualDepth:\n\ngl.depthFunc(514);\nbreak;\n\ncase GreaterEqualDepth:\n\ngl.depthFunc(518);\nbreak;\n\ncase GreaterDepth:\n\ngl.depthFunc(516);\nbreak;\n\ncase NotEqualDepth:\n\ngl.depthFunc(517);\nbreak;\n\ndefault:\n\ngl.depthFunc(515);}\n\n\n\n}else{\n\ngl.depthFunc(515);\n\n}\n\ncurrentDepthFunc=depthFunc;\n\n}\n\n},\n\nsetLocked:function setLocked(lock){\n\nlocked=lock;\n\n},\n\nsetClear:function setClear(depth){\n\nif(currentDepthClear!==depth){\n\ngl.clearDepth(depth);\ncurrentDepthClear=depth;\n\n}\n\n},\n\nreset:function reset(){\n\nlocked=false;\n\ncurrentDepthMask=null;\ncurrentDepthFunc=null;\ncurrentDepthClear=null;\n\n}};\n\n\n\n}\n\nfunction StencilBuffer(){\n\nvar locked=false;\n\nvar currentStencilMask=null;\nvar currentStencilFunc=null;\nvar currentStencilRef=null;\nvar currentStencilFuncMask=null;\nvar currentStencilFail=null;\nvar currentStencilZFail=null;\nvar currentStencilZPass=null;\nvar currentStencilClear=null;\n\nreturn{\n\nsetTest:function setTest(stencilTest){\n\nif(!locked){\n\nif(stencilTest){\n\nenable(2960);\n\n}else{\n\ndisable(2960);\n\n}\n\n}\n\n},\n\nsetMask:function setMask(stencilMask){\n\nif(currentStencilMask!==stencilMask&&!locked){\n\ngl.stencilMask(stencilMask);\ncurrentStencilMask=stencilMask;\n\n}\n\n},\n\nsetFunc:function setFunc(stencilFunc,stencilRef,stencilMask){\n\nif(currentStencilFunc!==stencilFunc||\ncurrentStencilRef!==stencilRef||\ncurrentStencilFuncMask!==stencilMask){\n\ngl.stencilFunc(stencilFunc,stencilRef,stencilMask);\n\ncurrentStencilFunc=stencilFunc;\ncurrentStencilRef=stencilRef;\ncurrentStencilFuncMask=stencilMask;\n\n}\n\n},\n\nsetOp:function setOp(stencilFail,stencilZFail,stencilZPass){\n\nif(currentStencilFail!==stencilFail||\ncurrentStencilZFail!==stencilZFail||\ncurrentStencilZPass!==stencilZPass){\n\ngl.stencilOp(stencilFail,stencilZFail,stencilZPass);\n\ncurrentStencilFail=stencilFail;\ncurrentStencilZFail=stencilZFail;\ncurrentStencilZPass=stencilZPass;\n\n}\n\n},\n\nsetLocked:function setLocked(lock){\n\nlocked=lock;\n\n},\n\nsetClear:function setClear(stencil){\n\nif(currentStencilClear!==stencil){\n\ngl.clearStencil(stencil);\ncurrentStencilClear=stencil;\n\n}\n\n},\n\nreset:function reset(){\n\nlocked=false;\n\ncurrentStencilMask=null;\ncurrentStencilFunc=null;\ncurrentStencilRef=null;\ncurrentStencilFuncMask=null;\ncurrentStencilFail=null;\ncurrentStencilZFail=null;\ncurrentStencilZPass=null;\ncurrentStencilClear=null;\n\n}};\n\n\n\n}\n\n//\n\nvar colorBuffer=new ColorBuffer();\nvar depthBuffer=new DepthBuffer();\nvar stencilBuffer=new StencilBuffer();\n\nvar enabledCapabilities={};\n\nvar currentBoundFramebuffers={};\nvar currentDrawbuffers=new WeakMap();\nvar defaultDrawbuffers=[];\n\nvar currentProgram=null;\n\nvar currentBlendingEnabled=false;\nvar currentBlending=null;\nvar currentBlendEquation=null;\nvar currentBlendSrc=null;\nvar currentBlendDst=null;\nvar currentBlendEquationAlpha=null;\nvar currentBlendSrcAlpha=null;\nvar currentBlendDstAlpha=null;\nvar currentPremultipledAlpha=false;\n\nvar currentFlipSided=null;\nvar currentCullFace=null;\n\nvar currentLineWidth=null;\n\nvar currentPolygonOffsetFactor=null;\nvar currentPolygonOffsetUnits=null;\n\nvar maxTextures=gl.getParameter(35661);\n\nvar lineWidthAvailable=false;\nvar version=0;\nvar glVersion=gl.getParameter(7938);\n\nif(glVersion.indexOf('WebGL')!==-1){\n\nversion=parseFloat(/^WebGL (\\d)/.exec(glVersion)[1]);\nlineWidthAvailable=version>=1.0;\n\n}else if(glVersion.indexOf('OpenGL ES')!==-1){\n\nversion=parseFloat(/^OpenGL ES (\\d)/.exec(glVersion)[1]);\nlineWidthAvailable=version>=2.0;\n\n}\n\nvar currentTextureSlot=null;\nvar currentBoundTextures={};\n\nvar scissorParam=gl.getParameter(3088);\nvar viewportParam=gl.getParameter(2978);\n\nvar currentScissor=new Vector4().fromArray(scissorParam);\nvar currentViewport=new Vector4().fromArray(viewportParam);\n\nfunction createTexture(type,target,count){\n\nvar data=new Uint8Array(4);// 4 is required to match default unpack alignment of 4.\nvar texture=gl.createTexture();\n\ngl.bindTexture(type,texture);\ngl.texParameteri(type,10241,9728);\ngl.texParameteri(type,10240,9728);\n\nfor(var i=0;i<count;i++){\n\ngl.texImage2D(target+i,0,6408,1,1,0,6408,5121,data);\n\n}\n\nreturn texture;\n\n}\n\nvar emptyTextures={};\nemptyTextures[3553]=createTexture(3553,3553,1);\nemptyTextures[34067]=createTexture(34067,34069,6);\n\n// init\n\ncolorBuffer.setClear(0,0,0,1);\ndepthBuffer.setClear(1);\nstencilBuffer.setClear(0);\n\nenable(2929);\ndepthBuffer.setFunc(LessEqualDepth);\n\nsetFlipSided(false);\nsetCullFace(CullFaceBack);\nenable(2884);\n\nsetBlending(NoBlending);\n\n//\n\nfunction enable(id){\n\nif(enabledCapabilities[id]!==true){\n\ngl.enable(id);\nenabledCapabilities[id]=true;\n\n}\n\n}\n\nfunction disable(id){\n\nif(enabledCapabilities[id]!==false){\n\ngl.disable(id);\nenabledCapabilities[id]=false;\n\n}\n\n}\n\nfunction bindFramebuffer(target,framebuffer){\n\nif(currentBoundFramebuffers[target]!==framebuffer){\n\ngl.bindFramebuffer(target,framebuffer);\n\ncurrentBoundFramebuffers[target]=framebuffer;\n\nif(isWebGL2){\n\n// 36009 is equivalent to 36160\n\nif(target===36009){\n\ncurrentBoundFramebuffers[36160]=framebuffer;\n\n}\n\nif(target===36160){\n\ncurrentBoundFramebuffers[36009]=framebuffer;\n\n}\n\n}\n\nreturn true;\n\n}\n\nreturn false;\n\n}\n\nfunction drawBuffers(renderTarget,framebuffer){\n\nvar drawBuffers=defaultDrawbuffers;\n\nvar needsUpdate=false;\n\nif(renderTarget){\n\ndrawBuffers=currentDrawbuffers.get(framebuffer);\n\nif(drawBuffers===undefined){\n\ndrawBuffers=[];\ncurrentDrawbuffers.set(framebuffer,drawBuffers);\n\n}\n\nif(renderTarget.isWebGLMultipleRenderTargets){\n\nvar textures=renderTarget.texture;\n\nif(drawBuffers.length!==textures.length||drawBuffers[0]!==36064){\n\nfor(var i=0,il=textures.length;i<il;i++){\n\ndrawBuffers[i]=36064+i;\n\n}\n\ndrawBuffers.length=textures.length;\n\nneedsUpdate=true;\n\n}\n\n}else{\n\nif(drawBuffers[0]!==36064){\n\ndrawBuffers[0]=36064;\n\nneedsUpdate=true;\n\n}\n\n}\n\n}else{\n\nif(drawBuffers[0]!==1029){\n\ndrawBuffers[0]=1029;\n\nneedsUpdate=true;\n\n}\n\n}\n\nif(needsUpdate){\n\nif(capabilities.isWebGL2){\n\ngl.drawBuffers(drawBuffers);\n\n}else{\n\nextensions.get('WEBGL_draw_buffers').drawBuffersWEBGL(drawBuffers);\n\n}\n\n}\n\n\n}\n\nfunction useProgram(program){\n\nif(currentProgram!==program){\n\ngl.useProgram(program);\n\ncurrentProgram=program;\n\nreturn true;\n\n}\n\nreturn false;\n\n}\n\nvar equationToGL=(_equationToGL={},_defineProperty(_equationToGL,\nAddEquation,32774),_defineProperty(_equationToGL,\nSubtractEquation,32778),_defineProperty(_equationToGL,\nReverseSubtractEquation,32779),_equationToGL);\n\n\nif(isWebGL2){\n\nequationToGL[MinEquation]=32775;\nequationToGL[MaxEquation]=32776;\n\n}else{\n\nvar extension=extensions.get('EXT_blend_minmax');\n\nif(extension!==null){\n\nequationToGL[MinEquation]=extension.MIN_EXT;\nequationToGL[MaxEquation]=extension.MAX_EXT;\n\n}\n\n}\n\nvar factorToGL=(_factorToGL={},_defineProperty(_factorToGL,\nZeroFactor,0),_defineProperty(_factorToGL,\nOneFactor,1),_defineProperty(_factorToGL,\nSrcColorFactor,768),_defineProperty(_factorToGL,\nSrcAlphaFactor,770),_defineProperty(_factorToGL,\nSrcAlphaSaturateFactor,776),_defineProperty(_factorToGL,\nDstColorFactor,774),_defineProperty(_factorToGL,\nDstAlphaFactor,772),_defineProperty(_factorToGL,\nOneMinusSrcColorFactor,769),_defineProperty(_factorToGL,\nOneMinusSrcAlphaFactor,771),_defineProperty(_factorToGL,\nOneMinusDstColorFactor,775),_defineProperty(_factorToGL,\nOneMinusDstAlphaFactor,773),_factorToGL);\n\n\nfunction setBlending(blending,blendEquation,blendSrc,blendDst,blendEquationAlpha,blendSrcAlpha,blendDstAlpha,premultipliedAlpha){\n\nif(blending===NoBlending){\n\nif(currentBlendingEnabled===true){\n\ndisable(3042);\ncurrentBlendingEnabled=false;\n\n}\n\nreturn;\n\n}\n\nif(currentBlendingEnabled===false){\n\nenable(3042);\ncurrentBlendingEnabled=true;\n\n}\n\nif(blending!==CustomBlending){\n\nif(blending!==currentBlending||premultipliedAlpha!==currentPremultipledAlpha){\n\nif(currentBlendEquation!==AddEquation||currentBlendEquationAlpha!==AddEquation){\n\ngl.blendEquation(32774);\n\ncurrentBlendEquation=AddEquation;\ncurrentBlendEquationAlpha=AddEquation;\n\n}\n\nif(premultipliedAlpha){\n\nswitch(blending){\n\ncase NormalBlending:\ngl.blendFuncSeparate(1,771,1,771);\nbreak;\n\ncase AdditiveBlending:\ngl.blendFunc(1,1);\nbreak;\n\ncase SubtractiveBlending:\ngl.blendFuncSeparate(0,769,0,1);\nbreak;\n\ncase MultiplyBlending:\ngl.blendFuncSeparate(0,768,0,770);\nbreak;\n\ndefault:\nconsole.error('THREE.WebGLState: Invalid blending: ',blending);\nbreak;}\n\n\n\n}else{\n\nswitch(blending){\n\ncase NormalBlending:\ngl.blendFuncSeparate(770,771,1,771);\nbreak;\n\ncase AdditiveBlending:\ngl.blendFunc(770,1);\nbreak;\n\ncase SubtractiveBlending:\ngl.blendFuncSeparate(0,769,0,1);\nbreak;\n\ncase MultiplyBlending:\ngl.blendFunc(0,768);\nbreak;\n\ndefault:\nconsole.error('THREE.WebGLState: Invalid blending: ',blending);\nbreak;}\n\n\n\n}\n\ncurrentBlendSrc=null;\ncurrentBlendDst=null;\ncurrentBlendSrcAlpha=null;\ncurrentBlendDstAlpha=null;\n\ncurrentBlending=blending;\ncurrentPremultipledAlpha=premultipliedAlpha;\n\n}\n\nreturn;\n\n}\n\n// custom blending\n\nblendEquationAlpha=blendEquationAlpha||blendEquation;\nblendSrcAlpha=blendSrcAlpha||blendSrc;\nblendDstAlpha=blendDstAlpha||blendDst;\n\nif(blendEquation!==currentBlendEquation||blendEquationAlpha!==currentBlendEquationAlpha){\n\ngl.blendEquationSeparate(equationToGL[blendEquation],equationToGL[blendEquationAlpha]);\n\ncurrentBlendEquation=blendEquation;\ncurrentBlendEquationAlpha=blendEquationAlpha;\n\n}\n\nif(blendSrc!==currentBlendSrc||blendDst!==currentBlendDst||blendSrcAlpha!==currentBlendSrcAlpha||blendDstAlpha!==currentBlendDstAlpha){\n\ngl.blendFuncSeparate(factorToGL[blendSrc],factorToGL[blendDst],factorToGL[blendSrcAlpha],factorToGL[blendDstAlpha]);\n\ncurrentBlendSrc=blendSrc;\ncurrentBlendDst=blendDst;\ncurrentBlendSrcAlpha=blendSrcAlpha;\ncurrentBlendDstAlpha=blendDstAlpha;\n\n}\n\ncurrentBlending=blending;\ncurrentPremultipledAlpha=null;\n\n}\n\nfunction setMaterial(material,frontFaceCW){\n\nmaterial.side===DoubleSide?\ndisable(2884):\nenable(2884);\n\nvar flipSided=material.side===BackSide;\nif(frontFaceCW)flipSided=!flipSided;\n\nsetFlipSided(flipSided);\n\nmaterial.blending===NormalBlending&&material.transparent===false?\nsetBlending(NoBlending):\nsetBlending(material.blending,material.blendEquation,material.blendSrc,material.blendDst,material.blendEquationAlpha,material.blendSrcAlpha,material.blendDstAlpha,material.premultipliedAlpha);\n\ndepthBuffer.setFunc(material.depthFunc);\ndepthBuffer.setTest(material.depthTest);\ndepthBuffer.setMask(material.depthWrite);\ncolorBuffer.setMask(material.colorWrite);\n\nvar stencilWrite=material.stencilWrite;\nstencilBuffer.setTest(stencilWrite);\nif(stencilWrite){\n\nstencilBuffer.setMask(material.stencilWriteMask);\nstencilBuffer.setFunc(material.stencilFunc,material.stencilRef,material.stencilFuncMask);\nstencilBuffer.setOp(material.stencilFail,material.stencilZFail,material.stencilZPass);\n\n}\n\nsetPolygonOffset(material.polygonOffset,material.polygonOffsetFactor,material.polygonOffsetUnits);\n\nmaterial.alphaToCoverage===true?\nenable(32926):\ndisable(32926);\n\n}\n\n//\n\nfunction setFlipSided(flipSided){\n\nif(currentFlipSided!==flipSided){\n\nif(flipSided){\n\ngl.frontFace(2304);\n\n}else{\n\ngl.frontFace(2305);\n\n}\n\ncurrentFlipSided=flipSided;\n\n}\n\n}\n\nfunction setCullFace(cullFace){\n\nif(cullFace!==CullFaceNone){\n\nenable(2884);\n\nif(cullFace!==currentCullFace){\n\nif(cullFace===CullFaceBack){\n\ngl.cullFace(1029);\n\n}else if(cullFace===CullFaceFront){\n\ngl.cullFace(1028);\n\n}else{\n\ngl.cullFace(1032);\n\n}\n\n}\n\n}else{\n\ndisable(2884);\n\n}\n\ncurrentCullFace=cullFace;\n\n}\n\nfunction setLineWidth(width){\n\nif(width!==currentLineWidth){\n\nif(lineWidthAvailable)gl.lineWidth(width);\n\ncurrentLineWidth=width;\n\n}\n\n}\n\nfunction setPolygonOffset(polygonOffset,factor,units){\n\nif(polygonOffset){\n\nenable(32823);\n\nif(currentPolygonOffsetFactor!==factor||currentPolygonOffsetUnits!==units){\n\ngl.polygonOffset(factor,units);\n\ncurrentPolygonOffsetFactor=factor;\ncurrentPolygonOffsetUnits=units;\n\n}\n\n}else{\n\ndisable(32823);\n\n}\n\n}\n\nfunction setScissorTest(scissorTest){\n\nif(scissorTest){\n\nenable(3089);\n\n}else{\n\ndisable(3089);\n\n}\n\n}\n\n// texture\n\nfunction activeTexture(webglSlot){\n\nif(webglSlot===undefined)webglSlot=33984+maxTextures-1;\n\nif(currentTextureSlot!==webglSlot){\n\ngl.activeTexture(webglSlot);\ncurrentTextureSlot=webglSlot;\n\n}\n\n}\n\nfunction bindTexture(webglType,webglTexture){\n\nif(currentTextureSlot===null){\n\nactiveTexture();\n\n}\n\nvar boundTexture=currentBoundTextures[currentTextureSlot];\n\nif(boundTexture===undefined){\n\nboundTexture={type:undefined,texture:undefined};\ncurrentBoundTextures[currentTextureSlot]=boundTexture;\n\n}\n\nif(boundTexture.type!==webglType||boundTexture.texture!==webglTexture){\n\ngl.bindTexture(webglType,webglTexture||emptyTextures[webglType]);\n\nboundTexture.type=webglType;\nboundTexture.texture=webglTexture;\n\n}\n\n}\n\nfunction unbindTexture(){\n\nvar boundTexture=currentBoundTextures[currentTextureSlot];\n\nif(boundTexture!==undefined&&boundTexture.type!==undefined){\n\ngl.bindTexture(boundTexture.type,null);\n\nboundTexture.type=undefined;\nboundTexture.texture=undefined;\n\n}\n\n}\n\nfunction compressedTexImage2D(){\n\ntry{\n\ngl.compressedTexImage2D.apply(gl,arguments);\n\n}catch(error){\n\nconsole.error('THREE.WebGLState:',error);\n\n}\n\n}\n\nfunction texSubImage2D(){\n\ntry{\n\ngl.texSubImage2D.apply(gl,arguments);\n\n}catch(error){\n\nconsole.error('THREE.WebGLState:',error);\n\n}\n\n}\n\nfunction texSubImage3D(){\n\ntry{\n\ngl.texSubImage3D.apply(gl,arguments);\n\n}catch(error){\n\nconsole.error('THREE.WebGLState:',error);\n\n}\n\n}\n\nfunction compressedTexSubImage2D(){\n\ntry{\n\ngl.compressedTexSubImage2D.apply(gl,arguments);\n\n}catch(error){\n\nconsole.error('THREE.WebGLState:',error);\n\n}\n\n}\n\nfunction texStorage2D(){\n\ntry{\n\ngl.texStorage2D.apply(gl,arguments);\n\n}catch(error){\n\nconsole.error('THREE.WebGLState:',error);\n\n}\n\n}\n\nfunction texStorage3D(){\n\ntry{\n\ngl.texStorage3D.apply(gl,arguments);\n\n}catch(error){\n\nconsole.error('THREE.WebGLState:',error);\n\n}\n\n}\n\nfunction texImage2D(){\n\ntry{\n\ngl.texImage2D.apply(gl,arguments);\n\n}catch(error){\n\nconsole.error('THREE.WebGLState:',error);\n\n}\n\n}\n\nfunction texImage3D(){\n\ntry{\n\ngl.texImage3D.apply(gl,arguments);\n\n}catch(error){\n\nconsole.error('THREE.WebGLState:',error);\n\n}\n\n}\n\n//\n\nfunction scissor(scissor){\n\nif(currentScissor.equals(scissor)===false){\n\ngl.scissor(scissor.x,scissor.y,scissor.z,scissor.w);\ncurrentScissor.copy(scissor);\n\n}\n\n}\n\nfunction viewport(viewport){\n\nif(currentViewport.equals(viewport)===false){\n\ngl.viewport(viewport.x,viewport.y,viewport.z,viewport.w);\ncurrentViewport.copy(viewport);\n\n}\n\n}\n\n//\n\nfunction reset(){\n\n// reset state\n\ngl.disable(3042);\ngl.disable(2884);\ngl.disable(2929);\ngl.disable(32823);\ngl.disable(3089);\ngl.disable(2960);\ngl.disable(32926);\n\ngl.blendEquation(32774);\ngl.blendFunc(1,0);\ngl.blendFuncSeparate(1,0,1,0);\n\ngl.colorMask(true,true,true,true);\ngl.clearColor(0,0,0,0);\n\ngl.depthMask(true);\ngl.depthFunc(513);\ngl.clearDepth(1);\n\ngl.stencilMask(0xffffffff);\ngl.stencilFunc(519,0,0xffffffff);\ngl.stencilOp(7680,7680,7680);\ngl.clearStencil(0);\n\ngl.cullFace(1029);\ngl.frontFace(2305);\n\ngl.polygonOffset(0,0);\n\ngl.activeTexture(33984);\n\ngl.bindFramebuffer(36160,null);\n\nif(isWebGL2===true){\n\ngl.bindFramebuffer(36009,null);\ngl.bindFramebuffer(36008,null);\n\n}\n\ngl.useProgram(null);\n\ngl.lineWidth(1);\n\ngl.scissor(0,0,gl.canvas.width,gl.canvas.height);\ngl.viewport(0,0,gl.canvas.width,gl.canvas.height);\n\n// reset internals\n\nenabledCapabilities={};\n\ncurrentTextureSlot=null;\ncurrentBoundTextures={};\n\ncurrentBoundFramebuffers={};\ncurrentDrawbuffers=new WeakMap();\ndefaultDrawbuffers=[];\n\ncurrentProgram=null;\n\ncurrentBlendingEnabled=false;\ncurrentBlending=null;\ncurrentBlendEquation=null;\ncurrentBlendSrc=null;\ncurrentBlendDst=null;\ncurrentBlendEquationAlpha=null;\ncurrentBlendSrcAlpha=null;\ncurrentBlendDstAlpha=null;\ncurrentPremultipledAlpha=false;\n\ncurrentFlipSided=null;\ncurrentCullFace=null;\n\ncurrentLineWidth=null;\n\ncurrentPolygonOffsetFactor=null;\ncurrentPolygonOffsetUnits=null;\n\ncurrentScissor.set(0,0,gl.canvas.width,gl.canvas.height);\ncurrentViewport.set(0,0,gl.canvas.width,gl.canvas.height);\n\ncolorBuffer.reset();\ndepthBuffer.reset();\nstencilBuffer.reset();\n\n}\n\nreturn{\n\nbuffers:{\ncolor:colorBuffer,\ndepth:depthBuffer,\nstencil:stencilBuffer},\n\n\nenable:enable,\ndisable:disable,\n\nbindFramebuffer:bindFramebuffer,\ndrawBuffers:drawBuffers,\n\nuseProgram:useProgram,\n\nsetBlending:setBlending,\nsetMaterial:setMaterial,\n\nsetFlipSided:setFlipSided,\nsetCullFace:setCullFace,\n\nsetLineWidth:setLineWidth,\nsetPolygonOffset:setPolygonOffset,\n\nsetScissorTest:setScissorTest,\n\nactiveTexture:activeTexture,\nbindTexture:bindTexture,\nunbindTexture:unbindTexture,\ncompressedTexImage2D:compressedTexImage2D,\ntexImage2D:texImage2D,\ntexImage3D:texImage3D,\n\ntexStorage2D:texStorage2D,\ntexStorage3D:texStorage3D,\ntexSubImage2D:texSubImage2D,\ntexSubImage3D:texSubImage3D,\ncompressedTexSubImage2D:compressedTexSubImage2D,\n\nscissor:scissor,\nviewport:viewport,\n\nreset:reset};\n\n\n\n}\n\nfunction WebGLTextures(_gl,extensions,state,properties,capabilities,utils,info){var _wrappingToGL,_filterToGL;\n\nvar isWebGL2=capabilities.isWebGL2;\nvar maxTextures=capabilities.maxTextures;\nvar maxCubemapSize=capabilities.maxCubemapSize;\nvar maxTextureSize=capabilities.maxTextureSize;\nvar maxSamples=capabilities.maxSamples;\nvar multisampledRTTExt=extensions.has('WEBGL_multisampled_render_to_texture')?extensions.get('WEBGL_multisampled_render_to_texture'):null;\nvar supportsInvalidateFramebuffer=/OculusBrowser/g.test(navigator.userAgent);\n\nvar _videoTextures=new WeakMap();\nvar _canvas=void 0;\n\nvar _sources=new WeakMap();// maps WebglTexture objects to instances of Source\n\n// cordova iOS (as of 5.0) still uses UIWebView, which provides OffscreenCanvas,\n// also OffscreenCanvas.getContext(\"webgl\"), but not OffscreenCanvas.getContext(\"2d\")!\n// Some implementations may only implement OffscreenCanvas partially (e.g. lacking 2d).\n\nvar useOffscreenCanvas=false;\n\ntry{\n\nuseOffscreenCanvas=typeof OffscreenCanvas!=='undefined'\n// eslint-disable-next-line compat/compat\n&&new OffscreenCanvas(1,1).getContext('2d')!==null;\n\n}catch(err){\n\n// Ignore any errors\n\n}\n\nfunction createCanvas(width,height){\n\n// Use OffscreenCanvas when available. Specially needed in web workers\n\nreturn useOffscreenCanvas?\n// eslint-disable-next-line compat/compat\nnew OffscreenCanvas(width,height):createElementNS('canvas');\n\n}\n\nfunction resizeImage(image,needsPowerOfTwo,needsNewCanvas,maxSize){\n\nvar scale=1;\n\n// handle case if texture exceeds max size\n\nif(image.width>maxSize||image.height>maxSize){\n\nscale=maxSize/Math.max(image.width,image.height);\n\n}\n\n// only perform resize if necessary\n\nif(scale<1||needsPowerOfTwo===true){\n\n// only perform resize for certain image types\n\nif(typeof HTMLImageElement!=='undefined'&&image instanceof HTMLImageElement||\ntypeof HTMLCanvasElement!=='undefined'&&image instanceof HTMLCanvasElement||\ntypeof ImageBitmap!=='undefined'&&image instanceof ImageBitmap){\n\nvar floor=needsPowerOfTwo?floorPowerOfTwo:Math.floor;\n\nvar width=floor(scale*image.width);\nvar height=floor(scale*image.height);\n\nif(_canvas===undefined)_canvas=createCanvas(width,height);\n\n// cube textures can't reuse the same canvas\n\nvar canvas=needsNewCanvas?createCanvas(width,height):_canvas;\n\ncanvas.width=width;\ncanvas.height=height;\n\nvar context=canvas.getContext('2d');\ncontext.drawImage(image,0,0,width,height);\n\nconsole.warn('THREE.WebGLRenderer: Texture has been resized from ('+image.width+'x'+image.height+') to ('+width+'x'+height+').');\n\nreturn canvas;\n\n}else{\n\nif('data'in image){\n\nconsole.warn('THREE.WebGLRenderer: Image in DataTexture is too big ('+image.width+'x'+image.height+').');\n\n}\n\nreturn image;\n\n}\n\n}\n\nreturn image;\n\n}\n\nfunction isPowerOfTwo$1(image){\n\nreturn isPowerOfTwo(image.width)&&isPowerOfTwo(image.height);\n\n}\n\nfunction textureNeedsPowerOfTwo(texture){\n\nif(isWebGL2)return false;\n\nreturn texture.wrapS!==ClampToEdgeWrapping||texture.wrapT!==ClampToEdgeWrapping||\ntexture.minFilter!==NearestFilter&&texture.minFilter!==LinearFilter;\n\n}\n\nfunction textureNeedsGenerateMipmaps(texture,supportsMips){\n\nreturn texture.generateMipmaps&&supportsMips&&\ntexture.minFilter!==NearestFilter&&texture.minFilter!==LinearFilter;\n\n}\n\nfunction generateMipmap(target){\n\n_gl.generateMipmap(target);\n\n}\n\nfunction getInternalFormat(internalFormatName,glFormat,glType,encoding){var isVideoTexture=arguments.length>4&&arguments[4]!==undefined?arguments[4]:false;\n\nif(isWebGL2===false)return glFormat;\n\nif(internalFormatName!==null){\n\nif(_gl[internalFormatName]!==undefined)return _gl[internalFormatName];\n\nconsole.warn('THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format \\''+internalFormatName+'\\'');\n\n}\n\nvar internalFormat=glFormat;\n\nif(glFormat===6403){\n\nif(glType===5126)internalFormat=33326;\nif(glType===5131)internalFormat=33325;\nif(glType===5121)internalFormat=33321;\n\n}\n\nif(glFormat===33319){\n\nif(glType===5126)internalFormat=33328;\nif(glType===5131)internalFormat=33327;\nif(glType===5121)internalFormat=33323;\n\n}\n\nif(glFormat===6408){\n\nif(glType===5126)internalFormat=34836;\nif(glType===5131)internalFormat=34842;\nif(glType===5121)internalFormat=encoding===sRGBEncoding&&isVideoTexture===false?35907:32856;\nif(glType===32819)internalFormat=32854;\nif(glType===32820)internalFormat=32855;\n\n}\n\nif(internalFormat===33325||internalFormat===33326||\ninternalFormat===33327||internalFormat===33328||\ninternalFormat===34842||internalFormat===34836){\n\nextensions.get('EXT_color_buffer_float');\n\n}\n\nreturn internalFormat;\n\n}\n\nfunction getMipLevels(texture,image,supportsMips){\n\nif(textureNeedsGenerateMipmaps(texture,supportsMips)===true||texture.isFramebufferTexture&&texture.minFilter!==NearestFilter&&texture.minFilter!==LinearFilter){\n\nreturn Math.log2(Math.max(image.width,image.height))+1;\n\n}else if(texture.mipmaps!==undefined&&texture.mipmaps.length>0){\n\n// user-defined mipmaps\n\nreturn texture.mipmaps.length;\n\n}else if(texture.isCompressedTexture&&Array.isArray(texture.image)){\n\nreturn image.mipmaps.length;\n\n}else{\n\n// texture without mipmaps (only base level)\n\nreturn 1;\n\n}\n\n}\n\n// Fallback filters for non-power-of-2 textures\n\nfunction filterFallback(f){\n\nif(f===NearestFilter||f===NearestMipmapNearestFilter||f===NearestMipmapLinearFilter){\n\nreturn 9728;\n\n}\n\nreturn 9729;\n\n}\n\n//\n\nfunction onTextureDispose(event){\n\nvar texture=event.target;\n\ntexture.removeEventListener('dispose',onTextureDispose);\n\ndeallocateTexture(texture);\n\nif(texture.isVideoTexture){\n\n_videoTextures.delete(texture);\n\n}\n\n}\n\nfunction onRenderTargetDispose(event){\n\nvar renderTarget=event.target;\n\nrenderTarget.removeEventListener('dispose',onRenderTargetDispose);\n\ndeallocateRenderTarget(renderTarget);\n\n}\n\n//\n\nfunction deallocateTexture(texture){\n\nvar textureProperties=properties.get(texture);\n\nif(textureProperties.__webglInit===undefined)return;\n\n// check if it's necessary to remove the WebGLTexture object\n\nvar source=texture.source;\nvar webglTextures=_sources.get(source);\n\nif(webglTextures){\n\nvar webglTexture=webglTextures[textureProperties.__cacheKey];\nwebglTexture.usedTimes--;\n\n// the WebGLTexture object is not used anymore, remove it\n\nif(webglTexture.usedTimes===0){\n\ndeleteTexture(texture);\n\n}\n\n// remove the weak map entry if no WebGLTexture uses the source anymore\n\nif(Object.keys(webglTextures).length===0){\n\n_sources.delete(source);\n\n}\n\n}\n\nproperties.remove(texture);\n\n}\n\nfunction deleteTexture(texture){\n\nvar textureProperties=properties.get(texture);\n_gl.deleteTexture(textureProperties.__webglTexture);\n\nvar source=texture.source;\nvar webglTextures=_sources.get(source);\ndelete webglTextures[textureProperties.__cacheKey];\n\ninfo.memory.textures--;\n\n}\n\nfunction deallocateRenderTarget(renderTarget){\n\nvar texture=renderTarget.texture;\n\nvar renderTargetProperties=properties.get(renderTarget);\nvar textureProperties=properties.get(texture);\n\nif(textureProperties.__webglTexture!==undefined){\n\n_gl.deleteTexture(textureProperties.__webglTexture);\n\ninfo.memory.textures--;\n\n}\n\nif(renderTarget.depthTexture){\n\nrenderTarget.depthTexture.dispose();\n\n}\n\nif(renderTarget.isWebGLCubeRenderTarget){\n\nfor(var i=0;i<6;i++){\n\n_gl.deleteFramebuffer(renderTargetProperties.__webglFramebuffer[i]);\nif(renderTargetProperties.__webglDepthbuffer)_gl.deleteRenderbuffer(renderTargetProperties.__webglDepthbuffer[i]);\n\n}\n\n}else{\n\n_gl.deleteFramebuffer(renderTargetProperties.__webglFramebuffer);\nif(renderTargetProperties.__webglDepthbuffer)_gl.deleteRenderbuffer(renderTargetProperties.__webglDepthbuffer);\nif(renderTargetProperties.__webglMultisampledFramebuffer)_gl.deleteFramebuffer(renderTargetProperties.__webglMultisampledFramebuffer);\n\nif(renderTargetProperties.__webglColorRenderbuffer){\n\nfor(var _i34=0;_i34<renderTargetProperties.__webglColorRenderbuffer.length;_i34++){\n\nif(renderTargetProperties.__webglColorRenderbuffer[_i34])_gl.deleteRenderbuffer(renderTargetProperties.__webglColorRenderbuffer[_i34]);\n\n}\n\n}\n\nif(renderTargetProperties.__webglDepthRenderbuffer)_gl.deleteRenderbuffer(renderTargetProperties.__webglDepthRenderbuffer);\n\n}\n\nif(renderTarget.isWebGLMultipleRenderTargets){\n\nfor(var _i35=0,il=texture.length;_i35<il;_i35++){\n\nvar attachmentProperties=properties.get(texture[_i35]);\n\nif(attachmentProperties.__webglTexture){\n\n_gl.deleteTexture(attachmentProperties.__webglTexture);\n\ninfo.memory.textures--;\n\n}\n\nproperties.remove(texture[_i35]);\n\n}\n\n}\n\nproperties.remove(texture);\nproperties.remove(renderTarget);\n\n}\n\n//\n\nvar textureUnits=0;\n\nfunction resetTextureUnits(){\n\ntextureUnits=0;\n\n}\n\nfunction allocateTextureUnit(){\n\nvar textureUnit=textureUnits;\n\nif(textureUnit>=maxTextures){\n\nconsole.warn('THREE.WebGLTextures: Trying to use '+textureUnit+' texture units while this GPU supports only '+maxTextures);\n\n}\n\ntextureUnits+=1;\n\nreturn textureUnit;\n\n}\n\nfunction getTextureCacheKey(texture){\n\nvar array=[];\n\narray.push(texture.wrapS);\narray.push(texture.wrapT);\narray.push(texture.magFilter);\narray.push(texture.minFilter);\narray.push(texture.anisotropy);\narray.push(texture.internalFormat);\narray.push(texture.format);\narray.push(texture.type);\narray.push(texture.generateMipmaps);\narray.push(texture.premultiplyAlpha);\narray.push(texture.flipY);\narray.push(texture.unpackAlignment);\narray.push(texture.encoding);\n\nreturn array.join();\n\n}\n\n//\n\nfunction setTexture2D(texture,slot){\n\nvar textureProperties=properties.get(texture);\n\nif(texture.isVideoTexture)updateVideoTexture(texture);\n\nif(texture.isRenderTargetTexture===false&&texture.version>0&&textureProperties.__version!==texture.version){\n\nvar image=texture.image;\n\nif(image===null){\n\nconsole.warn('THREE.WebGLRenderer: Texture marked for update but no image data found.');\n\n}else if(image.complete===false){\n\nconsole.warn('THREE.WebGLRenderer: Texture marked for update but image is incomplete');\n\n}else{\n\nuploadTexture(textureProperties,texture,slot);\nreturn;\n\n}\n\n}\n\nstate.activeTexture(33984+slot);\nstate.bindTexture(3553,textureProperties.__webglTexture);\n\n}\n\nfunction setTexture2DArray(texture,slot){\n\nvar textureProperties=properties.get(texture);\n\nif(texture.version>0&&textureProperties.__version!==texture.version){\n\nuploadTexture(textureProperties,texture,slot);\nreturn;\n\n}\n\nstate.activeTexture(33984+slot);\nstate.bindTexture(35866,textureProperties.__webglTexture);\n\n}\n\nfunction setTexture3D(texture,slot){\n\nvar textureProperties=properties.get(texture);\n\nif(texture.version>0&&textureProperties.__version!==texture.version){\n\nuploadTexture(textureProperties,texture,slot);\nreturn;\n\n}\n\nstate.activeTexture(33984+slot);\nstate.bindTexture(32879,textureProperties.__webglTexture);\n\n}\n\nfunction setTextureCube(texture,slot){\n\nvar textureProperties=properties.get(texture);\n\nif(texture.version>0&&textureProperties.__version!==texture.version){\n\nuploadCubeTexture(textureProperties,texture,slot);\nreturn;\n\n}\n\nstate.activeTexture(33984+slot);\nstate.bindTexture(34067,textureProperties.__webglTexture);\n\n}\n\nvar wrappingToGL=(_wrappingToGL={},_defineProperty(_wrappingToGL,\nRepeatWrapping,10497),_defineProperty(_wrappingToGL,\nClampToEdgeWrapping,33071),_defineProperty(_wrappingToGL,\nMirroredRepeatWrapping,33648),_wrappingToGL);\n\n\nvar filterToGL=(_filterToGL={},_defineProperty(_filterToGL,\nNearestFilter,9728),_defineProperty(_filterToGL,\nNearestMipmapNearestFilter,9984),_defineProperty(_filterToGL,\nNearestMipmapLinearFilter,9986),_defineProperty(_filterToGL,\n\nLinearFilter,9729),_defineProperty(_filterToGL,\nLinearMipmapNearestFilter,9985),_defineProperty(_filterToGL,\nLinearMipmapLinearFilter,9987),_filterToGL);\n\n\nfunction setTextureParameters(textureType,texture,supportsMips){\n\nif(supportsMips){\n\n_gl.texParameteri(textureType,10242,wrappingToGL[texture.wrapS]);\n_gl.texParameteri(textureType,10243,wrappingToGL[texture.wrapT]);\n\nif(textureType===32879||textureType===35866){\n\n_gl.texParameteri(textureType,32882,wrappingToGL[texture.wrapR]);\n\n}\n\n_gl.texParameteri(textureType,10240,filterToGL[texture.magFilter]);\n_gl.texParameteri(textureType,10241,filterToGL[texture.minFilter]);\n\n}else{\n\n_gl.texParameteri(textureType,10242,33071);\n_gl.texParameteri(textureType,10243,33071);\n\nif(textureType===32879||textureType===35866){\n\n_gl.texParameteri(textureType,32882,33071);\n\n}\n\nif(texture.wrapS!==ClampToEdgeWrapping||texture.wrapT!==ClampToEdgeWrapping){\n\nconsole.warn('THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping.');\n\n}\n\n_gl.texParameteri(textureType,10240,filterFallback(texture.magFilter));\n_gl.texParameteri(textureType,10241,filterFallback(texture.minFilter));\n\nif(texture.minFilter!==NearestFilter&&texture.minFilter!==LinearFilter){\n\nconsole.warn('THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.');\n\n}\n\n}\n\nif(extensions.has('EXT_texture_filter_anisotropic')===true){\n\nvar extension=extensions.get('EXT_texture_filter_anisotropic');\n\nif(texture.type===FloatType&&extensions.has('OES_texture_float_linear')===false)return;// verify extension for WebGL 1 and WebGL 2\nif(isWebGL2===false&&texture.type===HalfFloatType&&extensions.has('OES_texture_half_float_linear')===false)return;// verify extension for WebGL 1 only\n\nif(texture.anisotropy>1||properties.get(texture).__currentAnisotropy){\n\n_gl.texParameterf(textureType,extension.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(texture.anisotropy,capabilities.getMaxAnisotropy()));\nproperties.get(texture).__currentAnisotropy=texture.anisotropy;\n\n}\n\n}\n\n}\n\nfunction initTexture(textureProperties,texture){\n\nvar forceUpload=false;\n\nif(textureProperties.__webglInit===undefined){\n\ntextureProperties.__webglInit=true;\n\ntexture.addEventListener('dispose',onTextureDispose);\n\n}\n\n// create Source <-> WebGLTextures mapping if necessary\n\nvar source=texture.source;\nvar webglTextures=_sources.get(source);\n\nif(webglTextures===undefined){\n\nwebglTextures={};\n_sources.set(source,webglTextures);\n\n}\n\n// check if there is already a WebGLTexture object for the given texture parameters\n\nvar textureCacheKey=getTextureCacheKey(texture);\n\nif(textureCacheKey!==textureProperties.__cacheKey){\n\n// if not, create a new instance of WebGLTexture\n\nif(webglTextures[textureCacheKey]===undefined){\n\n// create new entry\n\nwebglTextures[textureCacheKey]={\ntexture:_gl.createTexture(),\nusedTimes:0};\n\n\ninfo.memory.textures++;\n\n// when a new instance of WebGLTexture was created, a texture upload is required\n// even if the image contents are identical\n\nforceUpload=true;\n\n}\n\nwebglTextures[textureCacheKey].usedTimes++;\n\n// every time the texture cache key changes, it's necessary to check if an instance of\n// WebGLTexture can be deleted in order to avoid a memory leak.\n\nvar webglTexture=webglTextures[textureProperties.__cacheKey];\n\nif(webglTexture!==undefined){\n\nwebglTextures[textureProperties.__cacheKey].usedTimes--;\n\nif(webglTexture.usedTimes===0){\n\ndeleteTexture(texture);\n\n}\n\n}\n\n// store references to cache key and WebGLTexture object\n\ntextureProperties.__cacheKey=textureCacheKey;\ntextureProperties.__webglTexture=webglTextures[textureCacheKey].texture;\n\n}\n\nreturn forceUpload;\n\n}\n\nfunction uploadTexture(textureProperties,texture,slot){\n\nvar textureType=3553;\n\nif(texture.isDataArrayTexture)textureType=35866;\nif(texture.isData3DTexture)textureType=32879;\n\nvar forceUpload=initTexture(textureProperties,texture);\nvar source=texture.source;\n\nstate.activeTexture(33984+slot);\nstate.bindTexture(textureType,textureProperties.__webglTexture);\n\nif(source.version!==source.__currentVersion||forceUpload===true){\n\n_gl.pixelStorei(37440,texture.flipY);\n_gl.pixelStorei(37441,texture.premultiplyAlpha);\n_gl.pixelStorei(3317,texture.unpackAlignment);\n_gl.pixelStorei(37443,0);\n\nvar needsPowerOfTwo=textureNeedsPowerOfTwo(texture)&&isPowerOfTwo$1(texture.image)===false;\nvar image=resizeImage(texture.image,needsPowerOfTwo,false,maxTextureSize);\nimage=verifyColorSpace(texture,image);\n\nvar supportsMips=isPowerOfTwo$1(image)||isWebGL2,\nglFormat=utils.convert(texture.format,texture.encoding);\n\nvar glType=utils.convert(texture.type),\nglInternalFormat=getInternalFormat(texture.internalFormat,glFormat,glType,texture.encoding,texture.isVideoTexture);\n\nsetTextureParameters(textureType,texture,supportsMips);\n\nvar mipmap=void 0;\nvar mipmaps=texture.mipmaps;\n\nvar useTexStorage=isWebGL2&&texture.isVideoTexture!==true;\nvar allocateMemory=source.__currentVersion===undefined||forceUpload===true;\nvar levels=getMipLevels(texture,image,supportsMips);\n\nif(texture.isDepthTexture){\n\n// populate depth texture with dummy data\n\nglInternalFormat=6402;\n\nif(isWebGL2){\n\nif(texture.type===FloatType){\n\nglInternalFormat=36012;\n\n}else if(texture.type===UnsignedIntType){\n\nglInternalFormat=33190;\n\n}else if(texture.type===UnsignedInt248Type){\n\nglInternalFormat=35056;\n\n}else{\n\nglInternalFormat=33189;// WebGL2 requires sized internalformat for glTexImage2D\n\n}\n\n}else{\n\nif(texture.type===FloatType){\n\nconsole.error('WebGLRenderer: Floating point depth texture requires WebGL2.');\n\n}\n\n}\n\n// validation checks for WebGL 1\n\nif(texture.format===DepthFormat&&glInternalFormat===6402){\n\n// The error INVALID_OPERATION is generated by texImage2D if format and internalformat are\n// DEPTH_COMPONENT and type is not UNSIGNED_SHORT or UNSIGNED_INT\n// (https://www.khronos.org/registry/webgl/extensions/WEBGL_depth_texture/)\nif(texture.type!==UnsignedShortType&&texture.type!==UnsignedIntType){\n\nconsole.warn('THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture.');\n\ntexture.type=UnsignedIntType;\nglType=utils.convert(texture.type);\n\n}\n\n}\n\nif(texture.format===DepthStencilFormat&&glInternalFormat===6402){\n\n// Depth stencil textures need the DEPTH_STENCIL internal format\n// (https://www.khronos.org/registry/webgl/extensions/WEBGL_depth_texture/)\nglInternalFormat=34041;\n\n// The error INVALID_OPERATION is generated by texImage2D if format and internalformat are\n// DEPTH_STENCIL and type is not UNSIGNED_INT_24_8_WEBGL.\n// (https://www.khronos.org/registry/webgl/extensions/WEBGL_depth_texture/)\nif(texture.type!==UnsignedInt248Type){\n\nconsole.warn('THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture.');\n\ntexture.type=UnsignedInt248Type;\nglType=utils.convert(texture.type);\n\n}\n\n}\n\n//\n\nif(allocateMemory){\n\nif(useTexStorage){\n\nstate.texStorage2D(3553,1,glInternalFormat,image.width,image.height);\n\n}else{\n\nstate.texImage2D(3553,0,glInternalFormat,image.width,image.height,0,glFormat,glType,null);\n\n}\n\n}\n\n}else if(texture.isDataTexture){\n\n// use manually created mipmaps if available\n// if there are no manual mipmaps\n// set 0 level mipmap and then use GL to generate other mipmap levels\n\nif(mipmaps.length>0&&supportsMips){\n\nif(useTexStorage&&allocateMemory){\n\nstate.texStorage2D(3553,levels,glInternalFormat,mipmaps[0].width,mipmaps[0].height);\n\n}\n\nfor(var i=0,il=mipmaps.length;i<il;i++){\n\nmipmap=mipmaps[i];\n\nif(useTexStorage){\n\nstate.texSubImage2D(3553,i,0,0,mipmap.width,mipmap.height,glFormat,glType,mipmap.data);\n\n}else{\n\nstate.texImage2D(3553,i,glInternalFormat,mipmap.width,mipmap.height,0,glFormat,glType,mipmap.data);\n\n}\n\n}\n\ntexture.generateMipmaps=false;\n\n}else{\n\nif(useTexStorage){\n\nif(allocateMemory){\n\nstate.texStorage2D(3553,levels,glInternalFormat,image.width,image.height);\n\n}\n\nstate.texSubImage2D(3553,0,0,0,image.width,image.height,glFormat,glType,image.data);\n\n}else{\n\nstate.texImage2D(3553,0,glInternalFormat,image.width,image.height,0,glFormat,glType,image.data);\n\n}\n\n}\n\n}else if(texture.isCompressedTexture){\n\nif(useTexStorage&&allocateMemory){\n\nstate.texStorage2D(3553,levels,glInternalFormat,mipmaps[0].width,mipmaps[0].height);\n\n}\n\nfor(var _i36=0,_il9=mipmaps.length;_i36<_il9;_i36++){\n\nmipmap=mipmaps[_i36];\n\nif(texture.format!==RGBAFormat){\n\nif(glFormat!==null){\n\nif(useTexStorage){\n\nstate.compressedTexSubImage2D(3553,_i36,0,0,mipmap.width,mipmap.height,glFormat,mipmap.data);\n\n}else{\n\nstate.compressedTexImage2D(3553,_i36,glInternalFormat,mipmap.width,mipmap.height,0,mipmap.data);\n\n}\n\n}else{\n\nconsole.warn('THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()');\n\n}\n\n}else{\n\nif(useTexStorage){\n\nstate.texSubImage2D(3553,_i36,0,0,mipmap.width,mipmap.height,glFormat,glType,mipmap.data);\n\n}else{\n\nstate.texImage2D(3553,_i36,glInternalFormat,mipmap.width,mipmap.height,0,glFormat,glType,mipmap.data);\n\n}\n\n}\n\n}\n\n}else if(texture.isDataArrayTexture){\n\nif(useTexStorage){\n\nif(allocateMemory){\n\nstate.texStorage3D(35866,levels,glInternalFormat,image.width,image.height,image.depth);\n\n}\n\nstate.texSubImage3D(35866,0,0,0,0,image.width,image.height,image.depth,glFormat,glType,image.data);\n\n}else{\n\nstate.texImage3D(35866,0,glInternalFormat,image.width,image.height,image.depth,0,glFormat,glType,image.data);\n\n}\n\n}else if(texture.isData3DTexture){\n\nif(useTexStorage){\n\nif(allocateMemory){\n\nstate.texStorage3D(32879,levels,glInternalFormat,image.width,image.height,image.depth);\n\n}\n\nstate.texSubImage3D(32879,0,0,0,0,image.width,image.height,image.depth,glFormat,glType,image.data);\n\n}else{\n\nstate.texImage3D(32879,0,glInternalFormat,image.width,image.height,image.depth,0,glFormat,glType,image.data);\n\n}\n\n}else if(texture.isFramebufferTexture){\n\nif(allocateMemory){\n\nif(useTexStorage){\n\nstate.texStorage2D(3553,levels,glInternalFormat,image.width,image.height);\n\n}else{\n\nvar width=image.width,height=image.height;\n\nfor(var _i37=0;_i37<levels;_i37++){\n\nstate.texImage2D(3553,_i37,glInternalFormat,width,height,0,glFormat,glType,null);\n\nwidth>>=1;\nheight>>=1;\n\n}\n\n}\n\n}\n\n}else{\n\n// regular Texture (image, video, canvas)\n\n// use manually created mipmaps if available\n// if there are no manual mipmaps\n// set 0 level mipmap and then use GL to generate other mipmap levels\n\nif(mipmaps.length>0&&supportsMips){\n\nif(useTexStorage&&allocateMemory){\n\nstate.texStorage2D(3553,levels,glInternalFormat,mipmaps[0].width,mipmaps[0].height);\n\n}\n\nfor(var _i38=0,_il10=mipmaps.length;_i38<_il10;_i38++){\n\nmipmap=mipmaps[_i38];\n\nif(useTexStorage){\n\nstate.texSubImage2D(3553,_i38,0,0,glFormat,glType,mipmap);\n\n}else{\n\nstate.texImage2D(3553,_i38,glInternalFormat,glFormat,glType,mipmap);\n\n}\n\n}\n\ntexture.generateMipmaps=false;\n\n}else{\n\nif(useTexStorage){\n\nif(allocateMemory){\n\nstate.texStorage2D(3553,levels,glInternalFormat,image.width,image.height);\n\n}\n\nstate.texSubImage2D(3553,0,0,0,glFormat,glType,image);\n\n}else{\n\nstate.texImage2D(3553,0,glInternalFormat,glFormat,glType,image);\n\n}\n\n}\n\n}\n\nif(textureNeedsGenerateMipmaps(texture,supportsMips)){\n\ngenerateMipmap(textureType);\n\n}\n\nsource.__currentVersion=source.version;\n\nif(texture.onUpdate)texture.onUpdate(texture);\n\n}\n\ntextureProperties.__version=texture.version;\n\n}\n\nfunction uploadCubeTexture(textureProperties,texture,slot){\n\nif(texture.image.length!==6)return;\n\nvar forceUpload=initTexture(textureProperties,texture);\nvar source=texture.source;\n\nstate.activeTexture(33984+slot);\nstate.bindTexture(34067,textureProperties.__webglTexture);\n\nif(source.version!==source.__currentVersion||forceUpload===true){\n\n_gl.pixelStorei(37440,texture.flipY);\n_gl.pixelStorei(37441,texture.premultiplyAlpha);\n_gl.pixelStorei(3317,texture.unpackAlignment);\n_gl.pixelStorei(37443,0);\n\nvar isCompressed=texture.isCompressedTexture||texture.image[0].isCompressedTexture;\nvar isDataTexture=texture.image[0]&&texture.image[0].isDataTexture;\n\nvar cubeImage=[];\n\nfor(var i=0;i<6;i++){\n\nif(!isCompressed&&!isDataTexture){\n\ncubeImage[i]=resizeImage(texture.image[i],false,true,maxCubemapSize);\n\n}else{\n\ncubeImage[i]=isDataTexture?texture.image[i].image:texture.image[i];\n\n}\n\ncubeImage[i]=verifyColorSpace(texture,cubeImage[i]);\n\n}\n\nvar image=cubeImage[0],\nsupportsMips=isPowerOfTwo$1(image)||isWebGL2,\nglFormat=utils.convert(texture.format,texture.encoding),\nglType=utils.convert(texture.type),\nglInternalFormat=getInternalFormat(texture.internalFormat,glFormat,glType,texture.encoding);\n\nvar useTexStorage=isWebGL2&&texture.isVideoTexture!==true;\nvar allocateMemory=source.__currentVersion===undefined||forceUpload===true;\nvar levels=getMipLevels(texture,image,supportsMips);\n\nsetTextureParameters(34067,texture,supportsMips);\n\nvar mipmaps=void 0;\n\nif(isCompressed){\n\nif(useTexStorage&&allocateMemory){\n\nstate.texStorage2D(34067,levels,glInternalFormat,image.width,image.height);\n\n}\n\nfor(var _i39=0;_i39<6;_i39++){\n\nmipmaps=cubeImage[_i39].mipmaps;\n\nfor(var j=0;j<mipmaps.length;j++){\n\nvar mipmap=mipmaps[j];\n\nif(texture.format!==RGBAFormat){\n\nif(glFormat!==null){\n\nif(useTexStorage){\n\nstate.compressedTexSubImage2D(34069+_i39,j,0,0,mipmap.width,mipmap.height,glFormat,mipmap.data);\n\n}else{\n\nstate.compressedTexImage2D(34069+_i39,j,glInternalFormat,mipmap.width,mipmap.height,0,mipmap.data);\n\n}\n\n}else{\n\nconsole.warn('THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()');\n\n}\n\n}else{\n\nif(useTexStorage){\n\nstate.texSubImage2D(34069+_i39,j,0,0,mipmap.width,mipmap.height,glFormat,glType,mipmap.data);\n\n}else{\n\nstate.texImage2D(34069+_i39,j,glInternalFormat,mipmap.width,mipmap.height,0,glFormat,glType,mipmap.data);\n\n}\n\n}\n\n}\n\n}\n\n}else{\n\nmipmaps=texture.mipmaps;\n\nif(useTexStorage&&allocateMemory){\n\n// TODO: Uniformly handle mipmap definitions\n// Normal textures and compressed cube textures define base level + mips with their mipmap array\n// Uncompressed cube textures use their mipmap array only for mips (no base level)\n\nif(mipmaps.length>0)levels++;\n\nstate.texStorage2D(34067,levels,glInternalFormat,cubeImage[0].width,cubeImage[0].height);\n\n}\n\nfor(var _i40=0;_i40<6;_i40++){\n\nif(isDataTexture){\n\nif(useTexStorage){\n\nstate.texSubImage2D(34069+_i40,0,0,0,cubeImage[_i40].width,cubeImage[_i40].height,glFormat,glType,cubeImage[_i40].data);\n\n}else{\n\nstate.texImage2D(34069+_i40,0,glInternalFormat,cubeImage[_i40].width,cubeImage[_i40].height,0,glFormat,glType,cubeImage[_i40].data);\n\n}\n\nfor(var _j3=0;_j3<mipmaps.length;_j3++){\n\nvar _mipmap=mipmaps[_j3];\nvar mipmapImage=_mipmap.image[_i40].image;\n\nif(useTexStorage){\n\nstate.texSubImage2D(34069+_i40,_j3+1,0,0,mipmapImage.width,mipmapImage.height,glFormat,glType,mipmapImage.data);\n\n}else{\n\nstate.texImage2D(34069+_i40,_j3+1,glInternalFormat,mipmapImage.width,mipmapImage.height,0,glFormat,glType,mipmapImage.data);\n\n}\n\n}\n\n}else{\n\nif(useTexStorage){\n\nstate.texSubImage2D(34069+_i40,0,0,0,glFormat,glType,cubeImage[_i40]);\n\n}else{\n\nstate.texImage2D(34069+_i40,0,glInternalFormat,glFormat,glType,cubeImage[_i40]);\n\n}\n\nfor(var _j4=0;_j4<mipmaps.length;_j4++){\n\nvar _mipmap2=mipmaps[_j4];\n\nif(useTexStorage){\n\nstate.texSubImage2D(34069+_i40,_j4+1,0,0,glFormat,glType,_mipmap2.image[_i40]);\n\n}else{\n\nstate.texImage2D(34069+_i40,_j4+1,glInternalFormat,glFormat,glType,_mipmap2.image[_i40]);\n\n}\n\n}\n\n}\n\n}\n\n}\n\nif(textureNeedsGenerateMipmaps(texture,supportsMips)){\n\n// We assume images for cube map have the same size.\ngenerateMipmap(34067);\n\n}\n\nsource.__currentVersion=source.version;\n\nif(texture.onUpdate)texture.onUpdate(texture);\n\n}\n\ntextureProperties.__version=texture.version;\n\n}\n\n// Render targets\n\n// Setup storage for target texture and bind it to correct framebuffer\nfunction setupFrameBufferTexture(framebuffer,renderTarget,texture,attachment,textureTarget){\n\nvar glFormat=utils.convert(texture.format,texture.encoding);\nvar glType=utils.convert(texture.type);\nvar glInternalFormat=getInternalFormat(texture.internalFormat,glFormat,glType,texture.encoding);\nvar renderTargetProperties=properties.get(renderTarget);\n\nif(!renderTargetProperties.__hasExternalTextures){\n\nif(textureTarget===32879||textureTarget===35866){\n\nstate.texImage3D(textureTarget,0,glInternalFormat,renderTarget.width,renderTarget.height,renderTarget.depth,0,glFormat,glType,null);\n\n}else{\n\nstate.texImage2D(textureTarget,0,glInternalFormat,renderTarget.width,renderTarget.height,0,glFormat,glType,null);\n\n}\n\n}\n\nstate.bindFramebuffer(36160,framebuffer);\n\nif(useMultisampledRTT(renderTarget)){\n\nmultisampledRTTExt.framebufferTexture2DMultisampleEXT(36160,attachment,textureTarget,properties.get(texture).__webglTexture,0,getRenderTargetSamples(renderTarget));\n\n}else{\n\n_gl.framebufferTexture2D(36160,attachment,textureTarget,properties.get(texture).__webglTexture,0);\n\n}\n\nstate.bindFramebuffer(36160,null);\n\n}\n\n\n// Setup storage for internal depth/stencil buffers and bind to correct framebuffer\nfunction setupRenderBufferStorage(renderbuffer,renderTarget,isMultisample){\n\n_gl.bindRenderbuffer(36161,renderbuffer);\n\nif(renderTarget.depthBuffer&&!renderTarget.stencilBuffer){\n\nvar glInternalFormat=33189;\n\nif(isMultisample||useMultisampledRTT(renderTarget)){\n\nvar depthTexture=renderTarget.depthTexture;\n\nif(depthTexture&&depthTexture.isDepthTexture){\n\nif(depthTexture.type===FloatType){\n\nglInternalFormat=36012;\n\n}else if(depthTexture.type===UnsignedIntType){\n\nglInternalFormat=33190;\n\n}\n\n}\n\nvar samples=getRenderTargetSamples(renderTarget);\n\nif(useMultisampledRTT(renderTarget)){\n\nmultisampledRTTExt.renderbufferStorageMultisampleEXT(36161,samples,glInternalFormat,renderTarget.width,renderTarget.height);\n\n}else{\n\n_gl.renderbufferStorageMultisample(36161,samples,glInternalFormat,renderTarget.width,renderTarget.height);\n\n}\n\n}else{\n\n_gl.renderbufferStorage(36161,glInternalFormat,renderTarget.width,renderTarget.height);\n\n}\n\n_gl.framebufferRenderbuffer(36160,36096,36161,renderbuffer);\n\n}else if(renderTarget.depthBuffer&&renderTarget.stencilBuffer){\n\nvar _samples=getRenderTargetSamples(renderTarget);\n\nif(isMultisample&&useMultisampledRTT(renderTarget)===false){\n\n_gl.renderbufferStorageMultisample(36161,_samples,35056,renderTarget.width,renderTarget.height);\n\n}else if(useMultisampledRTT(renderTarget)){\n\nmultisampledRTTExt.renderbufferStorageMultisampleEXT(36161,_samples,35056,renderTarget.width,renderTarget.height);\n\n}else{\n\n_gl.renderbufferStorage(36161,34041,renderTarget.width,renderTarget.height);\n\n}\n\n\n_gl.framebufferRenderbuffer(36160,33306,36161,renderbuffer);\n\n}else{\n\nvar textures=renderTarget.isWebGLMultipleRenderTargets===true?renderTarget.texture:[renderTarget.texture];\n\nfor(var i=0;i<textures.length;i++){\n\nvar _texture2=textures[i];\n\nvar glFormat=utils.convert(_texture2.format,_texture2.encoding);\nvar glType=utils.convert(_texture2.type);\nvar _glInternalFormat=getInternalFormat(_texture2.internalFormat,glFormat,glType,_texture2.encoding);\nvar _samples2=getRenderTargetSamples(renderTarget);\n\nif(isMultisample&&useMultisampledRTT(renderTarget)===false){\n\n_gl.renderbufferStorageMultisample(36161,_samples2,_glInternalFormat,renderTarget.width,renderTarget.height);\n\n}else if(useMultisampledRTT(renderTarget)){\n\nmultisampledRTTExt.renderbufferStorageMultisampleEXT(36161,_samples2,_glInternalFormat,renderTarget.width,renderTarget.height);\n\n}else{\n\n_gl.renderbufferStorage(36161,_glInternalFormat,renderTarget.width,renderTarget.height);\n\n}\n\n}\n\n}\n\n_gl.bindRenderbuffer(36161,null);\n\n}\n\n// Setup resources for a Depth Texture for a FBO (needs an extension)\nfunction setupDepthTexture(framebuffer,renderTarget){\n\nvar isCube=renderTarget&&renderTarget.isWebGLCubeRenderTarget;\nif(isCube)throw new Error('Depth Texture with cube render targets is not supported');\n\nstate.bindFramebuffer(36160,framebuffer);\n\nif(!(renderTarget.depthTexture&&renderTarget.depthTexture.isDepthTexture)){\n\nthrow new Error('renderTarget.depthTexture must be an instance of THREE.DepthTexture');\n\n}\n\n// upload an empty depth texture with framebuffer size\nif(!properties.get(renderTarget.depthTexture).__webglTexture||\nrenderTarget.depthTexture.image.width!==renderTarget.width||\nrenderTarget.depthTexture.image.height!==renderTarget.height){\n\nrenderTarget.depthTexture.image.width=renderTarget.width;\nrenderTarget.depthTexture.image.height=renderTarget.height;\nrenderTarget.depthTexture.needsUpdate=true;\n\n}\n\nsetTexture2D(renderTarget.depthTexture,0);\n\nvar webglDepthTexture=properties.get(renderTarget.depthTexture).__webglTexture;\nvar samples=getRenderTargetSamples(renderTarget);\n\nif(renderTarget.depthTexture.format===DepthFormat){\n\nif(useMultisampledRTT(renderTarget)){\n\nmultisampledRTTExt.framebufferTexture2DMultisampleEXT(36160,36096,3553,webglDepthTexture,0,samples);\n\n}else{\n\n_gl.framebufferTexture2D(36160,36096,3553,webglDepthTexture,0);\n\n}\n\n}else if(renderTarget.depthTexture.format===DepthStencilFormat){\n\nif(useMultisampledRTT(renderTarget)){\n\nmultisampledRTTExt.framebufferTexture2DMultisampleEXT(36160,33306,3553,webglDepthTexture,0,samples);\n\n}else{\n\n_gl.framebufferTexture2D(36160,33306,3553,webglDepthTexture,0);\n\n}\n\n}else{\n\nthrow new Error('Unknown depthTexture format');\n\n}\n\n}\n\n// Setup GL resources for a non-texture depth buffer\nfunction setupDepthRenderbuffer(renderTarget){\n\nvar renderTargetProperties=properties.get(renderTarget);\nvar isCube=renderTarget.isWebGLCubeRenderTarget===true;\n\nif(renderTarget.depthTexture&&!renderTargetProperties.__autoAllocateDepthBuffer){\n\nif(isCube)throw new Error('target.depthTexture not supported in Cube render targets');\n\nsetupDepthTexture(renderTargetProperties.__webglFramebuffer,renderTarget);\n\n}else{\n\nif(isCube){\n\nrenderTargetProperties.__webglDepthbuffer=[];\n\nfor(var i=0;i<6;i++){\n\nstate.bindFramebuffer(36160,renderTargetProperties.__webglFramebuffer[i]);\nrenderTargetProperties.__webglDepthbuffer[i]=_gl.createRenderbuffer();\nsetupRenderBufferStorage(renderTargetProperties.__webglDepthbuffer[i],renderTarget,false);\n\n}\n\n}else{\n\nstate.bindFramebuffer(36160,renderTargetProperties.__webglFramebuffer);\nrenderTargetProperties.__webglDepthbuffer=_gl.createRenderbuffer();\nsetupRenderBufferStorage(renderTargetProperties.__webglDepthbuffer,renderTarget,false);\n\n}\n\n}\n\nstate.bindFramebuffer(36160,null);\n\n}\n\n// rebind framebuffer with external textures\nfunction rebindTextures(renderTarget,colorTexture,depthTexture){\n\nvar renderTargetProperties=properties.get(renderTarget);\n\nif(colorTexture!==undefined){\n\nsetupFrameBufferTexture(renderTargetProperties.__webglFramebuffer,renderTarget,renderTarget.texture,36064,3553);\n\n}\n\nif(depthTexture!==undefined){\n\nsetupDepthRenderbuffer(renderTarget);\n\n}\n\n}\n\n// Set up GL resources for the render target\nfunction setupRenderTarget(renderTarget){\n\nvar texture=renderTarget.texture;\n\nvar renderTargetProperties=properties.get(renderTarget);\nvar textureProperties=properties.get(texture);\n\nrenderTarget.addEventListener('dispose',onRenderTargetDispose);\n\nif(renderTarget.isWebGLMultipleRenderTargets!==true){\n\nif(textureProperties.__webglTexture===undefined){\n\ntextureProperties.__webglTexture=_gl.createTexture();\n\n}\n\ntextureProperties.__version=texture.version;\ninfo.memory.textures++;\n\n}\n\nvar isCube=renderTarget.isWebGLCubeRenderTarget===true;\nvar isMultipleRenderTargets=renderTarget.isWebGLMultipleRenderTargets===true;\nvar supportsMips=isPowerOfTwo$1(renderTarget)||isWebGL2;\n\n// Setup framebuffer\n\nif(isCube){\n\nrenderTargetProperties.__webglFramebuffer=[];\n\nfor(var i=0;i<6;i++){\n\nrenderTargetProperties.__webglFramebuffer[i]=_gl.createFramebuffer();\n\n}\n\n}else{\n\nrenderTargetProperties.__webglFramebuffer=_gl.createFramebuffer();\n\nif(isMultipleRenderTargets){\n\nif(capabilities.drawBuffers){\n\nvar textures=renderTarget.texture;\n\nfor(var _i41=0,il=textures.length;_i41<il;_i41++){\n\nvar attachmentProperties=properties.get(textures[_i41]);\n\nif(attachmentProperties.__webglTexture===undefined){\n\nattachmentProperties.__webglTexture=_gl.createTexture();\n\ninfo.memory.textures++;\n\n}\n\n}\n\n}else{\n\nconsole.warn('THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.');\n\n}\n\n}\n\nif(isWebGL2&&renderTarget.samples>0&&useMultisampledRTT(renderTarget)===false){\n\nvar _textures=isMultipleRenderTargets?texture:[texture];\n\nrenderTargetProperties.__webglMultisampledFramebuffer=_gl.createFramebuffer();\nrenderTargetProperties.__webglColorRenderbuffer=[];\n\nstate.bindFramebuffer(36160,renderTargetProperties.__webglMultisampledFramebuffer);\n\nfor(var _i42=0;_i42<_textures.length;_i42++){\n\nvar _texture3=_textures[_i42];\nrenderTargetProperties.__webglColorRenderbuffer[_i42]=_gl.createRenderbuffer();\n\n_gl.bindRenderbuffer(36161,renderTargetProperties.__webglColorRenderbuffer[_i42]);\n\nvar glFormat=utils.convert(_texture3.format,_texture3.encoding);\nvar glType=utils.convert(_texture3.type);\nvar glInternalFormat=getInternalFormat(_texture3.internalFormat,glFormat,glType,_texture3.encoding);\nvar samples=getRenderTargetSamples(renderTarget);\n_gl.renderbufferStorageMultisample(36161,samples,glInternalFormat,renderTarget.width,renderTarget.height);\n\n_gl.framebufferRenderbuffer(36160,36064+_i42,36161,renderTargetProperties.__webglColorRenderbuffer[_i42]);\n\n}\n\n_gl.bindRenderbuffer(36161,null);\n\nif(renderTarget.depthBuffer){\n\nrenderTargetProperties.__webglDepthRenderbuffer=_gl.createRenderbuffer();\nsetupRenderBufferStorage(renderTargetProperties.__webglDepthRenderbuffer,renderTarget,true);\n\n}\n\nstate.bindFramebuffer(36160,null);\n\n}\n\n}\n\n// Setup color buffer\n\nif(isCube){\n\nstate.bindTexture(34067,textureProperties.__webglTexture);\nsetTextureParameters(34067,texture,supportsMips);\n\nfor(var _i43=0;_i43<6;_i43++){\n\nsetupFrameBufferTexture(renderTargetProperties.__webglFramebuffer[_i43],renderTarget,texture,36064,34069+_i43);\n\n}\n\nif(textureNeedsGenerateMipmaps(texture,supportsMips)){\n\ngenerateMipmap(34067);\n\n}\n\nstate.unbindTexture();\n\n}else if(isMultipleRenderTargets){\n\nvar _textures2=renderTarget.texture;\n\nfor(var _i44=0,_il11=_textures2.length;_i44<_il11;_i44++){\n\nvar attachment=_textures2[_i44];\nvar _attachmentProperties=properties.get(attachment);\n\nstate.bindTexture(3553,_attachmentProperties.__webglTexture);\nsetTextureParameters(3553,attachment,supportsMips);\nsetupFrameBufferTexture(renderTargetProperties.__webglFramebuffer,renderTarget,attachment,36064+_i44,3553);\n\nif(textureNeedsGenerateMipmaps(attachment,supportsMips)){\n\ngenerateMipmap(3553);\n\n}\n\n}\n\nstate.unbindTexture();\n\n}else{\n\nvar glTextureType=3553;\n\nif(renderTarget.isWebGL3DRenderTarget||renderTarget.isWebGLArrayRenderTarget){\n\nif(isWebGL2){\n\nglTextureType=renderTarget.isWebGL3DRenderTarget?32879:35866;\n\n}else{\n\nconsole.error('THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.');\n\n}\n\n}\n\nstate.bindTexture(glTextureType,textureProperties.__webglTexture);\nsetTextureParameters(glTextureType,texture,supportsMips);\nsetupFrameBufferTexture(renderTargetProperties.__webglFramebuffer,renderTarget,texture,36064,glTextureType);\n\nif(textureNeedsGenerateMipmaps(texture,supportsMips)){\n\ngenerateMipmap(glTextureType);\n\n}\n\nstate.unbindTexture();\n\n}\n\n// Setup depth and stencil buffers\n\nif(renderTarget.depthBuffer){\n\nsetupDepthRenderbuffer(renderTarget);\n\n}\n\n}\n\nfunction updateRenderTargetMipmap(renderTarget){\n\nvar supportsMips=isPowerOfTwo$1(renderTarget)||isWebGL2;\n\nvar textures=renderTarget.isWebGLMultipleRenderTargets===true?renderTarget.texture:[renderTarget.texture];\n\nfor(var i=0,il=textures.length;i<il;i++){\n\nvar _texture4=textures[i];\n\nif(textureNeedsGenerateMipmaps(_texture4,supportsMips)){\n\nvar target=renderTarget.isWebGLCubeRenderTarget?34067:3553;\nvar webglTexture=properties.get(_texture4).__webglTexture;\n\nstate.bindTexture(target,webglTexture);\ngenerateMipmap(target);\nstate.unbindTexture();\n\n}\n\n}\n\n}\n\nfunction updateMultisampleRenderTarget(renderTarget){\n\nif(isWebGL2&&renderTarget.samples>0&&useMultisampledRTT(renderTarget)===false){\n\nvar textures=renderTarget.isWebGLMultipleRenderTargets?renderTarget.texture:[renderTarget.texture];\nvar width=renderTarget.width;\nvar height=renderTarget.height;\nvar mask=16384;\nvar invalidationArray=[];\nvar depthStyle=renderTarget.stencilBuffer?33306:36096;\nvar renderTargetProperties=properties.get(renderTarget);\nvar isMultipleRenderTargets=renderTarget.isWebGLMultipleRenderTargets===true;\n\n// If MRT we need to remove FBO attachments\nif(isMultipleRenderTargets){\n\nfor(var i=0;i<textures.length;i++){\n\nstate.bindFramebuffer(36160,renderTargetProperties.__webglMultisampledFramebuffer);\n_gl.framebufferRenderbuffer(36160,36064+i,36161,null);\n\nstate.bindFramebuffer(36160,renderTargetProperties.__webglFramebuffer);\n_gl.framebufferTexture2D(36009,36064+i,3553,null,0);\n\n}\n\n}\n\nstate.bindFramebuffer(36008,renderTargetProperties.__webglMultisampledFramebuffer);\nstate.bindFramebuffer(36009,renderTargetProperties.__webglFramebuffer);\n\nfor(var _i45=0;_i45<textures.length;_i45++){\n\ninvalidationArray.push(36064+_i45);\n\nif(renderTarget.depthBuffer){\n\ninvalidationArray.push(depthStyle);\n\n}\n\nvar ignoreDepthValues=renderTargetProperties.__ignoreDepthValues!==undefined?renderTargetProperties.__ignoreDepthValues:false;\n\nif(ignoreDepthValues===false){\n\nif(renderTarget.depthBuffer)mask|=256;\nif(renderTarget.stencilBuffer)mask|=1024;\n\n}\n\nif(isMultipleRenderTargets){\n\n_gl.framebufferRenderbuffer(36008,36064,36161,renderTargetProperties.__webglColorRenderbuffer[_i45]);\n\n}\n\nif(ignoreDepthValues===true){\n\n_gl.invalidateFramebuffer(36008,[depthStyle]);\n_gl.invalidateFramebuffer(36009,[depthStyle]);\n\n}\n\nif(isMultipleRenderTargets){\n\nvar webglTexture=properties.get(textures[_i45]).__webglTexture;\n_gl.framebufferTexture2D(36009,36064,3553,webglTexture,0);\n\n}\n\n_gl.blitFramebuffer(0,0,width,height,0,0,width,height,mask,9728);\n\nif(supportsInvalidateFramebuffer){\n\n_gl.invalidateFramebuffer(36008,invalidationArray);\n\n}\n\n\n}\n\nstate.bindFramebuffer(36008,null);\nstate.bindFramebuffer(36009,null);\n\n// If MRT since pre-blit we removed the FBO we need to reconstruct the attachments\nif(isMultipleRenderTargets){\n\nfor(var _i46=0;_i46<textures.length;_i46++){\n\nstate.bindFramebuffer(36160,renderTargetProperties.__webglMultisampledFramebuffer);\n_gl.framebufferRenderbuffer(36160,36064+_i46,36161,renderTargetProperties.__webglColorRenderbuffer[_i46]);\n\nvar _webglTexture=properties.get(textures[_i46]).__webglTexture;\n\nstate.bindFramebuffer(36160,renderTargetProperties.__webglFramebuffer);\n_gl.framebufferTexture2D(36009,36064+_i46,3553,_webglTexture,0);\n\n}\n\n}\n\nstate.bindFramebuffer(36009,renderTargetProperties.__webglMultisampledFramebuffer);\n\n}\n\n}\n\nfunction getRenderTargetSamples(renderTarget){\n\nreturn Math.min(maxSamples,renderTarget.samples);\n\n}\n\nfunction useMultisampledRTT(renderTarget){\n\nvar renderTargetProperties=properties.get(renderTarget);\n\nreturn isWebGL2&&renderTarget.samples>0&&extensions.has('WEBGL_multisampled_render_to_texture')===true&&renderTargetProperties.__useRenderToTexture!==false;\n\n}\n\nfunction updateVideoTexture(texture){\n\nvar frame=info.render.frame;\n\n// Check the last frame we updated the VideoTexture\n\nif(_videoTextures.get(texture)!==frame){\n\n_videoTextures.set(texture,frame);\ntexture.update();\n\n}\n\n}\n\nfunction verifyColorSpace(texture,image){\n\nvar encoding=texture.encoding;\nvar format=texture.format;\nvar type=texture.type;\n\nif(texture.isCompressedTexture===true||texture.isVideoTexture===true||texture.format===_SRGBAFormat)return image;\n\nif(encoding!==LinearEncoding){\n\n// sRGB\n\nif(encoding===sRGBEncoding){\n\nif(isWebGL2===false){\n\n// in WebGL 1, try to use EXT_sRGB extension and unsized formats\n\nif(extensions.has('EXT_sRGB')===true&&format===RGBAFormat){\n\ntexture.format=_SRGBAFormat;\n\n// it's not possible to generate mips in WebGL 1 with this extension\n\ntexture.minFilter=LinearFilter;\ntexture.generateMipmaps=false;\n\n}else{\n\n// slow fallback (CPU decode)\n\nimage=ImageUtils.sRGBToLinear(image);\n\n}\n\n}else{\n\n// in WebGL 2 uncompressed textures can only be sRGB encoded if they have the RGBA8 format\n\nif(format!==RGBAFormat||type!==UnsignedByteType){\n\nconsole.warn('THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType.');\n\n}\n\n}\n\n}else{\n\nconsole.error('THREE.WebGLTextures: Unsupported texture encoding:',encoding);\n\n}\n\n}\n\nreturn image;\n\n}\n\n//\n\nthis.allocateTextureUnit=allocateTextureUnit;\nthis.resetTextureUnits=resetTextureUnits;\n\nthis.setTexture2D=setTexture2D;\nthis.setTexture2DArray=setTexture2DArray;\nthis.setTexture3D=setTexture3D;\nthis.setTextureCube=setTextureCube;\nthis.rebindTextures=rebindTextures;\nthis.setupRenderTarget=setupRenderTarget;\nthis.updateRenderTargetMipmap=updateRenderTargetMipmap;\nthis.updateMultisampleRenderTarget=updateMultisampleRenderTarget;\nthis.setupDepthRenderbuffer=setupDepthRenderbuffer;\nthis.setupFrameBufferTexture=setupFrameBufferTexture;\nthis.useMultisampledRTT=useMultisampledRTT;\n\n}\n\nfunction WebGLUtils(gl,extensions,capabilities){\n\nvar isWebGL2=capabilities.isWebGL2;\n\nfunction convert(p){var encoding=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;\n\nvar extension=void 0;\n\nif(p===UnsignedByteType)return 5121;\nif(p===UnsignedShort4444Type)return 32819;\nif(p===UnsignedShort5551Type)return 32820;\n\nif(p===ByteType)return 5120;\nif(p===ShortType)return 5122;\nif(p===UnsignedShortType)return 5123;\nif(p===IntType)return 5124;\nif(p===UnsignedIntType)return 5125;\nif(p===FloatType)return 5126;\n\nif(p===HalfFloatType){\n\nif(isWebGL2)return 5131;\n\nextension=extensions.get('OES_texture_half_float');\n\nif(extension!==null){\n\nreturn extension.HALF_FLOAT_OES;\n\n}else{\n\nreturn null;\n\n}\n\n}\n\nif(p===AlphaFormat)return 6406;\nif(p===RGBAFormat)return 6408;\nif(p===LuminanceFormat)return 6409;\nif(p===LuminanceAlphaFormat)return 6410;\nif(p===DepthFormat)return 6402;\nif(p===DepthStencilFormat)return 34041;\nif(p===RedFormat)return 6403;\n\nif(p===RGBFormat){\n\nconsole.warn('THREE.WebGLRenderer: THREE.RGBFormat has been removed. Use THREE.RGBAFormat instead. https://github.com/mrdoob/three.js/pull/23228');\nreturn 6408;\n\n}\n\n// WebGL 1 sRGB fallback\n\nif(p===_SRGBAFormat){\n\nextension=extensions.get('EXT_sRGB');\n\nif(extension!==null){\n\nreturn extension.SRGB_ALPHA_EXT;\n\n}else{\n\nreturn null;\n\n}\n\n}\n\n// WebGL2 formats.\n\nif(p===RedIntegerFormat)return 36244;\nif(p===RGFormat)return 33319;\nif(p===RGIntegerFormat)return 33320;\nif(p===RGBAIntegerFormat)return 36249;\n\n// S3TC\n\nif(p===RGB_S3TC_DXT1_Format||p===RGBA_S3TC_DXT1_Format||p===RGBA_S3TC_DXT3_Format||p===RGBA_S3TC_DXT5_Format){\n\nif(encoding===sRGBEncoding){\n\nextension=extensions.get('WEBGL_compressed_texture_s3tc_srgb');\n\nif(extension!==null){\n\nif(p===RGB_S3TC_DXT1_Format)return extension.COMPRESSED_SRGB_S3TC_DXT1_EXT;\nif(p===RGBA_S3TC_DXT1_Format)return extension.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;\nif(p===RGBA_S3TC_DXT3_Format)return extension.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;\nif(p===RGBA_S3TC_DXT5_Format)return extension.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT;\n\n}else{\n\nreturn null;\n\n}\n\n}else{\n\nextension=extensions.get('WEBGL_compressed_texture_s3tc');\n\nif(extension!==null){\n\nif(p===RGB_S3TC_DXT1_Format)return extension.COMPRESSED_RGB_S3TC_DXT1_EXT;\nif(p===RGBA_S3TC_DXT1_Format)return extension.COMPRESSED_RGBA_S3TC_DXT1_EXT;\nif(p===RGBA_S3TC_DXT3_Format)return extension.COMPRESSED_RGBA_S3TC_DXT3_EXT;\nif(p===RGBA_S3TC_DXT5_Format)return extension.COMPRESSED_RGBA_S3TC_DXT5_EXT;\n\n}else{\n\nreturn null;\n\n}\n\n}\n\n}\n\n// PVRTC\n\nif(p===RGB_PVRTC_4BPPV1_Format||p===RGB_PVRTC_2BPPV1_Format||p===RGBA_PVRTC_4BPPV1_Format||p===RGBA_PVRTC_2BPPV1_Format){\n\nextension=extensions.get('WEBGL_compressed_texture_pvrtc');\n\nif(extension!==null){\n\nif(p===RGB_PVRTC_4BPPV1_Format)return extension.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;\nif(p===RGB_PVRTC_2BPPV1_Format)return extension.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;\nif(p===RGBA_PVRTC_4BPPV1_Format)return extension.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;\nif(p===RGBA_PVRTC_2BPPV1_Format)return extension.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG;\n\n}else{\n\nreturn null;\n\n}\n\n}\n\n// ETC1\n\nif(p===RGB_ETC1_Format){\n\nextension=extensions.get('WEBGL_compressed_texture_etc1');\n\nif(extension!==null){\n\nreturn extension.COMPRESSED_RGB_ETC1_WEBGL;\n\n}else{\n\nreturn null;\n\n}\n\n}\n\n// ETC2\n\nif(p===RGB_ETC2_Format||p===RGBA_ETC2_EAC_Format){\n\nextension=extensions.get('WEBGL_compressed_texture_etc');\n\nif(extension!==null){\n\nif(p===RGB_ETC2_Format)return encoding===sRGBEncoding?extension.COMPRESSED_SRGB8_ETC2:extension.COMPRESSED_RGB8_ETC2;\nif(p===RGBA_ETC2_EAC_Format)return encoding===sRGBEncoding?extension.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:extension.COMPRESSED_RGBA8_ETC2_EAC;\n\n}else{\n\nreturn null;\n\n}\n\n}\n\n// ASTC\n\nif(p===RGBA_ASTC_4x4_Format||p===RGBA_ASTC_5x4_Format||p===RGBA_ASTC_5x5_Format||\np===RGBA_ASTC_6x5_Format||p===RGBA_ASTC_6x6_Format||p===RGBA_ASTC_8x5_Format||\np===RGBA_ASTC_8x6_Format||p===RGBA_ASTC_8x8_Format||p===RGBA_ASTC_10x5_Format||\np===RGBA_ASTC_10x6_Format||p===RGBA_ASTC_10x8_Format||p===RGBA_ASTC_10x10_Format||\np===RGBA_ASTC_12x10_Format||p===RGBA_ASTC_12x12_Format){\n\nextension=extensions.get('WEBGL_compressed_texture_astc');\n\nif(extension!==null){\n\nif(p===RGBA_ASTC_4x4_Format)return encoding===sRGBEncoding?extension.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:extension.COMPRESSED_RGBA_ASTC_4x4_KHR;\nif(p===RGBA_ASTC_5x4_Format)return encoding===sRGBEncoding?extension.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:extension.COMPRESSED_RGBA_ASTC_5x4_KHR;\nif(p===RGBA_ASTC_5x5_Format)return encoding===sRGBEncoding?extension.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:extension.COMPRESSED_RGBA_ASTC_5x5_KHR;\nif(p===RGBA_ASTC_6x5_Format)return encoding===sRGBEncoding?extension.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:extension.COMPRESSED_RGBA_ASTC_6x5_KHR;\nif(p===RGBA_ASTC_6x6_Format)return encoding===sRGBEncoding?extension.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:extension.COMPRESSED_RGBA_ASTC_6x6_KHR;\nif(p===RGBA_ASTC_8x5_Format)return encoding===sRGBEncoding?extension.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:extension.COMPRESSED_RGBA_ASTC_8x5_KHR;\nif(p===RGBA_ASTC_8x6_Format)return encoding===sRGBEncoding?extension.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:extension.COMPRESSED_RGBA_ASTC_8x6_KHR;\nif(p===RGBA_ASTC_8x8_Format)return encoding===sRGBEncoding?extension.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:extension.COMPRESSED_RGBA_ASTC_8x8_KHR;\nif(p===RGBA_ASTC_10x5_Format)return encoding===sRGBEncoding?extension.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:extension.COMPRESSED_RGBA_ASTC_10x5_KHR;\nif(p===RGBA_ASTC_10x6_Format)return encoding===sRGBEncoding?extension.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:extension.COMPRESSED_RGBA_ASTC_10x6_KHR;\nif(p===RGBA_ASTC_10x8_Format)return encoding===sRGBEncoding?extension.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:extension.COMPRESSED_RGBA_ASTC_10x8_KHR;\nif(p===RGBA_ASTC_10x10_Format)return encoding===sRGBEncoding?extension.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:extension.COMPRESSED_RGBA_ASTC_10x10_KHR;\nif(p===RGBA_ASTC_12x10_Format)return encoding===sRGBEncoding?extension.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:extension.COMPRESSED_RGBA_ASTC_12x10_KHR;\nif(p===RGBA_ASTC_12x12_Format)return encoding===sRGBEncoding?extension.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:extension.COMPRESSED_RGBA_ASTC_12x12_KHR;\n\n}else{\n\nreturn null;\n\n}\n\n}\n\n// BPTC\n\nif(p===RGBA_BPTC_Format){\n\nextension=extensions.get('EXT_texture_compression_bptc');\n\nif(extension!==null){\n\nif(p===RGBA_BPTC_Format)return encoding===sRGBEncoding?extension.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:extension.COMPRESSED_RGBA_BPTC_UNORM_EXT;\n\n}else{\n\nreturn null;\n\n}\n\n}\n\n//\n\nif(p===UnsignedInt248Type){\n\nif(isWebGL2)return 34042;\n\nextension=extensions.get('WEBGL_depth_texture');\n\nif(extension!==null){\n\nreturn extension.UNSIGNED_INT_24_8_WEBGL;\n\n}else{\n\nreturn null;\n\n}\n\n}\n\n// if \"p\" can't be resolved, assume the user defines a WebGL constant as a string (fallback/workaround for packed RGB formats)\n\nreturn gl[p]!==undefined?gl[p]:null;\n\n}\n\nreturn{convert:convert};\n\n}var\n\nArrayCamera=function(_PerspectiveCamera){_inherits(ArrayCamera,_PerspectiveCamera);\n\nfunction ArrayCamera(){var array=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];_classCallCheck(this,ArrayCamera);var _this35=_possibleConstructorReturn(this,(ArrayCamera.__proto__||Object.getPrototypeOf(ArrayCamera)).call(this));\n\n\n\n_this35.isArrayCamera=true;\n\n_this35.cameras=array;return _this35;\n\n}return ArrayCamera;}(PerspectiveCamera);var\n\n\n\nGroup=function(_Object3D4){_inherits(Group,_Object3D4);\n\nfunction Group(){_classCallCheck(this,Group);var _this36=_possibleConstructorReturn(this,(Group.__proto__||Object.getPrototypeOf(Group)).call(this));\n\n\n\n_this36.isGroup=true;\n\n_this36.type='Group';return _this36;\n\n}return Group;}(Object3D);\n\n\n\nvar _moveEvent={type:'move'};var\n\nWebXRController=function(){\n\nfunction WebXRController(){_classCallCheck(this,WebXRController);\n\nthis._targetRay=null;\nthis._grip=null;\nthis._hand=null;\n\n}_createClass(WebXRController,[{key:'getHandSpace',value:function getHandSpace()\n\n{\n\nif(this._hand===null){\n\nthis._hand=new Group();\nthis._hand.matrixAutoUpdate=false;\nthis._hand.visible=false;\n\nthis._hand.joints={};\nthis._hand.inputState={pinching:false};\n\n}\n\nreturn this._hand;\n\n}},{key:'getTargetRaySpace',value:function getTargetRaySpace()\n\n{\n\nif(this._targetRay===null){\n\nthis._targetRay=new Group();\nthis._targetRay.matrixAutoUpdate=false;\nthis._targetRay.visible=false;\nthis._targetRay.hasLinearVelocity=false;\nthis._targetRay.linearVelocity=new Vector3();\nthis._targetRay.hasAngularVelocity=false;\nthis._targetRay.angularVelocity=new Vector3();\n\n}\n\nreturn this._targetRay;\n\n}},{key:'getGripSpace',value:function getGripSpace()\n\n{\n\nif(this._grip===null){\n\nthis._grip=new Group();\nthis._grip.matrixAutoUpdate=false;\nthis._grip.visible=false;\nthis._grip.hasLinearVelocity=false;\nthis._grip.linearVelocity=new Vector3();\nthis._grip.hasAngularVelocity=false;\nthis._grip.angularVelocity=new Vector3();\n\n}\n\nreturn this._grip;\n\n}},{key:'dispatchEvent',value:function dispatchEvent(\n\nevent){\n\nif(this._targetRay!==null){\n\nthis._targetRay.dispatchEvent(event);\n\n}\n\nif(this._grip!==null){\n\nthis._grip.dispatchEvent(event);\n\n}\n\nif(this._hand!==null){\n\nthis._hand.dispatchEvent(event);\n\n}\n\nreturn this;\n\n}},{key:'disconnect',value:function disconnect(\n\ninputSource){\n\nthis.dispatchEvent({type:'disconnected',data:inputSource});\n\nif(this._targetRay!==null){\n\nthis._targetRay.visible=false;\n\n}\n\nif(this._grip!==null){\n\nthis._grip.visible=false;\n\n}\n\nif(this._hand!==null){\n\nthis._hand.visible=false;\n\n}\n\nreturn this;\n\n}},{key:'update',value:function update(\n\ninputSource,frame,referenceSpace){\n\nvar inputPose=null;\nvar gripPose=null;\nvar handPose=null;\n\nvar targetRay=this._targetRay;\nvar grip=this._grip;\nvar hand=this._hand;\n\nif(inputSource&&frame.session.visibilityState!=='visible-blurred'){\n\nif(hand&&inputSource.hand){\n\nhandPose=true;var _iteratorNormalCompletion2=true;var _didIteratorError2=false;var _iteratorError2=undefined;try{\n\nfor(var _iterator2=inputSource.hand.values()[Symbol.iterator](),_step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=true){var inputjoint=_step2.value;\n\n// Update the joints groups with the XRJoint poses\nvar jointPose=frame.getJointPose(inputjoint,referenceSpace);\n\nif(hand.joints[inputjoint.jointName]===undefined){\n\n// The transform of this joint will be updated with the joint pose on each frame\nvar _joint=new Group();\n_joint.matrixAutoUpdate=false;\n_joint.visible=false;\nhand.joints[inputjoint.jointName]=_joint;\n// ??\nhand.add(_joint);\n\n}\n\nvar joint=hand.joints[inputjoint.jointName];\n\nif(jointPose!==null){\n\njoint.matrix.fromArray(jointPose.transform.matrix);\njoint.matrix.decompose(joint.position,joint.rotation,joint.scale);\njoint.jointRadius=jointPose.radius;\n\n}\n\njoint.visible=jointPose!==null;\n\n}\n\n// Custom events\n\n// Check pinchz\n}catch(err){_didIteratorError2=true;_iteratorError2=err;}finally{try{if(!_iteratorNormalCompletion2&&_iterator2.return){_iterator2.return();}}finally{if(_didIteratorError2){throw _iteratorError2;}}}var indexTip=hand.joints['index-finger-tip'];\nvar thumbTip=hand.joints['thumb-tip'];\nvar distance=indexTip.position.distanceTo(thumbTip.position);\n\nvar distanceToPinch=0.02;\nvar threshold=0.005;\n\nif(hand.inputState.pinching&&distance>distanceToPinch+threshold){\n\nhand.inputState.pinching=false;\nthis.dispatchEvent({\ntype:'pinchend',\nhandedness:inputSource.handedness,\ntarget:this});\n\n\n}else if(!hand.inputState.pinching&&distance<=distanceToPinch-threshold){\n\nhand.inputState.pinching=true;\nthis.dispatchEvent({\ntype:'pinchstart',\nhandedness:inputSource.handedness,\ntarget:this});\n\n\n}\n\n}else{\n\nif(grip!==null&&inputSource.gripSpace){\n\ngripPose=frame.getPose(inputSource.gripSpace,referenceSpace);\n\nif(gripPose!==null){\n\ngrip.matrix.fromArray(gripPose.transform.matrix);\ngrip.matrix.decompose(grip.position,grip.rotation,grip.scale);\n\nif(gripPose.linearVelocity){\n\ngrip.hasLinearVelocity=true;\ngrip.linearVelocity.copy(gripPose.linearVelocity);\n\n}else{\n\ngrip.hasLinearVelocity=false;\n\n}\n\nif(gripPose.angularVelocity){\n\ngrip.hasAngularVelocity=true;\ngrip.angularVelocity.copy(gripPose.angularVelocity);\n\n}else{\n\ngrip.hasAngularVelocity=false;\n\n}\n\n}\n\n}\n\n}\n\nif(targetRay!==null){\n\ninputPose=frame.getPose(inputSource.targetRaySpace,referenceSpace);\n\n// Some runtimes (namely Vive Cosmos with Vive OpenXR Runtime) have only grip space and ray space is equal to it\nif(inputPose===null&&gripPose!==null){\n\ninputPose=gripPose;\n\n}\n\nif(inputPose!==null){\n\ntargetRay.matrix.fromArray(inputPose.transform.matrix);\ntargetRay.matrix.decompose(targetRay.position,targetRay.rotation,targetRay.scale);\n\nif(inputPose.linearVelocity){\n\ntargetRay.hasLinearVelocity=true;\ntargetRay.linearVelocity.copy(inputPose.linearVelocity);\n\n}else{\n\ntargetRay.hasLinearVelocity=false;\n\n}\n\nif(inputPose.angularVelocity){\n\ntargetRay.hasAngularVelocity=true;\ntargetRay.angularVelocity.copy(inputPose.angularVelocity);\n\n}else{\n\ntargetRay.hasAngularVelocity=false;\n\n}\n\nthis.dispatchEvent(_moveEvent);\n\n}\n\n}\n\n\n}\n\nif(targetRay!==null){\n\ntargetRay.visible=inputPose!==null;\n\n}\n\nif(grip!==null){\n\ngrip.visible=gripPose!==null;\n\n}\n\nif(hand!==null){\n\nhand.visible=handPose!==null;\n\n}\n\nreturn this;\n\n}}]);return WebXRController;}();var\n\n\n\nDepthTexture=function(_Texture4){_inherits(DepthTexture,_Texture4);\n\nfunction DepthTexture(width,height,type,mapping,wrapS,wrapT,magFilter,minFilter,anisotropy,format){_classCallCheck(this,DepthTexture);\n\nformat=format!==undefined?format:DepthFormat;\n\nif(format!==DepthFormat&&format!==DepthStencilFormat){\n\nthrow new Error('DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat');\n\n}\n\nif(type===undefined&&format===DepthFormat)type=UnsignedIntType;\nif(type===undefined&&format===DepthStencilFormat)type=UnsignedInt248Type;var _this37=_possibleConstructorReturn(this,(DepthTexture.__proto__||Object.getPrototypeOf(DepthTexture)).call(this,\n\nnull,mapping,wrapS,wrapT,magFilter,minFilter,format,type,anisotropy));\n\n_this37.isDepthTexture=true;\n\n_this37.image={width:width,height:height};\n\n_this37.magFilter=magFilter!==undefined?magFilter:NearestFilter;\n_this37.minFilter=minFilter!==undefined?minFilter:NearestFilter;\n\n_this37.flipY=false;\n_this37.generateMipmaps=false;return _this37;\n\n}return DepthTexture;}(Texture);var\n\n\n\n\nWebXRManager=function(_EventDispatcher6){_inherits(WebXRManager,_EventDispatcher6);\n\nfunction WebXRManager(renderer,gl){_classCallCheck(this,WebXRManager);var _this38=_possibleConstructorReturn(this,(WebXRManager.__proto__||Object.getPrototypeOf(WebXRManager)).call(this));\n\n\n\nvar scope=_this38;\n\nvar session=null;\nvar framebufferScaleFactor=1.0;\n\nvar referenceSpace=null;\nvar referenceSpaceType='local-floor';\nvar customReferenceSpace=null;\n\nvar pose=null;\nvar glBinding=null;\nvar glProjLayer=null;\nvar glBaseLayer=null;\nvar xrFrame=null;\nvar attributes=gl.getContextAttributes();\nvar initialRenderTarget=null;\nvar newRenderTarget=null;\n\nvar controllers=[];\nvar controllerInputSources=[];\n\n//\n\nvar cameraL=new PerspectiveCamera();\ncameraL.layers.enable(1);\ncameraL.viewport=new Vector4();\n\nvar cameraR=new PerspectiveCamera();\ncameraR.layers.enable(2);\ncameraR.viewport=new Vector4();\n\nvar cameras=[cameraL,cameraR];\n\nvar cameraVR=new ArrayCamera();\ncameraVR.layers.enable(1);\ncameraVR.layers.enable(2);\n\nvar _currentDepthNear=null;\nvar _currentDepthFar=null;\n\n//\n\n_this38.cameraAutoUpdate=true;\n_this38.enabled=false;\n\n_this38.isPresenting=false;\n\n_this38.getController=function(index){\n\nvar controller=controllers[index];\n\nif(controller===undefined){\n\ncontroller=new WebXRController();\ncontrollers[index]=controller;\n\n}\n\nreturn controller.getTargetRaySpace();\n\n};\n\n_this38.getControllerGrip=function(index){\n\nvar controller=controllers[index];\n\nif(controller===undefined){\n\ncontroller=new WebXRController();\ncontrollers[index]=controller;\n\n}\n\nreturn controller.getGripSpace();\n\n};\n\n_this38.getHand=function(index){\n\nvar controller=controllers[index];\n\nif(controller===undefined){\n\ncontroller=new WebXRController();\ncontrollers[index]=controller;\n\n}\n\nreturn controller.getHandSpace();\n\n};\n\n//\n\nfunction onSessionEvent(event){\n\nvar controllerIndex=controllerInputSources.indexOf(event.inputSource);\n\nif(controllerIndex===-1){\n\nreturn;\n\n}\n\nvar controller=controllers[controllerIndex];\n\nif(controller!==undefined){\n\ncontroller.dispatchEvent({type:event.type,data:event.inputSource});\n\n}\n\n}\n\nfunction onSessionEnd(){\n\nsession.removeEventListener('select',onSessionEvent);\nsession.removeEventListener('selectstart',onSessionEvent);\nsession.removeEventListener('selectend',onSessionEvent);\nsession.removeEventListener('squeeze',onSessionEvent);\nsession.removeEventListener('squeezestart',onSessionEvent);\nsession.removeEventListener('squeezeend',onSessionEvent);\nsession.removeEventListener('end',onSessionEnd);\nsession.removeEventListener('inputsourceschange',onInputSourcesChange);\n\nfor(var i=0;i<controllers.length;i++){\n\nvar inputSource=controllerInputSources[i];\n\nif(inputSource===null)continue;\n\ncontrollerInputSources[i]=null;\n\ncontrollers[i].disconnect(inputSource);\n\n}\n\n_currentDepthNear=null;\n_currentDepthFar=null;\n\n// restore framebuffer/rendering state\n\nrenderer.setRenderTarget(initialRenderTarget);\n\nglBaseLayer=null;\nglProjLayer=null;\nglBinding=null;\nsession=null;\nnewRenderTarget=null;\n\n//\n\nanimation.stop();\n\nscope.isPresenting=false;\n\nscope.dispatchEvent({type:'sessionend'});\n\n}\n\n_this38.setFramebufferScaleFactor=function(value){\n\nframebufferScaleFactor=value;\n\nif(scope.isPresenting===true){\n\nconsole.warn('THREE.WebXRManager: Cannot change framebuffer scale while presenting.');\n\n}\n\n};\n\n_this38.setReferenceSpaceType=function(value){\n\nreferenceSpaceType=value;\n\nif(scope.isPresenting===true){\n\nconsole.warn('THREE.WebXRManager: Cannot change reference space type while presenting.');\n\n}\n\n};\n\n_this38.getReferenceSpace=function(){\n\nreturn customReferenceSpace||referenceSpace;\n\n};\n\n_this38.setReferenceSpace=function(space){\n\ncustomReferenceSpace=space;\n\n};\n\n_this38.getBaseLayer=function(){\n\nreturn glProjLayer!==null?glProjLayer:glBaseLayer;\n\n};\n\n_this38.getBinding=function(){\n\nreturn glBinding;\n\n};\n\n_this38.getFrame=function(){\n\nreturn xrFrame;\n\n};\n\n_this38.getSession=function(){\n\nreturn session;\n\n};\n\n_this38.setSession=async function(value){\n\nsession=value;\n\nif(session!==null){\n\ninitialRenderTarget=renderer.getRenderTarget();\n\nsession.addEventListener('select',onSessionEvent);\nsession.addEventListener('selectstart',onSessionEvent);\nsession.addEventListener('selectend',onSessionEvent);\nsession.addEventListener('squeeze',onSessionEvent);\nsession.addEventListener('squeezestart',onSessionEvent);\nsession.addEventListener('squeezeend',onSessionEvent);\nsession.addEventListener('end',onSessionEnd);\nsession.addEventListener('inputsourceschange',onInputSourcesChange);\n\nif(attributes.xrCompatible!==true){\n\nawait gl.makeXRCompatible();\n\n}\n\nif(session.renderState.layers===undefined||renderer.capabilities.isWebGL2===false){\n\nvar layerInit={\nantialias:session.renderState.layers===undefined?attributes.antialias:true,\nalpha:attributes.alpha,\ndepth:attributes.depth,\nstencil:attributes.stencil,\nframebufferScaleFactor:framebufferScaleFactor};\n\n\nglBaseLayer=new XRWebGLLayer(session,gl,layerInit);\n\nsession.updateRenderState({baseLayer:glBaseLayer});\n\nnewRenderTarget=new WebGLRenderTarget(\nglBaseLayer.framebufferWidth,\nglBaseLayer.framebufferHeight,\n{\nformat:RGBAFormat,\ntype:UnsignedByteType,\nencoding:renderer.outputEncoding});\n\n\n\n}else{\n\nvar depthFormat=null;\nvar depthType=null;\nvar glDepthFormat=null;\n\nif(attributes.depth){\n\nglDepthFormat=attributes.stencil?35056:33190;\ndepthFormat=attributes.stencil?DepthStencilFormat:DepthFormat;\ndepthType=attributes.stencil?UnsignedInt248Type:UnsignedIntType;\n\n}\n\nvar projectionlayerInit={\ncolorFormat:32856,\ndepthFormat:glDepthFormat,\nscaleFactor:framebufferScaleFactor};\n\n\nglBinding=new XRWebGLBinding(session,gl);\n\nglProjLayer=glBinding.createProjectionLayer(projectionlayerInit);\n\nsession.updateRenderState({layers:[glProjLayer]});\n\nnewRenderTarget=new WebGLRenderTarget(\nglProjLayer.textureWidth,\nglProjLayer.textureHeight,\n{\nformat:RGBAFormat,\ntype:UnsignedByteType,\ndepthTexture:new DepthTexture(glProjLayer.textureWidth,glProjLayer.textureHeight,depthType,undefined,undefined,undefined,undefined,undefined,undefined,depthFormat),\nstencilBuffer:attributes.stencil,\nencoding:renderer.outputEncoding,\nsamples:attributes.antialias?4:0});\n\n\nvar renderTargetProperties=renderer.properties.get(newRenderTarget);\nrenderTargetProperties.__ignoreDepthValues=glProjLayer.ignoreDepthValues;\n\n}\n\nnewRenderTarget.isXRRenderTarget=true;// TODO Remove this when possible, see #23278\n\n// Set foveation to maximum.\nthis.setFoveation(1.0);\n\ncustomReferenceSpace=null;\nreferenceSpace=await session.requestReferenceSpace(referenceSpaceType);\n\nanimation.setContext(session);\nanimation.start();\n\nscope.isPresenting=true;\n\nscope.dispatchEvent({type:'sessionstart'});\n\n}\n\n};\n\nfunction onInputSourcesChange(event){\n\n// Notify disconnected\n\nfor(var i=0;i<event.removed.length;i++){\n\nvar inputSource=event.removed[i];\nvar index=controllerInputSources.indexOf(inputSource);\n\nif(index>=0){\n\ncontrollerInputSources[index]=null;\ncontrollers[index].dispatchEvent({type:'disconnected',data:inputSource});\n\n}\n\n}\n\n// Notify connected\n\nfor(var _i47=0;_i47<event.added.length;_i47++){\n\nvar _inputSource=event.added[_i47];\n\nvar controllerIndex=controllerInputSources.indexOf(_inputSource);\n\nif(controllerIndex===-1){\n\n// Assign input source a controller that currently has no input source\n\nfor(var _i48=0;_i48<controllers.length;_i48++){\n\nif(_i48>=controllerInputSources.length){\n\ncontrollerInputSources.push(_inputSource);\ncontrollerIndex=_i48;\nbreak;\n\n}else if(controllerInputSources[_i48]===null){\n\ncontrollerInputSources[_i48]=_inputSource;\ncontrollerIndex=_i48;\nbreak;\n\n}\n\n}\n\n// If all controllers do currently receive input we ignore new ones\n\nif(controllerIndex===-1)break;\n\n}\n\nvar controller=controllers[controllerIndex];\n\nif(controller){\n\ncontroller.dispatchEvent({type:'connected',data:_inputSource});\n\n}\n\n}\n\n}\n\n//\n\nvar cameraLPos=new Vector3();\nvar cameraRPos=new Vector3();\n\n/**\n\t\t * Assumes 2 cameras that are parallel and share an X-axis, and that\n\t\t * the cameras' projection and world matrices have already been set.\n\t\t * And that near and far planes are identical for both cameras.\n\t\t * Visualization of this technique: https://computergraphics.stackexchange.com/a/4765\n\t\t */\nfunction setProjectionFromUnion(camera,cameraL,cameraR){\n\ncameraLPos.setFromMatrixPosition(cameraL.matrixWorld);\ncameraRPos.setFromMatrixPosition(cameraR.matrixWorld);\n\nvar ipd=cameraLPos.distanceTo(cameraRPos);\n\nvar projL=cameraL.projectionMatrix.elements;\nvar projR=cameraR.projectionMatrix.elements;\n\n// VR systems will have identical far and near planes, and\n// most likely identical top and bottom frustum extents.\n// Use the left camera for these values.\nvar near=projL[14]/(projL[10]-1);\nvar far=projL[14]/(projL[10]+1);\nvar topFov=(projL[9]+1)/projL[5];\nvar bottomFov=(projL[9]-1)/projL[5];\n\nvar leftFov=(projL[8]-1)/projL[0];\nvar rightFov=(projR[8]+1)/projR[0];\nvar left=near*leftFov;\nvar right=near*rightFov;\n\n// Calculate the new camera's position offset from the\n// left camera. xOffset should be roughly half `ipd`.\nvar zOffset=ipd/(-leftFov+rightFov);\nvar xOffset=zOffset*-leftFov;\n\n// TODO: Better way to apply this offset?\ncameraL.matrixWorld.decompose(camera.position,camera.quaternion,camera.scale);\ncamera.translateX(xOffset);\ncamera.translateZ(zOffset);\ncamera.matrixWorld.compose(camera.position,camera.quaternion,camera.scale);\ncamera.matrixWorldInverse.copy(camera.matrixWorld).invert();\n\n// Find the union of the frustum values of the cameras and scale\n// the values so that the near plane's position does not change in world space,\n// although must now be relative to the new union camera.\nvar near2=near+zOffset;\nvar far2=far+zOffset;\nvar left2=left-xOffset;\nvar right2=right+(ipd-xOffset);\nvar top2=topFov*far/far2*near2;\nvar bottom2=bottomFov*far/far2*near2;\n\ncamera.projectionMatrix.makePerspective(left2,right2,top2,bottom2,near2,far2);\n\n}\n\nfunction updateCamera(camera,parent){\n\nif(parent===null){\n\ncamera.matrixWorld.copy(camera.matrix);\n\n}else{\n\ncamera.matrixWorld.multiplyMatrices(parent.matrixWorld,camera.matrix);\n\n}\n\ncamera.matrixWorldInverse.copy(camera.matrixWorld).invert();\n\n}\n\n_this38.updateCamera=function(camera){\n\nif(session===null)return;\n\ncameraVR.near=cameraR.near=cameraL.near=camera.near;\ncameraVR.far=cameraR.far=cameraL.far=camera.far;\n\nif(_currentDepthNear!==cameraVR.near||_currentDepthFar!==cameraVR.far){\n\n// Note that the new renderState won't apply until the next frame. See #18320\n\nsession.updateRenderState({\ndepthNear:cameraVR.near,\ndepthFar:cameraVR.far});\n\n\n_currentDepthNear=cameraVR.near;\n_currentDepthFar=cameraVR.far;\n\n}\n\nvar parent=camera.parent;\nvar cameras=cameraVR.cameras;\n\nupdateCamera(cameraVR,parent);\n\nfor(var i=0;i<cameras.length;i++){\n\nupdateCamera(cameras[i],parent);\n\n}\n\ncameraVR.matrixWorld.decompose(cameraVR.position,cameraVR.quaternion,cameraVR.scale);\n\n// update user camera and its children\n\ncamera.position.copy(cameraVR.position);\ncamera.quaternion.copy(cameraVR.quaternion);\ncamera.scale.copy(cameraVR.scale);\ncamera.matrix.copy(cameraVR.matrix);\ncamera.matrixWorld.copy(cameraVR.matrixWorld);\n\nvar children=camera.children;\n\nfor(var _i49=0,l=children.length;_i49<l;_i49++){\n\nchildren[_i49].updateMatrixWorld(true);\n\n}\n\n// update projection matrix for proper view frustum culling\n\nif(cameras.length===2){\n\nsetProjectionFromUnion(cameraVR,cameraL,cameraR);\n\n}else{\n\n// assume single camera setup (AR)\n\ncameraVR.projectionMatrix.copy(cameraL.projectionMatrix);\n\n}\n\n};\n\n_this38.getCamera=function(){\n\nreturn cameraVR;\n\n};\n\n_this38.getFoveation=function(){\n\nif(glProjLayer!==null){\n\nreturn glProjLayer.fixedFoveation;\n\n}\n\nif(glBaseLayer!==null){\n\nreturn glBaseLayer.fixedFoveation;\n\n}\n\nreturn undefined;\n\n};\n\n_this38.setFoveation=function(foveation){\n\n// 0 = no foveation = full resolution\n// 1 = maximum foveation = the edges render at lower resolution\n\nif(glProjLayer!==null){\n\nglProjLayer.fixedFoveation=foveation;\n\n}\n\nif(glBaseLayer!==null&&glBaseLayer.fixedFoveation!==undefined){\n\nglBaseLayer.fixedFoveation=foveation;\n\n}\n\n};\n\n// Animation Loop\n\nvar onAnimationFrameCallback=null;\n\nfunction onAnimationFrame(time,frame){\n\npose=frame.getViewerPose(customReferenceSpace||referenceSpace);\nxrFrame=frame;\n\nif(pose!==null){\n\nvar views=pose.views;\n\nif(glBaseLayer!==null){\n\nrenderer.setRenderTargetFramebuffer(newRenderTarget,glBaseLayer.framebuffer);\nrenderer.setRenderTarget(newRenderTarget);\n\n}\n\nvar cameraVRNeedsUpdate=false;\n\n// check if it's necessary to rebuild cameraVR's camera list\n\nif(views.length!==cameraVR.cameras.length){\n\ncameraVR.cameras.length=0;\ncameraVRNeedsUpdate=true;\n\n}\n\nfor(var i=0;i<views.length;i++){\n\nvar view=views[i];\n\nvar viewport=null;\n\nif(glBaseLayer!==null){\n\nviewport=glBaseLayer.getViewport(view);\n\n}else{\n\nvar glSubImage=glBinding.getViewSubImage(glProjLayer,view);\nviewport=glSubImage.viewport;\n\n// For side-by-side projection, we only produce a single texture for both eyes.\nif(i===0){\n\nrenderer.setRenderTargetTextures(\nnewRenderTarget,\nglSubImage.colorTexture,\nglProjLayer.ignoreDepthValues?undefined:glSubImage.depthStencilTexture);\n\nrenderer.setRenderTarget(newRenderTarget);\n\n}\n\n}\n\nvar camera=cameras[i];\n\nif(camera===undefined){\n\ncamera=new PerspectiveCamera();\ncamera.layers.enable(i);\ncamera.viewport=new Vector4();\ncameras[i]=camera;\n\n}\n\ncamera.matrix.fromArray(view.transform.matrix);\ncamera.projectionMatrix.fromArray(view.projectionMatrix);\ncamera.viewport.set(viewport.x,viewport.y,viewport.width,viewport.height);\n\nif(i===0){\n\ncameraVR.matrix.copy(camera.matrix);\n\n}\n\nif(cameraVRNeedsUpdate===true){\n\ncameraVR.cameras.push(camera);\n\n}\n\n}\n\n}\n\n//\n\nfor(var _i50=0;_i50<controllers.length;_i50++){\n\nvar inputSource=controllerInputSources[_i50];\nvar controller=controllers[_i50];\n\nif(inputSource!==null&&controller!==undefined){\n\ncontroller.update(inputSource,frame,customReferenceSpace||referenceSpace);\n\n}\n\n}\n\nif(onAnimationFrameCallback)onAnimationFrameCallback(time,frame);\n\nxrFrame=null;\n\n}\n\nvar animation=new WebGLAnimation();\n\nanimation.setAnimationLoop(onAnimationFrame);\n\n_this38.setAnimationLoop=function(callback){\n\nonAnimationFrameCallback=callback;\n\n};\n\n_this38.dispose=function(){};return _this38;\n\n}return WebXRManager;}(EventDispatcher);\n\n\n\nfunction WebGLMaterials(renderer,properties){\n\nfunction refreshFogUniforms(uniforms,fog){\n\nuniforms.fogColor.value.copy(fog.color);\n\nif(fog.isFog){\n\nuniforms.fogNear.value=fog.near;\nuniforms.fogFar.value=fog.far;\n\n}else if(fog.isFogExp2){\n\nuniforms.fogDensity.value=fog.density;\n\n}\n\n}\n\nfunction refreshMaterialUniforms(uniforms,material,pixelRatio,height,transmissionRenderTarget){\n\nif(material.isMeshBasicMaterial){\n\nrefreshUniformsCommon(uniforms,material);\n\n}else if(material.isMeshLambertMaterial){\n\nrefreshUniformsCommon(uniforms,material);\n\n}else if(material.isMeshToonMaterial){\n\nrefreshUniformsCommon(uniforms,material);\nrefreshUniformsToon(uniforms,material);\n\n}else if(material.isMeshPhongMaterial){\n\nrefreshUniformsCommon(uniforms,material);\nrefreshUniformsPhong(uniforms,material);\n\n}else if(material.isMeshStandardMaterial){\n\nrefreshUniformsCommon(uniforms,material);\nrefreshUniformsStandard(uniforms,material);\n\nif(material.isMeshPhysicalMaterial){\n\nrefreshUniformsPhysical(uniforms,material,transmissionRenderTarget);\n\n}\n\n}else if(material.isMeshMatcapMaterial){\n\nrefreshUniformsCommon(uniforms,material);\nrefreshUniformsMatcap(uniforms,material);\n\n}else if(material.isMeshDepthMaterial){\n\nrefreshUniformsCommon(uniforms,material);\n\n}else if(material.isMeshDistanceMaterial){\n\nrefreshUniformsCommon(uniforms,material);\nrefreshUniformsDistance(uniforms,material);\n\n}else if(material.isMeshNormalMaterial){\n\nrefreshUniformsCommon(uniforms,material);\n\n}else if(material.isLineBasicMaterial){\n\nrefreshUniformsLine(uniforms,material);\n\nif(material.isLineDashedMaterial){\n\nrefreshUniformsDash(uniforms,material);\n\n}\n\n}else if(material.isPointsMaterial){\n\nrefreshUniformsPoints(uniforms,material,pixelRatio,height);\n\n}else if(material.isSpriteMaterial){\n\nrefreshUniformsSprites(uniforms,material);\n\n}else if(material.isShadowMaterial){\n\nuniforms.color.value.copy(material.color);\nuniforms.opacity.value=material.opacity;\n\n}else if(material.isShaderMaterial){\n\nmaterial.uniformsNeedUpdate=false;// #15581\n\n}\n\n}\n\nfunction refreshUniformsCommon(uniforms,material){\n\nuniforms.opacity.value=material.opacity;\n\nif(material.color){\n\nuniforms.diffuse.value.copy(material.color);\n\n}\n\nif(material.emissive){\n\nuniforms.emissive.value.copy(material.emissive).multiplyScalar(material.emissiveIntensity);\n\n}\n\nif(material.map){\n\nuniforms.map.value=material.map;\n\n}\n\nif(material.alphaMap){\n\nuniforms.alphaMap.value=material.alphaMap;\n\n}\n\nif(material.bumpMap){\n\nuniforms.bumpMap.value=material.bumpMap;\nuniforms.bumpScale.value=material.bumpScale;\nif(material.side===BackSide)uniforms.bumpScale.value*=-1;\n\n}\n\nif(material.displacementMap){\n\nuniforms.displacementMap.value=material.displacementMap;\nuniforms.displacementScale.value=material.displacementScale;\nuniforms.displacementBias.value=material.displacementBias;\n\n}\n\nif(material.emissiveMap){\n\nuniforms.emissiveMap.value=material.emissiveMap;\n\n}\n\nif(material.normalMap){\n\nuniforms.normalMap.value=material.normalMap;\nuniforms.normalScale.value.copy(material.normalScale);\nif(material.side===BackSide)uniforms.normalScale.value.negate();\n\n}\n\nif(material.specularMap){\n\nuniforms.specularMap.value=material.specularMap;\n\n}\n\nif(material.alphaTest>0){\n\nuniforms.alphaTest.value=material.alphaTest;\n\n}\n\nvar envMap=properties.get(material).envMap;\n\nif(envMap){\n\nuniforms.envMap.value=envMap;\n\nuniforms.flipEnvMap.value=envMap.isCubeTexture&&envMap.isRenderTargetTexture===false?-1:1;\n\nuniforms.reflectivity.value=material.reflectivity;\nuniforms.ior.value=material.ior;\nuniforms.refractionRatio.value=material.refractionRatio;\n\n}\n\nif(material.lightMap){\n\nuniforms.lightMap.value=material.lightMap;\n\n// artist-friendly light intensity scaling factor\nvar scaleFactor=renderer.physicallyCorrectLights!==true?Math.PI:1;\n\nuniforms.lightMapIntensity.value=material.lightMapIntensity*scaleFactor;\n\n}\n\nif(material.aoMap){\n\nuniforms.aoMap.value=material.aoMap;\nuniforms.aoMapIntensity.value=material.aoMapIntensity;\n\n}\n\n// uv repeat and offset setting priorities\n// 1. color map\n// 2. specular map\n// 3. displacementMap map\n// 4. normal map\n// 5. bump map\n// 6. roughnessMap map\n// 7. metalnessMap map\n// 8. alphaMap map\n// 9. emissiveMap map\n// 10. clearcoat map\n// 11. clearcoat normal map\n// 12. clearcoat roughnessMap map\n// 13. iridescence map\n// 14. iridescence thickness map\n// 15. specular intensity map\n// 16. specular tint map\n// 17. transmission map\n// 18. thickness map\n\nvar uvScaleMap=void 0;\n\nif(material.map){\n\nuvScaleMap=material.map;\n\n}else if(material.specularMap){\n\nuvScaleMap=material.specularMap;\n\n}else if(material.displacementMap){\n\nuvScaleMap=material.displacementMap;\n\n}else if(material.normalMap){\n\nuvScaleMap=material.normalMap;\n\n}else if(material.bumpMap){\n\nuvScaleMap=material.bumpMap;\n\n}else if(material.roughnessMap){\n\nuvScaleMap=material.roughnessMap;\n\n}else if(material.metalnessMap){\n\nuvScaleMap=material.metalnessMap;\n\n}else if(material.alphaMap){\n\nuvScaleMap=material.alphaMap;\n\n}else if(material.emissiveMap){\n\nuvScaleMap=material.emissiveMap;\n\n}else if(material.clearcoatMap){\n\nuvScaleMap=material.clearcoatMap;\n\n}else if(material.clearcoatNormalMap){\n\nuvScaleMap=material.clearcoatNormalMap;\n\n}else if(material.clearcoatRoughnessMap){\n\nuvScaleMap=material.clearcoatRoughnessMap;\n\n}else if(material.iridescenceMap){\n\nuvScaleMap=material.iridescenceMap;\n\n}else if(material.iridescenceThicknessMap){\n\nuvScaleMap=material.iridescenceThicknessMap;\n\n}else if(material.specularIntensityMap){\n\nuvScaleMap=material.specularIntensityMap;\n\n}else if(material.specularColorMap){\n\nuvScaleMap=material.specularColorMap;\n\n}else if(material.transmissionMap){\n\nuvScaleMap=material.transmissionMap;\n\n}else if(material.thicknessMap){\n\nuvScaleMap=material.thicknessMap;\n\n}else if(material.sheenColorMap){\n\nuvScaleMap=material.sheenColorMap;\n\n}else if(material.sheenRoughnessMap){\n\nuvScaleMap=material.sheenRoughnessMap;\n\n}\n\nif(uvScaleMap!==undefined){\n\n// backwards compatibility\nif(uvScaleMap.isWebGLRenderTarget){\n\nuvScaleMap=uvScaleMap.texture;\n\n}\n\nif(uvScaleMap.matrixAutoUpdate===true){\n\nuvScaleMap.updateMatrix();\n\n}\n\nuniforms.uvTransform.value.copy(uvScaleMap.matrix);\n\n}\n\n// uv repeat and offset setting priorities for uv2\n// 1. ao map\n// 2. light map\n\nvar uv2ScaleMap=void 0;\n\nif(material.aoMap){\n\nuv2ScaleMap=material.aoMap;\n\n}else if(material.lightMap){\n\nuv2ScaleMap=material.lightMap;\n\n}\n\nif(uv2ScaleMap!==undefined){\n\n// backwards compatibility\nif(uv2ScaleMap.isWebGLRenderTarget){\n\nuv2ScaleMap=uv2ScaleMap.texture;\n\n}\n\nif(uv2ScaleMap.matrixAutoUpdate===true){\n\nuv2ScaleMap.updateMatrix();\n\n}\n\nuniforms.uv2Transform.value.copy(uv2ScaleMap.matrix);\n\n}\n\n}\n\nfunction refreshUniformsLine(uniforms,material){\n\nuniforms.diffuse.value.copy(material.color);\nuniforms.opacity.value=material.opacity;\n\n}\n\nfunction refreshUniformsDash(uniforms,material){\n\nuniforms.dashSize.value=material.dashSize;\nuniforms.totalSize.value=material.dashSize+material.gapSize;\nuniforms.scale.value=material.scale;\n\n}\n\nfunction refreshUniformsPoints(uniforms,material,pixelRatio,height){\n\nuniforms.diffuse.value.copy(material.color);\nuniforms.opacity.value=material.opacity;\nuniforms.size.value=material.size*pixelRatio;\nuniforms.scale.value=height*0.5;\n\nif(material.map){\n\nuniforms.map.value=material.map;\n\n}\n\nif(material.alphaMap){\n\nuniforms.alphaMap.value=material.alphaMap;\n\n}\n\nif(material.alphaTest>0){\n\nuniforms.alphaTest.value=material.alphaTest;\n\n}\n\n// uv repeat and offset setting priorities\n// 1. color map\n// 2. alpha map\n\nvar uvScaleMap=void 0;\n\nif(material.map){\n\nuvScaleMap=material.map;\n\n}else if(material.alphaMap){\n\nuvScaleMap=material.alphaMap;\n\n}\n\nif(uvScaleMap!==undefined){\n\nif(uvScaleMap.matrixAutoUpdate===true){\n\nuvScaleMap.updateMatrix();\n\n}\n\nuniforms.uvTransform.value.copy(uvScaleMap.matrix);\n\n}\n\n}\n\nfunction refreshUniformsSprites(uniforms,material){\n\nuniforms.diffuse.value.copy(material.color);\nuniforms.opacity.value=material.opacity;\nuniforms.rotation.value=material.rotation;\n\nif(material.map){\n\nuniforms.map.value=material.map;\n\n}\n\nif(material.alphaMap){\n\nuniforms.alphaMap.value=material.alphaMap;\n\n}\n\nif(material.alphaTest>0){\n\nuniforms.alphaTest.value=material.alphaTest;\n\n}\n\n// uv repeat and offset setting priorities\n// 1. color map\n// 2. alpha map\n\nvar uvScaleMap=void 0;\n\nif(material.map){\n\nuvScaleMap=material.map;\n\n}else if(material.alphaMap){\n\nuvScaleMap=material.alphaMap;\n\n}\n\nif(uvScaleMap!==undefined){\n\nif(uvScaleMap.matrixAutoUpdate===true){\n\nuvScaleMap.updateMatrix();\n\n}\n\nuniforms.uvTransform.value.copy(uvScaleMap.matrix);\n\n}\n\n}\n\nfunction refreshUniformsPhong(uniforms,material){\n\nuniforms.specular.value.copy(material.specular);\nuniforms.shininess.value=Math.max(material.shininess,1e-4);// to prevent pow( 0.0, 0.0 )\n\n}\n\nfunction refreshUniformsToon(uniforms,material){\n\nif(material.gradientMap){\n\nuniforms.gradientMap.value=material.gradientMap;\n\n}\n\n}\n\nfunction refreshUniformsStandard(uniforms,material){\n\nuniforms.roughness.value=material.roughness;\nuniforms.metalness.value=material.metalness;\n\nif(material.roughnessMap){\n\nuniforms.roughnessMap.value=material.roughnessMap;\n\n}\n\nif(material.metalnessMap){\n\nuniforms.metalnessMap.value=material.metalnessMap;\n\n}\n\nvar envMap=properties.get(material).envMap;\n\nif(envMap){\n\n//uniforms.envMap.value = material.envMap; // part of uniforms common\nuniforms.envMapIntensity.value=material.envMapIntensity;\n\n}\n\n}\n\nfunction refreshUniformsPhysical(uniforms,material,transmissionRenderTarget){\n\nuniforms.ior.value=material.ior;// also part of uniforms common\n\nif(material.sheen>0){\n\nuniforms.sheenColor.value.copy(material.sheenColor).multiplyScalar(material.sheen);\n\nuniforms.sheenRoughness.value=material.sheenRoughness;\n\nif(material.sheenColorMap){\n\nuniforms.sheenColorMap.value=material.sheenColorMap;\n\n}\n\nif(material.sheenRoughnessMap){\n\nuniforms.sheenRoughnessMap.value=material.sheenRoughnessMap;\n\n}\n\n}\n\nif(material.clearcoat>0){\n\nuniforms.clearcoat.value=material.clearcoat;\nuniforms.clearcoatRoughness.value=material.clearcoatRoughness;\n\nif(material.clearcoatMap){\n\nuniforms.clearcoatMap.value=material.clearcoatMap;\n\n}\n\nif(material.clearcoatRoughnessMap){\n\nuniforms.clearcoatRoughnessMap.value=material.clearcoatRoughnessMap;\n\n}\n\nif(material.clearcoatNormalMap){\n\nuniforms.clearcoatNormalScale.value.copy(material.clearcoatNormalScale);\nuniforms.clearcoatNormalMap.value=material.clearcoatNormalMap;\n\nif(material.side===BackSide){\n\nuniforms.clearcoatNormalScale.value.negate();\n\n}\n\n}\n\n}\n\nif(material.iridescence>0){\n\nuniforms.iridescence.value=material.iridescence;\nuniforms.iridescenceIOR.value=material.iridescenceIOR;\nuniforms.iridescenceThicknessMinimum.value=material.iridescenceThicknessRange[0];\nuniforms.iridescenceThicknessMaximum.value=material.iridescenceThicknessRange[1];\n\nif(material.iridescenceMap){\n\nuniforms.iridescenceMap.value=material.iridescenceMap;\n\n}\n\nif(material.iridescenceThicknessMap){\n\nuniforms.iridescenceThicknessMap.value=material.iridescenceThicknessMap;\n\n}\n\n}\n\nif(material.transmission>0){\n\nuniforms.transmission.value=material.transmission;\nuniforms.transmissionSamplerMap.value=transmissionRenderTarget.texture;\nuniforms.transmissionSamplerSize.value.set(transmissionRenderTarget.width,transmissionRenderTarget.height);\n\nif(material.transmissionMap){\n\nuniforms.transmissionMap.value=material.transmissionMap;\n\n}\n\nuniforms.thickness.value=material.thickness;\n\nif(material.thicknessMap){\n\nuniforms.thicknessMap.value=material.thicknessMap;\n\n}\n\nuniforms.attenuationDistance.value=material.attenuationDistance;\nuniforms.attenuationColor.value.copy(material.attenuationColor);\n\n}\n\nuniforms.specularIntensity.value=material.specularIntensity;\nuniforms.specularColor.value.copy(material.specularColor);\n\nif(material.specularIntensityMap){\n\nuniforms.specularIntensityMap.value=material.specularIntensityMap;\n\n}\n\nif(material.specularColorMap){\n\nuniforms.specularColorMap.value=material.specularColorMap;\n\n}\n\n}\n\nfunction refreshUniformsMatcap(uniforms,material){\n\nif(material.matcap){\n\nuniforms.matcap.value=material.matcap;\n\n}\n\n}\n\nfunction refreshUniformsDistance(uniforms,material){\n\nuniforms.referencePosition.value.copy(material.referencePosition);\nuniforms.nearDistance.value=material.nearDistance;\nuniforms.farDistance.value=material.farDistance;\n\n}\n\nreturn{\nrefreshFogUniforms:refreshFogUniforms,\nrefreshMaterialUniforms:refreshMaterialUniforms};\n\n\n}\n\nfunction createCanvasElement(){\n\nvar canvas=createElementNS('canvas');\ncanvas.style.display='block';\nreturn canvas;\n\n}\n\nfunction WebGLRenderer(){var parameters=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};\n\nthis.isWebGLRenderer=true;\n\nvar _canvas=parameters.canvas!==undefined?parameters.canvas:createCanvasElement(),\n_context=parameters.context!==undefined?parameters.context:null,\n\n_depth=parameters.depth!==undefined?parameters.depth:true,\n_stencil=parameters.stencil!==undefined?parameters.stencil:true,\n_antialias=parameters.antialias!==undefined?parameters.antialias:false,\n_premultipliedAlpha=parameters.premultipliedAlpha!==undefined?parameters.premultipliedAlpha:true,\n_preserveDrawingBuffer=parameters.preserveDrawingBuffer!==undefined?parameters.preserveDrawingBuffer:false,\n_powerPreference=parameters.powerPreference!==undefined?parameters.powerPreference:'default',\n_failIfMajorPerformanceCaveat=parameters.failIfMajorPerformanceCaveat!==undefined?parameters.failIfMajorPerformanceCaveat:false;\n\nvar _alpha=void 0;\n\nif(_context!==null){\n\n_alpha=_context.getContextAttributes().alpha;\n\n}else{\n\n_alpha=parameters.alpha!==undefined?parameters.alpha:false;\n\n}\n\nvar currentRenderList=null;\nvar currentRenderState=null;\n\n// render() can be called from within a callback triggered by another render.\n// We track this so that the nested render call gets its list and state isolated from the parent render call.\n\nvar renderListStack=[];\nvar renderStateStack=[];\n\n// public properties\n\nthis.domElement=_canvas;\n\n// Debug configuration container\nthis.debug={\n\n/**\n\t\t * Enables error checking and reporting when shader programs are being compiled\n\t\t * @type {boolean}\n\t\t */\ncheckShaderErrors:true};\n\n\n// clearing\n\nthis.autoClear=true;\nthis.autoClearColor=true;\nthis.autoClearDepth=true;\nthis.autoClearStencil=true;\n\n// scene graph\n\nthis.sortObjects=true;\n\n// user-defined clipping\n\nthis.clippingPlanes=[];\nthis.localClippingEnabled=false;\n\n// physically based shading\n\nthis.outputEncoding=LinearEncoding;\n\n// physical lights\n\nthis.physicallyCorrectLights=false;\n\n// tone mapping\n\nthis.toneMapping=NoToneMapping;\nthis.toneMappingExposure=1.0;\n\n//\n\nObject.defineProperties(this,{\n\n// @deprecated since r136, 0e21088102b4de7e0a0a33140620b7a3424b9e6d\n\ngammaFactor:{\nget:function get(){\n\nconsole.warn('THREE.WebGLRenderer: .gammaFactor has been removed.');\nreturn 2;\n\n},\nset:function set(){\n\nconsole.warn('THREE.WebGLRenderer: .gammaFactor has been removed.');\n\n}}});\n\n\n\n\n// internal properties\n\nvar _this=this;\n\nvar _isContextLost=false;\n\n// internal state cache\n\nvar _currentActiveCubeFace=0;\nvar _currentActiveMipmapLevel=0;\nvar _currentRenderTarget=null;\nvar _currentMaterialId=-1;\n\nvar _currentCamera=null;\n\nvar _currentViewport=new Vector4();\nvar _currentScissor=new Vector4();\nvar _currentScissorTest=null;\n\n//\n\nvar _width=_canvas.width;\nvar _height=_canvas.height;\n\nvar _pixelRatio=1;\nvar _opaqueSort=null;\nvar _transparentSort=null;\n\nvar _viewport=new Vector4(0,0,_width,_height);\nvar _scissor=new Vector4(0,0,_width,_height);\nvar _scissorTest=false;\n\n// frustum\n\nvar _frustum=new Frustum();\n\n// clipping\n\nvar _clippingEnabled=false;\nvar _localClippingEnabled=false;\n\n// transmission\n\nvar _transmissionRenderTarget=null;\n\n// camera matrices cache\n\nvar _projScreenMatrix=new Matrix4();\n\nvar _vector2=new Vector2();\nvar _vector3=new Vector3();\n\nvar _emptyScene={background:null,fog:null,environment:null,overrideMaterial:null,isScene:true};\n\nfunction getTargetPixelRatio(){\n\nreturn _currentRenderTarget===null?_pixelRatio:1;\n\n}\n\n// initialize\n\nvar _gl=_context;\n\nfunction getContext(contextNames,contextAttributes){\n\nfor(var i=0;i<contextNames.length;i++){\n\nvar contextName=contextNames[i];\nvar context=_canvas.getContext(contextName,contextAttributes);\nif(context!==null)return context;\n\n}\n\nreturn null;\n\n}\n\ntry{\n\nvar contextAttributes={\nalpha:true,\ndepth:_depth,\nstencil:_stencil,\nantialias:_antialias,\npremultipliedAlpha:_premultipliedAlpha,\npreserveDrawingBuffer:_preserveDrawingBuffer,\npowerPreference:_powerPreference,\nfailIfMajorPerformanceCaveat:_failIfMajorPerformanceCaveat};\n\n\n// OffscreenCanvas does not have setAttribute, see #22811\nif('setAttribute'in _canvas)_canvas.setAttribute('data-engine','three.js r'+REVISION);\n\n// event listeners must be registered before WebGL context is created, see #12753\n_canvas.addEventListener('webglcontextlost',onContextLost,false);\n_canvas.addEventListener('webglcontextrestored',onContextRestore,false);\n_canvas.addEventListener('webglcontextcreationerror',onContextCreationError,false);\n\nif(_gl===null){\n\nvar contextNames=['webgl2','webgl','experimental-webgl'];\n\nif(_this.isWebGL1Renderer===true){\n\ncontextNames.shift();\n\n}\n\n_gl=getContext(contextNames,contextAttributes);\n\nif(_gl===null){\n\nif(getContext(contextNames)){\n\nthrow new Error('Error creating WebGL context with your selected attributes.');\n\n}else{\n\nthrow new Error('Error creating WebGL context.');\n\n}\n\n}\n\n}\n\n// Some experimental-webgl implementations do not have getShaderPrecisionFormat\n\nif(_gl.getShaderPrecisionFormat===undefined){\n\n_gl.getShaderPrecisionFormat=function(){\n\nreturn{'rangeMin':1,'rangeMax':1,'precision':1};\n\n};\n\n}\n\n}catch(error){\n\nconsole.error('THREE.WebGLRenderer: '+error.message);\nthrow error;\n\n}\n\nvar extensions=void 0,capabilities=void 0,state=void 0,info=void 0;\nvar properties=void 0,textures=void 0,cubemaps=void 0,cubeuvmaps=void 0,attributes=void 0,geometries=void 0,objects=void 0;\nvar programCache=void 0,materials=void 0,renderLists=void 0,renderStates=void 0,clipping=void 0,shadowMap=void 0;\n\nvar background=void 0,morphtargets=void 0,bufferRenderer=void 0,indexedBufferRenderer=void 0;\n\nvar utils=void 0,bindingStates=void 0;\n\nfunction initGLContext(){\n\nextensions=new WebGLExtensions(_gl);\n\ncapabilities=new WebGLCapabilities(_gl,extensions,parameters);\n\nextensions.init(capabilities);\n\nutils=new WebGLUtils(_gl,extensions,capabilities);\n\nstate=new WebGLState(_gl,extensions,capabilities);\n\ninfo=new WebGLInfo();\nproperties=new WebGLProperties();\ntextures=new WebGLTextures(_gl,extensions,state,properties,capabilities,utils,info);\ncubemaps=new WebGLCubeMaps(_this);\ncubeuvmaps=new WebGLCubeUVMaps(_this);\nattributes=new WebGLAttributes(_gl,capabilities);\nbindingStates=new WebGLBindingStates(_gl,extensions,attributes,capabilities);\ngeometries=new WebGLGeometries(_gl,attributes,info,bindingStates);\nobjects=new WebGLObjects(_gl,geometries,attributes,info);\nmorphtargets=new WebGLMorphtargets(_gl,capabilities,textures);\nclipping=new WebGLClipping(properties);\nprogramCache=new WebGLPrograms(_this,cubemaps,cubeuvmaps,extensions,capabilities,bindingStates,clipping);\nmaterials=new WebGLMaterials(_this,properties);\nrenderLists=new WebGLRenderLists();\nrenderStates=new WebGLRenderStates(extensions,capabilities);\nbackground=new WebGLBackground(_this,cubemaps,state,objects,_alpha,_premultipliedAlpha);\nshadowMap=new WebGLShadowMap(_this,objects,capabilities);\n\nbufferRenderer=new WebGLBufferRenderer(_gl,extensions,info,capabilities);\nindexedBufferRenderer=new WebGLIndexedBufferRenderer(_gl,extensions,info,capabilities);\n\ninfo.programs=programCache.programs;\n\n_this.capabilities=capabilities;\n_this.extensions=extensions;\n_this.properties=properties;\n_this.renderLists=renderLists;\n_this.shadowMap=shadowMap;\n_this.state=state;\n_this.info=info;\n\n}\n\ninitGLContext();\n\n// xr\n\nvar xr=new WebXRManager(_this,_gl);\n\nthis.xr=xr;\n\n// API\n\nthis.getContext=function(){\n\nreturn _gl;\n\n};\n\nthis.getContextAttributes=function(){\n\nreturn _gl.getContextAttributes();\n\n};\n\nthis.forceContextLoss=function(){\n\nvar extension=extensions.get('WEBGL_lose_context');\nif(extension)extension.loseContext();\n\n};\n\nthis.forceContextRestore=function(){\n\nvar extension=extensions.get('WEBGL_lose_context');\nif(extension)extension.restoreContext();\n\n};\n\nthis.getPixelRatio=function(){\n\nreturn _pixelRatio;\n\n};\n\nthis.setPixelRatio=function(value){\n\nif(value===undefined)return;\n\n_pixelRatio=value;\n\nthis.setSize(_width,_height,false);\n\n};\n\nthis.getSize=function(target){\n\nreturn target.set(_width,_height);\n\n};\n\nthis.setSize=function(width,height,updateStyle){\n\nif(xr.isPresenting){\n\nconsole.warn('THREE.WebGLRenderer: Can\\'t change size while VR device is presenting.');\nreturn;\n\n}\n\n_width=width;\n_height=height;\n\n_canvas.width=Math.floor(width*_pixelRatio);\n_canvas.height=Math.floor(height*_pixelRatio);\n\nif(updateStyle!==false){\n\n_canvas.style.width=width+'px';\n_canvas.style.height=height+'px';\n\n}\n\nthis.setViewport(0,0,width,height);\n\n};\n\nthis.getDrawingBufferSize=function(target){\n\nreturn target.set(_width*_pixelRatio,_height*_pixelRatio).floor();\n\n};\n\nthis.setDrawingBufferSize=function(width,height,pixelRatio){\n\n_width=width;\n_height=height;\n\n_pixelRatio=pixelRatio;\n\n_canvas.width=Math.floor(width*pixelRatio);\n_canvas.height=Math.floor(height*pixelRatio);\n\nthis.setViewport(0,0,width,height);\n\n};\n\nthis.getCurrentViewport=function(target){\n\nreturn target.copy(_currentViewport);\n\n};\n\nthis.getViewport=function(target){\n\nreturn target.copy(_viewport);\n\n};\n\nthis.setViewport=function(x,y,width,height){\n\nif(x.isVector4){\n\n_viewport.set(x.x,x.y,x.z,x.w);\n\n}else{\n\n_viewport.set(x,y,width,height);\n\n}\n\nstate.viewport(_currentViewport.copy(_viewport).multiplyScalar(_pixelRatio).floor());\n\n};\n\nthis.getScissor=function(target){\n\nreturn target.copy(_scissor);\n\n};\n\nthis.setScissor=function(x,y,width,height){\n\nif(x.isVector4){\n\n_scissor.set(x.x,x.y,x.z,x.w);\n\n}else{\n\n_scissor.set(x,y,width,height);\n\n}\n\nstate.scissor(_currentScissor.copy(_scissor).multiplyScalar(_pixelRatio).floor());\n\n};\n\nthis.getScissorTest=function(){\n\nreturn _scissorTest;\n\n};\n\nthis.setScissorTest=function(boolean){\n\nstate.setScissorTest(_scissorTest=boolean);\n\n};\n\nthis.setOpaqueSort=function(method){\n\n_opaqueSort=method;\n\n};\n\nthis.setTransparentSort=function(method){\n\n_transparentSort=method;\n\n};\n\n// Clearing\n\nthis.getClearColor=function(target){\n\nreturn target.copy(background.getClearColor());\n\n};\n\nthis.setClearColor=function(){\n\nbackground.setClearColor.apply(background,arguments);\n\n};\n\nthis.getClearAlpha=function(){\n\nreturn background.getClearAlpha();\n\n};\n\nthis.setClearAlpha=function(){\n\nbackground.setClearAlpha.apply(background,arguments);\n\n};\n\nthis.clear=function(){var color=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;var depth=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;var stencil=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;\n\nvar bits=0;\n\nif(color)bits|=16384;\nif(depth)bits|=256;\nif(stencil)bits|=1024;\n\n_gl.clear(bits);\n\n};\n\nthis.clearColor=function(){\n\nthis.clear(true,false,false);\n\n};\n\nthis.clearDepth=function(){\n\nthis.clear(false,true,false);\n\n};\n\nthis.clearStencil=function(){\n\nthis.clear(false,false,true);\n\n};\n\n//\n\nthis.dispose=function(){\n\n_canvas.removeEventListener('webglcontextlost',onContextLost,false);\n_canvas.removeEventListener('webglcontextrestored',onContextRestore,false);\n_canvas.removeEventListener('webglcontextcreationerror',onContextCreationError,false);\n\nrenderLists.dispose();\nrenderStates.dispose();\nproperties.dispose();\ncubemaps.dispose();\ncubeuvmaps.dispose();\nobjects.dispose();\nbindingStates.dispose();\nprogramCache.dispose();\n\nxr.dispose();\n\nxr.removeEventListener('sessionstart',onXRSessionStart);\nxr.removeEventListener('sessionend',onXRSessionEnd);\n\nif(_transmissionRenderTarget){\n\n_transmissionRenderTarget.dispose();\n_transmissionRenderTarget=null;\n\n}\n\nanimation.stop();\n\n};\n\n// Events\n\nfunction onContextLost(event){\n\nevent.preventDefault();\n\nconsole.log('THREE.WebGLRenderer: Context Lost.');\n\n_isContextLost=true;\n\n}\n\nfunction onContextRestore()/* event */{\n\nconsole.log('THREE.WebGLRenderer: Context Restored.');\n\n_isContextLost=false;\n\nvar infoAutoReset=info.autoReset;\nvar shadowMapEnabled=shadowMap.enabled;\nvar shadowMapAutoUpdate=shadowMap.autoUpdate;\nvar shadowMapNeedsUpdate=shadowMap.needsUpdate;\nvar shadowMapType=shadowMap.type;\n\ninitGLContext();\n\ninfo.autoReset=infoAutoReset;\nshadowMap.enabled=shadowMapEnabled;\nshadowMap.autoUpdate=shadowMapAutoUpdate;\nshadowMap.needsUpdate=shadowMapNeedsUpdate;\nshadowMap.type=shadowMapType;\n\n}\n\nfunction onContextCreationError(event){\n\nconsole.error('THREE.WebGLRenderer: A WebGL context could not be created. Reason: ',event.statusMessage);\n\n}\n\nfunction onMaterialDispose(event){\n\nvar material=event.target;\n\nmaterial.removeEventListener('dispose',onMaterialDispose);\n\ndeallocateMaterial(material);\n\n}\n\n// Buffer deallocation\n\nfunction deallocateMaterial(material){\n\nreleaseMaterialProgramReferences(material);\n\nproperties.remove(material);\n\n}\n\n\nfunction releaseMaterialProgramReferences(material){\n\nvar programs=properties.get(material).programs;\n\nif(programs!==undefined){\n\nprograms.forEach(function(program){\n\nprogramCache.releaseProgram(program);\n\n});\n\nif(material.isShaderMaterial){\n\nprogramCache.releaseShaderCache(material);\n\n}\n\n}\n\n}\n\n// Buffer rendering\n\nthis.renderBufferDirect=function(camera,scene,geometry,material,object,group){\n\nif(scene===null)scene=_emptyScene;// renderBufferDirect second parameter used to be fog (could be null)\n\nvar frontFaceCW=object.isMesh&&object.matrixWorld.determinant()<0;\n\nvar program=setProgram(camera,scene,geometry,material,object);\n\nstate.setMaterial(material,frontFaceCW);\n\n//\n\nvar index=geometry.index;\nvar position=geometry.attributes.position;\n\n//\n\nif(index===null){\n\nif(position===undefined||position.count===0)return;\n\n}else if(index.count===0){\n\nreturn;\n\n}\n\n//\n\nvar rangeFactor=1;\n\nif(material.wireframe===true){\n\nindex=geometries.getWireframeAttribute(geometry);\nrangeFactor=2;\n\n}\n\nbindingStates.setup(object,material,program,geometry,index);\n\nvar attribute=void 0;\nvar renderer=bufferRenderer;\n\nif(index!==null){\n\nattribute=attributes.get(index);\n\nrenderer=indexedBufferRenderer;\nrenderer.setIndex(attribute);\n\n}\n\n//\n\nvar dataCount=index!==null?index.count:position.count;\n\nvar rangeStart=geometry.drawRange.start*rangeFactor;\nvar rangeCount=geometry.drawRange.count*rangeFactor;\n\nvar groupStart=group!==null?group.start*rangeFactor:0;\nvar groupCount=group!==null?group.count*rangeFactor:Infinity;\n\nvar drawStart=Math.max(rangeStart,groupStart);\nvar drawEnd=Math.min(dataCount,rangeStart+rangeCount,groupStart+groupCount)-1;\n\nvar drawCount=Math.max(0,drawEnd-drawStart+1);\n\nif(drawCount===0)return;\n\n//\n\nif(object.isMesh){\n\nif(material.wireframe===true){\n\nstate.setLineWidth(material.wireframeLinewidth*getTargetPixelRatio());\nrenderer.setMode(1);\n\n}else{\n\nrenderer.setMode(4);\n\n}\n\n}else if(object.isLine){\n\nvar lineWidth=material.linewidth;\n\nif(lineWidth===undefined)lineWidth=1;// Not using Line*Material\n\nstate.setLineWidth(lineWidth*getTargetPixelRatio());\n\nif(object.isLineSegments){\n\nrenderer.setMode(1);\n\n}else if(object.isLineLoop){\n\nrenderer.setMode(2);\n\n}else{\n\nrenderer.setMode(3);\n\n}\n\n}else if(object.isPoints){\n\nrenderer.setMode(0);\n\n}else if(object.isSprite){\n\nrenderer.setMode(4);\n\n}\n\nif(object.isInstancedMesh){\n\nrenderer.renderInstances(drawStart,drawCount,object.count);\n\n}else if(geometry.isInstancedBufferGeometry){\n\nvar instanceCount=Math.min(geometry.instanceCount,geometry._maxInstanceCount);\n\nrenderer.renderInstances(drawStart,drawCount,instanceCount);\n\n}else{\n\nrenderer.render(drawStart,drawCount);\n\n}\n\n};\n\n// Compile\n\nthis.compile=function(scene,camera){\n\ncurrentRenderState=renderStates.get(scene);\ncurrentRenderState.init();\n\nrenderStateStack.push(currentRenderState);\n\nscene.traverseVisible(function(object){\n\nif(object.isLight&&object.layers.test(camera.layers)){\n\ncurrentRenderState.pushLight(object);\n\nif(object.castShadow){\n\ncurrentRenderState.pushShadow(object);\n\n}\n\n}\n\n});\n\ncurrentRenderState.setupLights(_this.physicallyCorrectLights);\n\nscene.traverse(function(object){\n\nvar material=object.material;\n\nif(material){\n\nif(Array.isArray(material)){\n\nfor(var i=0;i<material.length;i++){\n\nvar material2=material[i];\n\ngetProgram(material2,scene,object);\n\n}\n\n}else{\n\ngetProgram(material,scene,object);\n\n}\n\n}\n\n});\n\nrenderStateStack.pop();\ncurrentRenderState=null;\n\n};\n\n// Animation Loop\n\nvar onAnimationFrameCallback=null;\n\nfunction onAnimationFrame(time){\n\nif(onAnimationFrameCallback)onAnimationFrameCallback(time);\n\n}\n\nfunction onXRSessionStart(){\n\nanimation.stop();\n\n}\n\nfunction onXRSessionEnd(){\n\nanimation.start();\n\n}\n\nvar animation=new WebGLAnimation();\nanimation.setAnimationLoop(onAnimationFrame);\n\nif(typeof self!=='undefined')animation.setContext(self);\n\nthis.setAnimationLoop=function(callback){\n\nonAnimationFrameCallback=callback;\nxr.setAnimationLoop(callback);\n\ncallback===null?animation.stop():animation.start();\n\n};\n\nxr.addEventListener('sessionstart',onXRSessionStart);\nxr.addEventListener('sessionend',onXRSessionEnd);\n\n// Rendering\n\nthis.render=function(scene,camera){\n\nif(camera!==undefined&&camera.isCamera!==true){\n\nconsole.error('THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.');\nreturn;\n\n}\n\nif(_isContextLost===true)return;\n\n// update scene graph\n\nif(scene.autoUpdate===true)scene.updateMatrixWorld();\n\n// update camera matrices and frustum\n\nif(camera.parent===null)camera.updateMatrixWorld();\n\nif(xr.enabled===true&&xr.isPresenting===true){\n\nif(xr.cameraAutoUpdate===true)xr.updateCamera(camera);\n\ncamera=xr.getCamera();// use XR camera for rendering\n\n}\n\n//\nif(scene.isScene===true)scene.onBeforeRender(_this,scene,camera,_currentRenderTarget);\n\ncurrentRenderState=renderStates.get(scene,renderStateStack.length);\ncurrentRenderState.init();\n\nrenderStateStack.push(currentRenderState);\n\n_projScreenMatrix.multiplyMatrices(camera.projectionMatrix,camera.matrixWorldInverse);\n_frustum.setFromProjectionMatrix(_projScreenMatrix);\n\n_localClippingEnabled=this.localClippingEnabled;\n_clippingEnabled=clipping.init(this.clippingPlanes,_localClippingEnabled,camera);\n\ncurrentRenderList=renderLists.get(scene,renderListStack.length);\ncurrentRenderList.init();\n\nrenderListStack.push(currentRenderList);\n\nprojectObject(scene,camera,0,_this.sortObjects);\n\ncurrentRenderList.finish();\n\nif(_this.sortObjects===true){\n\ncurrentRenderList.sort(_opaqueSort,_transparentSort);\n\n}\n\n//\n\nif(_clippingEnabled===true)clipping.beginShadows();\n\nvar shadowsArray=currentRenderState.state.shadowsArray;\n\nshadowMap.render(shadowsArray,scene,camera);\n\nif(_clippingEnabled===true)clipping.endShadows();\n\n//\n\nif(this.info.autoReset===true)this.info.reset();\n\n//\n\nbackground.render(currentRenderList,scene);\n\n// render scene\n\ncurrentRenderState.setupLights(_this.physicallyCorrectLights);\n\nif(camera.isArrayCamera){\n\nvar _cameras=camera.cameras;\n\nfor(var i=0,l=_cameras.length;i<l;i++){\n\nvar camera2=_cameras[i];\n\nrenderScene(currentRenderList,scene,camera2,camera2.viewport);\n\n}\n\n}else{\n\nrenderScene(currentRenderList,scene,camera);\n\n}\n\n//\n\nif(_currentRenderTarget!==null){\n\n// resolve multisample renderbuffers to a single-sample texture if necessary\n\ntextures.updateMultisampleRenderTarget(_currentRenderTarget);\n\n// Generate mipmap if we're using any kind of mipmap filtering\n\ntextures.updateRenderTargetMipmap(_currentRenderTarget);\n\n}\n\n//\n\nif(scene.isScene===true)scene.onAfterRender(_this,scene,camera);\n\n// _gl.finish();\n\nbindingStates.resetDefaultState();\n_currentMaterialId=-1;\n_currentCamera=null;\n\nrenderStateStack.pop();\n\nif(renderStateStack.length>0){\n\ncurrentRenderState=renderStateStack[renderStateStack.length-1];\n\n}else{\n\ncurrentRenderState=null;\n\n}\n\nrenderListStack.pop();\n\nif(renderListStack.length>0){\n\ncurrentRenderList=renderListStack[renderListStack.length-1];\n\n}else{\n\ncurrentRenderList=null;\n\n}\n\n};\n\nfunction projectObject(object,camera,groupOrder,sortObjects){\n\nif(object.visible===false)return;\n\nvar visible=object.layers.test(camera.layers);\n\nif(visible){\n\nif(object.isGroup){\n\ngroupOrder=object.renderOrder;\n\n}else if(object.isLOD){\n\nif(object.autoUpdate===true)object.update(camera);\n\n}else if(object.isLight){\n\ncurrentRenderState.pushLight(object);\n\nif(object.castShadow){\n\ncurrentRenderState.pushShadow(object);\n\n}\n\n}else if(object.isSprite){\n\nif(!object.frustumCulled||_frustum.intersectsSprite(object)){\n\nif(sortObjects){\n\n_vector3.setFromMatrixPosition(object.matrixWorld).\napplyMatrix4(_projScreenMatrix);\n\n}\n\nvar geometry=objects.update(object);\nvar material=object.material;\n\nif(material.visible){\n\ncurrentRenderList.push(object,geometry,material,groupOrder,_vector3.z,null);\n\n}\n\n}\n\n}else if(object.isMesh||object.isLine||object.isPoints){\n\nif(object.isSkinnedMesh){\n\n// update skeleton only once in a frame\n\nif(object.skeleton.frame!==info.render.frame){\n\nobject.skeleton.update();\nobject.skeleton.frame=info.render.frame;\n\n}\n\n}\n\nif(!object.frustumCulled||_frustum.intersectsObject(object)){\n\nif(sortObjects){\n\n_vector3.setFromMatrixPosition(object.matrixWorld).\napplyMatrix4(_projScreenMatrix);\n\n}\n\nvar _geometry2=objects.update(object);\nvar _material=object.material;\n\nif(Array.isArray(_material)){\n\nvar groups=_geometry2.groups;\n\nfor(var i=0,l=groups.length;i<l;i++){\n\nvar group=groups[i];\nvar groupMaterial=_material[group.materialIndex];\n\nif(groupMaterial&&groupMaterial.visible){\n\ncurrentRenderList.push(object,_geometry2,groupMaterial,groupOrder,_vector3.z,group);\n\n}\n\n}\n\n}else if(_material.visible){\n\ncurrentRenderList.push(object,_geometry2,_material,groupOrder,_vector3.z,null);\n\n}\n\n}\n\n}\n\n}\n\nvar children=object.children;\n\nfor(var _i51=0,_l6=children.length;_i51<_l6;_i51++){\n\nprojectObject(children[_i51],camera,groupOrder,sortObjects);\n\n}\n\n}\n\nfunction renderScene(currentRenderList,scene,camera,viewport){\n\nvar opaqueObjects=currentRenderList.opaque;\nvar transmissiveObjects=currentRenderList.transmissive;\nvar transparentObjects=currentRenderList.transparent;\n\ncurrentRenderState.setupLightsView(camera);\n\nif(transmissiveObjects.length>0)renderTransmissionPass(opaqueObjects,scene,camera);\n\nif(viewport)state.viewport(_currentViewport.copy(viewport));\n\nif(opaqueObjects.length>0)renderObjects(opaqueObjects,scene,camera);\nif(transmissiveObjects.length>0)renderObjects(transmissiveObjects,scene,camera);\nif(transparentObjects.length>0)renderObjects(transparentObjects,scene,camera);\n\n// Ensure depth buffer writing is enabled so it can be cleared on next render\n\nstate.buffers.depth.setTest(true);\nstate.buffers.depth.setMask(true);\nstate.buffers.color.setMask(true);\n\nstate.setPolygonOffset(false);\n\n}\n\nfunction renderTransmissionPass(opaqueObjects,scene,camera){\n\nvar isWebGL2=capabilities.isWebGL2;\n\nif(_transmissionRenderTarget===null){\n\n_transmissionRenderTarget=new WebGLRenderTarget(1,1,{\ngenerateMipmaps:true,\ntype:extensions.has('EXT_color_buffer_half_float')?HalfFloatType:UnsignedByteType,\nminFilter:LinearMipmapLinearFilter,\nsamples:isWebGL2&&_antialias===true?4:0});\n\n\n}\n\n_this.getDrawingBufferSize(_vector2);\n\nif(isWebGL2){\n\n_transmissionRenderTarget.setSize(_vector2.x,_vector2.y);\n\n}else{\n\n_transmissionRenderTarget.setSize(floorPowerOfTwo(_vector2.x),floorPowerOfTwo(_vector2.y));\n\n}\n\n//\n\nvar currentRenderTarget=_this.getRenderTarget();\n_this.setRenderTarget(_transmissionRenderTarget);\n_this.clear();\n\n// Turn off the features which can affect the frag color for opaque objects pass.\n// Otherwise they are applied twice in opaque objects pass and transmission objects pass.\nvar currentToneMapping=_this.toneMapping;\n_this.toneMapping=NoToneMapping;\n\nrenderObjects(opaqueObjects,scene,camera);\n\n_this.toneMapping=currentToneMapping;\n\ntextures.updateMultisampleRenderTarget(_transmissionRenderTarget);\ntextures.updateRenderTargetMipmap(_transmissionRenderTarget);\n\n_this.setRenderTarget(currentRenderTarget);\n\n}\n\nfunction renderObjects(renderList,scene,camera){\n\nvar overrideMaterial=scene.isScene===true?scene.overrideMaterial:null;\n\nfor(var i=0,l=renderList.length;i<l;i++){\n\nvar renderItem=renderList[i];\n\nvar object=renderItem.object;\nvar geometry=renderItem.geometry;\nvar material=overrideMaterial===null?renderItem.material:overrideMaterial;\nvar group=renderItem.group;\n\nif(object.layers.test(camera.layers)){\n\nrenderObject(object,scene,camera,geometry,material,group);\n\n}\n\n}\n\n}\n\nfunction renderObject(object,scene,camera,geometry,material,group){\n\nobject.onBeforeRender(_this,scene,camera,geometry,material,group);\n\nobject.modelViewMatrix.multiplyMatrices(camera.matrixWorldInverse,object.matrixWorld);\nobject.normalMatrix.getNormalMatrix(object.modelViewMatrix);\n\nmaterial.onBeforeRender(_this,scene,camera,geometry,object,group);\n\nif(material.transparent===true&&material.side===DoubleSide){\n\nmaterial.side=BackSide;\nmaterial.needsUpdate=true;\n_this.renderBufferDirect(camera,scene,geometry,material,object,group);\n\nmaterial.side=FrontSide;\nmaterial.needsUpdate=true;\n_this.renderBufferDirect(camera,scene,geometry,material,object,group);\n\nmaterial.side=DoubleSide;\n\n}else{\n\n_this.renderBufferDirect(camera,scene,geometry,material,object,group);\n\n}\n\nobject.onAfterRender(_this,scene,camera,geometry,material,group);\n\n}\n\nfunction getProgram(material,scene,object){\n\nif(scene.isScene!==true)scene=_emptyScene;// scene could be a Mesh, Line, Points, ...\n\nvar materialProperties=properties.get(material);\n\nvar lights=currentRenderState.state.lights;\nvar shadowsArray=currentRenderState.state.shadowsArray;\n\nvar lightsStateVersion=lights.state.version;\n\nvar parameters=programCache.getParameters(material,lights.state,shadowsArray,scene,object);\nvar programCacheKey=programCache.getProgramCacheKey(parameters);\n\nvar programs=materialProperties.programs;\n\n// always update environment and fog - changing these trigger an getProgram call, but it's possible that the program doesn't change\n\nmaterialProperties.environment=material.isMeshStandardMaterial?scene.environment:null;\nmaterialProperties.fog=scene.fog;\nmaterialProperties.envMap=(material.isMeshStandardMaterial?cubeuvmaps:cubemaps).get(material.envMap||materialProperties.environment);\n\nif(programs===undefined){\n\n// new material\n\nmaterial.addEventListener('dispose',onMaterialDispose);\n\nprograms=new Map();\nmaterialProperties.programs=programs;\n\n}\n\nvar program=programs.get(programCacheKey);\n\nif(program!==undefined){\n\n// early out if program and light state is identical\n\nif(materialProperties.currentProgram===program&&materialProperties.lightsStateVersion===lightsStateVersion){\n\nupdateCommonMaterialProperties(material,parameters);\n\nreturn program;\n\n}\n\n}else{\n\nparameters.uniforms=programCache.getUniforms(material);\n\nmaterial.onBuild(object,parameters,_this);\n\nmaterial.onBeforeCompile(parameters,_this);\n\nprogram=programCache.acquireProgram(parameters,programCacheKey);\nprograms.set(programCacheKey,program);\n\nmaterialProperties.uniforms=parameters.uniforms;\n\n}\n\nvar uniforms=materialProperties.uniforms;\n\nif(!material.isShaderMaterial&&!material.isRawShaderMaterial||material.clipping===true){\n\nuniforms.clippingPlanes=clipping.uniform;\n\n}\n\nupdateCommonMaterialProperties(material,parameters);\n\n// store the light setup it was created for\n\nmaterialProperties.needsLights=materialNeedsLights(material);\nmaterialProperties.lightsStateVersion=lightsStateVersion;\n\nif(materialProperties.needsLights){\n\n// wire up the material to this renderer's lighting state\n\nuniforms.ambientLightColor.value=lights.state.ambient;\nuniforms.lightProbe.value=lights.state.probe;\nuniforms.directionalLights.value=lights.state.directional;\nuniforms.directionalLightShadows.value=lights.state.directionalShadow;\nuniforms.spotLights.value=lights.state.spot;\nuniforms.spotLightShadows.value=lights.state.spotShadow;\nuniforms.rectAreaLights.value=lights.state.rectArea;\nuniforms.ltc_1.value=lights.state.rectAreaLTC1;\nuniforms.ltc_2.value=lights.state.rectAreaLTC2;\nuniforms.pointLights.value=lights.state.point;\nuniforms.pointLightShadows.value=lights.state.pointShadow;\nuniforms.hemisphereLights.value=lights.state.hemi;\n\nuniforms.directionalShadowMap.value=lights.state.directionalShadowMap;\nuniforms.directionalShadowMatrix.value=lights.state.directionalShadowMatrix;\nuniforms.spotShadowMap.value=lights.state.spotShadowMap;\nuniforms.spotShadowMatrix.value=lights.state.spotShadowMatrix;\nuniforms.pointShadowMap.value=lights.state.pointShadowMap;\nuniforms.pointShadowMatrix.value=lights.state.pointShadowMatrix;\n// TODO (abelnation): add area lights shadow info to uniforms\n\n}\n\nvar progUniforms=program.getUniforms();\nvar uniformsList=WebGLUniforms.seqWithValue(progUniforms.seq,uniforms);\n\nmaterialProperties.currentProgram=program;\nmaterialProperties.uniformsList=uniformsList;\n\nreturn program;\n\n}\n\nfunction updateCommonMaterialProperties(material,parameters){\n\nvar materialProperties=properties.get(material);\n\nmaterialProperties.outputEncoding=parameters.outputEncoding;\nmaterialProperties.instancing=parameters.instancing;\nmaterialProperties.skinning=parameters.skinning;\nmaterialProperties.morphTargets=parameters.morphTargets;\nmaterialProperties.morphNormals=parameters.morphNormals;\nmaterialProperties.morphColors=parameters.morphColors;\nmaterialProperties.morphTargetsCount=parameters.morphTargetsCount;\nmaterialProperties.numClippingPlanes=parameters.numClippingPlanes;\nmaterialProperties.numIntersection=parameters.numClipIntersection;\nmaterialProperties.vertexAlphas=parameters.vertexAlphas;\nmaterialProperties.vertexTangents=parameters.vertexTangents;\nmaterialProperties.toneMapping=parameters.toneMapping;\n\n}\n\nfunction setProgram(camera,scene,geometry,material,object){\n\nif(scene.isScene!==true)scene=_emptyScene;// scene could be a Mesh, Line, Points, ...\n\ntextures.resetTextureUnits();\n\nvar fog=scene.fog;\nvar environment=material.isMeshStandardMaterial?scene.environment:null;\nvar encoding=_currentRenderTarget===null?_this.outputEncoding:_currentRenderTarget.isXRRenderTarget===true?_currentRenderTarget.texture.encoding:LinearEncoding;\nvar envMap=(material.isMeshStandardMaterial?cubeuvmaps:cubemaps).get(material.envMap||environment);\nvar vertexAlphas=material.vertexColors===true&&!!geometry.attributes.color&&geometry.attributes.color.itemSize===4;\nvar vertexTangents=!!material.normalMap&&!!geometry.attributes.tangent;\nvar morphTargets=!!geometry.morphAttributes.position;\nvar morphNormals=!!geometry.morphAttributes.normal;\nvar morphColors=!!geometry.morphAttributes.color;\nvar toneMapping=material.toneMapped?_this.toneMapping:NoToneMapping;\n\nvar morphAttribute=geometry.morphAttributes.position||geometry.morphAttributes.normal||geometry.morphAttributes.color;\nvar morphTargetsCount=morphAttribute!==undefined?morphAttribute.length:0;\n\nvar materialProperties=properties.get(material);\nvar lights=currentRenderState.state.lights;\n\nif(_clippingEnabled===true){\n\nif(_localClippingEnabled===true||camera!==_currentCamera){\n\nvar useCache=\ncamera===_currentCamera&&\nmaterial.id===_currentMaterialId;\n\n// we might want to call this function with some ClippingGroup\n// object instead of the material, once it becomes feasible\n// (#8465, #8379)\nclipping.setState(material,camera,useCache);\n\n}\n\n}\n\n//\n\nvar needsProgramChange=false;\n\nif(material.version===materialProperties.__version){\n\nif(materialProperties.needsLights&&materialProperties.lightsStateVersion!==lights.state.version){\n\nneedsProgramChange=true;\n\n}else if(materialProperties.outputEncoding!==encoding){\n\nneedsProgramChange=true;\n\n}else if(object.isInstancedMesh&&materialProperties.instancing===false){\n\nneedsProgramChange=true;\n\n}else if(!object.isInstancedMesh&&materialProperties.instancing===true){\n\nneedsProgramChange=true;\n\n}else if(object.isSkinnedMesh&&materialProperties.skinning===false){\n\nneedsProgramChange=true;\n\n}else if(!object.isSkinnedMesh&&materialProperties.skinning===true){\n\nneedsProgramChange=true;\n\n}else if(materialProperties.envMap!==envMap){\n\nneedsProgramChange=true;\n\n}else if(material.fog===true&&materialProperties.fog!==fog){\n\nneedsProgramChange=true;\n\n}else if(materialProperties.numClippingPlanes!==undefined&&(\nmaterialProperties.numClippingPlanes!==clipping.numPlanes||\nmaterialProperties.numIntersection!==clipping.numIntersection)){\n\nneedsProgramChange=true;\n\n}else if(materialProperties.vertexAlphas!==vertexAlphas){\n\nneedsProgramChange=true;\n\n}else if(materialProperties.vertexTangents!==vertexTangents){\n\nneedsProgramChange=true;\n\n}else if(materialProperties.morphTargets!==morphTargets){\n\nneedsProgramChange=true;\n\n}else if(materialProperties.morphNormals!==morphNormals){\n\nneedsProgramChange=true;\n\n}else if(materialProperties.morphColors!==morphColors){\n\nneedsProgramChange=true;\n\n}else if(materialProperties.toneMapping!==toneMapping){\n\nneedsProgramChange=true;\n\n}else if(capabilities.isWebGL2===true&&materialProperties.morphTargetsCount!==morphTargetsCount){\n\nneedsProgramChange=true;\n\n}\n\n}else{\n\nneedsProgramChange=true;\nmaterialProperties.__version=material.version;\n\n}\n\n//\n\nvar program=materialProperties.currentProgram;\n\nif(needsProgramChange===true){\n\nprogram=getProgram(material,scene,object);\n\n}\n\nvar refreshProgram=false;\nvar refreshMaterial=false;\nvar refreshLights=false;\n\nvar p_uniforms=program.getUniforms(),\nm_uniforms=materialProperties.uniforms;\n\nif(state.useProgram(program.program)){\n\nrefreshProgram=true;\nrefreshMaterial=true;\nrefreshLights=true;\n\n}\n\nif(material.id!==_currentMaterialId){\n\n_currentMaterialId=material.id;\n\nrefreshMaterial=true;\n\n}\n\nif(refreshProgram||_currentCamera!==camera){\n\np_uniforms.setValue(_gl,'projectionMatrix',camera.projectionMatrix);\n\nif(capabilities.logarithmicDepthBuffer){\n\np_uniforms.setValue(_gl,'logDepthBufFC',\n2.0/(Math.log(camera.far+1.0)/Math.LN2));\n\n}\n\nif(_currentCamera!==camera){\n\n_currentCamera=camera;\n\n// lighting uniforms depend on the camera so enforce an update\n// now, in case this material supports lights - or later, when\n// the next material that does gets activated:\n\nrefreshMaterial=true;// set to true on material change\nrefreshLights=true;// remains set until update done\n\n}\n\n// load material specific uniforms\n// (shader material also gets them for the sake of genericity)\n\nif(material.isShaderMaterial||\nmaterial.isMeshPhongMaterial||\nmaterial.isMeshToonMaterial||\nmaterial.isMeshStandardMaterial||\nmaterial.envMap){\n\nvar uCamPos=p_uniforms.map.cameraPosition;\n\nif(uCamPos!==undefined){\n\nuCamPos.setValue(_gl,\n_vector3.setFromMatrixPosition(camera.matrixWorld));\n\n}\n\n}\n\nif(material.isMeshPhongMaterial||\nmaterial.isMeshToonMaterial||\nmaterial.isMeshLambertMaterial||\nmaterial.isMeshBasicMaterial||\nmaterial.isMeshStandardMaterial||\nmaterial.isShaderMaterial){\n\np_uniforms.setValue(_gl,'isOrthographic',camera.isOrthographicCamera===true);\n\n}\n\nif(material.isMeshPhongMaterial||\nmaterial.isMeshToonMaterial||\nmaterial.isMeshLambertMaterial||\nmaterial.isMeshBasicMaterial||\nmaterial.isMeshStandardMaterial||\nmaterial.isShaderMaterial||\nmaterial.isShadowMaterial||\nobject.isSkinnedMesh){\n\np_uniforms.setValue(_gl,'viewMatrix',camera.matrixWorldInverse);\n\n}\n\n}\n\n// skinning and morph target uniforms must be set even if material didn't change\n// auto-setting of texture unit for bone and morph texture must go before other textures\n// otherwise textures used for skinning and morphing can take over texture units reserved for other material textures\n\nif(object.isSkinnedMesh){\n\np_uniforms.setOptional(_gl,object,'bindMatrix');\np_uniforms.setOptional(_gl,object,'bindMatrixInverse');\n\nvar skeleton=object.skeleton;\n\nif(skeleton){\n\nif(capabilities.floatVertexTextures){\n\nif(skeleton.boneTexture===null)skeleton.computeBoneTexture();\n\np_uniforms.setValue(_gl,'boneTexture',skeleton.boneTexture,textures);\np_uniforms.setValue(_gl,'boneTextureSize',skeleton.boneTextureSize);\n\n}else{\n\nconsole.warn('THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required.');\n\n}\n\n}\n\n}\n\nvar morphAttributes=geometry.morphAttributes;\n\nif(morphAttributes.position!==undefined||morphAttributes.normal!==undefined||morphAttributes.color!==undefined&&capabilities.isWebGL2===true){\n\nmorphtargets.update(object,geometry,material,program);\n\n}\n\n\nif(refreshMaterial||materialProperties.receiveShadow!==object.receiveShadow){\n\nmaterialProperties.receiveShadow=object.receiveShadow;\np_uniforms.setValue(_gl,'receiveShadow',object.receiveShadow);\n\n}\n\nif(refreshMaterial){\n\np_uniforms.setValue(_gl,'toneMappingExposure',_this.toneMappingExposure);\n\nif(materialProperties.needsLights){\n\n// the current material requires lighting info\n\n// note: all lighting uniforms are always set correctly\n// they simply reference the renderer's state for their\n// values\n//\n// use the current material's .needsUpdate flags to set\n// the GL state when required\n\nmarkUniformsLightsNeedsUpdate(m_uniforms,refreshLights);\n\n}\n\n// refresh uniforms common to several materials\n\nif(fog&&material.fog===true){\n\nmaterials.refreshFogUniforms(m_uniforms,fog);\n\n}\n\nmaterials.refreshMaterialUniforms(m_uniforms,material,_pixelRatio,_height,_transmissionRenderTarget);\n\nWebGLUniforms.upload(_gl,materialProperties.uniformsList,m_uniforms,textures);\n\n}\n\nif(material.isShaderMaterial&&material.uniformsNeedUpdate===true){\n\nWebGLUniforms.upload(_gl,materialProperties.uniformsList,m_uniforms,textures);\nmaterial.uniformsNeedUpdate=false;\n\n}\n\nif(material.isSpriteMaterial){\n\np_uniforms.setValue(_gl,'center',object.center);\n\n}\n\n// common matrices\n\np_uniforms.setValue(_gl,'modelViewMatrix',object.modelViewMatrix);\np_uniforms.setValue(_gl,'normalMatrix',object.normalMatrix);\np_uniforms.setValue(_gl,'modelMatrix',object.matrixWorld);\n\nreturn program;\n\n}\n\n// If uniforms are marked as clean, they don't need to be loaded to the GPU.\n\nfunction markUniformsLightsNeedsUpdate(uniforms,value){\n\nuniforms.ambientLightColor.needsUpdate=value;\nuniforms.lightProbe.needsUpdate=value;\n\nuniforms.directionalLights.needsUpdate=value;\nuniforms.directionalLightShadows.needsUpdate=value;\nuniforms.pointLights.needsUpdate=value;\nuniforms.pointLightShadows.needsUpdate=value;\nuniforms.spotLights.needsUpdate=value;\nuniforms.spotLightShadows.needsUpdate=value;\nuniforms.rectAreaLights.needsUpdate=value;\nuniforms.hemisphereLights.needsUpdate=value;\n\n}\n\nfunction materialNeedsLights(material){\n\nreturn material.isMeshLambertMaterial||material.isMeshToonMaterial||material.isMeshPhongMaterial||\nmaterial.isMeshStandardMaterial||material.isShadowMaterial||\nmaterial.isShaderMaterial&&material.lights===true;\n\n}\n\nthis.getActiveCubeFace=function(){\n\nreturn _currentActiveCubeFace;\n\n};\n\nthis.getActiveMipmapLevel=function(){\n\nreturn _currentActiveMipmapLevel;\n\n};\n\nthis.getRenderTarget=function(){\n\nreturn _currentRenderTarget;\n\n};\n\nthis.setRenderTargetTextures=function(renderTarget,colorTexture,depthTexture){\n\nproperties.get(renderTarget.texture).__webglTexture=colorTexture;\nproperties.get(renderTarget.depthTexture).__webglTexture=depthTexture;\n\nvar renderTargetProperties=properties.get(renderTarget);\nrenderTargetProperties.__hasExternalTextures=true;\n\nif(renderTargetProperties.__hasExternalTextures){\n\nrenderTargetProperties.__autoAllocateDepthBuffer=depthTexture===undefined;\n\nif(!renderTargetProperties.__autoAllocateDepthBuffer){\n\n// The multisample_render_to_texture extension doesn't work properly if there\n// are midframe flushes and an external depth buffer. Disable use of the extension.\nif(extensions.has('WEBGL_multisampled_render_to_texture')===true){\n\nconsole.warn('THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided');\nrenderTargetProperties.__useRenderToTexture=false;\n\n}\n\n}\n\n}\n\n};\n\nthis.setRenderTargetFramebuffer=function(renderTarget,defaultFramebuffer){\n\nvar renderTargetProperties=properties.get(renderTarget);\nrenderTargetProperties.__webglFramebuffer=defaultFramebuffer;\nrenderTargetProperties.__useDefaultFramebuffer=defaultFramebuffer===undefined;\n\n};\n\nthis.setRenderTarget=function(renderTarget){var activeCubeFace=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var activeMipmapLevel=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;\n\n_currentRenderTarget=renderTarget;\n_currentActiveCubeFace=activeCubeFace;\n_currentActiveMipmapLevel=activeMipmapLevel;\n\nvar useDefaultFramebuffer=true;\n\nif(renderTarget){\n\nvar renderTargetProperties=properties.get(renderTarget);\n\nif(renderTargetProperties.__useDefaultFramebuffer!==undefined){\n\n// We need to make sure to rebind the framebuffer.\nstate.bindFramebuffer(36160,null);\nuseDefaultFramebuffer=false;\n\n}else if(renderTargetProperties.__webglFramebuffer===undefined){\n\ntextures.setupRenderTarget(renderTarget);\n\n}else if(renderTargetProperties.__hasExternalTextures){\n\n// Color and depth texture must be rebound in order for the swapchain to update.\ntextures.rebindTextures(renderTarget,properties.get(renderTarget.texture).__webglTexture,properties.get(renderTarget.depthTexture).__webglTexture);\n\n}\n\n}\n\nvar framebuffer=null;\nvar isCube=false;\nvar isRenderTarget3D=false;\n\nif(renderTarget){\n\nvar _texture5=renderTarget.texture;\n\nif(_texture5.isData3DTexture||_texture5.isDataArrayTexture){\n\nisRenderTarget3D=true;\n\n}\n\nvar __webglFramebuffer=properties.get(renderTarget).__webglFramebuffer;\n\nif(renderTarget.isWebGLCubeRenderTarget){\n\nframebuffer=__webglFramebuffer[activeCubeFace];\nisCube=true;\n\n}else if(capabilities.isWebGL2&&renderTarget.samples>0&&textures.useMultisampledRTT(renderTarget)===false){\n\nframebuffer=properties.get(renderTarget).__webglMultisampledFramebuffer;\n\n}else{\n\nframebuffer=__webglFramebuffer;\n\n}\n\n_currentViewport.copy(renderTarget.viewport);\n_currentScissor.copy(renderTarget.scissor);\n_currentScissorTest=renderTarget.scissorTest;\n\n}else{\n\n_currentViewport.copy(_viewport).multiplyScalar(_pixelRatio).floor();\n_currentScissor.copy(_scissor).multiplyScalar(_pixelRatio).floor();\n_currentScissorTest=_scissorTest;\n\n}\n\nvar framebufferBound=state.bindFramebuffer(36160,framebuffer);\n\nif(framebufferBound&&capabilities.drawBuffers&&useDefaultFramebuffer){\n\nstate.drawBuffers(renderTarget,framebuffer);\n\n}\n\nstate.viewport(_currentViewport);\nstate.scissor(_currentScissor);\nstate.setScissorTest(_currentScissorTest);\n\nif(isCube){\n\nvar textureProperties=properties.get(renderTarget.texture);\n_gl.framebufferTexture2D(36160,36064,34069+activeCubeFace,textureProperties.__webglTexture,activeMipmapLevel);\n\n}else if(isRenderTarget3D){\n\nvar _textureProperties=properties.get(renderTarget.texture);\nvar layer=activeCubeFace||0;\n_gl.framebufferTextureLayer(36160,36064,_textureProperties.__webglTexture,activeMipmapLevel||0,layer);\n\n}\n\n_currentMaterialId=-1;// reset current material to ensure correct uniform bindings\n\n};\n\nthis.readRenderTargetPixels=function(renderTarget,x,y,width,height,buffer,activeCubeFaceIndex){\n\nif(!(renderTarget&&renderTarget.isWebGLRenderTarget)){\n\nconsole.error('THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.');\nreturn;\n\n}\n\nvar framebuffer=properties.get(renderTarget).__webglFramebuffer;\n\nif(renderTarget.isWebGLCubeRenderTarget&&activeCubeFaceIndex!==undefined){\n\nframebuffer=framebuffer[activeCubeFaceIndex];\n\n}\n\nif(framebuffer){\n\nstate.bindFramebuffer(36160,framebuffer);\n\ntry{\n\nvar _texture6=renderTarget.texture;\nvar textureFormat=_texture6.format;\nvar textureType=_texture6.type;\n\nif(textureFormat!==RGBAFormat&&utils.convert(textureFormat)!==_gl.getParameter(35739)){\n\nconsole.error('THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.');\nreturn;\n\n}\n\nvar halfFloatSupportedByExt=textureType===HalfFloatType&&(extensions.has('EXT_color_buffer_half_float')||capabilities.isWebGL2&&extensions.has('EXT_color_buffer_float'));\n\nif(textureType!==UnsignedByteType&&utils.convert(textureType)!==_gl.getParameter(35738)&&// Edge and Chrome Mac < 52 (#9513)\n!(textureType===FloatType&&(capabilities.isWebGL2||extensions.has('OES_texture_float')||extensions.has('WEBGL_color_buffer_float')))&&// Chrome Mac >= 52 and Firefox\n!halfFloatSupportedByExt){\n\nconsole.error('THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.');\nreturn;\n\n}\n\n// the following if statement ensures valid read requests (no out-of-bounds pixels, see #8604)\n\nif(x>=0&&x<=renderTarget.width-width&&y>=0&&y<=renderTarget.height-height){\n\n_gl.readPixels(x,y,width,height,utils.convert(textureFormat),utils.convert(textureType),buffer);\n\n}\n\n}finally{\n\n// restore framebuffer of current render target if necessary\n\nvar _framebuffer=_currentRenderTarget!==null?properties.get(_currentRenderTarget).__webglFramebuffer:null;\nstate.bindFramebuffer(36160,_framebuffer);\n\n}\n\n}\n\n};\n\nthis.copyFramebufferToTexture=function(position,texture){var level=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;\n\nvar levelScale=Math.pow(2,-level);\nvar width=Math.floor(texture.image.width*levelScale);\nvar height=Math.floor(texture.image.height*levelScale);\n\ntextures.setTexture2D(texture,0);\n\n_gl.copyTexSubImage2D(3553,level,0,0,position.x,position.y,width,height);\n\nstate.unbindTexture();\n\n};\n\nthis.copyTextureToTexture=function(position,srcTexture,dstTexture){var level=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0;\n\nvar width=srcTexture.image.width;\nvar height=srcTexture.image.height;\nvar glFormat=utils.convert(dstTexture.format);\nvar glType=utils.convert(dstTexture.type);\n\ntextures.setTexture2D(dstTexture,0);\n\n// As another texture upload may have changed pixelStorei\n// parameters, make sure they are correct for the dstTexture\n_gl.pixelStorei(37440,dstTexture.flipY);\n_gl.pixelStorei(37441,dstTexture.premultiplyAlpha);\n_gl.pixelStorei(3317,dstTexture.unpackAlignment);\n\nif(srcTexture.isDataTexture){\n\n_gl.texSubImage2D(3553,level,position.x,position.y,width,height,glFormat,glType,srcTexture.image.data);\n\n}else{\n\nif(srcTexture.isCompressedTexture){\n\n_gl.compressedTexSubImage2D(3553,level,position.x,position.y,srcTexture.mipmaps[0].width,srcTexture.mipmaps[0].height,glFormat,srcTexture.mipmaps[0].data);\n\n}else{\n\n_gl.texSubImage2D(3553,level,position.x,position.y,glFormat,glType,srcTexture.image);\n\n}\n\n}\n\n// Generate mipmaps only when copying level 0\nif(level===0&&dstTexture.generateMipmaps)_gl.generateMipmap(3553);\n\nstate.unbindTexture();\n\n};\n\nthis.copyTextureToTexture3D=function(sourceBox,position,srcTexture,dstTexture){var level=arguments.length>4&&arguments[4]!==undefined?arguments[4]:0;\n\nif(_this.isWebGL1Renderer){\n\nconsole.warn('THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.');\nreturn;\n\n}\n\nvar width=sourceBox.max.x-sourceBox.min.x+1;\nvar height=sourceBox.max.y-sourceBox.min.y+1;\nvar depth=sourceBox.max.z-sourceBox.min.z+1;\nvar glFormat=utils.convert(dstTexture.format);\nvar glType=utils.convert(dstTexture.type);\nvar glTarget=void 0;\n\nif(dstTexture.isData3DTexture){\n\ntextures.setTexture3D(dstTexture,0);\nglTarget=32879;\n\n}else if(dstTexture.isDataArrayTexture){\n\ntextures.setTexture2DArray(dstTexture,0);\nglTarget=35866;\n\n}else{\n\nconsole.warn('THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.');\nreturn;\n\n}\n\n_gl.pixelStorei(37440,dstTexture.flipY);\n_gl.pixelStorei(37441,dstTexture.premultiplyAlpha);\n_gl.pixelStorei(3317,dstTexture.unpackAlignment);\n\nvar unpackRowLen=_gl.getParameter(3314);\nvar unpackImageHeight=_gl.getParameter(32878);\nvar unpackSkipPixels=_gl.getParameter(3316);\nvar unpackSkipRows=_gl.getParameter(3315);\nvar unpackSkipImages=_gl.getParameter(32877);\n\nvar image=srcTexture.isCompressedTexture?srcTexture.mipmaps[0]:srcTexture.image;\n\n_gl.pixelStorei(3314,image.width);\n_gl.pixelStorei(32878,image.height);\n_gl.pixelStorei(3316,sourceBox.min.x);\n_gl.pixelStorei(3315,sourceBox.min.y);\n_gl.pixelStorei(32877,sourceBox.min.z);\n\nif(srcTexture.isDataTexture||srcTexture.isData3DTexture){\n\n_gl.texSubImage3D(glTarget,level,position.x,position.y,position.z,width,height,depth,glFormat,glType,image.data);\n\n}else{\n\nif(srcTexture.isCompressedTexture){\n\nconsole.warn('THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture.');\n_gl.compressedTexSubImage3D(glTarget,level,position.x,position.y,position.z,width,height,depth,glFormat,image.data);\n\n}else{\n\n_gl.texSubImage3D(glTarget,level,position.x,position.y,position.z,width,height,depth,glFormat,glType,image);\n\n}\n\n}\n\n_gl.pixelStorei(3314,unpackRowLen);\n_gl.pixelStorei(32878,unpackImageHeight);\n_gl.pixelStorei(3316,unpackSkipPixels);\n_gl.pixelStorei(3315,unpackSkipRows);\n_gl.pixelStorei(32877,unpackSkipImages);\n\n// Generate mipmaps only when copying level 0\nif(level===0&&dstTexture.generateMipmaps)_gl.generateMipmap(glTarget);\n\nstate.unbindTexture();\n\n};\n\nthis.initTexture=function(texture){\n\nif(texture.isCubeTexture){\n\ntextures.setTextureCube(texture,0);\n\n}else if(texture.isData3DTexture){\n\ntextures.setTexture3D(texture,0);\n\n}else if(texture.isDataArrayTexture){\n\ntextures.setTexture2DArray(texture,0);\n\n}else{\n\ntextures.setTexture2D(texture,0);\n\n}\n\nstate.unbindTexture();\n\n};\n\nthis.resetState=function(){\n\n_currentActiveCubeFace=0;\n_currentActiveMipmapLevel=0;\n_currentRenderTarget=null;\n\nstate.reset();\nbindingStates.reset();\n\n};\n\nif(typeof __THREE_DEVTOOLS__!=='undefined'){\n\n__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent('observe',{detail:this}));\n\n}\n\n}var\n\nWebGL1Renderer=function(_WebGLRenderer){_inherits(WebGL1Renderer,_WebGLRenderer);function WebGL1Renderer(){_classCallCheck(this,WebGL1Renderer);return _possibleConstructorReturn(this,(WebGL1Renderer.__proto__||Object.getPrototypeOf(WebGL1Renderer)).apply(this,arguments));}return WebGL1Renderer;}(WebGLRenderer);\n\nWebGL1Renderer.prototype.isWebGL1Renderer=true;var\n\nFogExp2=function(){\n\nfunction FogExp2(color){var density=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0.00025;_classCallCheck(this,FogExp2);\n\nthis.isFogExp2=true;\n\nthis.name='';\n\nthis.color=new Color(color);\nthis.density=density;\n\n}_createClass(FogExp2,[{key:'clone',value:function clone()\n\n{\n\nreturn new FogExp2(this.color,this.density);\n\n}},{key:'toJSON',value:function toJSON()\n\n/* meta */{\n\nreturn{\ntype:'FogExp2',\ncolor:this.color.getHex(),\ndensity:this.density};\n\n\n}}]);return FogExp2;}();var\n\n\n\nFog=function(){\n\nfunction Fog(color){var near=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1;var far=arguments.length>2&&arguments[2]!==undefined?arguments[2]:1000;_classCallCheck(this,Fog);\n\nthis.isFog=true;\n\nthis.name='';\n\nthis.color=new Color(color);\n\nthis.near=near;\nthis.far=far;\n\n}_createClass(Fog,[{key:'clone',value:function clone()\n\n{\n\nreturn new Fog(this.color,this.near,this.far);\n\n}},{key:'toJSON',value:function toJSON()\n\n/* meta */{\n\nreturn{\ntype:'Fog',\ncolor:this.color.getHex(),\nnear:this.near,\nfar:this.far};\n\n\n}}]);return Fog;}();var\n\n\n\nScene=function(_Object3D5){_inherits(Scene,_Object3D5);\n\nfunction Scene(){_classCallCheck(this,Scene);var _this40=_possibleConstructorReturn(this,(Scene.__proto__||Object.getPrototypeOf(Scene)).call(this));\n\n\n\n_this40.isScene=true;\n\n_this40.type='Scene';\n\n_this40.background=null;\n_this40.environment=null;\n_this40.fog=null;\n\n_this40.overrideMaterial=null;\n\n_this40.autoUpdate=true;// checked by the renderer\n\nif(typeof __THREE_DEVTOOLS__!=='undefined'){\n\n__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent('observe',{detail:_this40}));\n\n}return _this40;\n\n}_createClass(Scene,[{key:'copy',value:function copy(\n\nsource,recursive){\n\n_get(Scene.prototype.__proto__||Object.getPrototypeOf(Scene.prototype),'copy',this).call(this,source,recursive);\n\nif(source.background!==null)this.background=source.background.clone();\nif(source.environment!==null)this.environment=source.environment.clone();\nif(source.fog!==null)this.fog=source.fog.clone();\n\nif(source.overrideMaterial!==null)this.overrideMaterial=source.overrideMaterial.clone();\n\nthis.autoUpdate=source.autoUpdate;\nthis.matrixAutoUpdate=source.matrixAutoUpdate;\n\nreturn this;\n\n}},{key:'toJSON',value:function toJSON(\n\nmeta){\n\nvar data=_get(Scene.prototype.__proto__||Object.getPrototypeOf(Scene.prototype),'toJSON',this).call(this,meta);\n\nif(this.fog!==null)data.object.fog=this.fog.toJSON();\n\nreturn data;\n\n}}]);return Scene;}(Object3D);var\n\n\n\nInterleavedBuffer=function(){\n\nfunction InterleavedBuffer(array,stride){_classCallCheck(this,InterleavedBuffer);\n\nthis.isInterleavedBuffer=true;\n\nthis.array=array;\nthis.stride=stride;\nthis.count=array!==undefined?array.length/stride:0;\n\nthis.usage=StaticDrawUsage;\nthis.updateRange={offset:0,count:-1};\n\nthis.version=0;\n\nthis.uuid=generateUUID();\n\n}_createClass(InterleavedBuffer,[{key:'onUploadCallback',value:function onUploadCallback()\n\n{}},{key:'setUsage',value:function setUsage(\n\n\n\n\n\n\n\nvalue){\n\nthis.usage=value;\n\nreturn this;\n\n}},{key:'copy',value:function copy(\n\nsource){\n\nthis.array=new source.array.constructor(source.array);\nthis.count=source.count;\nthis.stride=source.stride;\nthis.usage=source.usage;\n\nreturn this;\n\n}},{key:'copyAt',value:function copyAt(\n\nindex1,attribute,index2){\n\nindex1*=this.stride;\nindex2*=attribute.stride;\n\nfor(var i=0,l=this.stride;i<l;i++){\n\nthis.array[index1+i]=attribute.array[index2+i];\n\n}\n\nreturn this;\n\n}},{key:'set',value:function set(\n\nvalue){var offset=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;\n\nthis.array.set(value,offset);\n\nreturn this;\n\n}},{key:'clone',value:function clone(\n\ndata){\n\nif(data.arrayBuffers===undefined){\n\ndata.arrayBuffers={};\n\n}\n\nif(this.array.buffer._uuid===undefined){\n\nthis.array.buffer._uuid=generateUUID();\n\n}\n\nif(data.arrayBuffers[this.array.buffer._uuid]===undefined){\n\ndata.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer;\n\n}\n\nvar array=new this.array.constructor(data.arrayBuffers[this.array.buffer._uuid]);\n\nvar ib=new this.constructor(array,this.stride);\nib.setUsage(this.usage);\n\nreturn ib;\n\n}},{key:'onUpload',value:function onUpload(\n\ncallback){\n\nthis.onUploadCallback=callback;\n\nreturn this;\n\n}},{key:'toJSON',value:function toJSON(\n\ndata){\n\nif(data.arrayBuffers===undefined){\n\ndata.arrayBuffers={};\n\n}\n\n// generate UUID for array buffer if necessary\n\nif(this.array.buffer._uuid===undefined){\n\nthis.array.buffer._uuid=generateUUID();\n\n}\n\nif(data.arrayBuffers[this.array.buffer._uuid]===undefined){\n\ndata.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer));\n\n}\n\n//\n\nreturn{\nuuid:this.uuid,\nbuffer:this.array.buffer._uuid,\ntype:this.array.constructor.name,\nstride:this.stride};\n\n\n}},{key:'needsUpdate',set:function set(value){if(value===true)this.version++;}}]);return InterleavedBuffer;}();\n\n\n\nvar _vector$6=/*@__PURE__*/new Vector3();var\n\nInterleavedBufferAttribute=function(){\n\nfunction InterleavedBufferAttribute(interleavedBuffer,itemSize,offset){var normalized=arguments.length>3&&arguments[3]!==undefined?arguments[3]:false;_classCallCheck(this,InterleavedBufferAttribute);\n\nthis.isInterleavedBufferAttribute=true;\n\nthis.name='';\n\nthis.data=interleavedBuffer;\nthis.itemSize=itemSize;\nthis.offset=offset;\n\nthis.normalized=normalized===true;\n\n}_createClass(InterleavedBufferAttribute,[{key:'applyMatrix4',value:function applyMatrix4(\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nm){\n\nfor(var i=0,l=this.data.count;i<l;i++){\n\n_vector$6.fromBufferAttribute(this,i);\n\n_vector$6.applyMatrix4(m);\n\nthis.setXYZ(i,_vector$6.x,_vector$6.y,_vector$6.z);\n\n}\n\nreturn this;\n\n}},{key:'applyNormalMatrix',value:function applyNormalMatrix(\n\nm){\n\nfor(var i=0,l=this.count;i<l;i++){\n\n_vector$6.fromBufferAttribute(this,i);\n\n_vector$6.applyNormalMatrix(m);\n\nthis.setXYZ(i,_vector$6.x,_vector$6.y,_vector$6.z);\n\n}\n\nreturn this;\n\n}},{key:'transformDirection',value:function transformDirection(\n\nm){\n\nfor(var i=0,l=this.count;i<l;i++){\n\n_vector$6.fromBufferAttribute(this,i);\n\n_vector$6.transformDirection(m);\n\nthis.setXYZ(i,_vector$6.x,_vector$6.y,_vector$6.z);\n\n}\n\nreturn this;\n\n}},{key:'setX',value:function setX(\n\nindex,x){\n\nthis.data.array[index*this.data.stride+this.offset]=x;\n\nreturn this;\n\n}},{key:'setY',value:function setY(\n\nindex,y){\n\nthis.data.array[index*this.data.stride+this.offset+1]=y;\n\nreturn this;\n\n}},{key:'setZ',value:function setZ(\n\nindex,z){\n\nthis.data.array[index*this.data.stride+this.offset+2]=z;\n\nreturn this;\n\n}},{key:'setW',value:function setW(\n\nindex,w){\n\nthis.data.array[index*this.data.stride+this.offset+3]=w;\n\nreturn this;\n\n}},{key:'getX',value:function getX(\n\nindex){\n\nreturn this.data.array[index*this.data.stride+this.offset];\n\n}},{key:'getY',value:function getY(\n\nindex){\n\nreturn this.data.array[index*this.data.stride+this.offset+1];\n\n}},{key:'getZ',value:function getZ(\n\nindex){\n\nreturn this.data.array[index*this.data.stride+this.offset+2];\n\n}},{key:'getW',value:function getW(\n\nindex){\n\nreturn this.data.array[index*this.data.stride+this.offset+3];\n\n}},{key:'setXY',value:function setXY(\n\nindex,x,y){\n\nindex=index*this.data.stride+this.offset;\n\nthis.data.array[index+0]=x;\nthis.data.array[index+1]=y;\n\nreturn this;\n\n}},{key:'setXYZ',value:function setXYZ(\n\nindex,x,y,z){\n\nindex=index*this.data.stride+this.offset;\n\nthis.data.array[index+0]=x;\nthis.data.array[index+1]=y;\nthis.data.array[index+2]=z;\n\nreturn this;\n\n}},{key:'setXYZW',value:function setXYZW(\n\nindex,x,y,z,w){\n\nindex=index*this.data.stride+this.offset;\n\nthis.data.array[index+0]=x;\nthis.data.array[index+1]=y;\nthis.data.array[index+2]=z;\nthis.data.array[index+3]=w;\n\nreturn this;\n\n}},{key:'clone',value:function clone(\n\ndata){\n\nif(data===undefined){\n\nconsole.log('THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will deinterleave buffer data.');\n\nvar array=[];\n\nfor(var i=0;i<this.count;i++){\n\nvar index=i*this.data.stride+this.offset;\n\nfor(var j=0;j<this.itemSize;j++){\n\narray.push(this.data.array[index+j]);\n\n}\n\n}\n\nreturn new BufferAttribute(new this.array.constructor(array),this.itemSize,this.normalized);\n\n}else{\n\nif(data.interleavedBuffers===undefined){\n\ndata.interleavedBuffers={};\n\n}\n\nif(data.interleavedBuffers[this.data.uuid]===undefined){\n\ndata.interleavedBuffers[this.data.uuid]=this.data.clone(data);\n\n}\n\nreturn new InterleavedBufferAttribute(data.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized);\n\n}\n\n}},{key:'toJSON',value:function toJSON(\n\ndata){\n\nif(data===undefined){\n\nconsole.log('THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will deinterleave buffer data.');\n\nvar array=[];\n\nfor(var i=0;i<this.count;i++){\n\nvar index=i*this.data.stride+this.offset;\n\nfor(var j=0;j<this.itemSize;j++){\n\narray.push(this.data.array[index+j]);\n\n}\n\n}\n\n// deinterleave data and save it as an ordinary buffer attribute for now\n\nreturn{\nitemSize:this.itemSize,\ntype:this.array.constructor.name,\narray:array,\nnormalized:this.normalized};\n\n\n}else{\n\n// save as true interleaved attribtue\n\nif(data.interleavedBuffers===undefined){\n\ndata.interleavedBuffers={};\n\n}\n\nif(data.interleavedBuffers[this.data.uuid]===undefined){\n\ndata.interleavedBuffers[this.data.uuid]=this.data.toJSON(data);\n\n}\n\nreturn{\nisInterleavedBufferAttribute:true,\nitemSize:this.itemSize,\ndata:this.data.uuid,\noffset:this.offset,\nnormalized:this.normalized};\n\n\n}\n\n}},{key:'count',get:function get(){return this.data.count;}},{key:'array',get:function get(){return this.data.array;}},{key:'needsUpdate',set:function set(value){this.data.needsUpdate=value;}}]);return InterleavedBufferAttribute;}();var\n\n\n\nSpriteMaterial=function(_Material5){_inherits(SpriteMaterial,_Material5);\n\nfunction SpriteMaterial(parameters){_classCallCheck(this,SpriteMaterial);var _this41=_possibleConstructorReturn(this,(SpriteMaterial.__proto__||Object.getPrototypeOf(SpriteMaterial)).call(this));\n\n\n\n_this41.isSpriteMaterial=true;\n\n_this41.type='SpriteMaterial';\n\n_this41.color=new Color(0xffffff);\n\n_this41.map=null;\n\n_this41.alphaMap=null;\n\n_this41.rotation=0;\n\n_this41.sizeAttenuation=true;\n\n_this41.transparent=true;\n\n_this41.fog=true;\n\n_this41.setValues(parameters);return _this41;\n\n}_createClass(SpriteMaterial,[{key:'copy',value:function copy(\n\nsource){\n\n_get(SpriteMaterial.prototype.__proto__||Object.getPrototypeOf(SpriteMaterial.prototype),'copy',this).call(this,source);\n\nthis.color.copy(source.color);\n\nthis.map=source.map;\n\nthis.alphaMap=source.alphaMap;\n\nthis.rotation=source.rotation;\n\nthis.sizeAttenuation=source.sizeAttenuation;\n\nthis.fog=source.fog;\n\nreturn this;\n\n}}]);return SpriteMaterial;}(Material);\n\n\n\nvar _geometry=void 0;\n\nvar _intersectPoint=/*@__PURE__*/new Vector3();\nvar _worldScale=/*@__PURE__*/new Vector3();\nvar _mvPosition=/*@__PURE__*/new Vector3();\n\nvar _alignedPosition=/*@__PURE__*/new Vector2();\nvar _rotatedPosition=/*@__PURE__*/new Vector2();\nvar _viewWorldMatrix=/*@__PURE__*/new Matrix4();\n\nvar _vA=/*@__PURE__*/new Vector3();\nvar _vB=/*@__PURE__*/new Vector3();\nvar _vC=/*@__PURE__*/new Vector3();\n\nvar _uvA=/*@__PURE__*/new Vector2();\nvar _uvB=/*@__PURE__*/new Vector2();\nvar _uvC=/*@__PURE__*/new Vector2();var\n\nSprite=function(_Object3D6){_inherits(Sprite,_Object3D6);\n\nfunction Sprite(material){_classCallCheck(this,Sprite);var _this42=_possibleConstructorReturn(this,(Sprite.__proto__||Object.getPrototypeOf(Sprite)).call(this));\n\n\n\n_this42.isSprite=true;\n\n_this42.type='Sprite';\n\nif(_geometry===undefined){\n\n_geometry=new BufferGeometry();\n\nvar float32Array=new Float32Array([\n-0.5,-0.5,0,0,0,\n0.5,-0.5,0,1,0,\n0.5,0.5,0,1,1,\n-0.5,0.5,0,0,1]);\n\n\nvar interleavedBuffer=new InterleavedBuffer(float32Array,5);\n\n_geometry.setIndex([0,1,2,0,2,3]);\n_geometry.setAttribute('position',new InterleavedBufferAttribute(interleavedBuffer,3,0,false));\n_geometry.setAttribute('uv',new InterleavedBufferAttribute(interleavedBuffer,2,3,false));\n\n}\n\n_this42.geometry=_geometry;\n_this42.material=material!==undefined?material:new SpriteMaterial();\n\n_this42.center=new Vector2(0.5,0.5);return _this42;\n\n}_createClass(Sprite,[{key:'raycast',value:function raycast(\n\nraycaster,intersects){\n\nif(raycaster.camera===null){\n\nconsole.error('THREE.Sprite: \"Raycaster.camera\" needs to be set in order to raycast against sprites.');\n\n}\n\n_worldScale.setFromMatrixScale(this.matrixWorld);\n\n_viewWorldMatrix.copy(raycaster.camera.matrixWorld);\nthis.modelViewMatrix.multiplyMatrices(raycaster.camera.matrixWorldInverse,this.matrixWorld);\n\n_mvPosition.setFromMatrixPosition(this.modelViewMatrix);\n\nif(raycaster.camera.isPerspectiveCamera&&this.material.sizeAttenuation===false){\n\n_worldScale.multiplyScalar(-_mvPosition.z);\n\n}\n\nvar rotation=this.material.rotation;\nvar sin=void 0,cos=void 0;\n\nif(rotation!==0){\n\ncos=Math.cos(rotation);\nsin=Math.sin(rotation);\n\n}\n\nvar center=this.center;\n\ntransformVertex(_vA.set(-0.5,-0.5,0),_mvPosition,center,_worldScale,sin,cos);\ntransformVertex(_vB.set(0.5,-0.5,0),_mvPosition,center,_worldScale,sin,cos);\ntransformVertex(_vC.set(0.5,0.5,0),_mvPosition,center,_worldScale,sin,cos);\n\n_uvA.set(0,0);\n_uvB.set(1,0);\n_uvC.set(1,1);\n\n// check first triangle\nvar intersect=raycaster.ray.intersectTriangle(_vA,_vB,_vC,false,_intersectPoint);\n\nif(intersect===null){\n\n// check second triangle\ntransformVertex(_vB.set(-0.5,0.5,0),_mvPosition,center,_worldScale,sin,cos);\n_uvB.set(0,1);\n\nintersect=raycaster.ray.intersectTriangle(_vA,_vC,_vB,false,_intersectPoint);\nif(intersect===null){\n\nreturn;\n\n}\n\n}\n\nvar distance=raycaster.ray.origin.distanceTo(_intersectPoint);\n\nif(distance<raycaster.near||distance>raycaster.far)return;\n\nintersects.push({\n\ndistance:distance,\npoint:_intersectPoint.clone(),\nuv:Triangle.getUV(_intersectPoint,_vA,_vB,_vC,_uvA,_uvB,_uvC,new Vector2()),\nface:null,\nobject:this});\n\n\n\n}},{key:'copy',value:function copy(\n\nsource,recursive){\n\n_get(Sprite.prototype.__proto__||Object.getPrototypeOf(Sprite.prototype),'copy',this).call(this,source,recursive);\n\nif(source.center!==undefined)this.center.copy(source.center);\n\nthis.material=source.material;\n\nreturn this;\n\n}}]);return Sprite;}(Object3D);\n\n\n\nfunction transformVertex(vertexPosition,mvPosition,center,scale,sin,cos){\n\n// compute position in camera space\n_alignedPosition.subVectors(vertexPosition,center).addScalar(0.5).multiply(scale);\n\n// to check if rotation is not zero\nif(sin!==undefined){\n\n_rotatedPosition.x=cos*_alignedPosition.x-sin*_alignedPosition.y;\n_rotatedPosition.y=sin*_alignedPosition.x+cos*_alignedPosition.y;\n\n}else{\n\n_rotatedPosition.copy(_alignedPosition);\n\n}\n\n\nvertexPosition.copy(mvPosition);\nvertexPosition.x+=_rotatedPosition.x;\nvertexPosition.y+=_rotatedPosition.y;\n\n// transform to world space\nvertexPosition.applyMatrix4(_viewWorldMatrix);\n\n}\n\nvar _v1$2=/*@__PURE__*/new Vector3();\nvar _v2$1=/*@__PURE__*/new Vector3();var\n\nLOD=function(_Object3D7){_inherits(LOD,_Object3D7);\n\nfunction LOD(){_classCallCheck(this,LOD);var _this43=_possibleConstructorReturn(this,(LOD.__proto__||Object.getPrototypeOf(LOD)).call(this));\n\n\n\n_this43._currentLevel=0;\n\n_this43.type='LOD';\n\nObject.defineProperties(_this43,{\nlevels:{\nenumerable:true,\nvalue:[]},\n\nisLOD:{\nvalue:true}});\n\n\n\n_this43.autoUpdate=true;return _this43;\n\n}_createClass(LOD,[{key:'copy',value:function copy(\n\nsource){\n\n_get(LOD.prototype.__proto__||Object.getPrototypeOf(LOD.prototype),'copy',this).call(this,source,false);\n\nvar levels=source.levels;\n\nfor(var i=0,l=levels.length;i<l;i++){\n\nvar level=levels[i];\n\nthis.addLevel(level.object.clone(),level.distance);\n\n}\n\nthis.autoUpdate=source.autoUpdate;\n\nreturn this;\n\n}},{key:'addLevel',value:function addLevel(\n\nobject){var distance=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;\n\ndistance=Math.abs(distance);\n\nvar levels=this.levels;\n\nvar l=void 0;\n\nfor(l=0;l<levels.length;l++){\n\nif(distance<levels[l].distance){\n\nbreak;\n\n}\n\n}\n\nlevels.splice(l,0,{distance:distance,object:object});\n\nthis.add(object);\n\nreturn this;\n\n}},{key:'getCurrentLevel',value:function getCurrentLevel()\n\n{\n\nreturn this._currentLevel;\n\n}},{key:'getObjectForDistance',value:function getObjectForDistance(\n\ndistance){\n\nvar levels=this.levels;\n\nif(levels.length>0){\n\nvar i=void 0,l=void 0;\n\nfor(i=1,l=levels.length;i<l;i++){\n\nif(distance<levels[i].distance){\n\nbreak;\n\n}\n\n}\n\nreturn levels[i-1].object;\n\n}\n\nreturn null;\n\n}},{key:'raycast',value:function raycast(\n\nraycaster,intersects){\n\nvar levels=this.levels;\n\nif(levels.length>0){\n\n_v1$2.setFromMatrixPosition(this.matrixWorld);\n\nvar distance=raycaster.ray.origin.distanceTo(_v1$2);\n\nthis.getObjectForDistance(distance).raycast(raycaster,intersects);\n\n}\n\n}},{key:'update',value:function update(\n\ncamera){\n\nvar levels=this.levels;\n\nif(levels.length>1){\n\n_v1$2.setFromMatrixPosition(camera.matrixWorld);\n_v2$1.setFromMatrixPosition(this.matrixWorld);\n\nvar distance=_v1$2.distanceTo(_v2$1)/camera.zoom;\n\nlevels[0].object.visible=true;\n\nvar i=void 0,l=void 0;\n\nfor(i=1,l=levels.length;i<l;i++){\n\nif(distance>=levels[i].distance){\n\nlevels[i-1].object.visible=false;\nlevels[i].object.visible=true;\n\n}else{\n\nbreak;\n\n}\n\n}\n\nthis._currentLevel=i-1;\n\nfor(;i<l;i++){\n\nlevels[i].object.visible=false;\n\n}\n\n}\n\n}},{key:'toJSON',value:function toJSON(\n\nmeta){\n\nvar data=_get(LOD.prototype.__proto__||Object.getPrototypeOf(LOD.prototype),'toJSON',this).call(this,meta);\n\nif(this.autoUpdate===false)data.object.autoUpdate=false;\n\ndata.object.levels=[];\n\nvar levels=this.levels;\n\nfor(var i=0,l=levels.length;i<l;i++){\n\nvar level=levels[i];\n\ndata.object.levels.push({\nobject:level.object.uuid,\ndistance:level.distance});\n\n\n}\n\nreturn data;\n\n}}]);return LOD;}(Object3D);\n\n\n\nvar _basePosition=/*@__PURE__*/new Vector3();\n\nvar _skinIndex=/*@__PURE__*/new Vector4();\nvar _skinWeight=/*@__PURE__*/new Vector4();\n\nvar _vector$5=/*@__PURE__*/new Vector3();\nvar _matrix=/*@__PURE__*/new Matrix4();var\n\nSkinnedMesh=function(_Mesh){_inherits(SkinnedMesh,_Mesh);\n\nfunction SkinnedMesh(geometry,material){_classCallCheck(this,SkinnedMesh);var _this44=_possibleConstructorReturn(this,(SkinnedMesh.__proto__||Object.getPrototypeOf(SkinnedMesh)).call(this,\n\ngeometry,material));\n\n_this44.isSkinnedMesh=true;\n\n_this44.type='SkinnedMesh';\n\n_this44.bindMode='attached';\n_this44.bindMatrix=new Matrix4();\n_this44.bindMatrixInverse=new Matrix4();return _this44;\n\n}_createClass(SkinnedMesh,[{key:'copy',value:function copy(\n\nsource,recursive){\n\n_get(SkinnedMesh.prototype.__proto__||Object.getPrototypeOf(SkinnedMesh.prototype),'copy',this).call(this,source,recursive);\n\nthis.bindMode=source.bindMode;\nthis.bindMatrix.copy(source.bindMatrix);\nthis.bindMatrixInverse.copy(source.bindMatrixInverse);\n\nthis.skeleton=source.skeleton;\n\nreturn this;\n\n}},{key:'bind',value:function bind(\n\nskeleton,bindMatrix){\n\nthis.skeleton=skeleton;\n\nif(bindMatrix===undefined){\n\nthis.updateMatrixWorld(true);\n\nthis.skeleton.calculateInverses();\n\nbindMatrix=this.matrixWorld;\n\n}\n\nthis.bindMatrix.copy(bindMatrix);\nthis.bindMatrixInverse.copy(bindMatrix).invert();\n\n}},{key:'pose',value:function pose()\n\n{\n\nthis.skeleton.pose();\n\n}},{key:'normalizeSkinWeights',value:function normalizeSkinWeights()\n\n{\n\nvar vector=new Vector4();\n\nvar skinWeight=this.geometry.attributes.skinWeight;\n\nfor(var i=0,l=skinWeight.count;i<l;i++){\n\nvector.fromBufferAttribute(skinWeight,i);\n\nvar scale=1.0/vector.manhattanLength();\n\nif(scale!==Infinity){\n\nvector.multiplyScalar(scale);\n\n}else{\n\nvector.set(1,0,0,0);// do something reasonable\n\n}\n\nskinWeight.setXYZW(i,vector.x,vector.y,vector.z,vector.w);\n\n}\n\n}},{key:'updateMatrixWorld',value:function updateMatrixWorld(\n\nforce){\n\n_get(SkinnedMesh.prototype.__proto__||Object.getPrototypeOf(SkinnedMesh.prototype),'updateMatrixWorld',this).call(this,force);\n\nif(this.bindMode==='attached'){\n\nthis.bindMatrixInverse.copy(this.matrixWorld).invert();\n\n}else if(this.bindMode==='detached'){\n\nthis.bindMatrixInverse.copy(this.bindMatrix).invert();\n\n}else{\n\nconsole.warn('THREE.SkinnedMesh: Unrecognized bindMode: '+this.bindMode);\n\n}\n\n}},{key:'boneTransform',value:function boneTransform(\n\nindex,target){\n\nvar skeleton=this.skeleton;\nvar geometry=this.geometry;\n\n_skinIndex.fromBufferAttribute(geometry.attributes.skinIndex,index);\n_skinWeight.fromBufferAttribute(geometry.attributes.skinWeight,index);\n\n_basePosition.copy(target).applyMatrix4(this.bindMatrix);\n\ntarget.set(0,0,0);\n\nfor(var i=0;i<4;i++){\n\nvar weight=_skinWeight.getComponent(i);\n\nif(weight!==0){\n\nvar boneIndex=_skinIndex.getComponent(i);\n\n_matrix.multiplyMatrices(skeleton.bones[boneIndex].matrixWorld,skeleton.boneInverses[boneIndex]);\n\ntarget.addScaledVector(_vector$5.copy(_basePosition).applyMatrix4(_matrix),weight);\n\n}\n\n}\n\nreturn target.applyMatrix4(this.bindMatrixInverse);\n\n}}]);return SkinnedMesh;}(Mesh);var\n\n\n\nBone=function(_Object3D8){_inherits(Bone,_Object3D8);\n\nfunction Bone(){_classCallCheck(this,Bone);var _this45=_possibleConstructorReturn(this,(Bone.__proto__||Object.getPrototypeOf(Bone)).call(this));\n\n\n\n_this45.isBone=true;\n\n_this45.type='Bone';return _this45;\n\n}return Bone;}(Object3D);var\n\n\n\nDataTexture=function(_Texture5){_inherits(DataTexture,_Texture5);\n\nfunction DataTexture(){var data=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;var width=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1;var height=arguments.length>2&&arguments[2]!==undefined?arguments[2]:1;var format=arguments[3];var type=arguments[4];var mapping=arguments[5];var wrapS=arguments[6];var wrapT=arguments[7];var magFilter=arguments.length>8&&arguments[8]!==undefined?arguments[8]:NearestFilter;var minFilter=arguments.length>9&&arguments[9]!==undefined?arguments[9]:NearestFilter;var anisotropy=arguments[10];var encoding=arguments[11];_classCallCheck(this,DataTexture);var _this46=_possibleConstructorReturn(this,(DataTexture.__proto__||Object.getPrototypeOf(DataTexture)).call(this,\n\nnull,mapping,wrapS,wrapT,magFilter,minFilter,format,type,anisotropy,encoding));\n\n_this46.isDataTexture=true;\n\n_this46.image={data:data,width:width,height:height};\n\n_this46.generateMipmaps=false;\n_this46.flipY=false;\n_this46.unpackAlignment=1;return _this46;\n\n}return DataTexture;}(Texture);\n\n\n\nvar _offsetMatrix=/*@__PURE__*/new Matrix4();\nvar _identityMatrix=/*@__PURE__*/new Matrix4();var\n\nSkeleton=function(){\n\nfunction Skeleton(){var bones=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];var boneInverses=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];_classCallCheck(this,Skeleton);\n\nthis.uuid=generateUUID();\n\nthis.bones=bones.slice(0);\nthis.boneInverses=boneInverses;\nthis.boneMatrices=null;\n\nthis.boneTexture=null;\nthis.boneTextureSize=0;\n\nthis.frame=-1;\n\nthis.init();\n\n}_createClass(Skeleton,[{key:'init',value:function init()\n\n{\n\nvar bones=this.bones;\nvar boneInverses=this.boneInverses;\n\nthis.boneMatrices=new Float32Array(bones.length*16);\n\n// calculate inverse bone matrices if necessary\n\nif(boneInverses.length===0){\n\nthis.calculateInverses();\n\n}else{\n\n// handle special case\n\nif(bones.length!==boneInverses.length){\n\nconsole.warn('THREE.Skeleton: Number of inverse bone matrices does not match amount of bones.');\n\nthis.boneInverses=[];\n\nfor(var i=0,il=this.bones.length;i<il;i++){\n\nthis.boneInverses.push(new Matrix4());\n\n}\n\n}\n\n}\n\n}},{key:'calculateInverses',value:function calculateInverses()\n\n{\n\nthis.boneInverses.length=0;\n\nfor(var i=0,il=this.bones.length;i<il;i++){\n\nvar inverse=new Matrix4();\n\nif(this.bones[i]){\n\ninverse.copy(this.bones[i].matrixWorld).invert();\n\n}\n\nthis.boneInverses.push(inverse);\n\n}\n\n}},{key:'pose',value:function pose()\n\n{\n\n// recover the bind-time world matrices\n\nfor(var i=0,il=this.bones.length;i<il;i++){\n\nvar bone=this.bones[i];\n\nif(bone){\n\nbone.matrixWorld.copy(this.boneInverses[i]).invert();\n\n}\n\n}\n\n// compute the local matrices, positions, rotations and scales\n\nfor(var _i52=0,_il12=this.bones.length;_i52<_il12;_i52++){\n\nvar _bone=this.bones[_i52];\n\nif(_bone){\n\nif(_bone.parent&&_bone.parent.isBone){\n\n_bone.matrix.copy(_bone.parent.matrixWorld).invert();\n_bone.matrix.multiply(_bone.matrixWorld);\n\n}else{\n\n_bone.matrix.copy(_bone.matrixWorld);\n\n}\n\n_bone.matrix.decompose(_bone.position,_bone.quaternion,_bone.scale);\n\n}\n\n}\n\n}},{key:'update',value:function update()\n\n{\n\nvar bones=this.bones;\nvar boneInverses=this.boneInverses;\nvar boneMatrices=this.boneMatrices;\nvar boneTexture=this.boneTexture;\n\n// flatten bone matrices to array\n\nfor(var i=0,il=bones.length;i<il;i++){\n\n// compute the offset between the current and the original transform\n\nvar matrix=bones[i]?bones[i].matrixWorld:_identityMatrix;\n\n_offsetMatrix.multiplyMatrices(matrix,boneInverses[i]);\n_offsetMatrix.toArray(boneMatrices,i*16);\n\n}\n\nif(boneTexture!==null){\n\nboneTexture.needsUpdate=true;\n\n}\n\n}},{key:'clone',value:function clone()\n\n{\n\nreturn new Skeleton(this.bones,this.boneInverses);\n\n}},{key:'computeBoneTexture',value:function computeBoneTexture()\n\n{\n\n// layout (1 matrix = 4 pixels)\n//      RGBA RGBA RGBA RGBA (=> column1, column2, column3, column4)\n//  with  8x8  pixel texture max   16 bones * 4 pixels =  (8 * 8)\n//       16x16 pixel texture max   64 bones * 4 pixels = (16 * 16)\n//       32x32 pixel texture max  256 bones * 4 pixels = (32 * 32)\n//       64x64 pixel texture max 1024 bones * 4 pixels = (64 * 64)\n\nvar size=Math.sqrt(this.bones.length*4);// 4 pixels needed for 1 matrix\nsize=ceilPowerOfTwo(size);\nsize=Math.max(size,4);\n\nvar boneMatrices=new Float32Array(size*size*4);// 4 floats per RGBA pixel\nboneMatrices.set(this.boneMatrices);// copy current values\n\nvar boneTexture=new DataTexture(boneMatrices,size,size,RGBAFormat,FloatType);\nboneTexture.needsUpdate=true;\n\nthis.boneMatrices=boneMatrices;\nthis.boneTexture=boneTexture;\nthis.boneTextureSize=size;\n\nreturn this;\n\n}},{key:'getBoneByName',value:function getBoneByName(\n\nname){\n\nfor(var i=0,il=this.bones.length;i<il;i++){\n\nvar bone=this.bones[i];\n\nif(bone.name===name){\n\nreturn bone;\n\n}\n\n}\n\nreturn undefined;\n\n}},{key:'dispose',value:function dispose()\n\n{\n\nif(this.boneTexture!==null){\n\nthis.boneTexture.dispose();\n\nthis.boneTexture=null;\n\n}\n\n}},{key:'fromJSON',value:function fromJSON(\n\njson,bones){\n\nthis.uuid=json.uuid;\n\nfor(var i=0,l=json.bones.length;i<l;i++){\n\nvar uuid=json.bones[i];\nvar bone=bones[uuid];\n\nif(bone===undefined){\n\nconsole.warn('THREE.Skeleton: No bone found with UUID:',uuid);\nbone=new Bone();\n\n}\n\nthis.bones.push(bone);\nthis.boneInverses.push(new Matrix4().fromArray(json.boneInverses[i]));\n\n}\n\nthis.init();\n\nreturn this;\n\n}},{key:'toJSON',value:function toJSON()\n\n{\n\nvar data={\nmetadata:{\nversion:4.5,\ntype:'Skeleton',\ngenerator:'Skeleton.toJSON'},\n\nbones:[],\nboneInverses:[]};\n\n\ndata.uuid=this.uuid;\n\nvar bones=this.bones;\nvar boneInverses=this.boneInverses;\n\nfor(var i=0,l=bones.length;i<l;i++){\n\nvar bone=bones[i];\ndata.bones.push(bone.uuid);\n\nvar boneInverse=boneInverses[i];\ndata.boneInverses.push(boneInverse.toArray());\n\n}\n\nreturn data;\n\n}}]);return Skeleton;}();var\n\n\n\nInstancedBufferAttribute=function(_BufferAttribute11){_inherits(InstancedBufferAttribute,_BufferAttribute11);\n\nfunction InstancedBufferAttribute(array,itemSize,normalized){var meshPerAttribute=arguments.length>3&&arguments[3]!==undefined?arguments[3]:1;_classCallCheck(this,InstancedBufferAttribute);\n\nif(typeof normalized==='number'){\n\nmeshPerAttribute=normalized;\n\nnormalized=false;\n\nconsole.error('THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.');\n\n}var _this47=_possibleConstructorReturn(this,(InstancedBufferAttribute.__proto__||Object.getPrototypeOf(InstancedBufferAttribute)).call(this,\n\narray,itemSize,normalized));\n\n_this47.isInstancedBufferAttribute=true;\n\n_this47.meshPerAttribute=meshPerAttribute;return _this47;\n\n}_createClass(InstancedBufferAttribute,[{key:'copy',value:function copy(\n\nsource){\n\n_get(InstancedBufferAttribute.prototype.__proto__||Object.getPrototypeOf(InstancedBufferAttribute.prototype),'copy',this).call(this,source);\n\nthis.meshPerAttribute=source.meshPerAttribute;\n\nreturn this;\n\n}},{key:'toJSON',value:function toJSON()\n\n{\n\nvar data=_get(InstancedBufferAttribute.prototype.__proto__||Object.getPrototypeOf(InstancedBufferAttribute.prototype),'toJSON',this).call(this);\n\ndata.meshPerAttribute=this.meshPerAttribute;\n\ndata.isInstancedBufferAttribute=true;\n\nreturn data;\n\n}}]);return InstancedBufferAttribute;}(BufferAttribute);\n\n\n\nvar _instanceLocalMatrix=/*@__PURE__*/new Matrix4();\nvar _instanceWorldMatrix=/*@__PURE__*/new Matrix4();\n\nvar _instanceIntersects=[];\n\nvar _mesh=/*@__PURE__*/new Mesh();var\n\nInstancedMesh=function(_Mesh2){_inherits(InstancedMesh,_Mesh2);\n\nfunction InstancedMesh(geometry,material,count){_classCallCheck(this,InstancedMesh);var _this48=_possibleConstructorReturn(this,(InstancedMesh.__proto__||Object.getPrototypeOf(InstancedMesh)).call(this,\n\ngeometry,material));\n\n_this48.isInstancedMesh=true;\n\n_this48.instanceMatrix=new InstancedBufferAttribute(new Float32Array(count*16),16);\n_this48.instanceColor=null;\n\n_this48.count=count;\n\n_this48.frustumCulled=false;return _this48;\n\n}_createClass(InstancedMesh,[{key:'copy',value:function copy(\n\nsource,recursive){\n\n_get(InstancedMesh.prototype.__proto__||Object.getPrototypeOf(InstancedMesh.prototype),'copy',this).call(this,source,recursive);\n\nthis.instanceMatrix.copy(source.instanceMatrix);\n\nif(source.instanceColor!==null)this.instanceColor=source.instanceColor.clone();\n\nthis.count=source.count;\n\nreturn this;\n\n}},{key:'getColorAt',value:function getColorAt(\n\nindex,color){\n\ncolor.fromArray(this.instanceColor.array,index*3);\n\n}},{key:'getMatrixAt',value:function getMatrixAt(\n\nindex,matrix){\n\nmatrix.fromArray(this.instanceMatrix.array,index*16);\n\n}},{key:'raycast',value:function raycast(\n\nraycaster,intersects){\n\nvar matrixWorld=this.matrixWorld;\nvar raycastTimes=this.count;\n\n_mesh.geometry=this.geometry;\n_mesh.material=this.material;\n\nif(_mesh.material===undefined)return;\n\nfor(var instanceId=0;instanceId<raycastTimes;instanceId++){\n\n// calculate the world matrix for each instance\n\nthis.getMatrixAt(instanceId,_instanceLocalMatrix);\n\n_instanceWorldMatrix.multiplyMatrices(matrixWorld,_instanceLocalMatrix);\n\n// the mesh represents this single instance\n\n_mesh.matrixWorld=_instanceWorldMatrix;\n\n_mesh.raycast(raycaster,_instanceIntersects);\n\n// process the result of raycast\n\nfor(var i=0,l=_instanceIntersects.length;i<l;i++){\n\nvar intersect=_instanceIntersects[i];\nintersect.instanceId=instanceId;\nintersect.object=this;\nintersects.push(intersect);\n\n}\n\n_instanceIntersects.length=0;\n\n}\n\n}},{key:'setColorAt',value:function setColorAt(\n\nindex,color){\n\nif(this.instanceColor===null){\n\nthis.instanceColor=new InstancedBufferAttribute(new Float32Array(this.instanceMatrix.count*3),3);\n\n}\n\ncolor.toArray(this.instanceColor.array,index*3);\n\n}},{key:'setMatrixAt',value:function setMatrixAt(\n\nindex,matrix){\n\nmatrix.toArray(this.instanceMatrix.array,index*16);\n\n}},{key:'updateMorphTargets',value:function updateMorphTargets()\n\n{\n\n}},{key:'dispose',value:function dispose()\n\n{\n\nthis.dispatchEvent({type:'dispose'});\n\n}}]);return InstancedMesh;}(Mesh);var\n\n\n\nLineBasicMaterial=function(_Material6){_inherits(LineBasicMaterial,_Material6);\n\nfunction LineBasicMaterial(parameters){_classCallCheck(this,LineBasicMaterial);var _this49=_possibleConstructorReturn(this,(LineBasicMaterial.__proto__||Object.getPrototypeOf(LineBasicMaterial)).call(this));\n\n\n\n_this49.isLineBasicMaterial=true;\n\n_this49.type='LineBasicMaterial';\n\n_this49.color=new Color(0xffffff);\n\n_this49.linewidth=1;\n_this49.linecap='round';\n_this49.linejoin='round';\n\n_this49.fog=true;\n\n_this49.setValues(parameters);return _this49;\n\n}_createClass(LineBasicMaterial,[{key:'copy',value:function copy(\n\n\nsource){\n\n_get(LineBasicMaterial.prototype.__proto__||Object.getPrototypeOf(LineBasicMaterial.prototype),'copy',this).call(this,source);\n\nthis.color.copy(source.color);\n\nthis.linewidth=source.linewidth;\nthis.linecap=source.linecap;\nthis.linejoin=source.linejoin;\n\nthis.fog=source.fog;\n\nreturn this;\n\n}}]);return LineBasicMaterial;}(Material);\n\n\n\nvar _start$1=/*@__PURE__*/new Vector3();\nvar _end$1=/*@__PURE__*/new Vector3();\nvar _inverseMatrix$1=/*@__PURE__*/new Matrix4();\nvar _ray$1=/*@__PURE__*/new Ray();\nvar _sphere$1=/*@__PURE__*/new Sphere();var\n\nLine=function(_Object3D9){_inherits(Line,_Object3D9);\n\nfunction Line(){var geometry=arguments.length>0&&arguments[0]!==undefined?arguments[0]:new BufferGeometry();var material=arguments.length>1&&arguments[1]!==undefined?arguments[1]:new LineBasicMaterial();_classCallCheck(this,Line);var _this50=_possibleConstructorReturn(this,(Line.__proto__||Object.getPrototypeOf(Line)).call(this));\n\n\n\n_this50.isLine=true;\n\n_this50.type='Line';\n\n_this50.geometry=geometry;\n_this50.material=material;\n\n_this50.updateMorphTargets();return _this50;\n\n}_createClass(Line,[{key:'copy',value:function copy(\n\nsource,recursive){\n\n_get(Line.prototype.__proto__||Object.getPrototypeOf(Line.prototype),'copy',this).call(this,source,recursive);\n\nthis.material=source.material;\nthis.geometry=source.geometry;\n\nreturn this;\n\n}},{key:'computeLineDistances',value:function computeLineDistances()\n\n{\n\nvar geometry=this.geometry;\n\n// we assume non-indexed geometry\n\nif(geometry.index===null){\n\nvar positionAttribute=geometry.attributes.position;\nvar lineDistances=[0];\n\nfor(var i=1,l=positionAttribute.count;i<l;i++){\n\n_start$1.fromBufferAttribute(positionAttribute,i-1);\n_end$1.fromBufferAttribute(positionAttribute,i);\n\nlineDistances[i]=lineDistances[i-1];\nlineDistances[i]+=_start$1.distanceTo(_end$1);\n\n}\n\ngeometry.setAttribute('lineDistance',new Float32BufferAttribute(lineDistances,1));\n\n}else{\n\nconsole.warn('THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.');\n\n}\n\nreturn this;\n\n}},{key:'raycast',value:function raycast(\n\nraycaster,intersects){\n\nvar geometry=this.geometry;\nvar matrixWorld=this.matrixWorld;\nvar threshold=raycaster.params.Line.threshold;\nvar drawRange=geometry.drawRange;\n\n// Checking boundingSphere distance to ray\n\nif(geometry.boundingSphere===null)geometry.computeBoundingSphere();\n\n_sphere$1.copy(geometry.boundingSphere);\n_sphere$1.applyMatrix4(matrixWorld);\n_sphere$1.radius+=threshold;\n\nif(raycaster.ray.intersectsSphere(_sphere$1)===false)return;\n\n//\n\n_inverseMatrix$1.copy(matrixWorld).invert();\n_ray$1.copy(raycaster.ray).applyMatrix4(_inverseMatrix$1);\n\nvar localThreshold=threshold/((this.scale.x+this.scale.y+this.scale.z)/3);\nvar localThresholdSq=localThreshold*localThreshold;\n\nvar vStart=new Vector3();\nvar vEnd=new Vector3();\nvar interSegment=new Vector3();\nvar interRay=new Vector3();\nvar step=this.isLineSegments?2:1;\n\nvar index=geometry.index;\nvar attributes=geometry.attributes;\nvar positionAttribute=attributes.position;\n\nif(index!==null){\n\nvar start=Math.max(0,drawRange.start);\nvar end=Math.min(index.count,drawRange.start+drawRange.count);\n\nfor(var i=start,l=end-1;i<l;i+=step){\n\nvar a=index.getX(i);\nvar b=index.getX(i+1);\n\nvStart.fromBufferAttribute(positionAttribute,a);\nvEnd.fromBufferAttribute(positionAttribute,b);\n\nvar distSq=_ray$1.distanceSqToSegment(vStart,vEnd,interRay,interSegment);\n\nif(distSq>localThresholdSq)continue;\n\ninterRay.applyMatrix4(this.matrixWorld);//Move back to world space for distance calculation\n\nvar distance=raycaster.ray.origin.distanceTo(interRay);\n\nif(distance<raycaster.near||distance>raycaster.far)continue;\n\nintersects.push({\n\ndistance:distance,\n// What do we want? intersection point on the ray or on the segment??\n// point: raycaster.ray.at( distance ),\npoint:interSegment.clone().applyMatrix4(this.matrixWorld),\nindex:i,\nface:null,\nfaceIndex:null,\nobject:this});\n\n\n\n}\n\n}else{\n\nvar _start6=Math.max(0,drawRange.start);\nvar _end5=Math.min(positionAttribute.count,drawRange.start+drawRange.count);\n\nfor(var _i53=_start6,_l7=_end5-1;_i53<_l7;_i53+=step){\n\nvStart.fromBufferAttribute(positionAttribute,_i53);\nvEnd.fromBufferAttribute(positionAttribute,_i53+1);\n\nvar _distSq=_ray$1.distanceSqToSegment(vStart,vEnd,interRay,interSegment);\n\nif(_distSq>localThresholdSq)continue;\n\ninterRay.applyMatrix4(this.matrixWorld);//Move back to world space for distance calculation\n\nvar _distance=raycaster.ray.origin.distanceTo(interRay);\n\nif(_distance<raycaster.near||_distance>raycaster.far)continue;\n\nintersects.push({\n\ndistance:_distance,\n// What do we want? intersection point on the ray or on the segment??\n// point: raycaster.ray.at( distance ),\npoint:interSegment.clone().applyMatrix4(this.matrixWorld),\nindex:_i53,\nface:null,\nfaceIndex:null,\nobject:this});\n\n\n\n}\n\n}\n\n}},{key:'updateMorphTargets',value:function updateMorphTargets()\n\n{\n\nvar geometry=this.geometry;\n\nvar morphAttributes=geometry.morphAttributes;\nvar keys=Object.keys(morphAttributes);\n\nif(keys.length>0){\n\nvar morphAttribute=morphAttributes[keys[0]];\n\nif(morphAttribute!==undefined){\n\nthis.morphTargetInfluences=[];\nthis.morphTargetDictionary={};\n\nfor(var m=0,ml=morphAttribute.length;m<ml;m++){\n\nvar name=morphAttribute[m].name||String(m);\n\nthis.morphTargetInfluences.push(0);\nthis.morphTargetDictionary[name]=m;\n\n}\n\n}\n\n}\n\n}}]);return Line;}(Object3D);\n\n\n\nvar _start=/*@__PURE__*/new Vector3();\nvar _end=/*@__PURE__*/new Vector3();var\n\nLineSegments=function(_Line){_inherits(LineSegments,_Line);\n\nfunction LineSegments(geometry,material){_classCallCheck(this,LineSegments);var _this51=_possibleConstructorReturn(this,(LineSegments.__proto__||Object.getPrototypeOf(LineSegments)).call(this,\n\ngeometry,material));\n\n_this51.isLineSegments=true;\n\n_this51.type='LineSegments';return _this51;\n\n}_createClass(LineSegments,[{key:'computeLineDistances',value:function computeLineDistances()\n\n{\n\nvar geometry=this.geometry;\n\n// we assume non-indexed geometry\n\nif(geometry.index===null){\n\nvar positionAttribute=geometry.attributes.position;\nvar lineDistances=[];\n\nfor(var i=0,l=positionAttribute.count;i<l;i+=2){\n\n_start.fromBufferAttribute(positionAttribute,i);\n_end.fromBufferAttribute(positionAttribute,i+1);\n\nlineDistances[i]=i===0?0:lineDistances[i-1];\nlineDistances[i+1]=lineDistances[i]+_start.distanceTo(_end);\n\n}\n\ngeometry.setAttribute('lineDistance',new Float32BufferAttribute(lineDistances,1));\n\n}else{\n\nconsole.warn('THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.');\n\n}\n\nreturn this;\n\n}}]);return LineSegments;}(Line);var\n\n\n\nLineLoop=function(_Line2){_inherits(LineLoop,_Line2);\n\nfunction LineLoop(geometry,material){_classCallCheck(this,LineLoop);var _this52=_possibleConstructorReturn(this,(LineLoop.__proto__||Object.getPrototypeOf(LineLoop)).call(this,\n\ngeometry,material));\n\n_this52.isLineLoop=true;\n\n_this52.type='LineLoop';return _this52;\n\n}return LineLoop;}(Line);var\n\n\n\nPointsMaterial=function(_Material7){_inherits(PointsMaterial,_Material7);\n\nfunction PointsMaterial(parameters){_classCallCheck(this,PointsMaterial);var _this53=_possibleConstructorReturn(this,(PointsMaterial.__proto__||Object.getPrototypeOf(PointsMaterial)).call(this));\n\n\n\n_this53.isPointsMaterial=true;\n\n_this53.type='PointsMaterial';\n\n_this53.color=new Color(0xffffff);\n\n_this53.map=null;\n\n_this53.alphaMap=null;\n\n_this53.size=1;\n_this53.sizeAttenuation=true;\n\n_this53.fog=true;\n\n_this53.setValues(parameters);return _this53;\n\n}_createClass(PointsMaterial,[{key:'copy',value:function copy(\n\nsource){\n\n_get(PointsMaterial.prototype.__proto__||Object.getPrototypeOf(PointsMaterial.prototype),'copy',this).call(this,source);\n\nthis.color.copy(source.color);\n\nthis.map=source.map;\n\nthis.alphaMap=source.alphaMap;\n\nthis.size=source.size;\nthis.sizeAttenuation=source.sizeAttenuation;\n\nthis.fog=source.fog;\n\nreturn this;\n\n}}]);return PointsMaterial;}(Material);\n\n\n\nvar _inverseMatrix=/*@__PURE__*/new Matrix4();\nvar _ray=/*@__PURE__*/new Ray();\nvar _sphere=/*@__PURE__*/new Sphere();\nvar _position$2=/*@__PURE__*/new Vector3();var\n\nPoints=function(_Object3D10){_inherits(Points,_Object3D10);\n\nfunction Points(){var geometry=arguments.length>0&&arguments[0]!==undefined?arguments[0]:new BufferGeometry();var material=arguments.length>1&&arguments[1]!==undefined?arguments[1]:new PointsMaterial();_classCallCheck(this,Points);var _this54=_possibleConstructorReturn(this,(Points.__proto__||Object.getPrototypeOf(Points)).call(this));\n\n\n\n_this54.isPoints=true;\n\n_this54.type='Points';\n\n_this54.geometry=geometry;\n_this54.material=material;\n\n_this54.updateMorphTargets();return _this54;\n\n}_createClass(Points,[{key:'copy',value:function copy(\n\nsource,recursive){\n\n_get(Points.prototype.__proto__||Object.getPrototypeOf(Points.prototype),'copy',this).call(this,source,recursive);\n\nthis.material=source.material;\nthis.geometry=source.geometry;\n\nreturn this;\n\n}},{key:'raycast',value:function raycast(\n\nraycaster,intersects){\n\nvar geometry=this.geometry;\nvar matrixWorld=this.matrixWorld;\nvar threshold=raycaster.params.Points.threshold;\nvar drawRange=geometry.drawRange;\n\n// Checking boundingSphere distance to ray\n\nif(geometry.boundingSphere===null)geometry.computeBoundingSphere();\n\n_sphere.copy(geometry.boundingSphere);\n_sphere.applyMatrix4(matrixWorld);\n_sphere.radius+=threshold;\n\nif(raycaster.ray.intersectsSphere(_sphere)===false)return;\n\n//\n\n_inverseMatrix.copy(matrixWorld).invert();\n_ray.copy(raycaster.ray).applyMatrix4(_inverseMatrix);\n\nvar localThreshold=threshold/((this.scale.x+this.scale.y+this.scale.z)/3);\nvar localThresholdSq=localThreshold*localThreshold;\n\nvar index=geometry.index;\nvar attributes=geometry.attributes;\nvar positionAttribute=attributes.position;\n\nif(index!==null){\n\nvar start=Math.max(0,drawRange.start);\nvar end=Math.min(index.count,drawRange.start+drawRange.count);\n\nfor(var i=start,il=end;i<il;i++){\n\nvar a=index.getX(i);\n\n_position$2.fromBufferAttribute(positionAttribute,a);\n\ntestPoint(_position$2,a,localThresholdSq,matrixWorld,raycaster,intersects,this);\n\n}\n\n}else{\n\nvar _start7=Math.max(0,drawRange.start);\nvar _end6=Math.min(positionAttribute.count,drawRange.start+drawRange.count);\n\nfor(var _i54=_start7,l=_end6;_i54<l;_i54++){\n\n_position$2.fromBufferAttribute(positionAttribute,_i54);\n\ntestPoint(_position$2,_i54,localThresholdSq,matrixWorld,raycaster,intersects,this);\n\n}\n\n}\n\n}},{key:'updateMorphTargets',value:function updateMorphTargets()\n\n{\n\nvar geometry=this.geometry;\n\nvar morphAttributes=geometry.morphAttributes;\nvar keys=Object.keys(morphAttributes);\n\nif(keys.length>0){\n\nvar morphAttribute=morphAttributes[keys[0]];\n\nif(morphAttribute!==undefined){\n\nthis.morphTargetInfluences=[];\nthis.morphTargetDictionary={};\n\nfor(var m=0,ml=morphAttribute.length;m<ml;m++){\n\nvar name=morphAttribute[m].name||String(m);\n\nthis.morphTargetInfluences.push(0);\nthis.morphTargetDictionary[name]=m;\n\n}\n\n}\n\n}\n\n}}]);return Points;}(Object3D);\n\n\n\nfunction testPoint(point,index,localThresholdSq,matrixWorld,raycaster,intersects,object){\n\nvar rayPointDistanceSq=_ray.distanceSqToPoint(point);\n\nif(rayPointDistanceSq<localThresholdSq){\n\nvar intersectPoint=new Vector3();\n\n_ray.closestPointToPoint(point,intersectPoint);\nintersectPoint.applyMatrix4(matrixWorld);\n\nvar distance=raycaster.ray.origin.distanceTo(intersectPoint);\n\nif(distance<raycaster.near||distance>raycaster.far)return;\n\nintersects.push({\n\ndistance:distance,\ndistanceToRay:Math.sqrt(rayPointDistanceSq),\npoint:intersectPoint,\nindex:index,\nface:null,\nobject:object});\n\n\n\n}\n\n}var\n\nVideoTexture=function(_Texture6){_inherits(VideoTexture,_Texture6);\n\nfunction VideoTexture(video,mapping,wrapS,wrapT,magFilter,minFilter,format,type,anisotropy){_classCallCheck(this,VideoTexture);var _this55=_possibleConstructorReturn(this,(VideoTexture.__proto__||Object.getPrototypeOf(VideoTexture)).call(this,\n\nvideo,mapping,wrapS,wrapT,magFilter,minFilter,format,type,anisotropy));\n\n_this55.isVideoTexture=true;\n\n_this55.minFilter=minFilter!==undefined?minFilter:LinearFilter;\n_this55.magFilter=magFilter!==undefined?magFilter:LinearFilter;\n\n_this55.generateMipmaps=false;\n\nvar scope=_this55;\n\nfunction updateVideo(){\n\nscope.needsUpdate=true;\nvideo.requestVideoFrameCallback(updateVideo);\n\n}\n\nif('requestVideoFrameCallback'in video){\n\nvideo.requestVideoFrameCallback(updateVideo);\n\n}return _this55;\n\n}_createClass(VideoTexture,[{key:'clone',value:function clone()\n\n{\n\nreturn new this.constructor(this.image).copy(this);\n\n}},{key:'update',value:function update()\n\n{\n\nvar video=this.image;\nvar hasVideoFrameCallback='requestVideoFrameCallback'in video;\n\nif(hasVideoFrameCallback===false&&video.readyState>=video.HAVE_CURRENT_DATA){\n\nthis.needsUpdate=true;\n\n}\n\n}}]);return VideoTexture;}(Texture);var\n\n\n\nFramebufferTexture=function(_Texture7){_inherits(FramebufferTexture,_Texture7);\n\nfunction FramebufferTexture(width,height,format){_classCallCheck(this,FramebufferTexture);var _this56=_possibleConstructorReturn(this,(FramebufferTexture.__proto__||Object.getPrototypeOf(FramebufferTexture)).call(this,\n\n{width:width,height:height}));\n\n_this56.isFramebufferTexture=true;\n\n_this56.format=format;\n\n_this56.magFilter=NearestFilter;\n_this56.minFilter=NearestFilter;\n\n_this56.generateMipmaps=false;\n\n_this56.needsUpdate=true;return _this56;\n\n}return FramebufferTexture;}(Texture);var\n\n\n\nCompressedTexture=function(_Texture8){_inherits(CompressedTexture,_Texture8);\n\nfunction CompressedTexture(mipmaps,width,height,format,type,mapping,wrapS,wrapT,magFilter,minFilter,anisotropy,encoding){_classCallCheck(this,CompressedTexture);var _this57=_possibleConstructorReturn(this,(CompressedTexture.__proto__||Object.getPrototypeOf(CompressedTexture)).call(this,\n\nnull,mapping,wrapS,wrapT,magFilter,minFilter,format,type,anisotropy,encoding));\n\n_this57.isCompressedTexture=true;\n\n_this57.image={width:width,height:height};\n_this57.mipmaps=mipmaps;\n\n// no flipping for cube textures\n// (also flipping doesn't work for compressed textures )\n\n_this57.flipY=false;\n\n// can't generate mipmaps for compressed textures\n// mips must be embedded in DDS files\n\n_this57.generateMipmaps=false;return _this57;\n\n}return CompressedTexture;}(Texture);var\n\n\n\nCanvasTexture=function(_Texture9){_inherits(CanvasTexture,_Texture9);\n\nfunction CanvasTexture(canvas,mapping,wrapS,wrapT,magFilter,minFilter,format,type,anisotropy){_classCallCheck(this,CanvasTexture);var _this58=_possibleConstructorReturn(this,(CanvasTexture.__proto__||Object.getPrototypeOf(CanvasTexture)).call(this,\n\ncanvas,mapping,wrapS,wrapT,magFilter,minFilter,format,type,anisotropy));\n\n_this58.isCanvasTexture=true;\n\n_this58.needsUpdate=true;return _this58;\n\n}return CanvasTexture;}(Texture);\n\n\n\n/**\n * Extensible curve object.\n *\n * Some common of curve methods:\n * .getPoint( t, optionalTarget ), .getTangent( t, optionalTarget )\n * .getPointAt( u, optionalTarget ), .getTangentAt( u, optionalTarget )\n * .getPoints(), .getSpacedPoints()\n * .getLength()\n * .updateArcLengths()\n *\n * This following curves inherit from THREE.Curve:\n *\n * -- 2D curves --\n * THREE.ArcCurve\n * THREE.CubicBezierCurve\n * THREE.EllipseCurve\n * THREE.LineCurve\n * THREE.QuadraticBezierCurve\n * THREE.SplineCurve\n *\n * -- 3D curves --\n * THREE.CatmullRomCurve3\n * THREE.CubicBezierCurve3\n * THREE.LineCurve3\n * THREE.QuadraticBezierCurve3\n *\n * A series of curves can be represented as a THREE.CurvePath.\n *\n **/var\n\nCurve=function(){\n\nfunction Curve(){_classCallCheck(this,Curve);\n\nthis.type='Curve';\n\nthis.arcLengthDivisions=200;\n\n}\n\n// Virtual base class method to overwrite and implement in subclasses\n//\t- t [0 .. 1]\n_createClass(Curve,[{key:'getPoint',value:function getPoint()\n/* t, optionalTarget */{\n\nconsole.warn('THREE.Curve: .getPoint() not implemented.');\nreturn null;\n\n}\n\n// Get point at relative position in curve according to arc length\n// - u [0 .. 1]\n},{key:'getPointAt',value:function getPointAt(\nu,optionalTarget){\n\nvar t=this.getUtoTmapping(u);\nreturn this.getPoint(t,optionalTarget);\n\n}\n\n// Get sequence of points using getPoint( t )\n},{key:'getPoints',value:function getPoints()\n{var divisions=arguments.length>0&&arguments[0]!==undefined?arguments[0]:5;\n\nvar points=[];\n\nfor(var d=0;d<=divisions;d++){\n\npoints.push(this.getPoint(d/divisions));\n\n}\n\nreturn points;\n\n}\n\n// Get sequence of points using getPointAt( u )\n},{key:'getSpacedPoints',value:function getSpacedPoints()\n{var divisions=arguments.length>0&&arguments[0]!==undefined?arguments[0]:5;\n\nvar points=[];\n\nfor(var d=0;d<=divisions;d++){\n\npoints.push(this.getPointAt(d/divisions));\n\n}\n\nreturn points;\n\n}\n\n// Get total curve arc length\n},{key:'getLength',value:function getLength()\n{\n\nvar lengths=this.getLengths();\nreturn lengths[lengths.length-1];\n\n}\n\n// Get list of cumulative segment lengths\n},{key:'getLengths',value:function getLengths()\n{var divisions=arguments.length>0&&arguments[0]!==undefined?arguments[0]:this.arcLengthDivisions;\n\nif(this.cacheArcLengths&&\nthis.cacheArcLengths.length===divisions+1&&\n!this.needsUpdate){\n\nreturn this.cacheArcLengths;\n\n}\n\nthis.needsUpdate=false;\n\nvar cache=[];\nvar current=void 0,last=this.getPoint(0);\nvar sum=0;\n\ncache.push(0);\n\nfor(var p=1;p<=divisions;p++){\n\ncurrent=this.getPoint(p/divisions);\nsum+=current.distanceTo(last);\ncache.push(sum);\nlast=current;\n\n}\n\nthis.cacheArcLengths=cache;\n\nreturn cache;// { sums: cache, sum: sum }; Sum is in the last element.\n\n}},{key:'updateArcLengths',value:function updateArcLengths()\n\n{\n\nthis.needsUpdate=true;\nthis.getLengths();\n\n}\n\n// Given u ( 0 .. 1 ), get a t to find p. This gives you points which are equidistant\n},{key:'getUtoTmapping',value:function getUtoTmapping(\nu,distance){\n\nvar arcLengths=this.getLengths();\n\nvar i=0;\nvar il=arcLengths.length;\n\nvar targetArcLength=void 0;// The targeted u distance value to get\n\nif(distance){\n\ntargetArcLength=distance;\n\n}else{\n\ntargetArcLength=u*arcLengths[il-1];\n\n}\n\n// binary search for the index with largest value smaller than target u distance\n\nvar low=0,high=il-1,comparison=void 0;\n\nwhile(low<=high){\n\ni=Math.floor(low+(high-low)/2);// less likely to overflow, though probably not issue here, JS doesn't really have integers, all numbers are floats\n\ncomparison=arcLengths[i]-targetArcLength;\n\nif(comparison<0){\n\nlow=i+1;\n\n}else if(comparison>0){\n\nhigh=i-1;\n\n}else{\n\nhigh=i;\nbreak;\n\n// DONE\n\n}\n\n}\n\ni=high;\n\nif(arcLengths[i]===targetArcLength){\n\nreturn i/(il-1);\n\n}\n\n// we could get finer grain at lengths, or use simple interpolation between two points\n\nvar lengthBefore=arcLengths[i];\nvar lengthAfter=arcLengths[i+1];\n\nvar segmentLength=lengthAfter-lengthBefore;\n\n// determine where we are between the 'before' and 'after' points\n\nvar segmentFraction=(targetArcLength-lengthBefore)/segmentLength;\n\n// add that fractional amount to t\n\nvar t=(i+segmentFraction)/(il-1);\n\nreturn t;\n\n}\n\n// Returns a unit vector tangent at t\n// In case any sub curve does not implement its tangent derivation,\n// 2 points a small delta apart will be used to find its gradient\n// which seems to give a reasonable approximation\n},{key:'getTangent',value:function getTangent(\nt,optionalTarget){\n\nvar delta=0.0001;\nvar t1=t-delta;\nvar t2=t+delta;\n\n// Capping in case of danger\n\nif(t1<0)t1=0;\nif(t2>1)t2=1;\n\nvar pt1=this.getPoint(t1);\nvar pt2=this.getPoint(t2);\n\nvar tangent=optionalTarget||(pt1.isVector2?new Vector2():new Vector3());\n\ntangent.copy(pt2).sub(pt1).normalize();\n\nreturn tangent;\n\n}},{key:'getTangentAt',value:function getTangentAt(\n\nu,optionalTarget){\n\nvar t=this.getUtoTmapping(u);\nreturn this.getTangent(t,optionalTarget);\n\n}},{key:'computeFrenetFrames',value:function computeFrenetFrames(\n\nsegments,closed){\n\n// see http://www.cs.indiana.edu/pub/techreports/TR425.pdf\n\nvar normal=new Vector3();\n\nvar tangents=[];\nvar normals=[];\nvar binormals=[];\n\nvar vec=new Vector3();\nvar mat=new Matrix4();\n\n// compute the tangent vectors for each segment on the curve\n\nfor(var i=0;i<=segments;i++){\n\nvar u=i/segments;\n\ntangents[i]=this.getTangentAt(u,new Vector3());\n\n}\n\n// select an initial normal vector perpendicular to the first tangent vector,\n// and in the direction of the minimum tangent xyz component\n\nnormals[0]=new Vector3();\nbinormals[0]=new Vector3();\nvar min=Number.MAX_VALUE;\nvar tx=Math.abs(tangents[0].x);\nvar ty=Math.abs(tangents[0].y);\nvar tz=Math.abs(tangents[0].z);\n\nif(tx<=min){\n\nmin=tx;\nnormal.set(1,0,0);\n\n}\n\nif(ty<=min){\n\nmin=ty;\nnormal.set(0,1,0);\n\n}\n\nif(tz<=min){\n\nnormal.set(0,0,1);\n\n}\n\nvec.crossVectors(tangents[0],normal).normalize();\n\nnormals[0].crossVectors(tangents[0],vec);\nbinormals[0].crossVectors(tangents[0],normals[0]);\n\n\n// compute the slowly-varying normal and binormal vectors for each segment on the curve\n\nfor(var _i55=1;_i55<=segments;_i55++){\n\nnormals[_i55]=normals[_i55-1].clone();\n\nbinormals[_i55]=binormals[_i55-1].clone();\n\nvec.crossVectors(tangents[_i55-1],tangents[_i55]);\n\nif(vec.length()>Number.EPSILON){\n\nvec.normalize();\n\nvar theta=Math.acos(clamp(tangents[_i55-1].dot(tangents[_i55]),-1,1));// clamp for floating pt errors\n\nnormals[_i55].applyMatrix4(mat.makeRotationAxis(vec,theta));\n\n}\n\nbinormals[_i55].crossVectors(tangents[_i55],normals[_i55]);\n\n}\n\n// if the curve is closed, postprocess the vectors so the first and last normal vectors are the same\n\nif(closed===true){\n\nvar _theta=Math.acos(clamp(normals[0].dot(normals[segments]),-1,1));\n_theta/=segments;\n\nif(tangents[0].dot(vec.crossVectors(normals[0],normals[segments]))>0){\n\n_theta=-_theta;\n\n}\n\nfor(var _i56=1;_i56<=segments;_i56++){\n\n// twist a little...\nnormals[_i56].applyMatrix4(mat.makeRotationAxis(tangents[_i56],_theta*_i56));\nbinormals[_i56].crossVectors(tangents[_i56],normals[_i56]);\n\n}\n\n}\n\nreturn{\ntangents:tangents,\nnormals:normals,\nbinormals:binormals};\n\n\n}},{key:'clone',value:function clone()\n\n{\n\nreturn new this.constructor().copy(this);\n\n}},{key:'copy',value:function copy(\n\nsource){\n\nthis.arcLengthDivisions=source.arcLengthDivisions;\n\nreturn this;\n\n}},{key:'toJSON',value:function toJSON()\n\n{\n\nvar data={\nmetadata:{\nversion:4.5,\ntype:'Curve',\ngenerator:'Curve.toJSON'}};\n\n\n\ndata.arcLengthDivisions=this.arcLengthDivisions;\ndata.type=this.type;\n\nreturn data;\n\n}},{key:'fromJSON',value:function fromJSON(\n\njson){\n\nthis.arcLengthDivisions=json.arcLengthDivisions;\n\nreturn this;\n\n}}]);return Curve;}();var\n\n\n\nEllipseCurve=function(_Curve){_inherits(EllipseCurve,_Curve);\n\nfunction EllipseCurve(){var aX=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;var aY=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var xRadius=arguments.length>2&&arguments[2]!==undefined?arguments[2]:1;var yRadius=arguments.length>3&&arguments[3]!==undefined?arguments[3]:1;var aStartAngle=arguments.length>4&&arguments[4]!==undefined?arguments[4]:0;var aEndAngle=arguments.length>5&&arguments[5]!==undefined?arguments[5]:Math.PI*2;var aClockwise=arguments.length>6&&arguments[6]!==undefined?arguments[6]:false;var aRotation=arguments.length>7&&arguments[7]!==undefined?arguments[7]:0;_classCallCheck(this,EllipseCurve);var _this59=_possibleConstructorReturn(this,(EllipseCurve.__proto__||Object.getPrototypeOf(EllipseCurve)).call(this));\n\n\n\n_this59.isEllipseCurve=true;\n\n_this59.type='EllipseCurve';\n\n_this59.aX=aX;\n_this59.aY=aY;\n\n_this59.xRadius=xRadius;\n_this59.yRadius=yRadius;\n\n_this59.aStartAngle=aStartAngle;\n_this59.aEndAngle=aEndAngle;\n\n_this59.aClockwise=aClockwise;\n\n_this59.aRotation=aRotation;return _this59;\n\n}_createClass(EllipseCurve,[{key:'getPoint',value:function getPoint(\n\nt,optionalTarget){\n\nvar point=optionalTarget||new Vector2();\n\nvar twoPi=Math.PI*2;\nvar deltaAngle=this.aEndAngle-this.aStartAngle;\nvar samePoints=Math.abs(deltaAngle)<Number.EPSILON;\n\n// ensures that deltaAngle is 0 .. 2 PI\nwhile(deltaAngle<0){deltaAngle+=twoPi;}\nwhile(deltaAngle>twoPi){deltaAngle-=twoPi;}\n\nif(deltaAngle<Number.EPSILON){\n\nif(samePoints){\n\ndeltaAngle=0;\n\n}else{\n\ndeltaAngle=twoPi;\n\n}\n\n}\n\nif(this.aClockwise===true&&!samePoints){\n\nif(deltaAngle===twoPi){\n\ndeltaAngle=-twoPi;\n\n}else{\n\ndeltaAngle=deltaAngle-twoPi;\n\n}\n\n}\n\nvar angle=this.aStartAngle+t*deltaAngle;\nvar x=this.aX+this.xRadius*Math.cos(angle);\nvar y=this.aY+this.yRadius*Math.sin(angle);\n\nif(this.aRotation!==0){\n\nvar cos=Math.cos(this.aRotation);\nvar sin=Math.sin(this.aRotation);\n\nvar tx=x-this.aX;\nvar ty=y-this.aY;\n\n// Rotate the point about the center of the ellipse.\nx=tx*cos-ty*sin+this.aX;\ny=tx*sin+ty*cos+this.aY;\n\n}\n\nreturn point.set(x,y);\n\n}},{key:'copy',value:function copy(\n\nsource){\n\n_get(EllipseCurve.prototype.__proto__||Object.getPrototypeOf(EllipseCurve.prototype),'copy',this).call(this,source);\n\nthis.aX=source.aX;\nthis.aY=source.aY;\n\nthis.xRadius=source.xRadius;\nthis.yRadius=source.yRadius;\n\nthis.aStartAngle=source.aStartAngle;\nthis.aEndAngle=source.aEndAngle;\n\nthis.aClockwise=source.aClockwise;\n\nthis.aRotation=source.aRotation;\n\nreturn this;\n\n}},{key:'toJSON',value:function toJSON()\n\n{\n\nvar data=_get(EllipseCurve.prototype.__proto__||Object.getPrototypeOf(EllipseCurve.prototype),'toJSON',this).call(this);\n\ndata.aX=this.aX;\ndata.aY=this.aY;\n\ndata.xRadius=this.xRadius;\ndata.yRadius=this.yRadius;\n\ndata.aStartAngle=this.aStartAngle;\ndata.aEndAngle=this.aEndAngle;\n\ndata.aClockwise=this.aClockwise;\n\ndata.aRotation=this.aRotation;\n\nreturn data;\n\n}},{key:'fromJSON',value:function fromJSON(\n\njson){\n\n_get(EllipseCurve.prototype.__proto__||Object.getPrototypeOf(EllipseCurve.prototype),'fromJSON',this).call(this,json);\n\nthis.aX=json.aX;\nthis.aY=json.aY;\n\nthis.xRadius=json.xRadius;\nthis.yRadius=json.yRadius;\n\nthis.aStartAngle=json.aStartAngle;\nthis.aEndAngle=json.aEndAngle;\n\nthis.aClockwise=json.aClockwise;\n\nthis.aRotation=json.aRotation;\n\nreturn this;\n\n}}]);return EllipseCurve;}(Curve);var\n\n\n\nArcCurve=function(_EllipseCurve){_inherits(ArcCurve,_EllipseCurve);\n\nfunction ArcCurve(aX,aY,aRadius,aStartAngle,aEndAngle,aClockwise){_classCallCheck(this,ArcCurve);var _this60=_possibleConstructorReturn(this,(ArcCurve.__proto__||Object.getPrototypeOf(ArcCurve)).call(this,\n\naX,aY,aRadius,aRadius,aStartAngle,aEndAngle,aClockwise));\n\n_this60.isArcCurve=true;\n\n_this60.type='ArcCurve';return _this60;\n\n}return ArcCurve;}(EllipseCurve);\n\n\n\n/**\n * Centripetal CatmullRom Curve - which is useful for avoiding\n * cusps and self-intersections in non-uniform catmull rom curves.\n * http://www.cemyuksel.com/research/catmullrom_param/catmullrom.pdf\n *\n * curve.type accepts centripetal(default), chordal and catmullrom\n * curve.tension is used for catmullrom which defaults to 0.5\n */\n\n\n/*\nBased on an optimized c++ solution in\n - http://stackoverflow.com/questions/9489736/catmull-rom-curve-with-no-cusps-and-no-self-intersections/\n - http://ideone.com/NoEbVM\n\nThis CubicPoly class could be used for reusing some variables and calculations,\nbut for three.js curve use, it could be possible inlined and flatten into a single function call\nwhich can be placed in CurveUtils.\n*/\n\nfunction CubicPoly(){\n\nvar c0=0,c1=0,c2=0,c3=0;\n\n/*\n\t * Compute coefficients for a cubic polynomial\n\t *   p(s) = c0 + c1*s + c2*s^2 + c3*s^3\n\t * such that\n\t *   p(0) = x0, p(1) = x1\n\t *  and\n\t *   p'(0) = t0, p'(1) = t1.\n\t */\nfunction init(x0,x1,t0,t1){\n\nc0=x0;\nc1=t0;\nc2=-3*x0+3*x1-2*t0-t1;\nc3=2*x0-2*x1+t0+t1;\n\n}\n\nreturn{\n\ninitCatmullRom:function initCatmullRom(x0,x1,x2,x3,tension){\n\ninit(x1,x2,tension*(x2-x0),tension*(x3-x1));\n\n},\n\ninitNonuniformCatmullRom:function initNonuniformCatmullRom(x0,x1,x2,x3,dt0,dt1,dt2){\n\n// compute tangents when parameterized in [t1,t2]\nvar t1=(x1-x0)/dt0-(x2-x0)/(dt0+dt1)+(x2-x1)/dt1;\nvar t2=(x2-x1)/dt1-(x3-x1)/(dt1+dt2)+(x3-x2)/dt2;\n\n// rescale tangents for parametrization in [0,1]\nt1*=dt1;\nt2*=dt1;\n\ninit(x1,x2,t1,t2);\n\n},\n\ncalc:function calc(t){\n\nvar t2=t*t;\nvar t3=t2*t;\nreturn c0+c1*t+c2*t2+c3*t3;\n\n}};\n\n\n\n}\n\n//\n\nvar tmp=/*@__PURE__*/new Vector3();\nvar px=/*@__PURE__*/new CubicPoly();\nvar py=/*@__PURE__*/new CubicPoly();\nvar pz=/*@__PURE__*/new CubicPoly();var\n\nCatmullRomCurve3=function(_Curve2){_inherits(CatmullRomCurve3,_Curve2);\n\nfunction CatmullRomCurve3(){var points=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];var closed=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var curveType=arguments.length>2&&arguments[2]!==undefined?arguments[2]:'centripetal';var tension=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0.5;_classCallCheck(this,CatmullRomCurve3);var _this61=_possibleConstructorReturn(this,(CatmullRomCurve3.__proto__||Object.getPrototypeOf(CatmullRomCurve3)).call(this));\n\n\n\n_this61.isCatmullRomCurve3=true;\n\n_this61.type='CatmullRomCurve3';\n\n_this61.points=points;\n_this61.closed=closed;\n_this61.curveType=curveType;\n_this61.tension=tension;return _this61;\n\n}_createClass(CatmullRomCurve3,[{key:'getPoint',value:function getPoint(\n\nt){var optionalTarget=arguments.length>1&&arguments[1]!==undefined?arguments[1]:new Vector3();\n\nvar point=optionalTarget;\n\nvar points=this.points;\nvar l=points.length;\n\nvar p=(l-(this.closed?0:1))*t;\nvar intPoint=Math.floor(p);\nvar weight=p-intPoint;\n\nif(this.closed){\n\nintPoint+=intPoint>0?0:(Math.floor(Math.abs(intPoint)/l)+1)*l;\n\n}else if(weight===0&&intPoint===l-1){\n\nintPoint=l-2;\nweight=1;\n\n}\n\nvar p0=void 0,p3=void 0;// 4 points (p1 & p2 defined below)\n\nif(this.closed||intPoint>0){\n\np0=points[(intPoint-1)%l];\n\n}else{\n\n// extrapolate first point\ntmp.subVectors(points[0],points[1]).add(points[0]);\np0=tmp;\n\n}\n\nvar p1=points[intPoint%l];\nvar p2=points[(intPoint+1)%l];\n\nif(this.closed||intPoint+2<l){\n\np3=points[(intPoint+2)%l];\n\n}else{\n\n// extrapolate last point\ntmp.subVectors(points[l-1],points[l-2]).add(points[l-1]);\np3=tmp;\n\n}\n\nif(this.curveType==='centripetal'||this.curveType==='chordal'){\n\n// init Centripetal / Chordal Catmull-Rom\nvar pow=this.curveType==='chordal'?0.5:0.25;\nvar dt0=Math.pow(p0.distanceToSquared(p1),pow);\nvar dt1=Math.pow(p1.distanceToSquared(p2),pow);\nvar dt2=Math.pow(p2.distanceToSquared(p3),pow);\n\n// safety check for repeated points\nif(dt1<1e-4)dt1=1.0;\nif(dt0<1e-4)dt0=dt1;\nif(dt2<1e-4)dt2=dt1;\n\npx.initNonuniformCatmullRom(p0.x,p1.x,p2.x,p3.x,dt0,dt1,dt2);\npy.initNonuniformCatmullRom(p0.y,p1.y,p2.y,p3.y,dt0,dt1,dt2);\npz.initNonuniformCatmullRom(p0.z,p1.z,p2.z,p3.z,dt0,dt1,dt2);\n\n}else if(this.curveType==='catmullrom'){\n\npx.initCatmullRom(p0.x,p1.x,p2.x,p3.x,this.tension);\npy.initCatmullRom(p0.y,p1.y,p2.y,p3.y,this.tension);\npz.initCatmullRom(p0.z,p1.z,p2.z,p3.z,this.tension);\n\n}\n\npoint.set(\npx.calc(weight),\npy.calc(weight),\npz.calc(weight));\n\n\nreturn point;\n\n}},{key:'copy',value:function copy(\n\nsource){\n\n_get(CatmullRomCurve3.prototype.__proto__||Object.getPrototypeOf(CatmullRomCurve3.prototype),'copy',this).call(this,source);\n\nthis.points=[];\n\nfor(var i=0,l=source.points.length;i<l;i++){\n\nvar point=source.points[i];\n\nthis.points.push(point.clone());\n\n}\n\nthis.closed=source.closed;\nthis.curveType=source.curveType;\nthis.tension=source.tension;\n\nreturn this;\n\n}},{key:'toJSON',value:function toJSON()\n\n{\n\nvar data=_get(CatmullRomCurve3.prototype.__proto__||Object.getPrototypeOf(CatmullRomCurve3.prototype),'toJSON',this).call(this);\n\ndata.points=[];\n\nfor(var i=0,l=this.points.length;i<l;i++){\n\nvar point=this.points[i];\ndata.points.push(point.toArray());\n\n}\n\ndata.closed=this.closed;\ndata.curveType=this.curveType;\ndata.tension=this.tension;\n\nreturn data;\n\n}},{key:'fromJSON',value:function fromJSON(\n\njson){\n\n_get(CatmullRomCurve3.prototype.__proto__||Object.getPrototypeOf(CatmullRomCurve3.prototype),'fromJSON',this).call(this,json);\n\nthis.points=[];\n\nfor(var i=0,l=json.points.length;i<l;i++){\n\nvar point=json.points[i];\nthis.points.push(new Vector3().fromArray(point));\n\n}\n\nthis.closed=json.closed;\nthis.curveType=json.curveType;\nthis.tension=json.tension;\n\nreturn this;\n\n}}]);return CatmullRomCurve3;}(Curve);\n\n\n\n/**\n * Bezier Curves formulas obtained from\n * https://en.wikipedia.org/wiki/B%C3%A9zier_curve\n */\n\nfunction CatmullRom(t,p0,p1,p2,p3){\n\nvar v0=(p2-p0)*0.5;\nvar v1=(p3-p1)*0.5;\nvar t2=t*t;\nvar t3=t*t2;\nreturn(2*p1-2*p2+v0+v1)*t3+(-3*p1+3*p2-2*v0-v1)*t2+v0*t+p1;\n\n}\n\n//\n\nfunction QuadraticBezierP0(t,p){\n\nvar k=1-t;\nreturn k*k*p;\n\n}\n\nfunction QuadraticBezierP1(t,p){\n\nreturn 2*(1-t)*t*p;\n\n}\n\nfunction QuadraticBezierP2(t,p){\n\nreturn t*t*p;\n\n}\n\nfunction QuadraticBezier(t,p0,p1,p2){\n\nreturn QuadraticBezierP0(t,p0)+QuadraticBezierP1(t,p1)+\nQuadraticBezierP2(t,p2);\n\n}\n\n//\n\nfunction CubicBezierP0(t,p){\n\nvar k=1-t;\nreturn k*k*k*p;\n\n}\n\nfunction CubicBezierP1(t,p){\n\nvar k=1-t;\nreturn 3*k*k*t*p;\n\n}\n\nfunction CubicBezierP2(t,p){\n\nreturn 3*(1-t)*t*t*p;\n\n}\n\nfunction CubicBezierP3(t,p){\n\nreturn t*t*t*p;\n\n}\n\nfunction CubicBezier(t,p0,p1,p2,p3){\n\nreturn CubicBezierP0(t,p0)+CubicBezierP1(t,p1)+CubicBezierP2(t,p2)+\nCubicBezierP3(t,p3);\n\n}var\n\nCubicBezierCurve=function(_Curve3){_inherits(CubicBezierCurve,_Curve3);\n\nfunction CubicBezierCurve(){var v0=arguments.length>0&&arguments[0]!==undefined?arguments[0]:new Vector2();var v1=arguments.length>1&&arguments[1]!==undefined?arguments[1]:new Vector2();var v2=arguments.length>2&&arguments[2]!==undefined?arguments[2]:new Vector2();var v3=arguments.length>3&&arguments[3]!==undefined?arguments[3]:new Vector2();_classCallCheck(this,CubicBezierCurve);var _this62=_possibleConstructorReturn(this,(CubicBezierCurve.__proto__||Object.getPrototypeOf(CubicBezierCurve)).call(this));\n\n\n\n_this62.isCubicBezierCurve=true;\n\n_this62.type='CubicBezierCurve';\n\n_this62.v0=v0;\n_this62.v1=v1;\n_this62.v2=v2;\n_this62.v3=v3;return _this62;\n\n}_createClass(CubicBezierCurve,[{key:'getPoint',value:function getPoint(\n\nt){var optionalTarget=arguments.length>1&&arguments[1]!==undefined?arguments[1]:new Vector2();\n\nvar point=optionalTarget;\n\nvar v0=this.v0,v1=this.v1,v2=this.v2,v3=this.v3;\n\npoint.set(\nCubicBezier(t,v0.x,v1.x,v2.x,v3.x),\nCubicBezier(t,v0.y,v1.y,v2.y,v3.y));\n\n\nreturn point;\n\n}},{key:'copy',value:function copy(\n\nsource){\n\n_get(CubicBezierCurve.prototype.__proto__||Object.getPrototypeOf(CubicBezierCurve.prototype),'copy',this).call(this,source);\n\nthis.v0.copy(source.v0);\nthis.v1.copy(source.v1);\nthis.v2.copy(source.v2);\nthis.v3.copy(source.v3);\n\nreturn this;\n\n}},{key:'toJSON',value:function toJSON()\n\n{\n\nvar data=_get(CubicBezierCurve.prototype.__proto__||Object.getPrototypeOf(CubicBezierCurve.prototype),'toJSON',this).call(this);\n\ndata.v0=this.v0.toArray();\ndata.v1=this.v1.toArray();\ndata.v2=this.v2.toArray();\ndata.v3=this.v3.toArray();\n\nreturn data;\n\n}},{key:'fromJSON',value:function fromJSON(\n\njson){\n\n_get(CubicBezierCurve.prototype.__proto__||Object.getPrototypeOf(CubicBezierCurve.prototype),'fromJSON',this).call(this,json);\n\nthis.v0.fromArray(json.v0);\nthis.v1.fromArray(json.v1);\nthis.v2.fromArray(json.v2);\nthis.v3.fromArray(json.v3);\n\nreturn this;\n\n}}]);return CubicBezierCurve;}(Curve);var\n\n\n\nCubicBezierCurve3=function(_Curve4){_inherits(CubicBezierCurve3,_Curve4);\n\nfunction CubicBezierCurve3(){var v0=arguments.length>0&&arguments[0]!==undefined?arguments[0]:new Vector3();var v1=arguments.length>1&&arguments[1]!==undefined?arguments[1]:new Vector3();var v2=arguments.length>2&&arguments[2]!==undefined?arguments[2]:new Vector3();var v3=arguments.length>3&&arguments[3]!==undefined?arguments[3]:new Vector3();_classCallCheck(this,CubicBezierCurve3);var _this63=_possibleConstructorReturn(this,(CubicBezierCurve3.__proto__||Object.getPrototypeOf(CubicBezierCurve3)).call(this));\n\n\n\n_this63.isCubicBezierCurve3=true;\n\n_this63.type='CubicBezierCurve3';\n\n_this63.v0=v0;\n_this63.v1=v1;\n_this63.v2=v2;\n_this63.v3=v3;return _this63;\n\n}_createClass(CubicBezierCurve3,[{key:'getPoint',value:function getPoint(\n\nt){var optionalTarget=arguments.length>1&&arguments[1]!==undefined?arguments[1]:new Vector3();\n\nvar point=optionalTarget;\n\nvar v0=this.v0,v1=this.v1,v2=this.v2,v3=this.v3;\n\npoint.set(\nCubicBezier(t,v0.x,v1.x,v2.x,v3.x),\nCubicBezier(t,v0.y,v1.y,v2.y,v3.y),\nCubicBezier(t,v0.z,v1.z,v2.z,v3.z));\n\n\nreturn point;\n\n}},{key:'copy',value:function copy(\n\nsource){\n\n_get(CubicBezierCurve3.prototype.__proto__||Object.getPrototypeOf(CubicBezierCurve3.prototype),'copy',this).call(this,source);\n\nthis.v0.copy(source.v0);\nthis.v1.copy(source.v1);\nthis.v2.copy(source.v2);\nthis.v3.copy(source.v3);\n\nreturn this;\n\n}},{key:'toJSON',value:function toJSON()\n\n{\n\nvar data=_get(CubicBezierCurve3.prototype.__proto__||Object.getPrototypeOf(CubicBezierCurve3.prototype),'toJSON',this).call(this);\n\ndata.v0=this.v0.toArray();\ndata.v1=this.v1.toArray();\ndata.v2=this.v2.toArray();\ndata.v3=this.v3.toArray();\n\nreturn data;\n\n}},{key:'fromJSON',value:function fromJSON(\n\njson){\n\n_get(CubicBezierCurve3.prototype.__proto__||Object.getPrototypeOf(CubicBezierCurve3.prototype),'fromJSON',this).call(this,json);\n\nthis.v0.fromArray(json.v0);\nthis.v1.fromArray(json.v1);\nthis.v2.fromArray(json.v2);\nthis.v3.fromArray(json.v3);\n\nreturn this;\n\n}}]);return CubicBezierCurve3;}(Curve);var\n\n\n\nLineCurve=function(_Curve5){_inherits(LineCurve,_Curve5);\n\nfunction LineCurve(){var v1=arguments.length>0&&arguments[0]!==undefined?arguments[0]:new Vector2();var v2=arguments.length>1&&arguments[1]!==undefined?arguments[1]:new Vector2();_classCallCheck(this,LineCurve);var _this64=_possibleConstructorReturn(this,(LineCurve.__proto__||Object.getPrototypeOf(LineCurve)).call(this));\n\n\n\n_this64.isLineCurve=true;\n\n_this64.type='LineCurve';\n\n_this64.v1=v1;\n_this64.v2=v2;return _this64;\n\n}_createClass(LineCurve,[{key:'getPoint',value:function getPoint(\n\nt){var optionalTarget=arguments.length>1&&arguments[1]!==undefined?arguments[1]:new Vector2();\n\nvar point=optionalTarget;\n\nif(t===1){\n\npoint.copy(this.v2);\n\n}else{\n\npoint.copy(this.v2).sub(this.v1);\npoint.multiplyScalar(t).add(this.v1);\n\n}\n\nreturn point;\n\n}\n\n// Line curve is linear, so we can overwrite default getPointAt\n},{key:'getPointAt',value:function getPointAt(u,optionalTarget){\n\nreturn this.getPoint(u,optionalTarget);\n\n}},{key:'getTangent',value:function getTangent(\n\nt,optionalTarget){\n\nvar tangent=optionalTarget||new Vector2();\n\ntangent.copy(this.v2).sub(this.v1).normalize();\n\nreturn tangent;\n\n}},{key:'copy',value:function copy(\n\nsource){\n\n_get(LineCurve.prototype.__proto__||Object.getPrototypeOf(LineCurve.prototype),'copy',this).call(this,source);\n\nthis.v1.copy(source.v1);\nthis.v2.copy(source.v2);\n\nreturn this;\n\n}},{key:'toJSON',value:function toJSON()\n\n{\n\nvar data=_get(LineCurve.prototype.__proto__||Object.getPrototypeOf(LineCurve.prototype),'toJSON',this).call(this);\n\ndata.v1=this.v1.toArray();\ndata.v2=this.v2.toArray();\n\nreturn data;\n\n}},{key:'fromJSON',value:function fromJSON(\n\njson){\n\n_get(LineCurve.prototype.__proto__||Object.getPrototypeOf(LineCurve.prototype),'fromJSON',this).call(this,json);\n\nthis.v1.fromArray(json.v1);\nthis.v2.fromArray(json.v2);\n\nreturn this;\n\n}}]);return LineCurve;}(Curve);var\n\n\n\nLineCurve3=function(_Curve6){_inherits(LineCurve3,_Curve6);\n\nfunction LineCurve3(){var v1=arguments.length>0&&arguments[0]!==undefined?arguments[0]:new Vector3();var v2=arguments.length>1&&arguments[1]!==undefined?arguments[1]:new Vector3();_classCallCheck(this,LineCurve3);var _this65=_possibleConstructorReturn(this,(LineCurve3.__proto__||Object.getPrototypeOf(LineCurve3)).call(this));\n\n\n\n_this65.isLineCurve3=true;\n\n_this65.type='LineCurve3';\n\n_this65.v1=v1;\n_this65.v2=v2;return _this65;\n\n}_createClass(LineCurve3,[{key:'getPoint',value:function getPoint(\nt){var optionalTarget=arguments.length>1&&arguments[1]!==undefined?arguments[1]:new Vector3();\n\nvar point=optionalTarget;\n\nif(t===1){\n\npoint.copy(this.v2);\n\n}else{\n\npoint.copy(this.v2).sub(this.v1);\npoint.multiplyScalar(t).add(this.v1);\n\n}\n\nreturn point;\n\n}\n// Line curve is linear, so we can overwrite default getPointAt\n},{key:'getPointAt',value:function getPointAt(u,optionalTarget){\n\nreturn this.getPoint(u,optionalTarget);\n\n}},{key:'copy',value:function copy(\nsource){\n\n_get(LineCurve3.prototype.__proto__||Object.getPrototypeOf(LineCurve3.prototype),'copy',this).call(this,source);\n\nthis.v1.copy(source.v1);\nthis.v2.copy(source.v2);\n\nreturn this;\n\n}},{key:'toJSON',value:function toJSON()\n{\n\nvar data=_get(LineCurve3.prototype.__proto__||Object.getPrototypeOf(LineCurve3.prototype),'toJSON',this).call(this);\n\ndata.v1=this.v1.toArray();\ndata.v2=this.v2.toArray();\n\nreturn data;\n\n}},{key:'fromJSON',value:function fromJSON(\njson){\n\n_get(LineCurve3.prototype.__proto__||Object.getPrototypeOf(LineCurve3.prototype),'fromJSON',this).call(this,json);\n\nthis.v1.fromArray(json.v1);\nthis.v2.fromArray(json.v2);\n\nreturn this;\n\n}}]);return LineCurve3;}(Curve);var\n\n\n\nQuadraticBezierCurve=function(_Curve7){_inherits(QuadraticBezierCurve,_Curve7);\n\nfunction QuadraticBezierCurve(){var v0=arguments.length>0&&arguments[0]!==undefined?arguments[0]:new Vector2();var v1=arguments.length>1&&arguments[1]!==undefined?arguments[1]:new Vector2();var v2=arguments.length>2&&arguments[2]!==undefined?arguments[2]:new Vector2();_classCallCheck(this,QuadraticBezierCurve);var _this66=_possibleConstructorReturn(this,(QuadraticBezierCurve.__proto__||Object.getPrototypeOf(QuadraticBezierCurve)).call(this));\n\n\n\n_this66.isQuadraticBezierCurve=true;\n\n_this66.type='QuadraticBezierCurve';\n\n_this66.v0=v0;\n_this66.v1=v1;\n_this66.v2=v2;return _this66;\n\n}_createClass(QuadraticBezierCurve,[{key:'getPoint',value:function getPoint(\n\nt){var optionalTarget=arguments.length>1&&arguments[1]!==undefined?arguments[1]:new Vector2();\n\nvar point=optionalTarget;\n\nvar v0=this.v0,v1=this.v1,v2=this.v2;\n\npoint.set(\nQuadraticBezier(t,v0.x,v1.x,v2.x),\nQuadraticBezier(t,v0.y,v1.y,v2.y));\n\n\nreturn point;\n\n}},{key:'copy',value:function copy(\n\nsource){\n\n_get(QuadraticBezierCurve.prototype.__proto__||Object.getPrototypeOf(QuadraticBezierCurve.prototype),'copy',this).call(this,source);\n\nthis.v0.copy(source.v0);\nthis.v1.copy(source.v1);\nthis.v2.copy(source.v2);\n\nreturn this;\n\n}},{key:'toJSON',value:function toJSON()\n\n{\n\nvar data=_get(QuadraticBezierCurve.prototype.__proto__||Object.getPrototypeOf(QuadraticBezierCurve.prototype),'toJSON',this).call(this);\n\ndata.v0=this.v0.toArray();\ndata.v1=this.v1.toArray();\ndata.v2=this.v2.toArray();\n\nreturn data;\n\n}},{key:'fromJSON',value:function fromJSON(\n\njson){\n\n_get(QuadraticBezierCurve.prototype.__proto__||Object.getPrototypeOf(QuadraticBezierCurve.prototype),'fromJSON',this).call(this,json);\n\nthis.v0.fromArray(json.v0);\nthis.v1.fromArray(json.v1);\nthis.v2.fromArray(json.v2);\n\nreturn this;\n\n}}]);return QuadraticBezierCurve;}(Curve);var\n\n\n\nQuadraticBezierCurve3=function(_Curve8){_inherits(QuadraticBezierCurve3,_Curve8);\n\nfunction QuadraticBezierCurve3(){var v0=arguments.length>0&&arguments[0]!==undefined?arguments[0]:new Vector3();var v1=arguments.length>1&&arguments[1]!==undefined?arguments[1]:new Vector3();var v2=arguments.length>2&&arguments[2]!==undefined?arguments[2]:new Vector3();_classCallCheck(this,QuadraticBezierCurve3);var _this67=_possibleConstructorReturn(this,(QuadraticBezierCurve3.__proto__||Object.getPrototypeOf(QuadraticBezierCurve3)).call(this));\n\n\n\n_this67.isQuadraticBezierCurve3=true;\n\n_this67.type='QuadraticBezierCurve3';\n\n_this67.v0=v0;\n_this67.v1=v1;\n_this67.v2=v2;return _this67;\n\n}_createClass(QuadraticBezierCurve3,[{key:'getPoint',value:function getPoint(\n\nt){var optionalTarget=arguments.length>1&&arguments[1]!==undefined?arguments[1]:new Vector3();\n\nvar point=optionalTarget;\n\nvar v0=this.v0,v1=this.v1,v2=this.v2;\n\npoint.set(\nQuadraticBezier(t,v0.x,v1.x,v2.x),\nQuadraticBezier(t,v0.y,v1.y,v2.y),\nQuadraticBezier(t,v0.z,v1.z,v2.z));\n\n\nreturn point;\n\n}},{key:'copy',value:function copy(\n\nsource){\n\n_get(QuadraticBezierCurve3.prototype.__proto__||Object.getPrototypeOf(QuadraticBezierCurve3.prototype),'copy',this).call(this,source);\n\nthis.v0.copy(source.v0);\nthis.v1.copy(source.v1);\nthis.v2.copy(source.v2);\n\nreturn this;\n\n}},{key:'toJSON',value:function toJSON()\n\n{\n\nvar data=_get(QuadraticBezierCurve3.prototype.__proto__||Object.getPrototypeOf(QuadraticBezierCurve3.prototype),'toJSON',this).call(this);\n\ndata.v0=this.v0.toArray();\ndata.v1=this.v1.toArray();\ndata.v2=this.v2.toArray();\n\nreturn data;\n\n}},{key:'fromJSON',value:function fromJSON(\n\njson){\n\n_get(QuadraticBezierCurve3.prototype.__proto__||Object.getPrototypeOf(QuadraticBezierCurve3.prototype),'fromJSON',this).call(this,json);\n\nthis.v0.fromArray(json.v0);\nthis.v1.fromArray(json.v1);\nthis.v2.fromArray(json.v2);\n\nreturn this;\n\n}}]);return QuadraticBezierCurve3;}(Curve);var\n\n\n\nSplineCurve=function(_Curve9){_inherits(SplineCurve,_Curve9);\n\nfunction SplineCurve(){var points=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];_classCallCheck(this,SplineCurve);var _this68=_possibleConstructorReturn(this,(SplineCurve.__proto__||Object.getPrototypeOf(SplineCurve)).call(this));\n\n\n\n_this68.isSplineCurve=true;\n\n_this68.type='SplineCurve';\n\n_this68.points=points;return _this68;\n\n}_createClass(SplineCurve,[{key:'getPoint',value:function getPoint(\n\nt){var optionalTarget=arguments.length>1&&arguments[1]!==undefined?arguments[1]:new Vector2();\n\nvar point=optionalTarget;\n\nvar points=this.points;\nvar p=(points.length-1)*t;\n\nvar intPoint=Math.floor(p);\nvar weight=p-intPoint;\n\nvar p0=points[intPoint===0?intPoint:intPoint-1];\nvar p1=points[intPoint];\nvar p2=points[intPoint>points.length-2?points.length-1:intPoint+1];\nvar p3=points[intPoint>points.length-3?points.length-1:intPoint+2];\n\npoint.set(\nCatmullRom(weight,p0.x,p1.x,p2.x,p3.x),\nCatmullRom(weight,p0.y,p1.y,p2.y,p3.y));\n\n\nreturn point;\n\n}},{key:'copy',value:function copy(\n\nsource){\n\n_get(SplineCurve.prototype.__proto__||Object.getPrototypeOf(SplineCurve.prototype),'copy',this).call(this,source);\n\nthis.points=[];\n\nfor(var i=0,l=source.points.length;i<l;i++){\n\nvar point=source.points[i];\n\nthis.points.push(point.clone());\n\n}\n\nreturn this;\n\n}},{key:'toJSON',value:function toJSON()\n\n{\n\nvar data=_get(SplineCurve.prototype.__proto__||Object.getPrototypeOf(SplineCurve.prototype),'toJSON',this).call(this);\n\ndata.points=[];\n\nfor(var i=0,l=this.points.length;i<l;i++){\n\nvar point=this.points[i];\ndata.points.push(point.toArray());\n\n}\n\nreturn data;\n\n}},{key:'fromJSON',value:function fromJSON(\n\njson){\n\n_get(SplineCurve.prototype.__proto__||Object.getPrototypeOf(SplineCurve.prototype),'fromJSON',this).call(this,json);\n\nthis.points=[];\n\nfor(var i=0,l=json.points.length;i<l;i++){\n\nvar point=json.points[i];\nthis.points.push(new Vector2().fromArray(point));\n\n}\n\nreturn this;\n\n}}]);return SplineCurve;}(Curve);\n\n\n\nvar Curves=/*#__PURE__*/Object.freeze({\n__proto__:null,\nArcCurve:ArcCurve,\nCatmullRomCurve3:CatmullRomCurve3,\nCubicBezierCurve:CubicBezierCurve,\nCubicBezierCurve3:CubicBezierCurve3,\nEllipseCurve:EllipseCurve,\nLineCurve:LineCurve,\nLineCurve3:LineCurve3,\nQuadraticBezierCurve:QuadraticBezierCurve,\nQuadraticBezierCurve3:QuadraticBezierCurve3,\nSplineCurve:SplineCurve});\n\n\n/**************************************************************\n *\tCurved Path - a curve path is simply a array of connected\n *  curves, but retains the api of a curve\n **************************************************************/var\n\nCurvePath=function(_Curve10){_inherits(CurvePath,_Curve10);\n\nfunction CurvePath(){_classCallCheck(this,CurvePath);var _this69=_possibleConstructorReturn(this,(CurvePath.__proto__||Object.getPrototypeOf(CurvePath)).call(this));\n\n\n\n_this69.type='CurvePath';\n\n_this69.curves=[];\n_this69.autoClose=false;// Automatically closes the path\nreturn _this69;\n}_createClass(CurvePath,[{key:'add',value:function add(\n\ncurve){\n\nthis.curves.push(curve);\n\n}},{key:'closePath',value:function closePath()\n\n{\n\n// Add a line curve if start and end of lines are not connected\nvar startPoint=this.curves[0].getPoint(0);\nvar endPoint=this.curves[this.curves.length-1].getPoint(1);\n\nif(!startPoint.equals(endPoint)){\n\nthis.curves.push(new LineCurve(endPoint,startPoint));\n\n}\n\n}\n\n// To get accurate point with reference to\n// entire path distance at time t,\n// following has to be done:\n\n// 1. Length of each sub path have to be known\n// 2. Locate and identify type of curve\n// 3. Get t for the curve\n// 4. Return curve.getPointAt(t')\n},{key:'getPoint',value:function getPoint(\nt,optionalTarget){\n\nvar d=t*this.getLength();\nvar curveLengths=this.getCurveLengths();\nvar i=0;\n\n// To think about boundaries points.\n\nwhile(i<curveLengths.length){\n\nif(curveLengths[i]>=d){\n\nvar diff=curveLengths[i]-d;\nvar curve=this.curves[i];\n\nvar segmentLength=curve.getLength();\nvar u=segmentLength===0?0:1-diff/segmentLength;\n\nreturn curve.getPointAt(u,optionalTarget);\n\n}\n\ni++;\n\n}\n\nreturn null;\n\n// loop where sum != 0, sum > d , sum+1 <d\n\n}\n\n// We cannot use the default THREE.Curve getPoint() with getLength() because in\n// THREE.Curve, getLength() depends on getPoint() but in THREE.CurvePath\n// getPoint() depends on getLength\n},{key:'getLength',value:function getLength()\n{\n\nvar lens=this.getCurveLengths();\nreturn lens[lens.length-1];\n\n}\n\n// cacheLengths must be recalculated.\n},{key:'updateArcLengths',value:function updateArcLengths(){\n\nthis.needsUpdate=true;\nthis.cacheLengths=null;\nthis.getCurveLengths();\n\n}\n\n// Compute lengths and cache them\n// We cannot overwrite getLengths() because UtoT mapping uses it.\n},{key:'getCurveLengths',value:function getCurveLengths()\n{\n\n// We use cache values if curves and cache array are same length\n\nif(this.cacheLengths&&this.cacheLengths.length===this.curves.length){\n\nreturn this.cacheLengths;\n\n}\n\n// Get length of sub-curve\n// Push sums into cached array\n\nvar lengths=[];\nvar sums=0;\n\nfor(var i=0,l=this.curves.length;i<l;i++){\n\nsums+=this.curves[i].getLength();\nlengths.push(sums);\n\n}\n\nthis.cacheLengths=lengths;\n\nreturn lengths;\n\n}},{key:'getSpacedPoints',value:function getSpacedPoints()\n\n{var divisions=arguments.length>0&&arguments[0]!==undefined?arguments[0]:40;\n\nvar points=[];\n\nfor(var i=0;i<=divisions;i++){\n\npoints.push(this.getPoint(i/divisions));\n\n}\n\nif(this.autoClose){\n\npoints.push(points[0]);\n\n}\n\nreturn points;\n\n}},{key:'getPoints',value:function getPoints()\n\n{var divisions=arguments.length>0&&arguments[0]!==undefined?arguments[0]:12;\n\nvar points=[];\nvar last=void 0;\n\nfor(var i=0,curves=this.curves;i<curves.length;i++){\n\nvar curve=curves[i];\nvar resolution=curve.isEllipseCurve?divisions*2:\ncurve.isLineCurve||curve.isLineCurve3?1:\ncurve.isSplineCurve?divisions*curve.points.length:\ndivisions;\n\nvar pts=curve.getPoints(resolution);\n\nfor(var j=0;j<pts.length;j++){\n\nvar point=pts[j];\n\nif(last&&last.equals(point))continue;// ensures no consecutive points are duplicates\n\npoints.push(point);\nlast=point;\n\n}\n\n}\n\nif(this.autoClose&&points.length>1&&!points[points.length-1].equals(points[0])){\n\npoints.push(points[0]);\n\n}\n\nreturn points;\n\n}},{key:'copy',value:function copy(\n\nsource){\n\n_get(CurvePath.prototype.__proto__||Object.getPrototypeOf(CurvePath.prototype),'copy',this).call(this,source);\n\nthis.curves=[];\n\nfor(var i=0,l=source.curves.length;i<l;i++){\n\nvar curve=source.curves[i];\n\nthis.curves.push(curve.clone());\n\n}\n\nthis.autoClose=source.autoClose;\n\nreturn this;\n\n}},{key:'toJSON',value:function toJSON()\n\n{\n\nvar data=_get(CurvePath.prototype.__proto__||Object.getPrototypeOf(CurvePath.prototype),'toJSON',this).call(this);\n\ndata.autoClose=this.autoClose;\ndata.curves=[];\n\nfor(var i=0,l=this.curves.length;i<l;i++){\n\nvar curve=this.curves[i];\ndata.curves.push(curve.toJSON());\n\n}\n\nreturn data;\n\n}},{key:'fromJSON',value:function fromJSON(\n\njson){\n\n_get(CurvePath.prototype.__proto__||Object.getPrototypeOf(CurvePath.prototype),'fromJSON',this).call(this,json);\n\nthis.autoClose=json.autoClose;\nthis.curves=[];\n\nfor(var i=0,l=json.curves.length;i<l;i++){\n\nvar curve=json.curves[i];\nthis.curves.push(new Curves[curve.type]().fromJSON(curve));\n\n}\n\nreturn this;\n\n}}]);return CurvePath;}(Curve);var\n\n\n\nPath=function(_CurvePath){_inherits(Path,_CurvePath);\n\nfunction Path(points){_classCallCheck(this,Path);var _this70=_possibleConstructorReturn(this,(Path.__proto__||Object.getPrototypeOf(Path)).call(this));\n\n\n\n_this70.type='Path';\n\n_this70.currentPoint=new Vector2();\n\nif(points){\n\n_this70.setFromPoints(points);\n\n}return _this70;\n\n}_createClass(Path,[{key:'setFromPoints',value:function setFromPoints(\n\npoints){\n\nthis.moveTo(points[0].x,points[0].y);\n\nfor(var i=1,l=points.length;i<l;i++){\n\nthis.lineTo(points[i].x,points[i].y);\n\n}\n\nreturn this;\n\n}},{key:'moveTo',value:function moveTo(\n\nx,y){\n\nthis.currentPoint.set(x,y);// TODO consider referencing vectors instead of copying?\n\nreturn this;\n\n}},{key:'lineTo',value:function lineTo(\n\nx,y){\n\nvar curve=new LineCurve(this.currentPoint.clone(),new Vector2(x,y));\nthis.curves.push(curve);\n\nthis.currentPoint.set(x,y);\n\nreturn this;\n\n}},{key:'quadraticCurveTo',value:function quadraticCurveTo(\n\naCPx,aCPy,aX,aY){\n\nvar curve=new QuadraticBezierCurve(\nthis.currentPoint.clone(),\nnew Vector2(aCPx,aCPy),\nnew Vector2(aX,aY));\n\n\nthis.curves.push(curve);\n\nthis.currentPoint.set(aX,aY);\n\nreturn this;\n\n}},{key:'bezierCurveTo',value:function bezierCurveTo(\n\naCP1x,aCP1y,aCP2x,aCP2y,aX,aY){\n\nvar curve=new CubicBezierCurve(\nthis.currentPoint.clone(),\nnew Vector2(aCP1x,aCP1y),\nnew Vector2(aCP2x,aCP2y),\nnew Vector2(aX,aY));\n\n\nthis.curves.push(curve);\n\nthis.currentPoint.set(aX,aY);\n\nreturn this;\n\n}},{key:'splineThru',value:function splineThru(\n\npts/*Array of Vector*/){\n\nvar npts=[this.currentPoint.clone()].concat(pts);\n\nvar curve=new SplineCurve(npts);\nthis.curves.push(curve);\n\nthis.currentPoint.copy(pts[pts.length-1]);\n\nreturn this;\n\n}},{key:'arc',value:function arc(\n\naX,aY,aRadius,aStartAngle,aEndAngle,aClockwise){\n\nvar x0=this.currentPoint.x;\nvar y0=this.currentPoint.y;\n\nthis.absarc(aX+x0,aY+y0,aRadius,\naStartAngle,aEndAngle,aClockwise);\n\nreturn this;\n\n}},{key:'absarc',value:function absarc(\n\naX,aY,aRadius,aStartAngle,aEndAngle,aClockwise){\n\nthis.absellipse(aX,aY,aRadius,aRadius,aStartAngle,aEndAngle,aClockwise);\n\nreturn this;\n\n}},{key:'ellipse',value:function ellipse(\n\naX,aY,xRadius,yRadius,aStartAngle,aEndAngle,aClockwise,aRotation){\n\nvar x0=this.currentPoint.x;\nvar y0=this.currentPoint.y;\n\nthis.absellipse(aX+x0,aY+y0,xRadius,yRadius,aStartAngle,aEndAngle,aClockwise,aRotation);\n\nreturn this;\n\n}},{key:'absellipse',value:function absellipse(\n\naX,aY,xRadius,yRadius,aStartAngle,aEndAngle,aClockwise,aRotation){\n\nvar curve=new EllipseCurve(aX,aY,xRadius,yRadius,aStartAngle,aEndAngle,aClockwise,aRotation);\n\nif(this.curves.length>0){\n\n// if a previous curve is present, attempt to join\nvar firstPoint=curve.getPoint(0);\n\nif(!firstPoint.equals(this.currentPoint)){\n\nthis.lineTo(firstPoint.x,firstPoint.y);\n\n}\n\n}\n\nthis.curves.push(curve);\n\nvar lastPoint=curve.getPoint(1);\nthis.currentPoint.copy(lastPoint);\n\nreturn this;\n\n}},{key:'copy',value:function copy(\n\nsource){\n\n_get(Path.prototype.__proto__||Object.getPrototypeOf(Path.prototype),'copy',this).call(this,source);\n\nthis.currentPoint.copy(source.currentPoint);\n\nreturn this;\n\n}},{key:'toJSON',value:function toJSON()\n\n{\n\nvar data=_get(Path.prototype.__proto__||Object.getPrototypeOf(Path.prototype),'toJSON',this).call(this);\n\ndata.currentPoint=this.currentPoint.toArray();\n\nreturn data;\n\n}},{key:'fromJSON',value:function fromJSON(\n\njson){\n\n_get(Path.prototype.__proto__||Object.getPrototypeOf(Path.prototype),'fromJSON',this).call(this,json);\n\nthis.currentPoint.fromArray(json.currentPoint);\n\nreturn this;\n\n}}]);return Path;}(CurvePath);var\n\n\n\nLatheGeometry=function(_BufferGeometry3){_inherits(LatheGeometry,_BufferGeometry3);\n\nfunction LatheGeometry(){var points=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[new Vector2(0,0.5),new Vector2(0.5,0),new Vector2(0,-0.5)];var segments=arguments.length>1&&arguments[1]!==undefined?arguments[1]:12;var phiStart=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var phiLength=arguments.length>3&&arguments[3]!==undefined?arguments[3]:Math.PI*2;_classCallCheck(this,LatheGeometry);var _this71=_possibleConstructorReturn(this,(LatheGeometry.__proto__||Object.getPrototypeOf(LatheGeometry)).call(this));\n\n\n\n_this71.type='LatheGeometry';\n\n_this71.parameters={\npoints:points,\nsegments:segments,\nphiStart:phiStart,\nphiLength:phiLength};\n\n\nsegments=Math.floor(segments);\n\n// clamp phiLength so it's in range of [ 0, 2PI ]\n\nphiLength=clamp(phiLength,0,Math.PI*2);\n\n// buffers\n\nvar indices=[];\nvar vertices=[];\nvar uvs=[];\nvar initNormals=[];\nvar normals=[];\n\n// helper variables\n\nvar inverseSegments=1.0/segments;\nvar vertex=new Vector3();\nvar uv=new Vector2();\nvar normal=new Vector3();\nvar curNormal=new Vector3();\nvar prevNormal=new Vector3();\nvar dx=0;\nvar dy=0;\n\n// pre-compute normals for initial \"meridian\"\n\nfor(var j=0;j<=points.length-1;j++){\n\nswitch(j){\n\ncase 0:// special handling for 1st vertex on path\n\ndx=points[j+1].x-points[j].x;\ndy=points[j+1].y-points[j].y;\n\nnormal.x=dy*1.0;\nnormal.y=-dx;\nnormal.z=dy*0.0;\n\nprevNormal.copy(normal);\n\nnormal.normalize();\n\ninitNormals.push(normal.x,normal.y,normal.z);\n\nbreak;\n\ncase points.length-1:// special handling for last Vertex on path\n\ninitNormals.push(prevNormal.x,prevNormal.y,prevNormal.z);\n\nbreak;\n\ndefault:// default handling for all vertices in between\n\ndx=points[j+1].x-points[j].x;\ndy=points[j+1].y-points[j].y;\n\nnormal.x=dy*1.0;\nnormal.y=-dx;\nnormal.z=dy*0.0;\n\ncurNormal.copy(normal);\n\nnormal.x+=prevNormal.x;\nnormal.y+=prevNormal.y;\nnormal.z+=prevNormal.z;\n\nnormal.normalize();\n\ninitNormals.push(normal.x,normal.y,normal.z);\n\nprevNormal.copy(curNormal);}\n\n\n\n}\n\n// generate vertices, uvs and normals\n\nfor(var i=0;i<=segments;i++){\n\nvar phi=phiStart+i*inverseSegments*phiLength;\n\nvar sin=Math.sin(phi);\nvar cos=Math.cos(phi);\n\nfor(var _j5=0;_j5<=points.length-1;_j5++){\n\n// vertex\n\nvertex.x=points[_j5].x*sin;\nvertex.y=points[_j5].y;\nvertex.z=points[_j5].x*cos;\n\nvertices.push(vertex.x,vertex.y,vertex.z);\n\n// uv\n\nuv.x=i/segments;\nuv.y=_j5/(points.length-1);\n\nuvs.push(uv.x,uv.y);\n\n// normal\n\nvar x=initNormals[3*_j5+0]*sin;\nvar y=initNormals[3*_j5+1];\nvar z=initNormals[3*_j5+0]*cos;\n\nnormals.push(x,y,z);\n\n}\n\n}\n\n// indices\n\nfor(var _i57=0;_i57<segments;_i57++){\n\nfor(var _j6=0;_j6<points.length-1;_j6++){\n\nvar base=_j6+_i57*points.length;\n\nvar a=base;\nvar b=base+points.length;\nvar c=base+points.length+1;\nvar d=base+1;\n\n// faces\n\nindices.push(a,b,d);\nindices.push(c,d,b);\n\n}\n\n}\n\n// build geometry\n\n_this71.setIndex(indices);\n_this71.setAttribute('position',new Float32BufferAttribute(vertices,3));\n_this71.setAttribute('uv',new Float32BufferAttribute(uvs,2));\n_this71.setAttribute('normal',new Float32BufferAttribute(normals,3));return _this71;\n\n}_createClass(LatheGeometry,null,[{key:'fromJSON',value:function fromJSON(\n\ndata){\n\nreturn new LatheGeometry(data.points,data.segments,data.phiStart,data.phiLength);\n\n}}]);return LatheGeometry;}(BufferGeometry);var\n\n\n\nCapsuleGeometry=function(_LatheGeometry){_inherits(CapsuleGeometry,_LatheGeometry);\n\nfunction CapsuleGeometry(){var radius=arguments.length>0&&arguments[0]!==undefined?arguments[0]:1;var length=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1;var capSegments=arguments.length>2&&arguments[2]!==undefined?arguments[2]:4;var radialSegments=arguments.length>3&&arguments[3]!==undefined?arguments[3]:8;_classCallCheck(this,CapsuleGeometry);\n\nvar path=new Path();\npath.absarc(0,-length/2,radius,Math.PI*1.5,0);\npath.absarc(0,length/2,radius,0,Math.PI*0.5);var _this72=_possibleConstructorReturn(this,(CapsuleGeometry.__proto__||Object.getPrototypeOf(CapsuleGeometry)).call(this,\n\npath.getPoints(capSegments),radialSegments));\n\n_this72.type='CapsuleGeometry';\n\n_this72.parameters={\nradius:radius,\nheight:length,\ncapSegments:capSegments,\nradialSegments:radialSegments};return _this72;\n\n\n}_createClass(CapsuleGeometry,null,[{key:'fromJSON',value:function fromJSON(\n\ndata){\n\nreturn new CapsuleGeometry(data.radius,data.length,data.capSegments,data.radialSegments);\n\n}}]);return CapsuleGeometry;}(LatheGeometry);var\n\n\n\nCircleGeometry=function(_BufferGeometry4){_inherits(CircleGeometry,_BufferGeometry4);\n\nfunction CircleGeometry(){var radius=arguments.length>0&&arguments[0]!==undefined?arguments[0]:1;var segments=arguments.length>1&&arguments[1]!==undefined?arguments[1]:8;var thetaStart=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var thetaLength=arguments.length>3&&arguments[3]!==undefined?arguments[3]:Math.PI*2;_classCallCheck(this,CircleGeometry);var _this73=_possibleConstructorReturn(this,(CircleGeometry.__proto__||Object.getPrototypeOf(CircleGeometry)).call(this));\n\n\n\n_this73.type='CircleGeometry';\n\n_this73.parameters={\nradius:radius,\nsegments:segments,\nthetaStart:thetaStart,\nthetaLength:thetaLength};\n\n\nsegments=Math.max(3,segments);\n\n// buffers\n\nvar indices=[];\nvar vertices=[];\nvar normals=[];\nvar uvs=[];\n\n// helper variables\n\nvar vertex=new Vector3();\nvar uv=new Vector2();\n\n// center point\n\nvertices.push(0,0,0);\nnormals.push(0,0,1);\nuvs.push(0.5,0.5);\n\nfor(var s=0,i=3;s<=segments;s++,i+=3){\n\nvar segment=thetaStart+s/segments*thetaLength;\n\n// vertex\n\nvertex.x=radius*Math.cos(segment);\nvertex.y=radius*Math.sin(segment);\n\nvertices.push(vertex.x,vertex.y,vertex.z);\n\n// normal\n\nnormals.push(0,0,1);\n\n// uvs\n\nuv.x=(vertices[i]/radius+1)/2;\nuv.y=(vertices[i+1]/radius+1)/2;\n\nuvs.push(uv.x,uv.y);\n\n}\n\n// indices\n\nfor(var _i58=1;_i58<=segments;_i58++){\n\nindices.push(_i58,_i58+1,0);\n\n}\n\n// build geometry\n\n_this73.setIndex(indices);\n_this73.setAttribute('position',new Float32BufferAttribute(vertices,3));\n_this73.setAttribute('normal',new Float32BufferAttribute(normals,3));\n_this73.setAttribute('uv',new Float32BufferAttribute(uvs,2));return _this73;\n\n}_createClass(CircleGeometry,null,[{key:'fromJSON',value:function fromJSON(\n\ndata){\n\nreturn new CircleGeometry(data.radius,data.segments,data.thetaStart,data.thetaLength);\n\n}}]);return CircleGeometry;}(BufferGeometry);var\n\n\n\nCylinderGeometry=function(_BufferGeometry5){_inherits(CylinderGeometry,_BufferGeometry5);\n\nfunction CylinderGeometry(){var radiusTop=arguments.length>0&&arguments[0]!==undefined?arguments[0]:1;var radiusBottom=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1;var height=arguments.length>2&&arguments[2]!==undefined?arguments[2]:1;var radialSegments=arguments.length>3&&arguments[3]!==undefined?arguments[3]:8;var heightSegments=arguments.length>4&&arguments[4]!==undefined?arguments[4]:1;var openEnded=arguments.length>5&&arguments[5]!==undefined?arguments[5]:false;var thetaStart=arguments.length>6&&arguments[6]!==undefined?arguments[6]:0;var thetaLength=arguments.length>7&&arguments[7]!==undefined?arguments[7]:Math.PI*2;_classCallCheck(this,CylinderGeometry);var _this74=_possibleConstructorReturn(this,(CylinderGeometry.__proto__||Object.getPrototypeOf(CylinderGeometry)).call(this));\n\n\n_this74.type='CylinderGeometry';\n\n_this74.parameters={\nradiusTop:radiusTop,\nradiusBottom:radiusBottom,\nheight:height,\nradialSegments:radialSegments,\nheightSegments:heightSegments,\nopenEnded:openEnded,\nthetaStart:thetaStart,\nthetaLength:thetaLength};\n\n\nvar scope=_this74;\n\nradialSegments=Math.floor(radialSegments);\nheightSegments=Math.floor(heightSegments);\n\n// buffers\n\nvar indices=[];\nvar vertices=[];\nvar normals=[];\nvar uvs=[];\n\n// helper variables\n\nvar index=0;\nvar indexArray=[];\nvar halfHeight=height/2;\nvar groupStart=0;\n\n// generate geometry\n\ngenerateTorso();\n\nif(openEnded===false){\n\nif(radiusTop>0)generateCap(true);\nif(radiusBottom>0)generateCap(false);\n\n}\n\n// build geometry\n\n_this74.setIndex(indices);\n_this74.setAttribute('position',new Float32BufferAttribute(vertices,3));\n_this74.setAttribute('normal',new Float32BufferAttribute(normals,3));\n_this74.setAttribute('uv',new Float32BufferAttribute(uvs,2));\n\nfunction generateTorso(){\n\nvar normal=new Vector3();\nvar vertex=new Vector3();\n\nvar groupCount=0;\n\n// this will be used to calculate the normal\nvar slope=(radiusBottom-radiusTop)/height;\n\n// generate vertices, normals and uvs\n\nfor(var y=0;y<=heightSegments;y++){\n\nvar indexRow=[];\n\nvar v=y/heightSegments;\n\n// calculate the radius of the current row\n\nvar radius=v*(radiusBottom-radiusTop)+radiusTop;\n\nfor(var x=0;x<=radialSegments;x++){\n\nvar u=x/radialSegments;\n\nvar theta=u*thetaLength+thetaStart;\n\nvar sinTheta=Math.sin(theta);\nvar cosTheta=Math.cos(theta);\n\n// vertex\n\nvertex.x=radius*sinTheta;\nvertex.y=-v*height+halfHeight;\nvertex.z=radius*cosTheta;\nvertices.push(vertex.x,vertex.y,vertex.z);\n\n// normal\n\nnormal.set(sinTheta,slope,cosTheta).normalize();\nnormals.push(normal.x,normal.y,normal.z);\n\n// uv\n\nuvs.push(u,1-v);\n\n// save index of vertex in respective row\n\nindexRow.push(index++);\n\n}\n\n// now save vertices of the row in our index array\n\nindexArray.push(indexRow);\n\n}\n\n// generate indices\n\nfor(var _x227=0;_x227<radialSegments;_x227++){\n\nfor(var _y2=0;_y2<heightSegments;_y2++){\n\n// we use the index array to access the correct indices\n\nvar a=indexArray[_y2][_x227];\nvar b=indexArray[_y2+1][_x227];\nvar c=indexArray[_y2+1][_x227+1];\nvar d=indexArray[_y2][_x227+1];\n\n// faces\n\nindices.push(a,b,d);\nindices.push(b,c,d);\n\n// update group counter\n\ngroupCount+=6;\n\n}\n\n}\n\n// add a group to the geometry. this will ensure multi material support\n\nscope.addGroup(groupStart,groupCount,0);\n\n// calculate new start value for groups\n\ngroupStart+=groupCount;\n\n}\n\nfunction generateCap(top){\n\n// save the index of the first center vertex\nvar centerIndexStart=index;\n\nvar uv=new Vector2();\nvar vertex=new Vector3();\n\nvar groupCount=0;\n\nvar radius=top===true?radiusTop:radiusBottom;\nvar sign=top===true?1:-1;\n\n// first we generate the center vertex data of the cap.\n// because the geometry needs one set of uvs per face,\n// we must generate a center vertex per face/segment\n\nfor(var x=1;x<=radialSegments;x++){\n\n// vertex\n\nvertices.push(0,halfHeight*sign,0);\n\n// normal\n\nnormals.push(0,sign,0);\n\n// uv\n\nuvs.push(0.5,0.5);\n\n// increase index\n\nindex++;\n\n}\n\n// save the index of the last center vertex\nvar centerIndexEnd=index;\n\n// now we generate the surrounding vertices, normals and uvs\n\nfor(var _x228=0;_x228<=radialSegments;_x228++){\n\nvar u=_x228/radialSegments;\nvar theta=u*thetaLength+thetaStart;\n\nvar cosTheta=Math.cos(theta);\nvar sinTheta=Math.sin(theta);\n\n// vertex\n\nvertex.x=radius*sinTheta;\nvertex.y=halfHeight*sign;\nvertex.z=radius*cosTheta;\nvertices.push(vertex.x,vertex.y,vertex.z);\n\n// normal\n\nnormals.push(0,sign,0);\n\n// uv\n\nuv.x=cosTheta*0.5+0.5;\nuv.y=sinTheta*0.5*sign+0.5;\nuvs.push(uv.x,uv.y);\n\n// increase index\n\nindex++;\n\n}\n\n// generate indices\n\nfor(var _x229=0;_x229<radialSegments;_x229++){\n\nvar c=centerIndexStart+_x229;\nvar i=centerIndexEnd+_x229;\n\nif(top===true){\n\n// face top\n\nindices.push(i,i+1,c);\n\n}else{\n\n// face bottom\n\nindices.push(i+1,i,c);\n\n}\n\ngroupCount+=3;\n\n}\n\n// add a group to the geometry. this will ensure multi material support\n\nscope.addGroup(groupStart,groupCount,top===true?1:2);\n\n// calculate new start value for groups\n\ngroupStart+=groupCount;\n\n}return _this74;\n\n}_createClass(CylinderGeometry,null,[{key:'fromJSON',value:function fromJSON(\n\ndata){\n\nreturn new CylinderGeometry(data.radiusTop,data.radiusBottom,data.height,data.radialSegments,data.heightSegments,data.openEnded,data.thetaStart,data.thetaLength);\n\n}}]);return CylinderGeometry;}(BufferGeometry);var\n\n\n\nConeGeometry=function(_CylinderGeometry){_inherits(ConeGeometry,_CylinderGeometry);\n\nfunction ConeGeometry(){var radius=arguments.length>0&&arguments[0]!==undefined?arguments[0]:1;var height=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1;var radialSegments=arguments.length>2&&arguments[2]!==undefined?arguments[2]:8;var heightSegments=arguments.length>3&&arguments[3]!==undefined?arguments[3]:1;var openEnded=arguments.length>4&&arguments[4]!==undefined?arguments[4]:false;var thetaStart=arguments.length>5&&arguments[5]!==undefined?arguments[5]:0;var thetaLength=arguments.length>6&&arguments[6]!==undefined?arguments[6]:Math.PI*2;_classCallCheck(this,ConeGeometry);var _this75=_possibleConstructorReturn(this,(ConeGeometry.__proto__||Object.getPrototypeOf(ConeGeometry)).call(this,\n\n0,radius,height,radialSegments,heightSegments,openEnded,thetaStart,thetaLength));\n\n_this75.type='ConeGeometry';\n\n_this75.parameters={\nradius:radius,\nheight:height,\nradialSegments:radialSegments,\nheightSegments:heightSegments,\nopenEnded:openEnded,\nthetaStart:thetaStart,\nthetaLength:thetaLength};return _this75;\n\n\n}_createClass(ConeGeometry,null,[{key:'fromJSON',value:function fromJSON(\n\ndata){\n\nreturn new ConeGeometry(data.radius,data.height,data.radialSegments,data.heightSegments,data.openEnded,data.thetaStart,data.thetaLength);\n\n}}]);return ConeGeometry;}(CylinderGeometry);var\n\n\n\nPolyhedronGeometry=function(_BufferGeometry6){_inherits(PolyhedronGeometry,_BufferGeometry6);\n\nfunction PolyhedronGeometry(){var vertices=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];var indices=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];var radius=arguments.length>2&&arguments[2]!==undefined?arguments[2]:1;var detail=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0;_classCallCheck(this,PolyhedronGeometry);var _this76=_possibleConstructorReturn(this,(PolyhedronGeometry.__proto__||Object.getPrototypeOf(PolyhedronGeometry)).call(this));\n\n\n\n_this76.type='PolyhedronGeometry';\n\n_this76.parameters={\nvertices:vertices,\nindices:indices,\nradius:radius,\ndetail:detail};\n\n\n// default buffer data\n\nvar vertexBuffer=[];\nvar uvBuffer=[];\n\n// the subdivision creates the vertex buffer data\n\nsubdivide(detail);\n\n// all vertices should lie on a conceptual sphere with a given radius\n\napplyRadius(radius);\n\n// finally, create the uv data\n\ngenerateUVs();\n\n// build non-indexed geometry\n\n_this76.setAttribute('position',new Float32BufferAttribute(vertexBuffer,3));\n_this76.setAttribute('normal',new Float32BufferAttribute(vertexBuffer.slice(),3));\n_this76.setAttribute('uv',new Float32BufferAttribute(uvBuffer,2));\n\nif(detail===0){\n\n_this76.computeVertexNormals();// flat normals\n\n}else{\n\n_this76.normalizeNormals();// smooth normals\n\n}\n\n// helper functions\n\nfunction subdivide(detail){\n\nvar a=new Vector3();\nvar b=new Vector3();\nvar c=new Vector3();\n\n// iterate over all faces and apply a subdivison with the given detail value\n\nfor(var i=0;i<indices.length;i+=3){\n\n// get the vertices of the face\n\ngetVertexByIndex(indices[i+0],a);\ngetVertexByIndex(indices[i+1],b);\ngetVertexByIndex(indices[i+2],c);\n\n// perform subdivision\n\nsubdivideFace(a,b,c,detail);\n\n}\n\n}\n\nfunction subdivideFace(a,b,c,detail){\n\nvar cols=detail+1;\n\n// we use this multidimensional array as a data structure for creating the subdivision\n\nvar v=[];\n\n// construct all of the vertices for this subdivision\n\nfor(var i=0;i<=cols;i++){\n\nv[i]=[];\n\nvar aj=a.clone().lerp(c,i/cols);\nvar bj=b.clone().lerp(c,i/cols);\n\nvar rows=cols-i;\n\nfor(var j=0;j<=rows;j++){\n\nif(j===0&&i===cols){\n\nv[i][j]=aj;\n\n}else{\n\nv[i][j]=aj.clone().lerp(bj,j/rows);\n\n}\n\n}\n\n}\n\n// construct all of the faces\n\nfor(var _i59=0;_i59<cols;_i59++){\n\nfor(var _j7=0;_j7<2*(cols-_i59)-1;_j7++){\n\nvar k=Math.floor(_j7/2);\n\nif(_j7%2===0){\n\npushVertex(v[_i59][k+1]);\npushVertex(v[_i59+1][k]);\npushVertex(v[_i59][k]);\n\n}else{\n\npushVertex(v[_i59][k+1]);\npushVertex(v[_i59+1][k+1]);\npushVertex(v[_i59+1][k]);\n\n}\n\n}\n\n}\n\n}\n\nfunction applyRadius(radius){\n\nvar vertex=new Vector3();\n\n// iterate over the entire buffer and apply the radius to each vertex\n\nfor(var i=0;i<vertexBuffer.length;i+=3){\n\nvertex.x=vertexBuffer[i+0];\nvertex.y=vertexBuffer[i+1];\nvertex.z=vertexBuffer[i+2];\n\nvertex.normalize().multiplyScalar(radius);\n\nvertexBuffer[i+0]=vertex.x;\nvertexBuffer[i+1]=vertex.y;\nvertexBuffer[i+2]=vertex.z;\n\n}\n\n}\n\nfunction generateUVs(){\n\nvar vertex=new Vector3();\n\nfor(var i=0;i<vertexBuffer.length;i+=3){\n\nvertex.x=vertexBuffer[i+0];\nvertex.y=vertexBuffer[i+1];\nvertex.z=vertexBuffer[i+2];\n\nvar u=azimuth(vertex)/2/Math.PI+0.5;\nvar v=inclination(vertex)/Math.PI+0.5;\nuvBuffer.push(u,1-v);\n\n}\n\ncorrectUVs();\n\ncorrectSeam();\n\n}\n\nfunction correctSeam(){\n\n// handle case when face straddles the seam, see #3269\n\nfor(var i=0;i<uvBuffer.length;i+=6){\n\n// uv data of a single face\n\nvar x0=uvBuffer[i+0];\nvar x1=uvBuffer[i+2];\nvar x2=uvBuffer[i+4];\n\nvar max=Math.max(x0,x1,x2);\nvar min=Math.min(x0,x1,x2);\n\n// 0.9 is somewhat arbitrary\n\nif(max>0.9&&min<0.1){\n\nif(x0<0.2)uvBuffer[i+0]+=1;\nif(x1<0.2)uvBuffer[i+2]+=1;\nif(x2<0.2)uvBuffer[i+4]+=1;\n\n}\n\n}\n\n}\n\nfunction pushVertex(vertex){\n\nvertexBuffer.push(vertex.x,vertex.y,vertex.z);\n\n}\n\nfunction getVertexByIndex(index,vertex){\n\nvar stride=index*3;\n\nvertex.x=vertices[stride+0];\nvertex.y=vertices[stride+1];\nvertex.z=vertices[stride+2];\n\n}\n\nfunction correctUVs(){\n\nvar a=new Vector3();\nvar b=new Vector3();\nvar c=new Vector3();\n\nvar centroid=new Vector3();\n\nvar uvA=new Vector2();\nvar uvB=new Vector2();\nvar uvC=new Vector2();\n\nfor(var i=0,j=0;i<vertexBuffer.length;i+=9,j+=6){\n\na.set(vertexBuffer[i+0],vertexBuffer[i+1],vertexBuffer[i+2]);\nb.set(vertexBuffer[i+3],vertexBuffer[i+4],vertexBuffer[i+5]);\nc.set(vertexBuffer[i+6],vertexBuffer[i+7],vertexBuffer[i+8]);\n\nuvA.set(uvBuffer[j+0],uvBuffer[j+1]);\nuvB.set(uvBuffer[j+2],uvBuffer[j+3]);\nuvC.set(uvBuffer[j+4],uvBuffer[j+5]);\n\ncentroid.copy(a).add(b).add(c).divideScalar(3);\n\nvar azi=azimuth(centroid);\n\ncorrectUV(uvA,j+0,a,azi);\ncorrectUV(uvB,j+2,b,azi);\ncorrectUV(uvC,j+4,c,azi);\n\n}\n\n}\n\nfunction correctUV(uv,stride,vector,azimuth){\n\nif(azimuth<0&&uv.x===1){\n\nuvBuffer[stride]=uv.x-1;\n\n}\n\nif(vector.x===0&&vector.z===0){\n\nuvBuffer[stride]=azimuth/2/Math.PI+0.5;\n\n}\n\n}\n\n// Angle around the Y axis, counter-clockwise when looking from above.\n\nfunction azimuth(vector){\n\nreturn Math.atan2(vector.z,-vector.x);\n\n}\n\n\n// Angle above the XZ plane.\n\nfunction inclination(vector){\n\nreturn Math.atan2(-vector.y,Math.sqrt(vector.x*vector.x+vector.z*vector.z));\n\n}return _this76;\n\n}_createClass(PolyhedronGeometry,null,[{key:'fromJSON',value:function fromJSON(\n\ndata){\n\nreturn new PolyhedronGeometry(data.vertices,data.indices,data.radius,data.details);\n\n}}]);return PolyhedronGeometry;}(BufferGeometry);var\n\n\n\nDodecahedronGeometry=function(_PolyhedronGeometry){_inherits(DodecahedronGeometry,_PolyhedronGeometry);\n\nfunction DodecahedronGeometry(){var radius=arguments.length>0&&arguments[0]!==undefined?arguments[0]:1;var detail=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;_classCallCheck(this,DodecahedronGeometry);\n\nvar t=(1+Math.sqrt(5))/2;\nvar r=1/t;\n\nvar vertices=[\n\n// (1, 1, 1)\n-1,-1,-1,-1,-1,1,\n-1,1,-1,-1,1,1,\n1,-1,-1,1,-1,1,\n1,1,-1,1,1,1,\n\n// (0, 1/, )\n0,-r,-t,0,-r,t,\n0,r,-t,0,r,t,\n\n// (1/, , 0)\n-r,-t,0,-r,t,0,\nr,-t,0,r,t,0,\n\n// (, 0, 1/)\n-t,0,-r,t,0,-r,\n-t,0,r,t,0,r];\n\n\nvar indices=[\n3,11,7,3,7,15,3,15,13,\n7,19,17,7,17,6,7,6,15,\n17,4,8,17,8,10,17,10,6,\n8,0,16,8,16,2,8,2,10,\n0,12,1,0,1,18,0,18,16,\n6,10,2,6,2,13,6,13,15,\n2,16,18,2,18,3,2,3,13,\n18,1,9,18,9,11,18,11,3,\n4,14,12,4,12,0,4,0,8,\n11,9,5,11,5,19,11,19,7,\n19,5,14,19,14,4,19,4,17,\n1,12,14,1,14,5,1,5,9];var _this77=_possibleConstructorReturn(this,(DodecahedronGeometry.__proto__||Object.getPrototypeOf(DodecahedronGeometry)).call(this,\n\n\nvertices,indices,radius,detail));\n\n_this77.type='DodecahedronGeometry';\n\n_this77.parameters={\nradius:radius,\ndetail:detail};return _this77;\n\n\n}_createClass(DodecahedronGeometry,null,[{key:'fromJSON',value:function fromJSON(\n\ndata){\n\nreturn new DodecahedronGeometry(data.radius,data.detail);\n\n}}]);return DodecahedronGeometry;}(PolyhedronGeometry);\n\n\n\nvar _v0=/*@__PURE__*/new Vector3();\nvar _v1$1=/*@__PURE__*/new Vector3();\nvar _normal=/*@__PURE__*/new Vector3();\nvar _triangle=/*@__PURE__*/new Triangle();var\n\nEdgesGeometry=function(_BufferGeometry7){_inherits(EdgesGeometry,_BufferGeometry7);\n\nfunction EdgesGeometry(){var geometry=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;var thresholdAngle=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1;_classCallCheck(this,EdgesGeometry);var _this78=_possibleConstructorReturn(this,(EdgesGeometry.__proto__||Object.getPrototypeOf(EdgesGeometry)).call(this));\n\n\n_this78.type='EdgesGeometry';\n\n_this78.parameters={\ngeometry:geometry,\nthresholdAngle:thresholdAngle};\n\n\nif(geometry!==null){\n\nvar precisionPoints=4;\nvar precision=Math.pow(10,precisionPoints);\nvar thresholdDot=Math.cos(DEG2RAD*thresholdAngle);\n\nvar indexAttr=geometry.getIndex();\nvar positionAttr=geometry.getAttribute('position');\nvar indexCount=indexAttr?indexAttr.count:positionAttr.count;\n\nvar indexArr=[0,0,0];\nvar vertKeys=['a','b','c'];\nvar hashes=new Array(3);\n\nvar edgeData={};\nvar _vertices2=[];\nfor(var i=0;i<indexCount;i+=3){\n\nif(indexAttr){\n\nindexArr[0]=indexAttr.getX(i);\nindexArr[1]=indexAttr.getX(i+1);\nindexArr[2]=indexAttr.getX(i+2);\n\n}else{\n\nindexArr[0]=i;\nindexArr[1]=i+1;\nindexArr[2]=i+2;\n\n}var\n\na=_triangle.a,b=_triangle.b,c=_triangle.c;\na.fromBufferAttribute(positionAttr,indexArr[0]);\nb.fromBufferAttribute(positionAttr,indexArr[1]);\nc.fromBufferAttribute(positionAttr,indexArr[2]);\n_triangle.getNormal(_normal);\n\n// create hashes for the edge from the vertices\nhashes[0]=Math.round(a.x*precision)+','+Math.round(a.y*precision)+','+Math.round(a.z*precision);\nhashes[1]=Math.round(b.x*precision)+','+Math.round(b.y*precision)+','+Math.round(b.z*precision);\nhashes[2]=Math.round(c.x*precision)+','+Math.round(c.y*precision)+','+Math.round(c.z*precision);\n\n// skip degenerate triangles\nif(hashes[0]===hashes[1]||hashes[1]===hashes[2]||hashes[2]===hashes[0]){\n\ncontinue;\n\n}\n\n// iterate over every edge\nfor(var j=0;j<3;j++){\n\n// get the first and next vertex making up the edge\nvar jNext=(j+1)%3;\nvar vecHash0=hashes[j];\nvar vecHash1=hashes[jNext];\nvar v0=_triangle[vertKeys[j]];\nvar v1=_triangle[vertKeys[jNext]];\n\nvar hash=vecHash0+'_'+vecHash1;\nvar reverseHash=vecHash1+'_'+vecHash0;\n\nif(reverseHash in edgeData&&edgeData[reverseHash]){\n\n// if we found a sibling edge add it into the vertex array if\n// it meets the angle threshold and delete the edge from the map.\nif(_normal.dot(edgeData[reverseHash].normal)<=thresholdDot){\n\n_vertices2.push(v0.x,v0.y,v0.z);\n_vertices2.push(v1.x,v1.y,v1.z);\n\n}\n\nedgeData[reverseHash]=null;\n\n}else if(!(hash in edgeData)){\n\n// if we've already got an edge here then skip adding a new one\nedgeData[hash]={\n\nindex0:indexArr[j],\nindex1:indexArr[jNext],\nnormal:_normal.clone()};\n\n\n\n}\n\n}\n\n}\n\n// iterate over all remaining, unmatched edges and add them to the vertex array\nfor(var key in edgeData){\n\nif(edgeData[key]){var _edgeData$key=\n\nedgeData[key],index0=_edgeData$key.index0,index1=_edgeData$key.index1;\n_v0.fromBufferAttribute(positionAttr,index0);\n_v1$1.fromBufferAttribute(positionAttr,index1);\n\n_vertices2.push(_v0.x,_v0.y,_v0.z);\n_vertices2.push(_v1$1.x,_v1$1.y,_v1$1.z);\n\n}\n\n}\n\n_this78.setAttribute('position',new Float32BufferAttribute(_vertices2,3));\n\n}return _this78;\n\n}return EdgesGeometry;}(BufferGeometry);var\n\n\n\nShape=function(_Path){_inherits(Shape,_Path);\n\nfunction Shape(points){_classCallCheck(this,Shape);var _this79=_possibleConstructorReturn(this,(Shape.__proto__||Object.getPrototypeOf(Shape)).call(this,\n\npoints));\n\n_this79.uuid=generateUUID();\n\n_this79.type='Shape';\n\n_this79.holes=[];return _this79;\n\n}_createClass(Shape,[{key:'getPointsHoles',value:function getPointsHoles(\n\ndivisions){\n\nvar holesPts=[];\n\nfor(var i=0,l=this.holes.length;i<l;i++){\n\nholesPts[i]=this.holes[i].getPoints(divisions);\n\n}\n\nreturn holesPts;\n\n}\n\n// get points of shape and holes (keypoints based on segments parameter)\n},{key:'extractPoints',value:function extractPoints(\ndivisions){\n\nreturn{\n\nshape:this.getPoints(divisions),\nholes:this.getPointsHoles(divisions)};\n\n\n\n}},{key:'copy',value:function copy(\n\nsource){\n\n_get(Shape.prototype.__proto__||Object.getPrototypeOf(Shape.prototype),'copy',this).call(this,source);\n\nthis.holes=[];\n\nfor(var i=0,l=source.holes.length;i<l;i++){\n\nvar hole=source.holes[i];\n\nthis.holes.push(hole.clone());\n\n}\n\nreturn this;\n\n}},{key:'toJSON',value:function toJSON()\n\n{\n\nvar data=_get(Shape.prototype.__proto__||Object.getPrototypeOf(Shape.prototype),'toJSON',this).call(this);\n\ndata.uuid=this.uuid;\ndata.holes=[];\n\nfor(var i=0,l=this.holes.length;i<l;i++){\n\nvar hole=this.holes[i];\ndata.holes.push(hole.toJSON());\n\n}\n\nreturn data;\n\n}},{key:'fromJSON',value:function fromJSON(\n\njson){\n\n_get(Shape.prototype.__proto__||Object.getPrototypeOf(Shape.prototype),'fromJSON',this).call(this,json);\n\nthis.uuid=json.uuid;\nthis.holes=[];\n\nfor(var i=0,l=json.holes.length;i<l;i++){\n\nvar hole=json.holes[i];\nthis.holes.push(new Path().fromJSON(hole));\n\n}\n\nreturn this;\n\n}}]);return Shape;}(Path);\n\n\n\n/**\n * Port from https://github.com/mapbox/earcut (v2.2.2)\n */\n\nvar Earcut={\n\ntriangulate:function triangulate(data,holeIndices){var dim=arguments.length>2&&arguments[2]!==undefined?arguments[2]:2;\n\nvar hasHoles=holeIndices&&holeIndices.length;\nvar outerLen=hasHoles?holeIndices[0]*dim:data.length;\nvar outerNode=linkedList(data,0,outerLen,dim,true);\nvar triangles=[];\n\nif(!outerNode||outerNode.next===outerNode.prev)return triangles;\n\nvar minX=void 0,minY=void 0,maxX=void 0,maxY=void 0,x=void 0,y=void 0,invSize=void 0;\n\nif(hasHoles)outerNode=eliminateHoles(data,holeIndices,outerNode,dim);\n\n// if the shape is not too simple, we'll use z-order curve hash later; calculate polygon bbox\nif(data.length>80*dim){\n\nminX=maxX=data[0];\nminY=maxY=data[1];\n\nfor(var i=dim;i<outerLen;i+=dim){\n\nx=data[i];\ny=data[i+1];\nif(x<minX)minX=x;\nif(y<minY)minY=y;\nif(x>maxX)maxX=x;\nif(y>maxY)maxY=y;\n\n}\n\n// minX, minY and invSize are later used to transform coords into integers for z-order calculation\ninvSize=Math.max(maxX-minX,maxY-minY);\ninvSize=invSize!==0?1/invSize:0;\n\n}\n\nearcutLinked(outerNode,triangles,dim,minX,minY,invSize);\n\nreturn triangles;\n\n}};\n\n\n\n// create a circular doubly linked list from polygon points in the specified winding order\nfunction linkedList(data,start,end,dim,clockwise){\n\nvar i=void 0,last=void 0;\n\nif(clockwise===signedArea(data,start,end,dim)>0){\n\nfor(i=start;i<end;i+=dim){last=insertNode(i,data[i],data[i+1],last);}\n\n}else{\n\nfor(i=end-dim;i>=start;i-=dim){last=insertNode(i,data[i],data[i+1],last);}\n\n}\n\nif(last&&equals(last,last.next)){\n\nremoveNode(last);\nlast=last.next;\n\n}\n\nreturn last;\n\n}\n\n// eliminate colinear or duplicate points\nfunction filterPoints(start,end){\n\nif(!start)return start;\nif(!end)end=start;\n\nvar p=start,\nagain=void 0;\ndo{\n\nagain=false;\n\nif(!p.steiner&&(equals(p,p.next)||area(p.prev,p,p.next)===0)){\n\nremoveNode(p);\np=end=p.prev;\nif(p===p.next)break;\nagain=true;\n\n}else{\n\np=p.next;\n\n}\n\n}while(again||p!==end);\n\nreturn end;\n\n}\n\n// main ear slicing loop which triangulates a polygon (given as a linked list)\nfunction earcutLinked(ear,triangles,dim,minX,minY,invSize,pass){\n\nif(!ear)return;\n\n// interlink polygon nodes in z-order\nif(!pass&&invSize)indexCurve(ear,minX,minY,invSize);\n\nvar stop=ear,\nprev=void 0,next=void 0;\n\n// iterate through ears, slicing them one by one\nwhile(ear.prev!==ear.next){\n\nprev=ear.prev;\nnext=ear.next;\n\nif(invSize?isEarHashed(ear,minX,minY,invSize):isEar(ear)){\n\n// cut off the triangle\ntriangles.push(prev.i/dim);\ntriangles.push(ear.i/dim);\ntriangles.push(next.i/dim);\n\nremoveNode(ear);\n\n// skipping the next vertex leads to less sliver triangles\near=next.next;\nstop=next.next;\n\ncontinue;\n\n}\n\near=next;\n\n// if we looped through the whole remaining polygon and can't find any more ears\nif(ear===stop){\n\n// try filtering points and slicing again\nif(!pass){\n\nearcutLinked(filterPoints(ear),triangles,dim,minX,minY,invSize,1);\n\n// if this didn't work, try curing all small self-intersections locally\n\n}else if(pass===1){\n\near=cureLocalIntersections(filterPoints(ear),triangles,dim);\nearcutLinked(ear,triangles,dim,minX,minY,invSize,2);\n\n// as a last resort, try splitting the remaining polygon into two\n\n}else if(pass===2){\n\nsplitEarcut(ear,triangles,dim,minX,minY,invSize);\n\n}\n\nbreak;\n\n}\n\n}\n\n}\n\n// check whether a polygon node forms a valid ear with adjacent nodes\nfunction isEar(ear){\n\nvar a=ear.prev,\nb=ear,\nc=ear.next;\n\nif(area(a,b,c)>=0)return false;// reflex, can't be an ear\n\n// now make sure we don't have other points inside the potential ear\nvar p=ear.next.next;\n\nwhile(p!==ear.prev){\n\nif(pointInTriangle(a.x,a.y,b.x,b.y,c.x,c.y,p.x,p.y)&&\narea(p.prev,p,p.next)>=0)return false;\np=p.next;\n\n}\n\nreturn true;\n\n}\n\nfunction isEarHashed(ear,minX,minY,invSize){\n\nvar a=ear.prev,\nb=ear,\nc=ear.next;\n\nif(area(a,b,c)>=0)return false;// reflex, can't be an ear\n\n// triangle bbox; min & max are calculated like this for speed\nvar minTX=a.x<b.x?a.x<c.x?a.x:c.x:b.x<c.x?b.x:c.x,\nminTY=a.y<b.y?a.y<c.y?a.y:c.y:b.y<c.y?b.y:c.y,\nmaxTX=a.x>b.x?a.x>c.x?a.x:c.x:b.x>c.x?b.x:c.x,\nmaxTY=a.y>b.y?a.y>c.y?a.y:c.y:b.y>c.y?b.y:c.y;\n\n// z-order range for the current triangle bbox;\nvar minZ=zOrder(minTX,minTY,minX,minY,invSize),\nmaxZ=zOrder(maxTX,maxTY,minX,minY,invSize);\n\nvar p=ear.prevZ,\nn=ear.nextZ;\n\n// look for points inside the triangle in both directions\nwhile(p&&p.z>=minZ&&n&&n.z<=maxZ){\n\nif(p!==ear.prev&&p!==ear.next&&\npointInTriangle(a.x,a.y,b.x,b.y,c.x,c.y,p.x,p.y)&&\narea(p.prev,p,p.next)>=0)return false;\np=p.prevZ;\n\nif(n!==ear.prev&&n!==ear.next&&\npointInTriangle(a.x,a.y,b.x,b.y,c.x,c.y,n.x,n.y)&&\narea(n.prev,n,n.next)>=0)return false;\nn=n.nextZ;\n\n}\n\n// look for remaining points in decreasing z-order\nwhile(p&&p.z>=minZ){\n\nif(p!==ear.prev&&p!==ear.next&&\npointInTriangle(a.x,a.y,b.x,b.y,c.x,c.y,p.x,p.y)&&\narea(p.prev,p,p.next)>=0)return false;\np=p.prevZ;\n\n}\n\n// look for remaining points in increasing z-order\nwhile(n&&n.z<=maxZ){\n\nif(n!==ear.prev&&n!==ear.next&&\npointInTriangle(a.x,a.y,b.x,b.y,c.x,c.y,n.x,n.y)&&\narea(n.prev,n,n.next)>=0)return false;\nn=n.nextZ;\n\n}\n\nreturn true;\n\n}\n\n// go through all polygon nodes and cure small local self-intersections\nfunction cureLocalIntersections(start,triangles,dim){\n\nvar p=start;\ndo{\n\nvar a=p.prev,\nb=p.next.next;\n\nif(!equals(a,b)&&intersects(a,p,p.next,b)&&locallyInside(a,b)&&locallyInside(b,a)){\n\ntriangles.push(a.i/dim);\ntriangles.push(p.i/dim);\ntriangles.push(b.i/dim);\n\n// remove two nodes involved\nremoveNode(p);\nremoveNode(p.next);\n\np=start=b;\n\n}\n\np=p.next;\n\n}while(p!==start);\n\nreturn filterPoints(p);\n\n}\n\n// try splitting polygon into two and triangulate them independently\nfunction splitEarcut(start,triangles,dim,minX,minY,invSize){\n\n// look for a valid diagonal that divides the polygon into two\nvar a=start;\ndo{\n\nvar b=a.next.next;\nwhile(b!==a.prev){\n\nif(a.i!==b.i&&isValidDiagonal(a,b)){\n\n// split the polygon in two by the diagonal\nvar c=splitPolygon(a,b);\n\n// filter colinear points around the cuts\na=filterPoints(a,a.next);\nc=filterPoints(c,c.next);\n\n// run earcut on each half\nearcutLinked(a,triangles,dim,minX,minY,invSize);\nearcutLinked(c,triangles,dim,minX,minY,invSize);\nreturn;\n\n}\n\nb=b.next;\n\n}\n\na=a.next;\n\n}while(a!==start);\n\n}\n\n// link every hole into the outer loop, producing a single-ring polygon without holes\nfunction eliminateHoles(data,holeIndices,outerNode,dim){\n\nvar queue=[];\nvar i=void 0,len=void 0,start=void 0,end=void 0,list=void 0;\n\nfor(i=0,len=holeIndices.length;i<len;i++){\n\nstart=holeIndices[i]*dim;\nend=i<len-1?holeIndices[i+1]*dim:data.length;\nlist=linkedList(data,start,end,dim,false);\nif(list===list.next)list.steiner=true;\nqueue.push(getLeftmost(list));\n\n}\n\nqueue.sort(compareX);\n\n// process holes from left to right\nfor(i=0;i<queue.length;i++){\n\neliminateHole(queue[i],outerNode);\nouterNode=filterPoints(outerNode,outerNode.next);\n\n}\n\nreturn outerNode;\n\n}\n\nfunction compareX(a,b){\n\nreturn a.x-b.x;\n\n}\n\n// find a bridge between vertices that connects hole with an outer ring and link it\nfunction eliminateHole(hole,outerNode){\n\nouterNode=findHoleBridge(hole,outerNode);\nif(outerNode){\n\nvar b=splitPolygon(outerNode,hole);\n\n// filter collinear points around the cuts\nfilterPoints(outerNode,outerNode.next);\nfilterPoints(b,b.next);\n\n}\n\n}\n\n// David Eberly's algorithm for finding a bridge between hole and outer polygon\nfunction findHoleBridge(hole,outerNode){\n\nvar p=outerNode;\nvar hx=hole.x;\nvar hy=hole.y;\nvar qx=-Infinity,m=void 0;\n\n// find a segment intersected by a ray from the hole's leftmost point to the left;\n// segment's endpoint with lesser x will be potential connection point\ndo{\n\nif(hy<=p.y&&hy>=p.next.y&&p.next.y!==p.y){\n\nvar x=p.x+(hy-p.y)*(p.next.x-p.x)/(p.next.y-p.y);\nif(x<=hx&&x>qx){\n\nqx=x;\nif(x===hx){\n\nif(hy===p.y)return p;\nif(hy===p.next.y)return p.next;\n\n}\n\nm=p.x<p.next.x?p:p.next;\n\n}\n\n}\n\np=p.next;\n\n}while(p!==outerNode);\n\nif(!m)return null;\n\nif(hx===qx)return m;// hole touches outer segment; pick leftmost endpoint\n\n// look for points inside the triangle of hole point, segment intersection and endpoint;\n// if there are no points found, we have a valid connection;\n// otherwise choose the point of the minimum angle with the ray as connection point\n\nvar stop=m,\nmx=m.x,\nmy=m.y;\nvar tanMin=Infinity,tan=void 0;\n\np=m;\n\ndo{\n\nif(hx>=p.x&&p.x>=mx&&hx!==p.x&&\npointInTriangle(hy<my?hx:qx,hy,mx,my,hy<my?qx:hx,hy,p.x,p.y)){\n\ntan=Math.abs(hy-p.y)/(hx-p.x);// tangential\n\nif(locallyInside(p,hole)&&(tan<tanMin||tan===tanMin&&(p.x>m.x||p.x===m.x&&sectorContainsSector(m,p)))){\n\nm=p;\ntanMin=tan;\n\n}\n\n}\n\np=p.next;\n\n}while(p!==stop);\n\nreturn m;\n\n}\n\n// whether sector in vertex m contains sector in vertex p in the same coordinates\nfunction sectorContainsSector(m,p){\n\nreturn area(m.prev,m,p.prev)<0&&area(p.next,m,m.next)<0;\n\n}\n\n// interlink polygon nodes in z-order\nfunction indexCurve(start,minX,minY,invSize){\n\nvar p=start;\ndo{\n\nif(p.z===null)p.z=zOrder(p.x,p.y,minX,minY,invSize);\np.prevZ=p.prev;\np.nextZ=p.next;\np=p.next;\n\n}while(p!==start);\n\np.prevZ.nextZ=null;\np.prevZ=null;\n\nsortLinked(p);\n\n}\n\n// Simon Tatham's linked list merge sort algorithm\n// http://www.chiark.greenend.org.uk/~sgtatham/algorithms/listsort.html\nfunction sortLinked(list){\n\nvar i=void 0,p=void 0,q=void 0,e=void 0,tail=void 0,numMerges=void 0,pSize=void 0,qSize=void 0,\ninSize=1;\n\ndo{\n\np=list;\nlist=null;\ntail=null;\nnumMerges=0;\n\nwhile(p){\n\nnumMerges++;\nq=p;\npSize=0;\nfor(i=0;i<inSize;i++){\n\npSize++;\nq=q.nextZ;\nif(!q)break;\n\n}\n\nqSize=inSize;\n\nwhile(pSize>0||qSize>0&&q){\n\nif(pSize!==0&&(qSize===0||!q||p.z<=q.z)){\n\ne=p;\np=p.nextZ;\npSize--;\n\n}else{\n\ne=q;\nq=q.nextZ;\nqSize--;\n\n}\n\nif(tail)tail.nextZ=e;else\nlist=e;\n\ne.prevZ=tail;\ntail=e;\n\n}\n\np=q;\n\n}\n\ntail.nextZ=null;\ninSize*=2;\n\n}while(numMerges>1);\n\nreturn list;\n\n}\n\n// z-order of a point given coords and inverse of the longer side of data bbox\nfunction zOrder(x,y,minX,minY,invSize){\n\n// coords are transformed into non-negative 15-bit integer range\nx=32767*(x-minX)*invSize;\ny=32767*(y-minY)*invSize;\n\nx=(x|x<<8)&0x00FF00FF;\nx=(x|x<<4)&0x0F0F0F0F;\nx=(x|x<<2)&0x33333333;\nx=(x|x<<1)&0x55555555;\n\ny=(y|y<<8)&0x00FF00FF;\ny=(y|y<<4)&0x0F0F0F0F;\ny=(y|y<<2)&0x33333333;\ny=(y|y<<1)&0x55555555;\n\nreturn x|y<<1;\n\n}\n\n// find the leftmost node of a polygon ring\nfunction getLeftmost(start){\n\nvar p=start,\nleftmost=start;\ndo{\n\nif(p.x<leftmost.x||p.x===leftmost.x&&p.y<leftmost.y)leftmost=p;\np=p.next;\n\n}while(p!==start);\n\nreturn leftmost;\n\n}\n\n// check if a point lies within a convex triangle\nfunction pointInTriangle(ax,ay,bx,by,cx,cy,px,py){\n\nreturn(cx-px)*(ay-py)-(ax-px)*(cy-py)>=0&&\n(ax-px)*(by-py)-(bx-px)*(ay-py)>=0&&\n(bx-px)*(cy-py)-(cx-px)*(by-py)>=0;\n\n}\n\n// check if a diagonal between two polygon nodes is valid (lies in polygon interior)\nfunction isValidDiagonal(a,b){\n\nreturn a.next.i!==b.i&&a.prev.i!==b.i&&!intersectsPolygon(a,b)&&(// doesn't intersect other edges\nlocallyInside(a,b)&&locallyInside(b,a)&&middleInside(a,b)&&(// locally visible\narea(a.prev,a,b.prev)||area(a,b.prev,b))||// does not create opposite-facing sectors\nequals(a,b)&&area(a.prev,a,a.next)>0&&area(b.prev,b,b.next)>0);// special zero-length case\n\n}\n\n// signed area of a triangle\nfunction area(p,q,r){\n\nreturn(q.y-p.y)*(r.x-q.x)-(q.x-p.x)*(r.y-q.y);\n\n}\n\n// check if two points are equal\nfunction equals(p1,p2){\n\nreturn p1.x===p2.x&&p1.y===p2.y;\n\n}\n\n// check if two segments intersect\nfunction intersects(p1,q1,p2,q2){\n\nvar o1=sign(area(p1,q1,p2));\nvar o2=sign(area(p1,q1,q2));\nvar o3=sign(area(p2,q2,p1));\nvar o4=sign(area(p2,q2,q1));\n\nif(o1!==o2&&o3!==o4)return true;// general case\n\nif(o1===0&&onSegment(p1,p2,q1))return true;// p1, q1 and p2 are collinear and p2 lies on p1q1\nif(o2===0&&onSegment(p1,q2,q1))return true;// p1, q1 and q2 are collinear and q2 lies on p1q1\nif(o3===0&&onSegment(p2,p1,q2))return true;// p2, q2 and p1 are collinear and p1 lies on p2q2\nif(o4===0&&onSegment(p2,q1,q2))return true;// p2, q2 and q1 are collinear and q1 lies on p2q2\n\nreturn false;\n\n}\n\n// for collinear points p, q, r, check if point q lies on segment pr\nfunction onSegment(p,q,r){\n\nreturn q.x<=Math.max(p.x,r.x)&&q.x>=Math.min(p.x,r.x)&&q.y<=Math.max(p.y,r.y)&&q.y>=Math.min(p.y,r.y);\n\n}\n\nfunction sign(num){\n\nreturn num>0?1:num<0?-1:0;\n\n}\n\n// check if a polygon diagonal intersects any polygon segments\nfunction intersectsPolygon(a,b){\n\nvar p=a;\ndo{\n\nif(p.i!==a.i&&p.next.i!==a.i&&p.i!==b.i&&p.next.i!==b.i&&\nintersects(p,p.next,a,b))return true;\np=p.next;\n\n}while(p!==a);\n\nreturn false;\n\n}\n\n// check if a polygon diagonal is locally inside the polygon\nfunction locallyInside(a,b){\n\nreturn area(a.prev,a,a.next)<0?\narea(a,b,a.next)>=0&&area(a,a.prev,b)>=0:\narea(a,b,a.prev)<0||area(a,a.next,b)<0;\n\n}\n\n// check if the middle point of a polygon diagonal is inside the polygon\nfunction middleInside(a,b){\n\nvar p=a,\ninside=false;\nvar px=(a.x+b.x)/2,\npy=(a.y+b.y)/2;\ndo{\n\nif(p.y>py!==p.next.y>py&&p.next.y!==p.y&&\npx<(p.next.x-p.x)*(py-p.y)/(p.next.y-p.y)+p.x)\ninside=!inside;\np=p.next;\n\n}while(p!==a);\n\nreturn inside;\n\n}\n\n// link two polygon vertices with a bridge; if the vertices belong to the same ring, it splits polygon into two;\n// if one belongs to the outer ring and another to a hole, it merges it into a single ring\nfunction splitPolygon(a,b){\n\nvar a2=new Node(a.i,a.x,a.y),\nb2=new Node(b.i,b.x,b.y),\nan=a.next,\nbp=b.prev;\n\na.next=b;\nb.prev=a;\n\na2.next=an;\nan.prev=a2;\n\nb2.next=a2;\na2.prev=b2;\n\nbp.next=b2;\nb2.prev=bp;\n\nreturn b2;\n\n}\n\n// create a node and optionally link it with previous one (in a circular doubly linked list)\nfunction insertNode(i,x,y,last){\n\nvar p=new Node(i,x,y);\n\nif(!last){\n\np.prev=p;\np.next=p;\n\n}else{\n\np.next=last.next;\np.prev=last;\nlast.next.prev=p;\nlast.next=p;\n\n}\n\nreturn p;\n\n}\n\nfunction removeNode(p){\n\np.next.prev=p.prev;\np.prev.next=p.next;\n\nif(p.prevZ)p.prevZ.nextZ=p.nextZ;\nif(p.nextZ)p.nextZ.prevZ=p.prevZ;\n\n}\n\nfunction Node(i,x,y){\n\n// vertex index in coordinates array\nthis.i=i;\n\n// vertex coordinates\nthis.x=x;\nthis.y=y;\n\n// previous and next vertex nodes in a polygon ring\nthis.prev=null;\nthis.next=null;\n\n// z-order curve value\nthis.z=null;\n\n// previous and next nodes in z-order\nthis.prevZ=null;\nthis.nextZ=null;\n\n// indicates whether this is a steiner point\nthis.steiner=false;\n\n}\n\nfunction signedArea(data,start,end,dim){\n\nvar sum=0;\nfor(var i=start,j=end-dim;i<end;i+=dim){\n\nsum+=(data[j]-data[i])*(data[i+1]+data[j+1]);\nj=i;\n\n}\n\nreturn sum;\n\n}var\n\nShapeUtils=function(){function ShapeUtils(){_classCallCheck(this,ShapeUtils);}_createClass(ShapeUtils,null,[{key:'area',\n\n// calculate area of the contour polygon\nvalue:function area(\ncontour){\n\nvar n=contour.length;\nvar a=0.0;\n\nfor(var p=n-1,q=0;q<n;p=q++){\n\na+=contour[p].x*contour[q].y-contour[q].x*contour[p].y;\n\n}\n\nreturn a*0.5;\n\n}},{key:'isClockWise',value:function isClockWise(\n\npts){\n\nreturn ShapeUtils.area(pts)<0;\n\n}},{key:'triangulateShape',value:function triangulateShape(\n\ncontour,holes){\n\nvar vertices=[];// flat array of vertices like [ x0,y0, x1,y1, x2,y2, ... ]\nvar holeIndices=[];// array of hole indices\nvar faces=[];// final array of vertex indices like [ [ a,b,d ], [ b,c,d ] ]\n\nremoveDupEndPts(contour);\naddContour(vertices,contour);\n\n//\n\nvar holeIndex=contour.length;\n\nholes.forEach(removeDupEndPts);\n\nfor(var i=0;i<holes.length;i++){\n\nholeIndices.push(holeIndex);\nholeIndex+=holes[i].length;\naddContour(vertices,holes[i]);\n\n}\n\n//\n\nvar triangles=Earcut.triangulate(vertices,holeIndices);\n\n//\n\nfor(var _i60=0;_i60<triangles.length;_i60+=3){\n\nfaces.push(triangles.slice(_i60,_i60+3));\n\n}\n\nreturn faces;\n\n}}]);return ShapeUtils;}();\n\n\n\nfunction removeDupEndPts(points){\n\nvar l=points.length;\n\nif(l>2&&points[l-1].equals(points[0])){\n\npoints.pop();\n\n}\n\n}\n\nfunction addContour(vertices,contour){\n\nfor(var i=0;i<contour.length;i++){\n\nvertices.push(contour[i].x);\nvertices.push(contour[i].y);\n\n}\n\n}\n\n/**\n * Creates extruded geometry from a path shape.\n *\n * parameters = {\n *\n *  curveSegments: <int>, // number of points on the curves\n *  steps: <int>, // number of points for z-side extrusions / used for subdividing segments of extrude spline too\n *  depth: <float>, // Depth to extrude the shape\n *\n *  bevelEnabled: <bool>, // turn on bevel\n *  bevelThickness: <float>, // how deep into the original shape bevel goes\n *  bevelSize: <float>, // how far from shape outline (including bevelOffset) is bevel\n *  bevelOffset: <float>, // how far from shape outline does bevel start\n *  bevelSegments: <int>, // number of bevel layers\n *\n *  extrudePath: <THREE.Curve> // curve to extrude shape along\n *\n *  UVGenerator: <Object> // object that provides UV generator functions\n *\n * }\n */var\n\nExtrudeGeometry=function(_BufferGeometry8){_inherits(ExtrudeGeometry,_BufferGeometry8);\n\nfunction ExtrudeGeometry(){var shapes=arguments.length>0&&arguments[0]!==undefined?arguments[0]:new Shape([new Vector2(0.5,0.5),new Vector2(-0.5,0.5),new Vector2(-0.5,-0.5),new Vector2(0.5,-0.5)]);var options=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};_classCallCheck(this,ExtrudeGeometry);var _this80=_possibleConstructorReturn(this,(ExtrudeGeometry.__proto__||Object.getPrototypeOf(ExtrudeGeometry)).call(this));\n\n\n\n_this80.type='ExtrudeGeometry';\n\n_this80.parameters={\nshapes:shapes,\noptions:options};\n\n\nshapes=Array.isArray(shapes)?shapes:[shapes];\n\nvar scope=_this80;\n\nvar verticesArray=[];\nvar uvArray=[];\n\nfor(var i=0,l=shapes.length;i<l;i++){\n\nvar shape=shapes[i];\naddShape(shape);\n\n}\n\n// build geometry\n\n_this80.setAttribute('position',new Float32BufferAttribute(verticesArray,3));\n_this80.setAttribute('uv',new Float32BufferAttribute(uvArray,2));\n\n_this80.computeVertexNormals();\n\n// functions\n\nfunction addShape(shape){\n\nvar placeholder=[];\n\n// options\n\nvar curveSegments=options.curveSegments!==undefined?options.curveSegments:12;\nvar steps=options.steps!==undefined?options.steps:1;\nvar depth=options.depth!==undefined?options.depth:1;\n\nvar bevelEnabled=options.bevelEnabled!==undefined?options.bevelEnabled:true;\nvar bevelThickness=options.bevelThickness!==undefined?options.bevelThickness:0.2;\nvar bevelSize=options.bevelSize!==undefined?options.bevelSize:bevelThickness-0.1;\nvar bevelOffset=options.bevelOffset!==undefined?options.bevelOffset:0;\nvar bevelSegments=options.bevelSegments!==undefined?options.bevelSegments:3;\n\nvar extrudePath=options.extrudePath;\n\nvar uvgen=options.UVGenerator!==undefined?options.UVGenerator:WorldUVGenerator;\n\n// deprecated options\n\nif(options.amount!==undefined){\n\nconsole.warn('THREE.ExtrudeBufferGeometry: amount has been renamed to depth.');\ndepth=options.amount;\n\n}\n\n//\n\nvar extrudePts=void 0,extrudeByPath=false;\nvar splineTube=void 0,binormal=void 0,normal=void 0,position2=void 0;\n\nif(extrudePath){\n\nextrudePts=extrudePath.getSpacedPoints(steps);\n\nextrudeByPath=true;\nbevelEnabled=false;// bevels not supported for path extrusion\n\n// SETUP TNB variables\n\n// TODO1 - have a .isClosed in spline?\n\nsplineTube=extrudePath.computeFrenetFrames(steps,false);\n\n// console.log(splineTube, 'splineTube', splineTube.normals.length, 'steps', steps, 'extrudePts', extrudePts.length);\n\nbinormal=new Vector3();\nnormal=new Vector3();\nposition2=new Vector3();\n\n}\n\n// Safeguards if bevels are not enabled\n\nif(!bevelEnabled){\n\nbevelSegments=0;\nbevelThickness=0;\nbevelSize=0;\nbevelOffset=0;\n\n}\n\n// Variables initialization\n\nvar shapePoints=shape.extractPoints(curveSegments);\n\nvar vertices=shapePoints.shape;\nvar holes=shapePoints.holes;\n\nvar reverse=!ShapeUtils.isClockWise(vertices);\n\nif(reverse){\n\nvertices=vertices.reverse();\n\n// Maybe we should also check if holes are in the opposite direction, just to be safe ...\n\nfor(var h=0,hl=holes.length;h<hl;h++){\n\nvar ahole=holes[h];\n\nif(ShapeUtils.isClockWise(ahole)){\n\nholes[h]=ahole.reverse();\n\n}\n\n}\n\n}\n\n\nvar faces=ShapeUtils.triangulateShape(vertices,holes);\n\n/* Vertices */\n\nvar contour=vertices;// vertices has all points but contour has only points of circumference\n\nfor(var _h=0,_hl=holes.length;_h<_hl;_h++){\n\nvar _ahole=holes[_h];\n\nvertices=vertices.concat(_ahole);\n\n}\n\n\nfunction scalePt2(pt,vec,size){\n\nif(!vec)console.error('THREE.ExtrudeGeometry: vec does not exist');\n\nreturn vec.clone().multiplyScalar(size).add(pt);\n\n}\n\nvar vlen=vertices.length,flen=faces.length;\n\n\n// Find directions for point movement\n\n\nfunction getBevelVec(inPt,inPrev,inNext){\n\n// computes for inPt the corresponding point inPt' on a new contour\n//   shifted by 1 unit (length of normalized vector) to the left\n// if we walk along contour clockwise, this new contour is outside the old one\n//\n// inPt' is the intersection of the two lines parallel to the two\n//  adjacent edges of inPt at a distance of 1 unit on the left side.\n\nvar v_trans_x=void 0,v_trans_y=void 0,shrink_by=void 0;// resulting translation vector for inPt\n\n// good reading for geometry algorithms (here: line-line intersection)\n// http://geomalgorithms.com/a05-_intersect-1.html\n\nvar v_prev_x=inPt.x-inPrev.x,\nv_prev_y=inPt.y-inPrev.y;\nvar v_next_x=inNext.x-inPt.x,\nv_next_y=inNext.y-inPt.y;\n\nvar v_prev_lensq=v_prev_x*v_prev_x+v_prev_y*v_prev_y;\n\n// check for collinear edges\nvar collinear0=v_prev_x*v_next_y-v_prev_y*v_next_x;\n\nif(Math.abs(collinear0)>Number.EPSILON){\n\n// not collinear\n\n// length of vectors for normalizing\n\nvar v_prev_len=Math.sqrt(v_prev_lensq);\nvar v_next_len=Math.sqrt(v_next_x*v_next_x+v_next_y*v_next_y);\n\n// shift adjacent points by unit vectors to the left\n\nvar ptPrevShift_x=inPrev.x-v_prev_y/v_prev_len;\nvar ptPrevShift_y=inPrev.y+v_prev_x/v_prev_len;\n\nvar ptNextShift_x=inNext.x-v_next_y/v_next_len;\nvar ptNextShift_y=inNext.y+v_next_x/v_next_len;\n\n// scaling factor for v_prev to intersection point\n\nvar sf=((ptNextShift_x-ptPrevShift_x)*v_next_y-\n(ptNextShift_y-ptPrevShift_y)*v_next_x)/(\nv_prev_x*v_next_y-v_prev_y*v_next_x);\n\n// vector from inPt to intersection point\n\nv_trans_x=ptPrevShift_x+v_prev_x*sf-inPt.x;\nv_trans_y=ptPrevShift_y+v_prev_y*sf-inPt.y;\n\n// Don't normalize!, otherwise sharp corners become ugly\n//  but prevent crazy spikes\nvar v_trans_lensq=v_trans_x*v_trans_x+v_trans_y*v_trans_y;\nif(v_trans_lensq<=2){\n\nreturn new Vector2(v_trans_x,v_trans_y);\n\n}else{\n\nshrink_by=Math.sqrt(v_trans_lensq/2);\n\n}\n\n}else{\n\n// handle special case of collinear edges\n\nvar direction_eq=false;// assumes: opposite\n\nif(v_prev_x>Number.EPSILON){\n\nif(v_next_x>Number.EPSILON){\n\ndirection_eq=true;\n\n}\n\n}else{\n\nif(v_prev_x<-Number.EPSILON){\n\nif(v_next_x<-Number.EPSILON){\n\ndirection_eq=true;\n\n}\n\n}else{\n\nif(Math.sign(v_prev_y)===Math.sign(v_next_y)){\n\ndirection_eq=true;\n\n}\n\n}\n\n}\n\nif(direction_eq){\n\n// console.log(\"Warning: lines are a straight sequence\");\nv_trans_x=-v_prev_y;\nv_trans_y=v_prev_x;\nshrink_by=Math.sqrt(v_prev_lensq);\n\n}else{\n\n// console.log(\"Warning: lines are a straight spike\");\nv_trans_x=v_prev_x;\nv_trans_y=v_prev_y;\nshrink_by=Math.sqrt(v_prev_lensq/2);\n\n}\n\n}\n\nreturn new Vector2(v_trans_x/shrink_by,v_trans_y/shrink_by);\n\n}\n\n\nvar contourMovements=[];\n\nfor(var _i61=0,il=contour.length,j=il-1,k=_i61+1;_i61<il;_i61++,j++,k++){\n\nif(j===il)j=0;\nif(k===il)k=0;\n\n//  (j)---(i)---(k)\n// console.log('i,j,k', i, j , k)\n\ncontourMovements[_i61]=getBevelVec(contour[_i61],contour[j],contour[k]);\n\n}\n\nvar holesMovements=[];\nvar oneHoleMovements=void 0,verticesMovements=contourMovements.concat();\n\nfor(var _h2=0,_hl2=holes.length;_h2<_hl2;_h2++){\n\nvar _ahole2=holes[_h2];\n\noneHoleMovements=[];\n\nfor(var _i62=0,_il13=_ahole2.length,_j8=_il13-1,_k=_i62+1;_i62<_il13;_i62++,_j8++,_k++){\n\nif(_j8===_il13)_j8=0;\nif(_k===_il13)_k=0;\n\n//  (j)---(i)---(k)\noneHoleMovements[_i62]=getBevelVec(_ahole2[_i62],_ahole2[_j8],_ahole2[_k]);\n\n}\n\nholesMovements.push(oneHoleMovements);\nverticesMovements=verticesMovements.concat(oneHoleMovements);\n\n}\n\n\n// Loop bevelSegments, 1 for the front, 1 for the back\n\nfor(var b=0;b<bevelSegments;b++){\n\n//for ( b = bevelSegments; b > 0; b -- ) {\n\nvar t=b/bevelSegments;\nvar z=bevelThickness*Math.cos(t*Math.PI/2);\nvar _bs=bevelSize*Math.sin(t*Math.PI/2)+bevelOffset;\n\n// contract shape\n\nfor(var _i63=0,_il14=contour.length;_i63<_il14;_i63++){\n\nvar vert=scalePt2(contour[_i63],contourMovements[_i63],_bs);\n\nv(vert.x,vert.y,-z);\n\n}\n\n// expand holes\n\nfor(var _h3=0,_hl3=holes.length;_h3<_hl3;_h3++){\n\nvar _ahole3=holes[_h3];\noneHoleMovements=holesMovements[_h3];\n\nfor(var _i64=0,_il15=_ahole3.length;_i64<_il15;_i64++){\n\nvar _vert=scalePt2(_ahole3[_i64],oneHoleMovements[_i64],_bs);\n\nv(_vert.x,_vert.y,-z);\n\n}\n\n}\n\n}\n\nvar bs=bevelSize+bevelOffset;\n\n// Back facing vertices\n\nfor(var _i65=0;_i65<vlen;_i65++){\n\nvar _vert2=bevelEnabled?scalePt2(vertices[_i65],verticesMovements[_i65],bs):vertices[_i65];\n\nif(!extrudeByPath){\n\nv(_vert2.x,_vert2.y,0);\n\n}else{\n\n// v( vert.x, vert.y + extrudePts[ 0 ].y, extrudePts[ 0 ].x );\n\nnormal.copy(splineTube.normals[0]).multiplyScalar(_vert2.x);\nbinormal.copy(splineTube.binormals[0]).multiplyScalar(_vert2.y);\n\nposition2.copy(extrudePts[0]).add(normal).add(binormal);\n\nv(position2.x,position2.y,position2.z);\n\n}\n\n}\n\n// Add stepped vertices...\n// Including front facing vertices\n\nfor(var s=1;s<=steps;s++){\n\nfor(var _i66=0;_i66<vlen;_i66++){\n\nvar _vert3=bevelEnabled?scalePt2(vertices[_i66],verticesMovements[_i66],bs):vertices[_i66];\n\nif(!extrudeByPath){\n\nv(_vert3.x,_vert3.y,depth/steps*s);\n\n}else{\n\n// v( vert.x, vert.y + extrudePts[ s - 1 ].y, extrudePts[ s - 1 ].x );\n\nnormal.copy(splineTube.normals[s]).multiplyScalar(_vert3.x);\nbinormal.copy(splineTube.binormals[s]).multiplyScalar(_vert3.y);\n\nposition2.copy(extrudePts[s]).add(normal).add(binormal);\n\nv(position2.x,position2.y,position2.z);\n\n}\n\n}\n\n}\n\n\n// Add bevel segments planes\n\n//for ( b = 1; b <= bevelSegments; b ++ ) {\nfor(var _b5=bevelSegments-1;_b5>=0;_b5--){\n\nvar _t=_b5/bevelSegments;\nvar _z2=bevelThickness*Math.cos(_t*Math.PI/2);\nvar _bs2=bevelSize*Math.sin(_t*Math.PI/2)+bevelOffset;\n\n// contract shape\n\nfor(var _i67=0,_il16=contour.length;_i67<_il16;_i67++){\n\nvar _vert4=scalePt2(contour[_i67],contourMovements[_i67],_bs2);\nv(_vert4.x,_vert4.y,depth+_z2);\n\n}\n\n// expand holes\n\nfor(var _h4=0,_hl4=holes.length;_h4<_hl4;_h4++){\n\nvar _ahole4=holes[_h4];\noneHoleMovements=holesMovements[_h4];\n\nfor(var _i68=0,_il17=_ahole4.length;_i68<_il17;_i68++){\n\nvar _vert5=scalePt2(_ahole4[_i68],oneHoleMovements[_i68],_bs2);\n\nif(!extrudeByPath){\n\nv(_vert5.x,_vert5.y,depth+_z2);\n\n}else{\n\nv(_vert5.x,_vert5.y+extrudePts[steps-1].y,extrudePts[steps-1].x+_z2);\n\n}\n\n}\n\n}\n\n}\n\n/* Faces */\n\n// Top and bottom faces\n\nbuildLidFaces();\n\n// Sides faces\n\nbuildSideFaces();\n\n\n/////  Internal functions\n\nfunction buildLidFaces(){\n\nvar start=verticesArray.length/3;\n\nif(bevelEnabled){\n\nvar layer=0;// steps + 1\nvar offset=vlen*layer;\n\n// Bottom faces\n\nfor(var _i69=0;_i69<flen;_i69++){\n\nvar face=faces[_i69];\nf3(face[2]+offset,face[1]+offset,face[0]+offset);\n\n}\n\nlayer=steps+bevelSegments*2;\noffset=vlen*layer;\n\n// Top faces\n\nfor(var _i70=0;_i70<flen;_i70++){\n\nvar _face=faces[_i70];\nf3(_face[0]+offset,_face[1]+offset,_face[2]+offset);\n\n}\n\n}else{\n\n// Bottom faces\n\nfor(var _i71=0;_i71<flen;_i71++){\n\nvar _face2=faces[_i71];\nf3(_face2[2],_face2[1],_face2[0]);\n\n}\n\n// Top faces\n\nfor(var _i72=0;_i72<flen;_i72++){\n\nvar _face3=faces[_i72];\nf3(_face3[0]+vlen*steps,_face3[1]+vlen*steps,_face3[2]+vlen*steps);\n\n}\n\n}\n\nscope.addGroup(start,verticesArray.length/3-start,0);\n\n}\n\n// Create faces for the z-sides of the shape\n\nfunction buildSideFaces(){\n\nvar start=verticesArray.length/3;\nvar layeroffset=0;\nsidewalls(contour,layeroffset);\nlayeroffset+=contour.length;\n\nfor(var _h5=0,_hl5=holes.length;_h5<_hl5;_h5++){\n\nvar _ahole5=holes[_h5];\nsidewalls(_ahole5,layeroffset);\n\n//, true\nlayeroffset+=_ahole5.length;\n\n}\n\n\nscope.addGroup(start,verticesArray.length/3-start,1);\n\n\n}\n\nfunction sidewalls(contour,layeroffset){\n\nvar i=contour.length;\n\nwhile(--i>=0){\n\nvar _j9=i;\nvar _k2=i-1;\nif(_k2<0)_k2=contour.length-1;\n\n//console.log('b', i,j, i-1, k,vertices.length);\n\nfor(var _s4=0,sl=steps+bevelSegments*2;_s4<sl;_s4++){\n\nvar slen1=vlen*_s4;\nvar slen2=vlen*(_s4+1);\n\nvar a=layeroffset+_j9+slen1,\n_b6=layeroffset+_k2+slen1,\nc=layeroffset+_k2+slen2,\nd=layeroffset+_j9+slen2;\n\nf4(a,_b6,c,d);\n\n}\n\n}\n\n}\n\nfunction v(x,y,z){\n\nplaceholder.push(x);\nplaceholder.push(y);\nplaceholder.push(z);\n\n}\n\n\nfunction f3(a,b,c){\n\naddVertex(a);\naddVertex(b);\naddVertex(c);\n\nvar nextIndex=verticesArray.length/3;\nvar uvs=uvgen.generateTopUV(scope,verticesArray,nextIndex-3,nextIndex-2,nextIndex-1);\n\naddUV(uvs[0]);\naddUV(uvs[1]);\naddUV(uvs[2]);\n\n}\n\nfunction f4(a,b,c,d){\n\naddVertex(a);\naddVertex(b);\naddVertex(d);\n\naddVertex(b);\naddVertex(c);\naddVertex(d);\n\n\nvar nextIndex=verticesArray.length/3;\nvar uvs=uvgen.generateSideWallUV(scope,verticesArray,nextIndex-6,nextIndex-3,nextIndex-2,nextIndex-1);\n\naddUV(uvs[0]);\naddUV(uvs[1]);\naddUV(uvs[3]);\n\naddUV(uvs[1]);\naddUV(uvs[2]);\naddUV(uvs[3]);\n\n}\n\nfunction addVertex(index){\n\nverticesArray.push(placeholder[index*3+0]);\nverticesArray.push(placeholder[index*3+1]);\nverticesArray.push(placeholder[index*3+2]);\n\n}\n\n\nfunction addUV(vector2){\n\nuvArray.push(vector2.x);\nuvArray.push(vector2.y);\n\n}\n\n}return _this80;\n\n}_createClass(ExtrudeGeometry,[{key:'toJSON',value:function toJSON()\n\n{\n\nvar data=_get(ExtrudeGeometry.prototype.__proto__||Object.getPrototypeOf(ExtrudeGeometry.prototype),'toJSON',this).call(this);\n\nvar shapes=this.parameters.shapes;\nvar options=this.parameters.options;\n\nreturn toJSON$1(shapes,options,data);\n\n}}],[{key:'fromJSON',value:function fromJSON(\n\ndata,shapes){\n\nvar geometryShapes=[];\n\nfor(var j=0,jl=data.shapes.length;j<jl;j++){\n\nvar shape=shapes[data.shapes[j]];\n\ngeometryShapes.push(shape);\n\n}\n\nvar extrudePath=data.options.extrudePath;\n\nif(extrudePath!==undefined){\n\ndata.options.extrudePath=new Curves[extrudePath.type]().fromJSON(extrudePath);\n\n}\n\nreturn new ExtrudeGeometry(geometryShapes,data.options);\n\n}}]);return ExtrudeGeometry;}(BufferGeometry);\n\n\n\nvar WorldUVGenerator={\n\ngenerateTopUV:function generateTopUV(geometry,vertices,indexA,indexB,indexC){\n\nvar a_x=vertices[indexA*3];\nvar a_y=vertices[indexA*3+1];\nvar b_x=vertices[indexB*3];\nvar b_y=vertices[indexB*3+1];\nvar c_x=vertices[indexC*3];\nvar c_y=vertices[indexC*3+1];\n\nreturn[\nnew Vector2(a_x,a_y),\nnew Vector2(b_x,b_y),\nnew Vector2(c_x,c_y)];\n\n\n},\n\ngenerateSideWallUV:function generateSideWallUV(geometry,vertices,indexA,indexB,indexC,indexD){\n\nvar a_x=vertices[indexA*3];\nvar a_y=vertices[indexA*3+1];\nvar a_z=vertices[indexA*3+2];\nvar b_x=vertices[indexB*3];\nvar b_y=vertices[indexB*3+1];\nvar b_z=vertices[indexB*3+2];\nvar c_x=vertices[indexC*3];\nvar c_y=vertices[indexC*3+1];\nvar c_z=vertices[indexC*3+2];\nvar d_x=vertices[indexD*3];\nvar d_y=vertices[indexD*3+1];\nvar d_z=vertices[indexD*3+2];\n\nif(Math.abs(a_y-b_y)<Math.abs(a_x-b_x)){\n\nreturn[\nnew Vector2(a_x,1-a_z),\nnew Vector2(b_x,1-b_z),\nnew Vector2(c_x,1-c_z),\nnew Vector2(d_x,1-d_z)];\n\n\n}else{\n\nreturn[\nnew Vector2(a_y,1-a_z),\nnew Vector2(b_y,1-b_z),\nnew Vector2(c_y,1-c_z),\nnew Vector2(d_y,1-d_z)];\n\n\n}\n\n}};\n\n\n\nfunction toJSON$1(shapes,options,data){\n\ndata.shapes=[];\n\nif(Array.isArray(shapes)){\n\nfor(var i=0,l=shapes.length;i<l;i++){\n\nvar shape=shapes[i];\n\ndata.shapes.push(shape.uuid);\n\n}\n\n}else{\n\ndata.shapes.push(shapes.uuid);\n\n}\n\ndata.options=Object.assign({},options);\n\nif(options.extrudePath!==undefined)data.options.extrudePath=options.extrudePath.toJSON();\n\nreturn data;\n\n}var\n\nIcosahedronGeometry=function(_PolyhedronGeometry2){_inherits(IcosahedronGeometry,_PolyhedronGeometry2);\n\nfunction IcosahedronGeometry(){var radius=arguments.length>0&&arguments[0]!==undefined?arguments[0]:1;var detail=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;_classCallCheck(this,IcosahedronGeometry);\n\nvar t=(1+Math.sqrt(5))/2;\n\nvar vertices=[\n-1,t,0,1,t,0,-1,-t,0,1,-t,0,\n0,-1,t,0,1,t,0,-1,-t,0,1,-t,\nt,0,-1,t,0,1,-t,0,-1,-t,0,1];\n\n\nvar indices=[\n0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,\n1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,\n3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,\n4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];var _this81=_possibleConstructorReturn(this,(IcosahedronGeometry.__proto__||Object.getPrototypeOf(IcosahedronGeometry)).call(this,\n\n\nvertices,indices,radius,detail));\n\n_this81.type='IcosahedronGeometry';\n\n_this81.parameters={\nradius:radius,\ndetail:detail};return _this81;\n\n\n}_createClass(IcosahedronGeometry,null,[{key:'fromJSON',value:function fromJSON(\n\ndata){\n\nreturn new IcosahedronGeometry(data.radius,data.detail);\n\n}}]);return IcosahedronGeometry;}(PolyhedronGeometry);var\n\n\n\nOctahedronGeometry=function(_PolyhedronGeometry3){_inherits(OctahedronGeometry,_PolyhedronGeometry3);\n\nfunction OctahedronGeometry(){var radius=arguments.length>0&&arguments[0]!==undefined?arguments[0]:1;var detail=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;_classCallCheck(this,OctahedronGeometry);\n\nvar vertices=[\n1,0,0,-1,0,0,0,1,0,\n0,-1,0,0,0,1,0,0,-1];\n\n\nvar indices=[\n0,2,4,0,4,3,0,3,5,\n0,5,2,1,2,5,1,5,3,\n1,3,4,1,4,2];var _this82=_possibleConstructorReturn(this,(OctahedronGeometry.__proto__||Object.getPrototypeOf(OctahedronGeometry)).call(this,\n\n\nvertices,indices,radius,detail));\n\n_this82.type='OctahedronGeometry';\n\n_this82.parameters={\nradius:radius,\ndetail:detail};return _this82;\n\n\n}_createClass(OctahedronGeometry,null,[{key:'fromJSON',value:function fromJSON(\n\ndata){\n\nreturn new OctahedronGeometry(data.radius,data.detail);\n\n}}]);return OctahedronGeometry;}(PolyhedronGeometry);var\n\n\n\nRingGeometry=function(_BufferGeometry9){_inherits(RingGeometry,_BufferGeometry9);\n\nfunction RingGeometry(){var innerRadius=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0.5;var outerRadius=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1;var thetaSegments=arguments.length>2&&arguments[2]!==undefined?arguments[2]:8;var phiSegments=arguments.length>3&&arguments[3]!==undefined?arguments[3]:1;var thetaStart=arguments.length>4&&arguments[4]!==undefined?arguments[4]:0;var thetaLength=arguments.length>5&&arguments[5]!==undefined?arguments[5]:Math.PI*2;_classCallCheck(this,RingGeometry);var _this83=_possibleConstructorReturn(this,(RingGeometry.__proto__||Object.getPrototypeOf(RingGeometry)).call(this));\n\n\n\n_this83.type='RingGeometry';\n\n_this83.parameters={\ninnerRadius:innerRadius,\nouterRadius:outerRadius,\nthetaSegments:thetaSegments,\nphiSegments:phiSegments,\nthetaStart:thetaStart,\nthetaLength:thetaLength};\n\n\nthetaSegments=Math.max(3,thetaSegments);\nphiSegments=Math.max(1,phiSegments);\n\n// buffers\n\nvar indices=[];\nvar vertices=[];\nvar normals=[];\nvar uvs=[];\n\n// some helper variables\n\nvar radius=innerRadius;\nvar radiusStep=(outerRadius-innerRadius)/phiSegments;\nvar vertex=new Vector3();\nvar uv=new Vector2();\n\n// generate vertices, normals and uvs\n\nfor(var j=0;j<=phiSegments;j++){\n\nfor(var i=0;i<=thetaSegments;i++){\n\n// values are generate from the inside of the ring to the outside\n\nvar segment=thetaStart+i/thetaSegments*thetaLength;\n\n// vertex\n\nvertex.x=radius*Math.cos(segment);\nvertex.y=radius*Math.sin(segment);\n\nvertices.push(vertex.x,vertex.y,vertex.z);\n\n// normal\n\nnormals.push(0,0,1);\n\n// uv\n\nuv.x=(vertex.x/outerRadius+1)/2;\nuv.y=(vertex.y/outerRadius+1)/2;\n\nuvs.push(uv.x,uv.y);\n\n}\n\n// increase the radius for next row of vertices\n\nradius+=radiusStep;\n\n}\n\n// indices\n\nfor(var _j10=0;_j10<phiSegments;_j10++){\n\nvar thetaSegmentLevel=_j10*(thetaSegments+1);\n\nfor(var _i73=0;_i73<thetaSegments;_i73++){\n\nvar _segment=_i73+thetaSegmentLevel;\n\nvar a=_segment;\nvar b=_segment+thetaSegments+1;\nvar c=_segment+thetaSegments+2;\nvar d=_segment+1;\n\n// faces\n\nindices.push(a,b,d);\nindices.push(b,c,d);\n\n}\n\n}\n\n// build geometry\n\n_this83.setIndex(indices);\n_this83.setAttribute('position',new Float32BufferAttribute(vertices,3));\n_this83.setAttribute('normal',new Float32BufferAttribute(normals,3));\n_this83.setAttribute('uv',new Float32BufferAttribute(uvs,2));return _this83;\n\n}_createClass(RingGeometry,null,[{key:'fromJSON',value:function fromJSON(\n\ndata){\n\nreturn new RingGeometry(data.innerRadius,data.outerRadius,data.thetaSegments,data.phiSegments,data.thetaStart,data.thetaLength);\n\n}}]);return RingGeometry;}(BufferGeometry);var\n\n\n\nShapeGeometry=function(_BufferGeometry10){_inherits(ShapeGeometry,_BufferGeometry10);\n\nfunction ShapeGeometry(){var shapes=arguments.length>0&&arguments[0]!==undefined?arguments[0]:new Shape([new Vector2(0,0.5),new Vector2(-0.5,-0.5),new Vector2(0.5,-0.5)]);var curveSegments=arguments.length>1&&arguments[1]!==undefined?arguments[1]:12;_classCallCheck(this,ShapeGeometry);var _this84=_possibleConstructorReturn(this,(ShapeGeometry.__proto__||Object.getPrototypeOf(ShapeGeometry)).call(this));\n\n\n_this84.type='ShapeGeometry';\n\n_this84.parameters={\nshapes:shapes,\ncurveSegments:curveSegments};\n\n\n// buffers\n\nvar indices=[];\nvar vertices=[];\nvar normals=[];\nvar uvs=[];\n\n// helper variables\n\nvar groupStart=0;\nvar groupCount=0;\n\n// allow single and array values for \"shapes\" parameter\n\nif(Array.isArray(shapes)===false){\n\naddShape(shapes);\n\n}else{\n\nfor(var i=0;i<shapes.length;i++){\n\naddShape(shapes[i]);\n\n_this84.addGroup(groupStart,groupCount,i);// enables MultiMaterial support\n\ngroupStart+=groupCount;\ngroupCount=0;\n\n}\n\n}\n\n// build geometry\n\n_this84.setIndex(indices);\n_this84.setAttribute('position',new Float32BufferAttribute(vertices,3));\n_this84.setAttribute('normal',new Float32BufferAttribute(normals,3));\n_this84.setAttribute('uv',new Float32BufferAttribute(uvs,2));\n\n\n// helper functions\n\nfunction addShape(shape){\n\nvar indexOffset=vertices.length/3;\nvar points=shape.extractPoints(curveSegments);\n\nvar shapeVertices=points.shape;\nvar shapeHoles=points.holes;\n\n// check direction of vertices\n\nif(ShapeUtils.isClockWise(shapeVertices)===false){\n\nshapeVertices=shapeVertices.reverse();\n\n}\n\nfor(var _i74=0,l=shapeHoles.length;_i74<l;_i74++){\n\nvar shapeHole=shapeHoles[_i74];\n\nif(ShapeUtils.isClockWise(shapeHole)===true){\n\nshapeHoles[_i74]=shapeHole.reverse();\n\n}\n\n}\n\nvar faces=ShapeUtils.triangulateShape(shapeVertices,shapeHoles);\n\n// join vertices of inner and outer paths to a single array\n\nfor(var _i75=0,_l8=shapeHoles.length;_i75<_l8;_i75++){\n\nvar _shapeHole=shapeHoles[_i75];\nshapeVertices=shapeVertices.concat(_shapeHole);\n\n}\n\n// vertices, normals, uvs\n\nfor(var _i76=0,_l9=shapeVertices.length;_i76<_l9;_i76++){\n\nvar _vertex=shapeVertices[_i76];\n\nvertices.push(_vertex.x,_vertex.y,0);\nnormals.push(0,0,1);\nuvs.push(_vertex.x,_vertex.y);// world uvs\n\n}\n\n// incides\n\nfor(var _i77=0,_l10=faces.length;_i77<_l10;_i77++){\n\nvar face=faces[_i77];\n\nvar a=face[0]+indexOffset;\nvar b=face[1]+indexOffset;\nvar c=face[2]+indexOffset;\n\nindices.push(a,b,c);\ngroupCount+=3;\n\n}\n\n}return _this84;\n\n}_createClass(ShapeGeometry,[{key:'toJSON',value:function toJSON()\n\n{\n\nvar data=_get(ShapeGeometry.prototype.__proto__||Object.getPrototypeOf(ShapeGeometry.prototype),'toJSON',this).call(this);\n\nvar shapes=this.parameters.shapes;\n\nreturn _toJSON(shapes,data);\n\n}}],[{key:'fromJSON',value:function fromJSON(\n\ndata,shapes){\n\nvar geometryShapes=[];\n\nfor(var j=0,jl=data.shapes.length;j<jl;j++){\n\nvar shape=shapes[data.shapes[j]];\n\ngeometryShapes.push(shape);\n\n}\n\nreturn new ShapeGeometry(geometryShapes,data.curveSegments);\n\n}}]);return ShapeGeometry;}(BufferGeometry);\n\n\n\nfunction _toJSON(shapes,data){\n\ndata.shapes=[];\n\nif(Array.isArray(shapes)){\n\nfor(var i=0,l=shapes.length;i<l;i++){\n\nvar shape=shapes[i];\n\ndata.shapes.push(shape.uuid);\n\n}\n\n}else{\n\ndata.shapes.push(shapes.uuid);\n\n}\n\nreturn data;\n\n}var\n\nSphereGeometry=function(_BufferGeometry11){_inherits(SphereGeometry,_BufferGeometry11);\n\nfunction SphereGeometry(){var radius=arguments.length>0&&arguments[0]!==undefined?arguments[0]:1;var widthSegments=arguments.length>1&&arguments[1]!==undefined?arguments[1]:32;var heightSegments=arguments.length>2&&arguments[2]!==undefined?arguments[2]:16;var phiStart=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0;var phiLength=arguments.length>4&&arguments[4]!==undefined?arguments[4]:Math.PI*2;var thetaStart=arguments.length>5&&arguments[5]!==undefined?arguments[5]:0;var thetaLength=arguments.length>6&&arguments[6]!==undefined?arguments[6]:Math.PI;_classCallCheck(this,SphereGeometry);var _this85=_possibleConstructorReturn(this,(SphereGeometry.__proto__||Object.getPrototypeOf(SphereGeometry)).call(this));\n\n\n_this85.type='SphereGeometry';\n\n_this85.parameters={\nradius:radius,\nwidthSegments:widthSegments,\nheightSegments:heightSegments,\nphiStart:phiStart,\nphiLength:phiLength,\nthetaStart:thetaStart,\nthetaLength:thetaLength};\n\n\nwidthSegments=Math.max(3,Math.floor(widthSegments));\nheightSegments=Math.max(2,Math.floor(heightSegments));\n\nvar thetaEnd=Math.min(thetaStart+thetaLength,Math.PI);\n\nvar index=0;\nvar grid=[];\n\nvar vertex=new Vector3();\nvar normal=new Vector3();\n\n// buffers\n\nvar indices=[];\nvar vertices=[];\nvar normals=[];\nvar uvs=[];\n\n// generate vertices, normals and uvs\n\nfor(var iy=0;iy<=heightSegments;iy++){\n\nvar verticesRow=[];\n\nvar v=iy/heightSegments;\n\n// special case for the poles\n\nvar uOffset=0;\n\nif(iy==0&&thetaStart==0){\n\nuOffset=0.5/widthSegments;\n\n}else if(iy==heightSegments&&thetaEnd==Math.PI){\n\nuOffset=-0.5/widthSegments;\n\n}\n\nfor(var ix=0;ix<=widthSegments;ix++){\n\nvar u=ix/widthSegments;\n\n// vertex\n\nvertex.x=-radius*Math.cos(phiStart+u*phiLength)*Math.sin(thetaStart+v*thetaLength);\nvertex.y=radius*Math.cos(thetaStart+v*thetaLength);\nvertex.z=radius*Math.sin(phiStart+u*phiLength)*Math.sin(thetaStart+v*thetaLength);\n\nvertices.push(vertex.x,vertex.y,vertex.z);\n\n// normal\n\nnormal.copy(vertex).normalize();\nnormals.push(normal.x,normal.y,normal.z);\n\n// uv\n\nuvs.push(u+uOffset,1-v);\n\nverticesRow.push(index++);\n\n}\n\ngrid.push(verticesRow);\n\n}\n\n// indices\n\nfor(var _iy3=0;_iy3<heightSegments;_iy3++){\n\nfor(var _ix3=0;_ix3<widthSegments;_ix3++){\n\nvar a=grid[_iy3][_ix3+1];\nvar b=grid[_iy3][_ix3];\nvar c=grid[_iy3+1][_ix3];\nvar d=grid[_iy3+1][_ix3+1];\n\nif(_iy3!==0||thetaStart>0)indices.push(a,b,d);\nif(_iy3!==heightSegments-1||thetaEnd<Math.PI)indices.push(b,c,d);\n\n}\n\n}\n\n// build geometry\n\n_this85.setIndex(indices);\n_this85.setAttribute('position',new Float32BufferAttribute(vertices,3));\n_this85.setAttribute('normal',new Float32BufferAttribute(normals,3));\n_this85.setAttribute('uv',new Float32BufferAttribute(uvs,2));return _this85;\n\n}_createClass(SphereGeometry,null,[{key:'fromJSON',value:function fromJSON(\n\ndata){\n\nreturn new SphereGeometry(data.radius,data.widthSegments,data.heightSegments,data.phiStart,data.phiLength,data.thetaStart,data.thetaLength);\n\n}}]);return SphereGeometry;}(BufferGeometry);var\n\n\n\nTetrahedronGeometry=function(_PolyhedronGeometry4){_inherits(TetrahedronGeometry,_PolyhedronGeometry4);\n\nfunction TetrahedronGeometry(){var radius=arguments.length>0&&arguments[0]!==undefined?arguments[0]:1;var detail=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;_classCallCheck(this,TetrahedronGeometry);\n\nvar vertices=[\n1,1,1,-1,-1,1,-1,1,-1,1,-1,-1];\n\n\nvar indices=[\n2,1,0,0,3,2,1,3,0,2,3,1];var _this86=_possibleConstructorReturn(this,(TetrahedronGeometry.__proto__||Object.getPrototypeOf(TetrahedronGeometry)).call(this,\n\n\nvertices,indices,radius,detail));\n\n_this86.type='TetrahedronGeometry';\n\n_this86.parameters={\nradius:radius,\ndetail:detail};return _this86;\n\n\n}_createClass(TetrahedronGeometry,null,[{key:'fromJSON',value:function fromJSON(\n\ndata){\n\nreturn new TetrahedronGeometry(data.radius,data.detail);\n\n}}]);return TetrahedronGeometry;}(PolyhedronGeometry);var\n\n\n\nTorusGeometry=function(_BufferGeometry12){_inherits(TorusGeometry,_BufferGeometry12);\n\nfunction TorusGeometry(){var radius=arguments.length>0&&arguments[0]!==undefined?arguments[0]:1;var tube=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0.4;var radialSegments=arguments.length>2&&arguments[2]!==undefined?arguments[2]:8;var tubularSegments=arguments.length>3&&arguments[3]!==undefined?arguments[3]:6;var arc=arguments.length>4&&arguments[4]!==undefined?arguments[4]:Math.PI*2;_classCallCheck(this,TorusGeometry);var _this87=_possibleConstructorReturn(this,(TorusGeometry.__proto__||Object.getPrototypeOf(TorusGeometry)).call(this));\n\n\n_this87.type='TorusGeometry';\n\n_this87.parameters={\nradius:radius,\ntube:tube,\nradialSegments:radialSegments,\ntubularSegments:tubularSegments,\narc:arc};\n\n\nradialSegments=Math.floor(radialSegments);\ntubularSegments=Math.floor(tubularSegments);\n\n// buffers\n\nvar indices=[];\nvar vertices=[];\nvar normals=[];\nvar uvs=[];\n\n// helper variables\n\nvar center=new Vector3();\nvar vertex=new Vector3();\nvar normal=new Vector3();\n\n// generate vertices, normals and uvs\n\nfor(var j=0;j<=radialSegments;j++){\n\nfor(var i=0;i<=tubularSegments;i++){\n\nvar u=i/tubularSegments*arc;\nvar v=j/radialSegments*Math.PI*2;\n\n// vertex\n\nvertex.x=(radius+tube*Math.cos(v))*Math.cos(u);\nvertex.y=(radius+tube*Math.cos(v))*Math.sin(u);\nvertex.z=tube*Math.sin(v);\n\nvertices.push(vertex.x,vertex.y,vertex.z);\n\n// normal\n\ncenter.x=radius*Math.cos(u);\ncenter.y=radius*Math.sin(u);\nnormal.subVectors(vertex,center).normalize();\n\nnormals.push(normal.x,normal.y,normal.z);\n\n// uv\n\nuvs.push(i/tubularSegments);\nuvs.push(j/radialSegments);\n\n}\n\n}\n\n// generate indices\n\nfor(var _j11=1;_j11<=radialSegments;_j11++){\n\nfor(var _i78=1;_i78<=tubularSegments;_i78++){\n\n// indices\n\nvar a=(tubularSegments+1)*_j11+_i78-1;\nvar b=(tubularSegments+1)*(_j11-1)+_i78-1;\nvar c=(tubularSegments+1)*(_j11-1)+_i78;\nvar d=(tubularSegments+1)*_j11+_i78;\n\n// faces\n\nindices.push(a,b,d);\nindices.push(b,c,d);\n\n}\n\n}\n\n// build geometry\n\n_this87.setIndex(indices);\n_this87.setAttribute('position',new Float32BufferAttribute(vertices,3));\n_this87.setAttribute('normal',new Float32BufferAttribute(normals,3));\n_this87.setAttribute('uv',new Float32BufferAttribute(uvs,2));return _this87;\n\n}_createClass(TorusGeometry,null,[{key:'fromJSON',value:function fromJSON(\n\ndata){\n\nreturn new TorusGeometry(data.radius,data.tube,data.radialSegments,data.tubularSegments,data.arc);\n\n}}]);return TorusGeometry;}(BufferGeometry);var\n\n\n\nTorusKnotGeometry=function(_BufferGeometry13){_inherits(TorusKnotGeometry,_BufferGeometry13);\n\nfunction TorusKnotGeometry(){var radius=arguments.length>0&&arguments[0]!==undefined?arguments[0]:1;var tube=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0.4;var tubularSegments=arguments.length>2&&arguments[2]!==undefined?arguments[2]:64;var radialSegments=arguments.length>3&&arguments[3]!==undefined?arguments[3]:8;var p=arguments.length>4&&arguments[4]!==undefined?arguments[4]:2;var q=arguments.length>5&&arguments[5]!==undefined?arguments[5]:3;_classCallCheck(this,TorusKnotGeometry);var _this88=_possibleConstructorReturn(this,(TorusKnotGeometry.__proto__||Object.getPrototypeOf(TorusKnotGeometry)).call(this));\n\n\n_this88.type='TorusKnotGeometry';\n\n_this88.parameters={\nradius:radius,\ntube:tube,\ntubularSegments:tubularSegments,\nradialSegments:radialSegments,\np:p,\nq:q};\n\n\ntubularSegments=Math.floor(tubularSegments);\nradialSegments=Math.floor(radialSegments);\n\n// buffers\n\nvar indices=[];\nvar vertices=[];\nvar normals=[];\nvar uvs=[];\n\n// helper variables\n\nvar vertex=new Vector3();\nvar normal=new Vector3();\n\nvar P1=new Vector3();\nvar P2=new Vector3();\n\nvar B=new Vector3();\nvar T=new Vector3();\nvar N=new Vector3();\n\n// generate vertices, normals and uvs\n\nfor(var i=0;i<=tubularSegments;++i){\n\n// the radian \"u\" is used to calculate the position on the torus curve of the current tubular segment\n\nvar u=i/tubularSegments*p*Math.PI*2;\n\n// now we calculate two points. P1 is our current position on the curve, P2 is a little farther ahead.\n// these points are used to create a special \"coordinate space\", which is necessary to calculate the correct vertex positions\n\ncalculatePositionOnCurve(u,p,q,radius,P1);\ncalculatePositionOnCurve(u+0.01,p,q,radius,P2);\n\n// calculate orthonormal basis\n\nT.subVectors(P2,P1);\nN.addVectors(P2,P1);\nB.crossVectors(T,N);\nN.crossVectors(B,T);\n\n// normalize B, N. T can be ignored, we don't use it\n\nB.normalize();\nN.normalize();\n\nfor(var j=0;j<=radialSegments;++j){\n\n// now calculate the vertices. they are nothing more than an extrusion of the torus curve.\n// because we extrude a shape in the xy-plane, there is no need to calculate a z-value.\n\nvar v=j/radialSegments*Math.PI*2;\nvar cx=-tube*Math.cos(v);\nvar cy=tube*Math.sin(v);\n\n// now calculate the final vertex position.\n// first we orient the extrusion with our basis vectors, then we add it to the current position on the curve\n\nvertex.x=P1.x+(cx*N.x+cy*B.x);\nvertex.y=P1.y+(cx*N.y+cy*B.y);\nvertex.z=P1.z+(cx*N.z+cy*B.z);\n\nvertices.push(vertex.x,vertex.y,vertex.z);\n\n// normal (P1 is always the center/origin of the extrusion, thus we can use it to calculate the normal)\n\nnormal.subVectors(vertex,P1).normalize();\n\nnormals.push(normal.x,normal.y,normal.z);\n\n// uv\n\nuvs.push(i/tubularSegments);\nuvs.push(j/radialSegments);\n\n}\n\n}\n\n// generate indices\n\nfor(var _j12=1;_j12<=tubularSegments;_j12++){\n\nfor(var _i79=1;_i79<=radialSegments;_i79++){\n\n// indices\n\nvar a=(radialSegments+1)*(_j12-1)+(_i79-1);\nvar b=(radialSegments+1)*_j12+(_i79-1);\nvar c=(radialSegments+1)*_j12+_i79;\nvar d=(radialSegments+1)*(_j12-1)+_i79;\n\n// faces\n\nindices.push(a,b,d);\nindices.push(b,c,d);\n\n}\n\n}\n\n// build geometry\n\n_this88.setIndex(indices);\n_this88.setAttribute('position',new Float32BufferAttribute(vertices,3));\n_this88.setAttribute('normal',new Float32BufferAttribute(normals,3));\n_this88.setAttribute('uv',new Float32BufferAttribute(uvs,2));\n\n// this function calculates the current position on the torus curve\n\nfunction calculatePositionOnCurve(u,p,q,radius,position){\n\nvar cu=Math.cos(u);\nvar su=Math.sin(u);\nvar quOverP=q/p*u;\nvar cs=Math.cos(quOverP);\n\nposition.x=radius*(2+cs)*0.5*cu;\nposition.y=radius*(2+cs)*su*0.5;\nposition.z=radius*Math.sin(quOverP)*0.5;\n\n}return _this88;\n\n}_createClass(TorusKnotGeometry,null,[{key:'fromJSON',value:function fromJSON(\n\ndata){\n\nreturn new TorusKnotGeometry(data.radius,data.tube,data.tubularSegments,data.radialSegments,data.p,data.q);\n\n}}]);return TorusKnotGeometry;}(BufferGeometry);var\n\n\n\nTubeGeometry=function(_BufferGeometry14){_inherits(TubeGeometry,_BufferGeometry14);\n\nfunction TubeGeometry(){var path=arguments.length>0&&arguments[0]!==undefined?arguments[0]:new QuadraticBezierCurve3(new Vector3(-1,-1,0),new Vector3(-1,1,0),new Vector3(1,1,0));var tubularSegments=arguments.length>1&&arguments[1]!==undefined?arguments[1]:64;var radius=arguments.length>2&&arguments[2]!==undefined?arguments[2]:1;var radialSegments=arguments.length>3&&arguments[3]!==undefined?arguments[3]:8;var closed=arguments.length>4&&arguments[4]!==undefined?arguments[4]:false;_classCallCheck(this,TubeGeometry);var _this89=_possibleConstructorReturn(this,(TubeGeometry.__proto__||Object.getPrototypeOf(TubeGeometry)).call(this));\n\n\n_this89.type='TubeGeometry';\n\n_this89.parameters={\npath:path,\ntubularSegments:tubularSegments,\nradius:radius,\nradialSegments:radialSegments,\nclosed:closed};\n\n\nvar frames=path.computeFrenetFrames(tubularSegments,closed);\n\n// expose internals\n\n_this89.tangents=frames.tangents;\n_this89.normals=frames.normals;\n_this89.binormals=frames.binormals;\n\n// helper variables\n\nvar vertex=new Vector3();\nvar normal=new Vector3();\nvar uv=new Vector2();\nvar P=new Vector3();\n\n// buffer\n\nvar vertices=[];\nvar normals=[];\nvar uvs=[];\nvar indices=[];\n\n// create buffer data\n\ngenerateBufferData();\n\n// build geometry\n\n_this89.setIndex(indices);\n_this89.setAttribute('position',new Float32BufferAttribute(vertices,3));\n_this89.setAttribute('normal',new Float32BufferAttribute(normals,3));\n_this89.setAttribute('uv',new Float32BufferAttribute(uvs,2));\n\n// functions\n\nfunction generateBufferData(){\n\nfor(var i=0;i<tubularSegments;i++){\n\ngenerateSegment(i);\n\n}\n\n// if the geometry is not closed, generate the last row of vertices and normals\n// at the regular position on the given path\n//\n// if the geometry is closed, duplicate the first row of vertices and normals (uvs will differ)\n\ngenerateSegment(closed===false?tubularSegments:0);\n\n// uvs are generated in a separate function.\n// this makes it easy compute correct values for closed geometries\n\ngenerateUVs();\n\n// finally create faces\n\ngenerateIndices();\n\n}\n\nfunction generateSegment(i){\n\n// we use getPointAt to sample evenly distributed points from the given path\n\nP=path.getPointAt(i/tubularSegments,P);\n\n// retrieve corresponding normal and binormal\n\nvar N=frames.normals[i];\nvar B=frames.binormals[i];\n\n// generate normals and vertices for the current segment\n\nfor(var j=0;j<=radialSegments;j++){\n\nvar v=j/radialSegments*Math.PI*2;\n\nvar sin=Math.sin(v);\nvar cos=-Math.cos(v);\n\n// normal\n\nnormal.x=cos*N.x+sin*B.x;\nnormal.y=cos*N.y+sin*B.y;\nnormal.z=cos*N.z+sin*B.z;\nnormal.normalize();\n\nnormals.push(normal.x,normal.y,normal.z);\n\n// vertex\n\nvertex.x=P.x+radius*normal.x;\nvertex.y=P.y+radius*normal.y;\nvertex.z=P.z+radius*normal.z;\n\nvertices.push(vertex.x,vertex.y,vertex.z);\n\n}\n\n}\n\nfunction generateIndices(){\n\nfor(var j=1;j<=tubularSegments;j++){\n\nfor(var i=1;i<=radialSegments;i++){\n\nvar a=(radialSegments+1)*(j-1)+(i-1);\nvar b=(radialSegments+1)*j+(i-1);\nvar c=(radialSegments+1)*j+i;\nvar d=(radialSegments+1)*(j-1)+i;\n\n// faces\n\nindices.push(a,b,d);\nindices.push(b,c,d);\n\n}\n\n}\n\n}\n\nfunction generateUVs(){\n\nfor(var i=0;i<=tubularSegments;i++){\n\nfor(var j=0;j<=radialSegments;j++){\n\nuv.x=i/tubularSegments;\nuv.y=j/radialSegments;\n\nuvs.push(uv.x,uv.y);\n\n}\n\n}\n\n}return _this89;\n\n}_createClass(TubeGeometry,[{key:'toJSON',value:function toJSON()\n\n{\n\nvar data=_get(TubeGeometry.prototype.__proto__||Object.getPrototypeOf(TubeGeometry.prototype),'toJSON',this).call(this);\n\ndata.path=this.parameters.path.toJSON();\n\nreturn data;\n\n}}],[{key:'fromJSON',value:function fromJSON(\n\ndata){\n\n// This only works for built-in curves (e.g. CatmullRomCurve3).\n// User defined curves or instances of CurvePath will not be deserialized.\nreturn new TubeGeometry(\nnew Curves[data.path.type]().fromJSON(data.path),\ndata.tubularSegments,\ndata.radius,\ndata.radialSegments,\ndata.closed);\n\n\n}}]);return TubeGeometry;}(BufferGeometry);var\n\n\n\nWireframeGeometry=function(_BufferGeometry15){_inherits(WireframeGeometry,_BufferGeometry15);\n\nfunction WireframeGeometry(){var geometry=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;_classCallCheck(this,WireframeGeometry);var _this90=_possibleConstructorReturn(this,(WireframeGeometry.__proto__||Object.getPrototypeOf(WireframeGeometry)).call(this));\n\n\n_this90.type='WireframeGeometry';\n\n_this90.parameters={\ngeometry:geometry};\n\n\nif(geometry!==null){\n\n// buffer\n\nvar _vertices3=[];\nvar edges=new Set();\n\n// helper variables\n\nvar start=new Vector3();\nvar end=new Vector3();\n\nif(geometry.index!==null){\n\n// indexed BufferGeometry\n\nvar position=geometry.attributes.position;\nvar _indices=geometry.index;\nvar groups=geometry.groups;\n\nif(groups.length===0){\n\ngroups=[{start:0,count:_indices.count,materialIndex:0}];\n\n}\n\n// create a data structure that contains all edges without duplicates\n\nfor(var o=0,ol=groups.length;o<ol;++o){\n\nvar group=groups[o];\n\nvar _groupStart=group.start;\nvar _groupCount=group.count;\n\nfor(var i=_groupStart,l=_groupStart+_groupCount;i<l;i+=3){\n\nfor(var j=0;j<3;j++){\n\nvar index1=_indices.getX(i+j);\nvar index2=_indices.getX(i+(j+1)%3);\n\nstart.fromBufferAttribute(position,index1);\nend.fromBufferAttribute(position,index2);\n\nif(isUniqueEdge(start,end,edges)===true){\n\n_vertices3.push(start.x,start.y,start.z);\n_vertices3.push(end.x,end.y,end.z);\n\n}\n\n}\n\n}\n\n}\n\n}else{\n\n// non-indexed BufferGeometry\n\nvar _position2=geometry.attributes.position;\n\nfor(var _i80=0,_l11=_position2.count/3;_i80<_l11;_i80++){\n\nfor(var _j13=0;_j13<3;_j13++){\n\n// three edges per triangle, an edge is represented as (index1, index2)\n// e.g. the first triangle has the following edges: (0,1),(1,2),(2,0)\n\nvar _index=3*_i80+_j13;\nvar _index2=3*_i80+(_j13+1)%3;\n\nstart.fromBufferAttribute(_position2,_index);\nend.fromBufferAttribute(_position2,_index2);\n\nif(isUniqueEdge(start,end,edges)===true){\n\n_vertices3.push(start.x,start.y,start.z);\n_vertices3.push(end.x,end.y,end.z);\n\n}\n\n}\n\n}\n\n}\n\n// build geometry\n\n_this90.setAttribute('position',new Float32BufferAttribute(_vertices3,3));\n\n}return _this90;\n\n}return WireframeGeometry;}(BufferGeometry);\n\n\n\nfunction isUniqueEdge(start,end,edges){\n\nvar hash1=start.x+','+start.y+','+start.z+'-'+end.x+','+end.y+','+end.z;\nvar hash2=end.x+','+end.y+','+end.z+'-'+start.x+','+start.y+','+start.z;// coincident edge\n\nif(edges.has(hash1)===true||edges.has(hash2)===true){\n\nreturn false;\n\n}else{\n\nedges.add(hash1);\nedges.add(hash2);\nreturn true;\n\n}\n\n}\n\nvar Geometries=/*#__PURE__*/Object.freeze({\n__proto__:null,\nBoxGeometry:BoxGeometry,\nBoxBufferGeometry:BoxGeometry,\nCapsuleGeometry:CapsuleGeometry,\nCapsuleBufferGeometry:CapsuleGeometry,\nCircleGeometry:CircleGeometry,\nCircleBufferGeometry:CircleGeometry,\nConeGeometry:ConeGeometry,\nConeBufferGeometry:ConeGeometry,\nCylinderGeometry:CylinderGeometry,\nCylinderBufferGeometry:CylinderGeometry,\nDodecahedronGeometry:DodecahedronGeometry,\nDodecahedronBufferGeometry:DodecahedronGeometry,\nEdgesGeometry:EdgesGeometry,\nExtrudeGeometry:ExtrudeGeometry,\nExtrudeBufferGeometry:ExtrudeGeometry,\nIcosahedronGeometry:IcosahedronGeometry,\nIcosahedronBufferGeometry:IcosahedronGeometry,\nLatheGeometry:LatheGeometry,\nLatheBufferGeometry:LatheGeometry,\nOctahedronGeometry:OctahedronGeometry,\nOctahedronBufferGeometry:OctahedronGeometry,\nPlaneGeometry:PlaneGeometry,\nPlaneBufferGeometry:PlaneGeometry,\nPolyhedronGeometry:PolyhedronGeometry,\nPolyhedronBufferGeometry:PolyhedronGeometry,\nRingGeometry:RingGeometry,\nRingBufferGeometry:RingGeometry,\nShapeGeometry:ShapeGeometry,\nShapeBufferGeometry:ShapeGeometry,\nSphereGeometry:SphereGeometry,\nSphereBufferGeometry:SphereGeometry,\nTetrahedronGeometry:TetrahedronGeometry,\nTetrahedronBufferGeometry:TetrahedronGeometry,\nTorusGeometry:TorusGeometry,\nTorusBufferGeometry:TorusGeometry,\nTorusKnotGeometry:TorusKnotGeometry,\nTorusKnotBufferGeometry:TorusKnotGeometry,\nTubeGeometry:TubeGeometry,\nTubeBufferGeometry:TubeGeometry,\nWireframeGeometry:WireframeGeometry});var\n\n\nShadowMaterial=function(_Material8){_inherits(ShadowMaterial,_Material8);\n\nfunction ShadowMaterial(parameters){_classCallCheck(this,ShadowMaterial);var _this91=_possibleConstructorReturn(this,(ShadowMaterial.__proto__||Object.getPrototypeOf(ShadowMaterial)).call(this));\n\n\n\n_this91.isShadowMaterial=true;\n\n_this91.type='ShadowMaterial';\n\n_this91.color=new Color(0x000000);\n_this91.transparent=true;\n\n_this91.fog=true;\n\n_this91.setValues(parameters);return _this91;\n\n}_createClass(ShadowMaterial,[{key:'copy',value:function copy(\n\nsource){\n\n_get(ShadowMaterial.prototype.__proto__||Object.getPrototypeOf(ShadowMaterial.prototype),'copy',this).call(this,source);\n\nthis.color.copy(source.color);\n\nthis.fog=source.fog;\n\nreturn this;\n\n}}]);return ShadowMaterial;}(Material);var\n\n\n\nRawShaderMaterial=function(_ShaderMaterial){_inherits(RawShaderMaterial,_ShaderMaterial);\n\nfunction RawShaderMaterial(parameters){_classCallCheck(this,RawShaderMaterial);var _this92=_possibleConstructorReturn(this,(RawShaderMaterial.__proto__||Object.getPrototypeOf(RawShaderMaterial)).call(this,\n\nparameters));\n\n_this92.isRawShaderMaterial=true;\n\n_this92.type='RawShaderMaterial';return _this92;\n\n}return RawShaderMaterial;}(ShaderMaterial);var\n\n\n\nMeshStandardMaterial=function(_Material9){_inherits(MeshStandardMaterial,_Material9);\n\nfunction MeshStandardMaterial(parameters){_classCallCheck(this,MeshStandardMaterial);var _this93=_possibleConstructorReturn(this,(MeshStandardMaterial.__proto__||Object.getPrototypeOf(MeshStandardMaterial)).call(this));\n\n\n\n_this93.isMeshStandardMaterial=true;\n\n_this93.defines={'STANDARD':''};\n\n_this93.type='MeshStandardMaterial';\n\n_this93.color=new Color(0xffffff);// diffuse\n_this93.roughness=1.0;\n_this93.metalness=0.0;\n\n_this93.map=null;\n\n_this93.lightMap=null;\n_this93.lightMapIntensity=1.0;\n\n_this93.aoMap=null;\n_this93.aoMapIntensity=1.0;\n\n_this93.emissive=new Color(0x000000);\n_this93.emissiveIntensity=1.0;\n_this93.emissiveMap=null;\n\n_this93.bumpMap=null;\n_this93.bumpScale=1;\n\n_this93.normalMap=null;\n_this93.normalMapType=TangentSpaceNormalMap;\n_this93.normalScale=new Vector2(1,1);\n\n_this93.displacementMap=null;\n_this93.displacementScale=1;\n_this93.displacementBias=0;\n\n_this93.roughnessMap=null;\n\n_this93.metalnessMap=null;\n\n_this93.alphaMap=null;\n\n_this93.envMap=null;\n_this93.envMapIntensity=1.0;\n\n_this93.wireframe=false;\n_this93.wireframeLinewidth=1;\n_this93.wireframeLinecap='round';\n_this93.wireframeLinejoin='round';\n\n_this93.flatShading=false;\n\n_this93.fog=true;\n\n_this93.setValues(parameters);return _this93;\n\n}_createClass(MeshStandardMaterial,[{key:'copy',value:function copy(\n\nsource){\n\n_get(MeshStandardMaterial.prototype.__proto__||Object.getPrototypeOf(MeshStandardMaterial.prototype),'copy',this).call(this,source);\n\nthis.defines={'STANDARD':''};\n\nthis.color.copy(source.color);\nthis.roughness=source.roughness;\nthis.metalness=source.metalness;\n\nthis.map=source.map;\n\nthis.lightMap=source.lightMap;\nthis.lightMapIntensity=source.lightMapIntensity;\n\nthis.aoMap=source.aoMap;\nthis.aoMapIntensity=source.aoMapIntensity;\n\nthis.emissive.copy(source.emissive);\nthis.emissiveMap=source.emissiveMap;\nthis.emissiveIntensity=source.emissiveIntensity;\n\nthis.bumpMap=source.bumpMap;\nthis.bumpScale=source.bumpScale;\n\nthis.normalMap=source.normalMap;\nthis.normalMapType=source.normalMapType;\nthis.normalScale.copy(source.normalScale);\n\nthis.displacementMap=source.displacementMap;\nthis.displacementScale=source.displacementScale;\nthis.displacementBias=source.displacementBias;\n\nthis.roughnessMap=source.roughnessMap;\n\nthis.metalnessMap=source.metalnessMap;\n\nthis.alphaMap=source.alphaMap;\n\nthis.envMap=source.envMap;\nthis.envMapIntensity=source.envMapIntensity;\n\nthis.wireframe=source.wireframe;\nthis.wireframeLinewidth=source.wireframeLinewidth;\nthis.wireframeLinecap=source.wireframeLinecap;\nthis.wireframeLinejoin=source.wireframeLinejoin;\n\nthis.flatShading=source.flatShading;\n\nthis.fog=source.fog;\n\nreturn this;\n\n}}]);return MeshStandardMaterial;}(Material);var\n\n\n\nMeshPhysicalMaterial=function(_MeshStandardMaterial){_inherits(MeshPhysicalMaterial,_MeshStandardMaterial);\n\nfunction MeshPhysicalMaterial(parameters){_classCallCheck(this,MeshPhysicalMaterial);var _this94=_possibleConstructorReturn(this,(MeshPhysicalMaterial.__proto__||Object.getPrototypeOf(MeshPhysicalMaterial)).call(this));\n\n\n\n_this94.isMeshPhysicalMaterial=true;\n\n_this94.defines={\n\n'STANDARD':'',\n'PHYSICAL':''};\n\n\n\n_this94.type='MeshPhysicalMaterial';\n\n_this94.clearcoatMap=null;\n_this94.clearcoatRoughness=0.0;\n_this94.clearcoatRoughnessMap=null;\n_this94.clearcoatNormalScale=new Vector2(1,1);\n_this94.clearcoatNormalMap=null;\n\n_this94.ior=1.5;\n\nObject.defineProperty(_this94,'reflectivity',{\nget:function get(){\n\nreturn clamp(2.5*(this.ior-1)/(this.ior+1),0,1);\n\n},\nset:function set(reflectivity){\n\nthis.ior=(1+0.4*reflectivity)/(1-0.4*reflectivity);\n\n}});\n\n\n_this94.iridescenceMap=null;\n_this94.iridescenceIOR=1.3;\n_this94.iridescenceThicknessRange=[100,400];\n_this94.iridescenceThicknessMap=null;\n\n_this94.sheenColor=new Color(0x000000);\n_this94.sheenColorMap=null;\n_this94.sheenRoughness=1.0;\n_this94.sheenRoughnessMap=null;\n\n_this94.transmissionMap=null;\n\n_this94.thickness=0;\n_this94.thicknessMap=null;\n_this94.attenuationDistance=0.0;\n_this94.attenuationColor=new Color(1,1,1);\n\n_this94.specularIntensity=1.0;\n_this94.specularIntensityMap=null;\n_this94.specularColor=new Color(1,1,1);\n_this94.specularColorMap=null;\n\n_this94._sheen=0.0;\n_this94._clearcoat=0;\n_this94._iridescence=0;\n_this94._transmission=0;\n\n_this94.setValues(parameters);return _this94;\n\n}_createClass(MeshPhysicalMaterial,[{key:'copy',value:function copy(\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nsource){\n\n_get(MeshPhysicalMaterial.prototype.__proto__||Object.getPrototypeOf(MeshPhysicalMaterial.prototype),'copy',this).call(this,source);\n\nthis.defines={\n\n'STANDARD':'',\n'PHYSICAL':''};\n\n\n\nthis.clearcoat=source.clearcoat;\nthis.clearcoatMap=source.clearcoatMap;\nthis.clearcoatRoughness=source.clearcoatRoughness;\nthis.clearcoatRoughnessMap=source.clearcoatRoughnessMap;\nthis.clearcoatNormalMap=source.clearcoatNormalMap;\nthis.clearcoatNormalScale.copy(source.clearcoatNormalScale);\n\nthis.ior=source.ior;\n\nthis.iridescence=source.iridescence;\nthis.iridescenceMap=source.iridescenceMap;\nthis.iridescenceIOR=source.iridescenceIOR;\nthis.iridescenceThicknessRange=[].concat(_toConsumableArray(source.iridescenceThicknessRange));\nthis.iridescenceThicknessMap=source.iridescenceThicknessMap;\n\nthis.sheen=source.sheen;\nthis.sheenColor.copy(source.sheenColor);\nthis.sheenColorMap=source.sheenColorMap;\nthis.sheenRoughness=source.sheenRoughness;\nthis.sheenRoughnessMap=source.sheenRoughnessMap;\n\nthis.transmission=source.transmission;\nthis.transmissionMap=source.transmissionMap;\n\nthis.thickness=source.thickness;\nthis.thicknessMap=source.thicknessMap;\nthis.attenuationDistance=source.attenuationDistance;\nthis.attenuationColor.copy(source.attenuationColor);\n\nthis.specularIntensity=source.specularIntensity;\nthis.specularIntensityMap=source.specularIntensityMap;\nthis.specularColor.copy(source.specularColor);\nthis.specularColorMap=source.specularColorMap;\n\nreturn this;\n\n}},{key:'sheen',get:function get(){return this._sheen;},set:function set(value){if(this._sheen>0!==value>0){this.version++;}this._sheen=value;}},{key:'clearcoat',get:function get(){return this._clearcoat;},set:function set(value){if(this._clearcoat>0!==value>0){this.version++;}this._clearcoat=value;}},{key:'iridescence',get:function get(){return this._iridescence;},set:function set(value){if(this._iridescence>0!==value>0){this.version++;}this._iridescence=value;}},{key:'transmission',get:function get(){return this._transmission;},set:function set(value){if(this._transmission>0!==value>0){this.version++;}this._transmission=value;}}]);return MeshPhysicalMaterial;}(MeshStandardMaterial);var\n\n\n\nMeshPhongMaterial=function(_Material10){_inherits(MeshPhongMaterial,_Material10);\n\nfunction MeshPhongMaterial(parameters){_classCallCheck(this,MeshPhongMaterial);var _this95=_possibleConstructorReturn(this,(MeshPhongMaterial.__proto__||Object.getPrototypeOf(MeshPhongMaterial)).call(this));\n\n\n\n_this95.isMeshPhongMaterial=true;\n\n_this95.type='MeshPhongMaterial';\n\n_this95.color=new Color(0xffffff);// diffuse\n_this95.specular=new Color(0x111111);\n_this95.shininess=30;\n\n_this95.map=null;\n\n_this95.lightMap=null;\n_this95.lightMapIntensity=1.0;\n\n_this95.aoMap=null;\n_this95.aoMapIntensity=1.0;\n\n_this95.emissive=new Color(0x000000);\n_this95.emissiveIntensity=1.0;\n_this95.emissiveMap=null;\n\n_this95.bumpMap=null;\n_this95.bumpScale=1;\n\n_this95.normalMap=null;\n_this95.normalMapType=TangentSpaceNormalMap;\n_this95.normalScale=new Vector2(1,1);\n\n_this95.displacementMap=null;\n_this95.displacementScale=1;\n_this95.displacementBias=0;\n\n_this95.specularMap=null;\n\n_this95.alphaMap=null;\n\n_this95.envMap=null;\n_this95.combine=MultiplyOperation;\n_this95.reflectivity=1;\n_this95.refractionRatio=0.98;\n\n_this95.wireframe=false;\n_this95.wireframeLinewidth=1;\n_this95.wireframeLinecap='round';\n_this95.wireframeLinejoin='round';\n\n_this95.flatShading=false;\n\n_this95.fog=true;\n\n_this95.setValues(parameters);return _this95;\n\n}_createClass(MeshPhongMaterial,[{key:'copy',value:function copy(\n\nsource){\n\n_get(MeshPhongMaterial.prototype.__proto__||Object.getPrototypeOf(MeshPhongMaterial.prototype),'copy',this).call(this,source);\n\nthis.color.copy(source.color);\nthis.specular.copy(source.specular);\nthis.shininess=source.shininess;\n\nthis.map=source.map;\n\nthis.lightMap=source.lightMap;\nthis.lightMapIntensity=source.lightMapIntensity;\n\nthis.aoMap=source.aoMap;\nthis.aoMapIntensity=source.aoMapIntensity;\n\nthis.emissive.copy(source.emissive);\nthis.emissiveMap=source.emissiveMap;\nthis.emissiveIntensity=source.emissiveIntensity;\n\nthis.bumpMap=source.bumpMap;\nthis.bumpScale=source.bumpScale;\n\nthis.normalMap=source.normalMap;\nthis.normalMapType=source.normalMapType;\nthis.normalScale.copy(source.normalScale);\n\nthis.displacementMap=source.displacementMap;\nthis.displacementScale=source.displacementScale;\nthis.displacementBias=source.displacementBias;\n\nthis.specularMap=source.specularMap;\n\nthis.alphaMap=source.alphaMap;\n\nthis.envMap=source.envMap;\nthis.combine=source.combine;\nthis.reflectivity=source.reflectivity;\nthis.refractionRatio=source.refractionRatio;\n\nthis.wireframe=source.wireframe;\nthis.wireframeLinewidth=source.wireframeLinewidth;\nthis.wireframeLinecap=source.wireframeLinecap;\nthis.wireframeLinejoin=source.wireframeLinejoin;\n\nthis.flatShading=source.flatShading;\n\nthis.fog=source.fog;\n\nreturn this;\n\n}}]);return MeshPhongMaterial;}(Material);var\n\n\n\nMeshToonMaterial=function(_Material11){_inherits(MeshToonMaterial,_Material11);\n\nfunction MeshToonMaterial(parameters){_classCallCheck(this,MeshToonMaterial);var _this96=_possibleConstructorReturn(this,(MeshToonMaterial.__proto__||Object.getPrototypeOf(MeshToonMaterial)).call(this));\n\n\n\n_this96.isMeshToonMaterial=true;\n\n_this96.defines={'TOON':''};\n\n_this96.type='MeshToonMaterial';\n\n_this96.color=new Color(0xffffff);\n\n_this96.map=null;\n_this96.gradientMap=null;\n\n_this96.lightMap=null;\n_this96.lightMapIntensity=1.0;\n\n_this96.aoMap=null;\n_this96.aoMapIntensity=1.0;\n\n_this96.emissive=new Color(0x000000);\n_this96.emissiveIntensity=1.0;\n_this96.emissiveMap=null;\n\n_this96.bumpMap=null;\n_this96.bumpScale=1;\n\n_this96.normalMap=null;\n_this96.normalMapType=TangentSpaceNormalMap;\n_this96.normalScale=new Vector2(1,1);\n\n_this96.displacementMap=null;\n_this96.displacementScale=1;\n_this96.displacementBias=0;\n\n_this96.alphaMap=null;\n\n_this96.wireframe=false;\n_this96.wireframeLinewidth=1;\n_this96.wireframeLinecap='round';\n_this96.wireframeLinejoin='round';\n\n_this96.fog=true;\n\n_this96.setValues(parameters);return _this96;\n\n}_createClass(MeshToonMaterial,[{key:'copy',value:function copy(\n\nsource){\n\n_get(MeshToonMaterial.prototype.__proto__||Object.getPrototypeOf(MeshToonMaterial.prototype),'copy',this).call(this,source);\n\nthis.color.copy(source.color);\n\nthis.map=source.map;\nthis.gradientMap=source.gradientMap;\n\nthis.lightMap=source.lightMap;\nthis.lightMapIntensity=source.lightMapIntensity;\n\nthis.aoMap=source.aoMap;\nthis.aoMapIntensity=source.aoMapIntensity;\n\nthis.emissive.copy(source.emissive);\nthis.emissiveMap=source.emissiveMap;\nthis.emissiveIntensity=source.emissiveIntensity;\n\nthis.bumpMap=source.bumpMap;\nthis.bumpScale=source.bumpScale;\n\nthis.normalMap=source.normalMap;\nthis.normalMapType=source.normalMapType;\nthis.normalScale.copy(source.normalScale);\n\nthis.displacementMap=source.displacementMap;\nthis.displacementScale=source.displacementScale;\nthis.displacementBias=source.displacementBias;\n\nthis.alphaMap=source.alphaMap;\n\nthis.wireframe=source.wireframe;\nthis.wireframeLinewidth=source.wireframeLinewidth;\nthis.wireframeLinecap=source.wireframeLinecap;\nthis.wireframeLinejoin=source.wireframeLinejoin;\n\nthis.fog=source.fog;\n\nreturn this;\n\n}}]);return MeshToonMaterial;}(Material);var\n\n\n\nMeshNormalMaterial=function(_Material12){_inherits(MeshNormalMaterial,_Material12);\n\nfunction MeshNormalMaterial(parameters){_classCallCheck(this,MeshNormalMaterial);var _this97=_possibleConstructorReturn(this,(MeshNormalMaterial.__proto__||Object.getPrototypeOf(MeshNormalMaterial)).call(this));\n\n\n\n_this97.isMeshNormalMaterial=true;\n\n_this97.type='MeshNormalMaterial';\n\n_this97.bumpMap=null;\n_this97.bumpScale=1;\n\n_this97.normalMap=null;\n_this97.normalMapType=TangentSpaceNormalMap;\n_this97.normalScale=new Vector2(1,1);\n\n_this97.displacementMap=null;\n_this97.displacementScale=1;\n_this97.displacementBias=0;\n\n_this97.wireframe=false;\n_this97.wireframeLinewidth=1;\n\n_this97.flatShading=false;\n\n_this97.setValues(parameters);return _this97;\n\n}_createClass(MeshNormalMaterial,[{key:'copy',value:function copy(\n\nsource){\n\n_get(MeshNormalMaterial.prototype.__proto__||Object.getPrototypeOf(MeshNormalMaterial.prototype),'copy',this).call(this,source);\n\nthis.bumpMap=source.bumpMap;\nthis.bumpScale=source.bumpScale;\n\nthis.normalMap=source.normalMap;\nthis.normalMapType=source.normalMapType;\nthis.normalScale.copy(source.normalScale);\n\nthis.displacementMap=source.displacementMap;\nthis.displacementScale=source.displacementScale;\nthis.displacementBias=source.displacementBias;\n\nthis.wireframe=source.wireframe;\nthis.wireframeLinewidth=source.wireframeLinewidth;\n\nthis.flatShading=source.flatShading;\n\nreturn this;\n\n}}]);return MeshNormalMaterial;}(Material);var\n\n\n\nMeshLambertMaterial=function(_Material13){_inherits(MeshLambertMaterial,_Material13);\n\nfunction MeshLambertMaterial(parameters){_classCallCheck(this,MeshLambertMaterial);var _this98=_possibleConstructorReturn(this,(MeshLambertMaterial.__proto__||Object.getPrototypeOf(MeshLambertMaterial)).call(this));\n\n\n\n_this98.isMeshLambertMaterial=true;\n\n_this98.type='MeshLambertMaterial';\n\n_this98.color=new Color(0xffffff);// diffuse\n\n_this98.map=null;\n\n_this98.lightMap=null;\n_this98.lightMapIntensity=1.0;\n\n_this98.aoMap=null;\n_this98.aoMapIntensity=1.0;\n\n_this98.emissive=new Color(0x000000);\n_this98.emissiveIntensity=1.0;\n_this98.emissiveMap=null;\n\n_this98.specularMap=null;\n\n_this98.alphaMap=null;\n\n_this98.envMap=null;\n_this98.combine=MultiplyOperation;\n_this98.reflectivity=1;\n_this98.refractionRatio=0.98;\n\n_this98.wireframe=false;\n_this98.wireframeLinewidth=1;\n_this98.wireframeLinecap='round';\n_this98.wireframeLinejoin='round';\n\n_this98.fog=true;\n\n_this98.setValues(parameters);return _this98;\n\n}_createClass(MeshLambertMaterial,[{key:'copy',value:function copy(\n\nsource){\n\n_get(MeshLambertMaterial.prototype.__proto__||Object.getPrototypeOf(MeshLambertMaterial.prototype),'copy',this).call(this,source);\n\nthis.color.copy(source.color);\n\nthis.map=source.map;\n\nthis.lightMap=source.lightMap;\nthis.lightMapIntensity=source.lightMapIntensity;\n\nthis.aoMap=source.aoMap;\nthis.aoMapIntensity=source.aoMapIntensity;\n\nthis.emissive.copy(source.emissive);\nthis.emissiveMap=source.emissiveMap;\nthis.emissiveIntensity=source.emissiveIntensity;\n\nthis.specularMap=source.specularMap;\n\nthis.alphaMap=source.alphaMap;\n\nthis.envMap=source.envMap;\nthis.combine=source.combine;\nthis.reflectivity=source.reflectivity;\nthis.refractionRatio=source.refractionRatio;\n\nthis.wireframe=source.wireframe;\nthis.wireframeLinewidth=source.wireframeLinewidth;\nthis.wireframeLinecap=source.wireframeLinecap;\nthis.wireframeLinejoin=source.wireframeLinejoin;\n\nthis.fog=source.fog;\n\nreturn this;\n\n}}]);return MeshLambertMaterial;}(Material);var\n\n\n\nMeshMatcapMaterial=function(_Material14){_inherits(MeshMatcapMaterial,_Material14);\n\nfunction MeshMatcapMaterial(parameters){_classCallCheck(this,MeshMatcapMaterial);var _this99=_possibleConstructorReturn(this,(MeshMatcapMaterial.__proto__||Object.getPrototypeOf(MeshMatcapMaterial)).call(this));\n\n\n\n_this99.isMeshMatcapMaterial=true;\n\n_this99.defines={'MATCAP':''};\n\n_this99.type='MeshMatcapMaterial';\n\n_this99.color=new Color(0xffffff);// diffuse\n\n_this99.matcap=null;\n\n_this99.map=null;\n\n_this99.bumpMap=null;\n_this99.bumpScale=1;\n\n_this99.normalMap=null;\n_this99.normalMapType=TangentSpaceNormalMap;\n_this99.normalScale=new Vector2(1,1);\n\n_this99.displacementMap=null;\n_this99.displacementScale=1;\n_this99.displacementBias=0;\n\n_this99.alphaMap=null;\n\n_this99.flatShading=false;\n\n_this99.fog=true;\n\n_this99.setValues(parameters);return _this99;\n\n}_createClass(MeshMatcapMaterial,[{key:'copy',value:function copy(\n\n\nsource){\n\n_get(MeshMatcapMaterial.prototype.__proto__||Object.getPrototypeOf(MeshMatcapMaterial.prototype),'copy',this).call(this,source);\n\nthis.defines={'MATCAP':''};\n\nthis.color.copy(source.color);\n\nthis.matcap=source.matcap;\n\nthis.map=source.map;\n\nthis.bumpMap=source.bumpMap;\nthis.bumpScale=source.bumpScale;\n\nthis.normalMap=source.normalMap;\nthis.normalMapType=source.normalMapType;\nthis.normalScale.copy(source.normalScale);\n\nthis.displacementMap=source.displacementMap;\nthis.displacementScale=source.displacementScale;\nthis.displacementBias=source.displacementBias;\n\nthis.alphaMap=source.alphaMap;\n\nthis.flatShading=source.flatShading;\n\nthis.fog=source.fog;\n\nreturn this;\n\n}}]);return MeshMatcapMaterial;}(Material);var\n\n\n\nLineDashedMaterial=function(_LineBasicMaterial){_inherits(LineDashedMaterial,_LineBasicMaterial);\n\nfunction LineDashedMaterial(parameters){_classCallCheck(this,LineDashedMaterial);var _this100=_possibleConstructorReturn(this,(LineDashedMaterial.__proto__||Object.getPrototypeOf(LineDashedMaterial)).call(this));\n\n\n\n_this100.isLineDashedMaterial=true;\n\n_this100.type='LineDashedMaterial';\n\n_this100.scale=1;\n_this100.dashSize=3;\n_this100.gapSize=1;\n\n_this100.setValues(parameters);return _this100;\n\n}_createClass(LineDashedMaterial,[{key:'copy',value:function copy(\n\nsource){\n\n_get(LineDashedMaterial.prototype.__proto__||Object.getPrototypeOf(LineDashedMaterial.prototype),'copy',this).call(this,source);\n\nthis.scale=source.scale;\nthis.dashSize=source.dashSize;\nthis.gapSize=source.gapSize;\n\nreturn this;\n\n}}]);return LineDashedMaterial;}(LineBasicMaterial);\n\n\n\nvar AnimationUtils={\n\n// same as Array.prototype.slice, but also works on typed arrays\narraySlice:function arraySlice(array,from,to){\n\nif(AnimationUtils.isTypedArray(array)){\n\n// in ios9 array.subarray(from, undefined) will return empty array\n// but array.subarray(from) or array.subarray(from, len) is correct\nreturn new array.constructor(array.subarray(from,to!==undefined?to:array.length));\n\n}\n\nreturn array.slice(from,to);\n\n},\n\n// converts an array to a specific type\nconvertArray:function convertArray(array,type,forceClone){\n\nif(!array||// let 'undefined' and 'null' pass\n!forceClone&&array.constructor===type)return array;\n\nif(typeof type.BYTES_PER_ELEMENT==='number'){\n\nreturn new type(array);// create typed array\n\n}\n\nreturn Array.prototype.slice.call(array);// create Array\n\n},\n\nisTypedArray:function isTypedArray(object){\n\nreturn ArrayBuffer.isView(object)&&\n!(object instanceof DataView);\n\n},\n\n// returns an array by which times and values can be sorted\ngetKeyframeOrder:function getKeyframeOrder(times){\n\nfunction compareTime(i,j){\n\nreturn times[i]-times[j];\n\n}\n\nvar n=times.length;\nvar result=new Array(n);\nfor(var i=0;i!==n;++i){result[i]=i;}\n\nresult.sort(compareTime);\n\nreturn result;\n\n},\n\n// uses the array previously returned by 'getKeyframeOrder' to sort data\nsortedArray:function sortedArray(values,stride,order){\n\nvar nValues=values.length;\nvar result=new values.constructor(nValues);\n\nfor(var i=0,dstOffset=0;dstOffset!==nValues;++i){\n\nvar srcOffset=order[i]*stride;\n\nfor(var j=0;j!==stride;++j){\n\nresult[dstOffset++]=values[srcOffset+j];\n\n}\n\n}\n\nreturn result;\n\n},\n\n// function for parsing AOS keyframe formats\nflattenJSON:function flattenJSON(jsonKeys,times,values,valuePropertyName){\n\nvar i=1,key=jsonKeys[0];\n\nwhile(key!==undefined&&key[valuePropertyName]===undefined){\n\nkey=jsonKeys[i++];\n\n}\n\nif(key===undefined)return;// no data\n\nvar value=key[valuePropertyName];\nif(value===undefined)return;// no data\n\nif(Array.isArray(value)){\n\ndo{\n\nvalue=key[valuePropertyName];\n\nif(value!==undefined){\n\ntimes.push(key.time);\nvalues.push.apply(values,value);// push all elements\n\n}\n\nkey=jsonKeys[i++];\n\n}while(key!==undefined);\n\n}else if(value.toArray!==undefined){\n\n// ...assume THREE.Math-ish\n\ndo{\n\nvalue=key[valuePropertyName];\n\nif(value!==undefined){\n\ntimes.push(key.time);\nvalue.toArray(values,values.length);\n\n}\n\nkey=jsonKeys[i++];\n\n}while(key!==undefined);\n\n}else{\n\n// otherwise push as-is\n\ndo{\n\nvalue=key[valuePropertyName];\n\nif(value!==undefined){\n\ntimes.push(key.time);\nvalues.push(value);\n\n}\n\nkey=jsonKeys[i++];\n\n}while(key!==undefined);\n\n}\n\n},\n\nsubclip:function subclip(sourceClip,name,startFrame,endFrame){var fps=arguments.length>4&&arguments[4]!==undefined?arguments[4]:30;\n\nvar clip=sourceClip.clone();\n\nclip.name=name;\n\nvar tracks=[];\n\nfor(var i=0;i<clip.tracks.length;++i){\n\nvar track=clip.tracks[i];\nvar valueSize=track.getValueSize();\n\nvar times=[];\nvar values=[];\n\nfor(var j=0;j<track.times.length;++j){\n\nvar frame=track.times[j]*fps;\n\nif(frame<startFrame||frame>=endFrame)continue;\n\ntimes.push(track.times[j]);\n\nfor(var k=0;k<valueSize;++k){\n\nvalues.push(track.values[j*valueSize+k]);\n\n}\n\n}\n\nif(times.length===0)continue;\n\ntrack.times=AnimationUtils.convertArray(times,track.times.constructor);\ntrack.values=AnimationUtils.convertArray(values,track.values.constructor);\n\ntracks.push(track);\n\n}\n\nclip.tracks=tracks;\n\n// find minimum .times value across all tracks in the trimmed clip\n\nvar minStartTime=Infinity;\n\nfor(var _i81=0;_i81<clip.tracks.length;++_i81){\n\nif(minStartTime>clip.tracks[_i81].times[0]){\n\nminStartTime=clip.tracks[_i81].times[0];\n\n}\n\n}\n\n// shift all tracks such that clip begins at t=0\n\nfor(var _i82=0;_i82<clip.tracks.length;++_i82){\n\nclip.tracks[_i82].shift(-1*minStartTime);\n\n}\n\nclip.resetDuration();\n\nreturn clip;\n\n},\n\nmakeClipAdditive:function makeClipAdditive(targetClip){var referenceFrame=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var referenceClip=arguments.length>2&&arguments[2]!==undefined?arguments[2]:targetClip;var fps=arguments.length>3&&arguments[3]!==undefined?arguments[3]:30;\n\nif(fps<=0)fps=30;\n\nvar numTracks=referenceClip.tracks.length;\nvar referenceTime=referenceFrame/fps;\n\n// Make each track's values relative to the values at the reference frame\nvar _loop=function _loop(i){\n\nvar referenceTrack=referenceClip.tracks[i];\nvar referenceTrackType=referenceTrack.ValueTypeName;\n\n// Skip this track if it's non-numeric\nif(referenceTrackType==='bool'||referenceTrackType==='string')return'continue';\n\n// Find the track in the target clip whose name and type matches the reference track\nvar targetTrack=targetClip.tracks.find(function(track){\n\nreturn track.name===referenceTrack.name&&\ntrack.ValueTypeName===referenceTrackType;\n\n});\n\nif(targetTrack===undefined)return'continue';\n\nvar referenceOffset=0;\nvar referenceValueSize=referenceTrack.getValueSize();\n\nif(referenceTrack.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline){\n\nreferenceOffset=referenceValueSize/3;\n\n}\n\nvar targetOffset=0;\nvar targetValueSize=targetTrack.getValueSize();\n\nif(targetTrack.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline){\n\ntargetOffset=targetValueSize/3;\n\n}\n\nvar lastIndex=referenceTrack.times.length-1;\nvar referenceValue=void 0;\n\n// Find the value to subtract out of the track\nif(referenceTime<=referenceTrack.times[0]){\n\n// Reference frame is earlier than the first keyframe, so just use the first keyframe\nvar startIndex=referenceOffset;\nvar endIndex=referenceValueSize-referenceOffset;\nreferenceValue=AnimationUtils.arraySlice(referenceTrack.values,startIndex,endIndex);\n\n}else if(referenceTime>=referenceTrack.times[lastIndex]){\n\n// Reference frame is after the last keyframe, so just use the last keyframe\nvar _startIndex=lastIndex*referenceValueSize+referenceOffset;\nvar _endIndex=_startIndex+referenceValueSize-referenceOffset;\nreferenceValue=AnimationUtils.arraySlice(referenceTrack.values,_startIndex,_endIndex);\n\n}else{\n\n// Interpolate to the reference value\nvar interpolant=referenceTrack.createInterpolant();\nvar _startIndex2=referenceOffset;\nvar _endIndex2=referenceValueSize-referenceOffset;\ninterpolant.evaluate(referenceTime);\nreferenceValue=AnimationUtils.arraySlice(interpolant.resultBuffer,_startIndex2,_endIndex2);\n\n}\n\n// Conjugate the quaternion\nif(referenceTrackType==='quaternion'){\n\nvar referenceQuat=new Quaternion().fromArray(referenceValue).normalize().conjugate();\nreferenceQuat.toArray(referenceValue);\n\n}\n\n// Subtract the reference value from all of the track values\n\nvar numTimes=targetTrack.times.length;\nfor(var j=0;j<numTimes;++j){\n\nvar valueStart=j*targetValueSize+targetOffset;\n\nif(referenceTrackType==='quaternion'){\n\n// Multiply the conjugate for quaternion track types\nQuaternion.multiplyQuaternionsFlat(\ntargetTrack.values,\nvalueStart,\nreferenceValue,\n0,\ntargetTrack.values,\nvalueStart);\n\n\n}else{\n\nvar valueEnd=targetValueSize-targetOffset*2;\n\n// Subtract each value for all other numeric track types\nfor(var k=0;k<valueEnd;++k){\n\ntargetTrack.values[valueStart+k]-=referenceValue[k];\n\n}\n\n}\n\n}};for(var i=0;i<numTracks;++i){var _ret=_loop(i);if(_ret==='continue')continue;\n\n}\n\ntargetClip.blendMode=AdditiveAnimationBlendMode;\n\nreturn targetClip;\n\n}};\n\n\n\n/**\n * Abstract base class of interpolants over parametric samples.\n *\n * The parameter domain is one dimensional, typically the time or a path\n * along a curve defined by the data.\n *\n * The sample values can have any dimensionality and derived classes may\n * apply special interpretations to the data.\n *\n * This class provides the interval seek in a Template Method, deferring\n * the actual interpolation to derived classes.\n *\n * Time complexity is O(1) for linear access crossing at most two points\n * and O(log N) for random access, where N is the number of positions.\n *\n * References:\n *\n * \t\thttp://www.oodesign.com/template-method-pattern.html\n *\n */var\n\nInterpolant=function(){\n\nfunction Interpolant(parameterPositions,sampleValues,sampleSize,resultBuffer){_classCallCheck(this,Interpolant);\n\nthis.parameterPositions=parameterPositions;\nthis._cachedIndex=0;\n\nthis.resultBuffer=resultBuffer!==undefined?\nresultBuffer:new sampleValues.constructor(sampleSize);\nthis.sampleValues=sampleValues;\nthis.valueSize=sampleSize;\n\nthis.settings=null;\nthis.DefaultSettings_={};\n\n}_createClass(Interpolant,[{key:'evaluate',value:function evaluate(\n\nt){\n\nvar pp=this.parameterPositions;\nvar i1=this._cachedIndex,\nt1=pp[i1],\nt0=pp[i1-1];\n\nvalidate_interval:{\n\nseek:{\n\nvar right=void 0;\n\nlinear_scan:{\n\n//- See http://jsperf.com/comparison-to-undefined/3\n//- slower code:\n//-\n//- \t\t\t\tif ( t >= t1 || t1 === undefined ) {\nforward_scan:if(!(t<t1)){\n\nfor(var giveUpAt=i1+2;;){\n\nif(t1===undefined){\n\nif(t<t0)break forward_scan;\n\n// after end\n\ni1=pp.length;\nthis._cachedIndex=i1;\nreturn this.copySampleValue_(i1-1);\n\n}\n\nif(i1===giveUpAt)break;// this loop\n\nt0=t1;\nt1=pp[++i1];\n\nif(t<t1){\n\n// we have arrived at the sought interval\nbreak seek;\n\n}\n\n}\n\n// prepare binary search on the right side of the index\nright=pp.length;\nbreak linear_scan;\n\n}\n\n//- slower code:\n//-\t\t\t\t\tif ( t < t0 || t0 === undefined ) {\nif(!(t>=t0)){\n\n// looping?\n\nvar t1global=pp[1];\n\nif(t<t1global){\n\ni1=2;// + 1, using the scan for the details\nt0=t1global;\n\n}\n\n// linear reverse scan\n\nfor(var _giveUpAt=i1-2;;){\n\nif(t0===undefined){\n\n// before start\n\nthis._cachedIndex=0;\nreturn this.copySampleValue_(0);\n\n}\n\nif(i1===_giveUpAt)break;// this loop\n\nt1=t0;\nt0=pp[--i1-1];\n\nif(t>=t0){\n\n// we have arrived at the sought interval\nbreak seek;\n\n}\n\n}\n\n// prepare binary search on the left side of the index\nright=i1;\ni1=0;\nbreak linear_scan;\n\n}\n\n// the interval is valid\n\nbreak validate_interval;\n\n}// linear scan\n\n// binary search\n\nwhile(i1<right){\n\nvar mid=i1+right>>>1;\n\nif(t<pp[mid]){\n\nright=mid;\n\n}else{\n\ni1=mid+1;\n\n}\n\n}\n\nt1=pp[i1];\nt0=pp[i1-1];\n\n// check boundary cases, again\n\nif(t0===undefined){\n\nthis._cachedIndex=0;\nreturn this.copySampleValue_(0);\n\n}\n\nif(t1===undefined){\n\ni1=pp.length;\nthis._cachedIndex=i1;\nreturn this.copySampleValue_(i1-1);\n\n}\n\n}// seek\n\nthis._cachedIndex=i1;\n\nthis.intervalChanged_(i1,t0,t1);\n\n}// validate_interval\n\nreturn this.interpolate_(i1,t0,t,t1);\n\n}},{key:'getSettings_',value:function getSettings_()\n\n{\n\nreturn this.settings||this.DefaultSettings_;\n\n}},{key:'copySampleValue_',value:function copySampleValue_(\n\nindex){\n\n// copies a sample value to the result buffer\n\nvar result=this.resultBuffer,\nvalues=this.sampleValues,\nstride=this.valueSize,\noffset=index*stride;\n\nfor(var i=0;i!==stride;++i){\n\nresult[i]=values[offset+i];\n\n}\n\nreturn result;\n\n}\n\n// Template methods for derived classes:\n},{key:'interpolate_',value:function interpolate_()\n/* i1, t0, t, t1 */{\n\nthrow new Error('call to abstract method');\n// implementations shall return this.resultBuffer\n\n}},{key:'intervalChanged_',value:function intervalChanged_()\n\n/* i1, t0, t1 */{\n\n// empty\n\n}}]);return Interpolant;}();\n\n\n\n/**\n * Fast and simple cubic spline interpolant.\n *\n * It was derived from a Hermitian construction setting the first derivative\n * at each sample position to the linear slope between neighboring positions\n * over their parameter interval.\n */var\n\nCubicInterpolant=function(_Interpolant){_inherits(CubicInterpolant,_Interpolant);\n\nfunction CubicInterpolant(parameterPositions,sampleValues,sampleSize,resultBuffer){_classCallCheck(this,CubicInterpolant);var _this101=_possibleConstructorReturn(this,(CubicInterpolant.__proto__||Object.getPrototypeOf(CubicInterpolant)).call(this,\n\nparameterPositions,sampleValues,sampleSize,resultBuffer));\n\n_this101._weightPrev=-0;\n_this101._offsetPrev=-0;\n_this101._weightNext=-0;\n_this101._offsetNext=-0;\n\n_this101.DefaultSettings_={\n\nendingStart:ZeroCurvatureEnding,\nendingEnd:ZeroCurvatureEnding};return _this101;\n\n\n\n}_createClass(CubicInterpolant,[{key:'intervalChanged_',value:function intervalChanged_(\n\ni1,t0,t1){\n\nvar pp=this.parameterPositions;\nvar iPrev=i1-2,\niNext=i1+1,\n\ntPrev=pp[iPrev],\ntNext=pp[iNext];\n\nif(tPrev===undefined){\n\nswitch(this.getSettings_().endingStart){\n\ncase ZeroSlopeEnding:\n\n// f'(t0) = 0\niPrev=i1;\ntPrev=2*t0-t1;\n\nbreak;\n\ncase WrapAroundEnding:\n\n// use the other end of the curve\niPrev=pp.length-2;\ntPrev=t0+pp[iPrev]-pp[iPrev+1];\n\nbreak;\n\ndefault:// ZeroCurvatureEnding\n\n// f''(t0) = 0 a.k.a. Natural Spline\niPrev=i1;\ntPrev=t1;}\n\n\n\n}\n\nif(tNext===undefined){\n\nswitch(this.getSettings_().endingEnd){\n\ncase ZeroSlopeEnding:\n\n// f'(tN) = 0\niNext=i1;\ntNext=2*t1-t0;\n\nbreak;\n\ncase WrapAroundEnding:\n\n// use the other end of the curve\niNext=1;\ntNext=t1+pp[1]-pp[0];\n\nbreak;\n\ndefault:// ZeroCurvatureEnding\n\n// f''(tN) = 0, a.k.a. Natural Spline\niNext=i1-1;\ntNext=t0;}\n\n\n\n}\n\nvar halfDt=(t1-t0)*0.5,\nstride=this.valueSize;\n\nthis._weightPrev=halfDt/(t0-tPrev);\nthis._weightNext=halfDt/(tNext-t1);\nthis._offsetPrev=iPrev*stride;\nthis._offsetNext=iNext*stride;\n\n}},{key:'interpolate_',value:function interpolate_(\n\ni1,t0,t,t1){\n\nvar result=this.resultBuffer,\nvalues=this.sampleValues,\nstride=this.valueSize,\n\no1=i1*stride,o0=o1-stride,\noP=this._offsetPrev,oN=this._offsetNext,\nwP=this._weightPrev,wN=this._weightNext,\n\np=(t-t0)/(t1-t0),\npp=p*p,\nppp=pp*p;\n\n// evaluate polynomials\n\nvar sP=-wP*ppp+2*wP*pp-wP*p;\nvar s0=(1+wP)*ppp+(-1.5-2*wP)*pp+(-0.5+wP)*p+1;\nvar s1=(-1-wN)*ppp+(1.5+wN)*pp+0.5*p;\nvar sN=wN*ppp-wN*pp;\n\n// combine data linearly\n\nfor(var i=0;i!==stride;++i){\n\nresult[i]=\nsP*values[oP+i]+\ns0*values[o0+i]+\ns1*values[o1+i]+\nsN*values[oN+i];\n\n}\n\nreturn result;\n\n}}]);return CubicInterpolant;}(Interpolant);var\n\n\n\nLinearInterpolant=function(_Interpolant2){_inherits(LinearInterpolant,_Interpolant2);\n\nfunction LinearInterpolant(parameterPositions,sampleValues,sampleSize,resultBuffer){_classCallCheck(this,LinearInterpolant);return _possibleConstructorReturn(this,(LinearInterpolant.__proto__||Object.getPrototypeOf(LinearInterpolant)).call(this,\n\nparameterPositions,sampleValues,sampleSize,resultBuffer));\n\n}_createClass(LinearInterpolant,[{key:'interpolate_',value:function interpolate_(\n\ni1,t0,t,t1){\n\nvar result=this.resultBuffer,\nvalues=this.sampleValues,\nstride=this.valueSize,\n\noffset1=i1*stride,\noffset0=offset1-stride,\n\nweight1=(t-t0)/(t1-t0),\nweight0=1-weight1;\n\nfor(var i=0;i!==stride;++i){\n\nresult[i]=\nvalues[offset0+i]*weight0+\nvalues[offset1+i]*weight1;\n\n}\n\nreturn result;\n\n}}]);return LinearInterpolant;}(Interpolant);\n\n\n\n/**\n *\n * Interpolant that evaluates to the sample value at the position preceding\n * the parameter.\n */var\n\nDiscreteInterpolant=function(_Interpolant3){_inherits(DiscreteInterpolant,_Interpolant3);\n\nfunction DiscreteInterpolant(parameterPositions,sampleValues,sampleSize,resultBuffer){_classCallCheck(this,DiscreteInterpolant);return _possibleConstructorReturn(this,(DiscreteInterpolant.__proto__||Object.getPrototypeOf(DiscreteInterpolant)).call(this,\n\nparameterPositions,sampleValues,sampleSize,resultBuffer));\n\n}_createClass(DiscreteInterpolant,[{key:'interpolate_',value:function interpolate_(\n\ni1/*, t0, t, t1 */){\n\nreturn this.copySampleValue_(i1-1);\n\n}}]);return DiscreteInterpolant;}(Interpolant);var\n\n\n\nKeyframeTrack=function(){\n\nfunction KeyframeTrack(name,times,values,interpolation){_classCallCheck(this,KeyframeTrack);\n\nif(name===undefined)throw new Error('THREE.KeyframeTrack: track name is undefined');\nif(times===undefined||times.length===0)throw new Error('THREE.KeyframeTrack: no keyframes in track named '+name);\n\nthis.name=name;\n\nthis.times=AnimationUtils.convertArray(times,this.TimeBufferType);\nthis.values=AnimationUtils.convertArray(values,this.ValueBufferType);\n\nthis.setInterpolation(interpolation||this.DefaultInterpolation);\n\n}\n\n// Serialization (in static context, because of constructor invocation\n// and automatic invocation of .toJSON):\n_createClass(KeyframeTrack,[{key:'InterpolantFactoryMethodDiscrete',value:function InterpolantFactoryMethodDiscrete(\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nresult){\n\nreturn new DiscreteInterpolant(this.times,this.values,this.getValueSize(),result);\n\n}},{key:'InterpolantFactoryMethodLinear',value:function InterpolantFactoryMethodLinear(\n\nresult){\n\nreturn new LinearInterpolant(this.times,this.values,this.getValueSize(),result);\n\n}},{key:'InterpolantFactoryMethodSmooth',value:function InterpolantFactoryMethodSmooth(\n\nresult){\n\nreturn new CubicInterpolant(this.times,this.values,this.getValueSize(),result);\n\n}},{key:'setInterpolation',value:function setInterpolation(\n\ninterpolation){\n\nvar factoryMethod=void 0;\n\nswitch(interpolation){\n\ncase InterpolateDiscrete:\n\nfactoryMethod=this.InterpolantFactoryMethodDiscrete;\n\nbreak;\n\ncase InterpolateLinear:\n\nfactoryMethod=this.InterpolantFactoryMethodLinear;\n\nbreak;\n\ncase InterpolateSmooth:\n\nfactoryMethod=this.InterpolantFactoryMethodSmooth;\n\nbreak;}\n\n\n\nif(factoryMethod===undefined){\n\nvar message='unsupported interpolation for '+\nthis.ValueTypeName+' keyframe track named '+this.name;\n\nif(this.createInterpolant===undefined){\n\n// fall back to default, unless the default itself is messed up\nif(interpolation!==this.DefaultInterpolation){\n\nthis.setInterpolation(this.DefaultInterpolation);\n\n}else{\n\nthrow new Error(message);// fatal, in this case\n\n}\n\n}\n\nconsole.warn('THREE.KeyframeTrack:',message);\nreturn this;\n\n}\n\nthis.createInterpolant=factoryMethod;\n\nreturn this;\n\n}},{key:'getInterpolation',value:function getInterpolation()\n\n{\n\nswitch(this.createInterpolant){\n\ncase this.InterpolantFactoryMethodDiscrete:\n\nreturn InterpolateDiscrete;\n\ncase this.InterpolantFactoryMethodLinear:\n\nreturn InterpolateLinear;\n\ncase this.InterpolantFactoryMethodSmooth:\n\nreturn InterpolateSmooth;}\n\n\n\n}},{key:'getValueSize',value:function getValueSize()\n\n{\n\nreturn this.values.length/this.times.length;\n\n}\n\n// move all keyframes either forwards or backwards in time\n},{key:'shift',value:function shift(timeOffset){\n\nif(timeOffset!==0.0){\n\nvar times=this.times;\n\nfor(var i=0,_n4=times.length;i!==_n4;++i){\n\ntimes[i]+=timeOffset;\n\n}\n\n}\n\nreturn this;\n\n}\n\n// scale all keyframe times by a factor (useful for frame <-> seconds conversions)\n},{key:'scale',value:function scale(timeScale){\n\nif(timeScale!==1.0){\n\nvar times=this.times;\n\nfor(var i=0,_n5=times.length;i!==_n5;++i){\n\ntimes[i]*=timeScale;\n\n}\n\n}\n\nreturn this;\n\n}\n\n// removes keyframes before and after animation without changing any values within the range [startTime, endTime].\n// IMPORTANT: We do not shift around keys to the start of the track time, because for interpolated keys this will change their values\n},{key:'trim',value:function trim(startTime,endTime){\n\nvar times=this.times,\nnKeys=times.length;\n\nvar from=0,\nto=nKeys-1;\n\nwhile(from!==nKeys&&times[from]<startTime){\n\n++from;\n\n}\n\nwhile(to!==-1&&times[to]>endTime){\n\n--to;\n\n}\n\n++to;// inclusive -> exclusive bound\n\nif(from!==0||to!==nKeys){\n\n// empty tracks are forbidden, so keep at least one keyframe\nif(from>=to){\n\nto=Math.max(to,1);\nfrom=to-1;\n\n}\n\nvar stride=this.getValueSize();\nthis.times=AnimationUtils.arraySlice(times,from,to);\nthis.values=AnimationUtils.arraySlice(this.values,from*stride,to*stride);\n\n}\n\nreturn this;\n\n}\n\n// ensure we do not get a GarbageInGarbageOut situation, make sure tracks are at least minimally viable\n},{key:'validate',value:function validate(){\n\nvar valid=true;\n\nvar valueSize=this.getValueSize();\nif(valueSize-Math.floor(valueSize)!==0){\n\nconsole.error('THREE.KeyframeTrack: Invalid value size in track.',this);\nvalid=false;\n\n}\n\nvar times=this.times,\nvalues=this.values,\n\nnKeys=times.length;\n\nif(nKeys===0){\n\nconsole.error('THREE.KeyframeTrack: Track is empty.',this);\nvalid=false;\n\n}\n\nvar prevTime=null;\n\nfor(var i=0;i!==nKeys;i++){\n\nvar currTime=times[i];\n\nif(typeof currTime==='number'&&isNaN(currTime)){\n\nconsole.error('THREE.KeyframeTrack: Time is not a valid number.',this,i,currTime);\nvalid=false;\nbreak;\n\n}\n\nif(prevTime!==null&&prevTime>currTime){\n\nconsole.error('THREE.KeyframeTrack: Out of order keys.',this,i,currTime,prevTime);\nvalid=false;\nbreak;\n\n}\n\nprevTime=currTime;\n\n}\n\nif(values!==undefined){\n\nif(AnimationUtils.isTypedArray(values)){\n\nfor(var _i83=0,_n6=values.length;_i83!==_n6;++_i83){\n\nvar _value5=values[_i83];\n\nif(isNaN(_value5)){\n\nconsole.error('THREE.KeyframeTrack: Value is not a valid number.',this,_i83,_value5);\nvalid=false;\nbreak;\n\n}\n\n}\n\n}\n\n}\n\nreturn valid;\n\n}\n\n// removes equivalent sequential keys as common in morph target sequences\n// (0,0,0,0,1,1,1,0,0,0,0,0,0,0) --> (0,0,1,1,0,0)\n},{key:'optimize',value:function optimize(){\n\n// times or values may be shared with other tracks, so overwriting is unsafe\nvar times=AnimationUtils.arraySlice(this.times),\nvalues=AnimationUtils.arraySlice(this.values),\nstride=this.getValueSize(),\n\nsmoothInterpolation=this.getInterpolation()===InterpolateSmooth,\n\nlastIndex=times.length-1;\n\nvar writeIndex=1;\n\nfor(var i=1;i<lastIndex;++i){\n\nvar keep=false;\n\nvar time=times[i];\nvar timeNext=times[i+1];\n\n// remove adjacent keyframes scheduled at the same time\n\nif(time!==timeNext&&(i!==1||time!==times[0])){\n\nif(!smoothInterpolation){\n\n// remove unnecessary keyframes same as their neighbors\n\nvar offset=i*stride,\noffsetP=offset-stride,\noffsetN=offset+stride;\n\nfor(var j=0;j!==stride;++j){\n\nvar _value6=values[offset+j];\n\nif(_value6!==values[offsetP+j]||\n_value6!==values[offsetN+j]){\n\nkeep=true;\nbreak;\n\n}\n\n}\n\n}else{\n\nkeep=true;\n\n}\n\n}\n\n// in-place compaction\n\nif(keep){\n\nif(i!==writeIndex){\n\ntimes[writeIndex]=times[i];\n\nvar readOffset=i*stride,\nwriteOffset=writeIndex*stride;\n\nfor(var _j14=0;_j14!==stride;++_j14){\n\nvalues[writeOffset+_j14]=values[readOffset+_j14];\n\n}\n\n}\n\n++writeIndex;\n\n}\n\n}\n\n// flush last keyframe (compaction looks ahead)\n\nif(lastIndex>0){\n\ntimes[writeIndex]=times[lastIndex];\n\nfor(var _readOffset=lastIndex*stride,_writeOffset=writeIndex*stride,_j15=0;_j15!==stride;++_j15){\n\nvalues[_writeOffset+_j15]=values[_readOffset+_j15];\n\n}\n\n++writeIndex;\n\n}\n\nif(writeIndex!==times.length){\n\nthis.times=AnimationUtils.arraySlice(times,0,writeIndex);\nthis.values=AnimationUtils.arraySlice(values,0,writeIndex*stride);\n\n}else{\n\nthis.times=times;\nthis.values=values;\n\n}\n\nreturn this;\n\n}},{key:'clone',value:function clone()\n\n{\n\nvar times=AnimationUtils.arraySlice(this.times,0);\nvar values=AnimationUtils.arraySlice(this.values,0);\n\nvar TypedKeyframeTrack=this.constructor;\nvar track=new TypedKeyframeTrack(this.name,times,values);\n\n// Interpolant argument to constructor is not saved, so copy the factory method directly.\ntrack.createInterpolant=this.createInterpolant;\n\nreturn track;\n\n}}],[{key:'toJSON',value:function toJSON(track){var trackType=track.constructor;var json=void 0;// derived classes can define a static toJSON method\nif(trackType.toJSON!==this.toJSON){json=trackType.toJSON(track);}else{// by default, we assume the data can be serialized as-is\njson={'name':track.name,'times':AnimationUtils.convertArray(track.times,Array),'values':AnimationUtils.convertArray(track.values,Array)};var interpolation=track.getInterpolation();if(interpolation!==track.DefaultInterpolation){json.interpolation=interpolation;}}json.type=track.ValueTypeName;// mandatory\nreturn json;}}]);return KeyframeTrack;}();\nKeyframeTrack.prototype.TimeBufferType=Float32Array;\nKeyframeTrack.prototype.ValueBufferType=Float32Array;\nKeyframeTrack.prototype.DefaultInterpolation=InterpolateLinear;\n\n/**\n * A Track of Boolean keyframe values.\n */var\nBooleanKeyframeTrack=function(_KeyframeTrack){_inherits(BooleanKeyframeTrack,_KeyframeTrack);function BooleanKeyframeTrack(){_classCallCheck(this,BooleanKeyframeTrack);return _possibleConstructorReturn(this,(BooleanKeyframeTrack.__proto__||Object.getPrototypeOf(BooleanKeyframeTrack)).apply(this,arguments));}return BooleanKeyframeTrack;}(KeyframeTrack);\n\nBooleanKeyframeTrack.prototype.ValueTypeName='bool';\nBooleanKeyframeTrack.prototype.ValueBufferType=Array;\nBooleanKeyframeTrack.prototype.DefaultInterpolation=InterpolateDiscrete;\nBooleanKeyframeTrack.prototype.InterpolantFactoryMethodLinear=undefined;\nBooleanKeyframeTrack.prototype.InterpolantFactoryMethodSmooth=undefined;\n\n/**\n * A Track of keyframe values that represent color.\n */var\nColorKeyframeTrack=function(_KeyframeTrack2){_inherits(ColorKeyframeTrack,_KeyframeTrack2);function ColorKeyframeTrack(){_classCallCheck(this,ColorKeyframeTrack);return _possibleConstructorReturn(this,(ColorKeyframeTrack.__proto__||Object.getPrototypeOf(ColorKeyframeTrack)).apply(this,arguments));}return ColorKeyframeTrack;}(KeyframeTrack);\n\nColorKeyframeTrack.prototype.ValueTypeName='color';\n\n/**\n * A Track of numeric keyframe values.\n */var\nNumberKeyframeTrack=function(_KeyframeTrack3){_inherits(NumberKeyframeTrack,_KeyframeTrack3);function NumberKeyframeTrack(){_classCallCheck(this,NumberKeyframeTrack);return _possibleConstructorReturn(this,(NumberKeyframeTrack.__proto__||Object.getPrototypeOf(NumberKeyframeTrack)).apply(this,arguments));}return NumberKeyframeTrack;}(KeyframeTrack);\n\nNumberKeyframeTrack.prototype.ValueTypeName='number';\n\n/**\n * Spherical linear unit quaternion interpolant.\n */var\n\nQuaternionLinearInterpolant=function(_Interpolant4){_inherits(QuaternionLinearInterpolant,_Interpolant4);\n\nfunction QuaternionLinearInterpolant(parameterPositions,sampleValues,sampleSize,resultBuffer){_classCallCheck(this,QuaternionLinearInterpolant);return _possibleConstructorReturn(this,(QuaternionLinearInterpolant.__proto__||Object.getPrototypeOf(QuaternionLinearInterpolant)).call(this,\n\nparameterPositions,sampleValues,sampleSize,resultBuffer));\n\n}_createClass(QuaternionLinearInterpolant,[{key:'interpolate_',value:function interpolate_(\n\ni1,t0,t,t1){\n\nvar result=this.resultBuffer,\nvalues=this.sampleValues,\nstride=this.valueSize,\n\nalpha=(t-t0)/(t1-t0);\n\nvar offset=i1*stride;\n\nfor(var end=offset+stride;offset!==end;offset+=4){\n\nQuaternion.slerpFlat(result,0,values,offset-stride,values,offset,alpha);\n\n}\n\nreturn result;\n\n}}]);return QuaternionLinearInterpolant;}(Interpolant);\n\n\n\n/**\n * A Track of quaternion keyframe values.\n */var\nQuaternionKeyframeTrack=function(_KeyframeTrack4){_inherits(QuaternionKeyframeTrack,_KeyframeTrack4);function QuaternionKeyframeTrack(){_classCallCheck(this,QuaternionKeyframeTrack);return _possibleConstructorReturn(this,(QuaternionKeyframeTrack.__proto__||Object.getPrototypeOf(QuaternionKeyframeTrack)).apply(this,arguments));}_createClass(QuaternionKeyframeTrack,[{key:'InterpolantFactoryMethodLinear',value:function InterpolantFactoryMethodLinear(\n\nresult){\n\nreturn new QuaternionLinearInterpolant(this.times,this.values,this.getValueSize(),result);\n\n}}]);return QuaternionKeyframeTrack;}(KeyframeTrack);\n\n\n\nQuaternionKeyframeTrack.prototype.ValueTypeName='quaternion';\n// ValueBufferType is inherited\nQuaternionKeyframeTrack.prototype.DefaultInterpolation=InterpolateLinear;\nQuaternionKeyframeTrack.prototype.InterpolantFactoryMethodSmooth=undefined;\n\n/**\n * A Track that interpolates Strings\n */var\nStringKeyframeTrack=function(_KeyframeTrack5){_inherits(StringKeyframeTrack,_KeyframeTrack5);function StringKeyframeTrack(){_classCallCheck(this,StringKeyframeTrack);return _possibleConstructorReturn(this,(StringKeyframeTrack.__proto__||Object.getPrototypeOf(StringKeyframeTrack)).apply(this,arguments));}return StringKeyframeTrack;}(KeyframeTrack);\n\nStringKeyframeTrack.prototype.ValueTypeName='string';\nStringKeyframeTrack.prototype.ValueBufferType=Array;\nStringKeyframeTrack.prototype.DefaultInterpolation=InterpolateDiscrete;\nStringKeyframeTrack.prototype.InterpolantFactoryMethodLinear=undefined;\nStringKeyframeTrack.prototype.InterpolantFactoryMethodSmooth=undefined;\n\n/**\n * A Track of vectored keyframe values.\n */var\nVectorKeyframeTrack=function(_KeyframeTrack6){_inherits(VectorKeyframeTrack,_KeyframeTrack6);function VectorKeyframeTrack(){_classCallCheck(this,VectorKeyframeTrack);return _possibleConstructorReturn(this,(VectorKeyframeTrack.__proto__||Object.getPrototypeOf(VectorKeyframeTrack)).apply(this,arguments));}return VectorKeyframeTrack;}(KeyframeTrack);\n\nVectorKeyframeTrack.prototype.ValueTypeName='vector';var\n\nAnimationClip=function(){\n\nfunction AnimationClip(name){var duration=arguments.length>1&&arguments[1]!==undefined?arguments[1]:-1;var tracks=arguments[2];var blendMode=arguments.length>3&&arguments[3]!==undefined?arguments[3]:NormalAnimationBlendMode;_classCallCheck(this,AnimationClip);\n\nthis.name=name;\nthis.tracks=tracks;\nthis.duration=duration;\nthis.blendMode=blendMode;\n\nthis.uuid=generateUUID();\n\n// this means it should figure out its duration by scanning the tracks\nif(this.duration<0){\n\nthis.resetDuration();\n\n}\n\n}_createClass(AnimationClip,[{key:'resetDuration',value:function resetDuration()\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n{\n\nvar tracks=this.tracks;\nvar duration=0;\n\nfor(var i=0,_n7=tracks.length;i!==_n7;++i){\n\nvar track=this.tracks[i];\n\nduration=Math.max(duration,track.times[track.times.length-1]);\n\n}\n\nthis.duration=duration;\n\nreturn this;\n\n}},{key:'trim',value:function trim()\n\n{\n\nfor(var i=0;i<this.tracks.length;i++){\n\nthis.tracks[i].trim(0,this.duration);\n\n}\n\nreturn this;\n\n}},{key:'validate',value:function validate()\n\n{\n\nvar valid=true;\n\nfor(var i=0;i<this.tracks.length;i++){\n\nvalid=valid&&this.tracks[i].validate();\n\n}\n\nreturn valid;\n\n}},{key:'optimize',value:function optimize()\n\n{\n\nfor(var i=0;i<this.tracks.length;i++){\n\nthis.tracks[i].optimize();\n\n}\n\nreturn this;\n\n}},{key:'clone',value:function clone()\n\n{\n\nvar tracks=[];\n\nfor(var i=0;i<this.tracks.length;i++){\n\ntracks.push(this.tracks[i].clone());\n\n}\n\nreturn new this.constructor(this.name,this.duration,tracks,this.blendMode);\n\n}},{key:'toJSON',value:function toJSON()\n\n{\n\nreturn this.constructor.toJSON(this);\n\n}}],[{key:'parse',value:function parse(json){var tracks=[],jsonTracks=json.tracks,frameTime=1.0/(json.fps||1.0);for(var i=0,_n8=jsonTracks.length;i!==_n8;++i){tracks.push(parseKeyframeTrack(jsonTracks[i]).scale(frameTime));}var clip=new this(json.name,json.duration,tracks,json.blendMode);clip.uuid=json.uuid;return clip;}},{key:'toJSON',value:function toJSON(clip){var tracks=[],clipTracks=clip.tracks;var json={'name':clip.name,'duration':clip.duration,'tracks':tracks,'uuid':clip.uuid,'blendMode':clip.blendMode};for(var i=0,_n9=clipTracks.length;i!==_n9;++i){tracks.push(KeyframeTrack.toJSON(clipTracks[i]));}return json;}},{key:'CreateFromMorphTargetSequence',value:function CreateFromMorphTargetSequence(name,morphTargetSequence,fps,noLoop){var numMorphTargets=morphTargetSequence.length;var tracks=[];for(var i=0;i<numMorphTargets;i++){var times=[];var values=[];times.push((i+numMorphTargets-1)%numMorphTargets,i,(i+1)%numMorphTargets);values.push(0,1,0);var order=AnimationUtils.getKeyframeOrder(times);times=AnimationUtils.sortedArray(times,1,order);values=AnimationUtils.sortedArray(values,1,order);// if there is a key at the first frame, duplicate it as the\n// last frame as well for perfect loop.\nif(!noLoop&&times[0]===0){times.push(numMorphTargets);values.push(values[0]);}tracks.push(new NumberKeyframeTrack('.morphTargetInfluences['+morphTargetSequence[i].name+']',times,values).scale(1.0/fps));}return new this(name,-1,tracks);}},{key:'findByName',value:function findByName(objectOrClipArray,name){var clipArray=objectOrClipArray;if(!Array.isArray(objectOrClipArray)){var o=objectOrClipArray;clipArray=o.geometry&&o.geometry.animations||o.animations;}for(var i=0;i<clipArray.length;i++){if(clipArray[i].name===name){return clipArray[i];}}return null;}},{key:'CreateClipsFromMorphTargetSequences',value:function CreateClipsFromMorphTargetSequences(morphTargets,fps,noLoop){var animationToMorphTargets={};// tested with https://regex101.com/ on trick sequences\n// such flamingo_flyA_003, flamingo_run1_003, crdeath0059\nvar pattern=/^([\\w-]*?)([\\d]+)$/;// sort morph target names into animation groups based\n// patterns like Walk_001, Walk_002, Run_001, Run_002\nfor(var i=0,il=morphTargets.length;i<il;i++){var morphTarget=morphTargets[i];var parts=morphTarget.name.match(pattern);if(parts&&parts.length>1){var name=parts[1];var animationMorphTargets=animationToMorphTargets[name];if(!animationMorphTargets){animationToMorphTargets[name]=animationMorphTargets=[];}animationMorphTargets.push(morphTarget);}}var clips=[];for(var _name4 in animationToMorphTargets){clips.push(this.CreateFromMorphTargetSequence(_name4,animationToMorphTargets[_name4],fps,noLoop));}return clips;}// parse the animation.hierarchy format\n},{key:'parseAnimation',value:function parseAnimation(animation,bones){if(!animation){console.error('THREE.AnimationClip: No animation in JSONLoader data.');return null;}var addNonemptyTrack=function addNonemptyTrack(trackType,trackName,animationKeys,propertyName,destTracks){// only return track if there are actually keys.\nif(animationKeys.length!==0){var times=[];var values=[];AnimationUtils.flattenJSON(animationKeys,times,values,propertyName);// empty keys are filtered out, so check again\nif(times.length!==0){destTracks.push(new trackType(trackName,times,values));}}};var tracks=[];var clipName=animation.name||'default';var fps=animation.fps||30;var blendMode=animation.blendMode;// automatic length determination in AnimationClip.\nvar duration=animation.length||-1;var hierarchyTracks=animation.hierarchy||[];for(var h=0;h<hierarchyTracks.length;h++){var animationKeys=hierarchyTracks[h].keys;// skip empty tracks\nif(!animationKeys||animationKeys.length===0)continue;// process morph targets\nif(animationKeys[0].morphTargets){// figure out all morph targets used in this track\nvar morphTargetNames={};var k=void 0;for(k=0;k<animationKeys.length;k++){if(animationKeys[k].morphTargets){for(var m=0;m<animationKeys[k].morphTargets.length;m++){morphTargetNames[animationKeys[k].morphTargets[m]]=-1;}}}// create a track for each morph target with all zero\n// morphTargetInfluences except for the keys in which\n// the morphTarget is named.\nfor(var morphTargetName in morphTargetNames){var times=[];var values=[];for(var _m=0;_m!==animationKeys[k].morphTargets.length;++_m){var animationKey=animationKeys[k];times.push(animationKey.time);values.push(animationKey.morphTarget===morphTargetName?1:0);}tracks.push(new NumberKeyframeTrack('.morphTargetInfluence['+morphTargetName+']',times,values));}duration=morphTargetNames.length*fps;}else{// ...assume skeletal animation\nvar boneName='.bones['+bones[h].name+']';addNonemptyTrack(VectorKeyframeTrack,boneName+'.position',animationKeys,'pos',tracks);addNonemptyTrack(QuaternionKeyframeTrack,boneName+'.quaternion',animationKeys,'rot',tracks);addNonemptyTrack(VectorKeyframeTrack,boneName+'.scale',animationKeys,'scl',tracks);}}if(tracks.length===0){return null;}var clip=new this(clipName,duration,tracks,blendMode);return clip;}}]);return AnimationClip;}();function getTrackTypeForValueTypeName(typeName){switch(typeName.toLowerCase()){case'scalar':case'double':case'float':case'number':case'integer':return NumberKeyframeTrack;case'vector':case'vector2':\ncase'vector3':\ncase'vector4':\n\nreturn VectorKeyframeTrack;\n\ncase'color':\n\nreturn ColorKeyframeTrack;\n\ncase'quaternion':\n\nreturn QuaternionKeyframeTrack;\n\ncase'bool':\ncase'boolean':\n\nreturn BooleanKeyframeTrack;\n\ncase'string':\n\nreturn StringKeyframeTrack;}\n\n\n\nthrow new Error('THREE.KeyframeTrack: Unsupported typeName: '+typeName);\n\n}\n\nfunction parseKeyframeTrack(json){\n\nif(json.type===undefined){\n\nthrow new Error('THREE.KeyframeTrack: track type undefined, can not parse');\n\n}\n\nvar trackType=getTrackTypeForValueTypeName(json.type);\n\nif(json.times===undefined){\n\nvar times=[],values=[];\n\nAnimationUtils.flattenJSON(json.keys,times,values,'value');\n\njson.times=times;\njson.values=values;\n\n}\n\n// derived classes can define a static parse method\nif(trackType.parse!==undefined){\n\nreturn trackType.parse(json);\n\n}else{\n\n// by default, we assume a constructor compatible with the base\nreturn new trackType(json.name,json.times,json.values,json.interpolation);\n\n}\n\n}\n\nvar Cache={\n\nenabled:false,\n\nfiles:{},\n\nadd:function add(key,file){\n\nif(this.enabled===false)return;\n\n// console.log( 'THREE.Cache', 'Adding key:', key );\n\nthis.files[key]=file;\n\n},\n\nget:function get(key){\n\nif(this.enabled===false)return;\n\n// console.log( 'THREE.Cache', 'Checking key:', key );\n\nreturn this.files[key];\n\n},\n\nremove:function remove(key){\n\ndelete this.files[key];\n\n},\n\nclear:function clear(){\n\nthis.files={};\n\n}};var\n\n\n\nLoadingManager=\n\nfunction LoadingManager(onLoad,onProgress,onError){_classCallCheck(this,LoadingManager);\n\nvar scope=this;\n\nvar isLoading=false;\nvar itemsLoaded=0;\nvar itemsTotal=0;\nvar urlModifier=undefined;\nvar handlers=[];\n\n// Refer to #5689 for the reason why we don't set .onStart\n// in the constructor\n\nthis.onStart=undefined;\nthis.onLoad=onLoad;\nthis.onProgress=onProgress;\nthis.onError=onError;\n\nthis.itemStart=function(url){\n\nitemsTotal++;\n\nif(isLoading===false){\n\nif(scope.onStart!==undefined){\n\nscope.onStart(url,itemsLoaded,itemsTotal);\n\n}\n\n}\n\nisLoading=true;\n\n};\n\nthis.itemEnd=function(url){\n\nitemsLoaded++;\n\nif(scope.onProgress!==undefined){\n\nscope.onProgress(url,itemsLoaded,itemsTotal);\n\n}\n\nif(itemsLoaded===itemsTotal){\n\nisLoading=false;\n\nif(scope.onLoad!==undefined){\n\nscope.onLoad();\n\n}\n\n}\n\n};\n\nthis.itemError=function(url){\n\nif(scope.onError!==undefined){\n\nscope.onError(url);\n\n}\n\n};\n\nthis.resolveURL=function(url){\n\nif(urlModifier){\n\nreturn urlModifier(url);\n\n}\n\nreturn url;\n\n};\n\nthis.setURLModifier=function(transform){\n\nurlModifier=transform;\n\nreturn this;\n\n};\n\nthis.addHandler=function(regex,loader){\n\nhandlers.push(regex,loader);\n\nreturn this;\n\n};\n\nthis.removeHandler=function(regex){\n\nvar index=handlers.indexOf(regex);\n\nif(index!==-1){\n\nhandlers.splice(index,2);\n\n}\n\nreturn this;\n\n};\n\nthis.getHandler=function(file){\n\nfor(var i=0,l=handlers.length;i<l;i+=2){\n\nvar regex=handlers[i];\nvar loader=handlers[i+1];\n\nif(regex.global)regex.lastIndex=0;// see #17920\n\nif(regex.test(file)){\n\nreturn loader;\n\n}\n\n}\n\nreturn null;\n\n};\n\n};\n\n\n\nvar DefaultLoadingManager=new LoadingManager();var\n\nLoader=function(){\n\nfunction Loader(manager){_classCallCheck(this,Loader);\n\nthis.manager=manager!==undefined?manager:DefaultLoadingManager;\n\nthis.crossOrigin='anonymous';\nthis.withCredentials=false;\nthis.path='';\nthis.resourcePath='';\nthis.requestHeader={};\n\n}_createClass(Loader,[{key:'load',value:function load()\n\n/* url, onLoad, onProgress, onError */{}},{key:'loadAsync',value:function loadAsync(\n\nurl,onProgress){\n\nvar scope=this;\n\nreturn new Promise(function(resolve,reject){\n\nscope.load(url,resolve,onProgress,reject);\n\n});\n\n}},{key:'parse',value:function parse()\n\n/* data */{}},{key:'setCrossOrigin',value:function setCrossOrigin(\n\ncrossOrigin){\n\nthis.crossOrigin=crossOrigin;\nreturn this;\n\n}},{key:'setWithCredentials',value:function setWithCredentials(\n\nvalue){\n\nthis.withCredentials=value;\nreturn this;\n\n}},{key:'setPath',value:function setPath(\n\npath){\n\nthis.path=path;\nreturn this;\n\n}},{key:'setResourcePath',value:function setResourcePath(\n\nresourcePath){\n\nthis.resourcePath=resourcePath;\nreturn this;\n\n}},{key:'setRequestHeader',value:function setRequestHeader(\n\nrequestHeader){\n\nthis.requestHeader=requestHeader;\nreturn this;\n\n}}]);return Loader;}();\n\n\n\nvar loading={};var\n\nFileLoader=function(_Loader){_inherits(FileLoader,_Loader);\n\nfunction FileLoader(manager){_classCallCheck(this,FileLoader);return _possibleConstructorReturn(this,(FileLoader.__proto__||Object.getPrototypeOf(FileLoader)).call(this,\n\nmanager));\n\n}_createClass(FileLoader,[{key:'load',value:function load(\n\nurl,onLoad,onProgress,onError){var _this112=this;\n\nif(url===undefined)url='';\n\nif(this.path!==undefined)url=this.path+url;\n\nurl=this.manager.resolveURL(url);\n\nvar cached=Cache.get(url);\n\nif(cached!==undefined){\n\nthis.manager.itemStart(url);\n\nsetTimeout(function(){\n\nif(onLoad)onLoad(cached);\n\n_this112.manager.itemEnd(url);\n\n},0);\n\nreturn cached;\n\n}\n\n// Check if request is duplicate\n\nif(loading[url]!==undefined){\n\nloading[url].push({\n\nonLoad:onLoad,\nonProgress:onProgress,\nonError:onError});\n\n\n\nreturn;\n\n}\n\n// Initialise array for duplicate requests\nloading[url]=[];\n\nloading[url].push({\nonLoad:onLoad,\nonProgress:onProgress,\nonError:onError});\n\n\n// create request\nvar req=new Request(url,{\nheaders:new Headers(this.requestHeader),\ncredentials:this.withCredentials?'include':'same-origin'\n// An abort controller could be added within a future PR\n});\n\n// record states ( avoid data race )\nvar mimeType=this.mimeType;\nvar responseType=this.responseType;\n\n// start the fetch\nfetch(req).\nthen(function(response){\n\nif(response.status===200||response.status===0){\n\n// Some browsers return HTTP Status 0 when using non-http protocol\n// e.g. 'file://' or 'data://'. Handle as success.\n\nif(response.status===0){\n\nconsole.warn('THREE.FileLoader: HTTP Status 0 received.');\n\n}\n\n// Workaround: Checking if response.body === undefined for Alipay browser #23548\n\nif(typeof ReadableStream==='undefined'||response.body===undefined||response.body.getReader===undefined){\n\nreturn response;\n\n}\n\nvar callbacks=loading[url];\nvar reader=response.body.getReader();\nvar contentLength=response.headers.get('Content-Length');\nvar total=contentLength?parseInt(contentLength):0;\nvar lengthComputable=total!==0;\nvar loaded=0;\n\n// periodically read data into the new stream tracking while download progress\nvar stream=new ReadableStream({\nstart:function start(controller){\n\nreadData();\n\nfunction readData(){\n\nreader.read().then(function(_ref){var done=_ref.done,value=_ref.value;\n\nif(done){\n\ncontroller.close();\n\n}else{\n\nloaded+=value.byteLength;\n\nvar event=new ProgressEvent('progress',{lengthComputable:lengthComputable,loaded:loaded,total:total});\nfor(var i=0,il=callbacks.length;i<il;i++){\n\nvar callback=callbacks[i];\nif(callback.onProgress)callback.onProgress(event);\n\n}\n\ncontroller.enqueue(value);\nreadData();\n\n}\n\n});\n\n}\n\n}});\n\n\n\nreturn new Response(stream);\n\n}else{\n\nthrow Error('fetch for \"'+response.url+'\" responded with '+response.status+': '+response.statusText);\n\n}\n\n}).\nthen(function(response){\n\nswitch(responseType){\n\ncase'arraybuffer':\n\nreturn response.arrayBuffer();\n\ncase'blob':\n\nreturn response.blob();\n\ncase'document':\n\nreturn response.text().\nthen(function(text){\n\nvar parser=new DOMParser();\nreturn parser.parseFromString(text,mimeType);\n\n});\n\ncase'json':\n\nreturn response.json();\n\ndefault:\n\nif(mimeType===undefined){\n\nreturn response.text();\n\n}else{\n\n// sniff encoding\nvar re=/charset=\"?([^;\"\\s]*)\"?/i;\nvar exec=re.exec(mimeType);\nvar label=exec&&exec[1]?exec[1].toLowerCase():undefined;\nvar decoder=new TextDecoder(label);\nreturn response.arrayBuffer().then(function(ab){return decoder.decode(ab);});\n\n}}\n\n\n\n}).\nthen(function(data){\n\n// Add to cache only on HTTP success, so that we do not cache\n// error response bodies as proper responses to requests.\nCache.add(url,data);\n\nvar callbacks=loading[url];\ndelete loading[url];\n\nfor(var i=0,il=callbacks.length;i<il;i++){\n\nvar callback=callbacks[i];\nif(callback.onLoad)callback.onLoad(data);\n\n}\n\n}).\ncatch(function(err){\n\n// Abort errors and other errors are handled the same\n\nvar callbacks=loading[url];\n\nif(callbacks===undefined){\n\n// When onLoad was called and url was deleted in `loading`\n_this112.manager.itemError(url);\nthrow err;\n\n}\n\ndelete loading[url];\n\nfor(var i=0,il=callbacks.length;i<il;i++){\n\nvar callback=callbacks[i];\nif(callback.onError)callback.onError(err);\n\n}\n\n_this112.manager.itemError(url);\n\n}).\nfinally(function(){\n\n_this112.manager.itemEnd(url);\n\n});\n\nthis.manager.itemStart(url);\n\n}},{key:'setResponseType',value:function setResponseType(\n\nvalue){\n\nthis.responseType=value;\nreturn this;\n\n}},{key:'setMimeType',value:function setMimeType(\n\nvalue){\n\nthis.mimeType=value;\nreturn this;\n\n}}]);return FileLoader;}(Loader);var\n\n\n\nAnimationLoader=function(_Loader2){_inherits(AnimationLoader,_Loader2);\n\nfunction AnimationLoader(manager){_classCallCheck(this,AnimationLoader);return _possibleConstructorReturn(this,(AnimationLoader.__proto__||Object.getPrototypeOf(AnimationLoader)).call(this,\n\nmanager));\n\n}_createClass(AnimationLoader,[{key:'load',value:function load(\n\nurl,onLoad,onProgress,onError){\n\nvar scope=this;\n\nvar loader=new FileLoader(this.manager);\nloader.setPath(this.path);\nloader.setRequestHeader(this.requestHeader);\nloader.setWithCredentials(this.withCredentials);\nloader.load(url,function(text){\n\ntry{\n\nonLoad(scope.parse(JSON.parse(text)));\n\n}catch(e){\n\nif(onError){\n\nonError(e);\n\n}else{\n\nconsole.error(e);\n\n}\n\nscope.manager.itemError(url);\n\n}\n\n},onProgress,onError);\n\n}},{key:'parse',value:function parse(\n\njson){\n\nvar animations=[];\n\nfor(var i=0;i<json.length;i++){\n\nvar clip=AnimationClip.parse(json[i]);\n\nanimations.push(clip);\n\n}\n\nreturn animations;\n\n}}]);return AnimationLoader;}(Loader);\n\n\n\n/**\n * Abstract Base class to block based textures loader (dds, pvr, ...)\n *\n * Sub classes have to implement the parse() method which will be used in load().\n */var\n\nCompressedTextureLoader=function(_Loader3){_inherits(CompressedTextureLoader,_Loader3);\n\nfunction CompressedTextureLoader(manager){_classCallCheck(this,CompressedTextureLoader);return _possibleConstructorReturn(this,(CompressedTextureLoader.__proto__||Object.getPrototypeOf(CompressedTextureLoader)).call(this,\n\nmanager));\n\n}_createClass(CompressedTextureLoader,[{key:'load',value:function load(\n\nurl,onLoad,onProgress,onError){\n\nvar scope=this;\n\nvar images=[];\n\nvar texture=new CompressedTexture();\n\nvar loader=new FileLoader(this.manager);\nloader.setPath(this.path);\nloader.setResponseType('arraybuffer');\nloader.setRequestHeader(this.requestHeader);\nloader.setWithCredentials(scope.withCredentials);\n\nvar loaded=0;\n\nfunction loadTexture(i){\n\nloader.load(url[i],function(buffer){\n\nvar texDatas=scope.parse(buffer,true);\n\nimages[i]={\nwidth:texDatas.width,\nheight:texDatas.height,\nformat:texDatas.format,\nmipmaps:texDatas.mipmaps};\n\n\nloaded+=1;\n\nif(loaded===6){\n\nif(texDatas.mipmapCount===1)texture.minFilter=LinearFilter;\n\ntexture.image=images;\ntexture.format=texDatas.format;\ntexture.needsUpdate=true;\n\nif(onLoad)onLoad(texture);\n\n}\n\n},onProgress,onError);\n\n}\n\nif(Array.isArray(url)){\n\nfor(var i=0,il=url.length;i<il;++i){\n\nloadTexture(i);\n\n}\n\n}else{\n\n// compressed cubemap texture stored in a single DDS file\n\nloader.load(url,function(buffer){\n\nvar texDatas=scope.parse(buffer,true);\n\nif(texDatas.isCubemap){\n\nvar faces=texDatas.mipmaps.length/texDatas.mipmapCount;\n\nfor(var f=0;f<faces;f++){\n\nimages[f]={mipmaps:[]};\n\nfor(var _i84=0;_i84<texDatas.mipmapCount;_i84++){\n\nimages[f].mipmaps.push(texDatas.mipmaps[f*texDatas.mipmapCount+_i84]);\nimages[f].format=texDatas.format;\nimages[f].width=texDatas.width;\nimages[f].height=texDatas.height;\n\n}\n\n}\n\ntexture.image=images;\n\n}else{\n\ntexture.image.width=texDatas.width;\ntexture.image.height=texDatas.height;\ntexture.mipmaps=texDatas.mipmaps;\n\n}\n\nif(texDatas.mipmapCount===1){\n\ntexture.minFilter=LinearFilter;\n\n}\n\ntexture.format=texDatas.format;\ntexture.needsUpdate=true;\n\nif(onLoad)onLoad(texture);\n\n},onProgress,onError);\n\n}\n\nreturn texture;\n\n}}]);return CompressedTextureLoader;}(Loader);var\n\n\n\nImageLoader=function(_Loader4){_inherits(ImageLoader,_Loader4);\n\nfunction ImageLoader(manager){_classCallCheck(this,ImageLoader);return _possibleConstructorReturn(this,(ImageLoader.__proto__||Object.getPrototypeOf(ImageLoader)).call(this,\n\nmanager));\n\n}_createClass(ImageLoader,[{key:'load',value:function load(\n\nurl,onLoad,onProgress,onError){\n\nif(this.path!==undefined)url=this.path+url;\n\nurl=this.manager.resolveURL(url);\n\nvar scope=this;\n\nvar cached=Cache.get(url);\n\nif(cached!==undefined){\n\nscope.manager.itemStart(url);\n\nsetTimeout(function(){\n\nif(onLoad)onLoad(cached);\n\nscope.manager.itemEnd(url);\n\n},0);\n\nreturn cached;\n\n}\n\nvar image=createElementNS('img');\n\nfunction onImageLoad(){\n\nremoveEventListeners();\n\nCache.add(url,this);\n\nif(onLoad)onLoad(this);\n\nscope.manager.itemEnd(url);\n\n}\n\nfunction onImageError(event){\n\nremoveEventListeners();\n\nif(onError)onError(event);\n\nscope.manager.itemError(url);\nscope.manager.itemEnd(url);\n\n}\n\nfunction removeEventListeners(){\n\nimage.removeEventListener('load',onImageLoad,false);\nimage.removeEventListener('error',onImageError,false);\n\n}\n\nimage.addEventListener('load',onImageLoad,false);\nimage.addEventListener('error',onImageError,false);\n\nif(url.slice(0,5)!=='data:'){\n\nif(this.crossOrigin!==undefined)image.crossOrigin=this.crossOrigin;\n\n}\n\nscope.manager.itemStart(url);\n\nimage.src=url;\n\nreturn image;\n\n}}]);return ImageLoader;}(Loader);var\n\n\n\nCubeTextureLoader=function(_Loader5){_inherits(CubeTextureLoader,_Loader5);\n\nfunction CubeTextureLoader(manager){_classCallCheck(this,CubeTextureLoader);return _possibleConstructorReturn(this,(CubeTextureLoader.__proto__||Object.getPrototypeOf(CubeTextureLoader)).call(this,\n\nmanager));\n\n}_createClass(CubeTextureLoader,[{key:'load',value:function load(\n\nurls,onLoad,onProgress,onError){\n\nvar texture=new CubeTexture();\n\nvar loader=new ImageLoader(this.manager);\nloader.setCrossOrigin(this.crossOrigin);\nloader.setPath(this.path);\n\nvar loaded=0;\n\nfunction loadTexture(i){\n\nloader.load(urls[i],function(image){\n\ntexture.images[i]=image;\n\nloaded++;\n\nif(loaded===6){\n\ntexture.needsUpdate=true;\n\nif(onLoad)onLoad(texture);\n\n}\n\n},undefined,onError);\n\n}\n\nfor(var i=0;i<urls.length;++i){\n\nloadTexture(i);\n\n}\n\nreturn texture;\n\n}}]);return CubeTextureLoader;}(Loader);\n\n\n\n/**\n * Abstract Base class to load generic binary textures formats (rgbe, hdr, ...)\n *\n * Sub classes have to implement the parse() method which will be used in load().\n */var\n\nDataTextureLoader=function(_Loader6){_inherits(DataTextureLoader,_Loader6);\n\nfunction DataTextureLoader(manager){_classCallCheck(this,DataTextureLoader);return _possibleConstructorReturn(this,(DataTextureLoader.__proto__||Object.getPrototypeOf(DataTextureLoader)).call(this,\n\nmanager));\n\n}_createClass(DataTextureLoader,[{key:'load',value:function load(\n\nurl,onLoad,onProgress,onError){\n\nvar scope=this;\n\nvar texture=new DataTexture();\n\nvar loader=new FileLoader(this.manager);\nloader.setResponseType('arraybuffer');\nloader.setRequestHeader(this.requestHeader);\nloader.setPath(this.path);\nloader.setWithCredentials(scope.withCredentials);\nloader.load(url,function(buffer){\n\nvar texData=scope.parse(buffer);\n\nif(!texData)return;\n\nif(texData.image!==undefined){\n\ntexture.image=texData.image;\n\n}else if(texData.data!==undefined){\n\ntexture.image.width=texData.width;\ntexture.image.height=texData.height;\ntexture.image.data=texData.data;\n\n}\n\ntexture.wrapS=texData.wrapS!==undefined?texData.wrapS:ClampToEdgeWrapping;\ntexture.wrapT=texData.wrapT!==undefined?texData.wrapT:ClampToEdgeWrapping;\n\ntexture.magFilter=texData.magFilter!==undefined?texData.magFilter:LinearFilter;\ntexture.minFilter=texData.minFilter!==undefined?texData.minFilter:LinearFilter;\n\ntexture.anisotropy=texData.anisotropy!==undefined?texData.anisotropy:1;\n\nif(texData.encoding!==undefined){\n\ntexture.encoding=texData.encoding;\n\n}\n\nif(texData.flipY!==undefined){\n\ntexture.flipY=texData.flipY;\n\n}\n\nif(texData.format!==undefined){\n\ntexture.format=texData.format;\n\n}\n\nif(texData.type!==undefined){\n\ntexture.type=texData.type;\n\n}\n\nif(texData.mipmaps!==undefined){\n\ntexture.mipmaps=texData.mipmaps;\ntexture.minFilter=LinearMipmapLinearFilter;// presumably...\n\n}\n\nif(texData.mipmapCount===1){\n\ntexture.minFilter=LinearFilter;\n\n}\n\nif(texData.generateMipmaps!==undefined){\n\ntexture.generateMipmaps=texData.generateMipmaps;\n\n}\n\ntexture.needsUpdate=true;\n\nif(onLoad)onLoad(texture,texData);\n\n},onProgress,onError);\n\n\nreturn texture;\n\n}}]);return DataTextureLoader;}(Loader);var\n\n\n\nTextureLoader=function(_Loader7){_inherits(TextureLoader,_Loader7);\n\nfunction TextureLoader(manager){_classCallCheck(this,TextureLoader);return _possibleConstructorReturn(this,(TextureLoader.__proto__||Object.getPrototypeOf(TextureLoader)).call(this,\n\nmanager));\n\n}_createClass(TextureLoader,[{key:'load',value:function load(\n\nurl,onLoad,onProgress,onError){\n\nvar texture=new Texture();\n\nvar loader=new ImageLoader(this.manager);\nloader.setCrossOrigin(this.crossOrigin);\nloader.setPath(this.path);\n\nloader.load(url,function(image){\n\ntexture.image=image;\ntexture.needsUpdate=true;\n\nif(onLoad!==undefined){\n\nonLoad(texture);\n\n}\n\n},onProgress,onError);\n\nreturn texture;\n\n}}]);return TextureLoader;}(Loader);var\n\n\n\nLight=function(_Object3D11){_inherits(Light,_Object3D11);\n\nfunction Light(color){var intensity=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1;_classCallCheck(this,Light);var _this119=_possibleConstructorReturn(this,(Light.__proto__||Object.getPrototypeOf(Light)).call(this));\n\n\n\n_this119.isLight=true;\n\n_this119.type='Light';\n\n_this119.color=new Color(color);\n_this119.intensity=intensity;return _this119;\n\n}_createClass(Light,[{key:'dispose',value:function dispose()\n\n{\n\n// Empty here in base class; some subclasses override.\n\n}},{key:'copy',value:function copy(\n\nsource,recursive){\n\n_get(Light.prototype.__proto__||Object.getPrototypeOf(Light.prototype),'copy',this).call(this,source,recursive);\n\nthis.color.copy(source.color);\nthis.intensity=source.intensity;\n\nreturn this;\n\n}},{key:'toJSON',value:function toJSON(\n\nmeta){\n\nvar data=_get(Light.prototype.__proto__||Object.getPrototypeOf(Light.prototype),'toJSON',this).call(this,meta);\n\ndata.object.color=this.color.getHex();\ndata.object.intensity=this.intensity;\n\nif(this.groundColor!==undefined)data.object.groundColor=this.groundColor.getHex();\n\nif(this.distance!==undefined)data.object.distance=this.distance;\nif(this.angle!==undefined)data.object.angle=this.angle;\nif(this.decay!==undefined)data.object.decay=this.decay;\nif(this.penumbra!==undefined)data.object.penumbra=this.penumbra;\n\nif(this.shadow!==undefined)data.object.shadow=this.shadow.toJSON();\n\nreturn data;\n\n}}]);return Light;}(Object3D);var\n\n\n\nHemisphereLight=function(_Light){_inherits(HemisphereLight,_Light);\n\nfunction HemisphereLight(skyColor,groundColor,intensity){_classCallCheck(this,HemisphereLight);var _this120=_possibleConstructorReturn(this,(HemisphereLight.__proto__||Object.getPrototypeOf(HemisphereLight)).call(this,\n\nskyColor,intensity));\n\n_this120.isHemisphereLight=true;\n\n_this120.type='HemisphereLight';\n\n_this120.position.copy(Object3D.DefaultUp);\n_this120.updateMatrix();\n\n_this120.groundColor=new Color(groundColor);return _this120;\n\n}_createClass(HemisphereLight,[{key:'copy',value:function copy(\n\nsource,recursive){\n\n_get(HemisphereLight.prototype.__proto__||Object.getPrototypeOf(HemisphereLight.prototype),'copy',this).call(this,source,recursive);\n\nthis.groundColor.copy(source.groundColor);\n\nreturn this;\n\n}}]);return HemisphereLight;}(Light);\n\n\n\nvar _projScreenMatrix$1=/*@__PURE__*/new Matrix4();\nvar _lightPositionWorld$1=/*@__PURE__*/new Vector3();\nvar _lookTarget$1=/*@__PURE__*/new Vector3();var\n\nLightShadow=function(){\n\nfunction LightShadow(camera){_classCallCheck(this,LightShadow);\n\nthis.camera=camera;\n\nthis.bias=0;\nthis.normalBias=0;\nthis.radius=1;\nthis.blurSamples=8;\n\nthis.mapSize=new Vector2(512,512);\n\nthis.map=null;\nthis.mapPass=null;\nthis.matrix=new Matrix4();\n\nthis.autoUpdate=true;\nthis.needsUpdate=false;\n\nthis._frustum=new Frustum();\nthis._frameExtents=new Vector2(1,1);\n\nthis._viewportCount=1;\n\nthis._viewports=[\n\nnew Vector4(0,0,1,1)];\n\n\n\n}_createClass(LightShadow,[{key:'getViewportCount',value:function getViewportCount()\n\n{\n\nreturn this._viewportCount;\n\n}},{key:'getFrustum',value:function getFrustum()\n\n{\n\nreturn this._frustum;\n\n}},{key:'updateMatrices',value:function updateMatrices(\n\nlight){\n\nvar shadowCamera=this.camera;\nvar shadowMatrix=this.matrix;\n\n_lightPositionWorld$1.setFromMatrixPosition(light.matrixWorld);\nshadowCamera.position.copy(_lightPositionWorld$1);\n\n_lookTarget$1.setFromMatrixPosition(light.target.matrixWorld);\nshadowCamera.lookAt(_lookTarget$1);\nshadowCamera.updateMatrixWorld();\n\n_projScreenMatrix$1.multiplyMatrices(shadowCamera.projectionMatrix,shadowCamera.matrixWorldInverse);\nthis._frustum.setFromProjectionMatrix(_projScreenMatrix$1);\n\nshadowMatrix.set(\n0.5,0.0,0.0,0.5,\n0.0,0.5,0.0,0.5,\n0.0,0.0,0.5,0.5,\n0.0,0.0,0.0,1.0);\n\n\nshadowMatrix.multiply(shadowCamera.projectionMatrix);\nshadowMatrix.multiply(shadowCamera.matrixWorldInverse);\n\n}},{key:'getViewport',value:function getViewport(\n\nviewportIndex){\n\nreturn this._viewports[viewportIndex];\n\n}},{key:'getFrameExtents',value:function getFrameExtents()\n\n{\n\nreturn this._frameExtents;\n\n}},{key:'dispose',value:function dispose()\n\n{\n\nif(this.map){\n\nthis.map.dispose();\n\n}\n\nif(this.mapPass){\n\nthis.mapPass.dispose();\n\n}\n\n}},{key:'copy',value:function copy(\n\nsource){\n\nthis.camera=source.camera.clone();\n\nthis.bias=source.bias;\nthis.radius=source.radius;\n\nthis.mapSize.copy(source.mapSize);\n\nreturn this;\n\n}},{key:'clone',value:function clone()\n\n{\n\nreturn new this.constructor().copy(this);\n\n}},{key:'toJSON',value:function toJSON()\n\n{\n\nvar object={};\n\nif(this.bias!==0)object.bias=this.bias;\nif(this.normalBias!==0)object.normalBias=this.normalBias;\nif(this.radius!==1)object.radius=this.radius;\nif(this.mapSize.x!==512||this.mapSize.y!==512)object.mapSize=this.mapSize.toArray();\n\nobject.camera=this.camera.toJSON(false).object;\ndelete object.camera.matrix;\n\nreturn object;\n\n}}]);return LightShadow;}();var\n\n\n\nSpotLightShadow=function(_LightShadow){_inherits(SpotLightShadow,_LightShadow);\n\nfunction SpotLightShadow(){_classCallCheck(this,SpotLightShadow);var _this121=_possibleConstructorReturn(this,(SpotLightShadow.__proto__||Object.getPrototypeOf(SpotLightShadow)).call(this,\n\nnew PerspectiveCamera(50,1,0.5,500)));\n\n_this121.isSpotLightShadow=true;\n\n_this121.focus=1;return _this121;\n\n}_createClass(SpotLightShadow,[{key:'updateMatrices',value:function updateMatrices(\n\nlight){\n\nvar camera=this.camera;\n\nvar fov=RAD2DEG*2*light.angle*this.focus;\nvar aspect=this.mapSize.width/this.mapSize.height;\nvar far=light.distance||camera.far;\n\nif(fov!==camera.fov||aspect!==camera.aspect||far!==camera.far){\n\ncamera.fov=fov;\ncamera.aspect=aspect;\ncamera.far=far;\ncamera.updateProjectionMatrix();\n\n}\n\n_get(SpotLightShadow.prototype.__proto__||Object.getPrototypeOf(SpotLightShadow.prototype),'updateMatrices',this).call(this,light);\n\n}},{key:'copy',value:function copy(\n\nsource){\n\n_get(SpotLightShadow.prototype.__proto__||Object.getPrototypeOf(SpotLightShadow.prototype),'copy',this).call(this,source);\n\nthis.focus=source.focus;\n\nreturn this;\n\n}}]);return SpotLightShadow;}(LightShadow);var\n\n\n\nSpotLight=function(_Light2){_inherits(SpotLight,_Light2);\n\nfunction SpotLight(color,intensity){var distance=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var angle=arguments.length>3&&arguments[3]!==undefined?arguments[3]:Math.PI/3;var penumbra=arguments.length>4&&arguments[4]!==undefined?arguments[4]:0;var decay=arguments.length>5&&arguments[5]!==undefined?arguments[5]:1;_classCallCheck(this,SpotLight);var _this122=_possibleConstructorReturn(this,(SpotLight.__proto__||Object.getPrototypeOf(SpotLight)).call(this,\n\ncolor,intensity));\n\n_this122.isSpotLight=true;\n\n_this122.type='SpotLight';\n\n_this122.position.copy(Object3D.DefaultUp);\n_this122.updateMatrix();\n\n_this122.target=new Object3D();\n\n_this122.distance=distance;\n_this122.angle=angle;\n_this122.penumbra=penumbra;\n_this122.decay=decay;// for physically correct lights, should be 2.\n\n_this122.shadow=new SpotLightShadow();return _this122;\n\n}_createClass(SpotLight,[{key:'dispose',value:function dispose()\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n{\n\nthis.shadow.dispose();\n\n}},{key:'copy',value:function copy(\n\nsource,recursive){\n\n_get(SpotLight.prototype.__proto__||Object.getPrototypeOf(SpotLight.prototype),'copy',this).call(this,source,recursive);\n\nthis.distance=source.distance;\nthis.angle=source.angle;\nthis.penumbra=source.penumbra;\nthis.decay=source.decay;\n\nthis.target=source.target.clone();\n\nthis.shadow=source.shadow.clone();\n\nreturn this;\n\n}},{key:'power',get:function get(){// compute the light's luminous power (in lumens) from its intensity (in candela)\n// by convention for a spotlight, luminous power (lm) =  * luminous intensity (cd)\nreturn this.intensity*Math.PI;},set:function set(power){// set the light's intensity (in candela) from the desired luminous power (in lumens)\nthis.intensity=power/Math.PI;}}]);return SpotLight;}(Light);\nvar _projScreenMatrix=/*@__PURE__*/new Matrix4();\nvar _lightPositionWorld=/*@__PURE__*/new Vector3();\nvar _lookTarget=/*@__PURE__*/new Vector3();var\n\nPointLightShadow=function(_LightShadow2){_inherits(PointLightShadow,_LightShadow2);\n\nfunction PointLightShadow(){_classCallCheck(this,PointLightShadow);var _this123=_possibleConstructorReturn(this,(PointLightShadow.__proto__||Object.getPrototypeOf(PointLightShadow)).call(this,\n\nnew PerspectiveCamera(90,1,0.5,500)));\n\n_this123.isPointLightShadow=true;\n\n_this123._frameExtents=new Vector2(4,2);\n\n_this123._viewportCount=6;\n\n_this123._viewports=[\n// These viewports map a cube-map onto a 2D texture with the\n// following orientation:\n//\n//  xzXZ\n//   y Y\n//\n// X - Positive x direction\n// x - Negative x direction\n// Y - Positive y direction\n// y - Negative y direction\n// Z - Positive z direction\n// z - Negative z direction\n\n// positive X\nnew Vector4(2,1,1,1),\n// negative X\nnew Vector4(0,1,1,1),\n// positive Z\nnew Vector4(3,1,1,1),\n// negative Z\nnew Vector4(1,1,1,1),\n// positive Y\nnew Vector4(3,0,1,1),\n// negative Y\nnew Vector4(1,0,1,1)];\n\n\n_this123._cubeDirections=[\nnew Vector3(1,0,0),new Vector3(-1,0,0),new Vector3(0,0,1),\nnew Vector3(0,0,-1),new Vector3(0,1,0),new Vector3(0,-1,0)];\n\n\n_this123._cubeUps=[\nnew Vector3(0,1,0),new Vector3(0,1,0),new Vector3(0,1,0),\nnew Vector3(0,1,0),new Vector3(0,0,1),new Vector3(0,0,-1)];return _this123;\n\n\n}_createClass(PointLightShadow,[{key:'updateMatrices',value:function updateMatrices(\n\nlight){var viewportIndex=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;\n\nvar camera=this.camera;\nvar shadowMatrix=this.matrix;\n\nvar far=light.distance||camera.far;\n\nif(far!==camera.far){\n\ncamera.far=far;\ncamera.updateProjectionMatrix();\n\n}\n\n_lightPositionWorld.setFromMatrixPosition(light.matrixWorld);\ncamera.position.copy(_lightPositionWorld);\n\n_lookTarget.copy(camera.position);\n_lookTarget.add(this._cubeDirections[viewportIndex]);\ncamera.up.copy(this._cubeUps[viewportIndex]);\ncamera.lookAt(_lookTarget);\ncamera.updateMatrixWorld();\n\nshadowMatrix.makeTranslation(-_lightPositionWorld.x,-_lightPositionWorld.y,-_lightPositionWorld.z);\n\n_projScreenMatrix.multiplyMatrices(camera.projectionMatrix,camera.matrixWorldInverse);\nthis._frustum.setFromProjectionMatrix(_projScreenMatrix);\n\n}}]);return PointLightShadow;}(LightShadow);var\n\n\n\nPointLight=function(_Light3){_inherits(PointLight,_Light3);\n\nfunction PointLight(color,intensity){var distance=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var decay=arguments.length>3&&arguments[3]!==undefined?arguments[3]:1;_classCallCheck(this,PointLight);var _this124=_possibleConstructorReturn(this,(PointLight.__proto__||Object.getPrototypeOf(PointLight)).call(this,\n\ncolor,intensity));\n\n_this124.isPointLight=true;\n\n_this124.type='PointLight';\n\n_this124.distance=distance;\n_this124.decay=decay;// for physically correct lights, should be 2.\n\n_this124.shadow=new PointLightShadow();return _this124;\n\n}_createClass(PointLight,[{key:'dispose',value:function dispose()\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n{\n\nthis.shadow.dispose();\n\n}},{key:'copy',value:function copy(\n\nsource,recursive){\n\n_get(PointLight.prototype.__proto__||Object.getPrototypeOf(PointLight.prototype),'copy',this).call(this,source,recursive);\n\nthis.distance=source.distance;\nthis.decay=source.decay;\n\nthis.shadow=source.shadow.clone();\n\nreturn this;\n\n}},{key:'power',get:function get(){// compute the light's luminous power (in lumens) from its intensity (in candela)\n// for an isotropic light source, luminous power (lm) = 4  luminous intensity (cd)\nreturn this.intensity*4*Math.PI;},set:function set(power){// set the light's intensity (in candela) from the desired luminous power (in lumens)\nthis.intensity=power/(4*Math.PI);}}]);return PointLight;}(Light);var\nDirectionalLightShadow=function(_LightShadow3){_inherits(DirectionalLightShadow,_LightShadow3);\n\nfunction DirectionalLightShadow(){_classCallCheck(this,DirectionalLightShadow);var _this125=_possibleConstructorReturn(this,(DirectionalLightShadow.__proto__||Object.getPrototypeOf(DirectionalLightShadow)).call(this,\n\nnew OrthographicCamera(-5,5,5,-5,0.5,500)));\n\n_this125.isDirectionalLightShadow=true;return _this125;\n\n}return DirectionalLightShadow;}(LightShadow);var\n\n\n\nDirectionalLight=function(_Light4){_inherits(DirectionalLight,_Light4);\n\nfunction DirectionalLight(color,intensity){_classCallCheck(this,DirectionalLight);var _this126=_possibleConstructorReturn(this,(DirectionalLight.__proto__||Object.getPrototypeOf(DirectionalLight)).call(this,\n\ncolor,intensity));\n\n_this126.isDirectionalLight=true;\n\n_this126.type='DirectionalLight';\n\n_this126.position.copy(Object3D.DefaultUp);\n_this126.updateMatrix();\n\n_this126.target=new Object3D();\n\n_this126.shadow=new DirectionalLightShadow();return _this126;\n\n}_createClass(DirectionalLight,[{key:'dispose',value:function dispose()\n\n{\n\nthis.shadow.dispose();\n\n}},{key:'copy',value:function copy(\n\nsource){\n\n_get(DirectionalLight.prototype.__proto__||Object.getPrototypeOf(DirectionalLight.prototype),'copy',this).call(this,source);\n\nthis.target=source.target.clone();\nthis.shadow=source.shadow.clone();\n\nreturn this;\n\n}}]);return DirectionalLight;}(Light);var\n\n\n\nAmbientLight=function(_Light5){_inherits(AmbientLight,_Light5);\n\nfunction AmbientLight(color,intensity){_classCallCheck(this,AmbientLight);var _this127=_possibleConstructorReturn(this,(AmbientLight.__proto__||Object.getPrototypeOf(AmbientLight)).call(this,\n\ncolor,intensity));\n\n_this127.isAmbientLight=true;\n\n_this127.type='AmbientLight';return _this127;\n\n}return AmbientLight;}(Light);var\n\n\n\nRectAreaLight=function(_Light6){_inherits(RectAreaLight,_Light6);\n\nfunction RectAreaLight(color,intensity){var width=arguments.length>2&&arguments[2]!==undefined?arguments[2]:10;var height=arguments.length>3&&arguments[3]!==undefined?arguments[3]:10;_classCallCheck(this,RectAreaLight);var _this128=_possibleConstructorReturn(this,(RectAreaLight.__proto__||Object.getPrototypeOf(RectAreaLight)).call(this,\n\ncolor,intensity));\n\n_this128.isRectAreaLight=true;\n\n_this128.type='RectAreaLight';\n\n_this128.width=width;\n_this128.height=height;return _this128;\n\n}_createClass(RectAreaLight,[{key:'copy',value:function copy(\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nsource){\n\n_get(RectAreaLight.prototype.__proto__||Object.getPrototypeOf(RectAreaLight.prototype),'copy',this).call(this,source);\n\nthis.width=source.width;\nthis.height=source.height;\n\nreturn this;\n\n}},{key:'toJSON',value:function toJSON(\n\nmeta){\n\nvar data=_get(RectAreaLight.prototype.__proto__||Object.getPrototypeOf(RectAreaLight.prototype),'toJSON',this).call(this,meta);\n\ndata.object.width=this.width;\ndata.object.height=this.height;\n\nreturn data;\n\n}},{key:'power',get:function get(){// compute the light's luminous power (in lumens) from its intensity (in nits)\nreturn this.intensity*this.width*this.height*Math.PI;},set:function set(power){// set the light's intensity (in nits) from the desired luminous power (in lumens)\nthis.intensity=power/(this.width*this.height*Math.PI);}}]);return RectAreaLight;}(Light);\n\n/**\n * Primary reference:\n *   https://graphics.stanford.edu/papers/envmap/envmap.pdf\n *\n * Secondary reference:\n *   https://www.ppsloan.org/publications/StupidSH36.pdf\n */\n\n// 3-band SH defined by 9 coefficients\nvar\nSphericalHarmonics3=function(){\n\nfunction SphericalHarmonics3(){_classCallCheck(this,SphericalHarmonics3);\n\nthis.isSphericalHarmonics3=true;\n\nthis.coefficients=[];\n\nfor(var i=0;i<9;i++){\n\nthis.coefficients.push(new Vector3());\n\n}\n\n}_createClass(SphericalHarmonics3,[{key:'set',value:function set(\n\ncoefficients){\n\nfor(var i=0;i<9;i++){\n\nthis.coefficients[i].copy(coefficients[i]);\n\n}\n\nreturn this;\n\n}},{key:'zero',value:function zero()\n\n{\n\nfor(var i=0;i<9;i++){\n\nthis.coefficients[i].set(0,0,0);\n\n}\n\nreturn this;\n\n}\n\n// get the radiance in the direction of the normal\n// target is a Vector3\n},{key:'getAt',value:function getAt(normal,target){\n\n// normal is assumed to be unit length\n\nvar x=normal.x,y=normal.y,z=normal.z;\n\nvar coeff=this.coefficients;\n\n// band 0\ntarget.copy(coeff[0]).multiplyScalar(0.282095);\n\n// band 1\ntarget.addScaledVector(coeff[1],0.488603*y);\ntarget.addScaledVector(coeff[2],0.488603*z);\ntarget.addScaledVector(coeff[3],0.488603*x);\n\n// band 2\ntarget.addScaledVector(coeff[4],1.092548*(x*y));\ntarget.addScaledVector(coeff[5],1.092548*(y*z));\ntarget.addScaledVector(coeff[6],0.315392*(3.0*z*z-1.0));\ntarget.addScaledVector(coeff[7],1.092548*(x*z));\ntarget.addScaledVector(coeff[8],0.546274*(x*x-y*y));\n\nreturn target;\n\n}\n\n// get the irradiance (radiance convolved with cosine lobe) in the direction of the normal\n// target is a Vector3\n// https://graphics.stanford.edu/papers/envmap/envmap.pdf\n},{key:'getIrradianceAt',value:function getIrradianceAt(normal,target){\n\n// normal is assumed to be unit length\n\nvar x=normal.x,y=normal.y,z=normal.z;\n\nvar coeff=this.coefficients;\n\n// band 0\ntarget.copy(coeff[0]).multiplyScalar(0.886227);//  * 0.282095\n\n// band 1\ntarget.addScaledVector(coeff[1],2.0*0.511664*y);// ( 2 *  / 3 ) * 0.488603\ntarget.addScaledVector(coeff[2],2.0*0.511664*z);\ntarget.addScaledVector(coeff[3],2.0*0.511664*x);\n\n// band 2\ntarget.addScaledVector(coeff[4],2.0*0.429043*x*y);// (  / 4 ) * 1.092548\ntarget.addScaledVector(coeff[5],2.0*0.429043*y*z);\ntarget.addScaledVector(coeff[6],0.743125*z*z-0.247708);// (  / 4 ) * 0.315392 * 3\ntarget.addScaledVector(coeff[7],2.0*0.429043*x*z);\ntarget.addScaledVector(coeff[8],0.429043*(x*x-y*y));// (  / 4 ) * 0.546274\n\nreturn target;\n\n}},{key:'add',value:function add(\n\nsh){\n\nfor(var i=0;i<9;i++){\n\nthis.coefficients[i].add(sh.coefficients[i]);\n\n}\n\nreturn this;\n\n}},{key:'addScaledSH',value:function addScaledSH(\n\nsh,s){\n\nfor(var i=0;i<9;i++){\n\nthis.coefficients[i].addScaledVector(sh.coefficients[i],s);\n\n}\n\nreturn this;\n\n}},{key:'scale',value:function scale(\n\ns){\n\nfor(var i=0;i<9;i++){\n\nthis.coefficients[i].multiplyScalar(s);\n\n}\n\nreturn this;\n\n}},{key:'lerp',value:function lerp(\n\nsh,alpha){\n\nfor(var i=0;i<9;i++){\n\nthis.coefficients[i].lerp(sh.coefficients[i],alpha);\n\n}\n\nreturn this;\n\n}},{key:'equals',value:function equals(\n\nsh){\n\nfor(var i=0;i<9;i++){\n\nif(!this.coefficients[i].equals(sh.coefficients[i])){\n\nreturn false;\n\n}\n\n}\n\nreturn true;\n\n}},{key:'copy',value:function copy(\n\nsh){\n\nreturn this.set(sh.coefficients);\n\n}},{key:'clone',value:function clone()\n\n{\n\nreturn new this.constructor().copy(this);\n\n}},{key:'fromArray',value:function fromArray(\n\narray){var offset=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;\n\nvar coefficients=this.coefficients;\n\nfor(var i=0;i<9;i++){\n\ncoefficients[i].fromArray(array,offset+i*3);\n\n}\n\nreturn this;\n\n}},{key:'toArray',value:function toArray()\n\n{var array=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];var offset=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;\n\nvar coefficients=this.coefficients;\n\nfor(var i=0;i<9;i++){\n\ncoefficients[i].toArray(array,offset+i*3);\n\n}\n\nreturn array;\n\n}\n\n// evaluate the basis functions\n// shBasis is an Array[ 9 ]\n}],[{key:'getBasisAt',value:function getBasisAt(normal,shBasis){\n\n// normal is assumed to be unit length\n\nvar x=normal.x,y=normal.y,z=normal.z;\n\n// band 0\nshBasis[0]=0.282095;\n\n// band 1\nshBasis[1]=0.488603*y;\nshBasis[2]=0.488603*z;\nshBasis[3]=0.488603*x;\n\n// band 2\nshBasis[4]=1.092548*x*y;\nshBasis[5]=1.092548*y*z;\nshBasis[6]=0.315392*(3*z*z-1);\nshBasis[7]=1.092548*x*z;\nshBasis[8]=0.546274*(x*x-y*y);\n\n}}]);return SphericalHarmonics3;}();var\n\n\n\nLightProbe=function(_Light7){_inherits(LightProbe,_Light7);\n\nfunction LightProbe(){var sh=arguments.length>0&&arguments[0]!==undefined?arguments[0]:new SphericalHarmonics3();var intensity=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1;_classCallCheck(this,LightProbe);var _this129=_possibleConstructorReturn(this,(LightProbe.__proto__||Object.getPrototypeOf(LightProbe)).call(this,\n\nundefined,intensity));\n\n_this129.isLightProbe=true;\n\n_this129.sh=sh;return _this129;\n\n}_createClass(LightProbe,[{key:'copy',value:function copy(\n\nsource){\n\n_get(LightProbe.prototype.__proto__||Object.getPrototypeOf(LightProbe.prototype),'copy',this).call(this,source);\n\nthis.sh.copy(source.sh);\n\nreturn this;\n\n}},{key:'fromJSON',value:function fromJSON(\n\njson){\n\nthis.intensity=json.intensity;// TODO: Move this bit to Light.fromJSON();\nthis.sh.fromArray(json.sh);\n\nreturn this;\n\n}},{key:'toJSON',value:function toJSON(\n\nmeta){\n\nvar data=_get(LightProbe.prototype.__proto__||Object.getPrototypeOf(LightProbe.prototype),'toJSON',this).call(this,meta);\n\ndata.object.sh=this.sh.toArray();\n\nreturn data;\n\n}}]);return LightProbe;}(Light);var\n\n\n\nMaterialLoader=function(_Loader8){_inherits(MaterialLoader,_Loader8);\n\nfunction MaterialLoader(manager){_classCallCheck(this,MaterialLoader);var _this130=_possibleConstructorReturn(this,(MaterialLoader.__proto__||Object.getPrototypeOf(MaterialLoader)).call(this,\n\nmanager));\n_this130.textures={};return _this130;\n\n}_createClass(MaterialLoader,[{key:'load',value:function load(\n\nurl,onLoad,onProgress,onError){\n\nvar scope=this;\n\nvar loader=new FileLoader(scope.manager);\nloader.setPath(scope.path);\nloader.setRequestHeader(scope.requestHeader);\nloader.setWithCredentials(scope.withCredentials);\nloader.load(url,function(text){\n\ntry{\n\nonLoad(scope.parse(JSON.parse(text)));\n\n}catch(e){\n\nif(onError){\n\nonError(e);\n\n}else{\n\nconsole.error(e);\n\n}\n\nscope.manager.itemError(url);\n\n}\n\n},onProgress,onError);\n\n}},{key:'parse',value:function parse(\n\njson){\n\nvar textures=this.textures;\n\nfunction getTexture(name){\n\nif(textures[name]===undefined){\n\nconsole.warn('THREE.MaterialLoader: Undefined texture',name);\n\n}\n\nreturn textures[name];\n\n}\n\nvar material=MaterialLoader.createMaterialFromType(json.type);\n\nif(json.uuid!==undefined)material.uuid=json.uuid;\nif(json.name!==undefined)material.name=json.name;\nif(json.color!==undefined&&material.color!==undefined)material.color.setHex(json.color);\nif(json.roughness!==undefined)material.roughness=json.roughness;\nif(json.metalness!==undefined)material.metalness=json.metalness;\nif(json.sheen!==undefined)material.sheen=json.sheen;\nif(json.sheenColor!==undefined)material.sheenColor=new Color().setHex(json.sheenColor);\nif(json.sheenRoughness!==undefined)material.sheenRoughness=json.sheenRoughness;\nif(json.emissive!==undefined&&material.emissive!==undefined)material.emissive.setHex(json.emissive);\nif(json.specular!==undefined&&material.specular!==undefined)material.specular.setHex(json.specular);\nif(json.specularIntensity!==undefined)material.specularIntensity=json.specularIntensity;\nif(json.specularColor!==undefined&&material.specularColor!==undefined)material.specularColor.setHex(json.specularColor);\nif(json.shininess!==undefined)material.shininess=json.shininess;\nif(json.clearcoat!==undefined)material.clearcoat=json.clearcoat;\nif(json.clearcoatRoughness!==undefined)material.clearcoatRoughness=json.clearcoatRoughness;\nif(json.iridescence!==undefined)material.iridescence=json.iridescence;\nif(json.iridescenceIOR!==undefined)material.iridescenceIOR=json.iridescenceIOR;\nif(json.iridescenceThicknessRange!==undefined)material.iridescenceThicknessRange=json.iridescenceThicknessRange;\nif(json.transmission!==undefined)material.transmission=json.transmission;\nif(json.thickness!==undefined)material.thickness=json.thickness;\nif(json.attenuationDistance!==undefined)material.attenuationDistance=json.attenuationDistance;\nif(json.attenuationColor!==undefined&&material.attenuationColor!==undefined)material.attenuationColor.setHex(json.attenuationColor);\nif(json.fog!==undefined)material.fog=json.fog;\nif(json.flatShading!==undefined)material.flatShading=json.flatShading;\nif(json.blending!==undefined)material.blending=json.blending;\nif(json.combine!==undefined)material.combine=json.combine;\nif(json.side!==undefined)material.side=json.side;\nif(json.shadowSide!==undefined)material.shadowSide=json.shadowSide;\nif(json.opacity!==undefined)material.opacity=json.opacity;\nif(json.transparent!==undefined)material.transparent=json.transparent;\nif(json.alphaTest!==undefined)material.alphaTest=json.alphaTest;\nif(json.depthTest!==undefined)material.depthTest=json.depthTest;\nif(json.depthWrite!==undefined)material.depthWrite=json.depthWrite;\nif(json.colorWrite!==undefined)material.colorWrite=json.colorWrite;\n\nif(json.stencilWrite!==undefined)material.stencilWrite=json.stencilWrite;\nif(json.stencilWriteMask!==undefined)material.stencilWriteMask=json.stencilWriteMask;\nif(json.stencilFunc!==undefined)material.stencilFunc=json.stencilFunc;\nif(json.stencilRef!==undefined)material.stencilRef=json.stencilRef;\nif(json.stencilFuncMask!==undefined)material.stencilFuncMask=json.stencilFuncMask;\nif(json.stencilFail!==undefined)material.stencilFail=json.stencilFail;\nif(json.stencilZFail!==undefined)material.stencilZFail=json.stencilZFail;\nif(json.stencilZPass!==undefined)material.stencilZPass=json.stencilZPass;\n\nif(json.wireframe!==undefined)material.wireframe=json.wireframe;\nif(json.wireframeLinewidth!==undefined)material.wireframeLinewidth=json.wireframeLinewidth;\nif(json.wireframeLinecap!==undefined)material.wireframeLinecap=json.wireframeLinecap;\nif(json.wireframeLinejoin!==undefined)material.wireframeLinejoin=json.wireframeLinejoin;\n\nif(json.rotation!==undefined)material.rotation=json.rotation;\n\nif(json.linewidth!==1)material.linewidth=json.linewidth;\nif(json.dashSize!==undefined)material.dashSize=json.dashSize;\nif(json.gapSize!==undefined)material.gapSize=json.gapSize;\nif(json.scale!==undefined)material.scale=json.scale;\n\nif(json.polygonOffset!==undefined)material.polygonOffset=json.polygonOffset;\nif(json.polygonOffsetFactor!==undefined)material.polygonOffsetFactor=json.polygonOffsetFactor;\nif(json.polygonOffsetUnits!==undefined)material.polygonOffsetUnits=json.polygonOffsetUnits;\n\nif(json.dithering!==undefined)material.dithering=json.dithering;\n\nif(json.alphaToCoverage!==undefined)material.alphaToCoverage=json.alphaToCoverage;\nif(json.premultipliedAlpha!==undefined)material.premultipliedAlpha=json.premultipliedAlpha;\n\nif(json.visible!==undefined)material.visible=json.visible;\n\nif(json.toneMapped!==undefined)material.toneMapped=json.toneMapped;\n\nif(json.userData!==undefined)material.userData=json.userData;\n\nif(json.vertexColors!==undefined){\n\nif(typeof json.vertexColors==='number'){\n\nmaterial.vertexColors=json.vertexColors>0?true:false;\n\n}else{\n\nmaterial.vertexColors=json.vertexColors;\n\n}\n\n}\n\n// Shader Material\n\nif(json.uniforms!==undefined){\n\nfor(var name in json.uniforms){\n\nvar uniform=json.uniforms[name];\n\nmaterial.uniforms[name]={};\n\nswitch(uniform.type){\n\ncase't':\nmaterial.uniforms[name].value=getTexture(uniform.value);\nbreak;\n\ncase'c':\nmaterial.uniforms[name].value=new Color().setHex(uniform.value);\nbreak;\n\ncase'v2':\nmaterial.uniforms[name].value=new Vector2().fromArray(uniform.value);\nbreak;\n\ncase'v3':\nmaterial.uniforms[name].value=new Vector3().fromArray(uniform.value);\nbreak;\n\ncase'v4':\nmaterial.uniforms[name].value=new Vector4().fromArray(uniform.value);\nbreak;\n\ncase'm3':\nmaterial.uniforms[name].value=new Matrix3().fromArray(uniform.value);\nbreak;\n\ncase'm4':\nmaterial.uniforms[name].value=new Matrix4().fromArray(uniform.value);\nbreak;\n\ndefault:\nmaterial.uniforms[name].value=uniform.value;}\n\n\n\n}\n\n}\n\nif(json.defines!==undefined)material.defines=json.defines;\nif(json.vertexShader!==undefined)material.vertexShader=json.vertexShader;\nif(json.fragmentShader!==undefined)material.fragmentShader=json.fragmentShader;\n\nif(json.extensions!==undefined){\n\nfor(var key in json.extensions){\n\nmaterial.extensions[key]=json.extensions[key];\n\n}\n\n}\n\n// Deprecated\n\nif(json.shading!==undefined)material.flatShading=json.shading===1;// THREE.FlatShading\n\n// for PointsMaterial\n\nif(json.size!==undefined)material.size=json.size;\nif(json.sizeAttenuation!==undefined)material.sizeAttenuation=json.sizeAttenuation;\n\n// maps\n\nif(json.map!==undefined)material.map=getTexture(json.map);\nif(json.matcap!==undefined)material.matcap=getTexture(json.matcap);\n\nif(json.alphaMap!==undefined)material.alphaMap=getTexture(json.alphaMap);\n\nif(json.bumpMap!==undefined)material.bumpMap=getTexture(json.bumpMap);\nif(json.bumpScale!==undefined)material.bumpScale=json.bumpScale;\n\nif(json.normalMap!==undefined)material.normalMap=getTexture(json.normalMap);\nif(json.normalMapType!==undefined)material.normalMapType=json.normalMapType;\nif(json.normalScale!==undefined){\n\nvar normalScale=json.normalScale;\n\nif(Array.isArray(normalScale)===false){\n\n// Blender exporter used to export a scalar. See #7459\n\nnormalScale=[normalScale,normalScale];\n\n}\n\nmaterial.normalScale=new Vector2().fromArray(normalScale);\n\n}\n\nif(json.displacementMap!==undefined)material.displacementMap=getTexture(json.displacementMap);\nif(json.displacementScale!==undefined)material.displacementScale=json.displacementScale;\nif(json.displacementBias!==undefined)material.displacementBias=json.displacementBias;\n\nif(json.roughnessMap!==undefined)material.roughnessMap=getTexture(json.roughnessMap);\nif(json.metalnessMap!==undefined)material.metalnessMap=getTexture(json.metalnessMap);\n\nif(json.emissiveMap!==undefined)material.emissiveMap=getTexture(json.emissiveMap);\nif(json.emissiveIntensity!==undefined)material.emissiveIntensity=json.emissiveIntensity;\n\nif(json.specularMap!==undefined)material.specularMap=getTexture(json.specularMap);\nif(json.specularIntensityMap!==undefined)material.specularIntensityMap=getTexture(json.specularIntensityMap);\nif(json.specularColorMap!==undefined)material.specularColorMap=getTexture(json.specularColorMap);\n\nif(json.envMap!==undefined)material.envMap=getTexture(json.envMap);\nif(json.envMapIntensity!==undefined)material.envMapIntensity=json.envMapIntensity;\n\nif(json.reflectivity!==undefined)material.reflectivity=json.reflectivity;\nif(json.refractionRatio!==undefined)material.refractionRatio=json.refractionRatio;\n\nif(json.lightMap!==undefined)material.lightMap=getTexture(json.lightMap);\nif(json.lightMapIntensity!==undefined)material.lightMapIntensity=json.lightMapIntensity;\n\nif(json.aoMap!==undefined)material.aoMap=getTexture(json.aoMap);\nif(json.aoMapIntensity!==undefined)material.aoMapIntensity=json.aoMapIntensity;\n\nif(json.gradientMap!==undefined)material.gradientMap=getTexture(json.gradientMap);\n\nif(json.clearcoatMap!==undefined)material.clearcoatMap=getTexture(json.clearcoatMap);\nif(json.clearcoatRoughnessMap!==undefined)material.clearcoatRoughnessMap=getTexture(json.clearcoatRoughnessMap);\nif(json.clearcoatNormalMap!==undefined)material.clearcoatNormalMap=getTexture(json.clearcoatNormalMap);\nif(json.clearcoatNormalScale!==undefined)material.clearcoatNormalScale=new Vector2().fromArray(json.clearcoatNormalScale);\n\nif(json.iridescenceMap!==undefined)material.iridescenceMap=getTexture(json.iridescenceMap);\nif(json.iridescenceThicknessMap!==undefined)material.iridescenceThicknessMap=getTexture(json.iridescenceThicknessMap);\n\nif(json.transmissionMap!==undefined)material.transmissionMap=getTexture(json.transmissionMap);\nif(json.thicknessMap!==undefined)material.thicknessMap=getTexture(json.thicknessMap);\n\nif(json.sheenColorMap!==undefined)material.sheenColorMap=getTexture(json.sheenColorMap);\nif(json.sheenRoughnessMap!==undefined)material.sheenRoughnessMap=getTexture(json.sheenRoughnessMap);\n\nreturn material;\n\n}},{key:'setTextures',value:function setTextures(\n\nvalue){\n\nthis.textures=value;\nreturn this;\n\n}}],[{key:'createMaterialFromType',value:function createMaterialFromType(\n\ntype){\n\nvar materialLib={\nShadowMaterial:ShadowMaterial,\nSpriteMaterial:SpriteMaterial,\nRawShaderMaterial:RawShaderMaterial,\nShaderMaterial:ShaderMaterial,\nPointsMaterial:PointsMaterial,\nMeshPhysicalMaterial:MeshPhysicalMaterial,\nMeshStandardMaterial:MeshStandardMaterial,\nMeshPhongMaterial:MeshPhongMaterial,\nMeshToonMaterial:MeshToonMaterial,\nMeshNormalMaterial:MeshNormalMaterial,\nMeshLambertMaterial:MeshLambertMaterial,\nMeshDepthMaterial:MeshDepthMaterial,\nMeshDistanceMaterial:MeshDistanceMaterial,\nMeshBasicMaterial:MeshBasicMaterial,\nMeshMatcapMaterial:MeshMatcapMaterial,\nLineDashedMaterial:LineDashedMaterial,\nLineBasicMaterial:LineBasicMaterial,\nMaterial:Material};\n\n\nreturn new materialLib[type]();\n\n}}]);return MaterialLoader;}(Loader);var\n\n\n\nLoaderUtils=function(){function LoaderUtils(){_classCallCheck(this,LoaderUtils);}_createClass(LoaderUtils,null,[{key:'decodeText',value:function decodeText(\n\narray){\n\nif(typeof TextDecoder!=='undefined'){\n\nreturn new TextDecoder().decode(array);\n\n}\n\n// Avoid the String.fromCharCode.apply(null, array) shortcut, which\n// throws a \"maximum call stack size exceeded\" error for large arrays.\n\nvar s='';\n\nfor(var i=0,il=array.length;i<il;i++){\n\n// Implicitly assumes little-endian.\ns+=String.fromCharCode(array[i]);\n\n}\n\ntry{\n\n// merges multi-byte utf-8 characters.\n\nreturn decodeURIComponent(escape(s));\n\n}catch(e){// see #16358\n\nreturn s;\n\n}\n\n}},{key:'extractUrlBase',value:function extractUrlBase(\n\nurl){\n\nvar index=url.lastIndexOf('/');\n\nif(index===-1)return'./';\n\nreturn url.slice(0,index+1);\n\n}},{key:'resolveURL',value:function resolveURL(\n\nurl,path){\n\n// Invalid URL\nif(typeof url!=='string'||url==='')return'';\n\n// Host Relative URL\nif(/^https?:\\/\\//i.test(path)&&/^\\//.test(url)){\n\npath=path.replace(/(^https?:\\/\\/[^\\/]+).*/i,'$1');\n\n}\n\n// Absolute URL http://,https://,//\nif(/^(https?:)?\\/\\//i.test(url))return url;\n\n// Data URI\nif(/^data:.*,.*$/i.test(url))return url;\n\n// Blob URL\nif(/^blob:.*$/i.test(url))return url;\n\n// Relative URL\nreturn path+url;\n\n}}]);return LoaderUtils;}();var\n\n\n\nInstancedBufferGeometry=function(_BufferGeometry16){_inherits(InstancedBufferGeometry,_BufferGeometry16);\n\nfunction InstancedBufferGeometry(){_classCallCheck(this,InstancedBufferGeometry);var _this131=_possibleConstructorReturn(this,(InstancedBufferGeometry.__proto__||Object.getPrototypeOf(InstancedBufferGeometry)).call(this));\n\n\n\n_this131.isInstancedBufferGeometry=true;\n\n_this131.type='InstancedBufferGeometry';\n_this131.instanceCount=Infinity;return _this131;\n\n}_createClass(InstancedBufferGeometry,[{key:'copy',value:function copy(\n\nsource){\n\n_get(InstancedBufferGeometry.prototype.__proto__||Object.getPrototypeOf(InstancedBufferGeometry.prototype),'copy',this).call(this,source);\n\nthis.instanceCount=source.instanceCount;\n\nreturn this;\n\n}},{key:'clone',value:function clone()\n\n{\n\nreturn new this.constructor().copy(this);\n\n}},{key:'toJSON',value:function toJSON()\n\n{\n\nvar data=_get(InstancedBufferGeometry.prototype.__proto__||Object.getPrototypeOf(InstancedBufferGeometry.prototype),'toJSON',this).call(this,this);\n\ndata.instanceCount=this.instanceCount;\n\ndata.isInstancedBufferGeometry=true;\n\nreturn data;\n\n}}]);return InstancedBufferGeometry;}(BufferGeometry);var\n\n\n\nBufferGeometryLoader=function(_Loader9){_inherits(BufferGeometryLoader,_Loader9);\n\nfunction BufferGeometryLoader(manager){_classCallCheck(this,BufferGeometryLoader);return _possibleConstructorReturn(this,(BufferGeometryLoader.__proto__||Object.getPrototypeOf(BufferGeometryLoader)).call(this,\n\nmanager));\n\n}_createClass(BufferGeometryLoader,[{key:'load',value:function load(\n\nurl,onLoad,onProgress,onError){\n\nvar scope=this;\n\nvar loader=new FileLoader(scope.manager);\nloader.setPath(scope.path);\nloader.setRequestHeader(scope.requestHeader);\nloader.setWithCredentials(scope.withCredentials);\nloader.load(url,function(text){\n\ntry{\n\nonLoad(scope.parse(JSON.parse(text)));\n\n}catch(e){\n\nif(onError){\n\nonError(e);\n\n}else{\n\nconsole.error(e);\n\n}\n\nscope.manager.itemError(url);\n\n}\n\n},onProgress,onError);\n\n}},{key:'parse',value:function parse(\n\njson){\n\nvar interleavedBufferMap={};\nvar arrayBufferMap={};\n\nfunction getInterleavedBuffer(json,uuid){\n\nif(interleavedBufferMap[uuid]!==undefined)return interleavedBufferMap[uuid];\n\nvar interleavedBuffers=json.interleavedBuffers;\nvar interleavedBuffer=interleavedBuffers[uuid];\n\nvar buffer=getArrayBuffer(json,interleavedBuffer.buffer);\n\nvar array=getTypedArray(interleavedBuffer.type,buffer);\nvar ib=new InterleavedBuffer(array,interleavedBuffer.stride);\nib.uuid=interleavedBuffer.uuid;\n\ninterleavedBufferMap[uuid]=ib;\n\nreturn ib;\n\n}\n\nfunction getArrayBuffer(json,uuid){\n\nif(arrayBufferMap[uuid]!==undefined)return arrayBufferMap[uuid];\n\nvar arrayBuffers=json.arrayBuffers;\nvar arrayBuffer=arrayBuffers[uuid];\n\nvar ab=new Uint32Array(arrayBuffer).buffer;\n\narrayBufferMap[uuid]=ab;\n\nreturn ab;\n\n}\n\nvar geometry=json.isInstancedBufferGeometry?new InstancedBufferGeometry():new BufferGeometry();\n\nvar index=json.data.index;\n\nif(index!==undefined){\n\nvar typedArray=getTypedArray(index.type,index.array);\ngeometry.setIndex(new BufferAttribute(typedArray,1));\n\n}\n\nvar attributes=json.data.attributes;\n\nfor(var key in attributes){\n\nvar attribute=attributes[key];\nvar bufferAttribute=void 0;\n\nif(attribute.isInterleavedBufferAttribute){\n\nvar interleavedBuffer=getInterleavedBuffer(json.data,attribute.data);\nbufferAttribute=new InterleavedBufferAttribute(interleavedBuffer,attribute.itemSize,attribute.offset,attribute.normalized);\n\n}else{\n\nvar _typedArray=getTypedArray(attribute.type,attribute.array);\nvar bufferAttributeConstr=attribute.isInstancedBufferAttribute?InstancedBufferAttribute:BufferAttribute;\nbufferAttribute=new bufferAttributeConstr(_typedArray,attribute.itemSize,attribute.normalized);\n\n}\n\nif(attribute.name!==undefined)bufferAttribute.name=attribute.name;\nif(attribute.usage!==undefined)bufferAttribute.setUsage(attribute.usage);\n\nif(attribute.updateRange!==undefined){\n\nbufferAttribute.updateRange.offset=attribute.updateRange.offset;\nbufferAttribute.updateRange.count=attribute.updateRange.count;\n\n}\n\ngeometry.setAttribute(key,bufferAttribute);\n\n}\n\nvar morphAttributes=json.data.morphAttributes;\n\nif(morphAttributes){\n\nfor(var _key3 in morphAttributes){\n\nvar attributeArray=morphAttributes[_key3];\n\nvar array=[];\n\nfor(var i=0,il=attributeArray.length;i<il;i++){\n\nvar _attribute3=attributeArray[i];\nvar _bufferAttribute=void 0;\n\nif(_attribute3.isInterleavedBufferAttribute){\n\nvar _interleavedBuffer=getInterleavedBuffer(json.data,_attribute3.data);\n_bufferAttribute=new InterleavedBufferAttribute(_interleavedBuffer,_attribute3.itemSize,_attribute3.offset,_attribute3.normalized);\n\n}else{\n\nvar _typedArray2=getTypedArray(_attribute3.type,_attribute3.array);\n_bufferAttribute=new BufferAttribute(_typedArray2,_attribute3.itemSize,_attribute3.normalized);\n\n}\n\nif(_attribute3.name!==undefined)_bufferAttribute.name=_attribute3.name;\narray.push(_bufferAttribute);\n\n}\n\ngeometry.morphAttributes[_key3]=array;\n\n}\n\n}\n\nvar morphTargetsRelative=json.data.morphTargetsRelative;\n\nif(morphTargetsRelative){\n\ngeometry.morphTargetsRelative=true;\n\n}\n\nvar groups=json.data.groups||json.data.drawcalls||json.data.offsets;\n\nif(groups!==undefined){\n\nfor(var _i85=0,_n10=groups.length;_i85!==_n10;++_i85){\n\nvar group=groups[_i85];\n\ngeometry.addGroup(group.start,group.count,group.materialIndex);\n\n}\n\n}\n\nvar boundingSphere=json.data.boundingSphere;\n\nif(boundingSphere!==undefined){\n\nvar _center2=new Vector3();\n\nif(boundingSphere.center!==undefined){\n\n_center2.fromArray(boundingSphere.center);\n\n}\n\ngeometry.boundingSphere=new Sphere(_center2,boundingSphere.radius);\n\n}\n\nif(json.name)geometry.name=json.name;\nif(json.userData)geometry.userData=json.userData;\n\nreturn geometry;\n\n}}]);return BufferGeometryLoader;}(Loader);var\n\n\n\nObjectLoader=function(_Loader10){_inherits(ObjectLoader,_Loader10);\n\nfunction ObjectLoader(manager){_classCallCheck(this,ObjectLoader);return _possibleConstructorReturn(this,(ObjectLoader.__proto__||Object.getPrototypeOf(ObjectLoader)).call(this,\n\nmanager));\n\n}_createClass(ObjectLoader,[{key:'load',value:function load(\n\nurl,onLoad,onProgress,onError){\n\nvar scope=this;\n\nvar path=this.path===''?LoaderUtils.extractUrlBase(url):this.path;\nthis.resourcePath=this.resourcePath||path;\n\nvar loader=new FileLoader(this.manager);\nloader.setPath(this.path);\nloader.setRequestHeader(this.requestHeader);\nloader.setWithCredentials(this.withCredentials);\nloader.load(url,function(text){\n\nvar json=null;\n\ntry{\n\njson=JSON.parse(text);\n\n}catch(error){\n\nif(onError!==undefined)onError(error);\n\nconsole.error('THREE:ObjectLoader: Can\\'t parse '+url+'.',error.message);\n\nreturn;\n\n}\n\nvar metadata=json.metadata;\n\nif(metadata===undefined||metadata.type===undefined||metadata.type.toLowerCase()==='geometry'){\n\nconsole.error('THREE.ObjectLoader: Can\\'t load '+url);\nreturn;\n\n}\n\nscope.parse(json,onLoad);\n\n},onProgress,onError);\n\n}},{key:'loadAsync',value:async function loadAsync(\n\nurl,onProgress){\n\nvar scope=this;\n\nvar path=this.path===''?LoaderUtils.extractUrlBase(url):this.path;\nthis.resourcePath=this.resourcePath||path;\n\nvar loader=new FileLoader(this.manager);\nloader.setPath(this.path);\nloader.setRequestHeader(this.requestHeader);\nloader.setWithCredentials(this.withCredentials);\n\nvar text=await loader.loadAsync(url,onProgress);\n\nvar json=JSON.parse(text);\n\nvar metadata=json.metadata;\n\nif(metadata===undefined||metadata.type===undefined||metadata.type.toLowerCase()==='geometry'){\n\nthrow new Error('THREE.ObjectLoader: Can\\'t load '+url);\n\n}\n\nreturn await scope.parseAsync(json);\n\n}},{key:'parse',value:function parse(\n\njson,onLoad){\n\nvar animations=this.parseAnimations(json.animations);\nvar shapes=this.parseShapes(json.shapes);\nvar geometries=this.parseGeometries(json.geometries,shapes);\n\nvar images=this.parseImages(json.images,function(){\n\nif(onLoad!==undefined)onLoad(object);\n\n});\n\nvar textures=this.parseTextures(json.textures,images);\nvar materials=this.parseMaterials(json.materials,textures);\n\nvar object=this.parseObject(json.object,geometries,materials,textures,animations);\nvar skeletons=this.parseSkeletons(json.skeletons,object);\n\nthis.bindSkeletons(object,skeletons);\n\n//\n\nif(onLoad!==undefined){\n\nvar hasImages=false;\n\nfor(var uuid in images){\n\nif(images[uuid].data instanceof HTMLImageElement){\n\nhasImages=true;\nbreak;\n\n}\n\n}\n\nif(hasImages===false)onLoad(object);\n\n}\n\nreturn object;\n\n}},{key:'parseAsync',value:async function parseAsync(\n\njson){\n\nvar animations=this.parseAnimations(json.animations);\nvar shapes=this.parseShapes(json.shapes);\nvar geometries=this.parseGeometries(json.geometries,shapes);\n\nvar images=await this.parseImagesAsync(json.images);\n\nvar textures=this.parseTextures(json.textures,images);\nvar materials=this.parseMaterials(json.materials,textures);\n\nvar object=this.parseObject(json.object,geometries,materials,textures,animations);\nvar skeletons=this.parseSkeletons(json.skeletons,object);\n\nthis.bindSkeletons(object,skeletons);\n\nreturn object;\n\n}},{key:'parseShapes',value:function parseShapes(\n\njson){\n\nvar shapes={};\n\nif(json!==undefined){\n\nfor(var i=0,l=json.length;i<l;i++){\n\nvar shape=new Shape().fromJSON(json[i]);\n\nshapes[shape.uuid]=shape;\n\n}\n\n}\n\nreturn shapes;\n\n}},{key:'parseSkeletons',value:function parseSkeletons(\n\njson,object){\n\nvar skeletons={};\nvar bones={};\n\n// generate bone lookup table\n\nobject.traverse(function(child){\n\nif(child.isBone)bones[child.uuid]=child;\n\n});\n\n// create skeletons\n\nif(json!==undefined){\n\nfor(var i=0,l=json.length;i<l;i++){\n\nvar skeleton=new Skeleton().fromJSON(json[i],bones);\n\nskeletons[skeleton.uuid]=skeleton;\n\n}\n\n}\n\nreturn skeletons;\n\n}},{key:'parseGeometries',value:function parseGeometries(\n\njson,shapes){\n\nvar geometries={};\n\nif(json!==undefined){\n\nvar bufferGeometryLoader=new BufferGeometryLoader();\n\nfor(var i=0,l=json.length;i<l;i++){\n\nvar geometry=void 0;\nvar data=json[i];\n\nswitch(data.type){\n\ncase'BufferGeometry':\ncase'InstancedBufferGeometry':\n\ngeometry=bufferGeometryLoader.parse(data);\n\nbreak;\n\ncase'Geometry':\n\nconsole.error('THREE.ObjectLoader: The legacy Geometry type is no longer supported.');\n\nbreak;\n\ndefault:\n\nif(data.type in Geometries){\n\ngeometry=Geometries[data.type].fromJSON(data,shapes);\n\n}else{\n\nconsole.warn('THREE.ObjectLoader: Unsupported geometry type \"'+data.type+'\"');\n\n}}\n\n\n\ngeometry.uuid=data.uuid;\n\nif(data.name!==undefined)geometry.name=data.name;\nif(geometry.isBufferGeometry===true&&data.userData!==undefined)geometry.userData=data.userData;\n\ngeometries[data.uuid]=geometry;\n\n}\n\n}\n\nreturn geometries;\n\n}},{key:'parseMaterials',value:function parseMaterials(\n\njson,textures){\n\nvar cache={};// MultiMaterial\nvar materials={};\n\nif(json!==undefined){\n\nvar loader=new MaterialLoader();\nloader.setTextures(textures);\n\nfor(var i=0,l=json.length;i<l;i++){\n\nvar data=json[i];\n\nif(data.type==='MultiMaterial'){\n\n// Deprecated\n\nvar array=[];\n\nfor(var j=0;j<data.materials.length;j++){\n\nvar material=data.materials[j];\n\nif(cache[material.uuid]===undefined){\n\ncache[material.uuid]=loader.parse(material);\n\n}\n\narray.push(cache[material.uuid]);\n\n}\n\nmaterials[data.uuid]=array;\n\n}else{\n\nif(cache[data.uuid]===undefined){\n\ncache[data.uuid]=loader.parse(data);\n\n}\n\nmaterials[data.uuid]=cache[data.uuid];\n\n}\n\n}\n\n}\n\nreturn materials;\n\n}},{key:'parseAnimations',value:function parseAnimations(\n\njson){\n\nvar animations={};\n\nif(json!==undefined){\n\nfor(var i=0;i<json.length;i++){\n\nvar data=json[i];\n\nvar clip=AnimationClip.parse(data);\n\nanimations[clip.uuid]=clip;\n\n}\n\n}\n\nreturn animations;\n\n}},{key:'parseImages',value:function parseImages(\n\njson,onLoad){\n\nvar scope=this;\nvar images={};\n\nvar loader=void 0;\n\nfunction loadImage(url){\n\nscope.manager.itemStart(url);\n\nreturn loader.load(url,function(){\n\nscope.manager.itemEnd(url);\n\n},undefined,function(){\n\nscope.manager.itemError(url);\nscope.manager.itemEnd(url);\n\n});\n\n}\n\nfunction deserializeImage(image){\n\nif(typeof image==='string'){\n\nvar url=image;\n\nvar path=/^(\\/\\/)|([a-z]+:(\\/\\/)?)/i.test(url)?url:scope.resourcePath+url;\n\nreturn loadImage(path);\n\n}else{\n\nif(image.data){\n\nreturn{\ndata:getTypedArray(image.type,image.data),\nwidth:image.width,\nheight:image.height};\n\n\n}else{\n\nreturn null;\n\n}\n\n}\n\n}\n\nif(json!==undefined&&json.length>0){\n\nvar manager=new LoadingManager(onLoad);\n\nloader=new ImageLoader(manager);\nloader.setCrossOrigin(this.crossOrigin);\n\nfor(var i=0,il=json.length;i<il;i++){\n\nvar image=json[i];\nvar url=image.url;\n\nif(Array.isArray(url)){\n\n// load array of images e.g CubeTexture\n\nvar imageArray=[];\n\nfor(var j=0,jl=url.length;j<jl;j++){\n\nvar currentUrl=url[j];\n\nvar deserializedImage=deserializeImage(currentUrl);\n\nif(deserializedImage!==null){\n\nif(deserializedImage instanceof HTMLImageElement){\n\nimageArray.push(deserializedImage);\n\n}else{\n\n// special case: handle array of data textures for cube textures\n\nimageArray.push(new DataTexture(deserializedImage.data,deserializedImage.width,deserializedImage.height));\n\n}\n\n}\n\n}\n\nimages[image.uuid]=new Source(imageArray);\n\n}else{\n\n// load single image\n\nvar _deserializedImage=deserializeImage(image.url);\nimages[image.uuid]=new Source(_deserializedImage);\n\n\n}\n\n}\n\n}\n\nreturn images;\n\n}},{key:'parseImagesAsync',value:async function parseImagesAsync(\n\njson){\n\nvar scope=this;\nvar images={};\n\nvar loader=void 0;\n\nasync function deserializeImage(image){\n\nif(typeof image==='string'){\n\nvar url=image;\n\nvar path=/^(\\/\\/)|([a-z]+:(\\/\\/)?)/i.test(url)?url:scope.resourcePath+url;\n\nreturn await loader.loadAsync(path);\n\n}else{\n\nif(image.data){\n\nreturn{\ndata:getTypedArray(image.type,image.data),\nwidth:image.width,\nheight:image.height};\n\n\n}else{\n\nreturn null;\n\n}\n\n}\n\n}\n\nif(json!==undefined&&json.length>0){\n\nloader=new ImageLoader(this.manager);\nloader.setCrossOrigin(this.crossOrigin);\n\nfor(var i=0,il=json.length;i<il;i++){\n\nvar image=json[i];\nvar url=image.url;\n\nif(Array.isArray(url)){\n\n// load array of images e.g CubeTexture\n\nvar imageArray=[];\n\nfor(var j=0,jl=url.length;j<jl;j++){\n\nvar currentUrl=url[j];\n\nvar deserializedImage=await deserializeImage(currentUrl);\n\nif(deserializedImage!==null){\n\nif(deserializedImage instanceof HTMLImageElement){\n\nimageArray.push(deserializedImage);\n\n}else{\n\n// special case: handle array of data textures for cube textures\n\nimageArray.push(new DataTexture(deserializedImage.data,deserializedImage.width,deserializedImage.height));\n\n}\n\n}\n\n}\n\nimages[image.uuid]=new Source(imageArray);\n\n}else{\n\n// load single image\n\nvar _deserializedImage2=await deserializeImage(image.url);\nimages[image.uuid]=new Source(_deserializedImage2);\n\n}\n\n}\n\n}\n\nreturn images;\n\n}},{key:'parseTextures',value:function parseTextures(\n\njson,images){\n\nfunction parseConstant(value,type){\n\nif(typeof value==='number')return value;\n\nconsole.warn('THREE.ObjectLoader.parseTexture: Constant should be in numeric form.',value);\n\nreturn type[value];\n\n}\n\nvar textures={};\n\nif(json!==undefined){\n\nfor(var i=0,l=json.length;i<l;i++){\n\nvar data=json[i];\n\nif(data.image===undefined){\n\nconsole.warn('THREE.ObjectLoader: No \"image\" specified for',data.uuid);\n\n}\n\nif(images[data.image]===undefined){\n\nconsole.warn('THREE.ObjectLoader: Undefined image',data.image);\n\n}\n\nvar source=images[data.image];\nvar image=source.data;\n\nvar _texture7=void 0;\n\nif(Array.isArray(image)){\n\n_texture7=new CubeTexture();\n\nif(image.length===6)_texture7.needsUpdate=true;\n\n}else{\n\nif(image&&image.data){\n\n_texture7=new DataTexture();\n\n}else{\n\n_texture7=new Texture();\n\n}\n\nif(image)_texture7.needsUpdate=true;// textures can have undefined image data\n\n}\n\n_texture7.source=source;\n\n_texture7.uuid=data.uuid;\n\nif(data.name!==undefined)_texture7.name=data.name;\n\nif(data.mapping!==undefined)_texture7.mapping=parseConstant(data.mapping,TEXTURE_MAPPING);\n\nif(data.offset!==undefined)_texture7.offset.fromArray(data.offset);\nif(data.repeat!==undefined)_texture7.repeat.fromArray(data.repeat);\nif(data.center!==undefined)_texture7.center.fromArray(data.center);\nif(data.rotation!==undefined)_texture7.rotation=data.rotation;\n\nif(data.wrap!==undefined){\n\n_texture7.wrapS=parseConstant(data.wrap[0],TEXTURE_WRAPPING);\n_texture7.wrapT=parseConstant(data.wrap[1],TEXTURE_WRAPPING);\n\n}\n\nif(data.format!==undefined)_texture7.format=data.format;\nif(data.type!==undefined)_texture7.type=data.type;\nif(data.encoding!==undefined)_texture7.encoding=data.encoding;\n\nif(data.minFilter!==undefined)_texture7.minFilter=parseConstant(data.minFilter,TEXTURE_FILTER);\nif(data.magFilter!==undefined)_texture7.magFilter=parseConstant(data.magFilter,TEXTURE_FILTER);\nif(data.anisotropy!==undefined)_texture7.anisotropy=data.anisotropy;\n\nif(data.flipY!==undefined)_texture7.flipY=data.flipY;\n\nif(data.premultiplyAlpha!==undefined)_texture7.premultiplyAlpha=data.premultiplyAlpha;\nif(data.unpackAlignment!==undefined)_texture7.unpackAlignment=data.unpackAlignment;\n\nif(data.userData!==undefined)_texture7.userData=data.userData;\n\ntextures[data.uuid]=_texture7;\n\n}\n\n}\n\nreturn textures;\n\n}},{key:'parseObject',value:function parseObject(\n\ndata,geometries,materials,textures,animations){\n\nvar object=void 0;\n\nfunction getGeometry(name){\n\nif(geometries[name]===undefined){\n\nconsole.warn('THREE.ObjectLoader: Undefined geometry',name);\n\n}\n\nreturn geometries[name];\n\n}\n\nfunction getMaterial(name){\n\nif(name===undefined)return undefined;\n\nif(Array.isArray(name)){\n\nvar array=[];\n\nfor(var i=0,l=name.length;i<l;i++){\n\nvar uuid=name[i];\n\nif(materials[uuid]===undefined){\n\nconsole.warn('THREE.ObjectLoader: Undefined material',uuid);\n\n}\n\narray.push(materials[uuid]);\n\n}\n\nreturn array;\n\n}\n\nif(materials[name]===undefined){\n\nconsole.warn('THREE.ObjectLoader: Undefined material',name);\n\n}\n\nreturn materials[name];\n\n}\n\nfunction getTexture(uuid){\n\nif(textures[uuid]===undefined){\n\nconsole.warn('THREE.ObjectLoader: Undefined texture',uuid);\n\n}\n\nreturn textures[uuid];\n\n}\n\nvar geometry=void 0,material=void 0;\n\nswitch(data.type){\n\ncase'Scene':\n\nobject=new Scene();\n\nif(data.background!==undefined){\n\nif(Number.isInteger(data.background)){\n\nobject.background=new Color(data.background);\n\n}else{\n\nobject.background=getTexture(data.background);\n\n}\n\n}\n\nif(data.environment!==undefined){\n\nobject.environment=getTexture(data.environment);\n\n}\n\nif(data.fog!==undefined){\n\nif(data.fog.type==='Fog'){\n\nobject.fog=new Fog(data.fog.color,data.fog.near,data.fog.far);\n\n}else if(data.fog.type==='FogExp2'){\n\nobject.fog=new FogExp2(data.fog.color,data.fog.density);\n\n}\n\n}\n\nbreak;\n\ncase'PerspectiveCamera':\n\nobject=new PerspectiveCamera(data.fov,data.aspect,data.near,data.far);\n\nif(data.focus!==undefined)object.focus=data.focus;\nif(data.zoom!==undefined)object.zoom=data.zoom;\nif(data.filmGauge!==undefined)object.filmGauge=data.filmGauge;\nif(data.filmOffset!==undefined)object.filmOffset=data.filmOffset;\nif(data.view!==undefined)object.view=Object.assign({},data.view);\n\nbreak;\n\ncase'OrthographicCamera':\n\nobject=new OrthographicCamera(data.left,data.right,data.top,data.bottom,data.near,data.far);\n\nif(data.zoom!==undefined)object.zoom=data.zoom;\nif(data.view!==undefined)object.view=Object.assign({},data.view);\n\nbreak;\n\ncase'AmbientLight':\n\nobject=new AmbientLight(data.color,data.intensity);\n\nbreak;\n\ncase'DirectionalLight':\n\nobject=new DirectionalLight(data.color,data.intensity);\n\nbreak;\n\ncase'PointLight':\n\nobject=new PointLight(data.color,data.intensity,data.distance,data.decay);\n\nbreak;\n\ncase'RectAreaLight':\n\nobject=new RectAreaLight(data.color,data.intensity,data.width,data.height);\n\nbreak;\n\ncase'SpotLight':\n\nobject=new SpotLight(data.color,data.intensity,data.distance,data.angle,data.penumbra,data.decay);\n\nbreak;\n\ncase'HemisphereLight':\n\nobject=new HemisphereLight(data.color,data.groundColor,data.intensity);\n\nbreak;\n\ncase'LightProbe':\n\nobject=new LightProbe().fromJSON(data);\n\nbreak;\n\ncase'SkinnedMesh':\n\ngeometry=getGeometry(data.geometry);\nmaterial=getMaterial(data.material);\n\nobject=new SkinnedMesh(geometry,material);\n\nif(data.bindMode!==undefined)object.bindMode=data.bindMode;\nif(data.bindMatrix!==undefined)object.bindMatrix.fromArray(data.bindMatrix);\nif(data.skeleton!==undefined)object.skeleton=data.skeleton;\n\nbreak;\n\ncase'Mesh':\n\ngeometry=getGeometry(data.geometry);\nmaterial=getMaterial(data.material);\n\nobject=new Mesh(geometry,material);\n\nbreak;\n\ncase'InstancedMesh':\n\ngeometry=getGeometry(data.geometry);\nmaterial=getMaterial(data.material);\nvar count=data.count;\nvar instanceMatrix=data.instanceMatrix;\nvar instanceColor=data.instanceColor;\n\nobject=new InstancedMesh(geometry,material,count);\nobject.instanceMatrix=new InstancedBufferAttribute(new Float32Array(instanceMatrix.array),16);\nif(instanceColor!==undefined)object.instanceColor=new InstancedBufferAttribute(new Float32Array(instanceColor.array),instanceColor.itemSize);\n\nbreak;\n\ncase'LOD':\n\nobject=new LOD();\n\nbreak;\n\ncase'Line':\n\nobject=new Line(getGeometry(data.geometry),getMaterial(data.material));\n\nbreak;\n\ncase'LineLoop':\n\nobject=new LineLoop(getGeometry(data.geometry),getMaterial(data.material));\n\nbreak;\n\ncase'LineSegments':\n\nobject=new LineSegments(getGeometry(data.geometry),getMaterial(data.material));\n\nbreak;\n\ncase'PointCloud':\ncase'Points':\n\nobject=new Points(getGeometry(data.geometry),getMaterial(data.material));\n\nbreak;\n\ncase'Sprite':\n\nobject=new Sprite(getMaterial(data.material));\n\nbreak;\n\ncase'Group':\n\nobject=new Group();\n\nbreak;\n\ncase'Bone':\n\nobject=new Bone();\n\nbreak;\n\ndefault:\n\nobject=new Object3D();}\n\n\n\nobject.uuid=data.uuid;\n\nif(data.name!==undefined)object.name=data.name;\n\nif(data.matrix!==undefined){\n\nobject.matrix.fromArray(data.matrix);\n\nif(data.matrixAutoUpdate!==undefined)object.matrixAutoUpdate=data.matrixAutoUpdate;\nif(object.matrixAutoUpdate)object.matrix.decompose(object.position,object.quaternion,object.scale);\n\n}else{\n\nif(data.position!==undefined)object.position.fromArray(data.position);\nif(data.rotation!==undefined)object.rotation.fromArray(data.rotation);\nif(data.quaternion!==undefined)object.quaternion.fromArray(data.quaternion);\nif(data.scale!==undefined)object.scale.fromArray(data.scale);\n\n}\n\nif(data.castShadow!==undefined)object.castShadow=data.castShadow;\nif(data.receiveShadow!==undefined)object.receiveShadow=data.receiveShadow;\n\nif(data.shadow){\n\nif(data.shadow.bias!==undefined)object.shadow.bias=data.shadow.bias;\nif(data.shadow.normalBias!==undefined)object.shadow.normalBias=data.shadow.normalBias;\nif(data.shadow.radius!==undefined)object.shadow.radius=data.shadow.radius;\nif(data.shadow.mapSize!==undefined)object.shadow.mapSize.fromArray(data.shadow.mapSize);\nif(data.shadow.camera!==undefined)object.shadow.camera=this.parseObject(data.shadow.camera);\n\n}\n\nif(data.visible!==undefined)object.visible=data.visible;\nif(data.frustumCulled!==undefined)object.frustumCulled=data.frustumCulled;\nif(data.renderOrder!==undefined)object.renderOrder=data.renderOrder;\nif(data.userData!==undefined)object.userData=data.userData;\nif(data.layers!==undefined)object.layers.mask=data.layers;\n\nif(data.children!==undefined){\n\nvar children=data.children;\n\nfor(var i=0;i<children.length;i++){\n\nobject.add(this.parseObject(children[i],geometries,materials,textures,animations));\n\n}\n\n}\n\nif(data.animations!==undefined){\n\nvar objectAnimations=data.animations;\n\nfor(var _i86=0;_i86<objectAnimations.length;_i86++){\n\nvar uuid=objectAnimations[_i86];\n\nobject.animations.push(animations[uuid]);\n\n}\n\n}\n\nif(data.type==='LOD'){\n\nif(data.autoUpdate!==undefined)object.autoUpdate=data.autoUpdate;\n\nvar levels=data.levels;\n\nfor(var l=0;l<levels.length;l++){\n\nvar level=levels[l];\nvar child=object.getObjectByProperty('uuid',level.object);\n\nif(child!==undefined){\n\nobject.addLevel(child,level.distance);\n\n}\n\n}\n\n}\n\nreturn object;\n\n}},{key:'bindSkeletons',value:function bindSkeletons(\n\nobject,skeletons){\n\nif(Object.keys(skeletons).length===0)return;\n\nobject.traverse(function(child){\n\nif(child.isSkinnedMesh===true&&child.skeleton!==undefined){\n\nvar skeleton=skeletons[child.skeleton];\n\nif(skeleton===undefined){\n\nconsole.warn('THREE.ObjectLoader: No skeleton found with UUID:',child.skeleton);\n\n}else{\n\nchild.bind(skeleton,child.bindMatrix);\n\n}\n\n}\n\n});\n\n}\n\n/* DEPRECATED */},{key:'setTexturePath',value:function setTexturePath(\n\nvalue){\n\nconsole.warn('THREE.ObjectLoader: .setTexturePath() has been renamed to .setResourcePath().');\nreturn this.setResourcePath(value);\n\n}}]);return ObjectLoader;}(Loader);\n\n\n\nvar TEXTURE_MAPPING={\nUVMapping:UVMapping,\nCubeReflectionMapping:CubeReflectionMapping,\nCubeRefractionMapping:CubeRefractionMapping,\nEquirectangularReflectionMapping:EquirectangularReflectionMapping,\nEquirectangularRefractionMapping:EquirectangularRefractionMapping,\nCubeUVReflectionMapping:CubeUVReflectionMapping};\n\n\nvar TEXTURE_WRAPPING={\nRepeatWrapping:RepeatWrapping,\nClampToEdgeWrapping:ClampToEdgeWrapping,\nMirroredRepeatWrapping:MirroredRepeatWrapping};\n\n\nvar TEXTURE_FILTER={\nNearestFilter:NearestFilter,\nNearestMipmapNearestFilter:NearestMipmapNearestFilter,\nNearestMipmapLinearFilter:NearestMipmapLinearFilter,\nLinearFilter:LinearFilter,\nLinearMipmapNearestFilter:LinearMipmapNearestFilter,\nLinearMipmapLinearFilter:LinearMipmapLinearFilter};var\n\n\nImageBitmapLoader=function(_Loader11){_inherits(ImageBitmapLoader,_Loader11);\n\nfunction ImageBitmapLoader(manager){_classCallCheck(this,ImageBitmapLoader);var _this134=_possibleConstructorReturn(this,(ImageBitmapLoader.__proto__||Object.getPrototypeOf(ImageBitmapLoader)).call(this,\n\nmanager));\n\n_this134.isImageBitmapLoader=true;\n\nif(typeof createImageBitmap==='undefined'){\n\nconsole.warn('THREE.ImageBitmapLoader: createImageBitmap() not supported.');\n\n}\n\nif(typeof fetch==='undefined'){\n\nconsole.warn('THREE.ImageBitmapLoader: fetch() not supported.');\n\n}\n\n_this134.options={premultiplyAlpha:'none'};return _this134;\n\n}_createClass(ImageBitmapLoader,[{key:'setOptions',value:function setOptions(\n\noptions){\n\nthis.options=options;\n\nreturn this;\n\n}},{key:'load',value:function load(\n\nurl,onLoad,onProgress,onError){\n\nif(url===undefined)url='';\n\nif(this.path!==undefined)url=this.path+url;\n\nurl=this.manager.resolveURL(url);\n\nvar scope=this;\n\nvar cached=Cache.get(url);\n\nif(cached!==undefined){\n\nscope.manager.itemStart(url);\n\nsetTimeout(function(){\n\nif(onLoad)onLoad(cached);\n\nscope.manager.itemEnd(url);\n\n},0);\n\nreturn cached;\n\n}\n\nvar fetchOptions={};\nfetchOptions.credentials=this.crossOrigin==='anonymous'?'same-origin':'include';\nfetchOptions.headers=this.requestHeader;\n\nfetch(url,fetchOptions).then(function(res){\n\nreturn res.blob();\n\n}).then(function(blob){\n\nreturn createImageBitmap(blob,Object.assign(scope.options,{colorSpaceConversion:'none'}));\n\n}).then(function(imageBitmap){\n\nCache.add(url,imageBitmap);\n\nif(onLoad)onLoad(imageBitmap);\n\nscope.manager.itemEnd(url);\n\n}).catch(function(e){\n\nif(onError)onError(e);\n\nscope.manager.itemError(url);\nscope.manager.itemEnd(url);\n\n});\n\nscope.manager.itemStart(url);\n\n}}]);return ImageBitmapLoader;}(Loader);\n\n\n\nvar _context=void 0;\n\nvar AudioContext={\n\ngetContext:function getContext(){\n\nif(_context===undefined){\n\n_context=new(window.AudioContext||window.webkitAudioContext)();\n\n}\n\nreturn _context;\n\n},\n\nsetContext:function setContext(value){\n\n_context=value;\n\n}};var\n\n\n\nAudioLoader=function(_Loader12){_inherits(AudioLoader,_Loader12);\n\nfunction AudioLoader(manager){_classCallCheck(this,AudioLoader);return _possibleConstructorReturn(this,(AudioLoader.__proto__||Object.getPrototypeOf(AudioLoader)).call(this,\n\nmanager));\n\n}_createClass(AudioLoader,[{key:'load',value:function load(\n\nurl,onLoad,onProgress,onError){\n\nvar scope=this;\n\nvar loader=new FileLoader(this.manager);\nloader.setResponseType('arraybuffer');\nloader.setPath(this.path);\nloader.setRequestHeader(this.requestHeader);\nloader.setWithCredentials(this.withCredentials);\nloader.load(url,function(buffer){\n\ntry{\n\n// Create a copy of the buffer. The `decodeAudioData` method\n// detaches the buffer when complete, preventing reuse.\nvar bufferCopy=buffer.slice(0);\n\nvar context=AudioContext.getContext();\ncontext.decodeAudioData(bufferCopy,function(audioBuffer){\n\nonLoad(audioBuffer);\n\n});\n\n}catch(e){\n\nif(onError){\n\nonError(e);\n\n}else{\n\nconsole.error(e);\n\n}\n\nscope.manager.itemError(url);\n\n}\n\n},onProgress,onError);\n\n}}]);return AudioLoader;}(Loader);var\n\n\n\nHemisphereLightProbe=function(_LightProbe){_inherits(HemisphereLightProbe,_LightProbe);\n\nfunction HemisphereLightProbe(skyColor,groundColor){var intensity=arguments.length>2&&arguments[2]!==undefined?arguments[2]:1;_classCallCheck(this,HemisphereLightProbe);var _this136=_possibleConstructorReturn(this,(HemisphereLightProbe.__proto__||Object.getPrototypeOf(HemisphereLightProbe)).call(this,\n\nundefined,intensity));\n\n_this136.isHemisphereLightProbe=true;\n\nvar color1=new Color().set(skyColor);\nvar color2=new Color().set(groundColor);\n\nvar sky=new Vector3(color1.r,color1.g,color1.b);\nvar ground=new Vector3(color2.r,color2.g,color2.b);\n\n// without extra factor of PI in the shader, should = 1 / Math.sqrt( Math.PI );\nvar c0=Math.sqrt(Math.PI);\nvar c1=c0*Math.sqrt(0.75);\n\n_this136.sh.coefficients[0].copy(sky).add(ground).multiplyScalar(c0);\n_this136.sh.coefficients[1].copy(sky).sub(ground).multiplyScalar(c1);return _this136;\n\n}return HemisphereLightProbe;}(LightProbe);var\n\n\n\nAmbientLightProbe=function(_LightProbe2){_inherits(AmbientLightProbe,_LightProbe2);\n\nfunction AmbientLightProbe(color){var intensity=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1;_classCallCheck(this,AmbientLightProbe);var _this137=_possibleConstructorReturn(this,(AmbientLightProbe.__proto__||Object.getPrototypeOf(AmbientLightProbe)).call(this,\n\nundefined,intensity));\n\n_this137.isAmbientLightProbe=true;\n\nvar color1=new Color().set(color);\n\n// without extra factor of PI in the shader, would be 2 / Math.sqrt( Math.PI );\n_this137.sh.coefficients[0].set(color1.r,color1.g,color1.b).multiplyScalar(2*Math.sqrt(Math.PI));return _this137;\n\n}return AmbientLightProbe;}(LightProbe);\n\n\n\nvar _eyeRight=/*@__PURE__*/new Matrix4();\nvar _eyeLeft=/*@__PURE__*/new Matrix4();\nvar _projectionMatrix=/*@__PURE__*/new Matrix4();var\n\nStereoCamera=function(){\n\nfunction StereoCamera(){_classCallCheck(this,StereoCamera);\n\nthis.type='StereoCamera';\n\nthis.aspect=1;\n\nthis.eyeSep=0.064;\n\nthis.cameraL=new PerspectiveCamera();\nthis.cameraL.layers.enable(1);\nthis.cameraL.matrixAutoUpdate=false;\n\nthis.cameraR=new PerspectiveCamera();\nthis.cameraR.layers.enable(2);\nthis.cameraR.matrixAutoUpdate=false;\n\nthis._cache={\nfocus:null,\nfov:null,\naspect:null,\nnear:null,\nfar:null,\nzoom:null,\neyeSep:null};\n\n\n}_createClass(StereoCamera,[{key:'update',value:function update(\n\ncamera){\n\nvar cache=this._cache;\n\nvar needsUpdate=cache.focus!==camera.focus||cache.fov!==camera.fov||\ncache.aspect!==camera.aspect*this.aspect||cache.near!==camera.near||\ncache.far!==camera.far||cache.zoom!==camera.zoom||cache.eyeSep!==this.eyeSep;\n\nif(needsUpdate){\n\ncache.focus=camera.focus;\ncache.fov=camera.fov;\ncache.aspect=camera.aspect*this.aspect;\ncache.near=camera.near;\ncache.far=camera.far;\ncache.zoom=camera.zoom;\ncache.eyeSep=this.eyeSep;\n\n// Off-axis stereoscopic effect based on\n// http://paulbourke.net/stereographics/stereorender/\n\n_projectionMatrix.copy(camera.projectionMatrix);\nvar eyeSepHalf=cache.eyeSep/2;\nvar eyeSepOnProjection=eyeSepHalf*cache.near/cache.focus;\nvar ymax=cache.near*Math.tan(DEG2RAD*cache.fov*0.5)/cache.zoom;\nvar xmin=void 0,xmax=void 0;\n\n// translate xOffset\n\n_eyeLeft.elements[12]=-eyeSepHalf;\n_eyeRight.elements[12]=eyeSepHalf;\n\n// for left eye\n\nxmin=-ymax*cache.aspect+eyeSepOnProjection;\nxmax=ymax*cache.aspect+eyeSepOnProjection;\n\n_projectionMatrix.elements[0]=2*cache.near/(xmax-xmin);\n_projectionMatrix.elements[8]=(xmax+xmin)/(xmax-xmin);\n\nthis.cameraL.projectionMatrix.copy(_projectionMatrix);\n\n// for right eye\n\nxmin=-ymax*cache.aspect-eyeSepOnProjection;\nxmax=ymax*cache.aspect-eyeSepOnProjection;\n\n_projectionMatrix.elements[0]=2*cache.near/(xmax-xmin);\n_projectionMatrix.elements[8]=(xmax+xmin)/(xmax-xmin);\n\nthis.cameraR.projectionMatrix.copy(_projectionMatrix);\n\n}\n\nthis.cameraL.matrixWorld.copy(camera.matrixWorld).multiply(_eyeLeft);\nthis.cameraR.matrixWorld.copy(camera.matrixWorld).multiply(_eyeRight);\n\n}}]);return StereoCamera;}();var\n\n\n\nClock=function(){\n\nfunction Clock(){var autoStart=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;_classCallCheck(this,Clock);\n\nthis.autoStart=autoStart;\n\nthis.startTime=0;\nthis.oldTime=0;\nthis.elapsedTime=0;\n\nthis.running=false;\n\n}_createClass(Clock,[{key:'start',value:function start()\n\n{\n\nthis.startTime=now();\n\nthis.oldTime=this.startTime;\nthis.elapsedTime=0;\nthis.running=true;\n\n}},{key:'stop',value:function stop()\n\n{\n\nthis.getElapsedTime();\nthis.running=false;\nthis.autoStart=false;\n\n}},{key:'getElapsedTime',value:function getElapsedTime()\n\n{\n\nthis.getDelta();\nreturn this.elapsedTime;\n\n}},{key:'getDelta',value:function getDelta()\n\n{\n\nvar diff=0;\n\nif(this.autoStart&&!this.running){\n\nthis.start();\nreturn 0;\n\n}\n\nif(this.running){\n\nvar newTime=now();\n\ndiff=(newTime-this.oldTime)/1000;\nthis.oldTime=newTime;\n\nthis.elapsedTime+=diff;\n\n}\n\nreturn diff;\n\n}}]);return Clock;}();\n\n\n\nfunction now(){\n\nreturn(typeof performance==='undefined'?Date:performance).now();// see #10732\n\n}\n\nvar _position$1=/*@__PURE__*/new Vector3();\nvar _quaternion$1=/*@__PURE__*/new Quaternion();\nvar _scale$1=/*@__PURE__*/new Vector3();\nvar _orientation$1=/*@__PURE__*/new Vector3();var\n\nAudioListener=function(_Object3D12){_inherits(AudioListener,_Object3D12);\n\nfunction AudioListener(){_classCallCheck(this,AudioListener);var _this138=_possibleConstructorReturn(this,(AudioListener.__proto__||Object.getPrototypeOf(AudioListener)).call(this));\n\n\n\n_this138.type='AudioListener';\n\n_this138.context=AudioContext.getContext();\n\n_this138.gain=_this138.context.createGain();\n_this138.gain.connect(_this138.context.destination);\n\n_this138.filter=null;\n\n_this138.timeDelta=0;\n\n// private\n\n_this138._clock=new Clock();return _this138;\n\n}_createClass(AudioListener,[{key:'getInput',value:function getInput()\n\n{\n\nreturn this.gain;\n\n}},{key:'removeFilter',value:function removeFilter()\n\n{\n\nif(this.filter!==null){\n\nthis.gain.disconnect(this.filter);\nthis.filter.disconnect(this.context.destination);\nthis.gain.connect(this.context.destination);\nthis.filter=null;\n\n}\n\nreturn this;\n\n}},{key:'getFilter',value:function getFilter()\n\n{\n\nreturn this.filter;\n\n}},{key:'setFilter',value:function setFilter(\n\nvalue){\n\nif(this.filter!==null){\n\nthis.gain.disconnect(this.filter);\nthis.filter.disconnect(this.context.destination);\n\n}else{\n\nthis.gain.disconnect(this.context.destination);\n\n}\n\nthis.filter=value;\nthis.gain.connect(this.filter);\nthis.filter.connect(this.context.destination);\n\nreturn this;\n\n}},{key:'getMasterVolume',value:function getMasterVolume()\n\n{\n\nreturn this.gain.gain.value;\n\n}},{key:'setMasterVolume',value:function setMasterVolume(\n\nvalue){\n\nthis.gain.gain.setTargetAtTime(value,this.context.currentTime,0.01);\n\nreturn this;\n\n}},{key:'updateMatrixWorld',value:function updateMatrixWorld(\n\nforce){\n\n_get(AudioListener.prototype.__proto__||Object.getPrototypeOf(AudioListener.prototype),'updateMatrixWorld',this).call(this,force);\n\nvar listener=this.context.listener;\nvar up=this.up;\n\nthis.timeDelta=this._clock.getDelta();\n\nthis.matrixWorld.decompose(_position$1,_quaternion$1,_scale$1);\n\n_orientation$1.set(0,0,-1).applyQuaternion(_quaternion$1);\n\nif(listener.positionX){\n\n// code path for Chrome (see #14393)\n\nvar endTime=this.context.currentTime+this.timeDelta;\n\nlistener.positionX.linearRampToValueAtTime(_position$1.x,endTime);\nlistener.positionY.linearRampToValueAtTime(_position$1.y,endTime);\nlistener.positionZ.linearRampToValueAtTime(_position$1.z,endTime);\nlistener.forwardX.linearRampToValueAtTime(_orientation$1.x,endTime);\nlistener.forwardY.linearRampToValueAtTime(_orientation$1.y,endTime);\nlistener.forwardZ.linearRampToValueAtTime(_orientation$1.z,endTime);\nlistener.upX.linearRampToValueAtTime(up.x,endTime);\nlistener.upY.linearRampToValueAtTime(up.y,endTime);\nlistener.upZ.linearRampToValueAtTime(up.z,endTime);\n\n}else{\n\nlistener.setPosition(_position$1.x,_position$1.y,_position$1.z);\nlistener.setOrientation(_orientation$1.x,_orientation$1.y,_orientation$1.z,up.x,up.y,up.z);\n\n}\n\n}}]);return AudioListener;}(Object3D);var\n\n\n\nAudio=function(_Object3D13){_inherits(Audio,_Object3D13);\n\nfunction Audio(listener){_classCallCheck(this,Audio);var _this139=_possibleConstructorReturn(this,(Audio.__proto__||Object.getPrototypeOf(Audio)).call(this));\n\n\n\n_this139.type='Audio';\n\n_this139.listener=listener;\n_this139.context=listener.context;\n\n_this139.gain=_this139.context.createGain();\n_this139.gain.connect(listener.getInput());\n\n_this139.autoplay=false;\n\n_this139.buffer=null;\n_this139.detune=0;\n_this139.loop=false;\n_this139.loopStart=0;\n_this139.loopEnd=0;\n_this139.offset=0;\n_this139.duration=undefined;\n_this139.playbackRate=1;\n_this139.isPlaying=false;\n_this139.hasPlaybackControl=true;\n_this139.source=null;\n_this139.sourceType='empty';\n\n_this139._startedAt=0;\n_this139._progress=0;\n_this139._connected=false;\n\n_this139.filters=[];return _this139;\n\n}_createClass(Audio,[{key:'getOutput',value:function getOutput()\n\n{\n\nreturn this.gain;\n\n}},{key:'setNodeSource',value:function setNodeSource(\n\naudioNode){\n\nthis.hasPlaybackControl=false;\nthis.sourceType='audioNode';\nthis.source=audioNode;\nthis.connect();\n\nreturn this;\n\n}},{key:'setMediaElementSource',value:function setMediaElementSource(\n\nmediaElement){\n\nthis.hasPlaybackControl=false;\nthis.sourceType='mediaNode';\nthis.source=this.context.createMediaElementSource(mediaElement);\nthis.connect();\n\nreturn this;\n\n}},{key:'setMediaStreamSource',value:function setMediaStreamSource(\n\nmediaStream){\n\nthis.hasPlaybackControl=false;\nthis.sourceType='mediaStreamNode';\nthis.source=this.context.createMediaStreamSource(mediaStream);\nthis.connect();\n\nreturn this;\n\n}},{key:'setBuffer',value:function setBuffer(\n\naudioBuffer){\n\nthis.buffer=audioBuffer;\nthis.sourceType='buffer';\n\nif(this.autoplay)this.play();\n\nreturn this;\n\n}},{key:'play',value:function play()\n\n{var delay=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;\n\nif(this.isPlaying===true){\n\nconsole.warn('THREE.Audio: Audio is already playing.');\nreturn;\n\n}\n\nif(this.hasPlaybackControl===false){\n\nconsole.warn('THREE.Audio: this Audio has no playback control.');\nreturn;\n\n}\n\nthis._startedAt=this.context.currentTime+delay;\n\nvar source=this.context.createBufferSource();\nsource.buffer=this.buffer;\nsource.loop=this.loop;\nsource.loopStart=this.loopStart;\nsource.loopEnd=this.loopEnd;\nsource.onended=this.onEnded.bind(this);\nsource.start(this._startedAt,this._progress+this.offset,this.duration);\n\nthis.isPlaying=true;\n\nthis.source=source;\n\nthis.setDetune(this.detune);\nthis.setPlaybackRate(this.playbackRate);\n\nreturn this.connect();\n\n}},{key:'pause',value:function pause()\n\n{\n\nif(this.hasPlaybackControl===false){\n\nconsole.warn('THREE.Audio: this Audio has no playback control.');\nreturn;\n\n}\n\nif(this.isPlaying===true){\n\n// update current progress\n\nthis._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate;\n\nif(this.loop===true){\n\n// ensure _progress does not exceed duration with looped audios\n\nthis._progress=this._progress%(this.duration||this.buffer.duration);\n\n}\n\nthis.source.stop();\nthis.source.onended=null;\n\nthis.isPlaying=false;\n\n}\n\nreturn this;\n\n}},{key:'stop',value:function stop()\n\n{\n\nif(this.hasPlaybackControl===false){\n\nconsole.warn('THREE.Audio: this Audio has no playback control.');\nreturn;\n\n}\n\nthis._progress=0;\n\nthis.source.stop();\nthis.source.onended=null;\nthis.isPlaying=false;\n\nreturn this;\n\n}},{key:'connect',value:function connect()\n\n{\n\nif(this.filters.length>0){\n\nthis.source.connect(this.filters[0]);\n\nfor(var i=1,l=this.filters.length;i<l;i++){\n\nthis.filters[i-1].connect(this.filters[i]);\n\n}\n\nthis.filters[this.filters.length-1].connect(this.getOutput());\n\n}else{\n\nthis.source.connect(this.getOutput());\n\n}\n\nthis._connected=true;\n\nreturn this;\n\n}},{key:'disconnect',value:function disconnect()\n\n{\n\nif(this.filters.length>0){\n\nthis.source.disconnect(this.filters[0]);\n\nfor(var i=1,l=this.filters.length;i<l;i++){\n\nthis.filters[i-1].disconnect(this.filters[i]);\n\n}\n\nthis.filters[this.filters.length-1].disconnect(this.getOutput());\n\n}else{\n\nthis.source.disconnect(this.getOutput());\n\n}\n\nthis._connected=false;\n\nreturn this;\n\n}},{key:'getFilters',value:function getFilters()\n\n{\n\nreturn this.filters;\n\n}},{key:'setFilters',value:function setFilters(\n\nvalue){\n\nif(!value)value=[];\n\nif(this._connected===true){\n\nthis.disconnect();\nthis.filters=value.slice();\nthis.connect();\n\n}else{\n\nthis.filters=value.slice();\n\n}\n\nreturn this;\n\n}},{key:'setDetune',value:function setDetune(\n\nvalue){\n\nthis.detune=value;\n\nif(this.source.detune===undefined)return;// only set detune when available\n\nif(this.isPlaying===true){\n\nthis.source.detune.setTargetAtTime(this.detune,this.context.currentTime,0.01);\n\n}\n\nreturn this;\n\n}},{key:'getDetune',value:function getDetune()\n\n{\n\nreturn this.detune;\n\n}},{key:'getFilter',value:function getFilter()\n\n{\n\nreturn this.getFilters()[0];\n\n}},{key:'setFilter',value:function setFilter(\n\nfilter){\n\nreturn this.setFilters(filter?[filter]:[]);\n\n}},{key:'setPlaybackRate',value:function setPlaybackRate(\n\nvalue){\n\nif(this.hasPlaybackControl===false){\n\nconsole.warn('THREE.Audio: this Audio has no playback control.');\nreturn;\n\n}\n\nthis.playbackRate=value;\n\nif(this.isPlaying===true){\n\nthis.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,0.01);\n\n}\n\nreturn this;\n\n}},{key:'getPlaybackRate',value:function getPlaybackRate()\n\n{\n\nreturn this.playbackRate;\n\n}},{key:'onEnded',value:function onEnded()\n\n{\n\nthis.isPlaying=false;\n\n}},{key:'getLoop',value:function getLoop()\n\n{\n\nif(this.hasPlaybackControl===false){\n\nconsole.warn('THREE.Audio: this Audio has no playback control.');\nreturn false;\n\n}\n\nreturn this.loop;\n\n}},{key:'setLoop',value:function setLoop(\n\nvalue){\n\nif(this.hasPlaybackControl===false){\n\nconsole.warn('THREE.Audio: this Audio has no playback control.');\nreturn;\n\n}\n\nthis.loop=value;\n\nif(this.isPlaying===true){\n\nthis.source.loop=this.loop;\n\n}\n\nreturn this;\n\n}},{key:'setLoopStart',value:function setLoopStart(\n\nvalue){\n\nthis.loopStart=value;\n\nreturn this;\n\n}},{key:'setLoopEnd',value:function setLoopEnd(\n\nvalue){\n\nthis.loopEnd=value;\n\nreturn this;\n\n}},{key:'getVolume',value:function getVolume()\n\n{\n\nreturn this.gain.gain.value;\n\n}},{key:'setVolume',value:function setVolume(\n\nvalue){\n\nthis.gain.gain.setTargetAtTime(value,this.context.currentTime,0.01);\n\nreturn this;\n\n}}]);return Audio;}(Object3D);\n\n\n\nvar _position=/*@__PURE__*/new Vector3();\nvar _quaternion=/*@__PURE__*/new Quaternion();\nvar _scale=/*@__PURE__*/new Vector3();\nvar _orientation=/*@__PURE__*/new Vector3();var\n\nPositionalAudio=function(_Audio){_inherits(PositionalAudio,_Audio);\n\nfunction PositionalAudio(listener){_classCallCheck(this,PositionalAudio);var _this140=_possibleConstructorReturn(this,(PositionalAudio.__proto__||Object.getPrototypeOf(PositionalAudio)).call(this,\n\nlistener));\n\n_this140.panner=_this140.context.createPanner();\n_this140.panner.panningModel='HRTF';\n_this140.panner.connect(_this140.gain);return _this140;\n\n}_createClass(PositionalAudio,[{key:'disconnect',value:function disconnect()\n\n{\n\n_get(PositionalAudio.prototype.__proto__||Object.getPrototypeOf(PositionalAudio.prototype),'disconnect',this).call(this);\n\nthis.panner.disconnect(this.gain);\n\n}},{key:'getOutput',value:function getOutput()\n\n{\n\nreturn this.panner;\n\n}},{key:'getRefDistance',value:function getRefDistance()\n\n{\n\nreturn this.panner.refDistance;\n\n}},{key:'setRefDistance',value:function setRefDistance(\n\nvalue){\n\nthis.panner.refDistance=value;\n\nreturn this;\n\n}},{key:'getRolloffFactor',value:function getRolloffFactor()\n\n{\n\nreturn this.panner.rolloffFactor;\n\n}},{key:'setRolloffFactor',value:function setRolloffFactor(\n\nvalue){\n\nthis.panner.rolloffFactor=value;\n\nreturn this;\n\n}},{key:'getDistanceModel',value:function getDistanceModel()\n\n{\n\nreturn this.panner.distanceModel;\n\n}},{key:'setDistanceModel',value:function setDistanceModel(\n\nvalue){\n\nthis.panner.distanceModel=value;\n\nreturn this;\n\n}},{key:'getMaxDistance',value:function getMaxDistance()\n\n{\n\nreturn this.panner.maxDistance;\n\n}},{key:'setMaxDistance',value:function setMaxDistance(\n\nvalue){\n\nthis.panner.maxDistance=value;\n\nreturn this;\n\n}},{key:'setDirectionalCone',value:function setDirectionalCone(\n\nconeInnerAngle,coneOuterAngle,coneOuterGain){\n\nthis.panner.coneInnerAngle=coneInnerAngle;\nthis.panner.coneOuterAngle=coneOuterAngle;\nthis.panner.coneOuterGain=coneOuterGain;\n\nreturn this;\n\n}},{key:'updateMatrixWorld',value:function updateMatrixWorld(\n\nforce){\n\n_get(PositionalAudio.prototype.__proto__||Object.getPrototypeOf(PositionalAudio.prototype),'updateMatrixWorld',this).call(this,force);\n\nif(this.hasPlaybackControl===true&&this.isPlaying===false)return;\n\nthis.matrixWorld.decompose(_position,_quaternion,_scale);\n\n_orientation.set(0,0,1).applyQuaternion(_quaternion);\n\nvar panner=this.panner;\n\nif(panner.positionX){\n\n// code path for Chrome and Firefox (see #14393)\n\nvar endTime=this.context.currentTime+this.listener.timeDelta;\n\npanner.positionX.linearRampToValueAtTime(_position.x,endTime);\npanner.positionY.linearRampToValueAtTime(_position.y,endTime);\npanner.positionZ.linearRampToValueAtTime(_position.z,endTime);\npanner.orientationX.linearRampToValueAtTime(_orientation.x,endTime);\npanner.orientationY.linearRampToValueAtTime(_orientation.y,endTime);\npanner.orientationZ.linearRampToValueAtTime(_orientation.z,endTime);\n\n}else{\n\npanner.setPosition(_position.x,_position.y,_position.z);\npanner.setOrientation(_orientation.x,_orientation.y,_orientation.z);\n\n}\n\n}}]);return PositionalAudio;}(Audio);var\n\n\n\nAudioAnalyser=function(){\n\nfunction AudioAnalyser(audio){var fftSize=arguments.length>1&&arguments[1]!==undefined?arguments[1]:2048;_classCallCheck(this,AudioAnalyser);\n\nthis.analyser=audio.context.createAnalyser();\nthis.analyser.fftSize=fftSize;\n\nthis.data=new Uint8Array(this.analyser.frequencyBinCount);\n\naudio.getOutput().connect(this.analyser);\n\n}_createClass(AudioAnalyser,[{key:'getFrequencyData',value:function getFrequencyData()\n\n\n{\n\nthis.analyser.getByteFrequencyData(this.data);\n\nreturn this.data;\n\n}},{key:'getAverageFrequency',value:function getAverageFrequency()\n\n{\n\nvar value=0;\nvar data=this.getFrequencyData();\n\nfor(var i=0;i<data.length;i++){\n\nvalue+=data[i];\n\n}\n\nreturn value/data.length;\n\n}}]);return AudioAnalyser;}();var\n\n\n\nPropertyMixer=function(){\n\nfunction PropertyMixer(binding,typeName,valueSize){_classCallCheck(this,PropertyMixer);\n\nthis.binding=binding;\nthis.valueSize=valueSize;\n\nvar mixFunction=void 0,\nmixFunctionAdditive=void 0,\nsetIdentity=void 0;\n\n// buffer layout: [ incoming | accu0 | accu1 | orig | addAccu | (optional work) ]\n//\n// interpolators can use .buffer as their .result\n// the data then goes to 'incoming'\n//\n// 'accu0' and 'accu1' are used frame-interleaved for\n// the cumulative result and are compared to detect\n// changes\n//\n// 'orig' stores the original state of the property\n//\n// 'add' is used for additive cumulative results\n//\n// 'work' is optional and is only present for quaternion types. It is used\n// to store intermediate quaternion multiplication results\n\nswitch(typeName){\n\ncase'quaternion':\nmixFunction=this._slerp;\nmixFunctionAdditive=this._slerpAdditive;\nsetIdentity=this._setAdditiveIdentityQuaternion;\n\nthis.buffer=new Float64Array(valueSize*6);\nthis._workIndex=5;\nbreak;\n\ncase'string':\ncase'bool':\nmixFunction=this._select;\n\n// Use the regular mix function and for additive on these types,\n// additive is not relevant for non-numeric types\nmixFunctionAdditive=this._select;\n\nsetIdentity=this._setAdditiveIdentityOther;\n\nthis.buffer=new Array(valueSize*5);\nbreak;\n\ndefault:\nmixFunction=this._lerp;\nmixFunctionAdditive=this._lerpAdditive;\nsetIdentity=this._setAdditiveIdentityNumeric;\n\nthis.buffer=new Float64Array(valueSize*5);}\n\n\n\nthis._mixBufferRegion=mixFunction;\nthis._mixBufferRegionAdditive=mixFunctionAdditive;\nthis._setIdentity=setIdentity;\nthis._origIndex=3;\nthis._addIndex=4;\n\nthis.cumulativeWeight=0;\nthis.cumulativeWeightAdditive=0;\n\nthis.useCount=0;\nthis.referenceCount=0;\n\n}\n\n// accumulate data in the 'incoming' region into 'accu<i>'\n_createClass(PropertyMixer,[{key:'accumulate',value:function accumulate(accuIndex,weight){\n\n// note: happily accumulating nothing when weight = 0, the caller knows\n// the weight and shouldn't have made the call in the first place\n\nvar buffer=this.buffer,\nstride=this.valueSize,\noffset=accuIndex*stride+stride;\n\nvar currentWeight=this.cumulativeWeight;\n\nif(currentWeight===0){\n\n// accuN := incoming * weight\n\nfor(var i=0;i!==stride;++i){\n\nbuffer[offset+i]=buffer[i];\n\n}\n\ncurrentWeight=weight;\n\n}else{\n\n// accuN := accuN + incoming * weight\n\ncurrentWeight+=weight;\nvar mix=weight/currentWeight;\nthis._mixBufferRegion(buffer,offset,0,mix,stride);\n\n}\n\nthis.cumulativeWeight=currentWeight;\n\n}\n\n// accumulate data in the 'incoming' region into 'add'\n},{key:'accumulateAdditive',value:function accumulateAdditive(weight){\n\nvar buffer=this.buffer,\nstride=this.valueSize,\noffset=stride*this._addIndex;\n\nif(this.cumulativeWeightAdditive===0){\n\n// add = identity\n\nthis._setIdentity();\n\n}\n\n// add := add + incoming * weight\n\nthis._mixBufferRegionAdditive(buffer,offset,0,weight,stride);\nthis.cumulativeWeightAdditive+=weight;\n\n}\n\n// apply the state of 'accu<i>' to the binding when accus differ\n},{key:'apply',value:function apply(accuIndex){\n\nvar stride=this.valueSize,\nbuffer=this.buffer,\noffset=accuIndex*stride+stride,\n\nweight=this.cumulativeWeight,\nweightAdditive=this.cumulativeWeightAdditive,\n\nbinding=this.binding;\n\nthis.cumulativeWeight=0;\nthis.cumulativeWeightAdditive=0;\n\nif(weight<1){\n\n// accuN := accuN + original * ( 1 - cumulativeWeight )\n\nvar originalValueOffset=stride*this._origIndex;\n\nthis._mixBufferRegion(\nbuffer,offset,originalValueOffset,1-weight,stride);\n\n}\n\nif(weightAdditive>0){\n\n// accuN := accuN + additive accuN\n\nthis._mixBufferRegionAdditive(buffer,offset,this._addIndex*stride,1,stride);\n\n}\n\nfor(var i=stride,e=stride+stride;i!==e;++i){\n\nif(buffer[i]!==buffer[i+stride]){\n\n// value has changed -> update scene graph\n\nbinding.setValue(buffer,offset);\nbreak;\n\n}\n\n}\n\n}\n\n// remember the state of the bound property and copy it to both accus\n},{key:'saveOriginalState',value:function saveOriginalState(){\n\nvar binding=this.binding;\n\nvar buffer=this.buffer,\nstride=this.valueSize,\n\noriginalValueOffset=stride*this._origIndex;\n\nbinding.getValue(buffer,originalValueOffset);\n\n// accu[0..1] := orig -- initially detect changes against the original\nfor(var i=stride,e=originalValueOffset;i!==e;++i){\n\nbuffer[i]=buffer[originalValueOffset+i%stride];\n\n}\n\n// Add to identity for additive\nthis._setIdentity();\n\nthis.cumulativeWeight=0;\nthis.cumulativeWeightAdditive=0;\n\n}\n\n// apply the state previously taken via 'saveOriginalState' to the binding\n},{key:'restoreOriginalState',value:function restoreOriginalState(){\n\nvar originalValueOffset=this.valueSize*3;\nthis.binding.setValue(this.buffer,originalValueOffset);\n\n}},{key:'_setAdditiveIdentityNumeric',value:function _setAdditiveIdentityNumeric()\n\n{\n\nvar startIndex=this._addIndex*this.valueSize;\nvar endIndex=startIndex+this.valueSize;\n\nfor(var i=startIndex;i<endIndex;i++){\n\nthis.buffer[i]=0;\n\n}\n\n}},{key:'_setAdditiveIdentityQuaternion',value:function _setAdditiveIdentityQuaternion()\n\n{\n\nthis._setAdditiveIdentityNumeric();\nthis.buffer[this._addIndex*this.valueSize+3]=1;\n\n}},{key:'_setAdditiveIdentityOther',value:function _setAdditiveIdentityOther()\n\n{\n\nvar startIndex=this._origIndex*this.valueSize;\nvar targetIndex=this._addIndex*this.valueSize;\n\nfor(var i=0;i<this.valueSize;i++){\n\nthis.buffer[targetIndex+i]=this.buffer[startIndex+i];\n\n}\n\n}\n\n\n// mix functions\n},{key:'_select',value:function _select(\nbuffer,dstOffset,srcOffset,t,stride){\n\nif(t>=0.5){\n\nfor(var i=0;i!==stride;++i){\n\nbuffer[dstOffset+i]=buffer[srcOffset+i];\n\n}\n\n}\n\n}},{key:'_slerp',value:function _slerp(\n\nbuffer,dstOffset,srcOffset,t){\n\nQuaternion.slerpFlat(buffer,dstOffset,buffer,dstOffset,buffer,srcOffset,t);\n\n}},{key:'_slerpAdditive',value:function _slerpAdditive(\n\nbuffer,dstOffset,srcOffset,t,stride){\n\nvar workOffset=this._workIndex*stride;\n\n// Store result in intermediate buffer offset\nQuaternion.multiplyQuaternionsFlat(buffer,workOffset,buffer,dstOffset,buffer,srcOffset);\n\n// Slerp to the intermediate result\nQuaternion.slerpFlat(buffer,dstOffset,buffer,dstOffset,buffer,workOffset,t);\n\n}},{key:'_lerp',value:function _lerp(\n\nbuffer,dstOffset,srcOffset,t,stride){\n\nvar s=1-t;\n\nfor(var i=0;i!==stride;++i){\n\nvar j=dstOffset+i;\n\nbuffer[j]=buffer[j]*s+buffer[srcOffset+i]*t;\n\n}\n\n}},{key:'_lerpAdditive',value:function _lerpAdditive(\n\nbuffer,dstOffset,srcOffset,t,stride){\n\nfor(var i=0;i!==stride;++i){\n\nvar j=dstOffset+i;\n\nbuffer[j]=buffer[j]+buffer[srcOffset+i]*t;\n\n}\n\n}}]);return PropertyMixer;}();\n\n\n\n// Characters [].:/ are reserved for track binding syntax.\nvar _RESERVED_CHARS_RE='\\\\[\\\\]\\\\.:\\\\/';\nvar _reservedRe=new RegExp('['+_RESERVED_CHARS_RE+']','g');\n\n// Attempts to allow node names from any language. ES5's `\\w` regexp matches\n// only latin characters, and the unicode \\p{L} is not yet supported. So\n// instead, we exclude reserved characters and match everything else.\nvar _wordChar='[^'+_RESERVED_CHARS_RE+']';\nvar _wordCharOrDot='[^'+_RESERVED_CHARS_RE.replace('\\\\.','')+']';\n\n// Parent directories, delimited by '/' or ':'. Currently unused, but must\n// be matched to parse the rest of the track name.\nvar _directoryRe=/*@__PURE__*//((?:WC+[\\/:])*)/.source.replace('WC',_wordChar);\n\n// Target node. May contain word characters (a-zA-Z0-9_) and '.' or '-'.\nvar _nodeRe=/*@__PURE__*//(WCOD+)?/.source.replace('WCOD',_wordCharOrDot);\n\n// Object on target node, and accessor. May not contain reserved\n// characters. Accessor may contain any character except closing bracket.\nvar _objectRe=/*@__PURE__*//(?:\\.(WC+)(?:\\[(.+)\\])?)?/.source.replace('WC',_wordChar);\n\n// Property and accessor. May not contain reserved characters. Accessor may\n// contain any non-bracket characters.\nvar _propertyRe=/*@__PURE__*//\\.(WC+)(?:\\[(.+)\\])?/.source.replace('WC',_wordChar);\n\nvar _trackRe=new RegExp(''+\n'^'+\n_directoryRe+\n_nodeRe+\n_objectRe+\n_propertyRe+\n'$');\n\n\nvar _supportedObjectNames=['material','materials','bones'];var\n\nComposite=function(){\n\nfunction Composite(targetGroup,path,optionalParsedPath){_classCallCheck(this,Composite);\n\nvar parsedPath=optionalParsedPath||PropertyBinding.parseTrackName(path);\n\nthis._targetGroup=targetGroup;\nthis._bindings=targetGroup.subscribe_(path,parsedPath);\n\n}_createClass(Composite,[{key:'getValue',value:function getValue(\n\narray,offset){\n\nthis.bind();// bind all binding\n\nvar firstValidIndex=this._targetGroup.nCachedObjects_,\nbinding=this._bindings[firstValidIndex];\n\n// and only call .getValue on the first\nif(binding!==undefined)binding.getValue(array,offset);\n\n}},{key:'setValue',value:function setValue(\n\narray,offset){\n\nvar bindings=this._bindings;\n\nfor(var i=this._targetGroup.nCachedObjects_,_n11=bindings.length;i!==_n11;++i){\n\nbindings[i].setValue(array,offset);\n\n}\n\n}},{key:'bind',value:function bind()\n\n{\n\nvar bindings=this._bindings;\n\nfor(var i=this._targetGroup.nCachedObjects_,_n12=bindings.length;i!==_n12;++i){\n\nbindings[i].bind();\n\n}\n\n}},{key:'unbind',value:function unbind()\n\n{\n\nvar bindings=this._bindings;\n\nfor(var i=this._targetGroup.nCachedObjects_,_n13=bindings.length;i!==_n13;++i){\n\nbindings[i].unbind();\n\n}\n\n}}]);return Composite;}();\n\n\n\n// Note: This class uses a State pattern on a per-method basis:\n// 'bind' sets 'this.getValue' / 'setValue' and shadows the\n// prototype version of these methods with one that represents\n// the bound state. When the property is not found, the methods\n// become no-ops.\nvar PropertyBinding=function(){\n\nfunction PropertyBinding(rootNode,path,parsedPath){_classCallCheck(this,PropertyBinding);\n\nthis.path=path;\nthis.parsedPath=parsedPath||PropertyBinding.parseTrackName(path);\n\nthis.node=PropertyBinding.findNode(rootNode,this.parsedPath.nodeName)||rootNode;\n\nthis.rootNode=rootNode;\n\n// initial state of these methods that calls 'bind'\nthis.getValue=this._getValue_unbound;\nthis.setValue=this._setValue_unbound;\n\n}_createClass(PropertyBinding,[{key:'_getValue_unavailable',\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n// these are used to \"bind\" a nonexistent property\nvalue:function _getValue_unavailable(){}},{key:'_setValue_unavailable',value:function _setValue_unavailable()\n{}\n\n// Getters\n},{key:'_getValue_direct',value:function _getValue_direct(\nbuffer,offset){\n\nbuffer[offset]=this.targetObject[this.propertyName];\n\n}},{key:'_getValue_array',value:function _getValue_array(\n\nbuffer,offset){\n\nvar source=this.resolvedProperty;\n\nfor(var i=0,_n14=source.length;i!==_n14;++i){\n\nbuffer[offset++]=source[i];\n\n}\n\n}},{key:'_getValue_arrayElement',value:function _getValue_arrayElement(\n\nbuffer,offset){\n\nbuffer[offset]=this.resolvedProperty[this.propertyIndex];\n\n}},{key:'_getValue_toArray',value:function _getValue_toArray(\n\nbuffer,offset){\n\nthis.resolvedProperty.toArray(buffer,offset);\n\n}\n\n// Direct\n},{key:'_setValue_direct',value:function _setValue_direct(\nbuffer,offset){\n\nthis.targetObject[this.propertyName]=buffer[offset];\n\n}},{key:'_setValue_direct_setNeedsUpdate',value:function _setValue_direct_setNeedsUpdate(\n\nbuffer,offset){\n\nthis.targetObject[this.propertyName]=buffer[offset];\nthis.targetObject.needsUpdate=true;\n\n}},{key:'_setValue_direct_setMatrixWorldNeedsUpdate',value:function _setValue_direct_setMatrixWorldNeedsUpdate(\n\nbuffer,offset){\n\nthis.targetObject[this.propertyName]=buffer[offset];\nthis.targetObject.matrixWorldNeedsUpdate=true;\n\n}\n\n// EntireArray\n},{key:'_setValue_array',value:function _setValue_array(\nbuffer,offset){\n\nvar dest=this.resolvedProperty;\n\nfor(var i=0,_n15=dest.length;i!==_n15;++i){\n\ndest[i]=buffer[offset++];\n\n}\n\n}},{key:'_setValue_array_setNeedsUpdate',value:function _setValue_array_setNeedsUpdate(\n\nbuffer,offset){\n\nvar dest=this.resolvedProperty;\n\nfor(var i=0,_n16=dest.length;i!==_n16;++i){\n\ndest[i]=buffer[offset++];\n\n}\n\nthis.targetObject.needsUpdate=true;\n\n}},{key:'_setValue_array_setMatrixWorldNeedsUpdate',value:function _setValue_array_setMatrixWorldNeedsUpdate(\n\nbuffer,offset){\n\nvar dest=this.resolvedProperty;\n\nfor(var i=0,_n17=dest.length;i!==_n17;++i){\n\ndest[i]=buffer[offset++];\n\n}\n\nthis.targetObject.matrixWorldNeedsUpdate=true;\n\n}\n\n// ArrayElement\n},{key:'_setValue_arrayElement',value:function _setValue_arrayElement(\nbuffer,offset){\n\nthis.resolvedProperty[this.propertyIndex]=buffer[offset];\n\n}},{key:'_setValue_arrayElement_setNeedsUpdate',value:function _setValue_arrayElement_setNeedsUpdate(\n\nbuffer,offset){\n\nthis.resolvedProperty[this.propertyIndex]=buffer[offset];\nthis.targetObject.needsUpdate=true;\n\n}},{key:'_setValue_arrayElement_setMatrixWorldNeedsUpdate',value:function _setValue_arrayElement_setMatrixWorldNeedsUpdate(\n\nbuffer,offset){\n\nthis.resolvedProperty[this.propertyIndex]=buffer[offset];\nthis.targetObject.matrixWorldNeedsUpdate=true;\n\n}\n\n// HasToFromArray\n},{key:'_setValue_fromArray',value:function _setValue_fromArray(\nbuffer,offset){\n\nthis.resolvedProperty.fromArray(buffer,offset);\n\n}},{key:'_setValue_fromArray_setNeedsUpdate',value:function _setValue_fromArray_setNeedsUpdate(\n\nbuffer,offset){\n\nthis.resolvedProperty.fromArray(buffer,offset);\nthis.targetObject.needsUpdate=true;\n\n}},{key:'_setValue_fromArray_setMatrixWorldNeedsUpdate',value:function _setValue_fromArray_setMatrixWorldNeedsUpdate(\n\nbuffer,offset){\n\nthis.resolvedProperty.fromArray(buffer,offset);\nthis.targetObject.matrixWorldNeedsUpdate=true;\n\n}},{key:'_getValue_unbound',value:function _getValue_unbound(\n\ntargetArray,offset){\n\nthis.bind();\nthis.getValue(targetArray,offset);\n\n}},{key:'_setValue_unbound',value:function _setValue_unbound(\n\nsourceArray,offset){\n\nthis.bind();\nthis.setValue(sourceArray,offset);\n\n}\n\n// create getter / setter pair for a property in the scene graph\n},{key:'bind',value:function bind(){\n\nvar targetObject=this.node;\nvar parsedPath=this.parsedPath;\n\nvar objectName=parsedPath.objectName;\nvar propertyName=parsedPath.propertyName;\nvar propertyIndex=parsedPath.propertyIndex;\n\nif(!targetObject){\n\ntargetObject=PropertyBinding.findNode(this.rootNode,parsedPath.nodeName)||this.rootNode;\n\nthis.node=targetObject;\n\n}\n\n// set fail state so we can just 'return' on error\nthis.getValue=this._getValue_unavailable;\nthis.setValue=this._setValue_unavailable;\n\n// ensure there is a value node\nif(!targetObject){\n\nconsole.error('THREE.PropertyBinding: Trying to update node for track: '+this.path+' but it wasn\\'t found.');\nreturn;\n\n}\n\nif(objectName){\n\nvar objectIndex=parsedPath.objectIndex;\n\n// special cases were we need to reach deeper into the hierarchy to get the face materials....\nswitch(objectName){\n\ncase'materials':\n\nif(!targetObject.material){\n\nconsole.error('THREE.PropertyBinding: Can not bind to material as node does not have a material.',this);\nreturn;\n\n}\n\nif(!targetObject.material.materials){\n\nconsole.error('THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.',this);\nreturn;\n\n}\n\ntargetObject=targetObject.material.materials;\n\nbreak;\n\ncase'bones':\n\nif(!targetObject.skeleton){\n\nconsole.error('THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.',this);\nreturn;\n\n}\n\n// potential future optimization: skip this if propertyIndex is already an integer\n// and convert the integer string to a true integer.\n\ntargetObject=targetObject.skeleton.bones;\n\n// support resolving morphTarget names into indices.\nfor(var i=0;i<targetObject.length;i++){\n\nif(targetObject[i].name===objectIndex){\n\nobjectIndex=i;\nbreak;\n\n}\n\n}\n\nbreak;\n\ndefault:\n\nif(targetObject[objectName]===undefined){\n\nconsole.error('THREE.PropertyBinding: Can not bind to objectName of node undefined.',this);\nreturn;\n\n}\n\ntargetObject=targetObject[objectName];}\n\n\n\n\nif(objectIndex!==undefined){\n\nif(targetObject[objectIndex]===undefined){\n\nconsole.error('THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.',this,targetObject);\nreturn;\n\n}\n\ntargetObject=targetObject[objectIndex];\n\n}\n\n}\n\n// resolve property\nvar nodeProperty=targetObject[propertyName];\n\nif(nodeProperty===undefined){\n\nvar nodeName=parsedPath.nodeName;\n\nconsole.error('THREE.PropertyBinding: Trying to update property for track: '+nodeName+\n'.'+propertyName+' but it wasn\\'t found.',targetObject);\nreturn;\n\n}\n\n// determine versioning scheme\nvar versioning=this.Versioning.None;\n\nthis.targetObject=targetObject;\n\nif(targetObject.needsUpdate!==undefined){// material\n\nversioning=this.Versioning.NeedsUpdate;\n\n}else if(targetObject.matrixWorldNeedsUpdate!==undefined){// node transform\n\nversioning=this.Versioning.MatrixWorldNeedsUpdate;\n\n}\n\n// determine how the property gets bound\nvar bindingType=this.BindingType.Direct;\n\nif(propertyIndex!==undefined){\n\n// access a sub element of the property array (only primitives are supported right now)\n\nif(propertyName==='morphTargetInfluences'){\n\n// potential optimization, skip this if propertyIndex is already an integer, and convert the integer string to a true integer.\n\n// support resolving morphTarget names into indices.\nif(!targetObject.geometry){\n\nconsole.error('THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.',this);\nreturn;\n\n}\n\nif(!targetObject.geometry.morphAttributes){\n\nconsole.error('THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.',this);\nreturn;\n\n}\n\nif(targetObject.morphTargetDictionary[propertyIndex]!==undefined){\n\npropertyIndex=targetObject.morphTargetDictionary[propertyIndex];\n\n}\n\n}\n\nbindingType=this.BindingType.ArrayElement;\n\nthis.resolvedProperty=nodeProperty;\nthis.propertyIndex=propertyIndex;\n\n}else if(nodeProperty.fromArray!==undefined&&nodeProperty.toArray!==undefined){\n\n// must use copy for Object3D.Euler/Quaternion\n\nbindingType=this.BindingType.HasFromToArray;\n\nthis.resolvedProperty=nodeProperty;\n\n}else if(Array.isArray(nodeProperty)){\n\nbindingType=this.BindingType.EntireArray;\n\nthis.resolvedProperty=nodeProperty;\n\n}else{\n\nthis.propertyName=propertyName;\n\n}\n\n// select getter / setter\nthis.getValue=this.GetterByBindingType[bindingType];\nthis.setValue=this.SetterByBindingTypeAndVersioning[bindingType][versioning];\n\n}},{key:'unbind',value:function unbind()\n\n{\n\nthis.node=null;\n\n// back to the prototype version of getValue / setValue\n// note: avoiding to mutate the shape of 'this' via 'delete'\nthis.getValue=this._getValue_unbound;\nthis.setValue=this._setValue_unbound;\n\n}}],[{key:'create',value:function create(root,path,parsedPath){if(!(root&&root.isAnimationObjectGroup)){return new PropertyBinding(root,path,parsedPath);}else{return new PropertyBinding.Composite(root,path,parsedPath);}}/**\n\t * Replaces spaces with underscores and removes unsupported characters from\n\t * node names, to ensure compatibility with parseTrackName().\n\t *\n\t * @param {string} name Node name to be sanitized.\n\t * @return {string}\n\t */},{key:'sanitizeNodeName',value:function sanitizeNodeName(name){return name.replace(/\\s/g,'_').replace(_reservedRe,'');}},{key:'parseTrackName',value:function parseTrackName(trackName){var matches=_trackRe.exec(trackName);if(matches===null){throw new Error('PropertyBinding: Cannot parse trackName: '+trackName);}var results={// directoryName: matches[ 1 ], // (tschw) currently unused\nnodeName:matches[2],objectName:matches[3],objectIndex:matches[4],propertyName:matches[5],// required\npropertyIndex:matches[6]};var lastDot=results.nodeName&&results.nodeName.lastIndexOf('.');if(lastDot!==undefined&&lastDot!==-1){var objectName=results.nodeName.substring(lastDot+1);// Object names must be checked against an allowlist. Otherwise, there\n// is no way to parse 'foo.bar.baz': 'baz' must be a property, but\n// 'bar' could be the objectName, or part of a nodeName (which can\n// include '.' characters).\nif(_supportedObjectNames.indexOf(objectName)!==-1){results.nodeName=results.nodeName.substring(0,lastDot);results.objectName=objectName;}}if(results.propertyName===null||results.propertyName.length===0){throw new Error('PropertyBinding: can not parse propertyName from trackName: '+trackName);}return results;}},{key:'findNode',value:function findNode(root,nodeName){if(nodeName===undefined||nodeName===''||nodeName==='.'||nodeName===-1||nodeName===root.name||nodeName===root.uuid){return root;}// search into skeleton bones.\nif(root.skeleton){var bone=root.skeleton.getBoneByName(nodeName);if(bone!==undefined){return bone;}}// search into node subtree.\nif(root.children){var searchNodeSubtree=function searchNodeSubtree(children){for(var i=0;i<children.length;i++){var childNode=children[i];if(childNode.name===nodeName||childNode.uuid===nodeName){return childNode;}var result=searchNodeSubtree(childNode.children);if(result)return result;}return null;};var subTreeNode=searchNodeSubtree(root.children);if(subTreeNode){return subTreeNode;}}return null;}}]);return PropertyBinding;}();PropertyBinding.Composite=Composite;PropertyBinding.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3};PropertyBinding.prototype.Versioning={None:0,\nNeedsUpdate:1,\nMatrixWorldNeedsUpdate:2};\n\n\nPropertyBinding.prototype.GetterByBindingType=[\n\nPropertyBinding.prototype._getValue_direct,\nPropertyBinding.prototype._getValue_array,\nPropertyBinding.prototype._getValue_arrayElement,\nPropertyBinding.prototype._getValue_toArray];\n\n\n\nPropertyBinding.prototype.SetterByBindingTypeAndVersioning=[\n\n[\n// Direct\nPropertyBinding.prototype._setValue_direct,\nPropertyBinding.prototype._setValue_direct_setNeedsUpdate,\nPropertyBinding.prototype._setValue_direct_setMatrixWorldNeedsUpdate],\n\n[\n\n// EntireArray\n\nPropertyBinding.prototype._setValue_array,\nPropertyBinding.prototype._setValue_array_setNeedsUpdate,\nPropertyBinding.prototype._setValue_array_setMatrixWorldNeedsUpdate],\n\n[\n\n// ArrayElement\nPropertyBinding.prototype._setValue_arrayElement,\nPropertyBinding.prototype._setValue_arrayElement_setNeedsUpdate,\nPropertyBinding.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],\n\n[\n\n// HasToFromArray\nPropertyBinding.prototype._setValue_fromArray,\nPropertyBinding.prototype._setValue_fromArray_setNeedsUpdate,\nPropertyBinding.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];\n\n\n\n\n\n/**\n *\n * A group of objects that receives a shared animation state.\n *\n * Usage:\n *\n *  - Add objects you would otherwise pass as 'root' to the\n *    constructor or the .clipAction method of AnimationMixer.\n *\n *  - Instead pass this object as 'root'.\n *\n *  - You can also add and remove objects later when the mixer\n *    is running.\n *\n * Note:\n *\n *    Objects of this class appear as one object to the mixer,\n *    so cache control of the individual objects must be done\n *    on the group.\n *\n * Limitation:\n *\n *  - The animated properties must be compatible among the\n *    all objects in the group.\n *\n *  - A single property can either be controlled through a\n *    target group or directly, but not both.\n */var\n\nAnimationObjectGroup=function(){\n\nfunction AnimationObjectGroup(){_classCallCheck(this,AnimationObjectGroup);\n\nthis.isAnimationObjectGroup=true;\n\nthis.uuid=generateUUID();\n\n// cached objects followed by the active ones\nthis._objects=Array.prototype.slice.call(arguments);\n\nthis.nCachedObjects_=0;// threshold\n// note: read by PropertyBinding.Composite\n\nvar indices={};\nthis._indicesByUUID=indices;// for bookkeeping\n\nfor(var i=0,_n18=arguments.length;i!==_n18;++i){\n\nindices[arguments[i].uuid]=i;\n\n}\n\nthis._paths=[];// inside: string\nthis._parsedPaths=[];// inside: { we don't care, here }\nthis._bindings=[];// inside: Array< PropertyBinding >\nthis._bindingsIndicesByPath={};// inside: indices in these arrays\n\nvar scope=this;\n\nthis.stats={\n\nobjects:{\nget total(){\n\nreturn scope._objects.length;\n\n},\nget inUse(){\n\nreturn this.total-scope.nCachedObjects_;\n\n}},\n\nget bindingsPerObject(){\n\nreturn scope._bindings.length;\n\n}};\n\n\n\n}_createClass(AnimationObjectGroup,[{key:'add',value:function add()\n\n{\n\nvar objects=this._objects,\nindicesByUUID=this._indicesByUUID,\npaths=this._paths,\nparsedPaths=this._parsedPaths,\nbindings=this._bindings,\nnBindings=bindings.length;\n\nvar knownObject=undefined,\nnObjects=objects.length,\nnCachedObjects=this.nCachedObjects_;\n\nfor(var i=0,_n19=arguments.length;i!==_n19;++i){\n\nvar _object=arguments[i],\nuuid=_object.uuid;\nvar _index3=indicesByUUID[uuid];\n\nif(_index3===undefined){\n\n// unknown object -> add it to the ACTIVE region\n\n_index3=nObjects++;\nindicesByUUID[uuid]=_index3;\nobjects.push(_object);\n\n// accounting is done, now do the same for all bindings\n\nfor(var j=0,m=nBindings;j!==m;++j){\n\nbindings[j].push(new PropertyBinding(_object,paths[j],parsedPaths[j]));\n\n}\n\n}else if(_index3<nCachedObjects){\n\nknownObject=objects[_index3];\n\n// move existing object to the ACTIVE region\n\nvar firstActiveIndex=--nCachedObjects,\nlastCachedObject=objects[firstActiveIndex];\n\nindicesByUUID[lastCachedObject.uuid]=_index3;\nobjects[_index3]=lastCachedObject;\n\nindicesByUUID[uuid]=firstActiveIndex;\nobjects[firstActiveIndex]=_object;\n\n// accounting is done, now do the same for all bindings\n\nfor(var _j16=0,_m2=nBindings;_j16!==_m2;++_j16){\n\nvar bindingsForPath=bindings[_j16],\nlastCached=bindingsForPath[firstActiveIndex];\n\nvar binding=bindingsForPath[_index3];\n\nbindingsForPath[_index3]=lastCached;\n\nif(binding===undefined){\n\n// since we do not bother to create new bindings\n// for objects that are cached, the binding may\n// or may not exist\n\nbinding=new PropertyBinding(_object,paths[_j16],parsedPaths[_j16]);\n\n}\n\nbindingsForPath[firstActiveIndex]=binding;\n\n}\n\n}else if(objects[_index3]!==knownObject){\n\nconsole.error('THREE.AnimationObjectGroup: Different objects with the same UUID '+\n'detected. Clean the caches or recreate your infrastructure when reloading scenes.');\n\n}// else the object is already where we want it to be\n\n}// for arguments\n\nthis.nCachedObjects_=nCachedObjects;\n\n}},{key:'remove',value:function remove()\n\n{\n\nvar objects=this._objects,\nindicesByUUID=this._indicesByUUID,\nbindings=this._bindings,\nnBindings=bindings.length;\n\nvar nCachedObjects=this.nCachedObjects_;\n\nfor(var i=0,_n20=arguments.length;i!==_n20;++i){\n\nvar _object2=arguments[i],\nuuid=_object2.uuid,\n_index4=indicesByUUID[uuid];\n\nif(_index4!==undefined&&_index4>=nCachedObjects){\n\n// move existing object into the CACHED region\n\nvar lastCachedIndex=nCachedObjects++,\nfirstActiveObject=objects[lastCachedIndex];\n\nindicesByUUID[firstActiveObject.uuid]=_index4;\nobjects[_index4]=firstActiveObject;\n\nindicesByUUID[uuid]=lastCachedIndex;\nobjects[lastCachedIndex]=_object2;\n\n// accounting is done, now do the same for all bindings\n\nfor(var j=0,m=nBindings;j!==m;++j){\n\nvar bindingsForPath=bindings[j],\nfirstActive=bindingsForPath[lastCachedIndex],\nbinding=bindingsForPath[_index4];\n\nbindingsForPath[_index4]=firstActive;\nbindingsForPath[lastCachedIndex]=binding;\n\n}\n\n}\n\n}// for arguments\n\nthis.nCachedObjects_=nCachedObjects;\n\n}\n\n// remove & forget\n},{key:'uncache',value:function uncache(){\n\nvar objects=this._objects,\nindicesByUUID=this._indicesByUUID,\nbindings=this._bindings,\nnBindings=bindings.length;\n\nvar nCachedObjects=this.nCachedObjects_,\nnObjects=objects.length;\n\nfor(var i=0,_n21=arguments.length;i!==_n21;++i){\n\nvar _object3=arguments[i],\nuuid=_object3.uuid,\n_index5=indicesByUUID[uuid];\n\nif(_index5!==undefined){\n\ndelete indicesByUUID[uuid];\n\nif(_index5<nCachedObjects){\n\n// object is cached, shrink the CACHED region\n\nvar firstActiveIndex=--nCachedObjects,\nlastCachedObject=objects[firstActiveIndex],\n_lastIndex=--nObjects,\nlastObject=objects[_lastIndex];\n\n// last cached object takes this object's place\nindicesByUUID[lastCachedObject.uuid]=_index5;\nobjects[_index5]=lastCachedObject;\n\n// last object goes to the activated slot and pop\nindicesByUUID[lastObject.uuid]=firstActiveIndex;\nobjects[firstActiveIndex]=lastObject;\nobjects.pop();\n\n// accounting is done, now do the same for all bindings\n\nfor(var j=0,m=nBindings;j!==m;++j){\n\nvar bindingsForPath=bindings[j],\nlastCached=bindingsForPath[firstActiveIndex],\nlast=bindingsForPath[_lastIndex];\n\nbindingsForPath[_index5]=lastCached;\nbindingsForPath[firstActiveIndex]=last;\nbindingsForPath.pop();\n\n}\n\n}else{\n\n// object is active, just swap with the last and pop\n\nvar _lastIndex2=--nObjects,\n_lastObject=objects[_lastIndex2];\n\nif(_lastIndex2>0){\n\nindicesByUUID[_lastObject.uuid]=_index5;\n\n}\n\nobjects[_index5]=_lastObject;\nobjects.pop();\n\n// accounting is done, now do the same for all bindings\n\nfor(var _j17=0,_m3=nBindings;_j17!==_m3;++_j17){\n\nvar _bindingsForPath=bindings[_j17];\n\n_bindingsForPath[_index5]=_bindingsForPath[_lastIndex2];\n_bindingsForPath.pop();\n\n}\n\n}// cached or active\n\n}// if object is known\n\n}// for arguments\n\nthis.nCachedObjects_=nCachedObjects;\n\n}\n\n// Internal interface used by befriended PropertyBinding.Composite:\n},{key:'subscribe_',value:function subscribe_(\npath,parsedPath){\n\n// returns an array of bindings for the given path that is changed\n// according to the contained objects in the group\n\nvar indicesByPath=this._bindingsIndicesByPath;\nvar index=indicesByPath[path];\nvar bindings=this._bindings;\n\nif(index!==undefined)return bindings[index];\n\nvar paths=this._paths,\nparsedPaths=this._parsedPaths,\nobjects=this._objects,\nnObjects=objects.length,\nnCachedObjects=this.nCachedObjects_,\nbindingsForPath=new Array(nObjects);\n\nindex=bindings.length;\n\nindicesByPath[path]=index;\n\npaths.push(path);\nparsedPaths.push(parsedPath);\nbindings.push(bindingsForPath);\n\nfor(var i=nCachedObjects,_n22=objects.length;i!==_n22;++i){\n\nvar _object4=objects[i];\nbindingsForPath[i]=new PropertyBinding(_object4,path,parsedPath);\n\n}\n\nreturn bindingsForPath;\n\n}},{key:'unsubscribe_',value:function unsubscribe_(\n\npath){\n\n// tells the group to forget about a property path and no longer\n// update the array previously obtained with 'subscribe_'\n\nvar indicesByPath=this._bindingsIndicesByPath,\nindex=indicesByPath[path];\n\nif(index!==undefined){\n\nvar paths=this._paths,\nparsedPaths=this._parsedPaths,\nbindings=this._bindings,\nlastBindingsIndex=bindings.length-1,\nlastBindings=bindings[lastBindingsIndex],\nlastBindingsPath=path[lastBindingsIndex];\n\nindicesByPath[lastBindingsPath]=index;\n\nbindings[index]=lastBindings;\nbindings.pop();\n\nparsedPaths[index]=parsedPaths[lastBindingsIndex];\nparsedPaths.pop();\n\npaths[index]=paths[lastBindingsIndex];\npaths.pop();\n\n}\n\n}}]);return AnimationObjectGroup;}();var\n\n\n\nAnimationAction=function(){\n\nfunction AnimationAction(mixer,clip){var localRoot=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;var blendMode=arguments.length>3&&arguments[3]!==undefined?arguments[3]:clip.blendMode;_classCallCheck(this,AnimationAction);\n\nthis._mixer=mixer;\nthis._clip=clip;\nthis._localRoot=localRoot;\nthis.blendMode=blendMode;\n\nvar tracks=clip.tracks,\nnTracks=tracks.length,\ninterpolants=new Array(nTracks);\n\nvar interpolantSettings={\nendingStart:ZeroCurvatureEnding,\nendingEnd:ZeroCurvatureEnding};\n\n\nfor(var i=0;i!==nTracks;++i){\n\nvar interpolant=tracks[i].createInterpolant(null);\ninterpolants[i]=interpolant;\ninterpolant.settings=interpolantSettings;\n\n}\n\nthis._interpolantSettings=interpolantSettings;\n\nthis._interpolants=interpolants;// bound by the mixer\n\n// inside: PropertyMixer (managed by the mixer)\nthis._propertyBindings=new Array(nTracks);\n\nthis._cacheIndex=null;// for the memory manager\nthis._byClipCacheIndex=null;// for the memory manager\n\nthis._timeScaleInterpolant=null;\nthis._weightInterpolant=null;\n\nthis.loop=LoopRepeat;\nthis._loopCount=-1;\n\n// global mixer time when the action is to be started\n// it's set back to 'null' upon start of the action\nthis._startTime=null;\n\n// scaled local time of the action\n// gets clamped or wrapped to 0..clip.duration according to loop\nthis.time=0;\n\nthis.timeScale=1;\nthis._effectiveTimeScale=1;\n\nthis.weight=1;\nthis._effectiveWeight=1;\n\nthis.repetitions=Infinity;// no. of repetitions when looping\n\nthis.paused=false;// true -> zero effective time scale\nthis.enabled=true;// false -> zero effective weight\n\nthis.clampWhenFinished=false;// keep feeding the last frame?\n\nthis.zeroSlopeAtStart=true;// for smooth interpolation w/o separate\nthis.zeroSlopeAtEnd=true;// clips for start, loop and end\n\n}\n\n// State & Scheduling\n_createClass(AnimationAction,[{key:'play',value:function play()\n{\n\nthis._mixer._activateAction(this);\n\nreturn this;\n\n}},{key:'stop',value:function stop()\n\n{\n\nthis._mixer._deactivateAction(this);\n\nreturn this.reset();\n\n}},{key:'reset',value:function reset()\n\n{\n\nthis.paused=false;\nthis.enabled=true;\n\nthis.time=0;// restart clip\nthis._loopCount=-1;// forget previous loops\nthis._startTime=null;// forget scheduling\n\nreturn this.stopFading().stopWarping();\n\n}},{key:'isRunning',value:function isRunning()\n\n{\n\nreturn this.enabled&&!this.paused&&this.timeScale!==0&&\nthis._startTime===null&&this._mixer._isActiveAction(this);\n\n}\n\n// return true when play has been called\n},{key:'isScheduled',value:function isScheduled(){\n\nreturn this._mixer._isActiveAction(this);\n\n}},{key:'startAt',value:function startAt(\n\ntime){\n\nthis._startTime=time;\n\nreturn this;\n\n}},{key:'setLoop',value:function setLoop(\n\nmode,repetitions){\n\nthis.loop=mode;\nthis.repetitions=repetitions;\n\nreturn this;\n\n}\n\n// Weight\n\n// set the weight stopping any scheduled fading\n// although .enabled = false yields an effective weight of zero, this\n// method does *not* change .enabled, because it would be confusing\n},{key:'setEffectiveWeight',value:function setEffectiveWeight(weight){\n\nthis.weight=weight;\n\n// note: same logic as when updated at runtime\nthis._effectiveWeight=this.enabled?weight:0;\n\nreturn this.stopFading();\n\n}\n\n// return the weight considering fading and .enabled\n},{key:'getEffectiveWeight',value:function getEffectiveWeight(){\n\nreturn this._effectiveWeight;\n\n}},{key:'fadeIn',value:function fadeIn(\n\nduration){\n\nreturn this._scheduleFading(duration,0,1);\n\n}},{key:'fadeOut',value:function fadeOut(\n\nduration){\n\nreturn this._scheduleFading(duration,1,0);\n\n}},{key:'crossFadeFrom',value:function crossFadeFrom(\n\nfadeOutAction,duration,warp){\n\nfadeOutAction.fadeOut(duration);\nthis.fadeIn(duration);\n\nif(warp){\n\nvar fadeInDuration=this._clip.duration,\nfadeOutDuration=fadeOutAction._clip.duration,\n\nstartEndRatio=fadeOutDuration/fadeInDuration,\nendStartRatio=fadeInDuration/fadeOutDuration;\n\nfadeOutAction.warp(1.0,startEndRatio,duration);\nthis.warp(endStartRatio,1.0,duration);\n\n}\n\nreturn this;\n\n}},{key:'crossFadeTo',value:function crossFadeTo(\n\nfadeInAction,duration,warp){\n\nreturn fadeInAction.crossFadeFrom(this,duration,warp);\n\n}},{key:'stopFading',value:function stopFading()\n\n{\n\nvar weightInterpolant=this._weightInterpolant;\n\nif(weightInterpolant!==null){\n\nthis._weightInterpolant=null;\nthis._mixer._takeBackControlInterpolant(weightInterpolant);\n\n}\n\nreturn this;\n\n}\n\n// Time Scale Control\n\n// set the time scale stopping any scheduled warping\n// although .paused = true yields an effective time scale of zero, this\n// method does *not* change .paused, because it would be confusing\n},{key:'setEffectiveTimeScale',value:function setEffectiveTimeScale(timeScale){\n\nthis.timeScale=timeScale;\nthis._effectiveTimeScale=this.paused?0:timeScale;\n\nreturn this.stopWarping();\n\n}\n\n// return the time scale considering warping and .paused\n},{key:'getEffectiveTimeScale',value:function getEffectiveTimeScale(){\n\nreturn this._effectiveTimeScale;\n\n}},{key:'setDuration',value:function setDuration(\n\nduration){\n\nthis.timeScale=this._clip.duration/duration;\n\nreturn this.stopWarping();\n\n}},{key:'syncWith',value:function syncWith(\n\naction){\n\nthis.time=action.time;\nthis.timeScale=action.timeScale;\n\nreturn this.stopWarping();\n\n}},{key:'halt',value:function halt(\n\nduration){\n\nreturn this.warp(this._effectiveTimeScale,0,duration);\n\n}},{key:'warp',value:function warp(\n\nstartTimeScale,endTimeScale,duration){\n\nvar mixer=this._mixer,\nnow=mixer.time,\ntimeScale=this.timeScale;\n\nvar interpolant=this._timeScaleInterpolant;\n\nif(interpolant===null){\n\ninterpolant=mixer._lendControlInterpolant();\nthis._timeScaleInterpolant=interpolant;\n\n}\n\nvar times=interpolant.parameterPositions,\nvalues=interpolant.sampleValues;\n\ntimes[0]=now;\ntimes[1]=now+duration;\n\nvalues[0]=startTimeScale/timeScale;\nvalues[1]=endTimeScale/timeScale;\n\nreturn this;\n\n}},{key:'stopWarping',value:function stopWarping()\n\n{\n\nvar timeScaleInterpolant=this._timeScaleInterpolant;\n\nif(timeScaleInterpolant!==null){\n\nthis._timeScaleInterpolant=null;\nthis._mixer._takeBackControlInterpolant(timeScaleInterpolant);\n\n}\n\nreturn this;\n\n}\n\n// Object Accessors\n},{key:'getMixer',value:function getMixer()\n{\n\nreturn this._mixer;\n\n}},{key:'getClip',value:function getClip()\n\n{\n\nreturn this._clip;\n\n}},{key:'getRoot',value:function getRoot()\n\n{\n\nreturn this._localRoot||this._mixer._root;\n\n}\n\n// Interna\n},{key:'_update',value:function _update(\ntime,deltaTime,timeDirection,accuIndex){\n\n// called by the mixer\n\nif(!this.enabled){\n\n// call ._updateWeight() to update ._effectiveWeight\n\nthis._updateWeight(time);\nreturn;\n\n}\n\nvar startTime=this._startTime;\n\nif(startTime!==null){\n\n// check for scheduled start of action\n\nvar timeRunning=(time-startTime)*timeDirection;\nif(timeRunning<0||timeDirection===0){\n\nreturn;// yet to come / don't decide when delta = 0\n\n}\n\n// start\n\nthis._startTime=null;// unschedule\ndeltaTime=timeDirection*timeRunning;\n\n}\n\n// apply time scale and advance time\n\ndeltaTime*=this._updateTimeScale(time);\nvar clipTime=this._updateTime(deltaTime);\n\n// note: _updateTime may disable the action resulting in\n// an effective weight of 0\n\nvar weight=this._updateWeight(time);\n\nif(weight>0){\n\nvar _interpolants=this._interpolants;\nvar propertyMixers=this._propertyBindings;\n\nswitch(this.blendMode){\n\ncase AdditiveAnimationBlendMode:\n\nfor(var j=0,m=_interpolants.length;j!==m;++j){\n\n_interpolants[j].evaluate(clipTime);\npropertyMixers[j].accumulateAdditive(weight);\n\n}\n\nbreak;\n\ncase NormalAnimationBlendMode:\ndefault:\n\nfor(var _j18=0,_m4=_interpolants.length;_j18!==_m4;++_j18){\n\n_interpolants[_j18].evaluate(clipTime);\npropertyMixers[_j18].accumulate(accuIndex,weight);\n\n}}\n\n\n\n}\n\n}},{key:'_updateWeight',value:function _updateWeight(\n\ntime){\n\nvar weight=0;\n\nif(this.enabled){\n\nweight=this.weight;\nvar interpolant=this._weightInterpolant;\n\nif(interpolant!==null){\n\nvar interpolantValue=interpolant.evaluate(time)[0];\n\nweight*=interpolantValue;\n\nif(time>interpolant.parameterPositions[1]){\n\nthis.stopFading();\n\nif(interpolantValue===0){\n\n// faded out, disable\nthis.enabled=false;\n\n}\n\n}\n\n}\n\n}\n\nthis._effectiveWeight=weight;\nreturn weight;\n\n}},{key:'_updateTimeScale',value:function _updateTimeScale(\n\ntime){\n\nvar timeScale=0;\n\nif(!this.paused){\n\ntimeScale=this.timeScale;\n\nvar interpolant=this._timeScaleInterpolant;\n\nif(interpolant!==null){\n\nvar interpolantValue=interpolant.evaluate(time)[0];\n\ntimeScale*=interpolantValue;\n\nif(time>interpolant.parameterPositions[1]){\n\nthis.stopWarping();\n\nif(timeScale===0){\n\n// motion has halted, pause\nthis.paused=true;\n\n}else{\n\n// warp done - apply final time scale\nthis.timeScale=timeScale;\n\n}\n\n}\n\n}\n\n}\n\nthis._effectiveTimeScale=timeScale;\nreturn timeScale;\n\n}},{key:'_updateTime',value:function _updateTime(\n\ndeltaTime){\n\nvar duration=this._clip.duration;\nvar loop=this.loop;\n\nvar time=this.time+deltaTime;\nvar loopCount=this._loopCount;\n\nvar pingPong=loop===LoopPingPong;\n\nif(deltaTime===0){\n\nif(loopCount===-1)return time;\n\nreturn pingPong&&(loopCount&1)===1?duration-time:time;\n\n}\n\nif(loop===LoopOnce){\n\nif(loopCount===-1){\n\n// just started\n\nthis._loopCount=0;\nthis._setEndings(true,true,false);\n\n}\n\nhandle_stop:{\n\nif(time>=duration){\n\ntime=duration;\n\n}else if(time<0){\n\ntime=0;\n\n}else{\n\nthis.time=time;\n\nbreak handle_stop;\n\n}\n\nif(this.clampWhenFinished)this.paused=true;else\nthis.enabled=false;\n\nthis.time=time;\n\nthis._mixer.dispatchEvent({\ntype:'finished',action:this,\ndirection:deltaTime<0?-1:1});\n\n\n}\n\n}else{// repetitive Repeat or PingPong\n\nif(loopCount===-1){\n\n// just started\n\nif(deltaTime>=0){\n\nloopCount=0;\n\nthis._setEndings(true,this.repetitions===0,pingPong);\n\n}else{\n\n// when looping in reverse direction, the initial\n// transition through zero counts as a repetition,\n// so leave loopCount at -1\n\nthis._setEndings(this.repetitions===0,true,pingPong);\n\n}\n\n}\n\nif(time>=duration||time<0){\n\n// wrap around\n\nvar loopDelta=Math.floor(time/duration);// signed\ntime-=duration*loopDelta;\n\nloopCount+=Math.abs(loopDelta);\n\nvar pending=this.repetitions-loopCount;\n\nif(pending<=0){\n\n// have to stop (switch state, clamp time, fire event)\n\nif(this.clampWhenFinished)this.paused=true;else\nthis.enabled=false;\n\ntime=deltaTime>0?duration:0;\n\nthis.time=time;\n\nthis._mixer.dispatchEvent({\ntype:'finished',action:this,\ndirection:deltaTime>0?1:-1});\n\n\n}else{\n\n// keep running\n\nif(pending===1){\n\n// entering the last round\n\nvar atStart=deltaTime<0;\nthis._setEndings(atStart,!atStart,pingPong);\n\n}else{\n\nthis._setEndings(false,false,pingPong);\n\n}\n\nthis._loopCount=loopCount;\n\nthis.time=time;\n\nthis._mixer.dispatchEvent({\ntype:'loop',action:this,loopDelta:loopDelta});\n\n\n}\n\n}else{\n\nthis.time=time;\n\n}\n\nif(pingPong&&(loopCount&1)===1){\n\n// invert time for the \"pong round\"\n\nreturn duration-time;\n\n}\n\n}\n\nreturn time;\n\n}},{key:'_setEndings',value:function _setEndings(\n\natStart,atEnd,pingPong){\n\nvar settings=this._interpolantSettings;\n\nif(pingPong){\n\nsettings.endingStart=ZeroSlopeEnding;\nsettings.endingEnd=ZeroSlopeEnding;\n\n}else{\n\n// assuming for LoopOnce atStart == atEnd == true\n\nif(atStart){\n\nsettings.endingStart=this.zeroSlopeAtStart?ZeroSlopeEnding:ZeroCurvatureEnding;\n\n}else{\n\nsettings.endingStart=WrapAroundEnding;\n\n}\n\nif(atEnd){\n\nsettings.endingEnd=this.zeroSlopeAtEnd?ZeroSlopeEnding:ZeroCurvatureEnding;\n\n}else{\n\nsettings.endingEnd=WrapAroundEnding;\n\n}\n\n}\n\n}},{key:'_scheduleFading',value:function _scheduleFading(\n\nduration,weightNow,weightThen){\n\nvar mixer=this._mixer,now=mixer.time;\nvar interpolant=this._weightInterpolant;\n\nif(interpolant===null){\n\ninterpolant=mixer._lendControlInterpolant();\nthis._weightInterpolant=interpolant;\n\n}\n\nvar times=interpolant.parameterPositions,\nvalues=interpolant.sampleValues;\n\ntimes[0]=now;\nvalues[0]=weightNow;\ntimes[1]=now+duration;\nvalues[1]=weightThen;\n\nreturn this;\n\n}}]);return AnimationAction;}();\n\n\n\nvar _controlInterpolantsResultBuffer=/*@__PURE__*/new Float32Array(1);var\n\n\nAnimationMixer=function(_EventDispatcher7){_inherits(AnimationMixer,_EventDispatcher7);\n\nfunction AnimationMixer(root){_classCallCheck(this,AnimationMixer);var _this141=_possibleConstructorReturn(this,(AnimationMixer.__proto__||Object.getPrototypeOf(AnimationMixer)).call(this));\n\n\n\n_this141._root=root;\n_this141._initMemoryManager();\n_this141._accuIndex=0;\n_this141.time=0;\n_this141.timeScale=1.0;return _this141;\n\n}_createClass(AnimationMixer,[{key:'_bindAction',value:function _bindAction(\n\naction,prototypeAction){\n\nvar root=action._localRoot||this._root,\ntracks=action._clip.tracks,\nnTracks=tracks.length,\nbindings=action._propertyBindings,\ninterpolants=action._interpolants,\nrootUuid=root.uuid,\nbindingsByRoot=this._bindingsByRootAndName;\n\nvar bindingsByName=bindingsByRoot[rootUuid];\n\nif(bindingsByName===undefined){\n\nbindingsByName={};\nbindingsByRoot[rootUuid]=bindingsByName;\n\n}\n\nfor(var i=0;i!==nTracks;++i){\n\nvar track=tracks[i],\ntrackName=track.name;\n\nvar binding=bindingsByName[trackName];\n\nif(binding!==undefined){\n\n++binding.referenceCount;\nbindings[i]=binding;\n\n}else{\n\nbinding=bindings[i];\n\nif(binding!==undefined){\n\n// existing binding, make sure the cache knows\n\nif(binding._cacheIndex===null){\n\n++binding.referenceCount;\nthis._addInactiveBinding(binding,rootUuid,trackName);\n\n}\n\ncontinue;\n\n}\n\nvar path=prototypeAction&&prototypeAction.\n_propertyBindings[i].binding.parsedPath;\n\nbinding=new PropertyMixer(\nPropertyBinding.create(root,trackName,path),\ntrack.ValueTypeName,track.getValueSize());\n\n++binding.referenceCount;\nthis._addInactiveBinding(binding,rootUuid,trackName);\n\nbindings[i]=binding;\n\n}\n\ninterpolants[i].resultBuffer=binding.buffer;\n\n}\n\n}},{key:'_activateAction',value:function _activateAction(\n\naction){\n\nif(!this._isActiveAction(action)){\n\nif(action._cacheIndex===null){\n\n// this action has been forgotten by the cache, but the user\n// appears to be still using it -> rebind\n\nvar rootUuid=(action._localRoot||this._root).uuid,\nclipUuid=action._clip.uuid,\nactionsForClip=this._actionsByClip[clipUuid];\n\nthis._bindAction(action,\nactionsForClip&&actionsForClip.knownActions[0]);\n\nthis._addInactiveAction(action,clipUuid,rootUuid);\n\n}\n\nvar bindings=action._propertyBindings;\n\n// increment reference counts / sort out state\nfor(var i=0,_n23=bindings.length;i!==_n23;++i){\n\nvar binding=bindings[i];\n\nif(binding.useCount++===0){\n\nthis._lendBinding(binding);\nbinding.saveOriginalState();\n\n}\n\n}\n\nthis._lendAction(action);\n\n}\n\n}},{key:'_deactivateAction',value:function _deactivateAction(\n\naction){\n\nif(this._isActiveAction(action)){\n\nvar bindings=action._propertyBindings;\n\n// decrement reference counts / sort out state\nfor(var i=0,_n24=bindings.length;i!==_n24;++i){\n\nvar binding=bindings[i];\n\nif(--binding.useCount===0){\n\nbinding.restoreOriginalState();\nthis._takeBackBinding(binding);\n\n}\n\n}\n\nthis._takeBackAction(action);\n\n}\n\n}\n\n// Memory manager\n},{key:'_initMemoryManager',value:function _initMemoryManager()\n{\n\nthis._actions=[];// 'nActiveActions' followed by inactive ones\nthis._nActiveActions=0;\n\nthis._actionsByClip={};\n// inside:\n// {\n// \tknownActions: Array< AnimationAction > - used as prototypes\n// \tactionByRoot: AnimationAction - lookup\n// }\n\n\nthis._bindings=[];// 'nActiveBindings' followed by inactive ones\nthis._nActiveBindings=0;\n\nthis._bindingsByRootAndName={};// inside: Map< name, PropertyMixer >\n\n\nthis._controlInterpolants=[];// same game as above\nthis._nActiveControlInterpolants=0;\n\nvar scope=this;\n\nthis.stats={\n\nactions:{\nget total(){\n\nreturn scope._actions.length;\n\n},\nget inUse(){\n\nreturn scope._nActiveActions;\n\n}},\n\nbindings:{\nget total(){\n\nreturn scope._bindings.length;\n\n},\nget inUse(){\n\nreturn scope._nActiveBindings;\n\n}},\n\ncontrolInterpolants:{\nget total(){\n\nreturn scope._controlInterpolants.length;\n\n},\nget inUse(){\n\nreturn scope._nActiveControlInterpolants;\n\n}}};\n\n\n\n\n}\n\n// Memory management for AnimationAction objects\n},{key:'_isActiveAction',value:function _isActiveAction(\naction){\n\nvar index=action._cacheIndex;\nreturn index!==null&&index<this._nActiveActions;\n\n}},{key:'_addInactiveAction',value:function _addInactiveAction(\n\naction,clipUuid,rootUuid){\n\nvar actions=this._actions,\nactionsByClip=this._actionsByClip;\n\nvar actionsForClip=actionsByClip[clipUuid];\n\nif(actionsForClip===undefined){\n\nactionsForClip={\n\nknownActions:[action],\nactionByRoot:{}};\n\n\n\naction._byClipCacheIndex=0;\n\nactionsByClip[clipUuid]=actionsForClip;\n\n}else{\n\nvar knownActions=actionsForClip.knownActions;\n\naction._byClipCacheIndex=knownActions.length;\nknownActions.push(action);\n\n}\n\naction._cacheIndex=actions.length;\nactions.push(action);\n\nactionsForClip.actionByRoot[rootUuid]=action;\n\n}},{key:'_removeInactiveAction',value:function _removeInactiveAction(\n\naction){\n\nvar actions=this._actions,\nlastInactiveAction=actions[actions.length-1],\ncacheIndex=action._cacheIndex;\n\nlastInactiveAction._cacheIndex=cacheIndex;\nactions[cacheIndex]=lastInactiveAction;\nactions.pop();\n\naction._cacheIndex=null;\n\n\nvar clipUuid=action._clip.uuid,\nactionsByClip=this._actionsByClip,\nactionsForClip=actionsByClip[clipUuid],\nknownActionsForClip=actionsForClip.knownActions,\n\nlastKnownAction=\nknownActionsForClip[knownActionsForClip.length-1],\n\nbyClipCacheIndex=action._byClipCacheIndex;\n\nlastKnownAction._byClipCacheIndex=byClipCacheIndex;\nknownActionsForClip[byClipCacheIndex]=lastKnownAction;\nknownActionsForClip.pop();\n\naction._byClipCacheIndex=null;\n\n\nvar actionByRoot=actionsForClip.actionByRoot,\nrootUuid=(action._localRoot||this._root).uuid;\n\ndelete actionByRoot[rootUuid];\n\nif(knownActionsForClip.length===0){\n\ndelete actionsByClip[clipUuid];\n\n}\n\nthis._removeInactiveBindingsForAction(action);\n\n}},{key:'_removeInactiveBindingsForAction',value:function _removeInactiveBindingsForAction(\n\naction){\n\nvar bindings=action._propertyBindings;\n\nfor(var i=0,_n25=bindings.length;i!==_n25;++i){\n\nvar binding=bindings[i];\n\nif(--binding.referenceCount===0){\n\nthis._removeInactiveBinding(binding);\n\n}\n\n}\n\n}},{key:'_lendAction',value:function _lendAction(\n\naction){\n\n// [ active actions |  inactive actions  ]\n// [  active actions >| inactive actions ]\n//                 s        a\n//                  <-swap->\n//                 a        s\n\nvar actions=this._actions,\nprevIndex=action._cacheIndex,\n\nlastActiveIndex=this._nActiveActions++,\n\nfirstInactiveAction=actions[lastActiveIndex];\n\naction._cacheIndex=lastActiveIndex;\nactions[lastActiveIndex]=action;\n\nfirstInactiveAction._cacheIndex=prevIndex;\nactions[prevIndex]=firstInactiveAction;\n\n}},{key:'_takeBackAction',value:function _takeBackAction(\n\naction){\n\n// [  active actions  | inactive actions ]\n// [ active actions |< inactive actions  ]\n//        a        s\n//         <-swap->\n//        s        a\n\nvar actions=this._actions,\nprevIndex=action._cacheIndex,\n\nfirstInactiveIndex=--this._nActiveActions,\n\nlastActiveAction=actions[firstInactiveIndex];\n\naction._cacheIndex=firstInactiveIndex;\nactions[firstInactiveIndex]=action;\n\nlastActiveAction._cacheIndex=prevIndex;\nactions[prevIndex]=lastActiveAction;\n\n}\n\n// Memory management for PropertyMixer objects\n},{key:'_addInactiveBinding',value:function _addInactiveBinding(\nbinding,rootUuid,trackName){\n\nvar bindingsByRoot=this._bindingsByRootAndName,\nbindings=this._bindings;\n\nvar bindingByName=bindingsByRoot[rootUuid];\n\nif(bindingByName===undefined){\n\nbindingByName={};\nbindingsByRoot[rootUuid]=bindingByName;\n\n}\n\nbindingByName[trackName]=binding;\n\nbinding._cacheIndex=bindings.length;\nbindings.push(binding);\n\n}},{key:'_removeInactiveBinding',value:function _removeInactiveBinding(\n\nbinding){\n\nvar bindings=this._bindings,\npropBinding=binding.binding,\nrootUuid=propBinding.rootNode.uuid,\ntrackName=propBinding.path,\nbindingsByRoot=this._bindingsByRootAndName,\nbindingByName=bindingsByRoot[rootUuid],\n\nlastInactiveBinding=bindings[bindings.length-1],\ncacheIndex=binding._cacheIndex;\n\nlastInactiveBinding._cacheIndex=cacheIndex;\nbindings[cacheIndex]=lastInactiveBinding;\nbindings.pop();\n\ndelete bindingByName[trackName];\n\nif(Object.keys(bindingByName).length===0){\n\ndelete bindingsByRoot[rootUuid];\n\n}\n\n}},{key:'_lendBinding',value:function _lendBinding(\n\nbinding){\n\nvar bindings=this._bindings,\nprevIndex=binding._cacheIndex,\n\nlastActiveIndex=this._nActiveBindings++,\n\nfirstInactiveBinding=bindings[lastActiveIndex];\n\nbinding._cacheIndex=lastActiveIndex;\nbindings[lastActiveIndex]=binding;\n\nfirstInactiveBinding._cacheIndex=prevIndex;\nbindings[prevIndex]=firstInactiveBinding;\n\n}},{key:'_takeBackBinding',value:function _takeBackBinding(\n\nbinding){\n\nvar bindings=this._bindings,\nprevIndex=binding._cacheIndex,\n\nfirstInactiveIndex=--this._nActiveBindings,\n\nlastActiveBinding=bindings[firstInactiveIndex];\n\nbinding._cacheIndex=firstInactiveIndex;\nbindings[firstInactiveIndex]=binding;\n\nlastActiveBinding._cacheIndex=prevIndex;\nbindings[prevIndex]=lastActiveBinding;\n\n}\n\n\n// Memory management of Interpolants for weight and time scale\n},{key:'_lendControlInterpolant',value:function _lendControlInterpolant()\n{\n\nvar interpolants=this._controlInterpolants,\nlastActiveIndex=this._nActiveControlInterpolants++;\n\nvar interpolant=interpolants[lastActiveIndex];\n\nif(interpolant===undefined){\n\ninterpolant=new LinearInterpolant(\nnew Float32Array(2),new Float32Array(2),\n1,_controlInterpolantsResultBuffer);\n\ninterpolant.__cacheIndex=lastActiveIndex;\ninterpolants[lastActiveIndex]=interpolant;\n\n}\n\nreturn interpolant;\n\n}},{key:'_takeBackControlInterpolant',value:function _takeBackControlInterpolant(\n\ninterpolant){\n\nvar interpolants=this._controlInterpolants,\nprevIndex=interpolant.__cacheIndex,\n\nfirstInactiveIndex=--this._nActiveControlInterpolants,\n\nlastActiveInterpolant=interpolants[firstInactiveIndex];\n\ninterpolant.__cacheIndex=firstInactiveIndex;\ninterpolants[firstInactiveIndex]=interpolant;\n\nlastActiveInterpolant.__cacheIndex=prevIndex;\ninterpolants[prevIndex]=lastActiveInterpolant;\n\n}\n\n// return an action for a clip optionally using a custom root target\n// object (this method allocates a lot of dynamic memory in case a\n// previously unknown clip/root combination is specified)\n},{key:'clipAction',value:function clipAction(clip,optionalRoot,blendMode){\n\nvar root=optionalRoot||this._root,\nrootUuid=root.uuid;\n\nvar clipObject=typeof clip==='string'?AnimationClip.findByName(root,clip):clip;\n\nvar clipUuid=clipObject!==null?clipObject.uuid:clip;\n\nvar actionsForClip=this._actionsByClip[clipUuid];\nvar prototypeAction=null;\n\nif(blendMode===undefined){\n\nif(clipObject!==null){\n\nblendMode=clipObject.blendMode;\n\n}else{\n\nblendMode=NormalAnimationBlendMode;\n\n}\n\n}\n\nif(actionsForClip!==undefined){\n\nvar existingAction=actionsForClip.actionByRoot[rootUuid];\n\nif(existingAction!==undefined&&existingAction.blendMode===blendMode){\n\nreturn existingAction;\n\n}\n\n// we know the clip, so we don't have to parse all\n// the bindings again but can just copy\nprototypeAction=actionsForClip.knownActions[0];\n\n// also, take the clip from the prototype action\nif(clipObject===null)\nclipObject=prototypeAction._clip;\n\n}\n\n// clip must be known when specified via string\nif(clipObject===null)return null;\n\n// allocate all resources required to run it\nvar newAction=new AnimationAction(this,clipObject,optionalRoot,blendMode);\n\nthis._bindAction(newAction,prototypeAction);\n\n// and make the action known to the memory manager\nthis._addInactiveAction(newAction,clipUuid,rootUuid);\n\nreturn newAction;\n\n}\n\n// get an existing action\n},{key:'existingAction',value:function existingAction(clip,optionalRoot){\n\nvar root=optionalRoot||this._root,\nrootUuid=root.uuid,\n\nclipObject=typeof clip==='string'?\nAnimationClip.findByName(root,clip):clip,\n\nclipUuid=clipObject?clipObject.uuid:clip,\n\nactionsForClip=this._actionsByClip[clipUuid];\n\nif(actionsForClip!==undefined){\n\nreturn actionsForClip.actionByRoot[rootUuid]||null;\n\n}\n\nreturn null;\n\n}\n\n// deactivates all previously scheduled actions\n},{key:'stopAllAction',value:function stopAllAction(){\n\nvar actions=this._actions,\nnActions=this._nActiveActions;\n\nfor(var i=nActions-1;i>=0;--i){\n\nactions[i].stop();\n\n}\n\nreturn this;\n\n}\n\n// advance the time and update apply the animation\n},{key:'update',value:function update(deltaTime){\n\ndeltaTime*=this.timeScale;\n\nvar actions=this._actions,\nnActions=this._nActiveActions,\n\ntime=this.time+=deltaTime,\ntimeDirection=Math.sign(deltaTime),\n\naccuIndex=this._accuIndex^=1;\n\n// run active actions\n\nfor(var i=0;i!==nActions;++i){\n\nvar action=actions[i];\n\naction._update(time,deltaTime,timeDirection,accuIndex);\n\n}\n\n// update scene graph\n\nvar bindings=this._bindings,\nnBindings=this._nActiveBindings;\n\nfor(var _i87=0;_i87!==nBindings;++_i87){\n\nbindings[_i87].apply(accuIndex);\n\n}\n\nreturn this;\n\n}\n\n// Allows you to seek to a specific time in an animation.\n},{key:'setTime',value:function setTime(timeInSeconds){\n\nthis.time=0;// Zero out time attribute for AnimationMixer object;\nfor(var i=0;i<this._actions.length;i++){\n\nthis._actions[i].time=0;// Zero out time attribute for all associated AnimationAction objects.\n\n}\n\nreturn this.update(timeInSeconds);// Update used to set exact time. Returns \"this\" AnimationMixer object.\n\n}\n\n// return this mixer's root target object\n},{key:'getRoot',value:function getRoot(){\n\nreturn this._root;\n\n}\n\n// free all resources specific to a particular clip\n},{key:'uncacheClip',value:function uncacheClip(clip){\n\nvar actions=this._actions,\nclipUuid=clip.uuid,\nactionsByClip=this._actionsByClip,\nactionsForClip=actionsByClip[clipUuid];\n\nif(actionsForClip!==undefined){\n\n// note: just calling _removeInactiveAction would mess up the\n// iteration state and also require updating the state we can\n// just throw away\n\nvar actionsToRemove=actionsForClip.knownActions;\n\nfor(var i=0,_n26=actionsToRemove.length;i!==_n26;++i){\n\nvar action=actionsToRemove[i];\n\nthis._deactivateAction(action);\n\nvar cacheIndex=action._cacheIndex,\nlastInactiveAction=actions[actions.length-1];\n\naction._cacheIndex=null;\naction._byClipCacheIndex=null;\n\nlastInactiveAction._cacheIndex=cacheIndex;\nactions[cacheIndex]=lastInactiveAction;\nactions.pop();\n\nthis._removeInactiveBindingsForAction(action);\n\n}\n\ndelete actionsByClip[clipUuid];\n\n}\n\n}\n\n// free all resources specific to a particular root target object\n},{key:'uncacheRoot',value:function uncacheRoot(root){\n\nvar rootUuid=root.uuid,\nactionsByClip=this._actionsByClip;\n\nfor(var clipUuid in actionsByClip){\n\nvar actionByRoot=actionsByClip[clipUuid].actionByRoot,\naction=actionByRoot[rootUuid];\n\nif(action!==undefined){\n\nthis._deactivateAction(action);\nthis._removeInactiveAction(action);\n\n}\n\n}\n\nvar bindingsByRoot=this._bindingsByRootAndName,\nbindingByName=bindingsByRoot[rootUuid];\n\nif(bindingByName!==undefined){\n\nfor(var trackName in bindingByName){\n\nvar binding=bindingByName[trackName];\nbinding.restoreOriginalState();\nthis._removeInactiveBinding(binding);\n\n}\n\n}\n\n}\n\n// remove a targeted clip from the cache\n},{key:'uncacheAction',value:function uncacheAction(clip,optionalRoot){\n\nvar action=this.existingAction(clip,optionalRoot);\n\nif(action!==null){\n\nthis._deactivateAction(action);\nthis._removeInactiveAction(action);\n\n}\n\n}}]);return AnimationMixer;}(EventDispatcher);var\n\n\n\nUniform=function(){\n\nfunction Uniform(value){_classCallCheck(this,Uniform);\n\nif(typeof value==='string'){\n\nconsole.warn('THREE.Uniform: Type parameter is no longer needed.');\nvalue=arguments[1];\n\n}\n\nthis.value=value;\n\n}_createClass(Uniform,[{key:'clone',value:function clone()\n\n{\n\nreturn new Uniform(this.value.clone===undefined?this.value:this.value.clone());\n\n}}]);return Uniform;}();var\n\n\n\nInstancedInterleavedBuffer=function(_InterleavedBuffer){_inherits(InstancedInterleavedBuffer,_InterleavedBuffer);\n\nfunction InstancedInterleavedBuffer(array,stride){var meshPerAttribute=arguments.length>2&&arguments[2]!==undefined?arguments[2]:1;_classCallCheck(this,InstancedInterleavedBuffer);var _this142=_possibleConstructorReturn(this,(InstancedInterleavedBuffer.__proto__||Object.getPrototypeOf(InstancedInterleavedBuffer)).call(this,\n\narray,stride));\n\n_this142.isInstancedInterleavedBuffer=true;\n\n_this142.meshPerAttribute=meshPerAttribute;return _this142;\n\n}_createClass(InstancedInterleavedBuffer,[{key:'copy',value:function copy(\n\nsource){\n\n_get(InstancedInterleavedBuffer.prototype.__proto__||Object.getPrototypeOf(InstancedInterleavedBuffer.prototype),'copy',this).call(this,source);\n\nthis.meshPerAttribute=source.meshPerAttribute;\n\nreturn this;\n\n}},{key:'clone',value:function clone(\n\ndata){\n\nvar ib=_get(InstancedInterleavedBuffer.prototype.__proto__||Object.getPrototypeOf(InstancedInterleavedBuffer.prototype),'clone',this).call(this,data);\n\nib.meshPerAttribute=this.meshPerAttribute;\n\nreturn ib;\n\n}},{key:'toJSON',value:function toJSON(\n\ndata){\n\nvar json=_get(InstancedInterleavedBuffer.prototype.__proto__||Object.getPrototypeOf(InstancedInterleavedBuffer.prototype),'toJSON',this).call(this,data);\n\njson.isInstancedInterleavedBuffer=true;\njson.meshPerAttribute=this.meshPerAttribute;\n\nreturn json;\n\n}}]);return InstancedInterleavedBuffer;}(InterleavedBuffer);var\n\n\n\nGLBufferAttribute=function(){\n\nfunction GLBufferAttribute(buffer,type,itemSize,elementSize,count){_classCallCheck(this,GLBufferAttribute);\n\nthis.isGLBufferAttribute=true;\n\nthis.buffer=buffer;\nthis.type=type;\nthis.itemSize=itemSize;\nthis.elementSize=elementSize;\nthis.count=count;\n\nthis.version=0;\n\n}_createClass(GLBufferAttribute,[{key:'setBuffer',value:function setBuffer(\n\n\n\n\n\n\n\nbuffer){\n\nthis.buffer=buffer;\n\nreturn this;\n\n}},{key:'setType',value:function setType(\n\ntype,elementSize){\n\nthis.type=type;\nthis.elementSize=elementSize;\n\nreturn this;\n\n}},{key:'setItemSize',value:function setItemSize(\n\nitemSize){\n\nthis.itemSize=itemSize;\n\nreturn this;\n\n}},{key:'setCount',value:function setCount(\n\ncount){\n\nthis.count=count;\n\nreturn this;\n\n}},{key:'needsUpdate',set:function set(value){if(value===true)this.version++;}}]);return GLBufferAttribute;}();var\n\n\n\nRaycaster=function(){\n\nfunction Raycaster(origin,direction){var near=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var far=arguments.length>3&&arguments[3]!==undefined?arguments[3]:Infinity;_classCallCheck(this,Raycaster);\n\nthis.ray=new Ray(origin,direction);\n// direction is assumed to be normalized (for accurate distance calculations)\n\nthis.near=near;\nthis.far=far;\nthis.camera=null;\nthis.layers=new Layers();\n\nthis.params={\nMesh:{},\nLine:{threshold:1},\nLOD:{},\nPoints:{threshold:1},\nSprite:{}};\n\n\n}_createClass(Raycaster,[{key:'set',value:function set(\n\norigin,direction){\n\n// direction is assumed to be normalized (for accurate distance calculations)\n\nthis.ray.set(origin,direction);\n\n}},{key:'setFromCamera',value:function setFromCamera(\n\ncoords,camera){\n\nif(camera.isPerspectiveCamera){\n\nthis.ray.origin.setFromMatrixPosition(camera.matrixWorld);\nthis.ray.direction.set(coords.x,coords.y,0.5).unproject(camera).sub(this.ray.origin).normalize();\nthis.camera=camera;\n\n}else if(camera.isOrthographicCamera){\n\nthis.ray.origin.set(coords.x,coords.y,(camera.near+camera.far)/(camera.near-camera.far)).unproject(camera);// set origin in plane of camera\nthis.ray.direction.set(0,0,-1).transformDirection(camera.matrixWorld);\nthis.camera=camera;\n\n}else{\n\nconsole.error('THREE.Raycaster: Unsupported camera type: '+camera.type);\n\n}\n\n}},{key:'intersectObject',value:function intersectObject(\n\nobject){var recursive=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;var intersects=arguments.length>2&&arguments[2]!==undefined?arguments[2]:[];\n\n_intersectObject(object,this,intersects,recursive);\n\nintersects.sort(ascSort);\n\nreturn intersects;\n\n}},{key:'intersectObjects',value:function intersectObjects(\n\nobjects){var recursive=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;var intersects=arguments.length>2&&arguments[2]!==undefined?arguments[2]:[];\n\nfor(var i=0,l=objects.length;i<l;i++){\n\n_intersectObject(objects[i],this,intersects,recursive);\n\n}\n\nintersects.sort(ascSort);\n\nreturn intersects;\n\n}}]);return Raycaster;}();\n\n\n\nfunction ascSort(a,b){\n\nreturn a.distance-b.distance;\n\n}\n\nfunction _intersectObject(object,raycaster,intersects,recursive){\n\nif(object.layers.test(raycaster.layers)){\n\nobject.raycast(raycaster,intersects);\n\n}\n\nif(recursive===true){\n\nvar children=object.children;\n\nfor(var i=0,l=children.length;i<l;i++){\n\n_intersectObject(children[i],raycaster,intersects,true);\n\n}\n\n}\n\n}\n\n/**\n * Ref: https://en.wikipedia.org/wiki/Spherical_coordinate_system\n *\n * The polar angle (phi) is measured from the positive y-axis. The positive y-axis is up.\n * The azimuthal angle (theta) is measured from the positive z-axis.\n */var\n\nSpherical=function(){\n\nfunction Spherical(){var radius=arguments.length>0&&arguments[0]!==undefined?arguments[0]:1;var phi=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var theta=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;_classCallCheck(this,Spherical);\n\nthis.radius=radius;\nthis.phi=phi;// polar angle\nthis.theta=theta;// azimuthal angle\n\nreturn this;\n\n}_createClass(Spherical,[{key:'set',value:function set(\n\nradius,phi,theta){\n\nthis.radius=radius;\nthis.phi=phi;\nthis.theta=theta;\n\nreturn this;\n\n}},{key:'copy',value:function copy(\n\nother){\n\nthis.radius=other.radius;\nthis.phi=other.phi;\nthis.theta=other.theta;\n\nreturn this;\n\n}\n\n// restrict phi to be between EPS and PI-EPS\n},{key:'makeSafe',value:function makeSafe(){\n\nvar EPS=0.000001;\nthis.phi=Math.max(EPS,Math.min(Math.PI-EPS,this.phi));\n\nreturn this;\n\n}},{key:'setFromVector3',value:function setFromVector3(\n\nv){\n\nreturn this.setFromCartesianCoords(v.x,v.y,v.z);\n\n}},{key:'setFromCartesianCoords',value:function setFromCartesianCoords(\n\nx,y,z){\n\nthis.radius=Math.sqrt(x*x+y*y+z*z);\n\nif(this.radius===0){\n\nthis.theta=0;\nthis.phi=0;\n\n}else{\n\nthis.theta=Math.atan2(x,z);\nthis.phi=Math.acos(clamp(y/this.radius,-1,1));\n\n}\n\nreturn this;\n\n}},{key:'clone',value:function clone()\n\n{\n\nreturn new this.constructor().copy(this);\n\n}}]);return Spherical;}();\n\n\n\n/**\n * Ref: https://en.wikipedia.org/wiki/Cylindrical_coordinate_system\n */var\n\nCylindrical=function(){\n\nfunction Cylindrical(){var radius=arguments.length>0&&arguments[0]!==undefined?arguments[0]:1;var theta=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var y=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;_classCallCheck(this,Cylindrical);\n\nthis.radius=radius;// distance from the origin to a point in the x-z plane\nthis.theta=theta;// counterclockwise angle in the x-z plane measured in radians from the positive z-axis\nthis.y=y;// height above the x-z plane\n\nreturn this;\n\n}_createClass(Cylindrical,[{key:'set',value:function set(\n\nradius,theta,y){\n\nthis.radius=radius;\nthis.theta=theta;\nthis.y=y;\n\nreturn this;\n\n}},{key:'copy',value:function copy(\n\nother){\n\nthis.radius=other.radius;\nthis.theta=other.theta;\nthis.y=other.y;\n\nreturn this;\n\n}},{key:'setFromVector3',value:function setFromVector3(\n\nv){\n\nreturn this.setFromCartesianCoords(v.x,v.y,v.z);\n\n}},{key:'setFromCartesianCoords',value:function setFromCartesianCoords(\n\nx,y,z){\n\nthis.radius=Math.sqrt(x*x+z*z);\nthis.theta=Math.atan2(x,z);\nthis.y=y;\n\nreturn this;\n\n}},{key:'clone',value:function clone()\n\n{\n\nreturn new this.constructor().copy(this);\n\n}}]);return Cylindrical;}();\n\n\n\nvar _vector$4=/*@__PURE__*/new Vector2();var\n\nBox2=function(){\n\nfunction Box2(){var min=arguments.length>0&&arguments[0]!==undefined?arguments[0]:new Vector2(+Infinity,+Infinity);var max=arguments.length>1&&arguments[1]!==undefined?arguments[1]:new Vector2(-Infinity,-Infinity);_classCallCheck(this,Box2);\n\nthis.isBox2=true;\n\nthis.min=min;\nthis.max=max;\n\n}_createClass(Box2,[{key:'set',value:function set(\n\nmin,max){\n\nthis.min.copy(min);\nthis.max.copy(max);\n\nreturn this;\n\n}},{key:'setFromPoints',value:function setFromPoints(\n\npoints){\n\nthis.makeEmpty();\n\nfor(var i=0,il=points.length;i<il;i++){\n\nthis.expandByPoint(points[i]);\n\n}\n\nreturn this;\n\n}},{key:'setFromCenterAndSize',value:function setFromCenterAndSize(\n\ncenter,size){\n\nvar halfSize=_vector$4.copy(size).multiplyScalar(0.5);\nthis.min.copy(center).sub(halfSize);\nthis.max.copy(center).add(halfSize);\n\nreturn this;\n\n}},{key:'clone',value:function clone()\n\n{\n\nreturn new this.constructor().copy(this);\n\n}},{key:'copy',value:function copy(\n\nbox){\n\nthis.min.copy(box.min);\nthis.max.copy(box.max);\n\nreturn this;\n\n}},{key:'makeEmpty',value:function makeEmpty()\n\n{\n\nthis.min.x=this.min.y=+Infinity;\nthis.max.x=this.max.y=-Infinity;\n\nreturn this;\n\n}},{key:'isEmpty',value:function isEmpty()\n\n{\n\n// this is a more robust check for empty than ( volume <= 0 ) because volume can get positive with two negative axes\n\nreturn this.max.x<this.min.x||this.max.y<this.min.y;\n\n}},{key:'getCenter',value:function getCenter(\n\ntarget){\n\nreturn this.isEmpty()?target.set(0,0):target.addVectors(this.min,this.max).multiplyScalar(0.5);\n\n}},{key:'getSize',value:function getSize(\n\ntarget){\n\nreturn this.isEmpty()?target.set(0,0):target.subVectors(this.max,this.min);\n\n}},{key:'expandByPoint',value:function expandByPoint(\n\npoint){\n\nthis.min.min(point);\nthis.max.max(point);\n\nreturn this;\n\n}},{key:'expandByVector',value:function expandByVector(\n\nvector){\n\nthis.min.sub(vector);\nthis.max.add(vector);\n\nreturn this;\n\n}},{key:'expandByScalar',value:function expandByScalar(\n\nscalar){\n\nthis.min.addScalar(-scalar);\nthis.max.addScalar(scalar);\n\nreturn this;\n\n}},{key:'containsPoint',value:function containsPoint(\n\npoint){\n\nreturn point.x<this.min.x||point.x>this.max.x||\npoint.y<this.min.y||point.y>this.max.y?false:true;\n\n}},{key:'containsBox',value:function containsBox(\n\nbox){\n\nreturn this.min.x<=box.min.x&&box.max.x<=this.max.x&&\nthis.min.y<=box.min.y&&box.max.y<=this.max.y;\n\n}},{key:'getParameter',value:function getParameter(\n\npoint,target){\n\n// This can potentially have a divide by zero if the box\n// has a size dimension of 0.\n\nreturn target.set(\n(point.x-this.min.x)/(this.max.x-this.min.x),\n(point.y-this.min.y)/(this.max.y-this.min.y));\n\n\n}},{key:'intersectsBox',value:function intersectsBox(\n\nbox){\n\n// using 4 splitting planes to rule out intersections\n\nreturn box.max.x<this.min.x||box.min.x>this.max.x||\nbox.max.y<this.min.y||box.min.y>this.max.y?false:true;\n\n}},{key:'clampPoint',value:function clampPoint(\n\npoint,target){\n\nreturn target.copy(point).clamp(this.min,this.max);\n\n}},{key:'distanceToPoint',value:function distanceToPoint(\n\npoint){\n\nvar clampedPoint=_vector$4.copy(point).clamp(this.min,this.max);\nreturn clampedPoint.sub(point).length();\n\n}},{key:'intersect',value:function intersect(\n\nbox){\n\nthis.min.max(box.min);\nthis.max.min(box.max);\n\nreturn this;\n\n}},{key:'union',value:function union(\n\nbox){\n\nthis.min.min(box.min);\nthis.max.max(box.max);\n\nreturn this;\n\n}},{key:'translate',value:function translate(\n\noffset){\n\nthis.min.add(offset);\nthis.max.add(offset);\n\nreturn this;\n\n}},{key:'equals',value:function equals(\n\nbox){\n\nreturn box.min.equals(this.min)&&box.max.equals(this.max);\n\n}}]);return Box2;}();\n\n\n\nvar _startP=/*@__PURE__*/new Vector3();\nvar _startEnd=/*@__PURE__*/new Vector3();var\n\nLine3=function(){\n\nfunction Line3(){var start=arguments.length>0&&arguments[0]!==undefined?arguments[0]:new Vector3();var end=arguments.length>1&&arguments[1]!==undefined?arguments[1]:new Vector3();_classCallCheck(this,Line3);\n\nthis.start=start;\nthis.end=end;\n\n}_createClass(Line3,[{key:'set',value:function set(\n\nstart,end){\n\nthis.start.copy(start);\nthis.end.copy(end);\n\nreturn this;\n\n}},{key:'copy',value:function copy(\n\nline){\n\nthis.start.copy(line.start);\nthis.end.copy(line.end);\n\nreturn this;\n\n}},{key:'getCenter',value:function getCenter(\n\ntarget){\n\nreturn target.addVectors(this.start,this.end).multiplyScalar(0.5);\n\n}},{key:'delta',value:function delta(\n\ntarget){\n\nreturn target.subVectors(this.end,this.start);\n\n}},{key:'distanceSq',value:function distanceSq()\n\n{\n\nreturn this.start.distanceToSquared(this.end);\n\n}},{key:'distance',value:function distance()\n\n{\n\nreturn this.start.distanceTo(this.end);\n\n}},{key:'at',value:function at(\n\nt,target){\n\nreturn this.delta(target).multiplyScalar(t).add(this.start);\n\n}},{key:'closestPointToPointParameter',value:function closestPointToPointParameter(\n\npoint,clampToLine){\n\n_startP.subVectors(point,this.start);\n_startEnd.subVectors(this.end,this.start);\n\nvar startEnd2=_startEnd.dot(_startEnd);\nvar startEnd_startP=_startEnd.dot(_startP);\n\nvar t=startEnd_startP/startEnd2;\n\nif(clampToLine){\n\nt=clamp(t,0,1);\n\n}\n\nreturn t;\n\n}},{key:'closestPointToPoint',value:function closestPointToPoint(\n\npoint,clampToLine,target){\n\nvar t=this.closestPointToPointParameter(point,clampToLine);\n\nreturn this.delta(target).multiplyScalar(t).add(this.start);\n\n}},{key:'applyMatrix4',value:function applyMatrix4(\n\nmatrix){\n\nthis.start.applyMatrix4(matrix);\nthis.end.applyMatrix4(matrix);\n\nreturn this;\n\n}},{key:'equals',value:function equals(\n\nline){\n\nreturn line.start.equals(this.start)&&line.end.equals(this.end);\n\n}},{key:'clone',value:function clone()\n\n{\n\nreturn new this.constructor().copy(this);\n\n}}]);return Line3;}();\n\n\n\nvar _vector$3=/*@__PURE__*/new Vector3();var\n\nSpotLightHelper=function(_Object3D14){_inherits(SpotLightHelper,_Object3D14);\n\nfunction SpotLightHelper(light,color){_classCallCheck(this,SpotLightHelper);var _this143=_possibleConstructorReturn(this,(SpotLightHelper.__proto__||Object.getPrototypeOf(SpotLightHelper)).call(this));\n\n\n_this143.light=light;\n_this143.light.updateMatrixWorld();\n\n_this143.matrix=light.matrixWorld;\n_this143.matrixAutoUpdate=false;\n\n_this143.color=color;\n\nvar geometry=new BufferGeometry();\n\nvar positions=[\n0,0,0,0,0,1,\n0,0,0,1,0,1,\n0,0,0,-1,0,1,\n0,0,0,0,1,1,\n0,0,0,0,-1,1];\n\n\nfor(var i=0,j=1,l=32;i<l;i++,j++){\n\nvar p1=i/l*Math.PI*2;\nvar p2=j/l*Math.PI*2;\n\npositions.push(\nMath.cos(p1),Math.sin(p1),1,\nMath.cos(p2),Math.sin(p2),1);\n\n\n}\n\ngeometry.setAttribute('position',new Float32BufferAttribute(positions,3));\n\nvar material=new LineBasicMaterial({fog:false,toneMapped:false});\n\n_this143.cone=new LineSegments(geometry,material);\n_this143.add(_this143.cone);\n\n_this143.update();return _this143;\n\n}_createClass(SpotLightHelper,[{key:'dispose',value:function dispose()\n\n{\n\nthis.cone.geometry.dispose();\nthis.cone.material.dispose();\n\n}},{key:'update',value:function update()\n\n{\n\nthis.light.updateMatrixWorld();\n\nvar coneLength=this.light.distance?this.light.distance:1000;\nvar coneWidth=coneLength*Math.tan(this.light.angle);\n\nthis.cone.scale.set(coneWidth,coneWidth,coneLength);\n\n_vector$3.setFromMatrixPosition(this.light.target.matrixWorld);\n\nthis.cone.lookAt(_vector$3);\n\nif(this.color!==undefined){\n\nthis.cone.material.color.set(this.color);\n\n}else{\n\nthis.cone.material.color.copy(this.light.color);\n\n}\n\n}}]);return SpotLightHelper;}(Object3D);\n\n\n\nvar _vector$2=/*@__PURE__*/new Vector3();\nvar _boneMatrix=/*@__PURE__*/new Matrix4();\nvar _matrixWorldInv=/*@__PURE__*/new Matrix4();var\n\n\nSkeletonHelper=function(_LineSegments){_inherits(SkeletonHelper,_LineSegments);\n\nfunction SkeletonHelper(object){_classCallCheck(this,SkeletonHelper);\n\nvar bones=getBoneList(object);\n\nvar geometry=new BufferGeometry();\n\nvar vertices=[];\nvar colors=[];\n\nvar color1=new Color(0,0,1);\nvar color2=new Color(0,1,0);\n\nfor(var i=0;i<bones.length;i++){\n\nvar bone=bones[i];\n\nif(bone.parent&&bone.parent.isBone){\n\nvertices.push(0,0,0);\nvertices.push(0,0,0);\ncolors.push(color1.r,color1.g,color1.b);\ncolors.push(color2.r,color2.g,color2.b);\n\n}\n\n}\n\ngeometry.setAttribute('position',new Float32BufferAttribute(vertices,3));\ngeometry.setAttribute('color',new Float32BufferAttribute(colors,3));\n\nvar material=new LineBasicMaterial({vertexColors:true,depthTest:false,depthWrite:false,toneMapped:false,transparent:true});var _this144=_possibleConstructorReturn(this,(SkeletonHelper.__proto__||Object.getPrototypeOf(SkeletonHelper)).call(this,\n\ngeometry,material));\n\n_this144.isSkeletonHelper=true;\n\n_this144.type='SkeletonHelper';\n\n_this144.root=object;\n_this144.bones=bones;\n\n_this144.matrix=object.matrixWorld;\n_this144.matrixAutoUpdate=false;return _this144;\n\n}_createClass(SkeletonHelper,[{key:'updateMatrixWorld',value:function updateMatrixWorld(\n\nforce){\n\nvar bones=this.bones;\n\nvar geometry=this.geometry;\nvar position=geometry.getAttribute('position');\n\n_matrixWorldInv.copy(this.root.matrixWorld).invert();\n\nfor(var i=0,j=0;i<bones.length;i++){\n\nvar bone=bones[i];\n\nif(bone.parent&&bone.parent.isBone){\n\n_boneMatrix.multiplyMatrices(_matrixWorldInv,bone.matrixWorld);\n_vector$2.setFromMatrixPosition(_boneMatrix);\nposition.setXYZ(j,_vector$2.x,_vector$2.y,_vector$2.z);\n\n_boneMatrix.multiplyMatrices(_matrixWorldInv,bone.parent.matrixWorld);\n_vector$2.setFromMatrixPosition(_boneMatrix);\nposition.setXYZ(j+1,_vector$2.x,_vector$2.y,_vector$2.z);\n\nj+=2;\n\n}\n\n}\n\ngeometry.getAttribute('position').needsUpdate=true;\n\n_get(SkeletonHelper.prototype.__proto__||Object.getPrototypeOf(SkeletonHelper.prototype),'updateMatrixWorld',this).call(this,force);\n\n}}]);return SkeletonHelper;}(LineSegments);\n\n\n\n\nfunction getBoneList(object){\n\nvar boneList=[];\n\nif(object.isBone===true){\n\nboneList.push(object);\n\n}\n\nfor(var i=0;i<object.children.length;i++){\n\nboneList.push.apply(boneList,getBoneList(object.children[i]));\n\n}\n\nreturn boneList;\n\n}var\n\nPointLightHelper=function(_Mesh3){_inherits(PointLightHelper,_Mesh3);\n\nfunction PointLightHelper(light,sphereSize,color){_classCallCheck(this,PointLightHelper);\n\nvar geometry=new SphereGeometry(sphereSize,4,2);\nvar material=new MeshBasicMaterial({wireframe:true,fog:false,toneMapped:false});var _this145=_possibleConstructorReturn(this,(PointLightHelper.__proto__||Object.getPrototypeOf(PointLightHelper)).call(this,\n\ngeometry,material));\n\n_this145.light=light;\n_this145.light.updateMatrixWorld();\n\n_this145.color=color;\n\n_this145.type='PointLightHelper';\n\n_this145.matrix=_this145.light.matrixWorld;\n_this145.matrixAutoUpdate=false;\n\n_this145.update();\n\n\n/*\n\t// TODO: delete this comment?\n\tconst distanceGeometry = new THREE.IcosahedronGeometry( 1, 2 );\n\tconst distanceMaterial = new THREE.MeshBasicMaterial( { color: hexColor, fog: false, wireframe: true, opacity: 0.1, transparent: true } );\n\n\tthis.lightSphere = new THREE.Mesh( bulbGeometry, bulbMaterial );\n\tthis.lightDistance = new THREE.Mesh( distanceGeometry, distanceMaterial );\n\n\tconst d = light.distance;\n\n\tif ( d === 0.0 ) {\n\n\t\tthis.lightDistance.visible = false;\n\n\t} else {\n\n\t\tthis.lightDistance.scale.set( d, d, d );\n\n\t}\n\n\tthis.add( this.lightDistance );\n\t*/return _this145;\n\n}_createClass(PointLightHelper,[{key:'dispose',value:function dispose()\n\n{\n\nthis.geometry.dispose();\nthis.material.dispose();\n\n}},{key:'update',value:function update()\n\n{\n\nif(this.color!==undefined){\n\nthis.material.color.set(this.color);\n\n}else{\n\nthis.material.color.copy(this.light.color);\n\n}\n\n/*\n\t\tconst d = this.light.distance;\n\n\t\tif ( d === 0.0 ) {\n\n\t\t\tthis.lightDistance.visible = false;\n\n\t\t} else {\n\n\t\t\tthis.lightDistance.visible = true;\n\t\t\tthis.lightDistance.scale.set( d, d, d );\n\n\t\t}\n\t\t*/\n\n}}]);return PointLightHelper;}(Mesh);\n\n\n\nvar _vector$1=/*@__PURE__*/new Vector3();\nvar _color1=/*@__PURE__*/new Color();\nvar _color2=/*@__PURE__*/new Color();var\n\nHemisphereLightHelper=function(_Object3D15){_inherits(HemisphereLightHelper,_Object3D15);\n\nfunction HemisphereLightHelper(light,size,color){_classCallCheck(this,HemisphereLightHelper);var _this146=_possibleConstructorReturn(this,(HemisphereLightHelper.__proto__||Object.getPrototypeOf(HemisphereLightHelper)).call(this));\n\n\n_this146.light=light;\n_this146.light.updateMatrixWorld();\n\n_this146.matrix=light.matrixWorld;\n_this146.matrixAutoUpdate=false;\n\n_this146.color=color;\n\nvar geometry=new OctahedronGeometry(size);\ngeometry.rotateY(Math.PI*0.5);\n\n_this146.material=new MeshBasicMaterial({wireframe:true,fog:false,toneMapped:false});\nif(_this146.color===undefined)_this146.material.vertexColors=true;\n\nvar position=geometry.getAttribute('position');\nvar colors=new Float32Array(position.count*3);\n\ngeometry.setAttribute('color',new BufferAttribute(colors,3));\n\n_this146.add(new Mesh(geometry,_this146.material));\n\n_this146.update();return _this146;\n\n}_createClass(HemisphereLightHelper,[{key:'dispose',value:function dispose()\n\n{\n\nthis.children[0].geometry.dispose();\nthis.children[0].material.dispose();\n\n}},{key:'update',value:function update()\n\n{\n\nvar mesh=this.children[0];\n\nif(this.color!==undefined){\n\nthis.material.color.set(this.color);\n\n}else{\n\nvar _colors=mesh.geometry.getAttribute('color');\n\n_color1.copy(this.light.color);\n_color2.copy(this.light.groundColor);\n\nfor(var i=0,l=_colors.count;i<l;i++){\n\nvar color=i<l/2?_color1:_color2;\n\n_colors.setXYZ(i,color.r,color.g,color.b);\n\n}\n\n_colors.needsUpdate=true;\n\n}\n\nmesh.lookAt(_vector$1.setFromMatrixPosition(this.light.matrixWorld).negate());\n\n}}]);return HemisphereLightHelper;}(Object3D);var\n\n\n\nGridHelper=function(_LineSegments2){_inherits(GridHelper,_LineSegments2);\n\nfunction GridHelper(){var size=arguments.length>0&&arguments[0]!==undefined?arguments[0]:10;var divisions=arguments.length>1&&arguments[1]!==undefined?arguments[1]:10;var color1=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0x444444;var color2=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0x888888;_classCallCheck(this,GridHelper);\n\ncolor1=new Color(color1);\ncolor2=new Color(color2);\n\nvar center=divisions/2;\nvar step=size/divisions;\nvar halfSize=size/2;\n\nvar vertices=[],colors=[];\n\nfor(var i=0,j=0,k=-halfSize;i<=divisions;i++,k+=step){\n\nvertices.push(-halfSize,0,k,halfSize,0,k);\nvertices.push(k,0,-halfSize,k,0,halfSize);\n\nvar color=i===center?color1:color2;\n\ncolor.toArray(colors,j);j+=3;\ncolor.toArray(colors,j);j+=3;\ncolor.toArray(colors,j);j+=3;\ncolor.toArray(colors,j);j+=3;\n\n}\n\nvar geometry=new BufferGeometry();\ngeometry.setAttribute('position',new Float32BufferAttribute(vertices,3));\ngeometry.setAttribute('color',new Float32BufferAttribute(colors,3));\n\nvar material=new LineBasicMaterial({vertexColors:true,toneMapped:false});var _this147=_possibleConstructorReturn(this,(GridHelper.__proto__||Object.getPrototypeOf(GridHelper)).call(this,\n\ngeometry,material));\n\n_this147.type='GridHelper';return _this147;\n\n}return GridHelper;}(LineSegments);var\n\n\n\nPolarGridHelper=function(_LineSegments3){_inherits(PolarGridHelper,_LineSegments3);\n\nfunction PolarGridHelper(){var radius=arguments.length>0&&arguments[0]!==undefined?arguments[0]:10;var radials=arguments.length>1&&arguments[1]!==undefined?arguments[1]:16;var circles=arguments.length>2&&arguments[2]!==undefined?arguments[2]:8;var divisions=arguments.length>3&&arguments[3]!==undefined?arguments[3]:64;var color1=arguments.length>4&&arguments[4]!==undefined?arguments[4]:0x444444;var color2=arguments.length>5&&arguments[5]!==undefined?arguments[5]:0x888888;_classCallCheck(this,PolarGridHelper);\n\ncolor1=new Color(color1);\ncolor2=new Color(color2);\n\nvar vertices=[];\nvar colors=[];\n\n// create the radials\n\nfor(var i=0;i<=radials;i++){\n\nvar v=i/radials*(Math.PI*2);\n\nvar x=Math.sin(v)*radius;\nvar z=Math.cos(v)*radius;\n\nvertices.push(0,0,0);\nvertices.push(x,0,z);\n\nvar color=i&1?color1:color2;\n\ncolors.push(color.r,color.g,color.b);\ncolors.push(color.r,color.g,color.b);\n\n}\n\n// create the circles\n\nfor(var _i88=0;_i88<=circles;_i88++){\n\nvar _color=_i88&1?color1:color2;\n\nvar r=radius-radius/circles*_i88;\n\nfor(var j=0;j<divisions;j++){\n\n// first vertex\n\nvar _v=j/divisions*(Math.PI*2);\n\nvar _x341=Math.sin(_v)*r;\nvar _z3=Math.cos(_v)*r;\n\nvertices.push(_x341,0,_z3);\ncolors.push(_color.r,_color.g,_color.b);\n\n// second vertex\n\n_v=(j+1)/divisions*(Math.PI*2);\n\n_x341=Math.sin(_v)*r;\n_z3=Math.cos(_v)*r;\n\nvertices.push(_x341,0,_z3);\ncolors.push(_color.r,_color.g,_color.b);\n\n}\n\n}\n\nvar geometry=new BufferGeometry();\ngeometry.setAttribute('position',new Float32BufferAttribute(vertices,3));\ngeometry.setAttribute('color',new Float32BufferAttribute(colors,3));\n\nvar material=new LineBasicMaterial({vertexColors:true,toneMapped:false});var _this148=_possibleConstructorReturn(this,(PolarGridHelper.__proto__||Object.getPrototypeOf(PolarGridHelper)).call(this,\n\ngeometry,material));\n\n_this148.type='PolarGridHelper';return _this148;\n\n}return PolarGridHelper;}(LineSegments);\n\n\n\nvar _v1=/*@__PURE__*/new Vector3();\nvar _v2=/*@__PURE__*/new Vector3();\nvar _v3=/*@__PURE__*/new Vector3();var\n\nDirectionalLightHelper=function(_Object3D16){_inherits(DirectionalLightHelper,_Object3D16);\n\nfunction DirectionalLightHelper(light,size,color){_classCallCheck(this,DirectionalLightHelper);var _this149=_possibleConstructorReturn(this,(DirectionalLightHelper.__proto__||Object.getPrototypeOf(DirectionalLightHelper)).call(this));\n\n\n_this149.light=light;\n_this149.light.updateMatrixWorld();\n\n_this149.matrix=light.matrixWorld;\n_this149.matrixAutoUpdate=false;\n\n_this149.color=color;\n\nif(size===undefined)size=1;\n\nvar geometry=new BufferGeometry();\ngeometry.setAttribute('position',new Float32BufferAttribute([\n-size,size,0,\nsize,size,0,\nsize,-size,0,\n-size,-size,0,\n-size,size,0],\n3));\n\nvar material=new LineBasicMaterial({fog:false,toneMapped:false});\n\n_this149.lightPlane=new Line(geometry,material);\n_this149.add(_this149.lightPlane);\n\ngeometry=new BufferGeometry();\ngeometry.setAttribute('position',new Float32BufferAttribute([0,0,0,0,0,1],3));\n\n_this149.targetLine=new Line(geometry,material);\n_this149.add(_this149.targetLine);\n\n_this149.update();return _this149;\n\n}_createClass(DirectionalLightHelper,[{key:'dispose',value:function dispose()\n\n{\n\nthis.lightPlane.geometry.dispose();\nthis.lightPlane.material.dispose();\nthis.targetLine.geometry.dispose();\nthis.targetLine.material.dispose();\n\n}},{key:'update',value:function update()\n\n{\n\n_v1.setFromMatrixPosition(this.light.matrixWorld);\n_v2.setFromMatrixPosition(this.light.target.matrixWorld);\n_v3.subVectors(_v2,_v1);\n\nthis.lightPlane.lookAt(_v2);\n\nif(this.color!==undefined){\n\nthis.lightPlane.material.color.set(this.color);\nthis.targetLine.material.color.set(this.color);\n\n}else{\n\nthis.lightPlane.material.color.copy(this.light.color);\nthis.targetLine.material.color.copy(this.light.color);\n\n}\n\nthis.targetLine.lookAt(_v2);\nthis.targetLine.scale.z=_v3.length();\n\n}}]);return DirectionalLightHelper;}(Object3D);\n\n\n\nvar _vector=/*@__PURE__*/new Vector3();\nvar _camera=/*@__PURE__*/new Camera();\n\n/**\n *\t- shows frustum, line of sight and up of the camera\n *\t- suitable for fast updates\n * \t- based on frustum visualization in lightgl.js shadowmap example\n *\t\thttps://github.com/evanw/lightgl.js/blob/master/tests/shadowmap.html\n */var\n\nCameraHelper=function(_LineSegments4){_inherits(CameraHelper,_LineSegments4);\n\nfunction CameraHelper(camera){_classCallCheck(this,CameraHelper);\n\nvar geometry=new BufferGeometry();\nvar material=new LineBasicMaterial({color:0xffffff,vertexColors:true,toneMapped:false});\n\nvar vertices=[];\nvar colors=[];\n\nvar pointMap={};\n\n// near\n\naddLine('n1','n2');\naddLine('n2','n4');\naddLine('n4','n3');\naddLine('n3','n1');\n\n// far\n\naddLine('f1','f2');\naddLine('f2','f4');\naddLine('f4','f3');\naddLine('f3','f1');\n\n// sides\n\naddLine('n1','f1');\naddLine('n2','f2');\naddLine('n3','f3');\naddLine('n4','f4');\n\n// cone\n\naddLine('p','n1');\naddLine('p','n2');\naddLine('p','n3');\naddLine('p','n4');\n\n// up\n\naddLine('u1','u2');\naddLine('u2','u3');\naddLine('u3','u1');\n\n// target\n\naddLine('c','t');\naddLine('p','c');\n\n// cross\n\naddLine('cn1','cn2');\naddLine('cn3','cn4');\n\naddLine('cf1','cf2');\naddLine('cf3','cf4');\n\nfunction addLine(a,b){\n\naddPoint(a);\naddPoint(b);\n\n}\n\nfunction addPoint(id){\n\nvertices.push(0,0,0);\ncolors.push(0,0,0);\n\nif(pointMap[id]===undefined){\n\npointMap[id]=[];\n\n}\n\npointMap[id].push(vertices.length/3-1);\n\n}\n\ngeometry.setAttribute('position',new Float32BufferAttribute(vertices,3));\ngeometry.setAttribute('color',new Float32BufferAttribute(colors,3));var _this150=_possibleConstructorReturn(this,(CameraHelper.__proto__||Object.getPrototypeOf(CameraHelper)).call(this,\n\ngeometry,material));\n\n_this150.type='CameraHelper';\n\n_this150.camera=camera;\nif(_this150.camera.updateProjectionMatrix)_this150.camera.updateProjectionMatrix();\n\n_this150.matrix=camera.matrixWorld;\n_this150.matrixAutoUpdate=false;\n\n_this150.pointMap=pointMap;\n\n_this150.update();\n\n// colors\n\nvar colorFrustum=new Color(0xffaa00);\nvar colorCone=new Color(0xff0000);\nvar colorUp=new Color(0x00aaff);\nvar colorTarget=new Color(0xffffff);\nvar colorCross=new Color(0x333333);\n\n_this150.setColors(colorFrustum,colorCone,colorUp,colorTarget,colorCross);return _this150;\n\n}_createClass(CameraHelper,[{key:'setColors',value:function setColors(\n\nfrustum,cone,up,target,cross){\n\nvar geometry=this.geometry;\n\nvar colorAttribute=geometry.getAttribute('color');\n\n// near\n\ncolorAttribute.setXYZ(0,frustum.r,frustum.g,frustum.b);colorAttribute.setXYZ(1,frustum.r,frustum.g,frustum.b);// n1, n2\ncolorAttribute.setXYZ(2,frustum.r,frustum.g,frustum.b);colorAttribute.setXYZ(3,frustum.r,frustum.g,frustum.b);// n2, n4\ncolorAttribute.setXYZ(4,frustum.r,frustum.g,frustum.b);colorAttribute.setXYZ(5,frustum.r,frustum.g,frustum.b);// n4, n3\ncolorAttribute.setXYZ(6,frustum.r,frustum.g,frustum.b);colorAttribute.setXYZ(7,frustum.r,frustum.g,frustum.b);// n3, n1\n\n// far\n\ncolorAttribute.setXYZ(8,frustum.r,frustum.g,frustum.b);colorAttribute.setXYZ(9,frustum.r,frustum.g,frustum.b);// f1, f2\ncolorAttribute.setXYZ(10,frustum.r,frustum.g,frustum.b);colorAttribute.setXYZ(11,frustum.r,frustum.g,frustum.b);// f2, f4\ncolorAttribute.setXYZ(12,frustum.r,frustum.g,frustum.b);colorAttribute.setXYZ(13,frustum.r,frustum.g,frustum.b);// f4, f3\ncolorAttribute.setXYZ(14,frustum.r,frustum.g,frustum.b);colorAttribute.setXYZ(15,frustum.r,frustum.g,frustum.b);// f3, f1\n\n// sides\n\ncolorAttribute.setXYZ(16,frustum.r,frustum.g,frustum.b);colorAttribute.setXYZ(17,frustum.r,frustum.g,frustum.b);// n1, f1\ncolorAttribute.setXYZ(18,frustum.r,frustum.g,frustum.b);colorAttribute.setXYZ(19,frustum.r,frustum.g,frustum.b);// n2, f2\ncolorAttribute.setXYZ(20,frustum.r,frustum.g,frustum.b);colorAttribute.setXYZ(21,frustum.r,frustum.g,frustum.b);// n3, f3\ncolorAttribute.setXYZ(22,frustum.r,frustum.g,frustum.b);colorAttribute.setXYZ(23,frustum.r,frustum.g,frustum.b);// n4, f4\n\n// cone\n\ncolorAttribute.setXYZ(24,cone.r,cone.g,cone.b);colorAttribute.setXYZ(25,cone.r,cone.g,cone.b);// p, n1\ncolorAttribute.setXYZ(26,cone.r,cone.g,cone.b);colorAttribute.setXYZ(27,cone.r,cone.g,cone.b);// p, n2\ncolorAttribute.setXYZ(28,cone.r,cone.g,cone.b);colorAttribute.setXYZ(29,cone.r,cone.g,cone.b);// p, n3\ncolorAttribute.setXYZ(30,cone.r,cone.g,cone.b);colorAttribute.setXYZ(31,cone.r,cone.g,cone.b);// p, n4\n\n// up\n\ncolorAttribute.setXYZ(32,up.r,up.g,up.b);colorAttribute.setXYZ(33,up.r,up.g,up.b);// u1, u2\ncolorAttribute.setXYZ(34,up.r,up.g,up.b);colorAttribute.setXYZ(35,up.r,up.g,up.b);// u2, u3\ncolorAttribute.setXYZ(36,up.r,up.g,up.b);colorAttribute.setXYZ(37,up.r,up.g,up.b);// u3, u1\n\n// target\n\ncolorAttribute.setXYZ(38,target.r,target.g,target.b);colorAttribute.setXYZ(39,target.r,target.g,target.b);// c, t\ncolorAttribute.setXYZ(40,cross.r,cross.g,cross.b);colorAttribute.setXYZ(41,cross.r,cross.g,cross.b);// p, c\n\n// cross\n\ncolorAttribute.setXYZ(42,cross.r,cross.g,cross.b);colorAttribute.setXYZ(43,cross.r,cross.g,cross.b);// cn1, cn2\ncolorAttribute.setXYZ(44,cross.r,cross.g,cross.b);colorAttribute.setXYZ(45,cross.r,cross.g,cross.b);// cn3, cn4\n\ncolorAttribute.setXYZ(46,cross.r,cross.g,cross.b);colorAttribute.setXYZ(47,cross.r,cross.g,cross.b);// cf1, cf2\ncolorAttribute.setXYZ(48,cross.r,cross.g,cross.b);colorAttribute.setXYZ(49,cross.r,cross.g,cross.b);// cf3, cf4\n\ncolorAttribute.needsUpdate=true;\n\n}},{key:'update',value:function update()\n\n{\n\nvar geometry=this.geometry;\nvar pointMap=this.pointMap;\n\nvar w=1,h=1;\n\n// we need just camera projection matrix inverse\n// world matrix must be identity\n\n_camera.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse);\n\n// center / target\n\nsetPoint('c',pointMap,geometry,_camera,0,0,-1);\nsetPoint('t',pointMap,geometry,_camera,0,0,1);\n\n// near\n\nsetPoint('n1',pointMap,geometry,_camera,-w,-h,-1);\nsetPoint('n2',pointMap,geometry,_camera,w,-h,-1);\nsetPoint('n3',pointMap,geometry,_camera,-w,h,-1);\nsetPoint('n4',pointMap,geometry,_camera,w,h,-1);\n\n// far\n\nsetPoint('f1',pointMap,geometry,_camera,-w,-h,1);\nsetPoint('f2',pointMap,geometry,_camera,w,-h,1);\nsetPoint('f3',pointMap,geometry,_camera,-w,h,1);\nsetPoint('f4',pointMap,geometry,_camera,w,h,1);\n\n// up\n\nsetPoint('u1',pointMap,geometry,_camera,w*0.7,h*1.1,-1);\nsetPoint('u2',pointMap,geometry,_camera,-w*0.7,h*1.1,-1);\nsetPoint('u3',pointMap,geometry,_camera,0,h*2,-1);\n\n// cross\n\nsetPoint('cf1',pointMap,geometry,_camera,-w,0,1);\nsetPoint('cf2',pointMap,geometry,_camera,w,0,1);\nsetPoint('cf3',pointMap,geometry,_camera,0,-h,1);\nsetPoint('cf4',pointMap,geometry,_camera,0,h,1);\n\nsetPoint('cn1',pointMap,geometry,_camera,-w,0,-1);\nsetPoint('cn2',pointMap,geometry,_camera,w,0,-1);\nsetPoint('cn3',pointMap,geometry,_camera,0,-h,-1);\nsetPoint('cn4',pointMap,geometry,_camera,0,h,-1);\n\ngeometry.getAttribute('position').needsUpdate=true;\n\n}},{key:'dispose',value:function dispose()\n\n{\n\nthis.geometry.dispose();\nthis.material.dispose();\n\n}}]);return CameraHelper;}(LineSegments);\n\n\n\n\nfunction setPoint(point,pointMap,geometry,camera,x,y,z){\n\n_vector.set(x,y,z).unproject(camera);\n\nvar points=pointMap[point];\n\nif(points!==undefined){\n\nvar position=geometry.getAttribute('position');\n\nfor(var i=0,l=points.length;i<l;i++){\n\nposition.setXYZ(points[i],_vector.x,_vector.y,_vector.z);\n\n}\n\n}\n\n}\n\nvar _box=/*@__PURE__*/new Box3();var\n\nBoxHelper=function(_LineSegments5){_inherits(BoxHelper,_LineSegments5);\n\nfunction BoxHelper(object){var color=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0xffff00;_classCallCheck(this,BoxHelper);\n\nvar indices=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]);\nvar positions=new Float32Array(8*3);\n\nvar geometry=new BufferGeometry();\ngeometry.setIndex(new BufferAttribute(indices,1));\ngeometry.setAttribute('position',new BufferAttribute(positions,3));var _this151=_possibleConstructorReturn(this,(BoxHelper.__proto__||Object.getPrototypeOf(BoxHelper)).call(this,\n\ngeometry,new LineBasicMaterial({color:color,toneMapped:false})));\n\n_this151.object=object;\n_this151.type='BoxHelper';\n\n_this151.matrixAutoUpdate=false;\n\n_this151.update();return _this151;\n\n}_createClass(BoxHelper,[{key:'update',value:function update(\n\nobject){\n\nif(object!==undefined){\n\nconsole.warn('THREE.BoxHelper: .update() has no longer arguments.');\n\n}\n\nif(this.object!==undefined){\n\n_box.setFromObject(this.object);\n\n}\n\nif(_box.isEmpty())return;\n\nvar min=_box.min;\nvar max=_box.max;\n\n/*\n\t\t\t5____4\n\t\t1/___0/|\n\t\t| 6__|_7\n\t\t2/___3/\n\n\t\t0: max.x, max.y, max.z\n\t\t1: min.x, max.y, max.z\n\t\t2: min.x, min.y, max.z\n\t\t3: max.x, min.y, max.z\n\t\t4: max.x, max.y, min.z\n\t\t5: min.x, max.y, min.z\n\t\t6: min.x, min.y, min.z\n\t\t7: max.x, min.y, min.z\n\t\t*/\n\nvar position=this.geometry.attributes.position;\nvar array=position.array;\n\narray[0]=max.x;array[1]=max.y;array[2]=max.z;\narray[3]=min.x;array[4]=max.y;array[5]=max.z;\narray[6]=min.x;array[7]=min.y;array[8]=max.z;\narray[9]=max.x;array[10]=min.y;array[11]=max.z;\narray[12]=max.x;array[13]=max.y;array[14]=min.z;\narray[15]=min.x;array[16]=max.y;array[17]=min.z;\narray[18]=min.x;array[19]=min.y;array[20]=min.z;\narray[21]=max.x;array[22]=min.y;array[23]=min.z;\n\nposition.needsUpdate=true;\n\nthis.geometry.computeBoundingSphere();\n\n\n}},{key:'setFromObject',value:function setFromObject(\n\nobject){\n\nthis.object=object;\nthis.update();\n\nreturn this;\n\n}},{key:'copy',value:function copy(\n\nsource,recursive){\n\n_get(BoxHelper.prototype.__proto__||Object.getPrototypeOf(BoxHelper.prototype),'copy',this).call(this,source,recursive);\n\nthis.object=source.object;\n\nreturn this;\n\n}}]);return BoxHelper;}(LineSegments);var\n\n\n\nBox3Helper=function(_LineSegments6){_inherits(Box3Helper,_LineSegments6);\n\nfunction Box3Helper(box){var color=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0xffff00;_classCallCheck(this,Box3Helper);\n\nvar indices=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]);\n\nvar positions=[1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1];\n\nvar geometry=new BufferGeometry();\n\ngeometry.setIndex(new BufferAttribute(indices,1));\n\ngeometry.setAttribute('position',new Float32BufferAttribute(positions,3));var _this152=_possibleConstructorReturn(this,(Box3Helper.__proto__||Object.getPrototypeOf(Box3Helper)).call(this,\n\ngeometry,new LineBasicMaterial({color:color,toneMapped:false})));\n\n_this152.box=box;\n\n_this152.type='Box3Helper';\n\n_this152.geometry.computeBoundingSphere();return _this152;\n\n}_createClass(Box3Helper,[{key:'updateMatrixWorld',value:function updateMatrixWorld(\n\nforce){\n\nvar box=this.box;\n\nif(box.isEmpty())return;\n\nbox.getCenter(this.position);\n\nbox.getSize(this.scale);\n\nthis.scale.multiplyScalar(0.5);\n\n_get(Box3Helper.prototype.__proto__||Object.getPrototypeOf(Box3Helper.prototype),'updateMatrixWorld',this).call(this,force);\n\n}}]);return Box3Helper;}(LineSegments);var\n\n\n\nPlaneHelper=function(_Line3){_inherits(PlaneHelper,_Line3);\n\nfunction PlaneHelper(plane){var size=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1;var hex=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0xffff00;_classCallCheck(this,PlaneHelper);\n\nvar color=hex;\n\nvar positions=[1,-1,1,-1,1,1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,0,0,1,0,0,0];\n\nvar geometry=new BufferGeometry();\ngeometry.setAttribute('position',new Float32BufferAttribute(positions,3));\ngeometry.computeBoundingSphere();var _this153=_possibleConstructorReturn(this,(PlaneHelper.__proto__||Object.getPrototypeOf(PlaneHelper)).call(this,\n\ngeometry,new LineBasicMaterial({color:color,toneMapped:false})));\n\n_this153.type='PlaneHelper';\n\n_this153.plane=plane;\n\n_this153.size=size;\n\nvar positions2=[1,1,1,-1,1,1,-1,-1,1,1,1,1,-1,-1,1,1,-1,1];\n\nvar geometry2=new BufferGeometry();\ngeometry2.setAttribute('position',new Float32BufferAttribute(positions2,3));\ngeometry2.computeBoundingSphere();\n\n_this153.add(new Mesh(geometry2,new MeshBasicMaterial({color:color,opacity:0.2,transparent:true,depthWrite:false,toneMapped:false})));return _this153;\n\n}_createClass(PlaneHelper,[{key:'updateMatrixWorld',value:function updateMatrixWorld(\n\nforce){\n\nvar scale=-this.plane.constant;\n\nif(Math.abs(scale)<1e-8)scale=1e-8;// sign does not matter\n\nthis.scale.set(0.5*this.size,0.5*this.size,scale);\n\nthis.children[0].material.side=scale<0?BackSide:FrontSide;// renderer flips side when determinant < 0; flipping not wanted here\n\nthis.lookAt(this.plane.normal);\n\n_get(PlaneHelper.prototype.__proto__||Object.getPrototypeOf(PlaneHelper.prototype),'updateMatrixWorld',this).call(this,force);\n\n}}]);return PlaneHelper;}(Line);\n\n\n\nvar _axis=/*@__PURE__*/new Vector3();\nvar _lineGeometry=void 0,_coneGeometry=void 0;var\n\nArrowHelper=function(_Object3D17){_inherits(ArrowHelper,_Object3D17);\n\n// dir is assumed to be normalized\n\nfunction ArrowHelper(){var dir=arguments.length>0&&arguments[0]!==undefined?arguments[0]:new Vector3(0,0,1);var origin=arguments.length>1&&arguments[1]!==undefined?arguments[1]:new Vector3(0,0,0);var length=arguments.length>2&&arguments[2]!==undefined?arguments[2]:1;var color=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0xffff00;var headLength=arguments.length>4&&arguments[4]!==undefined?arguments[4]:length*0.2;var headWidth=arguments.length>5&&arguments[5]!==undefined?arguments[5]:headLength*0.2;_classCallCheck(this,ArrowHelper);var _this154=_possibleConstructorReturn(this,(ArrowHelper.__proto__||Object.getPrototypeOf(ArrowHelper)).call(this));\n\n\n\n_this154.type='ArrowHelper';\n\nif(_lineGeometry===undefined){\n\n_lineGeometry=new BufferGeometry();\n_lineGeometry.setAttribute('position',new Float32BufferAttribute([0,0,0,0,1,0],3));\n\n_coneGeometry=new CylinderGeometry(0,0.5,1,5,1);\n_coneGeometry.translate(0,-0.5,0);\n\n}\n\n_this154.position.copy(origin);\n\n_this154.line=new Line(_lineGeometry,new LineBasicMaterial({color:color,toneMapped:false}));\n_this154.line.matrixAutoUpdate=false;\n_this154.add(_this154.line);\n\n_this154.cone=new Mesh(_coneGeometry,new MeshBasicMaterial({color:color,toneMapped:false}));\n_this154.cone.matrixAutoUpdate=false;\n_this154.add(_this154.cone);\n\n_this154.setDirection(dir);\n_this154.setLength(length,headLength,headWidth);return _this154;\n\n}_createClass(ArrowHelper,[{key:'setDirection',value:function setDirection(\n\ndir){\n\n// dir is assumed to be normalized\n\nif(dir.y>0.99999){\n\nthis.quaternion.set(0,0,0,1);\n\n}else if(dir.y<-0.99999){\n\nthis.quaternion.set(1,0,0,0);\n\n}else{\n\n_axis.set(dir.z,0,-dir.x).normalize();\n\nvar radians=Math.acos(dir.y);\n\nthis.quaternion.setFromAxisAngle(_axis,radians);\n\n}\n\n}},{key:'setLength',value:function setLength(\n\nlength){var headLength=arguments.length>1&&arguments[1]!==undefined?arguments[1]:length*0.2;var headWidth=arguments.length>2&&arguments[2]!==undefined?arguments[2]:headLength*0.2;\n\nthis.line.scale.set(1,Math.max(0.0001,length-headLength),1);// see #17458\nthis.line.updateMatrix();\n\nthis.cone.scale.set(headWidth,headLength,headWidth);\nthis.cone.position.y=length;\nthis.cone.updateMatrix();\n\n}},{key:'setColor',value:function setColor(\n\ncolor){\n\nthis.line.material.color.set(color);\nthis.cone.material.color.set(color);\n\n}},{key:'copy',value:function copy(\n\nsource){\n\n_get(ArrowHelper.prototype.__proto__||Object.getPrototypeOf(ArrowHelper.prototype),'copy',this).call(this,source,false);\n\nthis.line.copy(source.line);\nthis.cone.copy(source.cone);\n\nreturn this;\n\n}}]);return ArrowHelper;}(Object3D);var\n\n\n\nAxesHelper=function(_LineSegments7){_inherits(AxesHelper,_LineSegments7);\n\nfunction AxesHelper(){var size=arguments.length>0&&arguments[0]!==undefined?arguments[0]:1;_classCallCheck(this,AxesHelper);\n\nvar vertices=[\n0,0,0,size,0,0,\n0,0,0,0,size,0,\n0,0,0,0,0,size];\n\n\nvar colors=[\n1,0,0,1,0.6,0,\n0,1,0,0.6,1,0,\n0,0,1,0,0.6,1];\n\n\nvar geometry=new BufferGeometry();\ngeometry.setAttribute('position',new Float32BufferAttribute(vertices,3));\ngeometry.setAttribute('color',new Float32BufferAttribute(colors,3));\n\nvar material=new LineBasicMaterial({vertexColors:true,toneMapped:false});var _this155=_possibleConstructorReturn(this,(AxesHelper.__proto__||Object.getPrototypeOf(AxesHelper)).call(this,\n\ngeometry,material));\n\n_this155.type='AxesHelper';return _this155;\n\n}_createClass(AxesHelper,[{key:'setColors',value:function setColors(\n\nxAxisColor,yAxisColor,zAxisColor){\n\nvar color=new Color();\nvar array=this.geometry.attributes.color.array;\n\ncolor.set(xAxisColor);\ncolor.toArray(array,0);\ncolor.toArray(array,3);\n\ncolor.set(yAxisColor);\ncolor.toArray(array,6);\ncolor.toArray(array,9);\n\ncolor.set(zAxisColor);\ncolor.toArray(array,12);\ncolor.toArray(array,15);\n\nthis.geometry.attributes.color.needsUpdate=true;\n\nreturn this;\n\n}},{key:'dispose',value:function dispose()\n\n{\n\nthis.geometry.dispose();\nthis.material.dispose();\n\n}}]);return AxesHelper;}(LineSegments);var\n\n\n\nShapePath=function(){\n\nfunction ShapePath(){_classCallCheck(this,ShapePath);\n\nthis.type='ShapePath';\n\nthis.color=new Color();\n\nthis.subPaths=[];\nthis.currentPath=null;\n\n}_createClass(ShapePath,[{key:'moveTo',value:function moveTo(\n\nx,y){\n\nthis.currentPath=new Path();\nthis.subPaths.push(this.currentPath);\nthis.currentPath.moveTo(x,y);\n\nreturn this;\n\n}},{key:'lineTo',value:function lineTo(\n\nx,y){\n\nthis.currentPath.lineTo(x,y);\n\nreturn this;\n\n}},{key:'quadraticCurveTo',value:function quadraticCurveTo(\n\naCPx,aCPy,aX,aY){\n\nthis.currentPath.quadraticCurveTo(aCPx,aCPy,aX,aY);\n\nreturn this;\n\n}},{key:'bezierCurveTo',value:function bezierCurveTo(\n\naCP1x,aCP1y,aCP2x,aCP2y,aX,aY){\n\nthis.currentPath.bezierCurveTo(aCP1x,aCP1y,aCP2x,aCP2y,aX,aY);\n\nreturn this;\n\n}},{key:'splineThru',value:function splineThru(\n\npts){\n\nthis.currentPath.splineThru(pts);\n\nreturn this;\n\n}},{key:'toShapes',value:function toShapes(\n\nisCCW,noHoles){\n\nfunction toShapesNoHoles(inSubpaths){\n\nvar shapes=[];\n\nfor(var i=0,l=inSubpaths.length;i<l;i++){\n\nvar _tmpPath=inSubpaths[i];\n\nvar _tmpShape=new Shape();\n_tmpShape.curves=_tmpPath.curves;\n\nshapes.push(_tmpShape);\n\n}\n\nreturn shapes;\n\n}\n\nfunction isPointInsidePolygon(inPt,inPolygon){\n\nvar polyLen=inPolygon.length;\n\n// inPt on polygon contour => immediate success    or\n// toggling of inside/outside at every single! intersection point of an edge\n//  with the horizontal line through inPt, left of inPt\n//  not counting lowerY endpoints of edges and whole edges on that line\nvar inside=false;\nfor(var p=polyLen-1,q=0;q<polyLen;p=q++){\n\nvar edgeLowPt=inPolygon[p];\nvar edgeHighPt=inPolygon[q];\n\nvar edgeDx=edgeHighPt.x-edgeLowPt.x;\nvar edgeDy=edgeHighPt.y-edgeLowPt.y;\n\nif(Math.abs(edgeDy)>Number.EPSILON){\n\n// not parallel\nif(edgeDy<0){\n\nedgeLowPt=inPolygon[q];edgeDx=-edgeDx;\nedgeHighPt=inPolygon[p];edgeDy=-edgeDy;\n\n}\n\nif(inPt.y<edgeLowPt.y||inPt.y>edgeHighPt.y)continue;\n\nif(inPt.y===edgeLowPt.y){\n\nif(inPt.x===edgeLowPt.x)return true;// inPt is on contour ?\n// continue;\t\t\t\t// no intersection or edgeLowPt => doesn't count !!!\n\n}else{\n\nvar perpEdge=edgeDy*(inPt.x-edgeLowPt.x)-edgeDx*(inPt.y-edgeLowPt.y);\nif(perpEdge===0)return true;// inPt is on contour ?\nif(perpEdge<0)continue;\ninside=!inside;// true intersection left of inPt\n\n}\n\n}else{\n\n// parallel or collinear\nif(inPt.y!==edgeLowPt.y)continue;// parallel\n// edge lies on the same horizontal line as inPt\nif(edgeHighPt.x<=inPt.x&&inPt.x<=edgeLowPt.x||\nedgeLowPt.x<=inPt.x&&inPt.x<=edgeHighPt.x)return true;// inPt: Point on contour !\n// continue;\n\n}\n\n}\n\nreturn inside;\n\n}\n\nvar isClockWise=ShapeUtils.isClockWise;\n\nvar subPaths=this.subPaths;\nif(subPaths.length===0)return[];\n\nif(noHoles===true)return toShapesNoHoles(subPaths);\n\n\nvar solid=void 0,tmpPath=void 0,tmpShape=void 0;\nvar shapes=[];\n\nif(subPaths.length===1){\n\ntmpPath=subPaths[0];\ntmpShape=new Shape();\ntmpShape.curves=tmpPath.curves;\nshapes.push(tmpShape);\nreturn shapes;\n\n}\n\nvar holesFirst=!isClockWise(subPaths[0].getPoints());\nholesFirst=isCCW?!holesFirst:holesFirst;\n\n// console.log(\"Holes first\", holesFirst);\n\nvar betterShapeHoles=[];\nvar newShapes=[];\nvar newShapeHoles=[];\nvar mainIdx=0;\nvar tmpPoints=void 0;\n\nnewShapes[mainIdx]=undefined;\nnewShapeHoles[mainIdx]=[];\n\nfor(var i=0,l=subPaths.length;i<l;i++){\n\ntmpPath=subPaths[i];\ntmpPoints=tmpPath.getPoints();\nsolid=isClockWise(tmpPoints);\nsolid=isCCW?!solid:solid;\n\nif(solid){\n\nif(!holesFirst&&newShapes[mainIdx])mainIdx++;\n\nnewShapes[mainIdx]={s:new Shape(),p:tmpPoints};\nnewShapes[mainIdx].s.curves=tmpPath.curves;\n\nif(holesFirst)mainIdx++;\nnewShapeHoles[mainIdx]=[];\n\n//console.log('cw', i);\n\n}else{\n\nnewShapeHoles[mainIdx].push({h:tmpPath,p:tmpPoints[0]});\n\n//console.log('ccw', i);\n\n}\n\n}\n\n// only Holes? -> probably all Shapes with wrong orientation\nif(!newShapes[0])return toShapesNoHoles(subPaths);\n\n\nif(newShapes.length>1){\n\nvar ambiguous=false;\nvar toChange=0;\n\nfor(var sIdx=0,sLen=newShapes.length;sIdx<sLen;sIdx++){\n\nbetterShapeHoles[sIdx]=[];\n\n}\n\nfor(var _sIdx=0,_sLen=newShapes.length;_sIdx<_sLen;_sIdx++){\n\nvar sho=newShapeHoles[_sIdx];\n\nfor(var hIdx=0;hIdx<sho.length;hIdx++){\n\nvar ho=sho[hIdx];\nvar hole_unassigned=true;\n\nfor(var s2Idx=0;s2Idx<newShapes.length;s2Idx++){\n\nif(isPointInsidePolygon(ho.p,newShapes[s2Idx].p)){\n\nif(_sIdx!==s2Idx)toChange++;\n\nif(hole_unassigned){\n\nhole_unassigned=false;\nbetterShapeHoles[s2Idx].push(ho);\n\n}else{\n\nambiguous=true;\n\n}\n\n}\n\n}\n\nif(hole_unassigned){\n\nbetterShapeHoles[_sIdx].push(ho);\n\n}\n\n}\n\n}\n\nif(toChange>0&&ambiguous===false){\n\nnewShapeHoles=betterShapeHoles;\n\n}\n\n}\n\nvar tmpHoles=void 0;\n\nfor(var _i89=0,il=newShapes.length;_i89<il;_i89++){\n\ntmpShape=newShapes[_i89].s;\nshapes.push(tmpShape);\ntmpHoles=newShapeHoles[_i89];\n\nfor(var j=0,jl=tmpHoles.length;j<jl;j++){\n\ntmpShape.holes.push(tmpHoles[j].h);\n\n}\n\n}\n\n//console.log(\"shape\", shapes);\n\nreturn shapes;\n\n}}]);return ShapePath;}();\n\n\n\n// Fast Half Float Conversions, http://www.fox-toolkit.org/ftp/fasthalffloatconversion.pdf\nvar _generateTables2=\n\n\n\n\n\n\n\n\n/*@__PURE__*/_generateTables(),_floatView=_generateTables2.floatView,_uint32View=_generateTables2.uint32View,_baseTable=_generateTables2.baseTable,_shiftTable=_generateTables2.shiftTable,_mantissaTable=_generateTables2.mantissaTable,_exponentTable=_generateTables2.exponentTable,_offsetTable=_generateTables2.offsetTable;\n\nfunction _generateTables(){\n\n// float32 to float16 helpers\n\nvar buffer=new ArrayBuffer(4);\nvar floatView=new Float32Array(buffer);\nvar uint32View=new Uint32Array(buffer);\n\nvar baseTable=new Uint32Array(512);\nvar shiftTable=new Uint32Array(512);\n\nfor(var i=0;i<256;++i){\n\nvar e=i-127;\n\n// very small number (0, -0)\n\nif(e<-27){\n\nbaseTable[i]=0x0000;\nbaseTable[i|0x100]=0x8000;\nshiftTable[i]=24;\nshiftTable[i|0x100]=24;\n\n// small number (denorm)\n\n}else if(e<-14){\n\nbaseTable[i]=0x0400>>-e-14;\nbaseTable[i|0x100]=0x0400>>-e-14|0x8000;\nshiftTable[i]=-e-1;\nshiftTable[i|0x100]=-e-1;\n\n// normal number\n\n}else if(e<=15){\n\nbaseTable[i]=e+15<<10;\nbaseTable[i|0x100]=e+15<<10|0x8000;\nshiftTable[i]=13;\nshiftTable[i|0x100]=13;\n\n// large number (Infinity, -Infinity)\n\n}else if(e<128){\n\nbaseTable[i]=0x7c00;\nbaseTable[i|0x100]=0xfc00;\nshiftTable[i]=24;\nshiftTable[i|0x100]=24;\n\n// stay (NaN, Infinity, -Infinity)\n\n}else{\n\nbaseTable[i]=0x7c00;\nbaseTable[i|0x100]=0xfc00;\nshiftTable[i]=13;\nshiftTable[i|0x100]=13;\n\n}\n\n}\n\n// float16 to float32 helpers\n\nvar mantissaTable=new Uint32Array(2048);\nvar exponentTable=new Uint32Array(64);\nvar offsetTable=new Uint32Array(64);\n\nfor(var _i90=1;_i90<1024;++_i90){\n\nvar m=_i90<<13;// zero pad mantissa bits\nvar _e2=0;// zero exponent\n\n// normalized\nwhile((m&0x00800000)===0){\n\nm<<=1;\n_e2-=0x00800000;// decrement exponent\n\n}\n\nm&=~0x00800000;// clear leading 1 bit\n_e2+=0x38800000;// adjust bias\n\nmantissaTable[_i90]=m|_e2;\n\n}\n\nfor(var _i91=1024;_i91<2048;++_i91){\n\nmantissaTable[_i91]=0x38000000+(_i91-1024<<13);\n\n}\n\nfor(var _i92=1;_i92<31;++_i92){\n\nexponentTable[_i92]=_i92<<23;\n\n}\n\nexponentTable[31]=0x47800000;\nexponentTable[32]=0x80000000;\n\nfor(var _i93=33;_i93<63;++_i93){\n\nexponentTable[_i93]=0x80000000+(_i93-32<<23);\n\n}\n\nexponentTable[63]=0xc7800000;\n\nfor(var _i94=1;_i94<64;++_i94){\n\nif(_i94!==32){\n\noffsetTable[_i94]=1024;\n\n}\n\n}\n\nreturn{\nfloatView:floatView,\nuint32View:uint32View,\nbaseTable:baseTable,\nshiftTable:shiftTable,\nmantissaTable:mantissaTable,\nexponentTable:exponentTable,\noffsetTable:offsetTable};\n\n\n}\n\n// float32 to float16\n\nfunction toHalfFloat(val){\n\nif(Math.abs(val)>65504)console.warn('THREE.DataUtils.toHalfFloat(): Value out of range.');\n\nval=clamp(val,-65504,65504);\n\n_floatView[0]=val;\nvar f=_uint32View[0];\nvar e=f>>23&0x1ff;\nreturn _baseTable[e]+((f&0x007fffff)>>_shiftTable[e]);\n\n}\n\n// float16 to float32\n\nfunction fromHalfFloat(val){\n\nvar m=val>>10;\n_uint32View[0]=_mantissaTable[_offsetTable[m]+(val&0x3ff)]+_exponentTable[m];\nreturn _floatView[0];\n\n}\n\nvar DataUtils=/*#__PURE__*/Object.freeze({\n__proto__:null,\ntoHalfFloat:toHalfFloat,\nfromHalfFloat:fromHalfFloat});\n\n\n// r133, c5bb5434555a3c3ddd784944a0a124f996fc721b\nvar\nParametricGeometry=function(_BufferGeometry17){_inherits(ParametricGeometry,_BufferGeometry17);\n\nfunction ParametricGeometry(){_classCallCheck(this,ParametricGeometry);\n\nconsole.error('THREE.ParametricGeometry has been moved to /examples/jsm/geometries/ParametricGeometry.js');return _possibleConstructorReturn(this,(ParametricGeometry.__proto__||Object.getPrototypeOf(ParametricGeometry)).call(this));\n\n\n}return ParametricGeometry;}(BufferGeometry);\n\n\n\n// r133, eb58ff153119090d3bbb24474ea0ffc40c70dc92\nvar\nTextGeometry=function(_BufferGeometry18){_inherits(TextGeometry,_BufferGeometry18);\n\nfunction TextGeometry(){_classCallCheck(this,TextGeometry);\n\nconsole.error('THREE.TextGeometry has been moved to /examples/jsm/geometries/TextGeometry.js');return _possibleConstructorReturn(this,(TextGeometry.__proto__||Object.getPrototypeOf(TextGeometry)).call(this));\n\n\n}return TextGeometry;}(BufferGeometry);\n\n\n\n// r133, eb58ff153119090d3bbb24474ea0ffc40c70dc92\n\nfunction FontLoader(){\n\nconsole.error('THREE.FontLoader has been moved to /examples/jsm/loaders/FontLoader.js');\n\n}\n\n// r133, eb58ff153119090d3bbb24474ea0ffc40c70dc92\n\nfunction Font(){\n\nconsole.error('THREE.Font has been moved to /examples/jsm/loaders/FontLoader.js');\n\n}\n\n// r134, d65e0af06644fe5a84a6fc0e372f4318f95a04c0\n\nfunction ImmediateRenderObject(){\n\nconsole.error('THREE.ImmediateRenderObject has been removed.');\n\n}\n\n// r138, 48b05d3500acc084df50be9b4c90781ad9b8cb17\nvar\nWebGLMultisampleRenderTarget=function(_WebGLRenderTarget5){_inherits(WebGLMultisampleRenderTarget,_WebGLRenderTarget5);\n\nfunction WebGLMultisampleRenderTarget(width,height,options){_classCallCheck(this,WebGLMultisampleRenderTarget);\n\nconsole.error('THREE.WebGLMultisampleRenderTarget has been removed. Use a normal render target and set the \"samples\" property to greater 0 to enable multisampling.');var _this158=_possibleConstructorReturn(this,(WebGLMultisampleRenderTarget.__proto__||Object.getPrototypeOf(WebGLMultisampleRenderTarget)).call(this,\nwidth,height,options));\n_this158.samples=4;return _this158;\n\n}return WebGLMultisampleRenderTarget;}(WebGLRenderTarget);\n\n\n\n// r138, f9cd9cab03b7b64244e304900a3a2eeaa3a588ce\nvar\nDataTexture2DArray=function(_DataArrayTexture){_inherits(DataTexture2DArray,_DataArrayTexture);\n\nfunction DataTexture2DArray(data,width,height,depth){_classCallCheck(this,DataTexture2DArray);\n\nconsole.warn('THREE.DataTexture2DArray has been renamed to DataArrayTexture.');return _possibleConstructorReturn(this,(DataTexture2DArray.__proto__||Object.getPrototypeOf(DataTexture2DArray)).call(this,\ndata,width,height,depth));\n\n}return DataTexture2DArray;}(DataArrayTexture);\n\n\n\n// r138, f9cd9cab03b7b64244e304900a3a2eeaa3a588ce\nvar\nDataTexture3D=function(_Data3DTexture){_inherits(DataTexture3D,_Data3DTexture);\n\nfunction DataTexture3D(data,width,height,depth){_classCallCheck(this,DataTexture3D);\n\nconsole.warn('THREE.DataTexture3D has been renamed to Data3DTexture.');return _possibleConstructorReturn(this,(DataTexture3D.__proto__||Object.getPrototypeOf(DataTexture3D)).call(this,\ndata,width,height,depth));\n\n}return DataTexture3D;}(Data3DTexture);\n\n\n\nif(typeof __THREE_DEVTOOLS__!=='undefined'){\n\n__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent('register',{detail:{\nrevision:REVISION}}));\n\n\n}\n\nif(typeof window!=='undefined'){\n\nif(window.__THREE__){\n\nconsole.warn('WARNING: Multiple instances of Three.js being imported.');\n\n}else{\n\nwindow.__THREE__=REVISION;\n\n}\n\n}exports.\n\nACESFilmicToneMapping=ACESFilmicToneMapping;exports.AddEquation=AddEquation;exports.AddOperation=AddOperation;exports.AdditiveAnimationBlendMode=AdditiveAnimationBlendMode;exports.AdditiveBlending=AdditiveBlending;exports.AlphaFormat=AlphaFormat;exports.AlwaysDepth=AlwaysDepth;exports.AlwaysStencilFunc=AlwaysStencilFunc;exports.AmbientLight=AmbientLight;exports.AmbientLightProbe=AmbientLightProbe;exports.AnimationClip=AnimationClip;exports.AnimationLoader=AnimationLoader;exports.AnimationMixer=AnimationMixer;exports.AnimationObjectGroup=AnimationObjectGroup;exports.AnimationUtils=AnimationUtils;exports.ArcCurve=ArcCurve;exports.ArrayCamera=ArrayCamera;exports.ArrowHelper=ArrowHelper;exports.Audio=Audio;exports.AudioAnalyser=AudioAnalyser;exports.AudioContext=AudioContext;exports.AudioListener=AudioListener;exports.AudioLoader=AudioLoader;exports.AxesHelper=AxesHelper;exports.BackSide=BackSide;exports.BasicDepthPacking=BasicDepthPacking;exports.BasicShadowMap=BasicShadowMap;exports.Bone=Bone;exports.BooleanKeyframeTrack=BooleanKeyframeTrack;exports.Box2=Box2;exports.Box3=Box3;exports.Box3Helper=Box3Helper;exports.BoxBufferGeometry=BoxGeometry;exports.BoxGeometry=BoxGeometry;exports.BoxHelper=BoxHelper;exports.BufferAttribute=BufferAttribute;exports.BufferGeometry=BufferGeometry;exports.BufferGeometryLoader=BufferGeometryLoader;exports.ByteType=ByteType;exports.Cache=Cache;exports.Camera=Camera;exports.CameraHelper=CameraHelper;exports.CanvasTexture=CanvasTexture;exports.CapsuleBufferGeometry=CapsuleGeometry;exports.CapsuleGeometry=CapsuleGeometry;exports.CatmullRomCurve3=CatmullRomCurve3;exports.CineonToneMapping=CineonToneMapping;exports.CircleBufferGeometry=CircleGeometry;exports.CircleGeometry=CircleGeometry;exports.ClampToEdgeWrapping=ClampToEdgeWrapping;exports.Clock=Clock;exports.Color=Color;exports.ColorKeyframeTrack=ColorKeyframeTrack;exports.ColorManagement=ColorManagement;exports.CompressedTexture=CompressedTexture;exports.CompressedTextureLoader=CompressedTextureLoader;exports.ConeBufferGeometry=ConeGeometry;exports.ConeGeometry=ConeGeometry;exports.CubeCamera=CubeCamera;exports.CubeReflectionMapping=CubeReflectionMapping;exports.CubeRefractionMapping=CubeRefractionMapping;exports.CubeTexture=CubeTexture;exports.CubeTextureLoader=CubeTextureLoader;exports.CubeUVReflectionMapping=CubeUVReflectionMapping;exports.CubicBezierCurve=CubicBezierCurve;exports.CubicBezierCurve3=CubicBezierCurve3;exports.CubicInterpolant=CubicInterpolant;exports.CullFaceBack=CullFaceBack;exports.CullFaceFront=CullFaceFront;exports.CullFaceFrontBack=CullFaceFrontBack;exports.CullFaceNone=CullFaceNone;exports.Curve=Curve;exports.CurvePath=CurvePath;exports.CustomBlending=CustomBlending;exports.CustomToneMapping=CustomToneMapping;exports.CylinderBufferGeometry=CylinderGeometry;exports.CylinderGeometry=CylinderGeometry;exports.Cylindrical=Cylindrical;exports.Data3DTexture=Data3DTexture;exports.DataArrayTexture=DataArrayTexture;exports.DataTexture=DataTexture;exports.DataTexture2DArray=DataTexture2DArray;exports.DataTexture3D=DataTexture3D;exports.DataTextureLoader=DataTextureLoader;exports.DataUtils=DataUtils;exports.DecrementStencilOp=DecrementStencilOp;exports.DecrementWrapStencilOp=DecrementWrapStencilOp;exports.DefaultLoadingManager=DefaultLoadingManager;exports.DepthFormat=DepthFormat;exports.DepthStencilFormat=DepthStencilFormat;exports.DepthTexture=DepthTexture;exports.DirectionalLight=DirectionalLight;exports.DirectionalLightHelper=DirectionalLightHelper;exports.DiscreteInterpolant=DiscreteInterpolant;exports.DodecahedronBufferGeometry=DodecahedronGeometry;exports.DodecahedronGeometry=DodecahedronGeometry;exports.DoubleSide=DoubleSide;exports.DstAlphaFactor=DstAlphaFactor;exports.DstColorFactor=DstColorFactor;exports.DynamicCopyUsage=DynamicCopyUsage;exports.DynamicDrawUsage=DynamicDrawUsage;exports.DynamicReadUsage=DynamicReadUsage;exports.EdgesGeometry=EdgesGeometry;exports.EllipseCurve=EllipseCurve;exports.EqualDepth=EqualDepth;exports.EqualStencilFunc=EqualStencilFunc;exports.EquirectangularReflectionMapping=EquirectangularReflectionMapping;exports.EquirectangularRefractionMapping=EquirectangularRefractionMapping;exports.Euler=Euler;exports.EventDispatcher=EventDispatcher;exports.ExtrudeBufferGeometry=ExtrudeGeometry;exports.ExtrudeGeometry=ExtrudeGeometry;exports.FileLoader=FileLoader;exports.FlatShading=FlatShading;exports.Float16BufferAttribute=Float16BufferAttribute;exports.Float32BufferAttribute=Float32BufferAttribute;exports.Float64BufferAttribute=Float64BufferAttribute;exports.FloatType=FloatType;exports.Fog=Fog;exports.FogExp2=FogExp2;exports.Font=Font;exports.FontLoader=FontLoader;exports.FramebufferTexture=FramebufferTexture;exports.FrontSide=FrontSide;exports.Frustum=Frustum;exports.GLBufferAttribute=GLBufferAttribute;exports.GLSL1=GLSL1;exports.GLSL3=GLSL3;exports.GreaterDepth=GreaterDepth;exports.GreaterEqualDepth=GreaterEqualDepth;exports.GreaterEqualStencilFunc=GreaterEqualStencilFunc;exports.GreaterStencilFunc=GreaterStencilFunc;exports.GridHelper=GridHelper;exports.Group=Group;exports.HalfFloatType=HalfFloatType;exports.HemisphereLight=HemisphereLight;exports.HemisphereLightHelper=HemisphereLightHelper;exports.HemisphereLightProbe=HemisphereLightProbe;exports.IcosahedronBufferGeometry=IcosahedronGeometry;exports.IcosahedronGeometry=IcosahedronGeometry;exports.ImageBitmapLoader=ImageBitmapLoader;exports.ImageLoader=ImageLoader;exports.ImageUtils=ImageUtils;exports.ImmediateRenderObject=ImmediateRenderObject;exports.IncrementStencilOp=IncrementStencilOp;exports.IncrementWrapStencilOp=IncrementWrapStencilOp;exports.InstancedBufferAttribute=InstancedBufferAttribute;exports.InstancedBufferGeometry=InstancedBufferGeometry;exports.InstancedInterleavedBuffer=InstancedInterleavedBuffer;exports.InstancedMesh=InstancedMesh;exports.Int16BufferAttribute=Int16BufferAttribute;exports.Int32BufferAttribute=Int32BufferAttribute;exports.Int8BufferAttribute=Int8BufferAttribute;exports.IntType=IntType;exports.InterleavedBuffer=InterleavedBuffer;exports.InterleavedBufferAttribute=InterleavedBufferAttribute;exports.Interpolant=Interpolant;exports.InterpolateDiscrete=InterpolateDiscrete;exports.InterpolateLinear=InterpolateLinear;exports.InterpolateSmooth=InterpolateSmooth;exports.InvertStencilOp=InvertStencilOp;exports.KeepStencilOp=KeepStencilOp;exports.KeyframeTrack=KeyframeTrack;exports.LOD=LOD;exports.LatheBufferGeometry=LatheGeometry;exports.LatheGeometry=LatheGeometry;exports.Layers=Layers;exports.LessDepth=LessDepth;exports.LessEqualDepth=LessEqualDepth;exports.LessEqualStencilFunc=LessEqualStencilFunc;exports.LessStencilFunc=LessStencilFunc;exports.Light=Light;exports.LightProbe=LightProbe;exports.Line=Line;exports.Line3=Line3;exports.LineBasicMaterial=LineBasicMaterial;exports.LineCurve=LineCurve;exports.LineCurve3=LineCurve3;exports.LineDashedMaterial=LineDashedMaterial;exports.LineLoop=LineLoop;exports.LineSegments=LineSegments;exports.LinearEncoding=LinearEncoding;exports.LinearFilter=LinearFilter;exports.LinearInterpolant=LinearInterpolant;exports.LinearMipMapLinearFilter=LinearMipMapLinearFilter;exports.LinearMipMapNearestFilter=LinearMipMapNearestFilter;exports.LinearMipmapLinearFilter=LinearMipmapLinearFilter;exports.LinearMipmapNearestFilter=LinearMipmapNearestFilter;exports.LinearSRGBColorSpace=LinearSRGBColorSpace;exports.LinearToneMapping=LinearToneMapping;exports.Loader=Loader;exports.LoaderUtils=LoaderUtils;exports.LoadingManager=LoadingManager;exports.LoopOnce=LoopOnce;exports.LoopPingPong=LoopPingPong;exports.LoopRepeat=LoopRepeat;exports.LuminanceAlphaFormat=LuminanceAlphaFormat;exports.LuminanceFormat=LuminanceFormat;exports.MOUSE=MOUSE;exports.Material=Material;exports.MaterialLoader=MaterialLoader;exports.MathUtils=MathUtils;exports.Matrix3=Matrix3;exports.Matrix4=Matrix4;exports.MaxEquation=MaxEquation;exports.Mesh=Mesh;exports.MeshBasicMaterial=MeshBasicMaterial;exports.MeshDepthMaterial=MeshDepthMaterial;exports.MeshDistanceMaterial=MeshDistanceMaterial;exports.MeshLambertMaterial=MeshLambertMaterial;exports.MeshMatcapMaterial=MeshMatcapMaterial;exports.MeshNormalMaterial=MeshNormalMaterial;exports.MeshPhongMaterial=MeshPhongMaterial;exports.MeshPhysicalMaterial=MeshPhysicalMaterial;exports.MeshStandardMaterial=MeshStandardMaterial;exports.MeshToonMaterial=MeshToonMaterial;exports.MinEquation=MinEquation;exports.MirroredRepeatWrapping=MirroredRepeatWrapping;exports.MixOperation=MixOperation;exports.MultiplyBlending=MultiplyBlending;exports.MultiplyOperation=MultiplyOperation;exports.NearestFilter=NearestFilter;exports.NearestMipMapLinearFilter=NearestMipMapLinearFilter;exports.NearestMipMapNearestFilter=NearestMipMapNearestFilter;exports.NearestMipmapLinearFilter=NearestMipmapLinearFilter;exports.NearestMipmapNearestFilter=NearestMipmapNearestFilter;exports.NeverDepth=NeverDepth;exports.NeverStencilFunc=NeverStencilFunc;exports.NoBlending=NoBlending;exports.NoColorSpace=NoColorSpace;exports.NoToneMapping=NoToneMapping;exports.NormalAnimationBlendMode=NormalAnimationBlendMode;exports.NormalBlending=NormalBlending;exports.NotEqualDepth=NotEqualDepth;exports.NotEqualStencilFunc=NotEqualStencilFunc;exports.NumberKeyframeTrack=NumberKeyframeTrack;exports.Object3D=Object3D;exports.ObjectLoader=ObjectLoader;exports.ObjectSpaceNormalMap=ObjectSpaceNormalMap;exports.OctahedronBufferGeometry=OctahedronGeometry;exports.OctahedronGeometry=OctahedronGeometry;exports.OneFactor=OneFactor;exports.OneMinusDstAlphaFactor=OneMinusDstAlphaFactor;exports.OneMinusDstColorFactor=OneMinusDstColorFactor;exports.OneMinusSrcAlphaFactor=OneMinusSrcAlphaFactor;exports.OneMinusSrcColorFactor=OneMinusSrcColorFactor;exports.OrthographicCamera=OrthographicCamera;exports.PCFShadowMap=PCFShadowMap;exports.PCFSoftShadowMap=PCFSoftShadowMap;exports.PMREMGenerator=PMREMGenerator;exports.ParametricGeometry=ParametricGeometry;exports.Path=Path;exports.PerspectiveCamera=PerspectiveCamera;exports.Plane=Plane;exports.PlaneBufferGeometry=PlaneGeometry;exports.PlaneGeometry=PlaneGeometry;exports.PlaneHelper=PlaneHelper;exports.PointLight=PointLight;exports.PointLightHelper=PointLightHelper;exports.Points=Points;exports.PointsMaterial=PointsMaterial;exports.PolarGridHelper=PolarGridHelper;exports.PolyhedronBufferGeometry=PolyhedronGeometry;exports.PolyhedronGeometry=PolyhedronGeometry;exports.PositionalAudio=PositionalAudio;exports.PropertyBinding=PropertyBinding;exports.PropertyMixer=PropertyMixer;exports.QuadraticBezierCurve=QuadraticBezierCurve;exports.QuadraticBezierCurve3=QuadraticBezierCurve3;exports.Quaternion=Quaternion;exports.QuaternionKeyframeTrack=QuaternionKeyframeTrack;exports.QuaternionLinearInterpolant=QuaternionLinearInterpolant;exports.REVISION=REVISION;exports.RGBADepthPacking=RGBADepthPacking;exports.RGBAFormat=RGBAFormat;exports.RGBAIntegerFormat=RGBAIntegerFormat;exports.RGBA_ASTC_10x10_Format=RGBA_ASTC_10x10_Format;exports.RGBA_ASTC_10x5_Format=RGBA_ASTC_10x5_Format;exports.RGBA_ASTC_10x6_Format=RGBA_ASTC_10x6_Format;exports.RGBA_ASTC_10x8_Format=RGBA_ASTC_10x8_Format;exports.RGBA_ASTC_12x10_Format=RGBA_ASTC_12x10_Format;exports.RGBA_ASTC_12x12_Format=RGBA_ASTC_12x12_Format;exports.RGBA_ASTC_4x4_Format=RGBA_ASTC_4x4_Format;exports.RGBA_ASTC_5x4_Format=RGBA_ASTC_5x4_Format;exports.RGBA_ASTC_5x5_Format=RGBA_ASTC_5x5_Format;exports.RGBA_ASTC_6x5_Format=RGBA_ASTC_6x5_Format;exports.RGBA_ASTC_6x6_Format=RGBA_ASTC_6x6_Format;exports.RGBA_ASTC_8x5_Format=RGBA_ASTC_8x5_Format;exports.RGBA_ASTC_8x6_Format=RGBA_ASTC_8x6_Format;exports.RGBA_ASTC_8x8_Format=RGBA_ASTC_8x8_Format;exports.RGBA_BPTC_Format=RGBA_BPTC_Format;exports.RGBA_ETC2_EAC_Format=RGBA_ETC2_EAC_Format;exports.RGBA_PVRTC_2BPPV1_Format=RGBA_PVRTC_2BPPV1_Format;exports.RGBA_PVRTC_4BPPV1_Format=RGBA_PVRTC_4BPPV1_Format;exports.RGBA_S3TC_DXT1_Format=RGBA_S3TC_DXT1_Format;exports.RGBA_S3TC_DXT3_Format=RGBA_S3TC_DXT3_Format;exports.RGBA_S3TC_DXT5_Format=RGBA_S3TC_DXT5_Format;exports.RGBFormat=RGBFormat;exports.RGB_ETC1_Format=RGB_ETC1_Format;exports.RGB_ETC2_Format=RGB_ETC2_Format;exports.RGB_PVRTC_2BPPV1_Format=RGB_PVRTC_2BPPV1_Format;exports.RGB_PVRTC_4BPPV1_Format=RGB_PVRTC_4BPPV1_Format;exports.RGB_S3TC_DXT1_Format=RGB_S3TC_DXT1_Format;exports.RGFormat=RGFormat;exports.RGIntegerFormat=RGIntegerFormat;exports.RawShaderMaterial=RawShaderMaterial;exports.Ray=Ray;exports.Raycaster=Raycaster;exports.RectAreaLight=RectAreaLight;exports.RedFormat=RedFormat;exports.RedIntegerFormat=RedIntegerFormat;exports.ReinhardToneMapping=ReinhardToneMapping;exports.RepeatWrapping=RepeatWrapping;exports.ReplaceStencilOp=ReplaceStencilOp;exports.ReverseSubtractEquation=ReverseSubtractEquation;exports.RingBufferGeometry=RingGeometry;exports.RingGeometry=RingGeometry;exports.SRGBColorSpace=SRGBColorSpace;exports.Scene=Scene;exports.ShaderChunk=ShaderChunk;exports.ShaderLib=ShaderLib;exports.ShaderMaterial=ShaderMaterial;exports.ShadowMaterial=ShadowMaterial;exports.Shape=Shape;exports.ShapeBufferGeometry=ShapeGeometry;exports.ShapeGeometry=ShapeGeometry;exports.ShapePath=ShapePath;exports.ShapeUtils=ShapeUtils;exports.ShortType=ShortType;exports.Skeleton=Skeleton;exports.SkeletonHelper=SkeletonHelper;exports.SkinnedMesh=SkinnedMesh;exports.SmoothShading=SmoothShading;exports.Source=Source;exports.Sphere=Sphere;exports.SphereBufferGeometry=SphereGeometry;exports.SphereGeometry=SphereGeometry;exports.Spherical=Spherical;exports.SphericalHarmonics3=SphericalHarmonics3;exports.SplineCurve=SplineCurve;exports.SpotLight=SpotLight;exports.SpotLightHelper=SpotLightHelper;exports.Sprite=Sprite;exports.SpriteMaterial=SpriteMaterial;exports.SrcAlphaFactor=SrcAlphaFactor;exports.SrcAlphaSaturateFactor=SrcAlphaSaturateFactor;exports.SrcColorFactor=SrcColorFactor;exports.StaticCopyUsage=StaticCopyUsage;exports.StaticDrawUsage=StaticDrawUsage;exports.StaticReadUsage=StaticReadUsage;exports.StereoCamera=StereoCamera;exports.StreamCopyUsage=StreamCopyUsage;exports.StreamDrawUsage=StreamDrawUsage;exports.StreamReadUsage=StreamReadUsage;exports.StringKeyframeTrack=StringKeyframeTrack;exports.SubtractEquation=SubtractEquation;exports.SubtractiveBlending=SubtractiveBlending;exports.TOUCH=TOUCH;exports.TangentSpaceNormalMap=TangentSpaceNormalMap;exports.TetrahedronBufferGeometry=TetrahedronGeometry;exports.TetrahedronGeometry=TetrahedronGeometry;exports.TextGeometry=TextGeometry;exports.Texture=Texture;exports.TextureLoader=TextureLoader;exports.TorusBufferGeometry=TorusGeometry;exports.TorusGeometry=TorusGeometry;exports.TorusKnotBufferGeometry=TorusKnotGeometry;exports.TorusKnotGeometry=TorusKnotGeometry;exports.Triangle=Triangle;exports.TriangleFanDrawMode=TriangleFanDrawMode;exports.TriangleStripDrawMode=TriangleStripDrawMode;exports.TrianglesDrawMode=TrianglesDrawMode;exports.TubeBufferGeometry=TubeGeometry;exports.TubeGeometry=TubeGeometry;exports.UVMapping=UVMapping;exports.Uint16BufferAttribute=Uint16BufferAttribute;exports.Uint32BufferAttribute=Uint32BufferAttribute;exports.Uint8BufferAttribute=Uint8BufferAttribute;exports.Uint8ClampedBufferAttribute=Uint8ClampedBufferAttribute;exports.Uniform=Uniform;exports.UniformsLib=UniformsLib;exports.UniformsUtils=UniformsUtils;exports.UnsignedByteType=UnsignedByteType;exports.UnsignedInt248Type=UnsignedInt248Type;exports.UnsignedIntType=UnsignedIntType;exports.UnsignedShort4444Type=UnsignedShort4444Type;exports.UnsignedShort5551Type=UnsignedShort5551Type;exports.UnsignedShortType=UnsignedShortType;exports.VSMShadowMap=VSMShadowMap;exports.Vector2=Vector2;exports.Vector3=Vector3;exports.Vector4=Vector4;exports.VectorKeyframeTrack=VectorKeyframeTrack;exports.VideoTexture=VideoTexture;exports.WebGL1Renderer=WebGL1Renderer;exports.WebGL3DRenderTarget=WebGL3DRenderTarget;exports.WebGLArrayRenderTarget=WebGLArrayRenderTarget;exports.WebGLCubeRenderTarget=WebGLCubeRenderTarget;exports.WebGLMultipleRenderTargets=WebGLMultipleRenderTargets;exports.WebGLMultisampleRenderTarget=WebGLMultisampleRenderTarget;exports.WebGLRenderTarget=WebGLRenderTarget;exports.WebGLRenderer=WebGLRenderer;exports.WebGLUtils=WebGLUtils;exports.WireframeGeometry=WireframeGeometry;exports.WrapAroundEnding=WrapAroundEnding;exports.ZeroCurvatureEnding=ZeroCurvatureEnding;exports.ZeroFactor=ZeroFactor;exports.ZeroSlopeEnding=ZeroSlopeEnding;exports.ZeroStencilOp=ZeroStencilOp;exports._SRGBAFormat=_SRGBAFormat;exports.sRGBEncoding=sRGBEncoding;\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/three/build/three.module.js\n// module id = 0\n// module chunks = 0\n\n//# sourceURL=webpack:///./~/three/build/three.module.js?");

/***/ }),
/* 1 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("Object.defineProperty(exports, \"__esModule\", { value: true });var _tween = __webpack_require__(13);var _tween2 = _interopRequireDefault(_tween);function _interopRequireDefault(obj) {return obj && obj.__esModule ? obj : { default: obj };}\n\n// This object contains the state of the app\nexports.default = {\n  isDev: false,\n  isLoaded: false,\n  isTweening: false,\n  isRotating: true,\n  isMouseMoving: false,\n  isMouseOver: false,\n  maxAnisotropy: 1,\n  dpr: 1,\n  easing: _tween2.default.Easing.Quadratic.InOut,\n  duration: 500,\n  model: {\n    path: './assets/models/head.obj',\n    scale: 30 },\n\n  texture: {\n    path: './assets/textures/',\n    imageFiles: [] },\n\n  mesh: {\n    enableHelper: false,\n    wireframe: true,\n    translucent: false,\n    material: {\n      color: 0xffffff,\n      emissive: 0xffffff } },\n\n\n  fog: {\n    color: 0xffffff,\n    near: 0.0008 },\n\n  grid: {\n    size: 10000,\n    divisions: 80 },\n\n  camera: {\n    fov: 45,\n    near: 100,\n    far: 15000,\n    aspect: 1,\n    posX: 0,\n    posY: 2500,\n    posZ: 0 },\n\n  soundObject: {\n    defaultRadius: 50,\n    defaultTrajectoryClock: 1,\n    defaultMovementSpeed: 5,\n    defaultMovementDirection: 1,\n    defaultPosX: 0,\n    defaultPosY: 0,\n    defaultPosZ: 0 },\n\n  controls: {\n    autoRotate: false,\n    autoRotateSpeed: -0.5,\n    rotateSpeed: 0.5,\n    zoomSpeed: 0.8,\n    minDistance: 200,\n    maxDistance: 7500,\n    minPolarAngle: -Math.PI / 2,\n    maxPolarAngle: Math.PI / 2,\n    minAzimuthAngle: -Infinity,\n    maxAzimuthAngle: Infinity,\n    enableDamping: true,\n    dampingFactor: 0.5,\n    enableZoom: true,\n    target: {\n      x: 0,\n      y: 0,\n      z: 0 } },\n\n\n  ambientLight: {\n    enabled: true,\n    color: 0x777777 },\n\n  directionalLight: {\n    enabled: true,\n    color: 0xffffff,\n    intensity: 1,\n    multiplyScalar: 50,\n    hue: 0.1,\n    saturation: 0,\n    lightness: 0.5,\n    x: 0,\n    y: 30,\n    z: 0 },\n\n  shadow: {\n    enabled: true,\n    helperEnabled: false,\n    bias: 0,\n    mapWidth: 2048,\n    mapHeight: 2048,\n    near: 0,\n    far: 2048,\n    top: 2048,\n    right: 2048,\n    bottom: -2048,\n    left: -2048 },\n\n  pointLight: {\n    enabled: false,\n    color: 0xffffff,\n    intensity: 0.34,\n    distance: 115,\n    x: 0,\n    y: 0,\n    z: 0 },\n\n  hemiLight: {\n    enabled: false,\n    color: 0xc8c8c8,\n    groundColor: 0xffffff,\n    intensity: 0.55,\n    x: 0,\n    y: 0,\n    z: 0 },\n\n  firebaseConfig: {\n    apiKey: \"AIzaSyDRAW7tWSgaHrabHRLW6TNwG7nikTBuHHc\",\n    authDomain: \"inviso-c8758.firebaseapp.com\",\n    projectId: \"inviso-c8758\",\n    storageBucket: \"inviso-c8758.appspot.com\",\n    messagingSenderId: \"52538340049\",\n    appId: \"1:52538340049:web:f7d728db5095f8d46ecbf0\" }\n\n  //   const firebaseConfig = {\n  //     apiKey: \"AIzaSyDRAW7tWSgaHrabHRLW6TNwG7nikTBuHHc\",\n  //     authDomain: \"inviso-c8758.firebaseapp.com\",\n  //     projectId: \"inviso-c8758\",\n  //     storageBucket: \"inviso-c8758.appspot.com\",\n  //     messagingSenderId: \"52538340049\",\n  //     appId: \"1:52538340049:web:f7d728db5095f8d46ecbf0\",\n  //     measurementId: \"G-XFP5XQ2SBF\"\n  //   };\n};\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/js/data/config.js\n// module id = 1\n// module chunks = 0\n\n//# sourceURL=webpack:///./src/js/data/config.js?");

/***/ }),
/* 2 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("Object.defineProperty(exports, \"__esModule\", { value: true });var _createClass = function () {function defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if (\"value\" in descriptor) descriptor.writable = true;Object.defineProperty(target, descriptor.key, descriptor);}}return function (Constructor, protoProps, staticProps) {if (protoProps) defineProperties(Constructor.prototype, protoProps);if (staticProps) defineProperties(Constructor, staticProps);return Constructor;};}();function _classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError(\"Cannot call a class as a function\");}} // Provides simple static functions that are used multiple times in the app\nvar Helpers = function () {function Helpers() {_classCallCheck(this, Helpers);}_createClass(Helpers, null, [{ key: 'throttle', value: function throttle(\n    fn, threshhold, scope) {\n      threshhold || (threshhold = 250);\n      var last = void 0,deferTimer = void 0;\n\n      return function () {\n        var context = scope || this;\n\n        var now = +new Date(),\n        args = arguments;\n\n        if (last && now < last + threshhold) {\n          clearTimeout(deferTimer);\n          deferTimer = setTimeout(function () {\n            last = now;\n            fn.apply(context, args);\n          }, threshhold);\n        } else\n        {\n          last = now;\n          fn.apply(context, args);\n        }\n      };\n    } }, { key: 'logProgress', value: function logProgress()\n\n    {\n      return function (xhr) {\n        if (xhr.lengthComputable) {\n          var percentComplete = xhr.loaded / xhr.total * 100;\n\n          console.log(Math.round(percentComplete, 2) + '% downloaded');\n        }\n      };\n    } }, { key: 'logError', value: function logError()\n\n    {\n      return function (xhr) {\n        console.error(xhr);\n      };\n    } }, { key: 'handleColorChange', value: function handleColorChange(\n\n    color) {\n      return function (value) {\n        if (typeof value === 'string') {\n          value = value.replace('#', '0x');\n        }\n\n        color.setHex(value);\n      };\n    } }, { key: 'update', value: function update(\n\n    mesh) {\n      this.needsUpdate(mesh.material, mesh.geometry);\n    } }, { key: 'needsUpdate', value: function needsUpdate(\n\n    material, geometry) {\n      return function () {\n        material.shading = +material.shading; //Ensure number\n        material.vertexColors = +material.vertexColors; //Ensure number\n        material.side = +material.side; //Ensure number\n        material.needsUpdate = true;\n        geometry.verticesNeedUpdate = true;\n        geometry.normalsNeedUpdate = true;\n        geometry.colorsNeedUpdate = true;\n      };\n    } }, { key: 'updateTexture', value: function updateTexture(\n\n    material, materialKey, textures) {\n      return function (key) {\n        material[materialKey] = textures[key];\n        material.needsUpdate = true;\n      };\n    } }, { key: 'toRadians', value: function toRadians(\n\n    angle) {\n      return angle * (Math.PI / 180);\n    } }, { key: 'mapRange', value: function mapRange(\n\n    value, low1, high1, low2, high2) {\n      return low2 + (high2 - low2) * (value - low1) / (high1 - low1);\n    } }]);return Helpers;}();exports.default = Helpers;\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/js/utils/helpers.js\n// module id = 2\n// module chunks = 0\n\n//# sourceURL=webpack:///./src/js/utils/helpers.js?");

/***/ }),
/* 3 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("Object.defineProperty(exports, \"__esModule\", { value: true });var _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) {return typeof obj;} : function (obj) {return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;};exports.\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n__extends = __extends;exports.\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n__rest = __rest;exports.\n\n\n\n\n\n\n\n\n\n\n\n__decorate = __decorate;exports.\n\n\n\n\n\n\n__param = __param;exports.\n\n\n\n__metadata = __metadata;exports.\n\n\n\n__awaiter = __awaiter;exports.\n\n\n\n\n\n\n\n\n\n__generator = __generator;exports.\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n__createBinding = __createBinding;exports.\n\n\n\n\n__exportStar = __exportStar;exports.\n\n\n\n__values = __values;exports.\n\n\n\n\n\n\n\n\n\n\n\n__read = __read;exports.\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n__spread = __spread;exports.\n\n\n\n\n\n__spreadArrays = __spreadArrays;exports.\n\n\n\n\n\n\n\n__await = __await;exports.\n\n\n\n__asyncGenerator = __asyncGenerator;exports.\n\n\n\n\n\n\n\n\n\n\n\n__asyncDelegator = __asyncDelegator;exports.\n\n\n\n\n\n__asyncValues = __asyncValues;exports.\n\n\n\n\n\n\n\n__makeTemplateObject = __makeTemplateObject;exports.\n\n\n\n\n__importStar = __importStar;exports.\n\n\n\n\n\n\n\n__importDefault = __importDefault;exports.\n\n\n\n__classPrivateFieldGet = __classPrivateFieldGet;exports.\n\n\n\n\n\n\n__classPrivateFieldSet = __classPrivateFieldSet; /*! *****************************************************************************\r\n                                                 Copyright (c) Microsoft Corporation.\r\n                                                 \r\n                                                 Permission to use, copy, modify, and/or distribute this software for any\r\n                                                 purpose with or without fee is hereby granted.\r\n                                                 \r\n                                                 THE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\n                                                 REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\n                                                 AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\n                                                 INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\n                                                 LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\n                                                 OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\n                                                 PERFORMANCE OF THIS SOFTWARE.\r\n                                                 ***************************************************************************** */ /* global Reflect, Promise */var _extendStatics = function extendStatics(d, b) {_extendStatics = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (d, b) {d.__proto__ = b;} || function (d, b) {for (var p in b) {if (b.hasOwnProperty(p)) d[p] = b[p];}};return _extendStatics(d, b);};function __extends(d, b) {_extendStatics(d, b);function __() {this.constructor = d;}d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());}var _assign = function __assign() {exports.__assign = _assign = Object.assign || function __assign(t) {for (var s, i = 1, n = arguments.length; i < n; i++) {s = arguments[i];for (var p in s) {if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];}}return t;};return _assign.apply(this, arguments);};exports.__assign = _assign;function __rest(s, e) {var t = {};for (var p in s) {if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0) t[p] = s[p];}if (s != null && typeof Object.getOwnPropertySymbols === \"function\") for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i])) t[p[i]] = s[p[i]];}return t;}function __decorate(decorators, target, key, desc) {var c = arguments.length,r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc,d;if ((typeof Reflect === \"undefined\" ? \"undefined\" : _typeof(Reflect)) === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);else for (var i = decorators.length - 1; i >= 0; i--) {if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;}return c > 3 && r && Object.defineProperty(target, key, r), r;}function __param(paramIndex, decorator) {return function (target, key) {decorator(target, key, paramIndex);};}function __metadata(metadataKey, metadataValue) {if ((typeof Reflect === \"undefined\" ? \"undefined\" : _typeof(Reflect)) === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);}function __awaiter(thisArg, _arguments, P, generator) {function adopt(value) {return value instanceof P ? value : new P(function (resolve) {resolve(value);});}return new (P || (P = Promise))(function (resolve, reject) {function fulfilled(value) {try {step(generator.next(value));} catch (e) {reject(e);}}function rejected(value) {try {step(generator[\"throw\"](value));} catch (e) {reject(e);}}function step(result) {result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);}step((generator = generator.apply(thisArg, _arguments || [])).next());});}function __generator(thisArg, body) {var _ = { label: 0, sent: function sent() {if (t[0] & 1) throw t[1];return t[1];}, trys: [], ops: [] },f,y,t,g;return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function () {return this;}), g;function verb(n) {return function (v) {return step([n, v]);};}function step(op) {if (f) throw new TypeError(\"Generator is already executing.\");while (_) {try {if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;if (y = 0, t) op = [op[0] & 2, t.value];switch (op[0]) {case 0:case 1:t = op;break;case 4:_.label++;return { value: op[1], done: false };case 5:_.label++;y = op[1];op = [0];continue;case 7:op = _.ops.pop();_.trys.pop();continue;default:if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) {_ = 0;continue;}if (op[0] === 3 && (!t || op[1] > t[0] && op[1] < t[3])) {_.label = op[1];break;}if (op[0] === 6 && _.label < t[1]) {_.label = t[1];t = op;break;}if (t && _.label < t[2]) {_.label = t[2];_.ops.push(op);break;}if (t[2]) _.ops.pop();_.trys.pop();continue;}op = body.call(thisArg, _);} catch (e) {op = [6, e];y = 0;} finally {f = t = 0;}}if (op[0] & 5) throw op[1];return { value: op[0] ? op[1] : void 0, done: true };}}function __createBinding(o, m, k, k2) {if (k2 === undefined) k2 = k;o[k2] = m[k];}function __exportStar(m, exports) {for (var p in m) {if (p !== \"default\" && !exports.hasOwnProperty(p)) exports[p] = m[p];}}function __values(o) {var s = typeof Symbol === \"function\" && Symbol.iterator,m = s && o[s],i = 0;if (m) return m.call(o);if (o && typeof o.length === \"number\") return { next: function next() {if (o && i >= o.length) o = void 0;return { value: o && o[i++], done: !o };} };throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");}function __read(o, n) {var m = typeof Symbol === \"function\" && o[Symbol.iterator];if (!m) return o;var i = m.call(o),r,ar = [],e;try {while ((n === void 0 || n-- > 0) && !(r = i.next()).done) {ar.push(r.value);}} catch (error) {e = { error: error };} finally {try {if (r && !r.done && (m = i[\"return\"])) m.call(i);} finally {if (e) throw e.error;}}return ar;}function __spread() {for (var ar = [], i = 0; i < arguments.length; i++) {ar = ar.concat(__read(arguments[i]));}return ar;}function __spreadArrays() {for (var s = 0, i = 0, il = arguments.length; i < il; i++) {s += arguments[i].length;}for (var r = Array(s), k = 0, i = 0; i < il; i++) {for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++) {r[k] = a[j];}}return r;};function __await(v) {return this instanceof __await ? (this.v = v, this) : new __await(v);}function __asyncGenerator(thisArg, _arguments, generator) {if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");var g = generator.apply(thisArg, _arguments || []),i,q = [];return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () {return this;}, i;function verb(n) {if (g[n]) i[n] = function (v) {return new Promise(function (a, b) {q.push([n, v, a, b]) > 1 || resume(n, v);});};}function resume(n, v) {try {step(g[n](v));} catch (e) {settle(q[0][3], e);}}function step(r) {r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r);}function fulfill(value) {resume(\"next\", value);}function reject(value) {resume(\"throw\", value);}function settle(f, v) {if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]);}}function __asyncDelegator(o) {var i, p;return i = {}, verb(\"next\"), verb(\"throw\", function (e) {throw e;}), verb(\"return\"), i[Symbol.iterator] = function () {return this;}, i;function verb(n, f) {i[n] = o[n] ? function (v) {return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v;} : f;}}function __asyncValues(o) {if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");var m = o[Symbol.asyncIterator],i;return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () {return this;}, i);function verb(n) {i[n] = o[n] && function (v) {return new Promise(function (resolve, reject) {v = o[n](v), settle(resolve, reject, v.done, v.value);});};}function settle(resolve, reject, d, v) {Promise.resolve(v).then(function (v) {resolve({ value: v, done: d });}, reject);}}function __makeTemplateObject(cooked, raw) {if (Object.defineProperty) {Object.defineProperty(cooked, \"raw\", { value: raw });} else {cooked.raw = raw;}return cooked;};function __importStar(mod) {if (mod && mod.__esModule) return mod;var result = {};if (mod != null) for (var k in mod) {if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];}result.default = mod;return result;}function __importDefault(mod) {return mod && mod.__esModule ? mod : { default: mod };}function __classPrivateFieldGet(receiver, privateMap) {if (!privateMap.has(receiver)) {throw new TypeError(\"attempted to get private field on non-instance\");}return privateMap.get(receiver);}function __classPrivateFieldSet(receiver, privateMap, value) {if (!privateMap.has(receiver)) {throw new TypeError(\"attempted to set private field on non-instance\");}privateMap.set(receiver, value);return value;}\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/tslib/tslib.es6.js\n// module id = 3\n// module chunks = 0\n\n//# sourceURL=webpack:///./~/tslib/tslib.es6.js?");

/***/ }),
/* 4 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("Object.defineProperty(exports, \"__esModule\", { value: true });var _createClass = function () {function defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if (\"value\" in descriptor) descriptor.writable = true;Object.defineProperty(target, descriptor.key, descriptor);}}return function (Constructor, protoProps, staticProps) {if (protoProps) defineProperties(Constructor.prototype, protoProps);if (staticProps) defineProperties(Constructor, staticProps);return Constructor;};}();var _three = __webpack_require__(0);var THREE = _interopRequireWildcard(_three);\n__webpack_require__(10);\n\nvar _config = __webpack_require__(1);var _config2 = _interopRequireDefault(_config);\nvar _helpers = __webpack_require__(2);var _helpers2 = _interopRequireDefault(_helpers);\nvar _action = __webpack_require__(5);var _action2 = _interopRequireDefault(_action);function _interopRequireDefault(obj) {return obj && obj.__esModule ? obj : { default: obj };}function _interopRequireWildcard(obj) {if (obj && obj.__esModule) {return obj;} else {var newObj = {};if (obj != null) {for (var key in obj) {if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key];}}newObj.default = obj;return newObj;}}function _classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError(\"Cannot call a class as a function\");}}var\n\nSoundObject = function () {\n  function SoundObject(main) {var copyObject = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;_classCallCheck(this, SoundObject);\n    this.stoRef = main.stoRef;\n    this.dbRef = main.dbRef;\n    this.type = 'SoundObject';\n    this.posX = 0;\n    this.posY = 0;\n    this.posZ = 0;\n    this.radius = _config2.default.soundObject.defaultRadius;\n    this.cones = [];\n    this.coneSounds = new Object();\n    this.prevOmniSphereSound = null;\n    this.audio = main.audio;\n    this.gui = main.gui;\n    this.isMuted = main.isMuted;\n    this.app = main;\n    this.userSetPlay = this.app.isPlaying;\n    this.finishUploadingSound = true;\n\n    this.trajectory = null;\n    this.trajectoryClock = _config2.default.soundObject.defaultTrajectoryClock;\n    this.movementSpeed = _config2.default.soundObject.defaultMovementSpeed;\n    this.movementDirection = _config2.default.soundObject.defaultMovementDirection;\n    this.movementIncrement = null;\n    this.oldPosition = null;\n    this.hasBeenMoved = false;\n    this.lastPathPosition = new THREE.Vector3();\n    this.objConeCache = {};\n    this.oldTrajectorySpeed = null;\n\n\n    this.containerObject = new THREE.Object3D();\n\n    var materialColor = this.userSetPlay ? 0xFFFFFF : 0x8F8F8F;\n    var sphereGeometry = new THREE.SphereBufferGeometry(this.radius, 100, 100);\n    var sphereMaterial = new THREE.MeshBasicMaterial({\n      color: materialColor,\n      opacity: 0.8,\n      transparent: true,\n      premultipliedAlpha: true });\n\n    this.omniSphere = new THREE.Mesh(sphereGeometry, sphereMaterial);\n    this.omniSphere.name = 'omniSphere';\n    this.omniSphere.castShadow = true;\n    this.omniSphere.sound = null;\n\n    var raycastSphereGeometry = new THREE.SphereBufferGeometry(150, 100, 100);\n    var raycastSphereMaterial = new THREE.MeshBasicMaterial({ color: 0xFFFFFF, visible: false });\n    this.raycastSphere = new THREE.Mesh(raycastSphereGeometry, raycastSphereMaterial);\n    this.raycastSphere.name = 'sphere';\n    this.raycastSphere.position.copy(main.mouse);\n    main.scene.add(this.raycastSphere);\n\n    this.axisHelper = new THREE.AxesHelper(100);\n    this.axisHelper.position.copy(main.mouse);\n    main.scene.add(this.axisHelper);\n\n    var lineMaterial = new THREE.LineDashedMaterial({\n      color: 0x888888,\n      dashSize: 30,\n      gapSize: 30 });\n\n\n    // const lineGeometry = new THREE.Geometry();\n\n    // lineGeometry.vertices.push(\n    //   new THREE.Vector3(0, 0, -300),\n    //   new THREE.Vector3(0, 0, 300),\n    // );\n\n    // lineGeometry.computeLineDistances();\n    var points = [];\n    points.push(new THREE.Vector3(0, 0, -300));\n    points.push(new THREE.Vector3(0, 0, 300));\n\n    var lineGeometry = new THREE.BufferGeometry().setFromPoints(points);\n\n    this.altitudeHelper = new THREE.Line(lineGeometry, lineMaterial);\n    this.altitudeHelper.computeLineDistances(); // added\n    this.altitudeHelper.rotation.x = Math.PI / 2;\n    main.scene.add(this.altitudeHelper);\n    this.altitudeHelper.position.copy(main.mouse);\n\n    this.containerObject.add(this.omniSphere);\n    this.containerObject.position.copy(main.mouse);\n    main.scene.add(this.containerObject);\n    // TODO: update roomCode if going from individual mode to group mode\n    this.roomCode = main.roomCode;\n    if (this.roomCode != null) {\n      this.headKey = main.headKey.key;\n      // Firebase tracking for newly created soundObjects\n      if (copyObject) {\n        this.containerObject.name = copyObject;\n      } else {\n        var objectKey = this.dbRef.child('objects').push();\n        this.containerObject.name = objectKey.key;\n        objectKey.set({\n          position: this.containerObject.position,\n          type: this.type,\n          sound: null,\n          lastEdit: main.headKey.key });\n\n      }\n    }\n\n  }_createClass(SoundObject, [{ key: 'updateFirebaseDetails', value: function updateFirebaseDetails(\n\n    dbRef, stoRef, headKey, roomCode) {var _this = this;\n      this.headKey = headKey.key;\n      this.stoRef = stoRef;\n      this.dbRef = dbRef;\n      this.roomCode = roomCode;\n      // push to firebase with new details\n      var objectKey = this.dbRef.child('objects').push();\n      this.containerObject.name = objectKey.key;\n\n      var playState = this.omniSphere.sound ? !this.omniSphere.sound.state.isAudioPaused :\n      this.app.isPlaying ? null : false;\n      objectKey.set({\n        position: this.containerObject.position,\n        type: this.type,\n        sound: null,\n        lastEdit: this.headKey,\n        isPlaying: playState });\n\n\n      // upload object's sound\n      if (this.omniSphere.sound != null && this.file) {\n        this.uploadSoundToFirebase(this, this.containerObject.name, this.file);\n      }\n\n      // upload all of object's cones\n      this.cones.forEach(function (c) {\n        _this.dbRef.child('objects').child('cones').push();\n        if (c.file) {\n          _this.uploadSoundToFirebase(c, c.uuid, c.file);\n        }\n      });\n\n      // upload object's trajectory\n      if (this.trajectory) {\n        this.trajectory.updateFirebaseDetails(dbRef, stoRef, headKey, roomCode);\n      }\n    } }, { key: 'createCone', value: function createCone(\n\n    sound) {var color = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;\n      sound.volume.gain.value = 1;\n      sound.spread = 0.5;\n\n      var coneWidth = sound.spread * 90;\n      var coneHeight = sound.volume.gain.value * 50 + 50;\n\n      var coneGeo = new THREE.CylinderGeometry(coneWidth, 0, coneHeight, 100, 1, true);\n      var randGreen = color !== null ? color : Math.random();\n      var randBlue = color !== null ? color : Math.random();\n      //const coneColor = new THREE.Color(0.5, randGreen, randBlue);\n      var coneColor = new THREE.Color();\n      coneColor.setHSL(randGreen, randBlue, 0.8);\n      var coneMaterial = new THREE.MeshBasicMaterial({\n        color: coneColor,\n        opacity: 0.8,\n        transparent: true });\n\n\n      coneGeo.translate(0, coneHeight / 2, 0);\n      coneGeo.rotateX(Math.PI / 2);\n      coneMaterial.side = THREE.DoubleSide;\n\n      var cone = new THREE.Mesh(coneGeo, coneMaterial);\n\n      cone.randGreen = randGreen;\n      cone.sound = sound;\n      cone.sound.panner.coneInnerAngle = Math.atan(coneWidth / coneHeight) * (180 / Math.PI);\n      cone.sound.panner.coneOuterAngle = cone.sound.panner.coneInnerAngle * 3;\n      cone.sound.panner.coneOuterGain = 0.05;\n      // cone.sound.volume.gain.value = Helpers.mapRange(coneHeight, 100, 150, 0.5, 2);\n\n      cone.name = 'cone';\n      cone.baseColor = coneColor;\n      cone.hoverColor = function () {\n        var c = this.baseColor.clone();\n        c.offsetHSL(0, -0.05, 0.1);\n        return c;\n      };\n\n      cone.userSetPlay = this.app.isPlaying;\n\n      var materialColor = cone.userSetPlay ? cone.baseColor.getHex() : 0x8F8F8F;\n      cone.material.color.setHex(materialColor);\n\n      sound.scriptNode.onaudioprocess = function () {\n        var array = new Uint8Array(sound.analyser.frequencyBinCount);\n        sound.analyser.getByteFrequencyData(array);\n        var values = 0;\n        var length = array.length;\n        for (var i = 0; i < length; i++) {values += array[i];}\n        var average = values / length;\n        cone.material.opacity = _helpers2.default.mapRange(average, 50, 100, 0.65, 0.95);\n\n        // Updates current time of playback for audio display\n        if (cone.sound && !cone.sound.state.isAudioPaused && !cone.sound.state.isChangingAudioTime) {\n          var currentTime = (Date.now() - cone.sound.state.startedAt) / 1000;\n          currentTime = currentTime % Math.floor(cone.sound.state.duration);\n          cone.sound.state.currentTime = currentTime;\n        }\n      };\n\n      cone.long = 0;\n      cone.lat = 0;\n\n\n      this.cones.push(cone);\n      this.containerObject.add(cone);\n      this.setAudioPosition(cone);\n      return cone;\n    } }, { key: 'setAudioPosition', value: function setAudioPosition(\n\n    object) {\n      var o = new THREE.Vector3();\n      object.updateMatrixWorld();\n      o.setFromMatrixPosition(object.matrixWorld);\n      if (object.sound) {\n        object.sound.panner.setPosition(o.x, o.y, o.z);\n      }\n\n      if (object.name == 'cone') {\n        var p = new THREE.Vector3();\n        var q = new THREE.Vector3();\n        var m = object.matrixWorld;\n\n        var mx = m.elements[12];\n        var my = m.elements[13];\n        var mz = m.elements[14];\n\n        var vec = new THREE.Vector3(0, 0, 1);\n\n        m.elements[12] = m.elements[13] = m.elements[14] = 0;\n\n        vec.applyMatrix4(m);\n        vec.normalize();\n        if (object.sound) {\n          object.sound.panner.setOrientation(vec.x, vec.y, vec.z);\n        }\n\n        m.elements[12] = mx;\n        m.elements[13] = my;\n        m.elements[14] = mz;\n      }\n    } }, { key: 'uploadSoundToFirebase', value: function uploadSoundToFirebase(\n\n    object, id, file) {\n      var tempDbRef = this.dbRef;\n      var headKey = this.headKey;\n      if (object.type == 'SoundObject') {\n        object.isAddingSound = true;\n        var self = this;\n        // change path from soundObjects/id\n        var upload = this.stoRef.child('soundObjects/' + id + '/' + file.name).put(file);\n        upload.on('state_changed', function (snapshot) {\n          var progress = snapshot.bytesTransferred / snapshot.totalBytes * 100;\n          console.log('Upload is ' + progress + '% done');\n        }, function (error) {\n          console.log('Problem uploading file');\n        }, function () {\n          console.log('File finished uploading, pushing status');\n          tempDbRef.child('objects').child(id).update({\n            sound: file.name,\n            volume: object.omniSphere.sound.volume.gain.value,\n            lastEdit: headKey,\n            isPlaying: object.omniSphere.sound != null ? !object.omniSphere.sound.state.isAudioPaused : self.app.isPlaying });\n\n          object.isAddingSound = false;\n        });\n      } else {\n        var _self = this;\n        var _upload = this.stoRef.child('soundObjects/' + this.containerObject.name + '/' + id + '/' + file.name).put(file);\n        var isConePlaying = !object.sound.state.isAudioPaused;\n        this.finishUploadingSound = false;\n        _upload.on('state_changed', function (snapshot) {\n          var progress = snapshot.bytesTransferred / snapshot.totalBytes * 100;\n          console.log('Upload is ' + progress + '% done');\n        }, function (error) {\n          console.log('Problem uploading file');\n        }, function () {\n          tempDbRef.child('objects').child(_self.containerObject.name).child('cones').child(id).update({\n            type: \"cone\",\n            parent: _self.containerObject.name,\n            uuid: id,\n            sound: file.name,\n            volume: object.sound.volume.gain.value,\n            spread: object.sound.spread,\n            longitude: object.long,\n            latitude: object.lat,\n            lastEdit: headKey,\n            isPlaying: isConePlaying });\n\n          _self.finishUploadingSound = true;\n        });\n      }\n\n    } }, { key: 'loadSound', value: function loadSound(\n\n    file, audio, mute, object) {var soundIn = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : null;var copy = arguments.length > 5 && arguments[5] !== undefined ? arguments[5] : false;\n      var context = audio.context;\n      var mainMixer = context.createGain();\n      var reader = new FileReader();\n      var sound = {};\n\n      console.log(\"loading \", file.name);\n      // add metadata with name of uuid\n      if (object != null && !copy && this.roomCode != null) {\n        var id = object.uuid;\n        if (object.type == 'SoundObject') {\n          id = object.containerObject.name;\n          this.uploadSoundToFirebase(object, id, file);\n        }\n      }\n\n\n      if (object) {// cones can be null at this point\n        object.filename = file.name;\n        object.file = file;\n      }\n      var temp = null;\n      if (soundIn != null) {\n        temp = Object.assign(soundIn, temp);\n      }\n      var promise = new Promise(function (resolve, reject) {\n        reader.onload = function (ev) {\n          context.decodeAudioData(ev.target.result, function (decodedData) {\n            if (object && object.type === 'SoundObject') {\n              /* attach omnidirectional sound */\n              object = object.omniSphere;\n            }\n\n\n            if (object && object.sound) {\n              if (!object.sound.state.isAudioPaused) {\n                object.sound.source.stop();\n              }\n\n              if (temp) {\n                var pausedTime = temp.state.pausedAt;\n                var current = temp.state.currentTime;\n              }\n              // Failed to execute disconnect on this audio node (346)\n              object.sound.source.disconnect(object.sound.scriptNode);\n              object.sound.scriptNode.disconnect(context.destination);\n\n              if (temp) {\n                object.sound.state.clear(temp.state);\n              } else\n              {\n                object.sound.state.clear();\n              }\n\n            }\n\n            sound.mainMixer = mainMixer;\n\n            sound.analyser = context.createAnalyser();\n            sound.analyser.smoothingTimeConstant = 0.5;\n            sound.analyser.fftSize = 1024;\n\n            sound.panner = context.createPanner();\n            sound.panner.panningModel = 'HRTF';\n            sound.panner.distanceModel = 'inverse';\n            sound.panner.refDistance = 100;\n\n            // sound.panner.rolloffFactor = 5;\n\n            sound.volume = context.createGain();\n            sound.volume.connect(sound.analyser);\n            sound.volume.connect(sound.panner);\n            sound.panner.connect(mainMixer);\n            mainMixer.connect(audio.destination);\n            mainMixer.gain.value = mute ? 0 : 1;\n\n            sound.state = {};\n            sound.state.startedAt = Date.now();\n            sound.state.pausedAt = 0;\n            sound.state.currentTime = 0;\n            sound.state.isAudioPaused = false;\n            sound.state.isChangingAudioTime = false;\n            sound.state.duration = 0;\n\n            // restore state\n            if (soundIn != null && temp) {\n              sound.state.pausedAt = pausedTime;\n              sound.state.currentTime = current;\n            }\n\n            sound.state.clear = function () {\n              sound.state.startedAt = sound.state.pausedAt = sound.state.currentTime = sound.state.duration = 0;\n              sound.state.isAudioPaused = true;\n            };\n\n            sound.play = function () {var resumeTime = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 0;\n              sound.scriptNode = context.createScriptProcessor(2048, 1, 1);\n              sound.scriptNode.connect(context.destination);\n              sound.source = context.createBufferSource();\n              sound.source.loop = true;\n              sound.source.connect(sound.scriptNode);\n              sound.source.connect(sound.volume);\n              sound.source.buffer = decodedData;\n\n              sound.state.duration = sound.source.buffer.duration;\n              sound.source.start(context.currentTime + 0.020, resumeTime);\n            };\n\n            if (soundIn != null) {\n              sound.state.startedAt = Date.now() - sound.state.pausedAt;\n              sound.state.isAudioPaused = false;\n              sound.play(sound.state.pausedAt / 1000);\n            } else\n            {\n              sound.play(0);\n            }\n\n            if (object && object.name === 'omniSphere') {\n              sound.scriptNode.onaudioprocess = function () {\n                var array = new Uint8Array(sound.analyser.frequencyBinCount);\n                sound.analyser.getByteFrequencyData(array);\n                var values = 0;\n                var length = array.length;\n                for (var i = 0; i < length; i++) {values += array[i];}\n                var average = values / length;\n                object.material.opacity = _helpers2.default.mapRange(average, 50, 100, 0.65, 0.95);\n\n                // Updates current time of play for audio playback\n                if (!sound.state.isAudioPaused && !sound.state.isChangingAudioTime) {\n                  var currentTime = (Date.now() - sound.state.startedAt) / 1000;\n                  currentTime = currentTime % Math.floor(sound.state.duration);\n                  sound.state.currentTime = currentTime;\n                }\n\n              };\n            }\n\n            resolve(sound);\n          });\n        };\n\n        reader.readAsArrayBuffer(file);\n      });\n      console.log(\"finished sound loading\");\n      return promise;\n    } }, { key: 'playSound', value: function playSound()\n\n    {var userToggled = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : false;var following = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n      if (this.omniSphere.sound && this.omniSphere.sound.state) {\n        this.omniSphere.sound.state.startedAt = Date.now() - this.omniSphere.sound.state.pausedAt;\n        this.omniSphere.sound.state.isAudioPaused = false;\n\n        this.omniSphere.sound.play(this.omniSphere.sound.state.pausedAt / 1000);\n\n        this.omniSphere.material.color.setHex(0xFFFFFF);\n        if (userToggled && this.roomCode != null) {\n          this.updatePlayStatus(true);\n        }\n      } else {\n        this.omniSphere.material.color.setHex(0xFFFFFF);\n      }\n    } }, { key: 'playConeSound', value: function playConeSound(\n\n    cone) {var userToggled = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;var following = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;\n      cone.sound.state.startedAt = Date.now() - cone.sound.state.pausedAt;\n      cone.sound.state.isAudioPaused = false;\n\n      cone.sound.play(cone.sound.state.pausedAt / 1000);\n\n      if (userToggled && this.roomCode != null) {\n        this.updateConePlayStatus(true, following, cone.uuid);\n      }\n\n      cone.material.color.setHex(cone.baseColor.getHex());\n    } }, { key: 'stopSound', value: function stopSound()\n\n    {var userToggled = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : false;var following = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n      if (this.omniSphere.sound && this.omniSphere.sound.state) {\n        this.omniSphere.sound.state.pausedAt = (Date.now() - this.omniSphere.sound.state.startedAt) % (this.omniSphere.sound.state.duration * 1000);\n        this.omniSphere.sound.state.isAudioPaused = true;\n        this.omniSphere.sound.source.stop();\n\n        this.omniSphere.material.color.setHex(0x8F8F8F);\n        if (userToggled && this.roomCode != null) {\n          this.updatePlayStatus(false);\n        }\n      } else {\n        this.omniSphere.material.color.setHex(0x8F8F8F);\n      }\n    } }, { key: 'updatePlayStatus', value: function updatePlayStatus(\n\n    status) {\n      var updates = {};\n      updates['isPlaying'] = status;\n      console.log(\"updating play status\", this.headKey);\n      updates['lastEdit'] = this.headKey;\n      this.dbRef.child('objects').child(this.containerObject.name).update(updates);\n    } }, { key: 'updateConePlayStatus', value: function updateConePlayStatus(\n\n    status, following, id) {\n      var updates = {};\n      updates['isPlaying'] = status;\n      if (!following) {\n        updates['lastEdit'] = this.headKey;\n      }\n      this.dbRef.child('objects').child(this.containerObject.name).child('cones').child(id).update(updates);\n\n    } }, { key: 'stopConeSound', value: function stopConeSound(\n\n    cone) {var userToggled = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;var following = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;\n      cone.sound.state.pausedAt = (Date.now() - cone.sound.state.startedAt) % (cone.sound.state.duration * 1000);\n      cone.sound.state.isAudioPaused = true;\n\n      cone.material.color.setHex(0x8F8F8F);\n      cone.sound.source.stop();\n      // cone.filename = null;\n      if (userToggled && this.roomCode != null) {\n        this.updateConePlayStatus(false, following, cone.uuid);\n      }\n    } }, { key: 'isUnderMouse', value: function isUnderMouse(\n\n    ray) {\n      return ray.intersectObject(this.containerObject, true).length > 0;\n    } }, { key: 'select', value: function select(\n\n    main) {\n      this.nonScaledMouseOffsetY = main.nonScaledMouse.y;\n    } }, { key: 'move', value: function move(\n\n    main, isTrajectoryDragging) {\n      var pointer = void 0;\n      var updates = {};\n      if (main.perspectiveView) {\n        var posY = _helpers2.default.mapRange(\n        main.nonScaledMouse.y - this.nonScaledMouseOffsetY,\n        -0.5,\n        0.5,\n        -200,\n        200);\n\n\n        pointer = this.containerObject.position;\n        if (pointer.y > -200 || pointer.y < 200) pointer.y += posY;\n\n        // clamp\n        pointer.y = Math.max(Math.min(pointer.y, 300), -300);\n\n        this.nonScaledMouseOffsetY = main.nonScaledMouse.y;\n      } else {\n        pointer = main.mouse;\n        pointer.y = this.containerObject.position.y;\n      }\n\n      if (this.trajectory) {\n        this.trajectory.move(pointer, main.nonScaledMouse, main.perspectiveView);\n      }\n\n      this.setPosition(pointer);\n      // fix for dragging while on trajectory\n      if (this.roomCode != null) {\n        updates[\"position\"] = pointer;\n        updates[\"lastEdit\"] = this.app.headKey.key;\n        this.dbRef.child('objects').child(this.containerObject.name).update(updates);\n      }\n\n      if (!isTrajectoryDragging) {\n        this.hasBeenMoved = true;\n      }\n    } }, { key: 'setPosition', value: function setPosition(\n\n    position) {\n      this.containerObject.position.copy(position);\n      this.axisHelper.position.copy(position);\n      this.altitudeHelper.position.copy(position);\n      this.altitudeHelper.position.y = 0;\n      this.raycastSphere.position.copy(position);\n\n      if (this.cones[0]) {\n        for (var i in this.cones) {\n          this.setAudioPosition(this.cones[i]);\n        }\n      }\n\n      if (this.omniSphere.sound) {\n        this.setAudioPosition(this.omniSphere);\n      }\n    } }, { key: 'updateSpeed', value: function updateSpeed(\n\n    rawSpeed) {\n      if (this.roomCode != null) {\n        this.dbRef.child('objects').child(this.containerObject.name).update({\n          speed: rawSpeed,\n          lastEdit: this.headKey });\n\n      }\n    } }, { key: 'addToScene', value: function addToScene(\n\n    scene) {var pos = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n      if (pos) {\n        this.setPosition(new THREE.Vector3(pos.x, pos.y, pos.z));\n      }\n      scene.add(this.containerObject);\n      if (this.roomCode != null) {\n        this.dbRef.child('objects').child(this.containerObject.name).update({});\n      }\n\n    } }, { key: 'setActive', value: function setActive(\n\n    main) {\n      if (this.trajectory) {\n        this.trajectory.setActive();\n        this.trajectory.setMouseOffset(main.nonScaledMouse, main.mouse);\n      }\n    } }, { key: 'setInactive', value: function setInactive()\n\n    {\n      if (this.trajectory) {\n        this.trajectory.setInactive();\n      }\n    } }, { key: 'changeRadius', value: function changeRadius()\n\n    {var changedVolume = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : false;\n      if (this.omniSphere.sound && this.omniSphere.sound.volume) {\n        var r = 0.5 + 0.5 * this.omniSphere.sound.volume.gain.value;\n        this.omniSphere.scale.x = this.omniSphere.scale.y = this.omniSphere.scale.z = r;\n      } else\n      {\n        this.omniSphere.scale.x = this.omniSphere.scale.y = this.omniSphere.scale.z = 1;\n      }\n      if (changedVolume && this.roomCode != null) {\n        this.dbRef.child('objects').child(this.containerObject.name).update({\n          volume: this.omniSphere.sound.volume.gain.value });\n\n      }\n    } }, { key: 'changeLength', value: function changeLength(\n\n    cone) {\n      var r = cone.sound.spread * 90;\n      var l = cone.sound.volume.gain.value * 50 + 50;\n      cone.sound.panner.coneInnerAngle = Math.atan(r / l) * (180 / Math.PI);\n      cone.sound.panner.coneOuterAngle = cone.sound.panner.coneInnerAngle * 1.5;\n\n      cone.geometry.dynamic = true;\n\n      cone.geometry.dispose();\n      cone.geometry = new THREE.CylinderGeometry(r, 0, l, 100, 1, true);\n      cone.geometry.translate(0, l / 2, 0);\n      cone.geometry.rotateX(Math.PI / 2);\n      var point = new THREE.Vector3();\n\n      // coneRotation = point - this.containerObject.position\n      // returns unit coneRotation vector\n      this.lonLatToVector3(cone.long, cone.lat, point);\n      point.multiplyScalar(500);\n      point.addVectors(point, this.containerObject.position);\n      cone.lookAt(point);\n    } }, { key: 'changeWidth', value: function changeWidth(\n\n    cone) {\n      var r = cone.sound.spread * 90;\n      var l = cone.sound.volume.gain.value * 50 + 50;\n      cone.sound.panner.coneInnerAngle = Math.atan(r / l) * (180 / Math.PI);\n      cone.sound.panner.coneOuterAngle = cone.sound.panner.coneInnerAngle * 3;\n\n      cone.geometry.dynamic = true;\n\n      cone.geometry.dispose();\n      cone.geometry = new THREE.CylinderGeometry(r, 0, l, 100, 1, true);\n      cone.geometry.translate(0, l / 2, 0);\n      cone.geometry.rotateX(Math.PI / 2);\n      var point = new THREE.Vector3();\n\n      // coneRotation = point - this.containerObject.position\n      // returns unit coneRotation vector\n      this.lonLatToVector3(cone.long, cone.lat, point);\n      point.multiplyScalar(500);\n      point.addVectors(point, this.containerObject.position);\n      cone.lookAt(point);\n    }\n\n    // returns a unit vector of the 3d position\n  }, { key: 'lonLatToVector3', value: function lonLatToVector3(lng, lat, out) {\n      // taken from https://gist.github.com/nicoptere/2f2571db4b454bb18cd9\n      out = out || new THREE.Vector3();\n\n      //flips the Y axis\n      lat = Math.PI / 2 - lat;\n\n      //distribute to sphere\n      out.set(\n      Math.sin(lat) * Math.sin(lng),\n      Math.cos(lat),\n      Math.sin(lat) * Math.cos(lng));\n\n      return out;\n    } }, { key: 'pointCone', value: function pointCone(\n\n    cone, point) {\n      var coneRotation = new THREE.Vector3();\n      coneRotation.subVectors(point, this.containerObject.position);\n      cone.lookAt(point);\n      this.setAudioPosition(cone);\n\n      var longlat = function (vector3) {\n        // taken from https://gist.github.com/nicoptere/2f2571db4b454bb18cd9\n        vector3.normalize();\n\n        //longitude = angle of the vector around the Y axis\n        //-( ) : negate to flip the longitude (3d space specific )\n        //- PI / 2 to face the Z axis\n        var lng = -Math.atan2(-vector3.z, -vector3.x) - Math.PI / 2;\n\n        //to bind between -PI / PI\n        if (lng < -Math.PI) lng += Math.PI * 2;\n\n        //latitude : angle between the vector & the vector projected on the XZ plane on a unit sphere\n\n        //project on the XZ plane\n        var p = new THREE.Vector3(vector3.x, 0, vector3.z);\n        //project on the unit sphere\n        p.normalize();\n        var dotProduct = Number(p.dot(vector3)).toFixed(10);\n        //compute the angle ( both vectors are normalized, no division by the sum of lengths )\n        var lat = Math.acos(dotProduct);\n\n        //invert if Y is negative to ensure the latitude is between -PI/2 & PI / 2\n        if (vector3.y < 0) lat *= -1;\n\n        return [lng, lat];\n\n      }(coneRotation);\n      cone.long = longlat[0];\n      cone.lat = longlat[1];\n      return longlat;\n    }\n\n    // Needs to be refactored - also lives in guiwindow\n  }, { key: 'pointConeMagic', value: function pointConeMagic(cone, lat, long) {\n      // adapted from https://gist.github.com/nicoptere/2f2571db4b454bb18cd9\n\n      var v = function lonLatToVector3(lng, lat)\n      {\n        //flips the Y axis\n        lat = Math.PI / 2 - lat;\n\n        //distribute to sphere\n        return new THREE.Vector3(\n        Math.sin(lat) * Math.sin(lng),\n        Math.cos(lat),\n        Math.sin(lat) * Math.cos(lng));\n\n\n      }(long, lat);\n      if (v.x === 0) {v.x = 0.0001;}\n      var point = this.containerObject.position.clone().add(v);\n      this.pointCone(cone, point);\n\n    } }, { key: 'applySoundToCone', value: function applySoundToCone(\n\n    cone, sound) {\n\n      sound.scriptNode.onaudioprocess = function () {\n        var array = new Uint8Array(sound.analyser.frequencyBinCount);\n        sound.analyser.getByteFrequencyData(array);\n        var values = 0;\n        var length = array.length;\n        for (var i = 0; i < length; i++) {values += array[i];}\n        var average = values / length;\n        cone.material.opacity = _helpers2.default.mapRange(average, 50, 100, 0.65, 0.95);\n\n        // Updates current time of playback for audio display\n        if (cone.sound && !cone.sound.state.isAudioPaused && !cone.sound.state.isChangingAudioTime) {\n          var currentTime = (Date.now() - cone.sound.state.startedAt) / 1000;\n          currentTime = currentTime % Math.floor(cone.sound.state.duration);\n          cone.sound.state.currentTime = currentTime;\n        }\n\n      };\n\n      sound.spread = cone.sound.spread;\n      sound.panner.refDistance = cone.sound.panner.refDistance;\n      sound.panner.distanceModel = cone.sound.panner.distanceModel;\n      sound.panner.coneInnerAngle = cone.sound.panner.coneInnerAngle;\n      sound.panner.coneOuterAngle = cone.sound.panner.coneOuterAngle;\n      sound.panner.coneOuterGain = cone.sound.panner.coneOuterGain;\n      sound.volume.gain.value = cone.sound.volume.gain.value;\n      cone.sound = sound;\n\n    } }, { key: 'removeCone', value: function removeCone(\n\n    cone) {\n      var i = this.cones.indexOf(cone);\n      // coneSounds are not removed as part of undo/redo restoration\n      if (cone.sound && !cone.sound.state.isAudioPaused) {\n        this.stopConeSound(cone);\n      }\n      cone.sound.source.disconnect(cone.sound.scriptNode);\n      cone.sound.scriptNode.disconnect(this.audio.context.destination);\n\n      var previousState = cone.sound.state;\n      var savedState = new Object();\n      var savedState = Object.assign(savedState, previousState);\n\n      this.coneSounds[cone.uuid].state = savedState;\n      cone.sound.state.clear();\n      cone.sound = null;\n      this.cones.splice(i, 1);\n      this.containerObject.remove(cone);\n      this.gui.removeCone(cone);\n      if (this.cones.length - 1 >= 0) {\n        this.app.interactiveCone = this.cones[this.cones.length - 1];\n      } else {\n        this.app.interactiveCone = null;\n      }\n      if (this.roomCode != null) {\n        this.dbRef.child('objects').child(this.containerObject.name).child('cones').child(cone.uuid).remove();\n      }\n    } }, { key: 'removeFromScene', value: function removeFromScene(\n\n    scene) {\n      scene.remove(this.containerObject, true);\n      scene.remove(this.altitudeHelper, true);\n      scene.remove(this.axisHelper, true);\n      scene.remove(this.trajectory, true);\n      for (var i in this.cones) {\n        this.cones[i].sound.source.stop();\n      }\n      if (this.omniSphere.sound && this.omniSphere.sound.source) {\n        this.stopSound();\n        this.prevOmniSphereSound = new Object();\n        this.prevOmniSphereSound = Object.assign(this.prevOmniSphereSound, this.omniSphere.sound);\n      }\n      if (this.roomCode != null) {\n        // can this remove sounds from storage\n        this.stoRef.child('soundObjects').child(this.containerObject.name).listAll().\n        then(function (res) {\n          res.items.forEach(function (itemRef) {\n            console.log(itemRef.location._path);\n          });\n          res.prefixes.forEach(function (folderRef) {\n            console.log(folderRef);\n          });\n        });\n        this.dbRef.child('objects').child(this.containerObject.name).remove();\n      }\n    } }, { key: 'restoreToScene', value: function restoreToScene(\n\n    scene) {var _this2 = this;\n      scene.add(this.containerObject);\n      scene.add(this.altitudeHelper);\n      scene.add(this.axisHelper);\n      if (this.trajectory) {\n        scene.add(this.trajectory);\n      }var _loop = function _loop(\n\n      i) {\n        _this2.loadSound(_this2.cones[i].file, _this2.audio, _this2.isMuted, _this2.cones[i]).then(function (sound) {\n          _this2.applySoundToCone(_this2.cones[i], sound);\n          _this2.setAudioPosition(_this2.cones[i]);\n          _this2.app.interactiveCone = _this2.cones[i];\n        });};for (var i in this.cones) {_loop(i);\n      }\n\n      if (this.file) {\n        var materialColor = this.userSetPlay ? 0xFFFFFF : 0x8F8F8F;\n        this.omniSphere.material.color.setHex(materialColor);\n\n        this.loadSound(this.file, this.audio, this.app.isMuted, this, this.prevOmniSphereSound).then(function (sound) {\n          _this2.omniSphere.sound = sound;\n          _this2.omniSphere.sound.name = _this2.prevOmniSphereSound.name;\n          _this2.omniSphere.sound.volume.gain.value = _this2.prevOmniSphereSound.volume.gain.value;\n          _this2.setAudioPosition(_this2.omniSphere);\n\n          if (!_this2.userSetPlay) {\n            _this2.stopSound();\n          }\n        });\n      }\n\n    } }, { key: 'restoreConeToScene', value: function restoreConeToScene(\n\n    cone, soundIn) {var _this3 = this;\n      soundIn.source.connect(soundIn.scriptNode);\n      soundIn.scriptNode.connect(this.audio.context.destination);\n      soundIn.source.connect(soundIn.volume);\n      cone.sound = soundIn;\n\n      var materialColor = cone.userSetPlay ? cone.baseColor.getHex() : 0x8F8F8F;\n      cone.material.color.setHex(materialColor);\n\n      this.cones.push(cone);\n      this.loadSound(cone.file, this.audio, this.isMuted, cone, soundIn).then(function (sound) {\n        cone.sound = sound;\n        cone.sound.spread = soundIn.spread;\n        cone.sound.volume.gain.value = soundIn.volume.gain.value;\n\n        _this3.changeLength(cone);\n        _this3.changeWidth(cone);\n        _this3.pointConeMagic(cone, cone.lat, cone.long);\n\n        _this3.applySoundToCone(_this3.cones[_this3.cones.length - 1], sound);\n        _this3.setAudioPosition(_this3.cones[_this3.cones.length - 1]);\n        _this3.app.interactiveCone = _this3.cones[_this3.cones.length - 1];\n\n        if (!cone.userSetPlay) {\n          _this3.stopConeSound(cone);\n        }\n\n      });\n\n      this.app.setActiveObject(this);\n      this.containerObject.add(cone);\n      this.gui.addCone(cone);\n      this.gui.show(this);\n    } }, { key: 'copyObject', value: function copyObject(\n\n    object, position) {var _this4 = this;\n      this.containerObject.position.copy(position);\n      this.altitudeHelper.position.copy(position);\n      this.raycastSphere.position.copy(position);\n      this.axisHelper.position.copy(position);\n\n      // Copy sound object\n      if (object.omniSphere.sound) {\n        this.loadSound(object.file, this.audio, this.app.isMuted, this).then(function (sound) {\n          _this4.omniSphere.sound = sound;\n          _this4.omniSphere.sound.name = object.omniSphere.sound.name;\n          _this4.omniSphere.sound.volume.gain.value = object.omniSphere.sound.volume.gain.value;\n          if (object.omniSphere.sound.state.isAudioPaused) {\n            _this4.stopSound();\n          }\n          _this4.userSetPlay = object.userSetPlay;\n          _this4.setAudioPosition(_this4.omniSphere);\n        });\n      }\n      this.omniSphere.material.color.setHex(object.omniSphere.material.color.getHex());\n\n      // Copy cones on sound object\n      object.cones.forEach(function (c) {\n        var cone = void 0;\n        if (c.file) {\n          _this4.loadSound(c.file, _this4.audio, false).then(function (sound) {\n            cone = _this4.createCone(sound, c.color);\n            cone.file = c.file;\n            cone.filename = c.filename;\n            cone.sound.volume.gain.value = c.sound.volume.gain.value;\n            cone.sound.spread = c.sound.spread;\n            if (c.sound.state.isAudioPaused) {\n              _this4.stopConeSound(cone);\n              cone.material.color.setHex(0x8F8F8F);\n            } else\n            {\n              cone.material.color.setHex(cone.baseColor.getHex());\n            }\n            cone.userSetPlay = c.userSetPlay;\n            cone.lat = c.lat;\n            cone.long = c.long;\n            _this4.changeLength(cone);\n            _this4.changeWidth(cone);\n            _this4.containerObject.add(cone);\n            _this4.gui.addCone(cone);\n            _this4.coneSounds[cone.uuid] = cone.sound;\n            _this4.pointConeMagic(cone, c.lat, c.long);\n            _this4.app.undoableActionStack.push(new _action2.default(_this4, 'addCone'));\n            _this4.app.undoableActionStack[_this4.app.undoableActionStack.length - 1].secondary = cone;\n          });\n        }\n      });\n\n      this.movementSpeed = object.movementSpeed;\n    } }, { key: 'copyOmnisphereSound', value: function copyOmnisphereSound(\n\n    file, volume, init) {var _this5 = this;var isPlaying = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : true;\n      this.loadSound(file, this.audio, this.app.isMuted, this, null, true).then(function (sound) {\n        _this5.omniSphere.sound = sound;\n        _this5.omniSphere.sound.name = file.name;\n        _this5.omniSphere.sound.volume.gain.value = volume;\n        _this5.setAudioPosition(_this5.omniSphere);\n        _this5.changeRadius();\n        if (!isPlaying || !_this5.app.isPlaying) {\n          _this5.stopSound();\n          _this5.userSetPlay = false;\n        } else {\n          _this5.userSetPlay = true;\n        }\n        _this5.isAddingSound = false;\n\n        // if(init && this.audio.context.state === \"suspended\"){\n        //   this.audio.context.resume();\n        // }\n      });\n    } }, { key: 'copyConeSound', value: function copyConeSound(\n\n    file, volume, lat, long, spread, uuid) {var _this6 = this;var isPlaying = arguments.length > 6 && arguments[6] !== undefined ? arguments[6] : true;var doesExist = arguments.length > 7 && arguments[7] !== undefined ? arguments[7] : false;\n      this.loadSound(file, this.audio, this.app.isMuted, this, null, true).then(function (sound) {\n        if (!doesExist) {\n          if (_this6.objConeCache[uuid]) {\n            volume = _this6.objConeCache[uuid].volume;\n            spread = _this6.objConeCache[uuid].spread;\n            lat = _this6.objConeCache[uuid].latitude;\n            long = _this6.objConeCache[uuid].longitude;\n            _this6.objConeCache[uuid] = {};\n          }\n          var numConesPrior = _this6.cones.length;\n          var cone = _this6.createCone(sound, null);\n          cone.file = file;\n          cone.filename = file.name;\n          cone.sound.volume.gain.value = volume;\n          cone.sound.spread = spread;\n          if (!isPlaying || !_this6.app.isPlaying) {\n            _this6.stopConeSound(cone);\n            cone.material.color.setHex(0x8F8F8F);\n            cone.userSetPlay = false;\n          } else\n          {\n            cone.material.color.setHex(cone.baseColor.getHex());\n            cone.userSetPlay = true;\n          }\n          cone.lat = lat;\n          cone.long = long;\n          _this6.changeLength(cone);\n          _this6.changeWidth(cone);\n          cone.uuid = uuid;\n          console.log(\"adding cone to gui, 1002\");\n          var addButton = document.getElementById('add-cone');\n          if (addButton) {\n            console.log(addButton.style.position, addButton.style.top);\n            if (_this6.app.isEditingObject) {\n              addButton.style.top = \"167.5px\";\n            } else {\n              addButton.style.top = \"228.51px\";\n            }\n            // 5%\n            addButton.firstChild.style.padding = '1.5% 8px';\n          }\n          _this6.gui.addCone(cone, false);\n          if (numConesPrior == 0) {\n            _this6.app.interactiveCone = cone;\n          }\n          _this6.coneSounds[cone.uuid] = cone.sound;\n          _this6.pointConeMagic(cone, lat, long);\n        } else {\n          var index = _this6.cones.findIndex(function (cone) {return cone.uuid == uuid;});\n          _this6.applySoundToCone(_this6.cones[index], sound);\n          _this6.setAudioPosition(_this6.cones[index]);\n        }\n      });\n    } }, { key: 'disconnectSound', value: function disconnectSound()\n\n    {\n      if (!this.omniSphere.sound.state.isAudioPaused) {\n        this.omniSphere.sound.source.stop();\n      }\n      this.omniSphere.sound.source.disconnect(this.omniSphere.sound.scriptNode);\n      this.omniSphere.sound.scriptNode.disconnect(this.audio.context.destination);\n      this.omniSphere.sound.state.clear();\n\n      var materialColor = this.app.isPlaying ? 0xFFFFFF : 0x8F8F8F;\n      this.omniSphere.material.color.setHex(materialColor);\n      this.omniSphere.material.opacity = 0.8;\n      this.omniSphere.sound = null;\n      this.changeRadius();\n      this.filename = null;\n    } }, { key: 'pause', value: function pause()\n    {\n      this.isPaused = true;\n    } }, { key: 'unpause', value: function unpause()\n    {\n      this.isPaused = false;\n    } }, { key: 'mute', value: function mute(\n\n    main) {\n      this.isMuted = true;\n      this.checkMuteState(main);\n    } }, { key: 'unmute', value: function unmute(\n    main) {\n      this.isMuted = false;\n      this.checkMuteState(main);\n    } }, { key: 'turnVisible', value: function turnVisible()\n\n    {\n      this.containerObject.visible = true;\n      this.axisHelper.visible = true;\n      this.altitudeHelper.visible = true;\n    } }, { key: 'turnInvisible', value: function turnInvisible()\n\n    {\n      this.containerObject.visible = false;\n      this.axisHelper.visible = false;\n      this.altitudeHelper.visible = false;\n    } }, { key: 'checkMuteState', value: function checkMuteState(\n\n    main) {\n      if (this.isMuted) {\n        this.cones.forEach(function (cone) {return cone.sound.mainMixer.gain.value = 0;});\n        if (this.omniSphere.sound && this.omniSphere.sound.mainMixer) {\n          this.omniSphere.sound.mainMixer.gain.value = 0;\n        }\n      } else\n      {\n        this.cones.forEach(function (cone) {return cone.sound.mainMixer.gain.value = 1;});\n        if (this.omniSphere.sound && this.omniSphere.sound.mainMixer) {\n          this.omniSphere.sound.mainMixer.gain.value = 1;\n        }\n      }\n    } }, { key: 'checkPlayState', value: function checkPlayState(\n\n    main) {var _this7 = this;\n      if (main.isPlaying) {// play\n        if (this.omniSphere.sound && this.omniSphere.sound.state.isAudioPaused) {\n          this.playSound(true);\n          this.userSetPlay = true;\n        }\n        //   else {\n        //     if(this.roomCode){\n        //         this.updatePlayStatus(null)\n        //     }\n        //   }\n        this.cones.forEach(function (cone) {\n          if (cone.sound.state.isAudioPaused) {\n            _this7.playConeSound(cone, true);\n            cone.userSetPlay = true;\n\n          }\n          cone.material.color.setHex(cone.baseColor.getHex());\n        });\n\n        this.omniSphere.material.color.setHex(0xFFFFFF);\n      } else\n      {// pause\n        this.cones.forEach(function (cone) {\n          if (!cone.sound.state.isAudioPaused) {\n\n            // this should also update firebase details with this user as the last editor\n            _this7.stopConeSound(cone, true);\n            cone.userSetPlay = false;\n          }\n\n          cone.material.color.setHex(0x8F8F8F);\n        });\n        if (this.omniSphere.sound && !this.omniSphere.sound.state.isAudioPaused) {\n          this.stopSound(true);\n          this.userSetPlay = false;\n        }\n        //   else {\n        //     if(this.roomCode){\n        //         this.updatePlayStatus(false);\n        //     }\n        //   }\n        this.omniSphere.material.color.setHex(0x8F8F8F);\n\n      }\n    } }, { key: 'toggleAppearance', value: function toggleAppearance(\n\n    main) {\n      if (main.isPlaying) {\n        this.omniSphere.material.color.setHex(0xFFFFFF);\n        this.cones.forEach(function (cone) {\n          cone.material.color.setHex(cone.baseColor.getHex());\n        });\n      } else {\n        this.omniSphere.material.color.setHex(0x8F8F8F);\n        this.cones.forEach(function (cone) {\n          cone.material.color.setHex(0x8F8F8F);\n        });\n      }\n    } }, { key: 'followTrajectory', value: function followTrajectory(\n\n    play) {\n      if (this.trajectory && !this.isPaused && !this.isMuted && play) {\n        this.trajectoryClock -= this.movementDirection * this.movementIncrement;\n\n        if (this.trajectoryClock >= 1) {\n          if (this.trajectory.spline.closed) {\n            this.trajectoryClock = 0;\n          } else {\n            this.movementDirection = -this.movementDirection;\n            this.trajectoryClock = 1;\n          }\n        }\n\n        if (this.trajectoryClock < 0) {\n          if (this.trajectory.spline.closed) {\n            this.trajectoryClock = 1;\n          } else {\n            this.movementDirection = -this.movementDirection;\n            this.trajectoryClock = 0;\n          }\n        }\n\n        var pointOnTrajectory = this.trajectory.spline.getPointAt(this.trajectoryClock);\n        this.containerObject.position.copy(pointOnTrajectory);\n        this.raycastSphere.position.copy(pointOnTrajectory);\n        this.altitudeHelper.position.copy(pointOnTrajectory);\n        this.axisHelper.position.copy(pointOnTrajectory);\n        this.altitudeHelper.position.y = 0;\n\n        if (this.trajectory == null && this.roomCode != null) {\n          this.dbRef.child('objects').child(this.containerObject.name).update({\n            position: pointOnTrajectory,\n            lastEdit: this.app.headKey.key });\n\n        }\n\n        if (this.cones[0]) {\n          for (var i in this.cones) {\n            this.setAudioPosition(this.cones[i]);\n          }\n        }\n        if (this.omniSphere.sound) {\n          this.setAudioPosition(this.omniSphere);\n        }\n      }\n    } }, { key: 'calculateMovementSpeed', value: function calculateMovementSpeed()\n\n    {\n      if (this.trajectory) {\n        this.movementIncrement = this.movementSpeed / this.trajectory.spline.getLength(10);\n      }\n    } }, { key: 'toJSON', value: function toJSON()\n\n    {\n      return JSON.stringify({\n        filename: this.omniSphere.sound && this.omniSphere.sound && this.omniSphere.sound.name || null,\n        volume: this.omniSphere && this.omniSphere.sound && this.omniSphere.sound.volume.gain.value || null,\n        position: this.containerObject.position,\n        movementSpeed: this.movementSpeed,\n        trajectory: this.trajectory && this.trajectory.points || null,\n        cones: this.cones.map(function (c) {\n          return {\n            file: c.file,\n            filename: c.filename,\n            position: {\n              lat: c.lat,\n              long: c.long },\n\n            volume: c.sound.volume.gain.value,\n            spread: c.sound.spread,\n            color: c.randGreen };\n\n        }) });\n\n    } }, { key: 'fromJSON', value: function fromJSON(\n\n    json, importedData) {var _this8 = this;\n      var object = JSON.parse(json);\n      this.containerObject.position.copy(object.position);\n      this.altitudeHelper.position.copy(object.position);\n      this.raycastSphere.position.copy(object.position);\n      this.axisHelper.position.copy(object.position);\n\n      if (object.filename && object.volume) {\n        var file = importedData[object.filename];\n        if (file) {\n          this.loadSound(file, this.audio, false, this).then(function (sound) {\n            _this8.omniSphere.sound = sound;\n            _this8.omniSphere.sound.name = object.filename;\n            _this8.omniSphere.sound.volume.gain.value = object.volume;\n            _this8.setAudioPosition(_this8.omniSphere);\n          });\n        }\n      }\n\n      object.cones.forEach(function (c) {\n        var cone = void 0;\n        var file = importedData[c.filename];\n        if (file) {\n          _this8.loadSound(file, _this8.audio, false).then(function (sound) {\n            cone = _this8.createCone(sound, c.color);\n            cone.file = file;\n            cone.filename = c.filename;\n            cone.sound.volume.gain.value = c.volume;\n            cone.sound.spread = c.spread;\n            cone.lat = c.position.lat;\n            cone.long = c.position.long;\n            _this8.changeLength(cone);\n            _this8.changeWidth(cone);\n            _this8.gui.addCone(cone);\n            _this8.pointConeMagic(cone, c.position.lat, c.position.long);\n            var self = _this8;\n            if (_this8.roomCode) {\n              var upload = _this8.stoRef.child('soundObjects/' + _this8.containerObject.name + '/' + cone.uuid + '/' + c.filename).put(file);\n              console.log(\"uploading cone sound\");\n              upload.on('state_changed', function (snapshot) {\n                var progress = snapshot.bytesTransferred / snapshot.totalBytes * 100;\n                console.log('Upload is ' + progress + '% done');\n              }, function (error) {\n                console.log('Problem uploading file');\n              }, function () {\n                self.dbRef.child('objects').child(self.containerObject.name).child('cones').child(cone.uuid).update({\n                  type: \"cone\",\n                  parent: self.containerObject.name,\n                  uuid: cone.uuid,\n                  sound: cone.filename,\n                  volume: c.volume,\n                  spread: c.spread,\n                  longitude: cone.long,\n                  latitude: cone.lat,\n                  lastEdit: self.headKey,\n                  isPlaying: !cone.sound.state.isAudioPaused });\n\n              });\n            }\n          });\n        }\n      });\n\n      this.movementSpeed = object.movementSpeed;\n      if (this.roomCode) {\n        var updates = {\n          \"position\": object.position };\n\n        this.dbRef.child('objects').child(this.containerObject.name).update(updates);\n\n      }\n    } }]);return SoundObject;}();exports.default = SoundObject;\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/js/app/components/soundobject.js\n// module id = 4\n// module chunks = 0\n\n//# sourceURL=webpack:///./src/js/app/components/soundobject.js?");

/***/ }),
/* 5 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("Object.defineProperty(exports, \"__esModule\", { value: true });var _three = __webpack_require__(0);var THREE = _interopRequireWildcard(_three);\nvar _soundobject = __webpack_require__(4);var _soundobject2 = _interopRequireDefault(_soundobject);\nvar _soundtrajectory = __webpack_require__(15);var _soundtrajectory2 = _interopRequireDefault(_soundtrajectory);\nvar _soundzone = __webpack_require__(7);var _soundzone2 = _interopRequireDefault(_soundzone);function _interopRequireDefault(obj) {return obj && obj.__esModule ? obj : { default: obj };}function _interopRequireWildcard(obj) {if (obj && obj.__esModule) {return obj;} else {var newObj = {};if (obj != null) {for (var key in obj) {if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key];}}newObj.default = obj;return newObj;}}function _classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError(\"Cannot call a class as a function\");}}var\n\nAction =\nfunction Action(object1, type) {_classCallCheck(this, Action);\n    this.mainObject = object1;\n    this.actionType = type;\n    this.cone;\n    this.secondary;\n};exports.default = Action;\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/js/app/model/action.js\n// module id = 5\n// module chunks = 0\n\n//# sourceURL=webpack:///./src/js/app/model/action.js?");

/***/ }),
/* 6 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("var _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) {return typeof obj;} : function (obj) {return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;};\n\nObject.defineProperty(exports, '__esModule', { value: true });\n\nvar tslib = __webpack_require__(3);\nvar util = __webpack_require__(9);\nvar component = __webpack_require__(8);\nvar logger$1 = __webpack_require__(11);\n\n/**\r\n                                             * @license\r\n                                             * Copyright 2019 Google LLC\r\n                                             *\r\n                                             * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n                                             * you may not use this file except in compliance with the License.\r\n                                             * You may obtain a copy of the License at\r\n                                             *\r\n                                             *   http://www.apache.org/licenses/LICENSE-2.0\r\n                                             *\r\n                                             * Unless required by applicable law or agreed to in writing, software\r\n                                             * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n                                             * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n                                             * See the License for the specific language governing permissions and\r\n                                             * limitations under the License.\r\n                                             */\nvar _a;\nvar ERRORS = (_a = {},\n_a[\"no-app\" /* NO_APP */] = \"No Firebase App '{$appName}' has been created - \" +\n'call Firebase App.initializeApp()',\n_a[\"bad-app-name\" /* BAD_APP_NAME */] = \"Illegal App name: '{$appName}\",\n_a[\"duplicate-app\" /* DUPLICATE_APP */] = \"Firebase App named '{$appName}' already exists\",\n_a[\"app-deleted\" /* APP_DELETED */] = \"Firebase App named '{$appName}' already deleted\",\n_a[\"invalid-app-argument\" /* INVALID_APP_ARGUMENT */] = 'firebase.{$appName}() takes either no argument or a ' +\n'Firebase App instance.',\n_a[\"invalid-log-argument\" /* INVALID_LOG_ARGUMENT */] = 'First argument to `onLog` must be null or a function.',\n_a);\nvar ERROR_FACTORY = new util.ErrorFactory('app', 'Firebase', ERRORS);\n\nvar name$1 = \"@firebase/app\";\nvar version = \"0.6.11\";\n\nvar name$2 = \"@firebase/analytics\";\n\nvar name$3 = \"@firebase/auth\";\n\nvar name$4 = \"@firebase/database\";\n\nvar name$5 = \"@firebase/functions\";\n\nvar name$6 = \"@firebase/installations\";\n\nvar name$7 = \"@firebase/messaging\";\n\nvar name$8 = \"@firebase/performance\";\n\nvar name$9 = \"@firebase/remote-config\";\n\nvar name$a = \"@firebase/storage\";\n\nvar name$b = \"@firebase/firestore\";\n\nvar name$c = \"firebase-wrapper\";\n\n/**\r\n                                  * @license\r\n                                  * Copyright 2019 Google LLC\r\n                                  *\r\n                                  * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n                                  * you may not use this file except in compliance with the License.\r\n                                  * You may obtain a copy of the License at\r\n                                  *\r\n                                  *   http://www.apache.org/licenses/LICENSE-2.0\r\n                                  *\r\n                                  * Unless required by applicable law or agreed to in writing, software\r\n                                  * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n                                  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n                                  * See the License for the specific language governing permissions and\r\n                                  * limitations under the License.\r\n                                  */\nvar _a$1;\nvar DEFAULT_ENTRY_NAME = '[DEFAULT]';\nvar PLATFORM_LOG_STRING = (_a$1 = {},\n_a$1[name$1] = 'fire-core',\n_a$1[name$2] = 'fire-analytics',\n_a$1[name$3] = 'fire-auth',\n_a$1[name$4] = 'fire-rtdb',\n_a$1[name$5] = 'fire-fn',\n_a$1[name$6] = 'fire-iid',\n_a$1[name$7] = 'fire-fcm',\n_a$1[name$8] = 'fire-perf',\n_a$1[name$9] = 'fire-rc',\n_a$1[name$a] = 'fire-gcs',\n_a$1[name$b] = 'fire-fst',\n_a$1['fire-js'] = 'fire-js',\n_a$1[name$c] = 'fire-js-all',\n_a$1);\n\n/**\r\n        * @license\r\n        * Copyright 2019 Google LLC\r\n        *\r\n        * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n        * you may not use this file except in compliance with the License.\r\n        * You may obtain a copy of the License at\r\n        *\r\n        *   http://www.apache.org/licenses/LICENSE-2.0\r\n        *\r\n        * Unless required by applicable law or agreed to in writing, software\r\n        * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n        * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n        * See the License for the specific language governing permissions and\r\n        * limitations under the License.\r\n        */\nvar logger = new logger$1.Logger('@firebase/app');\n\n/**\r\n                                                    * @license\r\n                                                    * Copyright 2017 Google LLC\r\n                                                    *\r\n                                                    * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n                                                    * you may not use this file except in compliance with the License.\r\n                                                    * You may obtain a copy of the License at\r\n                                                    *\r\n                                                    *   http://www.apache.org/licenses/LICENSE-2.0\r\n                                                    *\r\n                                                    * Unless required by applicable law or agreed to in writing, software\r\n                                                    * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n                                                    * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n                                                    * See the License for the specific language governing permissions and\r\n                                                    * limitations under the License.\r\n                                                    */\n/**\r\n                                                        * Global context object for a collection of services using\r\n                                                        * a shared authentication state.\r\n                                                        */\nvar FirebaseAppImpl = /** @class */function () {\n    function FirebaseAppImpl(options, config, firebase_) {\n        var e_1, _a;\n        var _this = this;\n        this.firebase_ = firebase_;\n        this.isDeleted_ = false;\n        this.name_ = config.name;\n        this.automaticDataCollectionEnabled_ =\n        config.automaticDataCollectionEnabled || false;\n        this.options_ = util.deepCopy(options);\n        this.container = new component.ComponentContainer(config.name);\n        // add itself to container\n        this._addComponent(new component.Component('app', function () {return _this;}, \"PUBLIC\" /* PUBLIC */));\n        try {\n            // populate ComponentContainer with existing components\n            for (var _b = tslib.__values(this.firebase_.INTERNAL.components.values()), _c = _b.next(); !_c.done; _c = _b.next()) {\n                var component$1 = _c.value;\n                this._addComponent(component$1);\n            }\n        }\n        catch (e_1_1) {e_1 = { error: e_1_1 };} finally\n        {\n            try {\n                if (_c && !_c.done && (_a = _b.return)) _a.call(_b);\n            } finally\n            {if (e_1) throw e_1.error;}\n        }\n    }\n    Object.defineProperty(FirebaseAppImpl.prototype, \"automaticDataCollectionEnabled\", {\n        get: function get() {\n            this.checkDestroyed_();\n            return this.automaticDataCollectionEnabled_;\n        },\n        set: function set(val) {\n            this.checkDestroyed_();\n            this.automaticDataCollectionEnabled_ = val;\n        },\n        enumerable: false,\n        configurable: true });\n\n    Object.defineProperty(FirebaseAppImpl.prototype, \"name\", {\n        get: function get() {\n            this.checkDestroyed_();\n            return this.name_;\n        },\n        enumerable: false,\n        configurable: true });\n\n    Object.defineProperty(FirebaseAppImpl.prototype, \"options\", {\n        get: function get() {\n            this.checkDestroyed_();\n            return this.options_;\n        },\n        enumerable: false,\n        configurable: true });\n\n    FirebaseAppImpl.prototype.delete = function () {\n        var _this = this;\n        return new Promise(function (resolve) {\n            _this.checkDestroyed_();\n            resolve();\n        }).\n        then(function () {\n            _this.firebase_.INTERNAL.removeApp(_this.name_);\n            return Promise.all(_this.container.getProviders().map(function (provider) {return provider.delete();}));\n        }).\n        then(function () {\n            _this.isDeleted_ = true;\n        });\n    };\n    /**\r\n        * Return a service instance associated with this app (creating it\r\n        * on demand), identified by the passed instanceIdentifier.\r\n        *\r\n        * NOTE: Currently storage and functions are the only ones that are leveraging this\r\n        * functionality. They invoke it by calling:\r\n        *\r\n        * ```javascript\r\n        * firebase.app().storage('STORAGE BUCKET ID')\r\n        * ```\r\n        *\r\n        * The service name is passed to this already\r\n        * @internal\r\n        */\n    FirebaseAppImpl.prototype._getService = function (name, instanceIdentifier) {\n        if (instanceIdentifier === void 0) {instanceIdentifier = DEFAULT_ENTRY_NAME;}\n        this.checkDestroyed_();\n        // getImmediate will always succeed because _getService is only called for registered components.\n        return this.container.getProvider(name).getImmediate({\n            identifier: instanceIdentifier });\n\n    };\n    /**\r\n        * Remove a service instance from the cache, so we will create a new instance for this service\r\n        * when people try to get this service again.\r\n        *\r\n        * NOTE: currently only firestore is using this functionality to support firestore shutdown.\r\n        *\r\n        * @param name The service name\r\n        * @param instanceIdentifier instance identifier in case multiple instances are allowed\r\n        * @internal\r\n        */\n    FirebaseAppImpl.prototype._removeServiceInstance = function (name, instanceIdentifier) {\n        if (instanceIdentifier === void 0) {instanceIdentifier = DEFAULT_ENTRY_NAME;}\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        this.container.getProvider(name).clearInstance(instanceIdentifier);\n    };\n    /**\r\n        * @param component the component being added to this app's container\r\n        */\n    FirebaseAppImpl.prototype._addComponent = function (component) {\n        try {\n            this.container.addComponent(component);\n        }\n        catch (e) {\n            logger.debug(\"Component \" + component.name + \" failed to register with FirebaseApp \" + this.name, e);\n        }\n    };\n    FirebaseAppImpl.prototype._addOrOverwriteComponent = function (component) {\n        this.container.addOrOverwriteComponent(component);\n    };\n    /**\r\n        * This function will throw an Error if the App has already been deleted -\r\n        * use before performing API actions on the App.\r\n        */\n    FirebaseAppImpl.prototype.checkDestroyed_ = function () {\n        if (this.isDeleted_) {\n            throw ERROR_FACTORY.create(\"app-deleted\" /* APP_DELETED */, { appName: this.name_ });\n        }\n    };\n    return FirebaseAppImpl;\n}();\n// Prevent dead-code elimination of these methods w/o invalid property\n// copying.\nFirebaseAppImpl.prototype.name && FirebaseAppImpl.prototype.options ||\nFirebaseAppImpl.prototype.delete ||\nconsole.log('dc');\n\nvar version$1 = \"7.20.0\";\n\n/**\r\n                           * @license\r\n                           * Copyright 2019 Google LLC\r\n                           *\r\n                           * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n                           * you may not use this file except in compliance with the License.\r\n                           * You may obtain a copy of the License at\r\n                           *\r\n                           *   http://www.apache.org/licenses/LICENSE-2.0\r\n                           *\r\n                           * Unless required by applicable law or agreed to in writing, software\r\n                           * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n                           * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n                           * See the License for the specific language governing permissions and\r\n                           * limitations under the License.\r\n                           */\n/**\r\n                               * Because auth can't share code with other components, we attach the utility functions\r\n                               * in an internal namespace to share code.\r\n                               * This function return a firebase namespace object without\r\n                               * any utility functions, so it can be shared between the regular firebaseNamespace and\r\n                               * the lite version.\r\n                               */\nfunction createFirebaseNamespaceCore(firebaseAppImpl) {\n    var apps = {};\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    var components = new Map();\n    // A namespace is a plain JavaScript Object.\n    var namespace = {\n        // Hack to prevent Babel from modifying the object returned\n        // as the firebase namespace.\n        // @ts-ignore\n        __esModule: true,\n        initializeApp: initializeApp,\n        // @ts-ignore\n        app: app,\n        registerVersion: registerVersion,\n        setLogLevel: logger$1.setLogLevel,\n        onLog: onLog,\n        // @ts-ignore\n        apps: null,\n        SDK_VERSION: version$1,\n        INTERNAL: {\n            registerComponent: registerComponent,\n            removeApp: removeApp,\n            components: components,\n            useAsService: useAsService } };\n\n\n    // Inject a circular default export to allow Babel users who were previously\n    // using:\n    //\n    //   import firebase from 'firebase';\n    //   which becomes: var firebase = require('firebase').default;\n    //\n    // instead of\n    //\n    //   import * as firebase from 'firebase';\n    //   which becomes: var firebase = require('firebase');\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    namespace['default'] = namespace;\n    // firebase.apps is a read-only getter.\n    Object.defineProperty(namespace, 'apps', {\n        get: getApps });\n\n    /**\r\n                          * Called by App.delete() - but before any services associated with the App\r\n                          * are deleted.\r\n                          */\n    function removeApp(name) {\n        delete apps[name];\n    }\n    /**\r\n       * Get the App object for a given name (or DEFAULT).\r\n       */\n    function app(name) {\n        name = name || DEFAULT_ENTRY_NAME;\n        if (!util.contains(apps, name)) {\n            throw ERROR_FACTORY.create(\"no-app\" /* NO_APP */, { appName: name });\n        }\n        return apps[name];\n    }\n    // @ts-ignore\n    app['App'] = firebaseAppImpl;\n    function initializeApp(options, rawConfig) {\n        if (rawConfig === void 0) {rawConfig = {};}\n        if ((typeof rawConfig === 'undefined' ? 'undefined' : _typeof(rawConfig)) !== 'object' || rawConfig === null) {\n            var name_1 = rawConfig;\n            rawConfig = { name: name_1 };\n        }\n        var config = rawConfig;\n        if (config.name === undefined) {\n            config.name = DEFAULT_ENTRY_NAME;\n        }\n        var name = config.name;\n        if (typeof name !== 'string' || !name) {\n            throw ERROR_FACTORY.create(\"bad-app-name\" /* BAD_APP_NAME */, {\n                appName: String(name) });\n\n        }\n        if (util.contains(apps, name)) {\n            throw ERROR_FACTORY.create(\"duplicate-app\" /* DUPLICATE_APP */, { appName: name });\n        }\n        var app = new firebaseAppImpl(options, config, namespace);\n        apps[name] = app;\n        return app;\n    }\n    /*\r\n       * Return an array of all the non-deleted FirebaseApps.\r\n       */\n    function getApps() {\n        // Make a copy so caller cannot mutate the apps list.\n        return Object.keys(apps).map(function (name) {return apps[name];});\n    }\n    function registerComponent(component) {\n        var e_1, _a;\n        var componentName = component.name;\n        if (components.has(componentName)) {\n            logger.debug(\"There were multiple attempts to register component \" + componentName + \".\");\n            return component.type === \"PUBLIC\" /* PUBLIC */ ?\n            // eslint-disable-next-line @typescript-eslint/no-explicit-any\n            namespace[componentName] :\n            null;\n        }\n        components.set(componentName, component);\n        // create service namespace for public components\n        if (component.type === \"PUBLIC\" /* PUBLIC */) {\n                // The Service namespace is an accessor function ...\n                var serviceNamespace = function serviceNamespace(appArg) {\n                    if (appArg === void 0) {appArg = app();}\n                    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n                    if (typeof appArg[componentName] !== 'function') {\n                        // Invalid argument.\n                        // This happens in the following case: firebase.storage('gs:/')\n                        throw ERROR_FACTORY.create(\"invalid-app-argument\" /* INVALID_APP_ARGUMENT */, {\n                            appName: componentName });\n\n                    }\n                    // Forward service instance lookup to the FirebaseApp.\n                    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n                    return appArg[componentName]();\n                };\n                // ... and a container for service-level properties.\n                if (component.serviceProps !== undefined) {\n                    util.deepExtend(serviceNamespace, component.serviceProps);\n                }\n                // eslint-disable-next-line @typescript-eslint/no-explicit-any\n                namespace[componentName] = serviceNamespace;\n                // Patch the FirebaseAppImpl prototype\n                // eslint-disable-next-line @typescript-eslint/no-explicit-any\n                firebaseAppImpl.prototype[componentName] =\n                // TODO: The eslint disable can be removed and the 'ignoreRestArgs'\n                // option added to the no-explicit-any rule when ESlint releases it.\n                // eslint-disable-next-line @typescript-eslint/no-explicit-any\n                function () {\n                    var args = [];\n                    for (var _i = 0; _i < arguments.length; _i++) {\n                        args[_i] = arguments[_i];\n                    }\n                    var serviceFxn = this._getService.bind(this, componentName);\n                    return serviceFxn.apply(this, component.multipleInstances ? args : []);\n                };\n            }\n        try {\n            // add the component to existing app instances\n            for (var _b = tslib.__values(Object.keys(apps)), _c = _b.next(); !_c.done; _c = _b.next()) {\n                var appName = _c.value;\n                apps[appName]._addComponent(component);\n            }\n        }\n        catch (e_1_1) {e_1 = { error: e_1_1 };} finally\n        {\n            try {\n                if (_c && !_c.done && (_a = _b.return)) _a.call(_b);\n            } finally\n            {if (e_1) throw e_1.error;}\n        }\n        return component.type === \"PUBLIC\" /* PUBLIC */ ?\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        namespace[componentName] :\n        null;\n    }\n    function registerVersion(libraryKeyOrName, version, variant) {\n        var _a;\n        // TODO: We can use this check to whitelist strings when/if we set up\n        // a good whitelist system.\n        var library = (_a = PLATFORM_LOG_STRING[libraryKeyOrName]) !== null && _a !== void 0 ? _a : libraryKeyOrName;\n        if (variant) {\n            library += \"-\" + variant;\n        }\n        var libraryMismatch = library.match(/\\s|\\//);\n        var versionMismatch = version.match(/\\s|\\//);\n        if (libraryMismatch || versionMismatch) {\n            var warning = [\n            \"Unable to register library \\\"\" + library + \"\\\" with version \\\"\" + version + \"\\\":\"];\n\n            if (libraryMismatch) {\n                warning.push(\"library name \\\"\" + library + \"\\\" contains illegal characters (whitespace or \\\"/\\\")\");\n            }\n            if (libraryMismatch && versionMismatch) {\n                warning.push('and');\n            }\n            if (versionMismatch) {\n                warning.push(\"version name \\\"\" + version + \"\\\" contains illegal characters (whitespace or \\\"/\\\")\");\n            }\n            logger.warn(warning.join(' '));\n            return;\n        }\n        registerComponent(new component.Component(library + \"-version\", function () {return { library: library, version: version };}, \"VERSION\" /* VERSION */));\n    }\n    function onLog(logCallback, options) {\n        if (logCallback !== null && typeof logCallback !== 'function') {\n            throw ERROR_FACTORY.create(\"invalid-log-argument\" /* INVALID_LOG_ARGUMENT */, {\n                appName: name });\n\n        }\n        logger$1.setUserLogHandler(logCallback, options);\n    }\n    // Map the requested service to a registered service name\n    // (used to map auth to serverAuth service when needed).\n    function useAsService(app, name) {\n        if (name === 'serverAuth') {\n            return null;\n        }\n        var useService = name;\n        return useService;\n    }\n    return namespace;\n}\n\n/**\r\n   * @license\r\n   * Copyright 2019 Google LLC\r\n   *\r\n   * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n   * you may not use this file except in compliance with the License.\r\n   * You may obtain a copy of the License at\r\n   *\r\n   *   http://www.apache.org/licenses/LICENSE-2.0\r\n   *\r\n   * Unless required by applicable law or agreed to in writing, software\r\n   * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n   * See the License for the specific language governing permissions and\r\n   * limitations under the License.\r\n   */\n/**\r\n       * Return a firebase namespace object.\r\n       *\r\n       * In production, this will be called exactly once and the result\r\n       * assigned to the 'firebase' global.  It may be called multiple times\r\n       * in unit tests.\r\n       */\nfunction createFirebaseNamespace() {\n    var namespace = createFirebaseNamespaceCore(FirebaseAppImpl);\n    namespace.INTERNAL = tslib.__assign(tslib.__assign({}, namespace.INTERNAL), { createFirebaseNamespace: createFirebaseNamespace,\n        extendNamespace: extendNamespace,\n        createSubscribe: util.createSubscribe,\n        ErrorFactory: util.ErrorFactory,\n        deepExtend: util.deepExtend });\n    /**\r\n                                         * Patch the top-level firebase namespace with additional properties.\r\n                                         *\r\n                                         * firebase.INTERNAL.extendNamespace()\r\n                                         */\n    function extendNamespace(props) {\n        util.deepExtend(namespace, props);\n    }\n    return namespace;\n}\nvar firebase = createFirebaseNamespace();\n\n/**\r\n                                           * @license\r\n                                           * Copyright 2019 Google LLC\r\n                                           *\r\n                                           * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n                                           * you may not use this file except in compliance with the License.\r\n                                           * You may obtain a copy of the License at\r\n                                           *\r\n                                           *   http://www.apache.org/licenses/LICENSE-2.0\r\n                                           *\r\n                                           * Unless required by applicable law or agreed to in writing, software\r\n                                           * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n                                           * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n                                           * See the License for the specific language governing permissions and\r\n                                           * limitations under the License.\r\n                                           */\nvar PlatformLoggerService = /** @class */function () {\n    function PlatformLoggerService(container) {\n        this.container = container;\n    }\n    // In initial implementation, this will be called by installations on\n    // auth token refresh, and installations will send this string.\n    PlatformLoggerService.prototype.getPlatformInfoString = function () {\n        var providers = this.container.getProviders();\n        // Loop through providers and get library/version pairs from any that are\n        // version components.\n        return providers.\n        map(function (provider) {\n            if (isVersionServiceProvider(provider)) {\n                var service = provider.getImmediate();\n                return service.library + \"/\" + service.version;\n            } else\n            {\n                return null;\n            }\n        }).\n        filter(function (logString) {return logString;}).\n        join(' ');\n    };\n    return PlatformLoggerService;\n}();\n/**\r\n      *\r\n      * @param provider check if this provider provides a VersionService\r\n      *\r\n      * NOTE: Using Provider<'app-version'> is a hack to indicate that the provider\r\n      * provides VersionService. The provider is not necessarily a 'app-version'\r\n      * provider.\r\n      */\nfunction isVersionServiceProvider(provider) {\n    var component = provider.getComponent();\n    return (component === null || component === void 0 ? void 0 : component.type) === \"VERSION\" /* VERSION */;\n}\n\n/**\r\n   * @license\r\n   * Copyright 2019 Google LLC\r\n   *\r\n   * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n   * you may not use this file except in compliance with the License.\r\n   * You may obtain a copy of the License at\r\n   *\r\n   *   http://www.apache.org/licenses/LICENSE-2.0\r\n   *\r\n   * Unless required by applicable law or agreed to in writing, software\r\n   * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n   * See the License for the specific language governing permissions and\r\n   * limitations under the License.\r\n   */\nfunction registerCoreComponents(firebase, variant) {\n    firebase.INTERNAL.registerComponent(new component.Component('platform-logger', function (container) {return new PlatformLoggerService(container);}, \"PRIVATE\" /* PRIVATE */));\n    // Register `app` package.\n    firebase.registerVersion(name$1, version, variant);\n    // Register platform SDK identifier (no version).\n    firebase.registerVersion('fire-js', '');\n}\n\n/**\r\n   * @license\r\n   * Copyright 2017 Google LLC\r\n   *\r\n   * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n   * you may not use this file except in compliance with the License.\r\n   * You may obtain a copy of the License at\r\n   *\r\n   *   http://www.apache.org/licenses/LICENSE-2.0\r\n   *\r\n   * Unless required by applicable law or agreed to in writing, software\r\n   * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n   * See the License for the specific language governing permissions and\r\n   * limitations under the License.\r\n   */\n// Firebase Lite detection test\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nif (util.isBrowser() && self.firebase !== undefined) {\n    logger.warn(\"\\n    Warning: Firebase is already defined in the global scope. Please make sure\\n    Firebase library is only loaded once.\\n  \");\n    // eslint-disable-next-line\n    var sdkVersion = self.firebase.SDK_VERSION;\n    if (sdkVersion && sdkVersion.indexOf('LITE') >= 0) {\n        logger.warn(\"\\n    Warning: You are trying to load Firebase while using Firebase Performance standalone script.\\n    You should load Firebase Performance with this instance of Firebase to avoid loading duplicate code.\\n    \");\n    }\n}\nvar initializeApp = firebase.initializeApp;\n// TODO: This disable can be removed and the 'ignoreRestArgs' option added to\n// the no-explicit-any rule when ESlint releases it.\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nfirebase.initializeApp = function () {\n    var args = [];\n    for (var _i = 0; _i < arguments.length; _i++) {\n        args[_i] = arguments[_i];\n    }\n    // Environment check before initializing app\n    // Do the check in initializeApp, so people have a chance to disable it by setting logLevel\n    // in @firebase/logger\n    if (util.isNode()) {\n        logger.warn(\"\\n      Warning: This is a browser-targeted Firebase bundle but it appears it is being\\n      run in a Node environment.  If running in a Node environment, make sure you\\n      are using the bundle specified by the \\\"main\\\" field in package.json.\\n      \\n      If you are using Webpack, you can specify \\\"main\\\" as the first item in\\n      \\\"resolve.mainFields\\\":\\n      https://webpack.js.org/configuration/resolve/#resolvemainfields\\n      \\n      If using Rollup, use the rollup-plugin-node-resolve plugin and specify \\\"main\\\"\\n      as the first item in \\\"mainFields\\\", e.g. ['main', 'module'].\\n      https://github.com/rollup/rollup-plugin-node-resolve\\n      \");\n    }\n    return initializeApp.apply(undefined, args);\n};\nvar firebase$1 = firebase;\nregisterCoreComponents(firebase$1);\n\nexports.default = firebase$1;\nexports.firebase = firebase$1;\n//# sourceMappingURL=index.cjs.js.map\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/@firebase/app/dist/index.cjs.js\n// module id = 6\n// module chunks = 0\n\n//# sourceURL=webpack:///./~/@firebase/app/dist/index.cjs.js?");

/***/ }),
/* 7 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("Object.defineProperty(exports, \"__esModule\", { value: true });var _createClass = function () {function defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if (\"value\" in descriptor) descriptor.writable = true;Object.defineProperty(target, descriptor.key, descriptor);}}return function (Constructor, protoProps, staticProps) {if (protoProps) defineProperties(Constructor.prototype, protoProps);if (staticProps) defineProperties(Constructor, staticProps);return Constructor;};}();var _three = __webpack_require__(0);var THREE = _interopRequireWildcard(_three);\n__webpack_require__(10);\nvar _helpers = __webpack_require__(2);var _helpers2 = _interopRequireDefault(_helpers);function _interopRequireDefault(obj) {return obj && obj.__esModule ? obj : { default: obj };}function _interopRequireWildcard(obj) {if (obj && obj.__esModule) {return obj;} else {var newObj = {};if (obj != null) {for (var key in obj) {if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key];}}newObj.default = obj;return newObj;}}function _classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError(\"Cannot call a class as a function\");}}var\n\nSoundZone = function () {\n  function SoundZone(main, points) {var copyZone = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;_classCallCheck(this, SoundZone);\n    this.type = 'SoundZone';\n    this.isActive = true;\n    this.audio = main.audio;\n    this.app = main;\n\n    this.stoRef = main.stoRef;\n    this.dbRef = main.dbRef;\n    this.roomCode = main.roomCode;\n\n    this.mouse = main.mouse;\n    this.scene = main.scene;\n\n    this.points = points;\n    this.splinePoints = points;\n\n    this.pointObjects;\n    this.spline;\n    this.shape;\n\n    this.sound = null;\n    this.prevSound = null;\n    this.file = null;\n    this.filename = null;\n\n    this.zoneScale = 1;\n    this.isMuted = main.isMuted;\n    this.loaded = false;\n    this.isPlaying = false;\n    this.isChangingAudioTime = false;\n    this.selectedPoint;\n    this.mouseOffsetX = 0, this.mouseOffsetY = 0;\n    this.volume = null;\n    this.isInZone = false;\n    this.userSetPlay = this.app.isPlaying;\n    this.isAddingSound = false;\n    this.cache = {};\n    this.oldVolume = -1;\n\n    this.containerObject = new THREE.Group();\n    this.cursor = new THREE.Mesh(\n    new THREE.SphereGeometry(15),\n    new THREE.MeshBasicMaterial({\n      color: 0xff1169,\n      transparent: true,\n      opacity: 0.5 }));\n\n\n    this.cursor.visible = false;\n    this.containerObject.add(this.cursor);\n\n    this.isInitialized = false;\n\n    this.renderPath();\n    if (this.roomCode != null) {\n      this.headKey = main.headKey.key;\n      this.zoneKey = this.dbRef.child('zones').push();\n      this.containerObject.name = this.zoneKey.key;\n    }\n    if (copyZone) {\n      this.containerObject.name = copyZone;\n    }\n  }_createClass(SoundZone, [{ key: 'updateFirebaseDetails', value: function updateFirebaseDetails(\n\n    dbRef, stoRef, headKey, roomCode) {\n      this.headKey = headKey.key;\n      this.stoRef = stoRef;\n      this.dbRef = dbRef;\n      this.roomCode = roomCode;\n      var zoneKey = this.dbRef.child('zones').push();\n      this.containerObject.name = zoneKey.key;\n      zoneKey.set({\n        position: this.containerObject.position,\n        type: this.type,\n        zone: this.splinePoints,\n        sound: null,\n        volume: this.volume,\n        scale: this.zoneScale,\n        rotation: this.containerObject.rotation.y,\n        lastEdit: this.headKey });\n\n\n      if (this.file) {\n        this.uploadFirebaseSound(this.file);\n      }\n    } }, { key: 'underUser', value: function underUser(\n\n    audio) {\n      if (this.sound && this.loaded && this.userSetPlay) {\n        // Starts playing if user is in zone, sound is not yet playing, and global play is on\n        if (!this.isInZone && this.isPlaying) {\n          this.sound.source.stop();\n          this.sound.state.pausedAt = (Date.now() - this.sound.state.startedAt) % (Math.floor(this.sound.state.duration) * 1000);\n          this.isPlaying = false;\n        }\n        if (!this.isPlaying) {\n          this.sound.source = audio.context.createBufferSource();\n          this.sound.source.buffer = this.sound.buffer;\n          this.sound.source.loop = true;\n          this.sound.source.volume = audio.context.createGain();\n          this.sound.source.volume.gain.value = this.volume;\n          this.sound.source.connect(this.sound.source.volume);\n          this.sound.source.volume.connect(this.sound.volume);\n          var resumeTime = this.sound.state.pausedAt;\n          this.sound.state.isAudioPaused = false;\n          resumeTime /= 1000;\n          this.sound.state.startedAt = Date.now() - this.sound.state.pausedAt;\n          this.sound.source.start(audio.context.currentTime, resumeTime);\n          this.sound.volume.gain.setTargetAtTime(1.0, audio.context.currentTime + 0.1, 0.1);\n        }\n        this.isPlaying = true;\n      } else\n      if (this.sound && this.isPlaying && this.loaded && !this.userSetPlay) {\n        // Stops playing if user is in zone, sound is playing, and global pause is on or users pauses sound\n        this.stopSound();\n      }\n      this.isInZone = true;\n    } }, { key: 'notUnderUser', value: function notUnderUser(\n\n    audio) {var isRender = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n      if (this.sound && this.loaded && this.isPlaying) {\n        this.sound.volume.gain.setTargetAtTime(0.0, audio.context.currentTime, 0.1);\n        this.sound.source.stop(audio.context.currentTime + 0.1);\n        if (!isRender) {\n          this.sound.state.pausedAt = (Date.now() - this.sound.state.startedAt) % (Math.floor(this.sound.state.duration) * 1000);\n          this.sound.state.isAudioPaused = true;\n          this.isPlaying = false;\n          // sound is still running but is not audibly heard\n        }\n      }\n      this.isInZone = false;\n    }\n\n    // remove sound file\n  }, { key: 'clear', value: function clear() {\n      // stop audio stream if currently playing\n      if (this.isPlaying) {\n        this.sound.source.stop();\n      }\n      if (this.sound && this.sound.state) {\n        this.sound.state.clear();\n        this.volume = null;\n      }\n      this.isPlaying = false;\n      this.loaded = false;\n      this.mainMixer = null;\n      this.sound = null;\n    } }, { key: 'uploadFirebaseSound', value: function uploadFirebaseSound(\n\n    file) {\n      var id = this.containerObject.name;\n      var tempDbRef = this.dbRef;\n      var headKey = this.headKey;\n      var audioState = this.sound != null ? !this.sound.state.isAudioPaused : this.app.isPlaying;\n      this.isAddingSound = true;\n      var self = this;\n      console.log(\"uploading sound to firebase\", headKey, this.headKey);\n      var upload = this.stoRef.child('zones' + '/' + id + '/' + file.name).put(file);\n      upload.on('state_changed', function (snapshot) {\n        var progress = snapshot.bytesTransferred / snapshot.totalBytes * 100;\n        console.log('Upload is ' + progress + '% done');\n      }, function (error) {\n        console.log('Problem uploading file');\n      }, function () {\n        var properties = {\n          prev: self.cache.hasOwnProperty('prev') ? self.cache.prev : null };\n\n        tempDbRef.child('zones').child(id).update({\n          sound: file.name,\n          volume: self.sound == null ? 1 : self.volume,\n          lastEdit: headKey,\n          isPlaying: audioState,\n          scale: self.zoneScale,\n          rotation: self.containerObject.rotation.y,\n          prev: properties.prev });\n\n        self.isAddingSound = false;\n        self.cache = {};\n\n      });\n    } }, { key: 'loadSound', value: function loadSound(\n\n    file, audio, mute) {var copy = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : false;\n      var context = audio.context;\n      var reader = new FileReader();\n\n      this.filename = file.name;\n      this.file = file;\n      this.volume = 0.5;\n      var that = this;\n\n      console.log(\"loading \", file.name);\n      if (!copy && this.roomCode != null) {\n        this.uploadFirebaseSound(file);\n      }\n      var promise = new Promise(function (resolve, reject) {\n        reader.onload = function (ev) {\n          context.decodeAudioData(ev.target.result, function (decodedData) {\n            that.clear();\n            if (that.sound == null) {\n              that.sound = {};\n\n              that.sound.state = {};\n              that.sound.state.startedAt = Date.now();\n              that.sound.state.pausedAt = 0;\n              that.sound.state.currentTime = 0;\n              that.sound.state.isAudioPaused = false;\n              that.sound.state.duration = 0;\n\n              that.sound.state.clear = function () {\n                that.sound.state.startedAt = that.sound.state.pausedAt = that.sound.state.currentTime = that.sound.state.duration = 0;\n                that.sound.state.isAudioPaused = true;\n              };\n\n\n              that.sound.name = file.name;\n              that.sound.source = context.createBufferSource();\n              that.sound.source.buffer = decodedData;\n              that.mainMixer = context.createGain();\n              that.sound.volume = context.createGain();\n              that.sound.source.volume = context.createGain();\n              that.sound.source.connect(that.sound.source.volume);\n              that.sound.source.volume.connect(that.sound.volume);\n              that.sound.volume.connect(that.mainMixer);\n              that.mainMixer.connect(audio.destination);\n              that.mainMixer.gain.value = mute ? 0 : 1;\n              that.sound.volume.gain.value = that.volume;\n              that.sound.buffer = decodedData;\n              that.sound.state.duration = that.sound.buffer.duration;\n              that.loaded = true;\n              resolve(that.sound);\n            };\n          });\n        };\n        reader.readAsArrayBuffer(file);\n      });\n\n      return promise;\n    } }, { key: 'playSound', value: function playSound()\n\n    {var userToggled = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : false;\n      if (this.sound && this.sound.state) {\n        this.sound.state.startedAt = Date.now() - this.sound.state.pausedAt;\n        this.sound.state.isAudioPaused = false;\n\n        this.shape.material.color.setHex(0xFF1169);\n        if (userToggled && this.roomCode != null) {\n          this.updatePlayStatus(true);\n        }\n      }\n    } }, { key: 'stopSound', value: function stopSound()\n\n    {var userToggled = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : false;\n      var t = this.sound && this.sound.state;\n      if (this.sound && this.sound.state) {\n        this.sound.state.pausedAt = (Date.now() - this.sound.state.startedAt) % (Math.floor(this.sound.state.duration) * 1000);\n        this.sound.state.isAudioPaused = true;\n        this.shape.material.color.setHex(0x8F8F8F);\n\n        // TODO: investigate this wrt flickering\n        this.notUnderUser(this.audio);\n        if (userToggled && this.roomCode != null) {\n          this.updatePlayStatus(false);\n        }\n      }\n    } }, { key: 'renderPath', value: function renderPath(\n\n    args) {var _this = this;\n      // splinePoints control the curve of the path\n      var points = this.splinePoints;\n      // setup\n      var sphere = new THREE.SphereGeometry(10);\n      var sphereMat = new THREE.MeshBasicMaterial({ color: 0xff1169 });\n\n      var collider = new THREE.SphereGeometry(15);\n      var colliderMat = new THREE.MeshBasicMaterial({\n        color: 0xff1169,\n        transparent: true,\n        opacity: 0,\n        depthWrite: false });\n\n\n      var colliderMesh = new THREE.Mesh(collider, colliderMat);\n\n      if (!this.isInitialized) {\n        this.pointObjects = [];\n        // place a meshgroup at each point in array\n        points.forEach(function (point) {\n          var sphereMesh = new THREE.Mesh(sphere, sphereMat.clone());\n          var group = new THREE.Object3D();\n\n          group.add(sphereMesh, colliderMesh.clone());\n          group.position.copy(point);\n\n          _this.pointObjects.push(group);\n        });\n        this.splinePoints = this.pointObjects.map(function (pt) {return pt.position;});\n      } else\n      if (args != null && args.updateType) {\n        if (args.updateType === \"delete\") {\n          var splicedPoint = this.pointObjects.splice(args.index, 1);\n          this.containerObject.remove(splicedPoint[0], true);\n        } else\n        if (args.updateType === \"add\") {\n          var insertedPoint = new THREE.Object3D();\n          insertedPoint.add(\n          new THREE.Mesh(sphere, sphereMat.clone()),\n          colliderMesh.clone());\n\n          insertedPoint.position.copy(this.splinePoints[args.index]);\n          this.pointObjects.splice(args.index, 0, insertedPoint);\n          this.containerObject.add(insertedPoint);\n        }\n        this.splinePoints = this.pointObjects.map(function (pt) {return pt.position;});\n      }\n      this.spline = new THREE.CatmullRomCurve3(this.splinePoints);\n      this.spline.type = 'centripetal';\n      this.spline.closed = true;\n\n      var geometry = new THREE.BufferGeometry().setFromPoints(this.spline.getPoints(200));\n      var material = new THREE.LineBasicMaterial({\n        color: 0xff1169,\n        linewidth: 5,\n        transparent: true,\n        opacity: 0.4 });\n\n\n      this.spline.mesh = new THREE.Line(geometry, material);\n\n      // fill the path\n      var rotatedPoints = this.spline.getPoints(200);\n      rotatedPoints.forEach(function (vertex) {\n        vertex.y = vertex.z;\n        vertex.z = 0.0;\n      });\n      //const shapeFill = new THREE.Shape(rotatedPoints);\n      var shapeFill = new THREE.Shape(rotatedPoints);\n      // shapeFill.fromPoints(rotatedPoints);\n      var shapeGeometry = new THREE.ShapeGeometry(shapeFill);\n      shapeGeometry.rotateX(Math.PI / 2);\n\n      var opacityIntensity = this.volume;\n      if (!this.volume) {\n        opacityIntensity = 0.5;\n      }\n\n      var materialColor = this.userSetPlay ? 0xFF1169 : 0x8F8F8F;\n      material = new THREE.MeshLambertMaterial({\n        color: materialColor,\n        transparent: true,\n        opacity: _helpers2.default.mapRange(opacityIntensity, 0, 2, 0.05, 0.35),\n        side: THREE.BackSide,\n        premultipliedAlpha: true });\n\n      this.shape = new THREE.Mesh(shapeGeometry, material);\n    } }, { key: 'addToScene', value: function addToScene(\n\n\n\n\n\n    scene) {var _this2 = this;var pos = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n      if (!this.isInitialized) {\n        this.isInitialized = true;\n        var box = new THREE.Box3().setFromObject(this.shape);\n        box.getCenter(this.containerObject.position);\n        scene.add(this.containerObject);\n        this.objects.forEach(function (obj) {\n          obj.translateX(-_this2.containerObject.position.x);\n          obj.translateZ(-_this2.containerObject.position.z);\n          _this2.containerObject.add(obj);\n        });\n\n        if (!pos && this.roomCode != null) {\n          this.zoneKey.set({\n            position: this.containerObject.position,\n            type: this.type,\n            zone: this.splinePoints,\n            sound: null,\n            volume: null,\n            scale: 1,\n            rotation: this.containerObject.rotation.y,\n            lastEdit: this.headKey });\n\n        } else if (pos) {\n          this.containerObject.position.copy(\n          new THREE.Vector3(pos.x, pos.y, pos.z));\n\n        }\n\n      } else\n      {\n        if (pos) {\n          this.containerObject.position.copy(\n          new THREE.Vector3(pos.x, pos.y, pos.z));\n\n        }\n        this.containerObject.add(this.shape);\n        this.containerObject.add(this.spline.mesh);\n      }\n    } }, { key: 'removeFromScene', value: function removeFromScene(\n\n    scene) {\n      if (this.sound) {\n        this.prevSound = new Object();\n        Object.assign(this.prevSound, this.sound);\n      }\n      scene.remove(this.containerObject, true);\n      if (this.roomCode != null) {\n        this.dbRef.child('zones').child(this.containerObject.name).remove();\n      }\n    } }, { key: 'restoreToScene', value: function restoreToScene(\n\n    scene) {\n      this.sound = this.prevSound;\n      this.scene.add(this.containerObject);\n    } }, { key: 'updateZoneScale', value: function updateZoneScale(\n\n    prevScale) {var delayUpdate = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n      for (var i = 0; i < this.splinePoints.length; i++) {\n        this.splinePoints[i].x = this.splinePoints[i].x / prevScale * this.zoneScale;\n        this.splinePoints[i].z = this.splinePoints[i].z / prevScale * this.zoneScale;\n      }\n      if (!delayUpdate) {\n        this.updateZone({ updateType: 'update' });\n      }\n    } }, { key: 'updatePointObjects', value: function updatePointObjects()\n\n    {var point = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : null;\n      if (point) {\n\n      } else {\n        for (var i = 0; i < this.splinePoints.length; ++i) {\n          this.pointObjects[i].position.x = this.splinePoints[i].x;\n          this.pointObjects[i].position.z = this.splinePoints[i].z;\n        }\n      }\n    } }, { key: 'copyObject', value: function copyObject(\n\n    object, position) {\n      this.containerObject.position.copy(position);\n      this.containerObject.rotation.y = object.containerObject.rotation.y;\n      this.zoneScale = object.zoneScale;\n\n      if (object.file) {\n        this.loadSound(object.file, this.audio, this.app.isMuted);\n        var volume = Math.max(Math.min(object.volume, 2), 0.0);\n        this.shape.material.opacity = _helpers2.default.mapRange(volume, 0, 2, 0.05, 0.35);\n\n        this.volume = volume;\n        if (this.sound && this.sound.source) {\n          this.sound.source.volume.gain.value = volume;\n          // this.sound.source.volume = volume;\n          this.sound.volume.gain.value = volume;\n        }\n\n        this.userSetPlay = object.userSetPlay;\n        if (object.sound.state.isAudioPaused) {\n          this.stopSound();\n        }\n      }\n      //this.app.soundZones.push(object);\n\n    } }, { key: 'copySound', value: function copySound(\n\n    file, volume) {var _this3 = this;var isPlaying = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : true;var setVolume = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : true;\n      this.loadSound(file, this.audio, this.app.isMuted, true).then(function () {\n        if (setVolume) {\n          _this3.volume = Math.max(Math.min(volume, 2), 0.0);\n        }\n\n        if (!isPlaying || !_this3.app.isPlaying) {\n          _this3.stopSound();\n          _this3.userSetPlay = false;\n        } else {\n          _this3.userSetPlay = true;\n        }\n        _this3.isAddingSound = false;\n        // if(init && this.audio.context.state === \"suspended\"){\n        //   this.audio.context.resume();\n        // }\n      });\n    }\n\n    // raycast to this soundzone\n  }, { key: 'isUnderMouse', value: function isUnderMouse(raycaster) {\n      if (this.isActive) {\n        return raycaster.intersectObjects(this.objects).length > 0;\n      }\n\n      return raycaster.intersectObject(this.shape).length > 0;\n    } }, { key: 'objectUnderMouse', value: function objectUnderMouse(\n\n    raycaster) {\n      var intersects = raycaster.intersectObjects(this.objects, true);\n      if (intersects.length > 0) {\n        if (intersects[0].object.type === 'Line' || intersects[0].object === this.shape) {\n          return intersects[Math.floor(intersects.length / 2)];\n        }\n\n        return intersects[0];\n      }\n\n      return null;\n    } }, { key: 'hideCursor', value: function hideCursor()\n\n    {\n      this.cursor.visible = false;\n    } }, { key: 'showCursor', value: function showCursor(\n\n    object, point) {\n      if (object !== this.shape) {\n        this.cursor.visible = true;\n        if (object === this.spline.mesh) {\n          var minv = new THREE.Matrix4();\n          minv.copy(this.containerObject.matrix);\n          minv.invert();\n          this.cursor.position.copy(point.applyMatrix4(minv));\n        } else\n        {\n          this.cursor.position.copy(object.parent.position);\n        }\n      } else\n      {\n        this.hideCursor();\n      }\n    } }, { key: 'setMouseOffset', value: function setMouseOffset(\n\n    point) {\n      this.mouseOffsetX = point.x;\n      this.mouseOffsetY = point.z;\n    } }, { key: 'updateZone', value: function updateZone()\n\n    {var args = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : null;var copy = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n      var scene = this.spline.mesh.parent;\n      this.containerObject.remove(this.spline.mesh, true);\n      this.containerObject.remove(this.shape, true);\n      this.renderPath(args);\n      this.addToScene(scene);\n      if (!copy && this.roomCode != null) {\n        this.dbRef.child('zones').child(this.containerObject.name).update({\n          zone: this.splinePoints,\n          lastEdit: this.headKey });\n\n      }\n    } }, { key: 'move', value: function move(\n\n    main) {\n      // if (!main.perspectiveView) {\n      var dx = main.mouse.x - this.mouseOffsetX;\n      var dy = main.mouse.z - this.mouseOffsetY;\n      this.mouseOffsetX = main.mouse.x;\n      this.mouseOffsetY = main.mouse.z;\n      this.hideCursor();\n\n      if (this.selectedPoint) {\n        // move selected point\n        var minv = new THREE.Matrix4();\n        minv.copy(this.containerObject.matrix);\n        minv.invert();\n        this.selectedPoint.position.copy(main.mouse.applyMatrix4(minv));\n        this.updateZone({ updateType: 'update' });\n      } else {\n        // move entire shape\n        this.containerObject.position.x += dx;\n        this.containerObject.position.z += dy;\n        if (this.roomCode != null) {\n          this.dbRef.child('zones').child(this.containerObject.name).update({\n            position: this.containerObject.position,\n            lastEdit: this.headKey });\n\n        }\n      }\n      // }\n    } }, { key: 'setActive', value: function setActive(\n\n    main) {\n      this.setMouseOffset(main.mouse);\n      this.isActive = true;\n      this.pointObjects.forEach(function (obj) {return obj.visible = true;});\n      this.spline.mesh.visible = true;\n    } }, { key: 'setInactive', value: function setInactive()\n\n    {\n      this.hideCursor();\n      this.deselectPoint();\n      this.isActive = false;\n      this.pointObjects.forEach(function (obj) {return obj.visible = false;});\n      this.spline.mesh.visible = false;\n    } }, { key: 'select', value: function select(\n\n    intersect) {\n      if (!intersect) return;\n\n      // obj can be the curve, a spline point, or the shape mesh\n      var obj = intersect.object;\n\n      if (obj.type === 'Line') {\n        // add a point to the line\n        this.addPoint(intersect.point);\n      } else if (obj.parent.type === 'Object3D') {\n        // select an existing point on line\n        this.selectPoint(obj.parent);\n      } else {\n        this.deselectPoint();\n        this.setMouseOffset(intersect.point);\n      }\n    } }, { key: 'removePoint', value: function removePoint()\n\n    {\n      // find point in array\n      var i = this.pointObjects.indexOf(this.selectedPoint);\n      this.splinePoints.splice(i, 1);\n      this.deselectPoint();\n      this.updateZone({ index: i, updateType: 'delete' });\n    } }, { key: 'addPoint', value: function addPoint(\n\n    point) {\n      var minv = new THREE.Matrix4();\n      minv.copy(this.containerObject.matrix);\n      minv.invert();\n      var position = point.applyMatrix4(minv);\n\n      var closestSplinePoint = 0;\n      var prevDistToSplinePoint = -1;\n      var minDistance = Number.MAX_VALUE;\n      var minPoint = 1;\n\n      // search for point on spline\n      for (var t = 0; t < 1; t += 1 / 200.0) {\n        var pt = this.spline.getPoint(t);\n\n        var distToSplinePoint = this.splinePoints[closestSplinePoint].distanceToSquared(pt);\n        if (distToSplinePoint > prevDistToSplinePoint) {\n          closestSplinePoint += 1;\n\n          if (closestSplinePoint >= this.splinePoints.length) {\n            closestSplinePoint = 0;\n          }\n        }\n        prevDistToSplinePoint = this.splinePoints[closestSplinePoint].distanceToSquared(pt);\n        var distToPoint = pt.distanceToSquared(position);\n        if (distToPoint < minDistance) {\n          minDistance = distToPoint;\n          minPoint = closestSplinePoint;\n        }\n      }\n\n      this.splinePoints.splice(minPoint, 0, position);\n      this.updateZone({ index: minPoint, updateType: 'add' });\n      this.selectPoint(this.pointObjects[minPoint]);\n    } }, { key: 'selectPoint', value: function selectPoint(\n\n    obj) {\n      this.deselectPoint();\n      this.selectedPoint = obj;\n      obj.children[0].material.color.set('blue');\n    } }, { key: 'deselectPoint', value: function deselectPoint()\n\n    {\n      if (this.selectedPoint) {\n        this.selectedPoint.children[0].material.color.set('red');\n        this.selectedPoint = null;\n      }\n    } }, { key: 'mute', value: function mute(\n\n    main) {\n      this.isMuted = true;\n      this.checkMuteState(main);\n    } }, { key: 'unmute', value: function unmute(\n\n    main) {\n      this.isMuted = false;\n      this.checkMuteState(main);\n    } }, { key: 'toggleAppearance', value: function toggleAppearance(\n\n    main) {\n      if (main.isPlaying) {\n        this.shape.material.color.setHex(0xFF1169);\n      } else {\n        this.shape.material.color.setHex(0x8F8F8F);\n      }\n    } }, { key: 'turnInvisible', value: function turnInvisible()\n\n    {\n      this.shape.material.visible = false;\n      this.pointObjects.forEach(function (point) {\n        point.children[0].visible = false;\n      });\n      this.spline.mesh.material.visible = false;\n    } }, { key: 'updatePlayStatus', value: function updatePlayStatus(\n\n    status) {\n      var updates = {};\n      updates['isPlaying'] = status;\n      updates['lastEdit'] = this.headKey;\n      this.dbRef.child('zones').child(this.containerObject.name).update(updates);\n    } }, { key: 'checkPlayState', value: function checkPlayState(\n\n    main) {\n      if (main.isPlaying) {\n        this.shape.material.color.setHex(0xFF1169);\n        if (this.sound && this.sound.state.isAudioPaused) {\n          this.playSound(true);\n          this.userSetPlay = true;\n        }\n      } else\n      {\n        if (this.sound && !this.sound.state.isAudioPaused) {\n          this.stopSound(true);\n          this.userSetPlay = false;\n        }\n        this.shape.material.color.setHex(0x8F8F8F);\n      }\n    } }, { key: 'checkMuteState', value: function checkMuteState(\n\n    main) {\n      if (this.mainMixer) {\n        if (main.isMuted || this.isMuted) {\n          this.mainMixer.gain.value = 0;\n        } else\n        {\n          this.mainMixer.gain.value = 1;\n        }\n      }\n    } }, { key: 'toJSON', value: function toJSON()\n\n    {\n      var object = {\n        position: this.containerObject.position,\n        points: this.splinePoints,\n        filename: this.filename,\n        volume: this.volume };\n\n      return JSON.stringify(object);\n    } }, { key: 'fromJSON', value: function fromJSON(\n\n    json, importedData) {\n      var object = JSON.parse(json);\n      this.containerObject.position.copy(object.position);\n      var file = importedData[object.filename];\n      if (file) {\n        this.loadSound(file, this.audio, false);\n        var volume = Math.max(Math.min(object.volume, 2), 0.0);\n        this.shape.material.opacity = _helpers2.default.mapRange(volume, 0, 2, 0.05, 0.35);\n        this.volume = volume;\n        if (this.sound && this.sound.source) {\n          this.sound.source.volume.gain.value = volume;\n        }\n\n      }\n      if (this.roomCode) {\n\n        var updates = {\n          position: object.position,\n          type: this.type,\n          zone: this.splinePoints,\n          sound: object.filename,\n          volume: this.volume,\n          scale: this.zoneScale,\n          rotation: this.containerObject.rotation.y,\n          lastEdit: this.headKey };\n\n        this.dbRef.child('zones').child(this.containerObject.name).update(updates);\n\n      }\n    } }, { key: 'objects', get: function get() {return [].concat(this.pointObjects, this.spline.mesh, this.shape);} }]);return SoundZone;}();exports.default = SoundZone;\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/js/app/components/soundzone.js\n// module id = 7\n// module chunks = 0\n\n//# sourceURL=webpack:///./src/js/app/components/soundzone.js?");

/***/ }),
/* 8 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, '__esModule', { value: true });\n\nvar tslib = __webpack_require__(3);\nvar util = __webpack_require__(9);\n\n/**\r\n                                       * Component for service name T, e.g. `auth`, `auth-internal`\r\n                                       */\nvar Component = /** @class */function () {\n    /**\r\n                                           *\r\n                                           * @param name The public service name, e.g. app, auth, firestore, database\r\n                                           * @param instanceFactory Service factory responsible for creating the public interface\r\n                                           * @param type whether the service provided by the component is public or private\r\n                                           */\n    function Component(name, instanceFactory, type) {\n        this.name = name;\n        this.instanceFactory = instanceFactory;\n        this.type = type;\n        this.multipleInstances = false;\n        /**\r\n                                         * Properties to be added to the service namespace\r\n                                         */\n        this.serviceProps = {};\n        this.instantiationMode = \"LAZY\" /* LAZY */;\n    }\n    Component.prototype.setInstantiationMode = function (mode) {\n        this.instantiationMode = mode;\n        return this;\n    };\n    Component.prototype.setMultipleInstances = function (multipleInstances) {\n        this.multipleInstances = multipleInstances;\n        return this;\n    };\n    Component.prototype.setServiceProps = function (props) {\n        this.serviceProps = props;\n        return this;\n    };\n    return Component;\n}();\n\n/**\r\n      * @license\r\n      * Copyright 2019 Google LLC\r\n      *\r\n      * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n      * you may not use this file except in compliance with the License.\r\n      * You may obtain a copy of the License at\r\n      *\r\n      *   http://www.apache.org/licenses/LICENSE-2.0\r\n      *\r\n      * Unless required by applicable law or agreed to in writing, software\r\n      * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n      * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n      * See the License for the specific language governing permissions and\r\n      * limitations under the License.\r\n      */\nvar DEFAULT_ENTRY_NAME = '[DEFAULT]';\n\n/**\r\n                                       * @license\r\n                                       * Copyright 2019 Google LLC\r\n                                       *\r\n                                       * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n                                       * you may not use this file except in compliance with the License.\r\n                                       * You may obtain a copy of the License at\r\n                                       *\r\n                                       *   http://www.apache.org/licenses/LICENSE-2.0\r\n                                       *\r\n                                       * Unless required by applicable law or agreed to in writing, software\r\n                                       * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n                                       * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n                                       * See the License for the specific language governing permissions and\r\n                                       * limitations under the License.\r\n                                       */\n/**\r\n                                           * Provider for instance for service name T, e.g. 'auth', 'auth-internal'\r\n                                           * NameServiceMapping[T] is an alias for the type of the instance\r\n                                           */\nvar Provider = /** @class */function () {\n    function Provider(name, container) {\n        this.name = name;\n        this.container = container;\n        this.component = null;\n        this.instances = new Map();\n        this.instancesDeferred = new Map();\n    }\n    /**\r\n       * @param identifier A provider can provide mulitple instances of a service\r\n       * if this.component.multipleInstances is true.\r\n       */\n    Provider.prototype.get = function (identifier) {\n        if (identifier === void 0) {identifier = DEFAULT_ENTRY_NAME;}\n        // if multipleInstances is not supported, use the default name\n        var normalizedIdentifier = this.normalizeInstanceIdentifier(identifier);\n        if (!this.instancesDeferred.has(normalizedIdentifier)) {\n            var deferred = new util.Deferred();\n            this.instancesDeferred.set(normalizedIdentifier, deferred);\n            // If the service instance is available, resolve the promise with it immediately\n            try {\n                var instance = this.getOrInitializeService(normalizedIdentifier);\n                if (instance) {\n                    deferred.resolve(instance);\n                }\n            }\n            catch (e) {\n                // when the instance factory throws an exception during get(), it should not cause\n                // a fatal error. We just return the unresolved promise in this case.\n            }\n        }\n        return this.instancesDeferred.get(normalizedIdentifier).promise;\n    };\n    Provider.prototype.getImmediate = function (options) {\n        var _a = tslib.__assign({ identifier: DEFAULT_ENTRY_NAME, optional: false }, options),identifier = _a.identifier,optional = _a.optional;\n        // if multipleInstances is not supported, use the default name\n        var normalizedIdentifier = this.normalizeInstanceIdentifier(identifier);\n        try {\n            var instance = this.getOrInitializeService(normalizedIdentifier);\n            if (!instance) {\n                if (optional) {\n                    return null;\n                }\n                throw Error(\"Service \" + this.name + \" is not available\");\n            }\n            return instance;\n        }\n        catch (e) {\n            if (optional) {\n                return null;\n            } else\n            {\n                throw e;\n            }\n        }\n    };\n    Provider.prototype.getComponent = function () {\n        return this.component;\n    };\n    Provider.prototype.setComponent = function (component) {\n        var e_1, _a;\n        if (component.name !== this.name) {\n            throw Error(\"Mismatching Component \" + component.name + \" for Provider \" + this.name + \".\");\n        }\n        if (this.component) {\n            throw Error(\"Component for \" + this.name + \" has already been provided\");\n        }\n        this.component = component;\n        // if the service is eager, initialize the default instance\n        if (isComponentEager(component)) {\n            try {\n                this.getOrInitializeService(DEFAULT_ENTRY_NAME);\n            }\n            catch (e) {\n                // when the instance factory for an eager Component throws an exception during the eager\n                // initialization, it should not cause a fatal error.\n                // TODO: Investigate if we need to make it configurable, because some component may want to cause\n                // a fatal error in this case?\n            }\n        }\n        try {\n            // Create service instances for the pending promises and resolve them\n            // NOTE: if this.multipleInstances is false, only the default instance will be created\n            // and all promises with resolve with it regardless of the identifier.\n            for (var _b = tslib.__values(this.instancesDeferred.entries()), _c = _b.next(); !_c.done; _c = _b.next()) {\n                var _d = tslib.__read(_c.value, 2),instanceIdentifier = _d[0],instanceDeferred = _d[1];\n                var normalizedIdentifier = this.normalizeInstanceIdentifier(instanceIdentifier);\n                try {\n                    // `getOrInitializeService()` should always return a valid instance since a component is guaranteed. use ! to make typescript happy.\n                    var instance = this.getOrInitializeService(normalizedIdentifier);\n                    instanceDeferred.resolve(instance);\n                }\n                catch (e) {\n                    // when the instance factory throws an exception, it should not cause\n                    // a fatal error. We just leave the promise unresolved.\n                }\n            }\n        }\n        catch (e_1_1) {e_1 = { error: e_1_1 };} finally\n        {\n            try {\n                if (_c && !_c.done && (_a = _b.return)) _a.call(_b);\n            } finally\n            {if (e_1) throw e_1.error;}\n        }\n    };\n    Provider.prototype.clearInstance = function (identifier) {\n        if (identifier === void 0) {identifier = DEFAULT_ENTRY_NAME;}\n        this.instancesDeferred.delete(identifier);\n        this.instances.delete(identifier);\n    };\n    // app.delete() will call this method on every provider to delete the services\n    // TODO: should we mark the provider as deleted?\n    Provider.prototype.delete = function () {\n        return tslib.__awaiter(this, void 0, void 0, function () {\n            var services;\n            return tslib.__generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        services = Array.from(this.instances.values());\n                        return [4 /*yield*/, Promise.all(tslib.__spread(services.\n                        filter(function (service) {return 'INTERNAL' in service;}) // legacy services\n                        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n                        .map(function (service) {return service.INTERNAL.delete();}), services.\n                        filter(function (service) {return '_delete' in service;}) // modularized services\n                        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n                        .map(function (service) {return service._delete();})))];\n                    case 1:\n                        _a.sent();\n                        return [2 /*return*/];}\n\n            });\n        });\n    };\n    Provider.prototype.isComponentSet = function () {\n        return this.component != null;\n    };\n    Provider.prototype.getOrInitializeService = function (identifier) {\n        var instance = this.instances.get(identifier);\n        if (!instance && this.component) {\n            instance = this.component.instanceFactory(this.container, normalizeIdentifierForFactory(identifier));\n            this.instances.set(identifier, instance);\n        }\n        return instance || null;\n    };\n    Provider.prototype.normalizeInstanceIdentifier = function (identifier) {\n        if (this.component) {\n            return this.component.multipleInstances ? identifier : DEFAULT_ENTRY_NAME;\n        } else\n        {\n            return identifier; // assume multiple instances are supported before the component is provided.\n        }\n    };\n    return Provider;\n}();\n// undefined should be passed to the service factory for the default instance\nfunction normalizeIdentifierForFactory(identifier) {\n    return identifier === DEFAULT_ENTRY_NAME ? undefined : identifier;\n}\nfunction isComponentEager(component) {\n    return component.instantiationMode === \"EAGER\" /* EAGER */;\n}\n\n/**\r\n   * @license\r\n   * Copyright 2019 Google LLC\r\n   *\r\n   * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n   * you may not use this file except in compliance with the License.\r\n   * You may obtain a copy of the License at\r\n   *\r\n   *   http://www.apache.org/licenses/LICENSE-2.0\r\n   *\r\n   * Unless required by applicable law or agreed to in writing, software\r\n   * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n   * See the License for the specific language governing permissions and\r\n   * limitations under the License.\r\n   */\n/**\r\n       * ComponentContainer that provides Providers for service name T, e.g. `auth`, `auth-internal`\r\n       */\nvar ComponentContainer = /** @class */function () {\n    function ComponentContainer(name) {\n        this.name = name;\n        this.providers = new Map();\n    }\n    /**\r\n       *\r\n       * @param component Component being added\r\n       * @param overwrite When a component with the same name has already been registered,\r\n       * if overwrite is true: overwrite the existing component with the new component and create a new\r\n       * provider with the new component. It can be useful in tests where you want to use different mocks\r\n       * for different tests.\r\n       * if overwrite is false: throw an exception\r\n       */\n    ComponentContainer.prototype.addComponent = function (component) {\n        var provider = this.getProvider(component.name);\n        if (provider.isComponentSet()) {\n            throw new Error(\"Component \" + component.name + \" has already been registered with \" + this.name);\n        }\n        provider.setComponent(component);\n    };\n    ComponentContainer.prototype.addOrOverwriteComponent = function (component) {\n        var provider = this.getProvider(component.name);\n        if (provider.isComponentSet()) {\n            // delete the existing provider from the container, so we can register the new component\n            this.providers.delete(component.name);\n        }\n        this.addComponent(component);\n    };\n    /**\r\n        * getProvider provides a type safe interface where it can only be called with a field name\r\n        * present in NameServiceMapping interface.\r\n        *\r\n        * Firebase SDKs providing services should extend NameServiceMapping interface to register\r\n        * themselves.\r\n        */\n    ComponentContainer.prototype.getProvider = function (name) {\n        if (this.providers.has(name)) {\n            return this.providers.get(name);\n        }\n        // create a Provider for a service that hasn't registered with Firebase\n        var provider = new Provider(name, this);\n        this.providers.set(name, provider);\n        return provider;\n    };\n    ComponentContainer.prototype.getProviders = function () {\n        return Array.from(this.providers.values());\n    };\n    return ComponentContainer;\n}();\n\nexports.Component = Component;\nexports.ComponentContainer = ComponentContainer;\nexports.Provider = Provider;\n//# sourceMappingURL=index.cjs.js.map\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/@firebase/component/dist/index.cjs.js\n// module id = 8\n// module chunks = 0\n\n//# sourceURL=webpack:///./~/@firebase/component/dist/index.cjs.js?");

/***/ }),
/* 9 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("/* WEBPACK VAR INJECTION */(function(global) {var _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) {return typeof obj;} : function (obj) {return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;};\n\nObject.defineProperty(exports, '__esModule', { value: true });\n\nvar tslib = __webpack_require__(3);\n\n/**\r\n                               * @license\r\n                               * Copyright 2017 Google LLC\r\n                               *\r\n                               * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n                               * you may not use this file except in compliance with the License.\r\n                               * You may obtain a copy of the License at\r\n                               *\r\n                               *   http://www.apache.org/licenses/LICENSE-2.0\r\n                               *\r\n                               * Unless required by applicable law or agreed to in writing, software\r\n                               * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n                               * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n                               * See the License for the specific language governing permissions and\r\n                               * limitations under the License.\r\n                               */\n/**\r\n                                   * @fileoverview Firebase constants.  Some of these (@defines) can be overridden at compile-time.\r\n                                   */\nvar CONSTANTS = {\n    /**\r\n                   * @define {boolean} Whether this is the client Node.js SDK.\r\n                   */\n    NODE_CLIENT: false,\n    /**\r\n                         * @define {boolean} Whether this is the Admin Node.js SDK.\r\n                         */\n    NODE_ADMIN: false,\n    /**\r\n                        * Firebase SDK Version\r\n                        */\n    SDK_VERSION: '${JSCORE_VERSION}' };\n\n\n/**\r\n                                         * @license\r\n                                         * Copyright 2017 Google LLC\r\n                                         *\r\n                                         * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n                                         * you may not use this file except in compliance with the License.\r\n                                         * You may obtain a copy of the License at\r\n                                         *\r\n                                         *   http://www.apache.org/licenses/LICENSE-2.0\r\n                                         *\r\n                                         * Unless required by applicable law or agreed to in writing, software\r\n                                         * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n                                         * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n                                         * See the License for the specific language governing permissions and\r\n                                         * limitations under the License.\r\n                                         */\n/**\r\n                                             * Throws an error if the provided assertion is falsy\r\n                                             */\nvar assert = function assert(assertion, message) {\n    if (!assertion) {\n        throw assertionError(message);\n    }\n};\n/**\r\n    * Returns an Error object suitable for throwing.\r\n    */\nvar assertionError = function assertionError(message) {\n    return new Error('Firebase Database (' +\n    CONSTANTS.SDK_VERSION +\n    ') INTERNAL ASSERT FAILED: ' +\n    message);\n};\n\n/**\r\n    * @license\r\n    * Copyright 2017 Google LLC\r\n    *\r\n    * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n    * you may not use this file except in compliance with the License.\r\n    * You may obtain a copy of the License at\r\n    *\r\n    *   http://www.apache.org/licenses/LICENSE-2.0\r\n    *\r\n    * Unless required by applicable law or agreed to in writing, software\r\n    * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n    * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n    * See the License for the specific language governing permissions and\r\n    * limitations under the License.\r\n    */\nvar stringToByteArray = function stringToByteArray(str) {\n    // TODO(user): Use native implementations if/when available\n    var out = [];\n    var p = 0;\n    for (var i = 0; i < str.length; i++) {\n        var c = str.charCodeAt(i);\n        if (c < 128) {\n            out[p++] = c;\n        } else\n        if (c < 2048) {\n            out[p++] = c >> 6 | 192;\n            out[p++] = c & 63 | 128;\n        } else\n        if ((c & 0xfc00) === 0xd800 &&\n        i + 1 < str.length &&\n        (str.charCodeAt(i + 1) & 0xfc00) === 0xdc00) {\n            // Surrogate Pair\n            c = 0x10000 + ((c & 0x03ff) << 10) + (str.charCodeAt(++i) & 0x03ff);\n            out[p++] = c >> 18 | 240;\n            out[p++] = c >> 12 & 63 | 128;\n            out[p++] = c >> 6 & 63 | 128;\n            out[p++] = c & 63 | 128;\n        } else\n        {\n            out[p++] = c >> 12 | 224;\n            out[p++] = c >> 6 & 63 | 128;\n            out[p++] = c & 63 | 128;\n        }\n    }\n    return out;\n};\n/**\r\n    * Turns an array of numbers into the string given by the concatenation of the\r\n    * characters to which the numbers correspond.\r\n    * @param bytes Array of numbers representing characters.\r\n    * @return Stringification of the array.\r\n    */\nvar byteArrayToString = function byteArrayToString(bytes) {\n    // TODO(user): Use native implementations if/when available\n    var out = [];\n    var pos = 0,c = 0;\n    while (pos < bytes.length) {\n        var c1 = bytes[pos++];\n        if (c1 < 128) {\n            out[c++] = String.fromCharCode(c1);\n        } else\n        if (c1 > 191 && c1 < 224) {\n            var c2 = bytes[pos++];\n            out[c++] = String.fromCharCode((c1 & 31) << 6 | c2 & 63);\n        } else\n        if (c1 > 239 && c1 < 365) {\n            // Surrogate Pair\n            var c2 = bytes[pos++];\n            var c3 = bytes[pos++];\n            var c4 = bytes[pos++];\n            var u = ((c1 & 7) << 18 | (c2 & 63) << 12 | (c3 & 63) << 6 | c4 & 63) -\n            0x10000;\n            out[c++] = String.fromCharCode(0xd800 + (u >> 10));\n            out[c++] = String.fromCharCode(0xdc00 + (u & 1023));\n        } else\n        {\n            var c2 = bytes[pos++];\n            var c3 = bytes[pos++];\n            out[c++] = String.fromCharCode((c1 & 15) << 12 | (c2 & 63) << 6 | c3 & 63);\n        }\n    }\n    return out.join('');\n};\n// We define it as an object literal instead of a class because a class compiled down to es5 can't\n// be treeshaked. https://github.com/rollup/rollup/issues/1691\n// Static lookup maps, lazily populated by init_()\nvar base64 = {\n    /**\r\n                * Maps bytes to characters.\r\n                */\n    byteToCharMap_: null,\n    /**\r\n                           * Maps characters to bytes.\r\n                           */\n    charToByteMap_: null,\n    /**\r\n                           * Maps bytes to websafe characters.\r\n                           * @private\r\n                           */\n    byteToCharMapWebSafe_: null,\n    /**\r\n                                  * Maps websafe characters to bytes.\r\n                                  * @private\r\n                                  */\n    charToByteMapWebSafe_: null,\n    /**\r\n                                  * Our default alphabet, shared between\r\n                                  * ENCODED_VALS and ENCODED_VALS_WEBSAFE\r\n                                  */\n    ENCODED_VALS_BASE: 'ABCDEFGHIJKLMNOPQRSTUVWXYZ' + 'abcdefghijklmnopqrstuvwxyz' + '0123456789',\n    /**\r\n                                                                                                    * Our default alphabet. Value 64 (=) is special; it means \"nothing.\"\r\n                                                                                                    */\n    get ENCODED_VALS() {\n        return this.ENCODED_VALS_BASE + '+/=';\n    },\n    /**\r\n        * Our websafe alphabet.\r\n        */\n    get ENCODED_VALS_WEBSAFE() {\n        return this.ENCODED_VALS_BASE + '-_.';\n    },\n    /**\r\n        * Whether this browser supports the atob and btoa functions. This extension\r\n        * started at Mozilla but is now implemented by many browsers. We use the\r\n        * ASSUME_* variables to avoid pulling in the full useragent detection library\r\n        * but still allowing the standard per-browser compilations.\r\n        *\r\n        */\n    HAS_NATIVE_SUPPORT: typeof atob === 'function',\n    /**\r\n                                                     * Base64-encode an array of bytes.\r\n                                                     *\r\n                                                     * @param input An array of bytes (numbers with\r\n                                                     *     value in [0, 255]) to encode.\r\n                                                     * @param webSafe Boolean indicating we should use the\r\n                                                     *     alternative alphabet.\r\n                                                     * @return The base64 encoded string.\r\n                                                     */\n    encodeByteArray: function encodeByteArray(input, webSafe) {\n        if (!Array.isArray(input)) {\n            throw Error('encodeByteArray takes an array as a parameter');\n        }\n        this.init_();\n        var byteToCharMap = webSafe ?\n        this.byteToCharMapWebSafe_ :\n        this.byteToCharMap_;\n        var output = [];\n        for (var i = 0; i < input.length; i += 3) {\n            var byte1 = input[i];\n            var haveByte2 = i + 1 < input.length;\n            var byte2 = haveByte2 ? input[i + 1] : 0;\n            var haveByte3 = i + 2 < input.length;\n            var byte3 = haveByte3 ? input[i + 2] : 0;\n            var outByte1 = byte1 >> 2;\n            var outByte2 = (byte1 & 0x03) << 4 | byte2 >> 4;\n            var outByte3 = (byte2 & 0x0f) << 2 | byte3 >> 6;\n            var outByte4 = byte3 & 0x3f;\n            if (!haveByte3) {\n                outByte4 = 64;\n                if (!haveByte2) {\n                    outByte3 = 64;\n                }\n            }\n            output.push(byteToCharMap[outByte1], byteToCharMap[outByte2], byteToCharMap[outByte3], byteToCharMap[outByte4]);\n        }\n        return output.join('');\n    },\n    /**\r\n        * Base64-encode a string.\r\n        *\r\n        * @param input A string to encode.\r\n        * @param webSafe If true, we should use the\r\n        *     alternative alphabet.\r\n        * @return The base64 encoded string.\r\n        */\n    encodeString: function encodeString(input, webSafe) {\n        // Shortcut for Mozilla browsers that implement\n        // a native base64 encoder in the form of \"btoa/atob\"\n        if (this.HAS_NATIVE_SUPPORT && !webSafe) {\n            return btoa(input);\n        }\n        return this.encodeByteArray(stringToByteArray(input), webSafe);\n    },\n    /**\r\n        * Base64-decode a string.\r\n        *\r\n        * @param input to decode.\r\n        * @param webSafe True if we should use the\r\n        *     alternative alphabet.\r\n        * @return string representing the decoded value.\r\n        */\n    decodeString: function decodeString(input, webSafe) {\n        // Shortcut for Mozilla browsers that implement\n        // a native base64 encoder in the form of \"btoa/atob\"\n        if (this.HAS_NATIVE_SUPPORT && !webSafe) {\n            return atob(input);\n        }\n        return byteArrayToString(this.decodeStringToByteArray(input, webSafe));\n    },\n    /**\r\n        * Base64-decode a string.\r\n        *\r\n        * In base-64 decoding, groups of four characters are converted into three\r\n        * bytes.  If the encoder did not apply padding, the input length may not\r\n        * be a multiple of 4.\r\n        *\r\n        * In this case, the last group will have fewer than 4 characters, and\r\n        * padding will be inferred.  If the group has one or two characters, it decodes\r\n        * to one byte.  If the group has three characters, it decodes to two bytes.\r\n        *\r\n        * @param input Input to decode.\r\n        * @param webSafe True if we should use the web-safe alphabet.\r\n        * @return bytes representing the decoded value.\r\n        */\n    decodeStringToByteArray: function decodeStringToByteArray(input, webSafe) {\n        this.init_();\n        var charToByteMap = webSafe ?\n        this.charToByteMapWebSafe_ :\n        this.charToByteMap_;\n        var output = [];\n        for (var i = 0; i < input.length;) {\n            var byte1 = charToByteMap[input.charAt(i++)];\n            var haveByte2 = i < input.length;\n            var byte2 = haveByte2 ? charToByteMap[input.charAt(i)] : 0;\n            ++i;\n            var haveByte3 = i < input.length;\n            var byte3 = haveByte3 ? charToByteMap[input.charAt(i)] : 64;\n            ++i;\n            var haveByte4 = i < input.length;\n            var byte4 = haveByte4 ? charToByteMap[input.charAt(i)] : 64;\n            ++i;\n            if (byte1 == null || byte2 == null || byte3 == null || byte4 == null) {\n                throw Error();\n            }\n            var outByte1 = byte1 << 2 | byte2 >> 4;\n            output.push(outByte1);\n            if (byte3 !== 64) {\n                var outByte2 = byte2 << 4 & 0xf0 | byte3 >> 2;\n                output.push(outByte2);\n                if (byte4 !== 64) {\n                    var outByte3 = byte3 << 6 & 0xc0 | byte4;\n                    output.push(outByte3);\n                }\n            }\n        }\n        return output;\n    },\n    /**\r\n        * Lazy static initialization function. Called before\r\n        * accessing any of the static map variables.\r\n        * @private\r\n        */\n    init_: function init_() {\n        if (!this.byteToCharMap_) {\n            this.byteToCharMap_ = {};\n            this.charToByteMap_ = {};\n            this.byteToCharMapWebSafe_ = {};\n            this.charToByteMapWebSafe_ = {};\n            // We want quick mappings back and forth, so we precompute two maps.\n            for (var i = 0; i < this.ENCODED_VALS.length; i++) {\n                this.byteToCharMap_[i] = this.ENCODED_VALS.charAt(i);\n                this.charToByteMap_[this.byteToCharMap_[i]] = i;\n                this.byteToCharMapWebSafe_[i] = this.ENCODED_VALS_WEBSAFE.charAt(i);\n                this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[i]] = i;\n                // Be forgiving when decoding and correctly decode both encodings.\n                if (i >= this.ENCODED_VALS_BASE.length) {\n                    this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(i)] = i;\n                    this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(i)] = i;\n                }\n            }\n        }\n    } };\n\n/**\r\n          * URL-safe base64 encoding\r\n          */\nvar base64Encode = function base64Encode(str) {\n    var utf8Bytes = stringToByteArray(str);\n    return base64.encodeByteArray(utf8Bytes, true);\n};\n/**\r\n    * URL-safe base64 decoding\r\n    *\r\n    * NOTE: DO NOT use the global atob() function - it does NOT support the\r\n    * base64Url variant encoding.\r\n    *\r\n    * @param str To be decoded\r\n    * @return Decoded result, if possible\r\n    */\nvar base64Decode = function base64Decode(str) {\n    try {\n        return base64.decodeString(str, true);\n    }\n    catch (e) {\n        console.error('base64Decode failed: ', e);\n    }\n    return null;\n};\n\n/**\r\n    * @license\r\n    * Copyright 2017 Google LLC\r\n    *\r\n    * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n    * you may not use this file except in compliance with the License.\r\n    * You may obtain a copy of the License at\r\n    *\r\n    *   http://www.apache.org/licenses/LICENSE-2.0\r\n    *\r\n    * Unless required by applicable law or agreed to in writing, software\r\n    * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n    * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n    * See the License for the specific language governing permissions and\r\n    * limitations under the License.\r\n    */\n/**\r\n        * Do a deep-copy of basic JavaScript Objects or Arrays.\r\n        */\nfunction deepCopy(value) {\n    return deepExtend(undefined, value);\n}\n/**\r\n   * Copy properties from source to target (recursively allows extension\r\n   * of Objects and Arrays).  Scalar values in the target are over-written.\r\n   * If target is undefined, an object of the appropriate type will be created\r\n   * (and returned).\r\n   *\r\n   * We recursively copy all child properties of plain Objects in the source- so\r\n   * that namespace- like dictionaries are merged.\r\n   *\r\n   * Note that the target can be a function, in which case the properties in\r\n   * the source Object are copied onto it as static properties of the Function.\r\n   */\nfunction deepExtend(target, source) {\n    if (!(source instanceof Object)) {\n        return source;\n    }\n    switch (source.constructor) {\n        case Date:\n            // Treat Dates like scalars; if the target date object had any child\n            // properties - they will be lost!\n            var dateValue = source;\n            return new Date(dateValue.getTime());\n        case Object:\n            if (target === undefined) {\n                target = {};\n            }\n            break;\n        case Array:\n            // Always copy the array source and overwrite the target.\n            target = [];\n            break;\n        default:\n            // Not a plain Object - treat it as a scalar.\n            return source;}\n\n    for (var prop in source) {\n        if (!source.hasOwnProperty(prop)) {\n            continue;\n        }\n        target[prop] = deepExtend(target[prop], source[prop]);\n    }\n    return target;\n}\n\n/**\r\n   * @license\r\n   * Copyright 2017 Google LLC\r\n   *\r\n   * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n   * you may not use this file except in compliance with the License.\r\n   * You may obtain a copy of the License at\r\n   *\r\n   *   http://www.apache.org/licenses/LICENSE-2.0\r\n   *\r\n   * Unless required by applicable law or agreed to in writing, software\r\n   * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n   * See the License for the specific language governing permissions and\r\n   * limitations under the License.\r\n   */\nvar Deferred = /** @class */function () {\n    function Deferred() {\n        var _this = this;\n        this.reject = function () {};\n        this.resolve = function () {};\n        this.promise = new Promise(function (resolve, reject) {\n            _this.resolve = resolve;\n            _this.reject = reject;\n        });\n    }\n    /**\r\n       * Our API internals are not promiseified and cannot because our callback APIs have subtle expectations around\r\n       * invoking promises inline, which Promises are forbidden to do. This method accepts an optional node-style callback\r\n       * and returns a node-style callback which will resolve or reject the Deferred's promise.\r\n       */\n    Deferred.prototype.wrapCallback = function (callback) {\n        var _this = this;\n        return function (error, value) {\n            if (error) {\n                _this.reject(error);\n            } else\n            {\n                _this.resolve(value);\n            }\n            if (typeof callback === 'function') {\n                // Attaching noop handler just in case developer wasn't expecting\n                // promises\n                _this.promise.catch(function () {});\n                // Some of our callbacks don't expect a value and our own tests\n                // assert that the parameter length is 1\n                if (callback.length === 1) {\n                    callback(error);\n                } else\n                {\n                    callback(error, value);\n                }\n            }\n        };\n    };\n    return Deferred;\n}();\n\n/**\r\n      * @license\r\n      * Copyright 2017 Google LLC\r\n      *\r\n      * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n      * you may not use this file except in compliance with the License.\r\n      * You may obtain a copy of the License at\r\n      *\r\n      *   http://www.apache.org/licenses/LICENSE-2.0\r\n      *\r\n      * Unless required by applicable law or agreed to in writing, software\r\n      * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n      * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n      * See the License for the specific language governing permissions and\r\n      * limitations under the License.\r\n      */\n/**\r\n          * Returns navigator.userAgent string or '' if it's not defined.\r\n          * @return user agent string\r\n          */\nfunction getUA() {\n    if (typeof navigator !== 'undefined' &&\n    typeof navigator['userAgent'] === 'string') {\n        return navigator['userAgent'];\n    } else\n    {\n        return '';\n    }\n}\n/**\r\n   * Detect Cordova / PhoneGap / Ionic frameworks on a mobile device.\r\n   *\r\n   * Deliberately does not rely on checking `file://` URLs (as this fails PhoneGap\r\n   * in the Ripple emulator) nor Cordova `onDeviceReady`, which would normally\r\n   * wait for a callback.\r\n   */\nfunction isMobileCordova() {\n    return typeof window !== 'undefined' &&\n    // @ts-ignore Setting up an broadly applicable index signature for Window\n    // just to deal with this case would probably be a bad idea.\n    !!(window['cordova'] || window['phonegap'] || window['PhoneGap']) &&\n    /ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(getUA());\n}\n/**\r\n   * Detect Node.js.\r\n   *\r\n   * @return true if Node.js environment is detected.\r\n   */\n// Node detection logic from: https://github.com/iliakan/detect-node/\nfunction isNode() {\n    try {\n        return Object.prototype.toString.call(global.process) === '[object process]';\n    }\n    catch (e) {\n        return false;\n    }\n}\n/**\r\n   * Detect Browser Environment\r\n   */\nfunction isBrowser() {\n    return (typeof self === 'undefined' ? 'undefined' : _typeof(self)) === 'object' && self.self === self;\n}\nfunction isBrowserExtension() {\n    var runtime = (typeof chrome === 'undefined' ? 'undefined' : _typeof(chrome)) === 'object' ?\n    chrome.runtime :\n    (typeof browser === 'undefined' ? 'undefined' : _typeof(browser)) === 'object' ?\n    browser.runtime :\n    undefined;\n    return (typeof runtime === 'undefined' ? 'undefined' : _typeof(runtime)) === 'object' && runtime.id !== undefined;\n}\n/**\r\n   * Detect React Native.\r\n   *\r\n   * @return true if ReactNative environment is detected.\r\n   */\nfunction isReactNative() {\n    return (typeof navigator === 'undefined' ? 'undefined' : _typeof(navigator)) === 'object' && navigator['product'] === 'ReactNative';\n}\n/** Detects Electron apps. */\nfunction isElectron() {\n    return getUA().indexOf('Electron/') >= 0;\n}\n/** Detects Internet Explorer. */\nfunction isIE() {\n    var ua = getUA();\n    return ua.indexOf('MSIE ') >= 0 || ua.indexOf('Trident/') >= 0;\n}\n/** Detects Universal Windows Platform apps. */\nfunction isUWP() {\n    return getUA().indexOf('MSAppHost/') >= 0;\n}\n/**\r\n   * Detect whether the current SDK build is the Node version.\r\n   *\r\n   * @return true if it's the Node SDK build.\r\n   */\nfunction isNodeSdk() {\n    return CONSTANTS.NODE_CLIENT === true || CONSTANTS.NODE_ADMIN === true;\n}\n/** Returns true if we are running in Safari. */\nfunction isSafari() {\n    return !isNode() &&\n    navigator.userAgent.includes('Safari') &&\n    !navigator.userAgent.includes('Chrome');\n}\n/**\r\n   * This method checks if indexedDB is supported by current browser/service worker context\r\n   * @return true if indexedDB is supported by current browser/service worker context\r\n   */\nfunction isIndexedDBAvailable() {\n    return 'indexedDB' in self && indexedDB != null;\n}\n/**\r\n   * This method validates browser context for indexedDB by opening a dummy indexedDB database and reject\r\n   * if errors occur during the database open operation.\r\n   */\nfunction validateIndexedDBOpenable() {\n    return new Promise(function (resolve, reject) {\n        try {\n            var preExist_1 = true;\n            var DB_CHECK_NAME_1 = 'validate-browser-context-for-indexeddb-analytics-module';\n            var request_1 = window.indexedDB.open(DB_CHECK_NAME_1);\n            request_1.onsuccess = function () {\n                request_1.result.close();\n                // delete database only when it doesn't pre-exist\n                if (!preExist_1) {\n                    window.indexedDB.deleteDatabase(DB_CHECK_NAME_1);\n                }\n                resolve(true);\n            };\n            request_1.onupgradeneeded = function () {\n                preExist_1 = false;\n            };\n            request_1.onerror = function () {\n                var _a;\n                reject(((_a = request_1.error) === null || _a === void 0 ? void 0 : _a.message) || '');\n            };\n        }\n        catch (error) {\n            reject(error);\n        }\n    });\n}\n/**\r\n   *\r\n   * This method checks whether cookie is enabled within current browser\r\n   * @return true if cookie is enabled within current browser\r\n   */\nfunction areCookiesEnabled() {\n    if (!navigator || !navigator.cookieEnabled) {\n        return false;\n    }\n    return true;\n}\n\n/**\r\n   * @license\r\n   * Copyright 2017 Google LLC\r\n   *\r\n   * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n   * you may not use this file except in compliance with the License.\r\n   * You may obtain a copy of the License at\r\n   *\r\n   *   http://www.apache.org/licenses/LICENSE-2.0\r\n   *\r\n   * Unless required by applicable law or agreed to in writing, software\r\n   * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n   * See the License for the specific language governing permissions and\r\n   * limitations under the License.\r\n   */\nvar ERROR_NAME = 'FirebaseError';\n// Based on code from:\n// https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Error#Custom_Error_Types\nvar FirebaseError = /** @class */function (_super) {\n    tslib.__extends(FirebaseError, _super);\n    function FirebaseError(code, message) {\n        var _this = _super.call(this, message) || this;\n        _this.code = code;\n        _this.name = ERROR_NAME;\n        // Fix For ES5\n        // https://github.com/Microsoft/TypeScript-wiki/blob/master/Breaking-Changes.md#extending-built-ins-like-error-array-and-map-may-no-longer-work\n        Object.setPrototypeOf(_this, FirebaseError.prototype);\n        // Maintains proper stack trace for where our error was thrown.\n        // Only available on V8.\n        if (Error.captureStackTrace) {\n            Error.captureStackTrace(_this, ErrorFactory.prototype.create);\n        }\n        return _this;\n    }\n    return FirebaseError;\n}(Error);\nvar ErrorFactory = /** @class */function () {\n    function ErrorFactory(service, serviceName, errors) {\n        this.service = service;\n        this.serviceName = serviceName;\n        this.errors = errors;\n    }\n    ErrorFactory.prototype.create = function (code) {\n        var data = [];\n        for (var _i = 1; _i < arguments.length; _i++) {\n            data[_i - 1] = arguments[_i];\n        }\n        var customData = data[0] || {};\n        var fullCode = this.service + \"/\" + code;\n        var template = this.errors[code];\n        var message = template ? replaceTemplate(template, customData) : 'Error';\n        // Service Name: Error message (service/code).\n        var fullMessage = this.serviceName + \": \" + message + \" (\" + fullCode + \").\";\n        var error = new FirebaseError(fullCode, fullMessage);\n        // Keys with an underscore at the end of their name are not included in\n        // error.data for some reason.\n        // TODO: Replace with Object.entries when lib is updated to es2017.\n        for (var _a = 0, _b = Object.keys(customData); _a < _b.length; _a++) {\n            var key = _b[_a];\n            if (key.slice(-1) !== '_') {\n                if (key in error) {\n                    console.warn(\"Overwriting FirebaseError base field \\\"\" + key + \"\\\" can cause unexpected behavior.\");\n                }\n                error[key] = customData[key];\n            }\n        }\n        return error;\n    };\n    return ErrorFactory;\n}();\nfunction replaceTemplate(template, data) {\n    return template.replace(PATTERN, function (_, key) {\n        var value = data[key];\n        return value != null ? String(value) : \"<\" + key + \"?>\";\n    });\n}\nvar PATTERN = /\\{\\$([^}]+)}/g;\n\n/**\r\n                                * @license\r\n                                * Copyright 2017 Google LLC\r\n                                *\r\n                                * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n                                * you may not use this file except in compliance with the License.\r\n                                * You may obtain a copy of the License at\r\n                                *\r\n                                *   http://www.apache.org/licenses/LICENSE-2.0\r\n                                *\r\n                                * Unless required by applicable law or agreed to in writing, software\r\n                                * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n                                * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n                                * See the License for the specific language governing permissions and\r\n                                * limitations under the License.\r\n                                */\n/**\r\n                                    * Evaluates a JSON string into a javascript object.\r\n                                    *\r\n                                    * @param {string} str A string containing JSON.\r\n                                    * @return {*} The javascript object representing the specified JSON.\r\n                                    */\nfunction jsonEval(str) {\n    return JSON.parse(str);\n}\n/**\r\n   * Returns JSON representing a javascript object.\r\n   * @param {*} data Javascript object to be stringified.\r\n   * @return {string} The JSON contents of the object.\r\n   */\nfunction stringify(data) {\n    return JSON.stringify(data);\n}\n\n/**\r\n   * @license\r\n   * Copyright 2017 Google LLC\r\n   *\r\n   * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n   * you may not use this file except in compliance with the License.\r\n   * You may obtain a copy of the License at\r\n   *\r\n   *   http://www.apache.org/licenses/LICENSE-2.0\r\n   *\r\n   * Unless required by applicable law or agreed to in writing, software\r\n   * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n   * See the License for the specific language governing permissions and\r\n   * limitations under the License.\r\n   */\n/**\r\n       * Decodes a Firebase auth. token into constituent parts.\r\n       *\r\n       * Notes:\r\n       * - May return with invalid / incomplete claims if there's no native base64 decoding support.\r\n       * - Doesn't check if the token is actually valid.\r\n       */\nvar decode = function decode(token) {\n    var header = {},claims = {},data = {},signature = '';\n    try {\n        var parts = token.split('.');\n        header = jsonEval(base64Decode(parts[0]) || '');\n        claims = jsonEval(base64Decode(parts[1]) || '');\n        signature = parts[2];\n        data = claims['d'] || {};\n        delete claims['d'];\n    }\n    catch (e) {}\n    return {\n        header: header,\n        claims: claims,\n        data: data,\n        signature: signature };\n\n};\n/**\r\n    * Decodes a Firebase auth. token and checks the validity of its time-based claims. Will return true if the\r\n    * token is within the time window authorized by the 'nbf' (not-before) and 'iat' (issued-at) claims.\r\n    *\r\n    * Notes:\r\n    * - May return a false negative if there's no native base64 decoding support.\r\n    * - Doesn't check if the token is actually valid.\r\n    */\nvar isValidTimestamp = function isValidTimestamp(token) {\n    var claims = decode(token).claims;\n    var now = Math.floor(new Date().getTime() / 1000);\n    var validSince = 0,validUntil = 0;\n    if ((typeof claims === 'undefined' ? 'undefined' : _typeof(claims)) === 'object') {\n        if (claims.hasOwnProperty('nbf')) {\n            validSince = claims['nbf'];\n        } else\n        if (claims.hasOwnProperty('iat')) {\n            validSince = claims['iat'];\n        }\n        if (claims.hasOwnProperty('exp')) {\n            validUntil = claims['exp'];\n        } else\n        {\n            // token will expire after 24h by default\n            validUntil = validSince + 86400;\n        }\n    }\n    return !!now &&\n    !!validSince &&\n    !!validUntil &&\n    now >= validSince &&\n    now <= validUntil;\n};\n/**\r\n    * Decodes a Firebase auth. token and returns its issued at time if valid, null otherwise.\r\n    *\r\n    * Notes:\r\n    * - May return null if there's no native base64 decoding support.\r\n    * - Doesn't check if the token is actually valid.\r\n    */\nvar issuedAtTime = function issuedAtTime(token) {\n    var claims = decode(token).claims;\n    if ((typeof claims === 'undefined' ? 'undefined' : _typeof(claims)) === 'object' && claims.hasOwnProperty('iat')) {\n        return claims['iat'];\n    }\n    return null;\n};\n/**\r\n    * Decodes a Firebase auth. token and checks the validity of its format. Expects a valid issued-at time.\r\n    *\r\n    * Notes:\r\n    * - May return a false negative if there's no native base64 decoding support.\r\n    * - Doesn't check if the token is actually valid.\r\n    */\nvar isValidFormat = function isValidFormat(token) {\n    var decoded = decode(token),claims = decoded.claims;\n    return !!claims && (typeof claims === 'undefined' ? 'undefined' : _typeof(claims)) === 'object' && claims.hasOwnProperty('iat');\n};\n/**\r\n    * Attempts to peer into an auth token and determine if it's an admin auth token by looking at the claims portion.\r\n    *\r\n    * Notes:\r\n    * - May return a false negative if there's no native base64 decoding support.\r\n    * - Doesn't check if the token is actually valid.\r\n    */\nvar isAdmin = function isAdmin(token) {\n    var claims = decode(token).claims;\n    return (typeof claims === 'undefined' ? 'undefined' : _typeof(claims)) === 'object' && claims['admin'] === true;\n};\n\n/**\r\n    * @license\r\n    * Copyright 2017 Google LLC\r\n    *\r\n    * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n    * you may not use this file except in compliance with the License.\r\n    * You may obtain a copy of the License at\r\n    *\r\n    *   http://www.apache.org/licenses/LICENSE-2.0\r\n    *\r\n    * Unless required by applicable law or agreed to in writing, software\r\n    * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n    * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n    * See the License for the specific language governing permissions and\r\n    * limitations under the License.\r\n    */\nfunction contains(obj, key) {\n    return Object.prototype.hasOwnProperty.call(obj, key);\n}\nfunction safeGet(obj, key) {\n    if (Object.prototype.hasOwnProperty.call(obj, key)) {\n        return obj[key];\n    } else\n    {\n        return undefined;\n    }\n}\nfunction isEmpty(obj) {\n    for (var key in obj) {\n        if (Object.prototype.hasOwnProperty.call(obj, key)) {\n            return false;\n        }\n    }\n    return true;\n}\nfunction map(obj, fn, contextObj) {\n    var res = {};\n    for (var key in obj) {\n        if (Object.prototype.hasOwnProperty.call(obj, key)) {\n            res[key] = fn.call(contextObj, obj[key], key, obj);\n        }\n    }\n    return res;\n}\n\n/**\r\n   * @license\r\n   * Copyright 2017 Google LLC\r\n   *\r\n   * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n   * you may not use this file except in compliance with the License.\r\n   * You may obtain a copy of the License at\r\n   *\r\n   *   http://www.apache.org/licenses/LICENSE-2.0\r\n   *\r\n   * Unless required by applicable law or agreed to in writing, software\r\n   * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n   * See the License for the specific language governing permissions and\r\n   * limitations under the License.\r\n   */\n/**\r\n       * Returns a querystring-formatted string (e.g. &arg=val&arg2=val2) from a\r\n       * params object (e.g. {arg: 'val', arg2: 'val2'})\r\n       * Note: You must prepend it with ? when adding it to a URL.\r\n       */\nfunction querystring(querystringParams) {\n    var params = [];\n    var _loop_1 = function _loop_1(key, value) {\n        if (Array.isArray(value)) {\n            value.forEach(function (arrayVal) {\n                params.push(encodeURIComponent(key) + '=' + encodeURIComponent(arrayVal));\n            });\n        } else\n        {\n            params.push(encodeURIComponent(key) + '=' + encodeURIComponent(value));\n        }\n    };\n    for (var _i = 0, _a = Object.entries(querystringParams); _i < _a.length; _i++) {\n        var _b = _a[_i],key = _b[0],value = _b[1];\n        _loop_1(key, value);\n    }\n    return params.length ? '&' + params.join('&') : '';\n}\n/**\r\n   * Decodes a querystring (e.g. ?arg=val&arg2=val2) into a params object\r\n   * (e.g. {arg: 'val', arg2: 'val2'})\r\n   */\nfunction querystringDecode(querystring) {\n    var obj = {};\n    var tokens = querystring.replace(/^\\?/, '').split('&');\n    tokens.forEach(function (token) {\n        if (token) {\n            var key = token.split('=');\n            obj[key[0]] = key[1];\n        }\n    });\n    return obj;\n}\n\n/**\r\n   * @license\r\n   * Copyright 2017 Google LLC\r\n   *\r\n   * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n   * you may not use this file except in compliance with the License.\r\n   * You may obtain a copy of the License at\r\n   *\r\n   *   http://www.apache.org/licenses/LICENSE-2.0\r\n   *\r\n   * Unless required by applicable law or agreed to in writing, software\r\n   * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n   * See the License for the specific language governing permissions and\r\n   * limitations under the License.\r\n   */\n/**\r\n       * @fileoverview SHA-1 cryptographic hash.\r\n       * Variable names follow the notation in FIPS PUB 180-3:\r\n       * http://csrc.nist.gov/publications/fips/fips180-3/fips180-3_final.pdf.\r\n       *\r\n       * Usage:\r\n       *   var sha1 = new sha1();\r\n       *   sha1.update(bytes);\r\n       *   var hash = sha1.digest();\r\n       *\r\n       * Performance:\r\n       *   Chrome 23:   ~400 Mbit/s\r\n       *   Firefox 16:  ~250 Mbit/s\r\n       *\r\n       */\n/**\r\n           * SHA-1 cryptographic hash constructor.\r\n           *\r\n           * The properties declared here are discussed in the above algorithm document.\r\n           * @constructor\r\n           * @final\r\n           * @struct\r\n           */\nvar Sha1 = /** @class */function () {\n    function Sha1() {\n        /**\r\n                      * Holds the previous values of accumulated variables a-e in the compress_\r\n                      * function.\r\n                      * @private\r\n                      */\n        this.chain_ = [];\n        /**\r\n                           * A buffer holding the partially computed hash result.\r\n                           * @private\r\n                           */\n        this.buf_ = [];\n        /**\r\n                         * An array of 80 bytes, each a part of the message to be hashed.  Referred to\r\n                         * as the message schedule in the docs.\r\n                         * @private\r\n                         */\n        this.W_ = [];\n        /**\r\n                       * Contains data needed to pad messages less than 64 bytes.\r\n                       * @private\r\n                       */\n        this.pad_ = [];\n        /**\r\n                         * @private {number}\r\n                         */\n        this.inbuf_ = 0;\n        /**\r\n                          * @private {number}\r\n                          */\n        this.total_ = 0;\n        this.blockSize = 512 / 8;\n        this.pad_[0] = 128;\n        for (var i = 1; i < this.blockSize; ++i) {\n            this.pad_[i] = 0;\n        }\n        this.reset();\n    }\n    Sha1.prototype.reset = function () {\n        this.chain_[0] = 0x67452301;\n        this.chain_[1] = 0xefcdab89;\n        this.chain_[2] = 0x98badcfe;\n        this.chain_[3] = 0x10325476;\n        this.chain_[4] = 0xc3d2e1f0;\n        this.inbuf_ = 0;\n        this.total_ = 0;\n    };\n    /**\r\n        * Internal compress helper function.\r\n        * @param buf Block to compress.\r\n        * @param offset Offset of the block in the buffer.\r\n        * @private\r\n        */\n    Sha1.prototype.compress_ = function (buf, offset) {\n        if (!offset) {\n            offset = 0;\n        }\n        var W = this.W_;\n        // get 16 big endian words\n        if (typeof buf === 'string') {\n            for (var i = 0; i < 16; i++) {\n                // TODO(user): [bug 8140122] Recent versions of Safari for Mac OS and iOS\n                // have a bug that turns the post-increment ++ operator into pre-increment\n                // during JIT compilation.  We have code that depends heavily on SHA-1 for\n                // correctness and which is affected by this bug, so I've removed all uses\n                // of post-increment ++ in which the result value is used.  We can revert\n                // this change once the Safari bug\n                // (https://bugs.webkit.org/show_bug.cgi?id=109036) has been fixed and\n                // most clients have been updated.\n                W[i] =\n                buf.charCodeAt(offset) << 24 |\n                buf.charCodeAt(offset + 1) << 16 |\n                buf.charCodeAt(offset + 2) << 8 |\n                buf.charCodeAt(offset + 3);\n                offset += 4;\n            }\n        } else\n        {\n            for (var i = 0; i < 16; i++) {\n                W[i] =\n                buf[offset] << 24 |\n                buf[offset + 1] << 16 |\n                buf[offset + 2] << 8 |\n                buf[offset + 3];\n                offset += 4;\n            }\n        }\n        // expand to 80 words\n        for (var i = 16; i < 80; i++) {\n            var t = W[i - 3] ^ W[i - 8] ^ W[i - 14] ^ W[i - 16];\n            W[i] = (t << 1 | t >>> 31) & 0xffffffff;\n        }\n        var a = this.chain_[0];\n        var b = this.chain_[1];\n        var c = this.chain_[2];\n        var d = this.chain_[3];\n        var e = this.chain_[4];\n        var f, k;\n        // TODO(user): Try to unroll this loop to speed up the computation.\n        for (var i = 0; i < 80; i++) {\n            if (i < 40) {\n                if (i < 20) {\n                    f = d ^ b & (c ^ d);\n                    k = 0x5a827999;\n                } else\n                {\n                    f = b ^ c ^ d;\n                    k = 0x6ed9eba1;\n                }\n            } else\n            {\n                if (i < 60) {\n                    f = b & c | d & (b | c);\n                    k = 0x8f1bbcdc;\n                } else\n                {\n                    f = b ^ c ^ d;\n                    k = 0xca62c1d6;\n                }\n            }\n            var t = (a << 5 | a >>> 27) + f + e + k + W[i] & 0xffffffff;\n            e = d;\n            d = c;\n            c = (b << 30 | b >>> 2) & 0xffffffff;\n            b = a;\n            a = t;\n        }\n        this.chain_[0] = this.chain_[0] + a & 0xffffffff;\n        this.chain_[1] = this.chain_[1] + b & 0xffffffff;\n        this.chain_[2] = this.chain_[2] + c & 0xffffffff;\n        this.chain_[3] = this.chain_[3] + d & 0xffffffff;\n        this.chain_[4] = this.chain_[4] + e & 0xffffffff;\n    };\n    Sha1.prototype.update = function (bytes, length) {\n        // TODO(johnlenz): tighten the function signature and remove this check\n        if (bytes == null) {\n            return;\n        }\n        if (length === undefined) {\n            length = bytes.length;\n        }\n        var lengthMinusBlock = length - this.blockSize;\n        var n = 0;\n        // Using local instead of member variables gives ~5% speedup on Firefox 16.\n        var buf = this.buf_;\n        var inbuf = this.inbuf_;\n        // The outer while loop should execute at most twice.\n        while (n < length) {\n            // When we have no data in the block to top up, we can directly process the\n            // input buffer (assuming it contains sufficient data). This gives ~25%\n            // speedup on Chrome 23 and ~15% speedup on Firefox 16, but requires that\n            // the data is provided in large chunks (or in multiples of 64 bytes).\n            if (inbuf === 0) {\n                while (n <= lengthMinusBlock) {\n                    this.compress_(bytes, n);\n                    n += this.blockSize;\n                }\n            }\n            if (typeof bytes === 'string') {\n                while (n < length) {\n                    buf[inbuf] = bytes.charCodeAt(n);\n                    ++inbuf;\n                    ++n;\n                    if (inbuf === this.blockSize) {\n                        this.compress_(buf);\n                        inbuf = 0;\n                        // Jump to the outer loop so we use the full-block optimization.\n                        break;\n                    }\n                }\n            } else\n            {\n                while (n < length) {\n                    buf[inbuf] = bytes[n];\n                    ++inbuf;\n                    ++n;\n                    if (inbuf === this.blockSize) {\n                        this.compress_(buf);\n                        inbuf = 0;\n                        // Jump to the outer loop so we use the full-block optimization.\n                        break;\n                    }\n                }\n            }\n        }\n        this.inbuf_ = inbuf;\n        this.total_ += length;\n    };\n    /** @override */\n    Sha1.prototype.digest = function () {\n        var digest = [];\n        var totalBits = this.total_ * 8;\n        // Add pad 0x80 0x00*.\n        if (this.inbuf_ < 56) {\n            this.update(this.pad_, 56 - this.inbuf_);\n        } else\n        {\n            this.update(this.pad_, this.blockSize - (this.inbuf_ - 56));\n        }\n        // Add # bits.\n        for (var i = this.blockSize - 1; i >= 56; i--) {\n            this.buf_[i] = totalBits & 255;\n            totalBits /= 256; // Don't use bit-shifting here!\n        }\n        this.compress_(this.buf_);\n        var n = 0;\n        for (var i = 0; i < 5; i++) {\n            for (var j = 24; j >= 0; j -= 8) {\n                digest[n] = this.chain_[i] >> j & 255;\n                ++n;\n            }\n        }\n        return digest;\n    };\n    return Sha1;\n}();\n\n/**\r\n      * Helper to make a Subscribe function (just like Promise helps make a\r\n      * Thenable).\r\n      *\r\n      * @param executor Function which can make calls to a single Observer\r\n      *     as a proxy.\r\n      * @param onNoObservers Callback when count of Observers goes to zero.\r\n      */\nfunction createSubscribe(executor, onNoObservers) {\n    var proxy = new ObserverProxy(executor, onNoObservers);\n    return proxy.subscribe.bind(proxy);\n}\n/**\r\n   * Implement fan-out for any number of Observers attached via a subscribe\r\n   * function.\r\n   */\nvar ObserverProxy = /** @class */function () {\n    /**\r\n                                               * @param executor Function which can make calls to a single Observer\r\n                                               *     as a proxy.\r\n                                               * @param onNoObservers Callback when count of Observers goes to zero.\r\n                                               */\n    function ObserverProxy(executor, onNoObservers) {\n        var _this = this;\n        this.observers = [];\n        this.unsubscribes = [];\n        this.observerCount = 0;\n        // Micro-task scheduling by calling task.then().\n        this.task = Promise.resolve();\n        this.finalized = false;\n        this.onNoObservers = onNoObservers;\n        // Call the executor asynchronously so subscribers that are called\n        // synchronously after the creation of the subscribe function\n        // can still receive the very first value generated in the executor.\n        this.task.\n        then(function () {\n            executor(_this);\n        }).\n        catch(function (e) {\n            _this.error(e);\n        });\n    }\n    ObserverProxy.prototype.next = function (value) {\n        this.forEachObserver(function (observer) {\n            observer.next(value);\n        });\n    };\n    ObserverProxy.prototype.error = function (error) {\n        this.forEachObserver(function (observer) {\n            observer.error(error);\n        });\n        this.close(error);\n    };\n    ObserverProxy.prototype.complete = function () {\n        this.forEachObserver(function (observer) {\n            observer.complete();\n        });\n        this.close();\n    };\n    /**\r\n        * Subscribe function that can be used to add an Observer to the fan-out list.\r\n        *\r\n        * - We require that no event is sent to a subscriber sychronously to their\r\n        *   call to subscribe().\r\n        */\n    ObserverProxy.prototype.subscribe = function (nextOrObserver, error, complete) {\n        var _this = this;\n        var observer;\n        if (nextOrObserver === undefined &&\n        error === undefined &&\n        complete === undefined) {\n            throw new Error('Missing Observer.');\n        }\n        // Assemble an Observer object when passed as callback functions.\n        if (implementsAnyMethods(nextOrObserver, [\n        'next',\n        'error',\n        'complete']))\n        {\n            observer = nextOrObserver;\n        } else\n        {\n            observer = {\n                next: nextOrObserver,\n                error: error,\n                complete: complete };\n\n        }\n        if (observer.next === undefined) {\n            observer.next = noop;\n        }\n        if (observer.error === undefined) {\n            observer.error = noop;\n        }\n        if (observer.complete === undefined) {\n            observer.complete = noop;\n        }\n        var unsub = this.unsubscribeOne.bind(this, this.observers.length);\n        // Attempt to subscribe to a terminated Observable - we\n        // just respond to the Observer with the final error or complete\n        // event.\n        if (this.finalized) {\n            // eslint-disable-next-line @typescript-eslint/no-floating-promises\n            this.task.then(function () {\n                try {\n                    if (_this.finalError) {\n                        observer.error(_this.finalError);\n                    } else\n                    {\n                        observer.complete();\n                    }\n                }\n                catch (e) {\n                    // nothing\n                }\n                return;\n            });\n        }\n        this.observers.push(observer);\n        return unsub;\n    };\n    // Unsubscribe is synchronous - we guarantee that no events are sent to\n    // any unsubscribed Observer.\n    ObserverProxy.prototype.unsubscribeOne = function (i) {\n        if (this.observers === undefined || this.observers[i] === undefined) {\n            return;\n        }\n        delete this.observers[i];\n        this.observerCount -= 1;\n        if (this.observerCount === 0 && this.onNoObservers !== undefined) {\n            this.onNoObservers(this);\n        }\n    };\n    ObserverProxy.prototype.forEachObserver = function (fn) {\n        if (this.finalized) {\n            // Already closed by previous event....just eat the additional values.\n            return;\n        }\n        // Since sendOne calls asynchronously - there is no chance that\n        // this.observers will become undefined.\n        for (var i = 0; i < this.observers.length; i++) {\n            this.sendOne(i, fn);\n        }\n    };\n    // Call the Observer via one of it's callback function. We are careful to\n    // confirm that the observe has not been unsubscribed since this asynchronous\n    // function had been queued.\n    ObserverProxy.prototype.sendOne = function (i, fn) {\n        var _this = this;\n        // Execute the callback asynchronously\n        // eslint-disable-next-line @typescript-eslint/no-floating-promises\n        this.task.then(function () {\n            if (_this.observers !== undefined && _this.observers[i] !== undefined) {\n                try {\n                    fn(_this.observers[i]);\n                }\n                catch (e) {\n                    // Ignore exceptions raised in Observers or missing methods of an\n                    // Observer.\n                    // Log error to console. b/31404806\n                    if (typeof console !== 'undefined' && console.error) {\n                        console.error(e);\n                    }\n                }\n            }\n        });\n    };\n    ObserverProxy.prototype.close = function (err) {\n        var _this = this;\n        if (this.finalized) {\n            return;\n        }\n        this.finalized = true;\n        if (err !== undefined) {\n            this.finalError = err;\n        }\n        // Proxy is no longer needed - garbage collect references\n        // eslint-disable-next-line @typescript-eslint/no-floating-promises\n        this.task.then(function () {\n            _this.observers = undefined;\n            _this.onNoObservers = undefined;\n        });\n    };\n    return ObserverProxy;\n}();\n/** Turn synchronous function into one called asynchronously. */\n// eslint-disable-next-line @typescript-eslint/ban-types\nfunction async(fn, onError) {\n    return function () {\n        var args = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            args[_i] = arguments[_i];\n        }\n        Promise.resolve(true).\n        then(function () {\n            fn.apply(void 0, args);\n        }).\n        catch(function (error) {\n            if (onError) {\n                onError(error);\n            }\n        });\n    };\n}\n/**\r\n   * Return true if the object passed in implements any of the named methods.\r\n   */\nfunction implementsAnyMethods(obj, methods) {\n    if ((typeof obj === 'undefined' ? 'undefined' : _typeof(obj)) !== 'object' || obj === null) {\n        return false;\n    }\n    for (var _i = 0, methods_1 = methods; _i < methods_1.length; _i++) {\n        var method = methods_1[_i];\n        if (method in obj && typeof obj[method] === 'function') {\n            return true;\n        }\n    }\n    return false;\n}\nfunction noop() {\n\n} // do nothing\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n/**\r\n     * Check to make sure the appropriate number of arguments are provided for a public function.\r\n     * Throws an error if it fails.\r\n     *\r\n     * @param fnName The function name\r\n     * @param minCount The minimum number of arguments to allow for the function call\r\n     * @param maxCount The maximum number of argument to allow for the function call\r\n     * @param argCount The actual number of arguments provided.\r\n     */\nvar validateArgCount = function validateArgCount(fnName, minCount, maxCount, argCount) {\n    var argError;\n    if (argCount < minCount) {\n        argError = 'at least ' + minCount;\n    } else\n    if (argCount > maxCount) {\n        argError = maxCount === 0 ? 'none' : 'no more than ' + maxCount;\n    }\n    if (argError) {\n        var error = fnName +\n        ' failed: Was called with ' +\n        argCount + (\n        argCount === 1 ? ' argument.' : ' arguments.') +\n        ' Expects ' +\n        argError +\n        '.';\n        throw new Error(error);\n    }\n};\n/**\r\n    * Generates a string to prefix an error message about failed argument validation\r\n    *\r\n    * @param fnName The function name\r\n    * @param argumentNumber The index of the argument\r\n    * @param optional Whether or not the argument is optional\r\n    * @return The prefix to add to the error thrown for validation.\r\n    */\nfunction errorPrefix(fnName, argumentNumber, optional) {\n    var argName = '';\n    switch (argumentNumber) {\n        case 1:\n            argName = optional ? 'first' : 'First';\n            break;\n        case 2:\n            argName = optional ? 'second' : 'Second';\n            break;\n        case 3:\n            argName = optional ? 'third' : 'Third';\n            break;\n        case 4:\n            argName = optional ? 'fourth' : 'Fourth';\n            break;\n        default:\n            throw new Error('errorPrefix called with argumentNumber > 4.  Need to update it?');}\n\n    var error = fnName + ' failed: ';\n    error += argName + ' argument ';\n    return error;\n}\n/**\r\n   * @param fnName\r\n   * @param argumentNumber\r\n   * @param namespace\r\n   * @param optional\r\n   */\nfunction validateNamespace(fnName, argumentNumber, namespace, optional) {\n    if (optional && !namespace) {\n        return;\n    }\n    if (typeof namespace !== 'string') {\n        //TODO: I should do more validation here. We only allow certain chars in namespaces.\n        throw new Error(errorPrefix(fnName, argumentNumber, optional) +\n        'must be a valid firebase namespace.');\n    }\n}\nfunction validateCallback(fnName, argumentNumber,\n// eslint-disable-next-line @typescript-eslint/ban-types\ncallback, optional) {\n    if (optional && !callback) {\n        return;\n    }\n    if (typeof callback !== 'function') {\n        throw new Error(errorPrefix(fnName, argumentNumber, optional) +\n        'must be a valid function.');\n    }\n}\nfunction validateContextObject(fnName, argumentNumber, context, optional) {\n    if (optional && !context) {\n        return;\n    }\n    if ((typeof context === 'undefined' ? 'undefined' : _typeof(context)) !== 'object' || context === null) {\n        throw new Error(errorPrefix(fnName, argumentNumber, optional) +\n        'must be a valid context object.');\n    }\n}\n\n/**\r\n   * @license\r\n   * Copyright 2017 Google LLC\r\n   *\r\n   * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n   * you may not use this file except in compliance with the License.\r\n   * You may obtain a copy of the License at\r\n   *\r\n   *   http://www.apache.org/licenses/LICENSE-2.0\r\n   *\r\n   * Unless required by applicable law or agreed to in writing, software\r\n   * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n   * See the License for the specific language governing permissions and\r\n   * limitations under the License.\r\n   */\n// Code originally came from goog.crypt.stringToUtf8ByteArray, but for some reason they\n// automatically replaced '\\r\\n' with '\\n', and they didn't handle surrogate pairs,\n// so it's been modified.\n// Note that not all Unicode characters appear as single characters in JavaScript strings.\n// fromCharCode returns the UTF-16 encoding of a character - so some Unicode characters\n// use 2 characters in Javascript.  All 4-byte UTF-8 characters begin with a first\n// character in the range 0xD800 - 0xDBFF (the first character of a so-called surrogate\n// pair).\n// See http://www.ecma-international.org/ecma-262/5.1/#sec-15.1.3\n/**\r\n * @param {string} str\r\n * @return {Array}\r\n */\nvar stringToByteArray$1 = function stringToByteArray$1(str) {\n    var out = [];\n    var p = 0;\n    for (var i = 0; i < str.length; i++) {\n        var c = str.charCodeAt(i);\n        // Is this the lead surrogate in a surrogate pair?\n        if (c >= 0xd800 && c <= 0xdbff) {\n            var high = c - 0xd800; // the high 10 bits.\n            i++;\n            assert(i < str.length, 'Surrogate pair missing trail surrogate.');\n            var low = str.charCodeAt(i) - 0xdc00; // the low 10 bits.\n            c = 0x10000 + (high << 10) + low;\n        }\n        if (c < 128) {\n            out[p++] = c;\n        } else\n        if (c < 2048) {\n            out[p++] = c >> 6 | 192;\n            out[p++] = c & 63 | 128;\n        } else\n        if (c < 65536) {\n            out[p++] = c >> 12 | 224;\n            out[p++] = c >> 6 & 63 | 128;\n            out[p++] = c & 63 | 128;\n        } else\n        {\n            out[p++] = c >> 18 | 240;\n            out[p++] = c >> 12 & 63 | 128;\n            out[p++] = c >> 6 & 63 | 128;\n            out[p++] = c & 63 | 128;\n        }\n    }\n    return out;\n};\n/**\r\n    * Calculate length without actually converting; useful for doing cheaper validation.\r\n    * @param {string} str\r\n    * @return {number}\r\n    */\nvar stringLength = function stringLength(str) {\n    var p = 0;\n    for (var i = 0; i < str.length; i++) {\n        var c = str.charCodeAt(i);\n        if (c < 128) {\n            p++;\n        } else\n        if (c < 2048) {\n            p += 2;\n        } else\n        if (c >= 0xd800 && c <= 0xdbff) {\n            // Lead surrogate of a surrogate pair.  The pair together will take 4 bytes to represent.\n            p += 4;\n            i++; // skip trail surrogate.\n        } else\n        {\n            p += 3;\n        }\n    }\n    return p;\n};\n\n/**\r\n    * @license\r\n    * Copyright 2019 Google LLC\r\n    *\r\n    * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n    * you may not use this file except in compliance with the License.\r\n    * You may obtain a copy of the License at\r\n    *\r\n    *   http://www.apache.org/licenses/LICENSE-2.0\r\n    *\r\n    * Unless required by applicable law or agreed to in writing, software\r\n    * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n    * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n    * See the License for the specific language governing permissions and\r\n    * limitations under the License.\r\n    */\n/**\r\n        * The amount of milliseconds to exponentially increase.\r\n        */\nvar DEFAULT_INTERVAL_MILLIS = 1000;\n/**\r\n                                     * The factor to backoff by.\r\n                                     * Should be a number greater than 1.\r\n                                     */\nvar DEFAULT_BACKOFF_FACTOR = 2;\n/**\r\n                                 * The maximum milliseconds to increase to.\r\n                                 *\r\n                                 * <p>Visible for testing\r\n                                 */\nvar MAX_VALUE_MILLIS = 4 * 60 * 60 * 1000; // Four hours, like iOS and Android.\n/**\r\n * The percentage of backoff time to randomize by.\r\n * See\r\n * http://go/safe-client-behavior#step-1-determine-the-appropriate-retry-interval-to-handle-spike-traffic\r\n * for context.\r\n *\r\n * <p>Visible for testing\r\n */\nvar RANDOM_FACTOR = 0.5;\n/**\r\n                          * Based on the backoff method from\r\n                          * https://github.com/google/closure-library/blob/master/closure/goog/math/exponentialbackoff.js.\r\n                          * Extracted here so we don't need to pass metadata and a stateful ExponentialBackoff object around.\r\n                          */\nfunction calculateBackoffMillis(backoffCount, intervalMillis, backoffFactor) {\n    if (intervalMillis === void 0) {intervalMillis = DEFAULT_INTERVAL_MILLIS;}\n    if (backoffFactor === void 0) {backoffFactor = DEFAULT_BACKOFF_FACTOR;}\n    // Calculates an exponentially increasing value.\n    // Deviation: calculates value from count and a constant interval, so we only need to save value\n    // and count to restore state.\n    var currBaseValue = intervalMillis * Math.pow(backoffFactor, backoffCount);\n    // A random \"fuzz\" to avoid waves of retries.\n    // Deviation: randomFactor is required.\n    var randomWait = Math.round(\n    // A fraction of the backoff value to add/subtract.\n    // Deviation: changes multiplication order to improve readability.\n    RANDOM_FACTOR *\n    currBaseValue * (\n    // A random float (rounded to int by Math.round above) in the range [-1, 1]. Determines\n    // if we add or subtract.\n    Math.random() - 0.5) *\n    2);\n    // Limits backoff to max to avoid effectively permanent backoff.\n    return Math.min(MAX_VALUE_MILLIS, currBaseValue + randomWait);\n}\n\nexports.CONSTANTS = CONSTANTS;\nexports.Deferred = Deferred;\nexports.ErrorFactory = ErrorFactory;\nexports.FirebaseError = FirebaseError;\nexports.MAX_VALUE_MILLIS = MAX_VALUE_MILLIS;\nexports.RANDOM_FACTOR = RANDOM_FACTOR;\nexports.Sha1 = Sha1;\nexports.areCookiesEnabled = areCookiesEnabled;\nexports.assert = assert;\nexports.assertionError = assertionError;\nexports.async = async;\nexports.base64 = base64;\nexports.base64Decode = base64Decode;\nexports.base64Encode = base64Encode;\nexports.calculateBackoffMillis = calculateBackoffMillis;\nexports.contains = contains;\nexports.createSubscribe = createSubscribe;\nexports.decode = decode;\nexports.deepCopy = deepCopy;\nexports.deepExtend = deepExtend;\nexports.errorPrefix = errorPrefix;\nexports.getUA = getUA;\nexports.isAdmin = isAdmin;\nexports.isBrowser = isBrowser;\nexports.isBrowserExtension = isBrowserExtension;\nexports.isElectron = isElectron;\nexports.isEmpty = isEmpty;\nexports.isIE = isIE;\nexports.isIndexedDBAvailable = isIndexedDBAvailable;\nexports.isMobileCordova = isMobileCordova;\nexports.isNode = isNode;\nexports.isNodeSdk = isNodeSdk;\nexports.isReactNative = isReactNative;\nexports.isSafari = isSafari;\nexports.isUWP = isUWP;\nexports.isValidFormat = isValidFormat;\nexports.isValidTimestamp = isValidTimestamp;\nexports.issuedAtTime = issuedAtTime;\nexports.jsonEval = jsonEval;\nexports.map = map;\nexports.querystring = querystring;\nexports.querystringDecode = querystringDecode;\nexports.safeGet = safeGet;\nexports.stringLength = stringLength;\nexports.stringToByteArray = stringToByteArray$1;\nexports.stringify = stringify;\nexports.validateArgCount = validateArgCount;\nexports.validateCallback = validateCallback;\nexports.validateContextObject = validateContextObject;\nexports.validateIndexedDBOpenable = validateIndexedDBOpenable;\nexports.validateNamespace = validateNamespace;\n//# sourceMappingURL=index.cjs.js.map\n/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(14)))\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/@firebase/util/dist/index.cjs.js\n// module id = 9\n// module chunks = 0\n\n//# sourceURL=webpack:///./~/@firebase/util/dist/index.cjs.js?");

/***/ }),
/* 10 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("(function (self) {\n  'use strict';\n\n  if (self.fetch) {\n    return;\n  }\n\n  var support = {\n    searchParams: 'URLSearchParams' in self,\n    iterable: 'Symbol' in self && 'iterator' in Symbol,\n    blob: 'FileReader' in self && 'Blob' in self && function () {\n      try {\n        new Blob();\n        return true;\n      } catch (e) {\n        return false;\n      }\n    }(),\n    formData: 'FormData' in self,\n    arrayBuffer: 'ArrayBuffer' in self };\n\n\n  if (support.arrayBuffer) {\n    var viewClasses = [\n    '[object Int8Array]',\n    '[object Uint8Array]',\n    '[object Uint8ClampedArray]',\n    '[object Int16Array]',\n    '[object Uint16Array]',\n    '[object Int32Array]',\n    '[object Uint32Array]',\n    '[object Float32Array]',\n    '[object Float64Array]'];\n\n\n    var isDataView = function isDataView(obj) {\n      return obj && DataView.prototype.isPrototypeOf(obj);\n    };\n\n    var isArrayBufferView = ArrayBuffer.isView || function (obj) {\n      return obj && viewClasses.indexOf(Object.prototype.toString.call(obj)) > -1;\n    };\n  }\n\n  function normalizeName(name) {\n    if (typeof name !== 'string') {\n      name = String(name);\n    }\n    if (/[^a-z0-9\\-#$%&'*+.\\^_`|~]/i.test(name)) {\n      throw new TypeError('Invalid character in header field name');\n    }\n    return name.toLowerCase();\n  }\n\n  function normalizeValue(value) {\n    if (typeof value !== 'string') {\n      value = String(value);\n    }\n    return value;\n  }\n\n  // Build a destructive iterator for the value list\n  function iteratorFor(items) {\n    var iterator = {\n      next: function next() {\n        var value = items.shift();\n        return { done: value === undefined, value: value };\n      } };\n\n\n    if (support.iterable) {\n      iterator[Symbol.iterator] = function () {\n        return iterator;\n      };\n    }\n\n    return iterator;\n  }\n\n  function Headers(headers) {\n    this.map = {};\n\n    if (headers instanceof Headers) {\n      headers.forEach(function (value, name) {\n        this.append(name, value);\n      }, this);\n    } else if (Array.isArray(headers)) {\n      headers.forEach(function (header) {\n        this.append(header[0], header[1]);\n      }, this);\n    } else if (headers) {\n      Object.getOwnPropertyNames(headers).forEach(function (name) {\n        this.append(name, headers[name]);\n      }, this);\n    }\n  }\n\n  Headers.prototype.append = function (name, value) {\n    name = normalizeName(name);\n    value = normalizeValue(value);\n    var oldValue = this.map[name];\n    this.map[name] = oldValue ? oldValue + ',' + value : value;\n  };\n\n  Headers.prototype['delete'] = function (name) {\n    delete this.map[normalizeName(name)];\n  };\n\n  Headers.prototype.get = function (name) {\n    name = normalizeName(name);\n    return this.has(name) ? this.map[name] : null;\n  };\n\n  Headers.prototype.has = function (name) {\n    return this.map.hasOwnProperty(normalizeName(name));\n  };\n\n  Headers.prototype.set = function (name, value) {\n    this.map[normalizeName(name)] = normalizeValue(value);\n  };\n\n  Headers.prototype.forEach = function (callback, thisArg) {\n    for (var name in this.map) {\n      if (this.map.hasOwnProperty(name)) {\n        callback.call(thisArg, this.map[name], name, this);\n      }\n    }\n  };\n\n  Headers.prototype.keys = function () {\n    var items = [];\n    this.forEach(function (value, name) {items.push(name);});\n    return iteratorFor(items);\n  };\n\n  Headers.prototype.values = function () {\n    var items = [];\n    this.forEach(function (value) {items.push(value);});\n    return iteratorFor(items);\n  };\n\n  Headers.prototype.entries = function () {\n    var items = [];\n    this.forEach(function (value, name) {items.push([name, value]);});\n    return iteratorFor(items);\n  };\n\n  if (support.iterable) {\n    Headers.prototype[Symbol.iterator] = Headers.prototype.entries;\n  }\n\n  function consumed(body) {\n    if (body.bodyUsed) {\n      return Promise.reject(new TypeError('Already read'));\n    }\n    body.bodyUsed = true;\n  }\n\n  function fileReaderReady(reader) {\n    return new Promise(function (resolve, reject) {\n      reader.onload = function () {\n        resolve(reader.result);\n      };\n      reader.onerror = function () {\n        reject(reader.error);\n      };\n    });\n  }\n\n  function readBlobAsArrayBuffer(blob) {\n    var reader = new FileReader();\n    var promise = fileReaderReady(reader);\n    reader.readAsArrayBuffer(blob);\n    return promise;\n  }\n\n  function readBlobAsText(blob) {\n    var reader = new FileReader();\n    var promise = fileReaderReady(reader);\n    reader.readAsText(blob);\n    return promise;\n  }\n\n  function readArrayBufferAsText(buf) {\n    var view = new Uint8Array(buf);\n    var chars = new Array(view.length);\n\n    for (var i = 0; i < view.length; i++) {\n      chars[i] = String.fromCharCode(view[i]);\n    }\n    return chars.join('');\n  }\n\n  function bufferClone(buf) {\n    if (buf.slice) {\n      return buf.slice(0);\n    } else {\n      var view = new Uint8Array(buf.byteLength);\n      view.set(new Uint8Array(buf));\n      return view.buffer;\n    }\n  }\n\n  function Body() {\n    this.bodyUsed = false;\n\n    this._initBody = function (body) {\n      this._bodyInit = body;\n      if (!body) {\n        this._bodyText = '';\n      } else if (typeof body === 'string') {\n        this._bodyText = body;\n      } else if (support.blob && Blob.prototype.isPrototypeOf(body)) {\n        this._bodyBlob = body;\n      } else if (support.formData && FormData.prototype.isPrototypeOf(body)) {\n        this._bodyFormData = body;\n      } else if (support.searchParams && URLSearchParams.prototype.isPrototypeOf(body)) {\n        this._bodyText = body.toString();\n      } else if (support.arrayBuffer && support.blob && isDataView(body)) {\n        this._bodyArrayBuffer = bufferClone(body.buffer);\n        // IE 10-11 can't handle a DataView body.\n        this._bodyInit = new Blob([this._bodyArrayBuffer]);\n      } else if (support.arrayBuffer && (ArrayBuffer.prototype.isPrototypeOf(body) || isArrayBufferView(body))) {\n        this._bodyArrayBuffer = bufferClone(body);\n      } else {\n        throw new Error('unsupported BodyInit type');\n      }\n\n      if (!this.headers.get('content-type')) {\n        if (typeof body === 'string') {\n          this.headers.set('content-type', 'text/plain;charset=UTF-8');\n        } else if (this._bodyBlob && this._bodyBlob.type) {\n          this.headers.set('content-type', this._bodyBlob.type);\n        } else if (support.searchParams && URLSearchParams.prototype.isPrototypeOf(body)) {\n          this.headers.set('content-type', 'application/x-www-form-urlencoded;charset=UTF-8');\n        }\n      }\n    };\n\n    if (support.blob) {\n      this.blob = function () {\n        var rejected = consumed(this);\n        if (rejected) {\n          return rejected;\n        }\n\n        if (this._bodyBlob) {\n          return Promise.resolve(this._bodyBlob);\n        } else if (this._bodyArrayBuffer) {\n          return Promise.resolve(new Blob([this._bodyArrayBuffer]));\n        } else if (this._bodyFormData) {\n          throw new Error('could not read FormData body as blob');\n        } else {\n          return Promise.resolve(new Blob([this._bodyText]));\n        }\n      };\n\n      this.arrayBuffer = function () {\n        if (this._bodyArrayBuffer) {\n          return consumed(this) || Promise.resolve(this._bodyArrayBuffer);\n        } else {\n          return this.blob().then(readBlobAsArrayBuffer);\n        }\n      };\n    }\n\n    this.text = function () {\n      var rejected = consumed(this);\n      if (rejected) {\n        return rejected;\n      }\n\n      if (this._bodyBlob) {\n        return readBlobAsText(this._bodyBlob);\n      } else if (this._bodyArrayBuffer) {\n        return Promise.resolve(readArrayBufferAsText(this._bodyArrayBuffer));\n      } else if (this._bodyFormData) {\n        throw new Error('could not read FormData body as text');\n      } else {\n        return Promise.resolve(this._bodyText);\n      }\n    };\n\n    if (support.formData) {\n      this.formData = function () {\n        return this.text().then(decode);\n      };\n    }\n\n    this.json = function () {\n      return this.text().then(JSON.parse);\n    };\n\n    return this;\n  }\n\n  // HTTP methods whose capitalization should be normalized\n  var methods = ['DELETE', 'GET', 'HEAD', 'OPTIONS', 'POST', 'PUT'];\n\n  function normalizeMethod(method) {\n    var upcased = method.toUpperCase();\n    return methods.indexOf(upcased) > -1 ? upcased : method;\n  }\n\n  function Request(input, options) {\n    options = options || {};\n    var body = options.body;\n\n    if (input instanceof Request) {\n      if (input.bodyUsed) {\n        throw new TypeError('Already read');\n      }\n      this.url = input.url;\n      this.credentials = input.credentials;\n      if (!options.headers) {\n        this.headers = new Headers(input.headers);\n      }\n      this.method = input.method;\n      this.mode = input.mode;\n      if (!body && input._bodyInit != null) {\n        body = input._bodyInit;\n        input.bodyUsed = true;\n      }\n    } else {\n      this.url = String(input);\n    }\n\n    this.credentials = options.credentials || this.credentials || 'omit';\n    if (options.headers || !this.headers) {\n      this.headers = new Headers(options.headers);\n    }\n    this.method = normalizeMethod(options.method || this.method || 'GET');\n    this.mode = options.mode || this.mode || null;\n    this.referrer = null;\n\n    if ((this.method === 'GET' || this.method === 'HEAD') && body) {\n      throw new TypeError('Body not allowed for GET or HEAD requests');\n    }\n    this._initBody(body);\n  }\n\n  Request.prototype.clone = function () {\n    return new Request(this, { body: this._bodyInit });\n  };\n\n  function decode(body) {\n    var form = new FormData();\n    body.trim().split('&').forEach(function (bytes) {\n      if (bytes) {\n        var split = bytes.split('=');\n        var name = split.shift().replace(/\\+/g, ' ');\n        var value = split.join('=').replace(/\\+/g, ' ');\n        form.append(decodeURIComponent(name), decodeURIComponent(value));\n      }\n    });\n    return form;\n  }\n\n  function parseHeaders(rawHeaders) {\n    var headers = new Headers();\n    // Replace instances of \\r\\n and \\n followed by at least one space or horizontal tab with a space\n    // https://tools.ietf.org/html/rfc7230#section-3.2\n    var preProcessedHeaders = rawHeaders.replace(/\\r?\\n[\\t ]+/g, ' ');\n    preProcessedHeaders.split(/\\r?\\n/).forEach(function (line) {\n      var parts = line.split(':');\n      var key = parts.shift().trim();\n      if (key) {\n        var value = parts.join(':').trim();\n        headers.append(key, value);\n      }\n    });\n    return headers;\n  }\n\n  Body.call(Request.prototype);\n\n  function Response(bodyInit, options) {\n    if (!options) {\n      options = {};\n    }\n\n    this.type = 'default';\n    this.status = options.status === undefined ? 200 : options.status;\n    this.ok = this.status >= 200 && this.status < 300;\n    this.statusText = 'statusText' in options ? options.statusText : 'OK';\n    this.headers = new Headers(options.headers);\n    this.url = options.url || '';\n    this._initBody(bodyInit);\n  }\n\n  Body.call(Response.prototype);\n\n  Response.prototype.clone = function () {\n    return new Response(this._bodyInit, {\n      status: this.status,\n      statusText: this.statusText,\n      headers: new Headers(this.headers),\n      url: this.url });\n\n  };\n\n  Response.error = function () {\n    var response = new Response(null, { status: 0, statusText: '' });\n    response.type = 'error';\n    return response;\n  };\n\n  var redirectStatuses = [301, 302, 303, 307, 308];\n\n  Response.redirect = function (url, status) {\n    if (redirectStatuses.indexOf(status) === -1) {\n      throw new RangeError('Invalid status code');\n    }\n\n    return new Response(null, { status: status, headers: { location: url } });\n  };\n\n  self.Headers = Headers;\n  self.Request = Request;\n  self.Response = Response;\n\n  self.fetch = function (input, init) {\n    return new Promise(function (resolve, reject) {\n      var request = new Request(input, init);\n      var xhr = new XMLHttpRequest();\n\n      xhr.onload = function () {\n        var options = {\n          status: xhr.status,\n          statusText: xhr.statusText,\n          headers: parseHeaders(xhr.getAllResponseHeaders() || '') };\n\n        options.url = 'responseURL' in xhr ? xhr.responseURL : options.headers.get('X-Request-URL');\n        var body = 'response' in xhr ? xhr.response : xhr.responseText;\n        resolve(new Response(body, options));\n      };\n\n      xhr.onerror = function () {\n        reject(new TypeError('Network request failed'));\n      };\n\n      xhr.ontimeout = function () {\n        reject(new TypeError('Network request failed'));\n      };\n\n      xhr.open(request.method, request.url, true);\n\n      if (request.credentials === 'include') {\n        xhr.withCredentials = true;\n      } else if (request.credentials === 'omit') {\n        xhr.withCredentials = false;\n      }\n\n      if ('responseType' in xhr && support.blob) {\n        xhr.responseType = 'blob';\n      }\n\n      request.headers.forEach(function (value, name) {\n        xhr.setRequestHeader(name, value);\n      });\n\n      xhr.send(typeof request._bodyInit === 'undefined' ? null : request._bodyInit);\n    });\n  };\n  self.fetch.polyfill = true;\n})(typeof self !== 'undefined' ? self : undefined);\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/whatwg-fetch/fetch.js\n// module id = 10\n// module chunks = 0\n\n//# sourceURL=webpack:///./~/whatwg-fetch/fetch.js?");

/***/ }),
/* 11 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("Object.defineProperty(exports, \"__esModule\", { value: true }); /*! *****************************************************************************\r\n                                                                            Copyright (c) Microsoft Corporation. All rights reserved.\r\n                                                                            Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use\r\n                                                                            this file except in compliance with the License. You may obtain a copy of the\r\n                                                                            License at http://www.apache.org/licenses/LICENSE-2.0\r\n                                                                            \r\n                                                                            THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\n                                                                            KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED\r\n                                                                            WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,\r\n                                                                            MERCHANTABLITY OR NON-INFRINGEMENT.\r\n                                                                            \r\n                                                                            See the Apache Version 2.0 License for specific language governing permissions\r\n                                                                            and limitations under the License.\r\n                                                                            ***************************************************************************** */\n\nfunction __spreadArrays() {\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) {s += arguments[i].length;}\n    for (var r = Array(s), k = 0, i = 0; i < il; i++) {\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++) {\n            r[k] = a[j];}}\n    return r;\n}\n\n/**\r\n   * @license\r\n   * Copyright 2017 Google LLC\r\n   *\r\n   * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n   * you may not use this file except in compliance with the License.\r\n   * You may obtain a copy of the License at\r\n   *\r\n   *   http://www.apache.org/licenses/LICENSE-2.0\r\n   *\r\n   * Unless required by applicable law or agreed to in writing, software\r\n   * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n   * See the License for the specific language governing permissions and\r\n   * limitations under the License.\r\n   */\nvar _a;\n/**\r\n         * A container for all of the Logger instances\r\n         */\nvar instances = [];\n/**\r\n                     * The JS SDK supports 5 log levels and also allows a user the ability to\r\n                     * silence the logs altogether.\r\n                     *\r\n                     * The order is a follows:\r\n                     * DEBUG < VERBOSE < INFO < WARN < ERROR\r\n                     *\r\n                     * All of the log types above the current log level will be captured (i.e. if\r\n                     * you set the log level to `INFO`, errors will still be logged, but `DEBUG` and\r\n                     * `VERBOSE` logs will not)\r\n                     */\nvar LogLevel;\n(function (LogLevel) {\n    LogLevel[LogLevel[\"DEBUG\"] = 0] = \"DEBUG\";\n    LogLevel[LogLevel[\"VERBOSE\"] = 1] = \"VERBOSE\";\n    LogLevel[LogLevel[\"INFO\"] = 2] = \"INFO\";\n    LogLevel[LogLevel[\"WARN\"] = 3] = \"WARN\";\n    LogLevel[LogLevel[\"ERROR\"] = 4] = \"ERROR\";\n    LogLevel[LogLevel[\"SILENT\"] = 5] = \"SILENT\";\n})(LogLevel || (exports.\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nLogLevel = LogLevel = {}));var levelStringToEnum = { 'debug': LogLevel.DEBUG, 'verbose': LogLevel.VERBOSE, 'info': LogLevel.INFO, 'warn': LogLevel.WARN, 'error': LogLevel.ERROR, 'silent': LogLevel.SILENT }; /**\r\n                                                                                                                                                                                                                * The default log level\r\n                                                                                                                                                                                                                */var defaultLogLevel = LogLevel.INFO; /**\r\n                                                                                                                                                                                                                                                        * By default, `console.debug` is not displayed in the developer console (in\r\n                                                                                                                                                                                                                                                        * chrome). To avoid forcing users to have to opt-in to these logs twice\r\n                                                                                                                                                                                                                                                        * (i.e. once for firebase, and once in the console), we are sending `DEBUG`\r\n                                                                                                                                                                                                                                                        * logs to the `console.log` function.\r\n                                                                                                                                                                                                                                                        */var ConsoleMethod = (_a = {}, _a[LogLevel.DEBUG] = 'log', _a[LogLevel.VERBOSE] = 'log', _a[LogLevel.INFO] = 'info', _a[LogLevel.WARN] = 'warn', _a[LogLevel.ERROR] = 'error', _a); /**\r\n                                                                                                                                                                                                                                                                                                                                                                                                                                              * The default log handler will forward DEBUG, VERBOSE, INFO, WARN, and ERROR\r\n                                                                                                                                                                                                                                                                                                                                                                                                                                              * messages on to their corresponding console counterparts (if the log method\r\n                                                                                                                                                                                                                                                                                                                                                                                                                                              * is supported by the current log level)\r\n                                                                                                                                                                                                                                                                                                                                                                                                                                              */var defaultLogHandler = function defaultLogHandler(instance, logType) {var args = [];for (var _i = 2; _i < arguments.length; _i++) {args[_i - 2] = arguments[_i];}if (logType < instance.logLevel) {return;}var now = new Date().toISOString();var method = ConsoleMethod[logType];if (method) {console[method].apply(console, __spreadArrays([\"[\" + now + \"]  \" + instance.name + \":\"], args));} else {throw new Error(\"Attempted to log a message with an invalid logType (value: \" + logType + \")\");}};var Logger = /** @class */function () {/**\r\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  * Gives you an instance of a Logger to capture messages according to\r\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  * Firebase's logging scheme.\r\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  *\r\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  * @param name The name that the logs will be associated with\r\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  */function Logger(name) {this.name = name; /**\r\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * The log level of the given Logger instance.\r\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              */this._logLevel = defaultLogLevel; /**\r\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   * The main (internal) log handler for the Logger instance.\r\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   * Can be set to a new function in internal package code but not by user.\r\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   */this._logHandler = defaultLogHandler; /**\r\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            * The optional, additional, user-defined log handler for the Logger instance.\r\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            */this._userLogHandler = null; /**\r\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            * Capture the current instance for later use\r\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            */instances.push(this);}Object.defineProperty(Logger.prototype, \"logLevel\", { get: function get() {return this._logLevel;}, set: function set(val) {if (!(val in LogLevel)) {throw new TypeError(\"Invalid value \\\"\" + val + \"\\\" assigned to `logLevel`\");}this._logLevel = val;}, enumerable: false, configurable: true }); // Workaround for setter/getter having to be the same type.\n    Logger.prototype.setLogLevel = function (val) {this._logLevel = typeof val === 'string' ? levelStringToEnum[val] : val;};Object.defineProperty(Logger.prototype, \"logHandler\", { get: function get() {return this._logHandler;}, set: function set(val) {if (typeof val !== 'function') {throw new TypeError('Value assigned to `logHandler` must be a function');}this._logHandler = val;}, enumerable: false, configurable: true });Object.defineProperty(Logger.prototype, \"userLogHandler\", { get: function get() {return this._userLogHandler;}, set: function set(val) {this._userLogHandler = val;}, enumerable: false, configurable: true }); /**\r\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           * The functions below are all based on the `console` interface\r\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           */Logger.prototype.debug = function () {var args = [];for (var _i = 0; _i < arguments.length; _i++) {args[_i] = arguments[_i];}this._userLogHandler && this._userLogHandler.apply(this, __spreadArrays([this, LogLevel.DEBUG], args));this._logHandler.apply(this, __spreadArrays([this, LogLevel.DEBUG], args));};Logger.prototype.log = function () {var args = [];for (var _i = 0; _i < arguments.length; _i++) {args[_i] = arguments[_i];}this._userLogHandler && this._userLogHandler.apply(this, __spreadArrays([this, LogLevel.VERBOSE], args));this._logHandler.apply(this, __spreadArrays([this, LogLevel.VERBOSE], args));};Logger.prototype.info = function () {var args = [];for (var _i = 0; _i < arguments.length; _i++) {args[_i] = arguments[_i];}this._userLogHandler && this._userLogHandler.apply(this, __spreadArrays([this, LogLevel.INFO], args));this._logHandler.apply(this, __spreadArrays([this, LogLevel.INFO], args));};Logger.prototype.warn = function () {var args = [];for (var _i = 0; _i < arguments.length; _i++) {args[_i] = arguments[_i];}this._userLogHandler && this._userLogHandler.apply(this, __spreadArrays([this, LogLevel.WARN], args));this._logHandler.apply(this, __spreadArrays([this, LogLevel.WARN], args));};Logger.prototype.error = function () {var args = [];for (var _i = 0; _i < arguments.length; _i++) {args[_i] = arguments[_i];}this._userLogHandler && this._userLogHandler.apply(this, __spreadArrays([this, LogLevel.ERROR], args));this._logHandler.apply(this, __spreadArrays([this, LogLevel.ERROR], args));};return Logger;}();function setLogLevel(level) {instances.forEach(function (inst) {inst.setLogLevel(level);});}function setUserLogHandler(logCallback, options) {var _loop_1 = function _loop_1(instance) {var customLogLevel = null;if (options && options.level) {customLogLevel = levelStringToEnum[options.level];}if (logCallback === null) {instance.userLogHandler = null;} else {instance.userLogHandler = function (instance, level) {var args = [];for (var _i = 2; _i < arguments.length; _i++) {args[_i - 2] = arguments[_i];}var message = args.map(function (arg) {if (arg == null) {return null;} else if (typeof arg === 'string') {return arg;} else if (typeof arg === 'number' || typeof arg === 'boolean') {return arg.toString();} else if (arg instanceof Error) {return arg.message;} else {try {return JSON.stringify(arg);} catch (ignored) {return null;}}}).filter(function (arg) {return arg;}).join(' ');if (level >= (customLogLevel !== null && customLogLevel !== void 0 ? customLogLevel : instance.logLevel)) {logCallback({ level: LogLevel[level].toLowerCase(), message: message, args: args, type: instance.name });}};}};for (var _i = 0, instances_1 = instances; _i < instances_1.length; _i++) {var instance = instances_1[_i];_loop_1(instance);}}exports.LogLevel = LogLevel;exports.Logger = Logger;exports.setLogLevel = setLogLevel;exports.setUserLogHandler = setUserLogHandler; //# sourceMappingURL=index.esm.js.map\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/@firebase/logger/dist/index.esm.js\n// module id = 11\n// module chunks = 0\n\n//# sourceURL=webpack:///./~/@firebase/logger/dist/index.esm.js?");

/***/ }),
/* 12 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval(" // shim for using process in browser\nvar process = module.exports = {};\n\n// cached from whatever global is present so that test runners that stub it\n// don't break things.  But we need to wrap it in a try catch in case it is\n// wrapped in strict mode code which doesn't define any globals.  It's inside a\n// function because try/catches deoptimize in certain engines.\n\nvar cachedSetTimeout;\nvar cachedClearTimeout;\n\nfunction defaultSetTimout() {\n    throw new Error('setTimeout has not been defined');\n}\nfunction defaultClearTimeout() {\n    throw new Error('clearTimeout has not been defined');\n}\n(function () {\n    try {\n        if (typeof setTimeout === 'function') {\n            cachedSetTimeout = setTimeout;\n        } else {\n            cachedSetTimeout = defaultSetTimout;\n        }\n    } catch (e) {\n        cachedSetTimeout = defaultSetTimout;\n    }\n    try {\n        if (typeof clearTimeout === 'function') {\n            cachedClearTimeout = clearTimeout;\n        } else {\n            cachedClearTimeout = defaultClearTimeout;\n        }\n    } catch (e) {\n        cachedClearTimeout = defaultClearTimeout;\n    }\n})();\nfunction runTimeout(fun) {\n    if (cachedSetTimeout === setTimeout) {\n        //normal enviroments in sane situations\n        return setTimeout(fun, 0);\n    }\n    // if setTimeout wasn't available but was latter defined\n    if ((cachedSetTimeout === defaultSetTimout || !cachedSetTimeout) && setTimeout) {\n        cachedSetTimeout = setTimeout;\n        return setTimeout(fun, 0);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedSetTimeout(fun, 0);\n    } catch (e) {\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't trust the global object when called normally\n            return cachedSetTimeout.call(null, fun, 0);\n        } catch (e) {\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error\n            return cachedSetTimeout.call(this, fun, 0);\n        }\n    }\n\n\n}\nfunction runClearTimeout(marker) {\n    if (cachedClearTimeout === clearTimeout) {\n        //normal enviroments in sane situations\n        return clearTimeout(marker);\n    }\n    // if clearTimeout wasn't available but was latter defined\n    if ((cachedClearTimeout === defaultClearTimeout || !cachedClearTimeout) && clearTimeout) {\n        cachedClearTimeout = clearTimeout;\n        return clearTimeout(marker);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedClearTimeout(marker);\n    } catch (e) {\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't  trust the global object when called normally\n            return cachedClearTimeout.call(null, marker);\n        } catch (e) {\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error.\n            // Some versions of I.E. have different rules for clearTimeout vs setTimeout\n            return cachedClearTimeout.call(this, marker);\n        }\n    }\n\n\n\n}\nvar queue = [];\nvar draining = false;\nvar currentQueue;\nvar queueIndex = -1;\n\nfunction cleanUpNextTick() {\n    if (!draining || !currentQueue) {\n        return;\n    }\n    draining = false;\n    if (currentQueue.length) {\n        queue = currentQueue.concat(queue);\n    } else {\n        queueIndex = -1;\n    }\n    if (queue.length) {\n        drainQueue();\n    }\n}\n\nfunction drainQueue() {\n    if (draining) {\n        return;\n    }\n    var timeout = runTimeout(cleanUpNextTick);\n    draining = true;\n\n    var len = queue.length;\n    while (len) {\n        currentQueue = queue;\n        queue = [];\n        while (++queueIndex < len) {\n            if (currentQueue) {\n                currentQueue[queueIndex].run();\n            }\n        }\n        queueIndex = -1;\n        len = queue.length;\n    }\n    currentQueue = null;\n    draining = false;\n    runClearTimeout(timeout);\n}\n\nprocess.nextTick = function (fun) {\n    var args = new Array(arguments.length - 1);\n    if (arguments.length > 1) {\n        for (var i = 1; i < arguments.length; i++) {\n            args[i - 1] = arguments[i];\n        }\n    }\n    queue.push(new Item(fun, args));\n    if (queue.length === 1 && !draining) {\n        runTimeout(drainQueue);\n    }\n};\n\n// v8 likes predictible objects\nfunction Item(fun, array) {\n    this.fun = fun;\n    this.array = array;\n}\nItem.prototype.run = function () {\n    this.fun.apply(null, this.array);\n};\nprocess.title = 'browser';\nprocess.browser = true;\nprocess.env = {};\nprocess.argv = [];\nprocess.version = ''; // empty string to avoid regexp issues\nprocess.versions = {};\n\nfunction noop() {}\n\nprocess.on = noop;\nprocess.addListener = noop;\nprocess.once = noop;\nprocess.off = noop;\nprocess.removeListener = noop;\nprocess.removeAllListeners = noop;\nprocess.emit = noop;\nprocess.prependListener = noop;\nprocess.prependOnceListener = noop;\n\nprocess.listeners = function (name) {return [];};\n\nprocess.binding = function (name) {\n    throw new Error('process.binding is not supported');\n};\n\nprocess.cwd = function () {return '/';};\nprocess.chdir = function (dir) {\n    throw new Error('process.chdir is not supported');\n};\nprocess.umask = function () {return 0;};\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/process/browser.js\n// module id = 12\n// module chunks = 0\n\n//# sourceURL=webpack:///./~/process/browser.js?");

/***/ }),
/* 13 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("/* WEBPACK VAR INJECTION */(function(process) {var __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;var _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) {return typeof obj;} : function (obj) {return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;}; /**\n                                                                                                                                                                                                                                                                                        * Tween.js - Licensed under the MIT license\n                                                                                                                                                                                                                                                                                        * https://github.com/tweenjs/tween.js\n                                                                                                                                                                                                                                                                                        * ----------------------------------------------\n                                                                                                                                                                                                                                                                                        *\n                                                                                                                                                                                                                                                                                        * See https://github.com/tweenjs/tween.js/graphs/contributors for the full list of contributors.\n                                                                                                                                                                                                                                                                                        * Thank you all, you're awesome!\n                                                                                                                                                                                                                                                                                        */\n\nvar TWEEN = TWEEN || function () {\n\n\tvar _tweens = [];\n\n\treturn {\n\n\t\tgetAll: function getAll() {\n\n\t\t\treturn _tweens;\n\n\t\t},\n\n\t\tremoveAll: function removeAll() {\n\n\t\t\t_tweens = [];\n\n\t\t},\n\n\t\tadd: function add(tween) {\n\n\t\t\t_tweens.push(tween);\n\n\t\t},\n\n\t\tremove: function remove(tween) {\n\n\t\t\tvar i = _tweens.indexOf(tween);\n\n\t\t\tif (i !== -1) {\n\t\t\t\t_tweens.splice(i, 1);\n\t\t\t}\n\n\t\t},\n\n\t\tupdate: function update(time, preserve) {\n\n\t\t\tif (_tweens.length === 0) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tvar i = 0;\n\n\t\t\ttime = time !== undefined ? time : TWEEN.now();\n\n\t\t\twhile (i < _tweens.length) {\n\n\t\t\t\tif (_tweens[i].update(time) || preserve) {\n\t\t\t\t\ti++;\n\t\t\t\t} else {\n\t\t\t\t\t_tweens.splice(i, 1);\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn true;\n\n\t\t} };\n\n\n}();\n\n\n// Include a performance.now polyfill.\n// In node.js, use process.hrtime.\nif (typeof window === 'undefined' && typeof process !== 'undefined') {\n\tTWEEN.now = function () {\n\t\tvar time = process.hrtime();\n\n\t\t// Convert [seconds, nanoseconds] to milliseconds.\n\t\treturn time[0] * 1000 + time[1] / 1000000;\n\t};\n}\n// In a browser, use window.performance.now if it is available.\nelse if (typeof window !== 'undefined' &&\n\twindow.performance !== undefined &&\n\twindow.performance.now !== undefined) {\n\t\t// This must be bound, because directly assigning this function\n\t\t// leads to an invocation exception in Chrome.\n\t\tTWEEN.now = window.performance.now.bind(window.performance);\n\t}\n\t// Use Date.now if it is available.\n\telse if (Date.now !== undefined) {\n\t\t\tTWEEN.now = Date.now;\n\t\t}\n\t\t// Otherwise, use 'new Date().getTime()'.\n\t\telse {\n\t\t\t\tTWEEN.now = function () {\n\t\t\t\t\treturn new Date().getTime();\n\t\t\t\t};\n\t\t\t}\n\n\nTWEEN.Tween = function (object) {\n\n\tvar _object = object;\n\tvar _valuesStart = {};\n\tvar _valuesEnd = {};\n\tvar _valuesStartRepeat = {};\n\tvar _duration = 1000;\n\tvar _repeat = 0;\n\tvar _repeatDelayTime;\n\tvar _yoyo = false;\n\tvar _isPlaying = false;\n\tvar _reversed = false;\n\tvar _delayTime = 0;\n\tvar _startTime = null;\n\tvar _easingFunction = TWEEN.Easing.Linear.None;\n\tvar _interpolationFunction = TWEEN.Interpolation.Linear;\n\tvar _chainedTweens = [];\n\tvar _onStartCallback = null;\n\tvar _onStartCallbackFired = false;\n\tvar _onUpdateCallback = null;\n\tvar _onCompleteCallback = null;\n\tvar _onStopCallback = null;\n\n\tthis.to = function (properties, duration) {\n\n\t\t_valuesEnd = properties;\n\n\t\tif (duration !== undefined) {\n\t\t\t_duration = duration;\n\t\t}\n\n\t\treturn this;\n\n\t};\n\n\tthis.start = function (time) {\n\n\t\tTWEEN.add(this);\n\n\t\t_isPlaying = true;\n\n\t\t_onStartCallbackFired = false;\n\n\t\t_startTime = time !== undefined ? time : TWEEN.now();\n\t\t_startTime += _delayTime;\n\n\t\tfor (var property in _valuesEnd) {\n\n\t\t\t// Check if an Array was provided as property value\n\t\t\tif (_valuesEnd[property] instanceof Array) {\n\n\t\t\t\tif (_valuesEnd[property].length === 0) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\t// Create a local copy of the Array with the start value at the front\n\t\t\t\t_valuesEnd[property] = [_object[property]].concat(_valuesEnd[property]);\n\n\t\t\t}\n\n\t\t\t// If `to()` specifies a property that doesn't exist in the source object,\n\t\t\t// we should not set that property in the object\n\t\t\tif (_object[property] === undefined) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t// Save the starting value.\n\t\t\t_valuesStart[property] = _object[property];\n\n\t\t\tif (_valuesStart[property] instanceof Array === false) {\n\t\t\t\t_valuesStart[property] *= 1.0; // Ensures we're using numbers, not strings\n\t\t\t}\n\n\t\t\t_valuesStartRepeat[property] = _valuesStart[property] || 0;\n\n\t\t}\n\n\t\treturn this;\n\n\t};\n\n\tthis.stop = function () {\n\n\t\tif (!_isPlaying) {\n\t\t\treturn this;\n\t\t}\n\n\t\tTWEEN.remove(this);\n\t\t_isPlaying = false;\n\n\t\tif (_onStopCallback !== null) {\n\t\t\t_onStopCallback.call(_object, _object);\n\t\t}\n\n\t\tthis.stopChainedTweens();\n\t\treturn this;\n\n\t};\n\n\tthis.end = function () {\n\n\t\tthis.update(_startTime + _duration);\n\t\treturn this;\n\n\t};\n\n\tthis.stopChainedTweens = function () {\n\n\t\tfor (var i = 0, numChainedTweens = _chainedTweens.length; i < numChainedTweens; i++) {\n\t\t\t_chainedTweens[i].stop();\n\t\t}\n\n\t};\n\n\tthis.delay = function (amount) {\n\n\t\t_delayTime = amount;\n\t\treturn this;\n\n\t};\n\n\tthis.repeat = function (times) {\n\n\t\t_repeat = times;\n\t\treturn this;\n\n\t};\n\n\tthis.repeatDelay = function (amount) {\n\n\t\t_repeatDelayTime = amount;\n\t\treturn this;\n\n\t};\n\n\tthis.yoyo = function (yoyo) {\n\n\t\t_yoyo = yoyo;\n\t\treturn this;\n\n\t};\n\n\n\tthis.easing = function (easing) {\n\n\t\t_easingFunction = easing;\n\t\treturn this;\n\n\t};\n\n\tthis.interpolation = function (interpolation) {\n\n\t\t_interpolationFunction = interpolation;\n\t\treturn this;\n\n\t};\n\n\tthis.chain = function () {\n\n\t\t_chainedTweens = arguments;\n\t\treturn this;\n\n\t};\n\n\tthis.onStart = function (callback) {\n\n\t\t_onStartCallback = callback;\n\t\treturn this;\n\n\t};\n\n\tthis.onUpdate = function (callback) {\n\n\t\t_onUpdateCallback = callback;\n\t\treturn this;\n\n\t};\n\n\tthis.onComplete = function (callback) {\n\n\t\t_onCompleteCallback = callback;\n\t\treturn this;\n\n\t};\n\n\tthis.onStop = function (callback) {\n\n\t\t_onStopCallback = callback;\n\t\treturn this;\n\n\t};\n\n\tthis.update = function (time) {\n\n\t\tvar property;\n\t\tvar elapsed;\n\t\tvar value;\n\n\t\tif (time < _startTime) {\n\t\t\treturn true;\n\t\t}\n\n\t\tif (_onStartCallbackFired === false) {\n\n\t\t\tif (_onStartCallback !== null) {\n\t\t\t\t_onStartCallback.call(_object, _object);\n\t\t\t}\n\n\t\t\t_onStartCallbackFired = true;\n\t\t}\n\n\t\telapsed = (time - _startTime) / _duration;\n\t\telapsed = elapsed > 1 ? 1 : elapsed;\n\n\t\tvalue = _easingFunction(elapsed);\n\n\t\tfor (property in _valuesEnd) {\n\n\t\t\t// Don't update properties that do not exist in the source object\n\t\t\tif (_valuesStart[property] === undefined) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tvar start = _valuesStart[property] || 0;\n\t\t\tvar end = _valuesEnd[property];\n\n\t\t\tif (end instanceof Array) {\n\n\t\t\t\t_object[property] = _interpolationFunction(end, value);\n\n\t\t\t} else {\n\n\t\t\t\t// Parses relative end values with start as base (e.g.: +10, -3)\n\t\t\t\tif (typeof end === 'string') {\n\n\t\t\t\t\tif (end.charAt(0) === '+' || end.charAt(0) === '-') {\n\t\t\t\t\t\tend = start + parseFloat(end);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tend = parseFloat(end);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Protect against non numeric properties.\n\t\t\t\tif (typeof end === 'number') {\n\t\t\t\t\t_object[property] = start + (end - start) * value;\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t\tif (_onUpdateCallback !== null) {\n\t\t\t_onUpdateCallback.call(_object, value);\n\t\t}\n\n\t\tif (elapsed === 1) {\n\n\t\t\tif (_repeat > 0) {\n\n\t\t\t\tif (isFinite(_repeat)) {\n\t\t\t\t\t_repeat--;\n\t\t\t\t}\n\n\t\t\t\t// Reassign starting values, restart by making startTime = now\n\t\t\t\tfor (property in _valuesStartRepeat) {\n\n\t\t\t\t\tif (typeof _valuesEnd[property] === 'string') {\n\t\t\t\t\t\t_valuesStartRepeat[property] = _valuesStartRepeat[property] + parseFloat(_valuesEnd[property]);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (_yoyo) {\n\t\t\t\t\t\tvar tmp = _valuesStartRepeat[property];\n\n\t\t\t\t\t\t_valuesStartRepeat[property] = _valuesEnd[property];\n\t\t\t\t\t\t_valuesEnd[property] = tmp;\n\t\t\t\t\t}\n\n\t\t\t\t\t_valuesStart[property] = _valuesStartRepeat[property];\n\n\t\t\t\t}\n\n\t\t\t\tif (_yoyo) {\n\t\t\t\t\t_reversed = !_reversed;\n\t\t\t\t}\n\n\t\t\t\tif (_repeatDelayTime !== undefined) {\n\t\t\t\t\t_startTime = time + _repeatDelayTime;\n\t\t\t\t} else {\n\t\t\t\t\t_startTime = time + _delayTime;\n\t\t\t\t}\n\n\t\t\t\treturn true;\n\n\t\t\t} else {\n\n\t\t\t\tif (_onCompleteCallback !== null) {\n\n\t\t\t\t\t_onCompleteCallback.call(_object, _object);\n\t\t\t\t}\n\n\t\t\t\tfor (var i = 0, numChainedTweens = _chainedTweens.length; i < numChainedTweens; i++) {\n\t\t\t\t\t// Make the chained tweens start exactly at the time they should,\n\t\t\t\t\t// even if the `update()` method was called way past the duration of the tween\n\t\t\t\t\t_chainedTweens[i].start(_startTime + _duration);\n\t\t\t\t}\n\n\t\t\t\treturn false;\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn true;\n\n\t};\n\n};\n\n\nTWEEN.Easing = {\n\n\tLinear: {\n\n\t\tNone: function None(k) {\n\n\t\t\treturn k;\n\n\t\t} },\n\n\n\n\tQuadratic: {\n\n\t\tIn: function In(k) {\n\n\t\t\treturn k * k;\n\n\t\t},\n\n\t\tOut: function Out(k) {\n\n\t\t\treturn k * (2 - k);\n\n\t\t},\n\n\t\tInOut: function InOut(k) {\n\n\t\t\tif ((k *= 2) < 1) {\n\t\t\t\treturn 0.5 * k * k;\n\t\t\t}\n\n\t\t\treturn -0.5 * (--k * (k - 2) - 1);\n\n\t\t} },\n\n\n\n\tCubic: {\n\n\t\tIn: function In(k) {\n\n\t\t\treturn k * k * k;\n\n\t\t},\n\n\t\tOut: function Out(k) {\n\n\t\t\treturn --k * k * k + 1;\n\n\t\t},\n\n\t\tInOut: function InOut(k) {\n\n\t\t\tif ((k *= 2) < 1) {\n\t\t\t\treturn 0.5 * k * k * k;\n\t\t\t}\n\n\t\t\treturn 0.5 * ((k -= 2) * k * k + 2);\n\n\t\t} },\n\n\n\n\tQuartic: {\n\n\t\tIn: function In(k) {\n\n\t\t\treturn k * k * k * k;\n\n\t\t},\n\n\t\tOut: function Out(k) {\n\n\t\t\treturn 1 - --k * k * k * k;\n\n\t\t},\n\n\t\tInOut: function InOut(k) {\n\n\t\t\tif ((k *= 2) < 1) {\n\t\t\t\treturn 0.5 * k * k * k * k;\n\t\t\t}\n\n\t\t\treturn -0.5 * ((k -= 2) * k * k * k - 2);\n\n\t\t} },\n\n\n\n\tQuintic: {\n\n\t\tIn: function In(k) {\n\n\t\t\treturn k * k * k * k * k;\n\n\t\t},\n\n\t\tOut: function Out(k) {\n\n\t\t\treturn --k * k * k * k * k + 1;\n\n\t\t},\n\n\t\tInOut: function InOut(k) {\n\n\t\t\tif ((k *= 2) < 1) {\n\t\t\t\treturn 0.5 * k * k * k * k * k;\n\t\t\t}\n\n\t\t\treturn 0.5 * ((k -= 2) * k * k * k * k + 2);\n\n\t\t} },\n\n\n\n\tSinusoidal: {\n\n\t\tIn: function In(k) {\n\n\t\t\treturn 1 - Math.cos(k * Math.PI / 2);\n\n\t\t},\n\n\t\tOut: function Out(k) {\n\n\t\t\treturn Math.sin(k * Math.PI / 2);\n\n\t\t},\n\n\t\tInOut: function InOut(k) {\n\n\t\t\treturn 0.5 * (1 - Math.cos(Math.PI * k));\n\n\t\t} },\n\n\n\n\tExponential: {\n\n\t\tIn: function In(k) {\n\n\t\t\treturn k === 0 ? 0 : Math.pow(1024, k - 1);\n\n\t\t},\n\n\t\tOut: function Out(k) {\n\n\t\t\treturn k === 1 ? 1 : 1 - Math.pow(2, -10 * k);\n\n\t\t},\n\n\t\tInOut: function InOut(k) {\n\n\t\t\tif (k === 0) {\n\t\t\t\treturn 0;\n\t\t\t}\n\n\t\t\tif (k === 1) {\n\t\t\t\treturn 1;\n\t\t\t}\n\n\t\t\tif ((k *= 2) < 1) {\n\t\t\t\treturn 0.5 * Math.pow(1024, k - 1);\n\t\t\t}\n\n\t\t\treturn 0.5 * (-Math.pow(2, -10 * (k - 1)) + 2);\n\n\t\t} },\n\n\n\n\tCircular: {\n\n\t\tIn: function In(k) {\n\n\t\t\treturn 1 - Math.sqrt(1 - k * k);\n\n\t\t},\n\n\t\tOut: function Out(k) {\n\n\t\t\treturn Math.sqrt(1 - --k * k);\n\n\t\t},\n\n\t\tInOut: function InOut(k) {\n\n\t\t\tif ((k *= 2) < 1) {\n\t\t\t\treturn -0.5 * (Math.sqrt(1 - k * k) - 1);\n\t\t\t}\n\n\t\t\treturn 0.5 * (Math.sqrt(1 - (k -= 2) * k) + 1);\n\n\t\t} },\n\n\n\n\tElastic: {\n\n\t\tIn: function In(k) {\n\n\t\t\tif (k === 0) {\n\t\t\t\treturn 0;\n\t\t\t}\n\n\t\t\tif (k === 1) {\n\t\t\t\treturn 1;\n\t\t\t}\n\n\t\t\treturn -Math.pow(2, 10 * (k - 1)) * Math.sin((k - 1.1) * 5 * Math.PI);\n\n\t\t},\n\n\t\tOut: function Out(k) {\n\n\t\t\tif (k === 0) {\n\t\t\t\treturn 0;\n\t\t\t}\n\n\t\t\tif (k === 1) {\n\t\t\t\treturn 1;\n\t\t\t}\n\n\t\t\treturn Math.pow(2, -10 * k) * Math.sin((k - 0.1) * 5 * Math.PI) + 1;\n\n\t\t},\n\n\t\tInOut: function InOut(k) {\n\n\t\t\tif (k === 0) {\n\t\t\t\treturn 0;\n\t\t\t}\n\n\t\t\tif (k === 1) {\n\t\t\t\treturn 1;\n\t\t\t}\n\n\t\t\tk *= 2;\n\n\t\t\tif (k < 1) {\n\t\t\t\treturn -0.5 * Math.pow(2, 10 * (k - 1)) * Math.sin((k - 1.1) * 5 * Math.PI);\n\t\t\t}\n\n\t\t\treturn 0.5 * Math.pow(2, -10 * (k - 1)) * Math.sin((k - 1.1) * 5 * Math.PI) + 1;\n\n\t\t} },\n\n\n\n\tBack: {\n\n\t\tIn: function In(k) {\n\n\t\t\tvar s = 1.70158;\n\n\t\t\treturn k * k * ((s + 1) * k - s);\n\n\t\t},\n\n\t\tOut: function Out(k) {\n\n\t\t\tvar s = 1.70158;\n\n\t\t\treturn --k * k * ((s + 1) * k + s) + 1;\n\n\t\t},\n\n\t\tInOut: function InOut(k) {\n\n\t\t\tvar s = 1.70158 * 1.525;\n\n\t\t\tif ((k *= 2) < 1) {\n\t\t\t\treturn 0.5 * (k * k * ((s + 1) * k - s));\n\t\t\t}\n\n\t\t\treturn 0.5 * ((k -= 2) * k * ((s + 1) * k + s) + 2);\n\n\t\t} },\n\n\n\n\tBounce: {\n\n\t\tIn: function In(k) {\n\n\t\t\treturn 1 - TWEEN.Easing.Bounce.Out(1 - k);\n\n\t\t},\n\n\t\tOut: function Out(k) {\n\n\t\t\tif (k < 1 / 2.75) {\n\t\t\t\treturn 7.5625 * k * k;\n\t\t\t} else if (k < 2 / 2.75) {\n\t\t\t\treturn 7.5625 * (k -= 1.5 / 2.75) * k + 0.75;\n\t\t\t} else if (k < 2.5 / 2.75) {\n\t\t\t\treturn 7.5625 * (k -= 2.25 / 2.75) * k + 0.9375;\n\t\t\t} else {\n\t\t\t\treturn 7.5625 * (k -= 2.625 / 2.75) * k + 0.984375;\n\t\t\t}\n\n\t\t},\n\n\t\tInOut: function InOut(k) {\n\n\t\t\tif (k < 0.5) {\n\t\t\t\treturn TWEEN.Easing.Bounce.In(k * 2) * 0.5;\n\t\t\t}\n\n\t\t\treturn TWEEN.Easing.Bounce.Out(k * 2 - 1) * 0.5 + 0.5;\n\n\t\t} } };\n\n\n\n\n\nTWEEN.Interpolation = {\n\n\tLinear: function Linear(v, k) {\n\n\t\tvar m = v.length - 1;\n\t\tvar f = m * k;\n\t\tvar i = Math.floor(f);\n\t\tvar fn = TWEEN.Interpolation.Utils.Linear;\n\n\t\tif (k < 0) {\n\t\t\treturn fn(v[0], v[1], f);\n\t\t}\n\n\t\tif (k > 1) {\n\t\t\treturn fn(v[m], v[m - 1], m - f);\n\t\t}\n\n\t\treturn fn(v[i], v[i + 1 > m ? m : i + 1], f - i);\n\n\t},\n\n\tBezier: function Bezier(v, k) {\n\n\t\tvar b = 0;\n\t\tvar n = v.length - 1;\n\t\tvar pw = Math.pow;\n\t\tvar bn = TWEEN.Interpolation.Utils.Bernstein;\n\n\t\tfor (var i = 0; i <= n; i++) {\n\t\t\tb += pw(1 - k, n - i) * pw(k, i) * v[i] * bn(n, i);\n\t\t}\n\n\t\treturn b;\n\n\t},\n\n\tCatmullRom: function CatmullRom(v, k) {\n\n\t\tvar m = v.length - 1;\n\t\tvar f = m * k;\n\t\tvar i = Math.floor(f);\n\t\tvar fn = TWEEN.Interpolation.Utils.CatmullRom;\n\n\t\tif (v[0] === v[m]) {\n\n\t\t\tif (k < 0) {\n\t\t\t\ti = Math.floor(f = m * (1 + k));\n\t\t\t}\n\n\t\t\treturn fn(v[(i - 1 + m) % m], v[i], v[(i + 1) % m], v[(i + 2) % m], f - i);\n\n\t\t} else {\n\n\t\t\tif (k < 0) {\n\t\t\t\treturn v[0] - (fn(v[0], v[0], v[1], v[1], -f) - v[0]);\n\t\t\t}\n\n\t\t\tif (k > 1) {\n\t\t\t\treturn v[m] - (fn(v[m], v[m], v[m - 1], v[m - 1], f - m) - v[m]);\n\t\t\t}\n\n\t\t\treturn fn(v[i ? i - 1 : 0], v[i], v[m < i + 1 ? m : i + 1], v[m < i + 2 ? m : i + 2], f - i);\n\n\t\t}\n\n\t},\n\n\tUtils: {\n\n\t\tLinear: function Linear(p0, p1, t) {\n\n\t\t\treturn (p1 - p0) * t + p0;\n\n\t\t},\n\n\t\tBernstein: function Bernstein(n, i) {\n\n\t\t\tvar fc = TWEEN.Interpolation.Utils.Factorial;\n\n\t\t\treturn fc(n) / fc(i) / fc(n - i);\n\n\t\t},\n\n\t\tFactorial: function () {\n\n\t\t\tvar a = [1];\n\n\t\t\treturn function (n) {\n\n\t\t\t\tvar s = 1;\n\n\t\t\t\tif (a[n]) {\n\t\t\t\t\treturn a[n];\n\t\t\t\t}\n\n\t\t\t\tfor (var i = n; i > 1; i--) {\n\t\t\t\t\ts *= i;\n\t\t\t\t}\n\n\t\t\t\ta[n] = s;\n\t\t\t\treturn s;\n\n\t\t\t};\n\n\t\t}(),\n\n\t\tCatmullRom: function CatmullRom(p0, p1, p2, p3, t) {\n\n\t\t\tvar v0 = (p2 - p0) * 0.5;\n\t\t\tvar v1 = (p3 - p1) * 0.5;\n\t\t\tvar t2 = t * t;\n\t\t\tvar t3 = t * t2;\n\n\t\t\treturn (2 * p1 - 2 * p2 + v0 + v1) * t3 + (-3 * p1 + 3 * p2 - 2 * v0 - v1) * t2 + v0 * t + p1;\n\n\t\t} } };\n\n\n\n\n\n// UMD (Universal Module Definition)\n(function (root) {\n\n\tif (true) {\n\n\t\t// AMD\n\t\t!(__WEBPACK_AMD_DEFINE_ARRAY__ = [], __WEBPACK_AMD_DEFINE_RESULT__ = function () {\n\t\t\treturn TWEEN;\n\t\t}.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__),\n\t\t\t\t__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\n\t} else if (typeof module !== 'undefined' && (typeof exports === 'undefined' ? 'undefined' : _typeof(exports)) === 'object') {\n\n\t\t// Node.js\n\t\tmodule.exports = TWEEN;\n\n\t} else if (root !== undefined) {\n\n\t\t// Global variable\n\t\troot.TWEEN = TWEEN;\n\n\t}\n\n})(undefined);\n/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(12)))\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/tween.js/src/Tween.js\n// module id = 13\n// module chunks = 0\n\n//# sourceURL=webpack:///./~/tween.js/src/Tween.js?");

/***/ }),
/* 14 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("var _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) {return typeof obj;} : function (obj) {return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;};var g;\n\n// This works in non-strict mode\ng = function () {\n\treturn this;\n}();\n\ntry {\n\t// This works if eval is allowed (see CSP)\n\tg = g || Function(\"return this\")() || (1, eval)(\"this\");\n} catch (e) {\n\t// This works if the window reference is available\n\tif ((typeof window === \"undefined\" ? \"undefined\" : _typeof(window)) === \"object\")\n\tg = window;\n}\n\n// g can still be undefined, but nothing to do about it...\n// We return undefined, instead of nothing here, so it's\n// easier to handle this case. if(!global) { ...}\n\nmodule.exports = g;\n\n//////////////////\n// WEBPACK FOOTER\n// (webpack)/buildin/global.js\n// module id = 14\n// module chunks = 0\n\n//# sourceURL=webpack:///(webpack)/buildin/global.js?");

/***/ }),
/* 15 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("Object.defineProperty(exports, \"__esModule\", { value: true });var _createClass = function () {function defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if (\"value\" in descriptor) descriptor.writable = true;Object.defineProperty(target, descriptor.key, descriptor);}}return function (Constructor, protoProps, staticProps) {if (protoProps) defineProperties(Constructor.prototype, protoProps);if (staticProps) defineProperties(Constructor, staticProps);return Constructor;};}();var _three = __webpack_require__(0);var THREE = _interopRequireWildcard(_three);\n\nvar _helpers = __webpack_require__(2);var _helpers2 = _interopRequireDefault(_helpers);function _interopRequireDefault(obj) {return obj && obj.__esModule ? obj : { default: obj };}function _interopRequireWildcard(obj) {if (obj && obj.__esModule) {return obj;} else {var newObj = {};if (obj != null) {for (var key in obj) {if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key];}}newObj.default = obj;return newObj;}}function _classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError(\"Cannot call a class as a function\");}}var\n\nSoundTrajectory = function () {\n  function SoundTrajectory(main, points) {_classCallCheck(this, SoundTrajectory);\n    this.type = 'SoundTrajectory';\n    this.splinePoints = points;\n    this.isActive = true;\n    this.pointObjects;\n    this.spline;\n    this.parentSoundObject;\n    this.selectedPoint;\n    this.mouseOffsetX = 0;\n    this.mouseOffsetY = 0;\n    this.nonScaledMouseOffsetY = 0;\n    this.dbRef = main.dbRef;\n    this.roomCode = main.roomCode;\n    this.headKey = null;\n    this.ownerHeadKey = null;\n    if (this.roomCode != null) {\n      this.headKey = main.headKey.key;\n    }\n\n    this.cursor = new THREE.Mesh(\n    new THREE.SphereGeometry(15),\n    new THREE.MeshBasicMaterial({\n      color: 0xff1169,\n      transparent: true,\n      opacity: 0.5 }));\n\n\n    this.cursor.visible = false;\n    main.scene.add(this.cursor);\n    /**\n                                  * First call to renderPath happens in update trajectory function. From there\n                                  * on the function recursively calls itself at the end of each draw.\n                                  */\n    this.renderPath();\n  }\n\n  /**\n     * A recursive function that draws all the THREE geometries, including\n     *\n     * visual and collider spheres as control points on the trajectory spline\n     * (grouped as points in the pointsObjects array),\n     *\n     * the CatmullRom spline that is created from splinePoints, which is populated\n     * under addPoint function below, and repopulated whenever a trajectory is\n     * moved or a control point is removed from the spline,\n     *\n     * and the line geometry which is assigned as a mesh for the said spline for it\n     * to be drawn on screen.\n     */_createClass(SoundTrajectory, [{ key: 'renderPath', value: function renderPath()\n    {\n      var points = this.splinePoints;\n\n      this.pointObjects = function () {\n        var sphere = new THREE.SphereGeometry(10);\n        var sphereMat = new THREE.MeshBasicMaterial({ color: 0x999999 });\n\n        var collider = new THREE.SphereGeometry(20);\n        var colliderMat = new THREE.MeshBasicMaterial({\n          color: 0x999999,\n          transparent: true,\n          opacity: 0,\n          depthWrite: false });\n\n        var colliderMesh = new THREE.Mesh(collider, colliderMat);\n\n        var pointObjects = [];\n\n        points.forEach(function (point) {\n          var sphereMesh = new THREE.Mesh(sphere, sphereMat.clone());\n          var group = new THREE.Object3D();\n\n          group.add(sphereMesh, colliderMesh.clone());\n          group.position.x = point.x;\n          group.position.y = point.y;\n          group.position.z = point.z;\n\n          pointObjects.push(group);\n        });\n\n        return pointObjects;\n      }();\n\n      this.spline = new THREE.CatmullRomCurve3(this.splinePoints);\n      this.spline.type = 'centripetal';\n\n      /*\n                                         * This measures the distance between the start and end points of a trajectory\n                                         * and if the distance is small enough it turnes the spline into a closed curve.\n                                         * This is checked in each frame so that the user can interactively determine\n                                         * if a trajectory is closed (looping) or open (back-and-forth).\n                                         */\n      var begEndDistance = this.splinePoints[0].distanceTo(this.splinePoints[this.splinePoints.length - 1]);\n\n      if (begEndDistance < 40) {\n        this.spline.closed = true;\n      } else {\n        this.spline.closed = false;\n      }\n\n      // const geometry = new THREE.Geometry();\n\n      // geometry.vertices = this.spline.getPoints(200);\n      var geometry = new THREE.BufferGeometry().setFromPoints(this.spline.getPoints(200));\n\n      var material = new THREE.LineBasicMaterial({\n        color: 0x999999,\n        linewidth: 2,\n        opacity: 0.4 });\n\n\n      this.spline.mesh = new THREE.Line(geometry, material);\n    }\n\n    /**\n       * Creates a global object array that includes both the pointObjects (i.e. vectors\n       * for both visible and collider spheres) and the spline mesh which is used to\n       * draw the line that makes up the spline.\n       */ }, { key: 'removeFromScene',\n\n\n\n\n    /**\n                                        * Removes each object in the object array (that pertain to a single\n                                        * trajectory) from the scene.\n                                        */value: function removeFromScene(\n    scene, isUpdating) {\n      if (scene) {\n        this.objects.forEach(function (obj) {\n          scene.remove(obj, true);\n        });\n      }\n      if (!isUpdating) {\n        scene.remove(this.cursor, true);\n      }\n    } }, { key: 'restoreToScene', value: function restoreToScene(\n\n    scene) {\n      this.turnVisible();\n      this.addToScene(scene);\n    }\n\n    /**\n       * Adds each object in the object array (that pertain to a single\n       * trajectory) to the scene.\n       */ }, { key: 'addToScene', value: function addToScene(\n    scene) {\n      if (scene) {\n        this.objects.forEach(function (obj) {\n          scene.add(obj);\n        });\n      }\n    }\n\n    /**\n       * Returns true if a particular object is under the mouse (called from\n       * index.html)\n       */ }, { key: 'isUnderMouse', value: function isUnderMouse(\n    raycaster) {\n      if (this.isActive) {\n        return raycaster.intersectObjects(this.objects, true).length > 0;\n      }\n    }\n\n    /**\n       * Determines if it is a control point or the curve itself that's under the\n       * mouse. Returns the collided object.\n       */ }, { key: 'objectUnderMouse', value: function objectUnderMouse(\n    raycaster) {\n      var intersects = raycaster.intersectObjects(this.objects, true);\n\n      if (intersects.length > 0) {\n        if (intersects[0].object.type === 'Line') {\n          return intersects[Math.floor(intersects.length / 2)];\n        }\n\n        return intersects[0];\n      }\n\n      return null;\n    } }, { key: 'hideCursor', value: function hideCursor()\n\n    {\n      this.cursor.visible = false;\n    } }, { key: 'showCursor', value: function showCursor(\n    object, point) {\n      this.cursor.visible = true;\n      if (object === this.spline.mesh) {\n        this.cursor.position.copy(point);\n      } else\n      {\n        this.cursor.position.copy(object.parent.position);\n      }\n    }\n\n    /* Keeps record of the mouse offset after the initial click. */ }, { key: 'setMouseOffset', value: function setMouseOffset(\n    nonScaledMouse, point) {\n      this.mouseOffsetX = point.x;\n      this.mouseOffsetY = point.z;\n      this.nonScaledMouseOffsetY = nonScaledMouse.y;\n    }\n\n    /* Moves a single control point on the spline or the entire trajectory. */ }, { key: 'move', value: function move(\n    mouse, nonScaledMouse, perspectiveView) {\n      this.hideCursor();\n      if (this.selectedPoint) {\n        var i = this.pointObjects.indexOf(this.selectedPoint);\n        if (i > -1) {\n          /**\n                      * If the camera is in perspective view, the control points can only be\n                      * moved in the Y-axis (height).\n                      */\n          if (perspectiveView) {\n            var dy = nonScaledMouse.y - this.nonScaledMouseOffsetY;\n            dy = _helpers2.default.mapRange(dy, -0.5, 0.5, -200, 200);\n            this.splinePoints[i].y = Math.min(Math.max(this.splinePoints[i].y + dy, -300), 300);\n            this.nonScaledMouseOffsetY = nonScaledMouse.y;\n          } else {\n            /* Otherwise the mouse position vector is copied to the control point. */\n            var pointer = mouse.clone();\n            pointer.y = this.splinePoints[i].y;\n            this.splinePoints[i].copy(pointer);\n          }\n          this.updateTrajectory();\n          this.selectPoint(this.pointObjects[i]);\n        }\n      } else {\n        /**\n               * This moves the entire shape when the parent sound object is moved around.\n               * The same XZ versus Y dimension principles apply depending which view mode\n               * the camera is in.\n               */\n        if (perspectiveView) {\n          var posY = _helpers2.default.mapRange(\n          nonScaledMouse.y - this.nonScaledMouseOffsetY,\n          -0.5,\n          0.5,\n          -200,\n          200);\n\n\n          this.splinePoints.forEach(function (pt) {\n            pt.y = Math.min(Math.max(-300, pt.y + posY), 300);\n          });\n\n          this.nonScaledMouseOffsetY = nonScaledMouse.y;\n        } else {\n          /**\n                 * Mouse movement differentials based on initial click position stored\n                 * in setMouseOffset() is calculated here.\n                 */\n          var dx = mouse.x - this.mouseOffsetX;\n          var _dy = mouse.z - this.mouseOffsetY;\n          this.mouseOffsetX = mouse.x;\n          this.mouseOffsetY = mouse.z;\n\n          /**\n                                        * Maps mouse position differentials to the splinePoints, which are in\n                                        * return used in the render path function to update the trajectories in\n                                        * each frame.\n                                        */\n          this.splinePoints.forEach(function (pt) {\n            pt.x += dx;\n            pt.z += _dy;\n          });\n        }\n\n        this.updateTrajectory();\n\n      }\n\n    }\n\n    /*\n       * Sets position of trajectory if soundobject is copied and placed\n       */ }, { key: 'setCopyPosition', value: function setCopyPosition(\n    position) {\n      var diffX = position.x - this.splinePoints[0].x;\n      var diffY = position.z - this.splinePoints[0].z;\n\n      this.splinePoints.forEach(function (pt) {\n        pt.x += diffX;\n        pt.z += diffY;\n      });\n\n      this.updateTrajectory(true);\n    } }, { key: 'setActive', value: function setActive()\n\n    {\n      this.isActive = true;\n\n      this.pointObjects.forEach(function (obj) {\n        obj.children[0].material.color.setHex(0x999999);\n      });\n\n      this.spline.mesh.material.color.setHex(0x999999);\n    } }, { key: 'setInactive', value: function setInactive()\n\n    {\n      this.hideCursor();\n      this.deselectPoint();\n      this.isActive = false;\n\n      this.pointObjects.forEach(function (obj) {\n        obj.children[0].material.color.setHex(0xcccccc);\n      });\n\n      this.spline.mesh.material.color.setHex(0xcccccc);\n    } }, { key: 'select', value: function select(\n\n    intersect, main) {\n      if (!intersect) return;\n\n      var obj = intersect.object;\n\n      if (obj.type === 'Line') {\n        this.addPoint(intersect.point);\n      } else {\n        this.selectPoint(obj.parent);\n        this.setMouseOffset(main.nonScaledMouse, intersect.point);\n      }\n    } }, { key: 'selectPoint', value: function selectPoint(\n\n    obj) {\n      this.deselectPoint();\n      this.selectedPoint = obj;\n      obj.children[0].material.color.set(0xff0077);\n    } }, { key: 'deselectPoint', value: function deselectPoint()\n\n    {\n      if (this.selectedPoint) {\n        this.selectedPoint.children[0].material.color.set(0x999999);\n        this.selectedPoint = null;\n      }\n    }\n\n    /**\n       * Adds new points to an existing trajectory. Updates the splinePoints array\n       * and calls the updateTrajectory function as a result.\n       */ }, { key: 'addPoint', value: function addPoint(\n    position) {\n      var minDistance = Number.MAX_VALUE;\n      var minPoint = 1;\n      var prevDistToSplinePoint = -1;\n      var closestSplinePoint = 0;\n\n      for (var t = 0; t < 1; t += 1 / 200.0) {\n        var pt = this.spline.getPoint(t);\n\n        var distToSplinePoint = this.splinePoints[closestSplinePoint].distanceToSquared(pt);\n        if (distToSplinePoint > prevDistToSplinePoint) {\n          closestSplinePoint += 1;\n\n          if (closestSplinePoint >= this.splinePoints.length) {\n            closestSplinePoint = 0;\n          }\n        }\n\n        prevDistToSplinePoint = this.splinePoints[closestSplinePoint].distanceToSquared(pt);\n\n        var distToPoint = pt.distanceToSquared(position);\n        if (distToPoint < minDistance) {\n          minDistance = distToPoint;\n          minPoint = closestSplinePoint;\n        }\n      }\n\n      this.splinePoints.splice(minPoint, 0, position);\n      this.updateTrajectory();\n      this.selectPoint(this.pointObjects[minPoint]);\n    }\n\n    /* Removes points from the splinePoints array. */ }, { key: 'removePoint', value: function removePoint()\n    {\n      var i = this.pointObjects.indexOf(this.selectedPoint);\n      this.splinePoints.splice(i, 1);\n      this.deselectPoint();\n      this.updateTrajectory();\n    } }, { key: 'turnVisible', value: function turnVisible()\n\n    {\n      this.spline.mesh.visible = true;\n      this.pointObjects.forEach(function (point) {\n        point.visible = true;\n      });\n    } }, { key: 'turnInvisible', value: function turnInvisible()\n\n    {\n      this.spline.mesh.visible = false;\n      this.pointObjects.forEach(function (point) {\n        point.visible = false;\n      });\n    }\n\n    /**\n       * Updates trajectory by calling renderPath. First called inside addPoint()\n       * and this initates the renderPath() recursion.\n       */ }, { key: 'updateTrajectory', value: function updateTrajectory()\n    {var copy = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : false;\n      var scene = this.spline.mesh.parent;\n      this.removeFromScene(scene, true);\n      this.renderPath();\n      this.addToScene(scene);\n      if (!copy && this.roomCode != null) {\n        if (this.parentSoundObject.type == 'SoundObject') {\n          this.dbRef.child('objects').child(this.parentSoundObject.containerObject.name).update({\n            trajectory: this.splinePoints,\n            lastEdit: this.headKey });\n\n        } else {\n          this.dbRef.child('users').child(this.headKey).update({\n            trajectory: this.splinePoints });\n\n        }\n      }\n    } }, { key: 'updateFirebaseDetails', value: function updateFirebaseDetails(\n\n    dbRef, stoRef, headKey, roomCode) {\n      this.headKey = headKey.key;\n      this.stoRef = stoRef;\n      this.dbRef = dbRef;\n      this.roomCode = roomCode;\n\n      if (this.parentSoundObject.type == 'SoundObject') {\n        this.dbRef.child('objects').child(this.parentSoundObject.containerObject.name).update({\n          trajectory: this.splinePoints,\n          lastEdit: this.headKey });\n\n      } else {\n        this.ownerHeadKey = this.headKey;\n        this.dbRef.child('users').child(this.headKey).update({\n          trajectory: this.splinePoints });\n\n      }\n\n    } }, { key: 'objects', get: function get() {return [].concat(this.pointObjects, this.spline.mesh);} }]);return SoundTrajectory;}();exports.default = SoundTrajectory;\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/js/app/components/soundtrajectory.js\n// module id = 15\n// module chunks = 0\n\n//# sourceURL=webpack:///./src/js/app/components/soundtrajectory.js?");

/***/ }),
/* 16 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("Object.defineProperty(exports, \"__esModule\", { value: true });var _three = __webpack_require__(0);var THREE = _interopRequireWildcard(_three);\n\nvar _config = __webpack_require__(1);var _config2 = _interopRequireDefault(_config);function _interopRequireDefault(obj) {return obj && obj.__esModule ? obj : { default: obj };}function _interopRequireWildcard(obj) {if (obj && obj.__esModule) {return obj;} else {var newObj = {};if (obj != null) {for (var key in obj) {if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key];}}newObj.default = obj;return newObj;}}function _classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError(\"Cannot call a class as a function\");}}\n\n// Use this class as a helper to set up some default materials\nvar Material =\nfunction Material(color) {_classCallCheck(this, Material);\n  this.basic = new THREE.MeshBasicMaterial({\n    color: color,\n    side: THREE.DoubleSide });\n\n\n  this.standard = new THREE.MeshStandardMaterial({\n    color: color,\n    side: THREE.DoubleSide,\n    visible: false });\n\n\n  this.wire = new THREE.MeshBasicMaterial({ wireframe: false });\n};exports.default = Material;\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/js/app/helpers/material.js\n// module id = 16\n// module chunks = 0\n\n//# sourceURL=webpack:///./src/js/app/helpers/material.js?");

/***/ }),
/* 17 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("/* WEBPACK VAR INJECTION */(function(module) {var _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) {return typeof obj;} : function (obj) {return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;}; /**\n                                                                                                                                                                                                                                                                                        * Copyright (c) 2014-present, Facebook, Inc.\n                                                                                                                                                                                                                                                                                        *\n                                                                                                                                                                                                                                                                                        * This source code is licensed under the MIT license found in the\n                                                                                                                                                                                                                                                                                        * LICENSE file in the root directory of this source tree.\n                                                                                                                                                                                                                                                                                        */\n\nvar runtime = function (exports) {\n  \"use strict\";\n\n  var Op = Object.prototype;\n  var hasOwn = Op.hasOwnProperty;\n  var undefined; // More compressible than void 0.\n  var $Symbol = typeof Symbol === \"function\" ? Symbol : {};\n  var iteratorSymbol = $Symbol.iterator || \"@@iterator\";\n  var asyncIteratorSymbol = $Symbol.asyncIterator || \"@@asyncIterator\";\n  var toStringTagSymbol = $Symbol.toStringTag || \"@@toStringTag\";\n\n  function define(obj, key, value) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true });\n\n    return obj[key];\n  }\n  try {\n    // IE 8 has a broken Object.defineProperty that only works on DOM objects.\n    define({}, \"\");\n  } catch (err) {\n    define = function define(obj, key, value) {\n      return obj[key] = value;\n    };\n  }\n\n  function wrap(innerFn, outerFn, self, tryLocsList) {\n    // If outerFn provided and outerFn.prototype is a Generator, then outerFn.prototype instanceof Generator.\n    var protoGenerator = outerFn && outerFn.prototype instanceof Generator ? outerFn : Generator;\n    var generator = Object.create(protoGenerator.prototype);\n    var context = new Context(tryLocsList || []);\n\n    // The ._invoke method unifies the implementations of the .next,\n    // .throw, and .return methods.\n    generator._invoke = makeInvokeMethod(innerFn, self, context);\n\n    return generator;\n  }\n  exports.wrap = wrap;\n\n  // Try/catch helper to minimize deoptimizations. Returns a completion\n  // record like context.tryEntries[i].completion. This interface could\n  // have been (and was previously) designed to take a closure to be\n  // invoked without arguments, but in all the cases we care about we\n  // already have an existing method we want to call, so there's no need\n  // to create a new function object. We can even get away with assuming\n  // the method takes exactly one argument, since that happens to be true\n  // in every case, so we don't have to touch the arguments object. The\n  // only additional allocation required is the completion record, which\n  // has a stable shape and so hopefully should be cheap to allocate.\n  function tryCatch(fn, obj, arg) {\n    try {\n      return { type: \"normal\", arg: fn.call(obj, arg) };\n    } catch (err) {\n      return { type: \"throw\", arg: err };\n    }\n  }\n\n  var GenStateSuspendedStart = \"suspendedStart\";\n  var GenStateSuspendedYield = \"suspendedYield\";\n  var GenStateExecuting = \"executing\";\n  var GenStateCompleted = \"completed\";\n\n  // Returning this object from the innerFn has the same effect as\n  // breaking out of the dispatch switch statement.\n  var ContinueSentinel = {};\n\n  // Dummy constructor functions that we use as the .constructor and\n  // .constructor.prototype properties for functions that return Generator\n  // objects. For full spec compliance, you may wish to configure your\n  // minifier not to mangle the names of these two functions.\n  function Generator() {}\n  function GeneratorFunction() {}\n  function GeneratorFunctionPrototype() {}\n\n  // This is a polyfill for %IteratorPrototype% for environments that\n  // don't natively support it.\n  var IteratorPrototype = {};\n  define(IteratorPrototype, iteratorSymbol, function () {\n    return this;\n  });\n\n  var getProto = Object.getPrototypeOf;\n  var NativeIteratorPrototype = getProto && getProto(getProto(values([])));\n  if (NativeIteratorPrototype &&\n  NativeIteratorPrototype !== Op &&\n  hasOwn.call(NativeIteratorPrototype, iteratorSymbol)) {\n    // This environment has a native %IteratorPrototype%; use it instead\n    // of the polyfill.\n    IteratorPrototype = NativeIteratorPrototype;\n  }\n\n  var Gp = GeneratorFunctionPrototype.prototype =\n  Generator.prototype = Object.create(IteratorPrototype);\n  GeneratorFunction.prototype = GeneratorFunctionPrototype;\n  define(Gp, \"constructor\", GeneratorFunctionPrototype);\n  define(GeneratorFunctionPrototype, \"constructor\", GeneratorFunction);\n  GeneratorFunction.displayName = define(\n  GeneratorFunctionPrototype,\n  toStringTagSymbol,\n  \"GeneratorFunction\");\n\n\n  // Helper for defining the .next, .throw, and .return methods of the\n  // Iterator interface in terms of a single ._invoke method.\n  function defineIteratorMethods(prototype) {\n    [\"next\", \"throw\", \"return\"].forEach(function (method) {\n      define(prototype, method, function (arg) {\n        return this._invoke(method, arg);\n      });\n    });\n  }\n\n  exports.isGeneratorFunction = function (genFun) {\n    var ctor = typeof genFun === \"function\" && genFun.constructor;\n    return ctor ?\n    ctor === GeneratorFunction ||\n    // For the native GeneratorFunction constructor, the best we can\n    // do is to check its .name property.\n    (ctor.displayName || ctor.name) === \"GeneratorFunction\" :\n    false;\n  };\n\n  exports.mark = function (genFun) {\n    if (Object.setPrototypeOf) {\n      Object.setPrototypeOf(genFun, GeneratorFunctionPrototype);\n    } else {\n      genFun.__proto__ = GeneratorFunctionPrototype;\n      define(genFun, toStringTagSymbol, \"GeneratorFunction\");\n    }\n    genFun.prototype = Object.create(Gp);\n    return genFun;\n  };\n\n  // Within the body of any async function, `await x` is transformed to\n  // `yield regeneratorRuntime.awrap(x)`, so that the runtime can test\n  // `hasOwn.call(value, \"__await\")` to determine if the yielded value is\n  // meant to be awaited.\n  exports.awrap = function (arg) {\n    return { __await: arg };\n  };\n\n  function AsyncIterator(generator, PromiseImpl) {\n    function invoke(method, arg, resolve, reject) {\n      var record = tryCatch(generator[method], generator, arg);\n      if (record.type === \"throw\") {\n        reject(record.arg);\n      } else {\n        var result = record.arg;\n        var value = result.value;\n        if (value &&\n        (typeof value === \"undefined\" ? \"undefined\" : _typeof(value)) === \"object\" &&\n        hasOwn.call(value, \"__await\")) {\n          return PromiseImpl.resolve(value.__await).then(function (value) {\n            invoke(\"next\", value, resolve, reject);\n          }, function (err) {\n            invoke(\"throw\", err, resolve, reject);\n          });\n        }\n\n        return PromiseImpl.resolve(value).then(function (unwrapped) {\n          // When a yielded Promise is resolved, its final value becomes\n          // the .value of the Promise<{value,done}> result for the\n          // current iteration.\n          result.value = unwrapped;\n          resolve(result);\n        }, function (error) {\n          // If a rejected Promise was yielded, throw the rejection back\n          // into the async generator function so it can be handled there.\n          return invoke(\"throw\", error, resolve, reject);\n        });\n      }\n    }\n\n    var previousPromise;\n\n    function enqueue(method, arg) {\n      function callInvokeWithMethodAndArg() {\n        return new PromiseImpl(function (resolve, reject) {\n          invoke(method, arg, resolve, reject);\n        });\n      }\n\n      return previousPromise =\n      // If enqueue has been called before, then we want to wait until\n      // all previous Promises have been resolved before calling invoke,\n      // so that results are always delivered in the correct order. If\n      // enqueue has not been called before, then it is important to\n      // call invoke immediately, without waiting on a callback to fire,\n      // so that the async generator function has the opportunity to do\n      // any necessary setup in a predictable way. This predictability\n      // is why the Promise constructor synchronously invokes its\n      // executor callback, and why async functions synchronously\n      // execute code before the first await. Since we implement simple\n      // async functions in terms of async generators, it is especially\n      // important to get this right, even though it requires care.\n      previousPromise ? previousPromise.then(\n      callInvokeWithMethodAndArg,\n      // Avoid propagating failures to Promises returned by later\n      // invocations of the iterator.\n      callInvokeWithMethodAndArg) :\n      callInvokeWithMethodAndArg();\n    }\n\n    // Define the unified helper method that is used to implement .next,\n    // .throw, and .return (see defineIteratorMethods).\n    this._invoke = enqueue;\n  }\n\n  defineIteratorMethods(AsyncIterator.prototype);\n  define(AsyncIterator.prototype, asyncIteratorSymbol, function () {\n    return this;\n  });\n  exports.AsyncIterator = AsyncIterator;\n\n  // Note that simple async functions are implemented on top of\n  // AsyncIterator objects; they just return a Promise for the value of\n  // the final result produced by the iterator.\n  exports.async = function (innerFn, outerFn, self, tryLocsList, PromiseImpl) {\n    if (PromiseImpl === void 0) PromiseImpl = Promise;\n\n    var iter = new AsyncIterator(\n    wrap(innerFn, outerFn, self, tryLocsList),\n    PromiseImpl);\n\n\n    return exports.isGeneratorFunction(outerFn) ?\n    iter // If outerFn is a generator, return the full iterator.\n    : iter.next().then(function (result) {\n      return result.done ? result.value : iter.next();\n    });\n  };\n\n  function makeInvokeMethod(innerFn, self, context) {\n    var state = GenStateSuspendedStart;\n\n    return function invoke(method, arg) {\n      if (state === GenStateExecuting) {\n        throw new Error(\"Generator is already running\");\n      }\n\n      if (state === GenStateCompleted) {\n        if (method === \"throw\") {\n          throw arg;\n        }\n\n        // Be forgiving, per 25.3.3.3.3 of the spec:\n        // https://people.mozilla.org/~jorendorff/es6-draft.html#sec-generatorresume\n        return doneResult();\n      }\n\n      context.method = method;\n      context.arg = arg;\n\n      while (true) {\n        var delegate = context.delegate;\n        if (delegate) {\n          var delegateResult = maybeInvokeDelegate(delegate, context);\n          if (delegateResult) {\n            if (delegateResult === ContinueSentinel) continue;\n            return delegateResult;\n          }\n        }\n\n        if (context.method === \"next\") {\n          // Setting context._sent for legacy support of Babel's\n          // function.sent implementation.\n          context.sent = context._sent = context.arg;\n\n        } else if (context.method === \"throw\") {\n          if (state === GenStateSuspendedStart) {\n            state = GenStateCompleted;\n            throw context.arg;\n          }\n\n          context.dispatchException(context.arg);\n\n        } else if (context.method === \"return\") {\n          context.abrupt(\"return\", context.arg);\n        }\n\n        state = GenStateExecuting;\n\n        var record = tryCatch(innerFn, self, context);\n        if (record.type === \"normal\") {\n          // If an exception is thrown from innerFn, we leave state ===\n          // GenStateExecuting and loop back for another invocation.\n          state = context.done ?\n          GenStateCompleted :\n          GenStateSuspendedYield;\n\n          if (record.arg === ContinueSentinel) {\n            continue;\n          }\n\n          return {\n            value: record.arg,\n            done: context.done };\n\n\n        } else if (record.type === \"throw\") {\n          state = GenStateCompleted;\n          // Dispatch the exception by looping back around to the\n          // context.dispatchException(context.arg) call above.\n          context.method = \"throw\";\n          context.arg = record.arg;\n        }\n      }\n    };\n  }\n\n  // Call delegate.iterator[context.method](context.arg) and handle the\n  // result, either by returning a { value, done } result from the\n  // delegate iterator, or by modifying context.method and context.arg,\n  // setting context.delegate to null, and returning the ContinueSentinel.\n  function maybeInvokeDelegate(delegate, context) {\n    var method = delegate.iterator[context.method];\n    if (method === undefined) {\n      // A .throw or .return when the delegate iterator has no .throw\n      // method always terminates the yield* loop.\n      context.delegate = null;\n\n      if (context.method === \"throw\") {\n        // Note: [\"return\"] must be used for ES3 parsing compatibility.\n        if (delegate.iterator[\"return\"]) {\n          // If the delegate iterator has a return method, give it a\n          // chance to clean up.\n          context.method = \"return\";\n          context.arg = undefined;\n          maybeInvokeDelegate(delegate, context);\n\n          if (context.method === \"throw\") {\n            // If maybeInvokeDelegate(context) changed context.method from\n            // \"return\" to \"throw\", let that override the TypeError below.\n            return ContinueSentinel;\n          }\n        }\n\n        context.method = \"throw\";\n        context.arg = new TypeError(\n        \"The iterator does not provide a 'throw' method\");\n      }\n\n      return ContinueSentinel;\n    }\n\n    var record = tryCatch(method, delegate.iterator, context.arg);\n\n    if (record.type === \"throw\") {\n      context.method = \"throw\";\n      context.arg = record.arg;\n      context.delegate = null;\n      return ContinueSentinel;\n    }\n\n    var info = record.arg;\n\n    if (!info) {\n      context.method = \"throw\";\n      context.arg = new TypeError(\"iterator result is not an object\");\n      context.delegate = null;\n      return ContinueSentinel;\n    }\n\n    if (info.done) {\n      // Assign the result of the finished delegate to the temporary\n      // variable specified by delegate.resultName (see delegateYield).\n      context[delegate.resultName] = info.value;\n\n      // Resume execution at the desired location (see delegateYield).\n      context.next = delegate.nextLoc;\n\n      // If context.method was \"throw\" but the delegate handled the\n      // exception, let the outer generator proceed normally. If\n      // context.method was \"next\", forget context.arg since it has been\n      // \"consumed\" by the delegate iterator. If context.method was\n      // \"return\", allow the original .return call to continue in the\n      // outer generator.\n      if (context.method !== \"return\") {\n        context.method = \"next\";\n        context.arg = undefined;\n      }\n\n    } else {\n      // Re-yield the result returned by the delegate method.\n      return info;\n    }\n\n    // The delegate iterator is finished, so forget it and continue with\n    // the outer generator.\n    context.delegate = null;\n    return ContinueSentinel;\n  }\n\n  // Define Generator.prototype.{next,throw,return} in terms of the\n  // unified ._invoke helper method.\n  defineIteratorMethods(Gp);\n\n  define(Gp, toStringTagSymbol, \"Generator\");\n\n  // A Generator should always return itself as the iterator object when the\n  // @@iterator function is called on it. Some browsers' implementations of the\n  // iterator prototype chain incorrectly implement this, causing the Generator\n  // object to not be returned from this call. This ensures that doesn't happen.\n  // See https://github.com/facebook/regenerator/issues/274 for more details.\n  define(Gp, iteratorSymbol, function () {\n    return this;\n  });\n\n  define(Gp, \"toString\", function () {\n    return \"[object Generator]\";\n  });\n\n  function pushTryEntry(locs) {\n    var entry = { tryLoc: locs[0] };\n\n    if (1 in locs) {\n      entry.catchLoc = locs[1];\n    }\n\n    if (2 in locs) {\n      entry.finallyLoc = locs[2];\n      entry.afterLoc = locs[3];\n    }\n\n    this.tryEntries.push(entry);\n  }\n\n  function resetTryEntry(entry) {\n    var record = entry.completion || {};\n    record.type = \"normal\";\n    delete record.arg;\n    entry.completion = record;\n  }\n\n  function Context(tryLocsList) {\n    // The root entry object (effectively a try statement without a catch\n    // or a finally block) gives us a place to store values thrown from\n    // locations where there is no enclosing try statement.\n    this.tryEntries = [{ tryLoc: \"root\" }];\n    tryLocsList.forEach(pushTryEntry, this);\n    this.reset(true);\n  }\n\n  exports.keys = function (object) {\n    var keys = [];\n    for (var key in object) {\n      keys.push(key);\n    }\n    keys.reverse();\n\n    // Rather than returning an object with a next method, we keep\n    // things simple and return the next function itself.\n    return function next() {\n      while (keys.length) {\n        var key = keys.pop();\n        if (key in object) {\n          next.value = key;\n          next.done = false;\n          return next;\n        }\n      }\n\n      // To avoid creating an additional object, we just hang the .value\n      // and .done properties off the next function object itself. This\n      // also ensures that the minifier will not anonymize the function.\n      next.done = true;\n      return next;\n    };\n  };\n\n  function values(iterable) {\n    if (iterable) {\n      var iteratorMethod = iterable[iteratorSymbol];\n      if (iteratorMethod) {\n        return iteratorMethod.call(iterable);\n      }\n\n      if (typeof iterable.next === \"function\") {\n        return iterable;\n      }\n\n      if (!isNaN(iterable.length)) {\n        var i = -1,next = function next() {\n          while (++i < iterable.length) {\n            if (hasOwn.call(iterable, i)) {\n              next.value = iterable[i];\n              next.done = false;\n              return next;\n            }\n          }\n\n          next.value = undefined;\n          next.done = true;\n\n          return next;\n        };\n\n        return next.next = next;\n      }\n    }\n\n    // Return an iterator with no values.\n    return { next: doneResult };\n  }\n  exports.values = values;\n\n  function doneResult() {\n    return { value: undefined, done: true };\n  }\n\n  Context.prototype = {\n    constructor: Context,\n\n    reset: function reset(skipTempReset) {\n      this.prev = 0;\n      this.next = 0;\n      // Resetting context._sent for legacy support of Babel's\n      // function.sent implementation.\n      this.sent = this._sent = undefined;\n      this.done = false;\n      this.delegate = null;\n\n      this.method = \"next\";\n      this.arg = undefined;\n\n      this.tryEntries.forEach(resetTryEntry);\n\n      if (!skipTempReset) {\n        for (var name in this) {\n          // Not sure about the optimal order of these conditions:\n          if (name.charAt(0) === \"t\" &&\n          hasOwn.call(this, name) &&\n          !isNaN(+name.slice(1))) {\n            this[name] = undefined;\n          }\n        }\n      }\n    },\n\n    stop: function stop() {\n      this.done = true;\n\n      var rootEntry = this.tryEntries[0];\n      var rootRecord = rootEntry.completion;\n      if (rootRecord.type === \"throw\") {\n        throw rootRecord.arg;\n      }\n\n      return this.rval;\n    },\n\n    dispatchException: function dispatchException(exception) {\n      if (this.done) {\n        throw exception;\n      }\n\n      var context = this;\n      function handle(loc, caught) {\n        record.type = \"throw\";\n        record.arg = exception;\n        context.next = loc;\n\n        if (caught) {\n          // If the dispatched exception was caught by a catch block,\n          // then let that catch block handle the exception normally.\n          context.method = \"next\";\n          context.arg = undefined;\n        }\n\n        return !!caught;\n      }\n\n      for (var i = this.tryEntries.length - 1; i >= 0; --i) {\n        var entry = this.tryEntries[i];\n        var record = entry.completion;\n\n        if (entry.tryLoc === \"root\") {\n          // Exception thrown outside of any try block that could handle\n          // it, so set the completion value of the entire function to\n          // throw the exception.\n          return handle(\"end\");\n        }\n\n        if (entry.tryLoc <= this.prev) {\n          var hasCatch = hasOwn.call(entry, \"catchLoc\");\n          var hasFinally = hasOwn.call(entry, \"finallyLoc\");\n\n          if (hasCatch && hasFinally) {\n            if (this.prev < entry.catchLoc) {\n              return handle(entry.catchLoc, true);\n            } else if (this.prev < entry.finallyLoc) {\n              return handle(entry.finallyLoc);\n            }\n\n          } else if (hasCatch) {\n            if (this.prev < entry.catchLoc) {\n              return handle(entry.catchLoc, true);\n            }\n\n          } else if (hasFinally) {\n            if (this.prev < entry.finallyLoc) {\n              return handle(entry.finallyLoc);\n            }\n\n          } else {\n            throw new Error(\"try statement without catch or finally\");\n          }\n        }\n      }\n    },\n\n    abrupt: function abrupt(type, arg) {\n      for (var i = this.tryEntries.length - 1; i >= 0; --i) {\n        var entry = this.tryEntries[i];\n        if (entry.tryLoc <= this.prev &&\n        hasOwn.call(entry, \"finallyLoc\") &&\n        this.prev < entry.finallyLoc) {\n          var finallyEntry = entry;\n          break;\n        }\n      }\n\n      if (finallyEntry && (\n      type === \"break\" ||\n      type === \"continue\") &&\n      finallyEntry.tryLoc <= arg &&\n      arg <= finallyEntry.finallyLoc) {\n        // Ignore the finally entry if control is not jumping to a\n        // location outside the try/catch block.\n        finallyEntry = null;\n      }\n\n      var record = finallyEntry ? finallyEntry.completion : {};\n      record.type = type;\n      record.arg = arg;\n\n      if (finallyEntry) {\n        this.method = \"next\";\n        this.next = finallyEntry.finallyLoc;\n        return ContinueSentinel;\n      }\n\n      return this.complete(record);\n    },\n\n    complete: function complete(record, afterLoc) {\n      if (record.type === \"throw\") {\n        throw record.arg;\n      }\n\n      if (record.type === \"break\" ||\n      record.type === \"continue\") {\n        this.next = record.arg;\n      } else if (record.type === \"return\") {\n        this.rval = this.arg = record.arg;\n        this.method = \"return\";\n        this.next = \"end\";\n      } else if (record.type === \"normal\" && afterLoc) {\n        this.next = afterLoc;\n      }\n\n      return ContinueSentinel;\n    },\n\n    finish: function finish(finallyLoc) {\n      for (var i = this.tryEntries.length - 1; i >= 0; --i) {\n        var entry = this.tryEntries[i];\n        if (entry.finallyLoc === finallyLoc) {\n          this.complete(entry.completion, entry.afterLoc);\n          resetTryEntry(entry);\n          return ContinueSentinel;\n        }\n      }\n    },\n\n    \"catch\": function _catch(tryLoc) {\n      for (var i = this.tryEntries.length - 1; i >= 0; --i) {\n        var entry = this.tryEntries[i];\n        if (entry.tryLoc === tryLoc) {\n          var record = entry.completion;\n          if (record.type === \"throw\") {\n            var thrown = record.arg;\n            resetTryEntry(entry);\n          }\n          return thrown;\n        }\n      }\n\n      // The context.catch method must only be called with a location\n      // argument that corresponds to a known catch block.\n      throw new Error(\"illegal catch attempt\");\n    },\n\n    delegateYield: function delegateYield(iterable, resultName, nextLoc) {\n      this.delegate = {\n        iterator: values(iterable),\n        resultName: resultName,\n        nextLoc: nextLoc };\n\n\n      if (this.method === \"next\") {\n        // Deliberately forget the last sent value so that we don't\n        // accidentally pass it on to the delegate.\n        this.arg = undefined;\n      }\n\n      return ContinueSentinel;\n    } };\n\n\n  // Regardless of whether this script is executing as a CommonJS module\n  // or not, return the runtime object so that we can declare the variable\n  // regeneratorRuntime in the outer scope, which allows this module to be\n  // injected easily by `bin/regenerator --include-runtime script.js`.\n  return exports;\n\n}(\n// If this script is executing as a CommonJS module, use module.exports\n// as the regeneratorRuntime namespace. Otherwise create a new empty\n// object. Either way, the resulting object will be used to initialize\n// the regeneratorRuntime variable at the top of this file.\n( false ? \"undefined\" : _typeof(module)) === \"object\" ? module.exports : {});\n\n\ntry {\n  regeneratorRuntime = runtime;\n} catch (accidentalStrictMode) {\n  // This module should not be running in strict mode, so the above\n  // assignment should always work unless something is misconfigured. Just\n  // in case runtime.js accidentally runs in strict mode, in modern engines\n  // we can explicitly access globalThis. In older engines we can escape\n  // strict mode using a global Function call. This could conceivably fail\n  // if a Content Security Policy forbids using Function, but in that case\n  // the proper solution is to fix the accidental strict mode problem. If\n  // you've misconfigured your bundler to force strict mode and applied a\n  // CSP to forbid Function, and you're not willing to fix either of those\n  // problems, please detail your unique predicament in a GitHub issue.\n  if ((typeof globalThis === \"undefined\" ? \"undefined\" : _typeof(globalThis)) === \"object\") {\n    globalThis.regeneratorRuntime = runtime;\n  } else {\n    Function(\"r\", \"regeneratorRuntime = r\")(runtime);\n  }\n}\n/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(26)(module)))\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/regenerator-runtime/runtime.js\n// module id = 17\n// module chunks = 0\n\n//# sourceURL=webpack:///./~/regenerator-runtime/runtime.js?");

/***/ }),
/* 18 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("var _config = __webpack_require__(1);var _config2 = _interopRequireDefault(_config);\nvar _detector = __webpack_require__(40);var _detector2 = _interopRequireDefault(_detector);\nvar _main = __webpack_require__(35);var _main2 = _interopRequireDefault(_main);function _interopRequireDefault(obj) {return obj && obj.__esModule ? obj : { default: obj };}\n\n// Check environment and set the Config helper\nif (true) {\n  console.log('----- RUNNING IN DEV ENVIRONMENT! -----');\n\n  _config2.default.isDev = true;\n}\n\nfunction init() {\n  // Check for webGL capabilities\n  if (!_detector2.default.webgl) {\n    _detector2.default.addGetWebGLMessage();\n  } else {\n    var container = document.getElementById('appContainer');\n    new _main2.default(container);\n  }\n}\n\ninit();\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/js/app.js\n// module id = 18\n// module chunks = 0\n\n//# sourceURL=webpack:///./src/js/app.js?");

/***/ }),
/* 19 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("/* WEBPACK VAR INJECTION */(function(global) {var _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) {return typeof obj;} : function (obj) {return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;};(function () {var firebase = __webpack_require__(6).default; /*\n                                                                                                                                                                                                                                                                                                                                                     Copyright The Closure Library Authors.\n                                                                                                                                                                                                                                                                                                                                                     SPDX-License-Identifier: Apache-2.0\n                                                                                                                                                                                                                                                                                                                                                     */\n\n  var k,aa = \"function\" == typeof Object.defineProperties ? Object.defineProperty : function (a, b, c) {a != Array.prototype && a != Object.prototype && (a[b] = c.value);};function ba(a) {a = [\"object\" == (typeof window === \"undefined\" ? \"undefined\" : _typeof(window)) && window, \"object\" == (typeof self === \"undefined\" ? \"undefined\" : _typeof(self)) && self, \"object\" == (typeof global === \"undefined\" ? \"undefined\" : _typeof(global)) && global, a];for (var b = 0; b < a.length; ++b) {var c = a[b];if (c && c.Math == Math) return c;}return globalThis;}var ca = ba(this);\n  function da(a, b) {if (b) {var c = ca;a = a.split(\".\");for (var d = 0; d < a.length - 1; d++) {var e = a[d];e in c || (c[e] = {});c = c[e];}a = a[a.length - 1];d = c[a];b = b(d);b != d && null != b && aa(c, a, { configurable: !0, writable: !0, value: b });}}function ea(a) {var b = 0;return function () {return b < a.length ? { done: !1, value: a[b++] } : { done: !0 };};}function fa(a) {var b = \"undefined\" != typeof Symbol && Symbol.iterator && a[Symbol.iterator];return b ? b.call(a) : { next: ea(a) };}\n  da(\"Promise\", function (a) {function b(g) {this.b = 0;this.c = void 0;this.a = [];var h = this.f();try {g(h.resolve, h.reject);} catch (m) {h.reject(m);}}function c() {this.a = null;}function d(g) {return g instanceof b ? g : new b(function (h) {h(g);});}if (a) return a;c.prototype.b = function (g) {if (null == this.a) {this.a = [];var h = this;this.c(function () {h.g();});}this.a.push(g);};var e = ca.setTimeout;c.prototype.c = function (g) {e(g, 0);};c.prototype.g = function () {for (; this.a && this.a.length;) {var g = this.a;this.a = [];for (var h = 0; h < g.length; ++h) {var m =\n          g[h];g[h] = null;try {m();} catch (p) {this.f(p);}}}this.a = null;};c.prototype.f = function (g) {this.c(function () {throw g;});};b.prototype.f = function () {function g(p) {return function (v) {m || (m = !0, p.call(h, v));};}var h = this,m = !1;return { resolve: g(this.v), reject: g(this.g) };};b.prototype.v = function (g) {if (g === this) this.g(new TypeError(\"A Promise cannot resolve to itself\"));else if (g instanceof b) this.o(g);else {a: switch (typeof g === \"undefined\" ? \"undefined\" : _typeof(g)) {case \"object\":var h = null != g;break a;case \"function\":h = !0;break a;default:h = !1;}h ? this.m(g) : this.h(g);}};\n    b.prototype.m = function (g) {var h = void 0;try {h = g.then;} catch (m) {this.g(m);return;}\"function\" == typeof h ? this.u(h, g) : this.h(g);};b.prototype.g = function (g) {this.i(2, g);};b.prototype.h = function (g) {this.i(1, g);};b.prototype.i = function (g, h) {if (0 != this.b) throw Error(\"Cannot settle(\" + g + \", \" + h + \"): Promise already settled in state\" + this.b);this.b = g;this.c = h;this.l();};b.prototype.l = function () {if (null != this.a) {for (var g = 0; g < this.a.length; ++g) {f.b(this.a[g]);}this.a = null;}};var f = new c();b.prototype.o = function (g) {var h = this.f();\n      g.Pa(h.resolve, h.reject);};b.prototype.u = function (g, h) {var m = this.f();try {g.call(h, m.resolve, m.reject);} catch (p) {m.reject(p);}};b.prototype.then = function (g, h) {function m(A, Q) {return \"function\" == typeof A ? function (xa) {try {p(A(xa));} catch (yd) {v(yd);}} : Q;}var p,v,B = new b(function (A, Q) {p = A;v = Q;});this.Pa(m(g, p), m(h, v));return B;};b.prototype.catch = function (g) {return this.then(void 0, g);};b.prototype.Pa = function (g, h) {function m() {switch (p.b) {case 1:g(p.c);break;case 2:h(p.c);break;default:throw Error(\"Unexpected state: \" +\n            p.b);}}var p = this;null == this.a ? f.b(m) : this.a.push(m);};b.resolve = d;b.reject = function (g) {return new b(function (h, m) {m(g);});};b.race = function (g) {return new b(function (h, m) {for (var p = fa(g), v = p.next(); !v.done; v = p.next()) {d(v.value).Pa(h, m);}});};b.all = function (g) {var h = fa(g),m = h.next();return m.done ? d([]) : new b(function (p, v) {function B(xa) {return function (yd) {A[xa] = yd;Q--;0 == Q && p(A);};}var A = [],Q = 0;do {A.push(void 0), Q++, d(m.value).Pa(B(A.length - 1), v), m = h.next();} while (!m.done);});};return b;});\n  var ha = ha || {},l = this || self,ia = /^[\\w+/_-]+[=]{0,2}$/,ja = null;function ka() {}\n  function la(a) {var b = typeof a === \"undefined\" ? \"undefined\" : _typeof(a);if (\"object\" == b) {if (a) {if (a instanceof Array) return \"array\";if (a instanceof Object) return b;var c = Object.prototype.toString.call(a);if (\"[object Window]\" == c) return \"object\";if (\"[object Array]\" == c || \"number\" == typeof a.length && \"undefined\" != typeof a.splice && \"undefined\" != typeof a.propertyIsEnumerable && !a.propertyIsEnumerable(\"splice\")) return \"array\";if (\"[object Function]\" == c || \"undefined\" != typeof a.call && \"undefined\" != typeof a.propertyIsEnumerable && !a.propertyIsEnumerable(\"call\")) return \"function\";} else return \"null\";} else\n    if (\"function\" == b && \"undefined\" == typeof a.call) return \"object\";return b;}function ma(a) {var b = la(a);return \"array\" == b || \"object\" == b && \"number\" == typeof a.length;}function na(a) {return \"function\" == la(a);}function n(a) {var b = typeof a === \"undefined\" ? \"undefined\" : _typeof(a);return \"object\" == b && null != a || \"function\" == b;}function oa(a) {return Object.prototype.hasOwnProperty.call(a, pa) && a[pa] || (a[pa] = ++qa);}var pa = \"closure_uid_\" + (1E9 * Math.random() >>> 0),qa = 0;function ra(a, b, c) {return a.call.apply(a.bind, arguments);}\n  function sa(a, b, c) {if (!a) throw Error();if (2 < arguments.length) {var d = Array.prototype.slice.call(arguments, 2);return function () {var e = Array.prototype.slice.call(arguments);Array.prototype.unshift.apply(e, d);return a.apply(b, e);};}return function () {return a.apply(b, arguments);};}function q(a, b, c) {Function.prototype.bind && -1 != Function.prototype.bind.toString().indexOf(\"native code\") ? q = ra : q = sa;return q.apply(null, arguments);}\n  function ta(a, b) {var c = Array.prototype.slice.call(arguments, 1);return function () {var d = c.slice();d.push.apply(d, arguments);return a.apply(this, d);};}var ua = Date.now || function () {return +new Date();};function r(a, b) {function c() {}c.prototype = b.prototype;a.$a = b.prototype;a.prototype = new c();a.prototype.constructor = a;}; /*\n                                                                                                                                                                                                                                                                                                                                                            Copyright 2017 Google Inc.\n                                                                                                                                                                                                                                                                                                                                                            Licensed under the Apache License, Version 2.0 (the \"License\");\n                                                                                                                                                                                                                                                                                                                                                            you may not use this file except in compliance with the License.\n                                                                                                                                                                                                                                                                                                                                                            You may obtain a copy of the License at\n                                                                                                                                                                                                                                                                                                                                                            http://www.apache.org/licenses/LICENSE-2.0\n                                                                                                                                                                                                                                                                                                                                                            Unless required by applicable law or agreed to in writing, software\n                                                                                                                                                                                                                                                                                                                                                            distributed under the License is distributed on an \"AS IS\" BASIS,\n                                                                                                                                                                                                                                                                                                                                                            WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n                                                                                                                                                                                                                                                                                                                                                            See the License for the specific language governing permissions and\n                                                                                                                                                                                                                                                                                                                                                            limitations under the License.\n                                                                                                                                                                                                                                                                                                                                                            */\n\n\n\n\n  function t(a, b, c) {this.code = va + a;this.message = b || wa[a] || \"\";this.a = c || null;}r(t, Error);t.prototype.w = function () {var a = { code: this.code, message: this.message };this.a && (a.serverResponse = this.a);return a;};t.prototype.toJSON = function () {return this.w();};function ya(a) {var b = a && a.code;return b ? new t(b.substring(va.length), a.message, a.serverResponse) : null;}\n  var va = \"auth/\",wa = { \"admin-restricted-operation\": \"This operation is restricted to administrators only.\", \"argument-error\": \"\", \"app-not-authorized\": \"This app, identified by the domain where it's hosted, is not authorized to use Firebase Authentication with the provided API key. Review your key configuration in the Google API console.\", \"app-not-installed\": \"The requested mobile application corresponding to the identifier (Android package name or iOS bundle ID) provided is not installed on this device.\",\n    \"captcha-check-failed\": \"The reCAPTCHA response token provided is either invalid, expired, already used or the domain associated with it does not match the list of whitelisted domains.\", \"code-expired\": \"The SMS code has expired. Please re-send the verification code to try again.\", \"cordova-not-ready\": \"Cordova framework is not ready.\", \"cors-unsupported\": \"This browser is not supported.\", \"credential-already-in-use\": \"This credential is already associated with a different user account.\", \"custom-token-mismatch\": \"The custom token corresponds to a different audience.\",\n    \"requires-recent-login\": \"This operation is sensitive and requires recent authentication. Log in again before retrying this request.\", \"dynamic-link-not-activated\": \"Please activate Dynamic Links in the Firebase Console and agree to the terms and conditions.\", \"email-change-needs-verification\": \"Multi-factor users must always have a verified email.\", \"email-already-in-use\": \"The email address is already in use by another account.\", \"expired-action-code\": \"The action code has expired. \", \"cancelled-popup-request\": \"This operation has been cancelled due to another conflicting popup being opened.\",\n    \"internal-error\": \"An internal error has occurred.\", \"invalid-app-credential\": \"The phone verification request contains an invalid application verifier. The reCAPTCHA token response is either invalid or expired.\", \"invalid-app-id\": \"The mobile app identifier is not registed for the current project.\", \"invalid-user-token\": \"This user's credential isn't valid for this project. This can happen if the user's token has been tampered with, or if the user isn't for the project associated with this API key.\", \"invalid-auth-event\": \"An internal error has occurred.\",\n    \"invalid-verification-code\": \"The SMS verification code used to create the phone auth credential is invalid. Please resend the verification code sms and be sure use the verification code provided by the user.\", \"invalid-continue-uri\": \"The continue URL provided in the request is invalid.\", \"invalid-cordova-configuration\": \"The following Cordova plugins must be installed to enable OAuth sign-in: cordova-plugin-buildinfo, cordova-universal-links-plugin, cordova-plugin-browsertab, cordova-plugin-inappbrowser and cordova-plugin-customurlscheme.\",\n    \"invalid-custom-token\": \"The custom token format is incorrect. Please check the documentation.\", \"invalid-dynamic-link-domain\": \"The provided dynamic link domain is not configured or authorized for the current project.\", \"invalid-email\": \"The email address is badly formatted.\", \"invalid-api-key\": \"Your API key is invalid, please check you have copied it correctly.\", \"invalid-cert-hash\": \"The SHA-1 certificate hash provided is invalid.\", \"invalid-credential\": \"The supplied auth credential is malformed or has expired.\",\n    \"invalid-message-payload\": \"The email template corresponding to this action contains invalid characters in its message. Please fix by going to the Auth email templates section in the Firebase Console.\", \"invalid-multi-factor-session\": \"The request does not contain a valid proof of first factor successful sign-in.\", \"invalid-oauth-provider\": \"EmailAuthProvider is not supported for this operation. This operation only supports OAuth providers.\", \"invalid-oauth-client-id\": \"The OAuth client ID provided is either invalid or does not match the specified API key.\",\n    \"unauthorized-domain\": \"This domain is not authorized for OAuth operations for your Firebase project. Edit the list of authorized domains from the Firebase console.\", \"invalid-action-code\": \"The action code is invalid. This can happen if the code is malformed, expired, or has already been used.\", \"wrong-password\": \"The password is invalid or the user does not have a password.\", \"invalid-persistence-type\": \"The specified persistence type is invalid. It can only be local, session or none.\", \"invalid-phone-number\": \"The format of the phone number provided is incorrect. Please enter the phone number in a format that can be parsed into E.164 format. E.164 phone numbers are written in the format [+][country code][subscriber number including area code].\",\n    \"invalid-provider-id\": \"The specified provider ID is invalid.\", \"invalid-recipient-email\": \"The email corresponding to this action failed to send as the provided recipient email address is invalid.\", \"invalid-sender\": \"The email template corresponding to this action contains an invalid sender email or name. Please fix by going to the Auth email templates section in the Firebase Console.\", \"invalid-verification-id\": \"The verification ID used to create the phone auth credential is invalid.\", \"invalid-tenant-id\": \"The Auth instance's tenant ID is invalid.\",\n    \"multi-factor-info-not-found\": \"The user does not have a second factor matching the identifier provided.\", \"multi-factor-auth-required\": \"Proof of ownership of a second factor is required to complete sign-in.\", \"missing-android-pkg-name\": \"An Android Package Name must be provided if the Android App is required to be installed.\", \"auth-domain-config-required\": \"Be sure to include authDomain when calling firebase.initializeApp(), by following the instructions in the Firebase console.\", \"missing-app-credential\": \"The phone verification request is missing an application verifier assertion. A reCAPTCHA response token needs to be provided.\",\n    \"missing-verification-code\": \"The phone auth credential was created with an empty SMS verification code.\", \"missing-continue-uri\": \"A continue URL must be provided in the request.\", \"missing-iframe-start\": \"An internal error has occurred.\", \"missing-ios-bundle-id\": \"An iOS Bundle ID must be provided if an App Store ID is provided.\", \"missing-multi-factor-info\": \"No second factor identifier is provided.\", \"missing-multi-factor-session\": \"The request is missing proof of first factor successful sign-in.\", \"missing-or-invalid-nonce\": \"The request does not contain a valid nonce. This can occur if the SHA-256 hash of the provided raw nonce does not match the hashed nonce in the ID token payload.\",\n    \"missing-phone-number\": \"To send verification codes, provide a phone number for the recipient.\", \"missing-verification-id\": \"The phone auth credential was created with an empty verification ID.\", \"app-deleted\": \"This instance of FirebaseApp has been deleted.\", \"account-exists-with-different-credential\": \"An account already exists with the same email address but different sign-in credentials. Sign in using a provider associated with this email address.\", \"network-request-failed\": \"A network error (such as timeout, interrupted connection or unreachable host) has occurred.\",\n    \"no-auth-event\": \"An internal error has occurred.\", \"no-such-provider\": \"User was not linked to an account with the given provider.\", \"null-user\": \"A null user object was provided as the argument for an operation which requires a non-null user object.\", \"operation-not-allowed\": \"The given sign-in provider is disabled for this Firebase project. Enable it in the Firebase console, under the sign-in method tab of the Auth section.\", \"operation-not-supported-in-this-environment\": 'This operation is not supported in the environment this application is running on. \"location.protocol\" must be http, https or chrome-extension and web storage must be enabled.',\n    \"popup-blocked\": \"Unable to establish a connection with the popup. It may have been blocked by the browser.\", \"popup-closed-by-user\": \"The popup has been closed by the user before finalizing the operation.\", \"provider-already-linked\": \"User can only be linked to one identity for the given provider.\", \"quota-exceeded\": \"The project's quota for this operation has been exceeded.\", \"redirect-cancelled-by-user\": \"The redirect operation has been cancelled by the user before finalizing.\", \"redirect-operation-pending\": \"A redirect sign-in operation is already pending.\",\n    \"rejected-credential\": \"The request contains malformed or mismatching credentials.\", \"second-factor-already-in-use\": \"The second factor is already enrolled on this account.\", \"maximum-second-factor-count-exceeded\": \"The maximum allowed number of second factors on a user has been exceeded.\", \"tenant-id-mismatch\": \"The provided tenant ID does not match the Auth instance's tenant ID\", timeout: \"The operation has timed out.\", \"user-token-expired\": \"The user's credential is no longer valid. The user must sign in again.\",\n    \"too-many-requests\": \"We have blocked all requests from this device due to unusual activity. Try again later.\", \"unauthorized-continue-uri\": \"The domain of the continue URL is not whitelisted.  Please whitelist the domain in the Firebase console.\", \"unsupported-first-factor\": \"Enrolling a second factor or signing in with a multi-factor account requires sign-in with a supported first factor.\", \"unsupported-persistence-type\": \"The current environment does not support the specified persistence type.\", \"unsupported-tenant-operation\": \"This operation is not supported in a multi-tenant context.\",\n    \"unverified-email\": \"The operation requires a verified email.\", \"user-cancelled\": \"The user did not grant your application the permissions it requested.\", \"user-not-found\": \"There is no user record corresponding to this identifier. The user may have been deleted.\", \"user-disabled\": \"The user account has been disabled by an administrator.\", \"user-mismatch\": \"The supplied credentials do not correspond to the previously signed in user.\", \"user-signed-out\": \"\", \"weak-password\": \"The password must be 6 characters long or more.\",\n    \"web-storage-unsupported\": \"This browser is not supported or 3rd party cookies and data may be disabled.\" };var za = { kd: { Sa: \"https://staging-identitytoolkit.sandbox.googleapis.com/identitytoolkit/v3/relyingparty/\", Ya: \"https://staging-securetoken.sandbox.googleapis.com/v1/token\", Va: \"https://staging-identitytoolkit.sandbox.googleapis.com/v2/\", id: \"b\" }, rd: { Sa: \"https://www.googleapis.com/identitytoolkit/v3/relyingparty/\", Ya: \"https://securetoken.googleapis.com/v1/token\", Va: \"https://identitytoolkit.googleapis.com/v2/\", id: \"p\" }, td: { Sa: \"https://staging-www.sandbox.googleapis.com/identitytoolkit/v3/relyingparty/\",\n      Ya: \"https://staging-securetoken.sandbox.googleapis.com/v1/token\", Va: \"https://staging-identitytoolkit.sandbox.googleapis.com/v2/\", id: \"s\" }, ud: { Sa: \"https://www-googleapis-test.sandbox.google.com/identitytoolkit/v3/relyingparty/\", Ya: \"https://test-securetoken.sandbox.googleapis.com/v1/token\", Va: \"https://test-identitytoolkit.sandbox.googleapis.com/v2/\", id: \"t\" } };\n  function Aa(a) {for (var b in za) {if (za[b].id === a) return a = za[b], { firebaseEndpoint: a.Sa, secureTokenEndpoint: a.Ya, identityPlatformEndpoint: a.Va };}return null;}var Ba;Ba = Aa(\"__EID__\") ? \"__EID__\" : void 0;function Ca(a) {if (!a) return !1;try {return !!a.$goog_Thenable;} catch (b) {return !1;}};function u(a) {if (Error.captureStackTrace) Error.captureStackTrace(this, u);else {var b = Error().stack;b && (this.stack = b);}a && (this.message = String(a));}r(u, Error);u.prototype.name = \"CustomError\";function Da(a, b) {a = a.split(\"%s\");for (var c = \"\", d = a.length - 1, e = 0; e < d; e++) {c += a[e] + (e < b.length ? b[e] : \"%s\");}u.call(this, c + a[d]);}r(Da, u);Da.prototype.name = \"AssertionError\";function Ea(a, b) {throw new Da(\"Failure\" + (a ? \": \" + a : \"\"), Array.prototype.slice.call(arguments, 1));};function Fa(a, b) {this.c = a;this.f = b;this.b = 0;this.a = null;}Fa.prototype.get = function () {if (0 < this.b) {this.b--;var a = this.a;this.a = a.next;a.next = null;} else a = this.c();return a;};function Ga(a, b) {a.f(b);100 > a.b && (a.b++, b.next = a.a, a.a = b);};function Ha() {this.b = this.a = null;}var Ja = new Fa(function () {return new Ia();}, function (a) {a.reset();});Ha.prototype.add = function (a, b) {var c = Ja.get();c.set(a, b);this.b ? this.b.next = c : this.a = c;this.b = c;};function Ka() {var a = La,b = null;a.a && (b = a.a, a.a = a.a.next, a.a || (a.b = null), b.next = null);return b;}function Ia() {this.next = this.b = this.a = null;}Ia.prototype.set = function (a, b) {this.a = a;this.b = b;this.next = null;};Ia.prototype.reset = function () {this.next = this.b = this.a = null;};var Ma = Array.prototype.indexOf ? function (a, b) {return Array.prototype.indexOf.call(a, b, void 0);} : function (a, b) {if (\"string\" === typeof a) return \"string\" !== typeof b || 1 != b.length ? -1 : a.indexOf(b, 0);for (var c = 0; c < a.length; c++) {if (c in a && a[c] === b) return c;}return -1;},w = Array.prototype.forEach ? function (a, b, c) {Array.prototype.forEach.call(a, b, c);} : function (a, b, c) {for (var d = a.length, e = \"string\" === typeof a ? a.split(\"\") : a, f = 0; f < d; f++) {f in e && b.call(c, e[f], f, a);}};\n  function Na(a, b) {for (var c = \"string\" === typeof a ? a.split(\"\") : a, d = a.length - 1; 0 <= d; --d) {d in c && b.call(void 0, c[d], d, a);}}\n  var Oa = Array.prototype.filter ? function (a, b) {return Array.prototype.filter.call(a, b, void 0);} : function (a, b) {for (var c = a.length, d = [], e = 0, f = \"string\" === typeof a ? a.split(\"\") : a, g = 0; g < c; g++) {if (g in f) {var h = f[g];b.call(void 0, h, g, a) && (d[e++] = h);}}return d;},Pa = Array.prototype.map ? function (a, b) {return Array.prototype.map.call(a, b, void 0);} : function (a, b) {for (var c = a.length, d = Array(c), e = \"string\" === typeof a ? a.split(\"\") : a, f = 0; f < c; f++) {f in e && (d[f] = b.call(void 0, e[f], f, a));}return d;},Qa = Array.prototype.some ? function (a,\n  b) {return Array.prototype.some.call(a, b, void 0);} : function (a, b) {for (var c = a.length, d = \"string\" === typeof a ? a.split(\"\") : a, e = 0; e < c; e++) {if (e in d && b.call(void 0, d[e], e, a)) return !0;}return !1;};function Ra(a) {a: {var b = Sa;for (var c = a.length, d = \"string\" === typeof a ? a.split(\"\") : a, e = 0; e < c; e++) {if (e in d && b.call(void 0, d[e], e, a)) {b = e;break a;}}b = -1;}return 0 > b ? null : \"string\" === typeof a ? a.charAt(b) : a[b];}function Ta(a, b) {return 0 <= Ma(a, b);}\n  function Ua(a, b) {b = Ma(a, b);var c;(c = 0 <= b) && Array.prototype.splice.call(a, b, 1);return c;}function Va(a, b) {var c = 0;Na(a, function (d, e) {b.call(void 0, d, e, a) && 1 == Array.prototype.splice.call(a, e, 1).length && c++;});}function Wa(a) {return Array.prototype.concat.apply([], arguments);}function Xa(a) {var b = a.length;if (0 < b) {for (var c = Array(b), d = 0; d < b; d++) {c[d] = a[d];}return c;}return [];};var Ya = String.prototype.trim ? function (a) {return a.trim();} : function (a) {return (/^[\\s\\xa0]*([\\s\\S]*?)[\\s\\xa0]*$/.exec(a)[1]);},Za = /&/g,$a = /</g,ab = />/g,bb = /\"/g,cb = /'/g,db = /\\x00/g,eb = /[\\x00&<>\"']/;function x(a, b) {return -1 != a.indexOf(b);}function fb(a, b) {return a < b ? -1 : a > b ? 1 : 0;};var gb;a: {var hb = l.navigator;if (hb) {var ib = hb.userAgent;if (ib) {gb = ib;break a;}}gb = \"\";}function y(a) {return x(gb, a);};function jb(a, b) {for (var c in a) {b.call(void 0, a[c], c, a);}}function kb(a) {for (var b in a) {return !1;}return !0;}function lb(a) {var b = {},c;for (c in a) {b[c] = a[c];}return b;}var mb = \"constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf\".split(\" \");function z(a, b) {for (var c, d, e = 1; e < arguments.length; e++) {d = arguments[e];for (c in d) {a[c] = d[c];}for (var f = 0; f < mb.length; f++) {c = mb[f], Object.prototype.hasOwnProperty.call(d, c) && (a[c] = d[c]);}}};function nb(a, b) {a: {try {var c = a && a.ownerDocument,d = c && (c.defaultView || c.parentWindow);d = d || l;if (d.Element && d.Location) {var e = d;break a;}} catch (g) {}e = null;}if (e && \"undefined\" != typeof e[b] && (!a || !(a instanceof e[b]) && (a instanceof e.Location || a instanceof e.Element))) {if (n(a)) try {var f = a.constructor.displayName || a.constructor.name || Object.prototype.toString.call(a);} catch (g) {f = \"<object could not be stringified>\";} else f = void 0 === a ? \"undefined\" : null === a ? \"null\" : typeof a === \"undefined\" ? \"undefined\" : _typeof(a);Ea(\"Argument is not a %s (or a non-Element, non-Location mock); got: %s\",\n      b, f);}};function ob(a, b) {this.a = a === pb && b || \"\";this.b = qb;}ob.prototype.sa = !0;ob.prototype.ra = function () {return this.a;};ob.prototype.toString = function () {return \"Const{\" + this.a + \"}\";};function rb(a) {if (a instanceof ob && a.constructor === ob && a.b === qb) return a.a;Ea(\"expected object of type Const, got '\" + a + \"'\");return \"type_error:Const\";}var qb = {},pb = {},sb = new ob(pb, \"\");function tb(a, b) {this.a = a === ub && b || \"\";this.b = vb;}tb.prototype.sa = !0;tb.prototype.ra = function () {return this.a.toString();};tb.prototype.toString = function () {return \"TrustedResourceUrl{\" + this.a + \"}\";};function wb(a) {if (a instanceof tb && a.constructor === tb && a.b === vb) return a.a;Ea(\"expected object of type TrustedResourceUrl, got '\" + a + \"' of type \" + la(a));return \"type_error:TrustedResourceUrl\";}\n  function xb(a, b) {var c = rb(a);if (!yb.test(c)) throw Error(\"Invalid TrustedResourceUrl format: \" + c);a = c.replace(zb, function (d, e) {if (!Object.prototype.hasOwnProperty.call(b, e)) throw Error('Found marker, \"' + e + '\", in format string, \"' + c + '\", but no valid label mapping found in args: ' + JSON.stringify(b));d = b[e];return d instanceof ob ? rb(d) : encodeURIComponent(String(d));});return new tb(ub, a);}\n  var zb = /%{(\\w+)}/g,yb = /^((https:)?\\/\\/[0-9a-z.:[\\]-]+\\/|\\/[^/\\\\]|[^:/\\\\%]+\\/|[^:/\\\\%]*[?#]|about:blank#)/i,vb = {},ub = {};function Ab(a, b) {this.a = a === Bb && b || \"\";this.b = Cb;}Ab.prototype.sa = !0;Ab.prototype.ra = function () {return this.a.toString();};Ab.prototype.toString = function () {return \"SafeUrl{\" + this.a + \"}\";};function Db(a) {if (a instanceof Ab && a.constructor === Ab && a.b === Cb) return a.a;Ea(\"expected object of type SafeUrl, got '\" + a + \"' of type \" + la(a));return \"type_error:SafeUrl\";}var Eb = /^(?:(?:https?|mailto|ftp):|[^:/?#]*(?:[/?#]|$))/i;\n  function Fb(a) {if (a instanceof Ab) return a;a = \"object\" == (typeof a === \"undefined\" ? \"undefined\" : _typeof(a)) && a.sa ? a.ra() : String(a);Eb.test(a) || (a = \"about:invalid#zClosurez\");return new Ab(Bb, a);}var Cb = {},Bb = {};function Gb() {this.a = \"\";this.b = Hb;}Gb.prototype.sa = !0;Gb.prototype.ra = function () {return this.a.toString();};Gb.prototype.toString = function () {return \"SafeHtml{\" + this.a + \"}\";};function Ib(a) {if (a instanceof Gb && a.constructor === Gb && a.b === Hb) return a.a;Ea(\"expected object of type SafeHtml, got '\" + a + \"' of type \" + la(a));return \"type_error:SafeHtml\";}var Hb = {};function Jb(a) {var b = new Gb();b.a = a;return b;}Jb(\"<!DOCTYPE html>\");var Kb = Jb(\"\");Jb(\"<br>\");function Lb(a) {var b = new tb(ub, rb(sb));nb(a, \"HTMLIFrameElement\");a.src = wb(b).toString();}function Mb(a, b) {nb(a, \"HTMLScriptElement\");a.src = wb(b);if (null === ja) b: {b = l.document;if ((b = b.querySelector && b.querySelector(\"script[nonce]\")) && (b = b.nonce || b.getAttribute(\"nonce\")) && ia.test(b)) {ja = b;break b;}ja = \"\";}b = ja;b && a.setAttribute(\"nonce\", b);};function Nb(a, b) {for (var c = a.split(\"%s\"), d = \"\", e = Array.prototype.slice.call(arguments, 1); e.length && 1 < c.length;) {d += c.shift() + e.shift();}return d + c.join(\"%s\");}function Ob(a) {eb.test(a) && (-1 != a.indexOf(\"&\") && (a = a.replace(Za, \"&amp;\")), -1 != a.indexOf(\"<\") && (a = a.replace($a, \"&lt;\")), -1 != a.indexOf(\">\") && (a = a.replace(ab, \"&gt;\")), -1 != a.indexOf('\"') && (a = a.replace(bb, \"&quot;\")), -1 != a.indexOf(\"'\") && (a = a.replace(cb, \"&#39;\")), -1 != a.indexOf(\"\\x00\") && (a = a.replace(db, \"&#0;\")));return a;};function Pb(a) {Pb[\" \"](a);return a;}Pb[\" \"] = ka;function Qb(a, b) {var c = Rb;return Object.prototype.hasOwnProperty.call(c, a) ? c[a] : c[a] = b(a);};var Sb = y(\"Opera\"),Tb = y(\"Trident\") || y(\"MSIE\"),Ub = y(\"Edge\"),Vb = Ub || Tb,Wb = y(\"Gecko\") && !(x(gb.toLowerCase(), \"webkit\") && !y(\"Edge\")) && !(y(\"Trident\") || y(\"MSIE\")) && !y(\"Edge\"),Xb = x(gb.toLowerCase(), \"webkit\") && !y(\"Edge\");function Yb() {var a = l.document;return a ? a.documentMode : void 0;}var Zb;\n  a: {var $b = \"\",ac = function () {var a = gb;if (Wb) return (/rv:([^\\);]+)(\\)|;)/.exec(a));if (Ub) return (/Edge\\/([\\d\\.]+)/.exec(a));if (Tb) return (/\\b(?:MSIE|rv)[: ]([^\\);]+)(\\)|;)/.exec(a));if (Xb) return (/WebKit\\/(\\S+)/.exec(a));if (Sb) return (/(?:Version)[ \\/]?(\\S+)/.exec(a));}();ac && ($b = ac ? ac[1] : \"\");if (Tb) {var bc = Yb();if (null != bc && bc > parseFloat($b)) {Zb = String(bc);break a;}}Zb = $b;}var Rb = {};\n  function cc(a) {return Qb(a, function () {for (var b = 0, c = Ya(String(Zb)).split(\".\"), d = Ya(String(a)).split(\".\"), e = Math.max(c.length, d.length), f = 0; 0 == b && f < e; f++) {var g = c[f] || \"\",h = d[f] || \"\";do {g = /(\\d*)(\\D*)(.*)/.exec(g) || [\"\", \"\", \"\", \"\"];h = /(\\d*)(\\D*)(.*)/.exec(h) || [\"\", \"\", \"\", \"\"];if (0 == g[0].length && 0 == h[0].length) break;b = fb(0 == g[1].length ? 0 : parseInt(g[1], 10), 0 == h[1].length ? 0 : parseInt(h[1], 10)) || fb(0 == g[2].length, 0 == h[2].length) || fb(g[2], h[2]);g = g[3];h = h[3];} while (0 == b);}return 0 <= b;});}var dc;\n  dc = l.document && Tb ? Yb() : void 0;try {new self.OffscreenCanvas(0, 0).getContext(\"2d\");} catch (a) {}var ec = !Tb || 9 <= Number(dc);function fc(a) {var b = document;return \"string\" === typeof a ? b.getElementById(a) : a;}function gc(a, b) {jb(b, function (c, d) {c && \"object\" == (typeof c === \"undefined\" ? \"undefined\" : _typeof(c)) && c.sa && (c = c.ra());\"style\" == d ? a.style.cssText = c : \"class\" == d ? a.className = c : \"for\" == d ? a.htmlFor = c : hc.hasOwnProperty(d) ? a.setAttribute(hc[d], c) : 0 == d.lastIndexOf(\"aria-\", 0) || 0 == d.lastIndexOf(\"data-\", 0) ? a.setAttribute(d, c) : a[d] = c;});}\n  var hc = { cellpadding: \"cellPadding\", cellspacing: \"cellSpacing\", colspan: \"colSpan\", frameborder: \"frameBorder\", height: \"height\", maxlength: \"maxLength\", nonce: \"nonce\", role: \"role\", rowspan: \"rowSpan\", type: \"type\", usemap: \"useMap\", valign: \"vAlign\", width: \"width\" };\n  function ic(a, b, c) {var d = arguments,e = document,f = String(d[0]),g = d[1];if (!ec && g && (g.name || g.type)) {f = [\"<\", f];g.name && f.push(' name=\"', Ob(g.name), '\"');if (g.type) {f.push(' type=\"', Ob(g.type), '\"');var h = {};z(h, g);delete h.type;g = h;}f.push(\">\");f = f.join(\"\");}f = jc(e, f);g && (\"string\" === typeof g ? f.className = g : Array.isArray(g) ? f.className = g.join(\" \") : gc(f, g));2 < d.length && kc(e, f, d);return f;}\n  function kc(a, b, c) {function d(g) {g && b.appendChild(\"string\" === typeof g ? a.createTextNode(g) : g);}for (var e = 2; e < c.length; e++) {var f = c[e];!ma(f) || n(f) && 0 < f.nodeType ? d(f) : w(lc(f) ? Xa(f) : f, d);}}function jc(a, b) {b = String(b);\"application/xhtml+xml\" === a.contentType && (b = b.toLowerCase());return a.createElement(b);}function lc(a) {if (a && \"number\" == typeof a.length) {if (n(a)) return \"function\" == typeof a.item || \"string\" == typeof a.item;if (na(a)) return \"function\" == typeof a.item;}return !1;};function mc(a) {l.setTimeout(function () {throw a;}, 0);}var nc;\n  function oc() {var a = l.MessageChannel;\"undefined\" === typeof a && \"undefined\" !== typeof window && window.postMessage && window.addEventListener && !y(\"Presto\") && (a = function a() {var e = jc(document, \"IFRAME\");e.style.display = \"none\";Lb(e);document.documentElement.appendChild(e);var f = e.contentWindow;e = f.document;e.open();e.write(Ib(Kb));e.close();var g = \"callImmediate\" + Math.random(),h = \"file:\" == f.location.protocol ? \"*\" : f.location.protocol + \"//\" + f.location.host;e = q(function (m) {if ((\"*\" == h || m.origin == h) && m.data == g) this.port1.onmessage();},\n      this);f.addEventListener(\"message\", e, !1);this.port1 = {};this.port2 = { postMessage: function postMessage() {f.postMessage(g, h);} };});if (\"undefined\" !== typeof a && !y(\"Trident\") && !y(\"MSIE\")) {var b = new a(),c = {},d = c;b.port1.onmessage = function () {if (void 0 !== c.next) {c = c.next;var e = c.Fb;c.Fb = null;e();}};return function (e) {d.next = { Fb: e };d = d.next;b.port2.postMessage(0);};}return function (e) {l.setTimeout(e, 0);};};function pc(a, b) {qc || rc();sc || (qc(), sc = !0);La.add(a, b);}var qc;function rc() {if (l.Promise && l.Promise.resolve) {var a = l.Promise.resolve(void 0);qc = function qc() {a.then(tc);};} else qc = function qc() {var b = tc;!na(l.setImmediate) || l.Window && l.Window.prototype && !y(\"Edge\") && l.Window.prototype.setImmediate == l.setImmediate ? (nc || (nc = oc()), nc(b)) : l.setImmediate(b);};}var sc = !1,La = new Ha();function tc() {for (var a; a = Ka();) {try {a.a.call(a.b);} catch (b) {mc(b);}Ga(Ja, a);}sc = !1;};function C(a, b) {this.a = uc;this.i = void 0;this.f = this.b = this.c = null;this.g = this.h = !1;if (a != ka) try {var c = this;a.call(b, function (d) {vc(c, wc, d);}, function (d) {if (!(d instanceof xc)) try {if (d instanceof Error) throw d;throw Error(\"Promise rejected.\");} catch (e) {}vc(c, yc, d);});} catch (d) {vc(this, yc, d);}}var uc = 0,wc = 2,yc = 3;function zc() {this.next = this.f = this.b = this.g = this.a = null;this.c = !1;}zc.prototype.reset = function () {this.f = this.b = this.g = this.a = null;this.c = !1;};var Ac = new Fa(function () {return new zc();}, function (a) {a.reset();});\n  function Bc(a, b, c) {var d = Ac.get();d.g = a;d.b = b;d.f = c;return d;}function D(a) {if (a instanceof C) return a;var b = new C(ka);vc(b, wc, a);return b;}function E(a) {return new C(function (b, c) {c(a);});}function Cc(a, b, c) {Dc(a, b, c, null) || pc(ta(b, a));}function Ec(a) {return new C(function (b, c) {var d = a.length,e = [];if (d) for (var f = function f(p, v) {d--;e[p] = v;0 == d && b(e);}, g = function g(p) {c(p);}, h = 0, m; h < a.length; h++) {m = a[h], Cc(m, ta(f, h), g);} else b(e);});}\n  function Fc(a) {return new C(function (b) {var c = a.length,d = [];if (c) for (var e = function e(h, m, p) {c--;d[h] = m ? { Ob: !0, value: p } : { Ob: !1, reason: p };0 == c && b(d);}, f = 0, g; f < a.length; f++) {g = a[f], Cc(g, ta(e, f, !0), ta(e, f, !1));} else b(d);});}C.prototype.then = function (a, b, c) {return Gc(this, na(a) ? a : null, na(b) ? b : null, c);};C.prototype.$goog_Thenable = !0;k = C.prototype;k.na = function (a, b) {a = Bc(a, a, b);a.c = !0;Hc(this, a);return this;};k.s = function (a, b) {return Gc(this, null, a, b);};\n  k.cancel = function (a) {if (this.a == uc) {var b = new xc(a);pc(function () {Ic(this, b);}, this);}};function Ic(a, b) {if (a.a == uc) if (a.c) {var c = a.c;if (c.b) {for (var d = 0, e = null, f = null, g = c.b; g && (g.c || (d++, g.a == a && (e = g), !(e && 1 < d))); g = g.next) {e || (f = g);}e && (c.a == uc && 1 == d ? Ic(c, b) : (f ? (d = f, d.next == c.f && (c.f = d), d.next = d.next.next) : Jc(c), Kc(c, e, yc, b)));}a.c = null;} else vc(a, yc, b);}function Hc(a, b) {a.b || a.a != wc && a.a != yc || Lc(a);a.f ? a.f.next = b : a.b = b;a.f = b;}\n  function Gc(a, b, c, d) {var e = Bc(null, null, null);e.a = new C(function (f, g) {e.g = b ? function (h) {try {var m = b.call(d, h);f(m);} catch (p) {g(p);}} : f;e.b = c ? function (h) {try {var m = c.call(d, h);void 0 === m && h instanceof xc ? g(h) : f(m);} catch (p) {g(p);}} : g;});e.a.c = a;Hc(a, e);return e.a;}k.Zc = function (a) {this.a = uc;vc(this, wc, a);};k.$c = function (a) {this.a = uc;vc(this, yc, a);};\n  function vc(a, b, c) {a.a == uc && (a === c && (b = yc, c = new TypeError(\"Promise cannot resolve to itself\")), a.a = 1, Dc(c, a.Zc, a.$c, a) || (a.i = c, a.a = b, a.c = null, Lc(a), b != yc || c instanceof xc || Mc(a, c)));}function Dc(a, b, c, d) {if (a instanceof C) return Hc(a, Bc(b || ka, c || null, d)), !0;if (Ca(a)) return a.then(b, c, d), !0;if (n(a)) try {var e = a.then;if (na(e)) return Nc(a, e, b, c, d), !0;} catch (f) {return c.call(d, f), !0;}return !1;}\n  function Nc(a, b, c, d, e) {function f(m) {h || (h = !0, d.call(e, m));}function g(m) {h || (h = !0, c.call(e, m));}var h = !1;try {b.call(a, g, f);} catch (m) {f(m);}}function Lc(a) {a.h || (a.h = !0, pc(a.fc, a));}function Jc(a) {var b = null;a.b && (b = a.b, a.b = b.next, b.next = null);a.b || (a.f = null);return b;}k.fc = function () {for (var a; a = Jc(this);) {Kc(this, a, this.a, this.i);}this.h = !1;};\n  function Kc(a, b, c, d) {if (c == yc && b.b && !b.c) for (; a && a.g; a = a.c) {a.g = !1;}if (b.a) b.a.c = null, Oc(b, c, d);else try {b.c ? b.g.call(b.f) : Oc(b, c, d);} catch (e) {Pc.call(null, e);}Ga(Ac, b);}function Oc(a, b, c) {b == wc ? a.g.call(a.f, c) : a.b && a.b.call(a.f, c);}function Mc(a, b) {a.g = !0;pc(function () {a.g && Pc.call(null, b);});}var Pc = mc;function xc(a) {u.call(this, a);}r(xc, u);xc.prototype.name = \"cancel\";function Qc() {0 != Rc && (Sc[oa(this)] = this);this.xa = this.xa;this.oa = this.oa;}var Rc = 0,Sc = {};Qc.prototype.xa = !1;function Tc(a) {if (!a.xa && (a.xa = !0, a.Da(), 0 != Rc)) {var b = oa(a);if (0 != Rc && a.oa && 0 < a.oa.length) throw Error(a + \" did not empty its onDisposeCallbacks queue. This probably means it overrode dispose() or disposeInternal() without calling the superclass' method.\");delete Sc[b];}}Qc.prototype.Da = function () {if (this.oa) for (; this.oa.length;) {this.oa.shift()();}};var Uc = Object.freeze || function (a) {return a;};var Vc = !Tb || 9 <= Number(dc),Wc = Tb && !cc(\"9\"),Xc = function () {if (!l.addEventListener || !Object.defineProperty) return !1;var a = !1,b = Object.defineProperty({}, \"passive\", { get: function get() {a = !0;} });try {l.addEventListener(\"test\", ka, b), l.removeEventListener(\"test\", ka, b);} catch (c) {}return a;}();function F(a, b) {this.type = a;this.b = this.target = b;this.defaultPrevented = !1;}F.prototype.preventDefault = function () {this.defaultPrevented = !0;};function Yc(a, b) {F.call(this, a ? a.type : \"\");this.relatedTarget = this.b = this.target = null;this.button = this.screenY = this.screenX = this.clientY = this.clientX = 0;this.key = \"\";this.metaKey = this.shiftKey = this.altKey = this.ctrlKey = !1;this.pointerId = 0;this.pointerType = \"\";this.a = null;if (a) {var c = this.type = a.type,d = a.changedTouches && a.changedTouches.length ? a.changedTouches[0] : null;this.target = a.target || a.srcElement;this.b = b;if (b = a.relatedTarget) {if (Wb) {a: {try {Pb(b.nodeName);var e = !0;break a;} catch (f) {}e = !1;}e || (b = null);}} else \"mouseover\" ==\n      c ? b = a.fromElement : \"mouseout\" == c && (b = a.toElement);this.relatedTarget = b;d ? (this.clientX = void 0 !== d.clientX ? d.clientX : d.pageX, this.clientY = void 0 !== d.clientY ? d.clientY : d.pageY, this.screenX = d.screenX || 0, this.screenY = d.screenY || 0) : (this.clientX = void 0 !== a.clientX ? a.clientX : a.pageX, this.clientY = void 0 !== a.clientY ? a.clientY : a.pageY, this.screenX = a.screenX || 0, this.screenY = a.screenY || 0);this.button = a.button;this.key = a.key || \"\";this.ctrlKey = a.ctrlKey;this.altKey = a.altKey;this.shiftKey = a.shiftKey;this.metaKey =\n      a.metaKey;this.pointerId = a.pointerId || 0;this.pointerType = \"string\" === typeof a.pointerType ? a.pointerType : Zc[a.pointerType] || \"\";this.a = a;a.defaultPrevented && this.preventDefault();}}r(Yc, F);var Zc = Uc({ 2: \"touch\", 3: \"pen\", 4: \"mouse\" });Yc.prototype.preventDefault = function () {Yc.$a.preventDefault.call(this);var a = this.a;if (a.preventDefault) a.preventDefault();else if (a.returnValue = !1, Wc) try {if (a.ctrlKey || 112 <= a.keyCode && 123 >= a.keyCode) a.keyCode = -1;} catch (b) {}};Yc.prototype.g = function () {return this.a;};var $c = \"closure_listenable_\" + (1E6 * Math.random() | 0),ad = 0;function bd(a, b, c, d, e) {this.listener = a;this.proxy = null;this.src = b;this.type = c;this.capture = !!d;this.Ua = e;this.key = ++ad;this.va = this.Oa = !1;}function cd(a) {a.va = !0;a.listener = null;a.proxy = null;a.src = null;a.Ua = null;};function dd(a) {this.src = a;this.a = {};this.b = 0;}dd.prototype.add = function (a, b, c, d, e) {var f = a.toString();a = this.a[f];a || (a = this.a[f] = [], this.b++);var g = ed(a, b, d, e);-1 < g ? (b = a[g], c || (b.Oa = !1)) : (b = new bd(b, this.src, f, !!d, e), b.Oa = c, a.push(b));return b;};function fd(a, b) {var c = b.type;c in a.a && Ua(a.a[c], b) && (cd(b), 0 == a.a[c].length && (delete a.a[c], a.b--));}function ed(a, b, c, d) {for (var e = 0; e < a.length; ++e) {var f = a[e];if (!f.va && f.listener == b && f.capture == !!c && f.Ua == d) return e;}return -1;};var gd = \"closure_lm_\" + (1E6 * Math.random() | 0),hd = {},id = 0;function jd(a, b, c, d, e) {if (d && d.once) kd(a, b, c, d, e);else if (Array.isArray(b)) for (var f = 0; f < b.length; f++) {jd(a, b[f], c, d, e);} else c = ld(c), a && a[$c] ? md(a, b, c, n(d) ? !!d.capture : !!d, e) : nd(a, b, c, !1, d, e);}\n  function nd(a, b, c, d, e, f) {if (!b) throw Error(\"Invalid event type\");var g = n(e) ? !!e.capture : !!e,h = od(a);h || (a[gd] = h = new dd(a));c = h.add(b, c, d, g, f);if (!c.proxy) {d = pd();c.proxy = d;d.src = a;d.listener = c;if (a.addEventListener) Xc || (e = g), void 0 === e && (e = !1), a.addEventListener(b.toString(), d, e);else if (a.attachEvent) a.attachEvent(qd(b.toString()), d);else if (a.addListener && a.removeListener) a.addListener(d);else throw Error(\"addEventListener and attachEvent are unavailable.\");id++;}}\n  function pd() {var a = rd,b = Vc ? function (c) {return a.call(b.src, b.listener, c);} : function (c) {c = a.call(b.src, b.listener, c);if (!c) return c;};return b;}function kd(a, b, c, d, e) {if (Array.isArray(b)) for (var f = 0; f < b.length; f++) {kd(a, b[f], c, d, e);} else c = ld(c), a && a[$c] ? sd(a, b, c, n(d) ? !!d.capture : !!d, e) : nd(a, b, c, !0, d, e);}\n  function G(a, b, c, d, e) {if (Array.isArray(b)) for (var f = 0; f < b.length; f++) {G(a, b[f], c, d, e);} else (d = n(d) ? !!d.capture : !!d, c = ld(c), a && a[$c]) ? (a = a.v, b = String(b).toString(), b in a.a && (f = a.a[b], c = ed(f, c, d, e), -1 < c && (cd(f[c]), Array.prototype.splice.call(f, c, 1), 0 == f.length && (delete a.a[b], a.b--)))) : a && (a = od(a)) && (b = a.a[b.toString()], a = -1, b && (a = ed(b, c, d, e)), (c = -1 < a ? b[a] : null) && td(c));}\n  function td(a) {if (\"number\" !== typeof a && a && !a.va) {var b = a.src;if (b && b[$c]) fd(b.v, a);else {var c = a.type,d = a.proxy;b.removeEventListener ? b.removeEventListener(c, d, a.capture) : b.detachEvent ? b.detachEvent(qd(c), d) : b.addListener && b.removeListener && b.removeListener(d);id--;(c = od(b)) ? (fd(c, a), 0 == c.b && (c.src = null, b[gd] = null)) : cd(a);}}}function qd(a) {return a in hd ? hd[a] : hd[a] = \"on\" + a;}\n  function ud(a, b, c, d) {var e = !0;if (a = od(a)) if (b = a.a[b.toString()]) for (b = b.concat(), a = 0; a < b.length; a++) {var f = b[a];f && f.capture == c && !f.va && (f = vd(f, d), e = e && !1 !== f);}return e;}function vd(a, b) {var c = a.listener,d = a.Ua || a.src;a.Oa && td(a);return c.call(d, b);}\n  function rd(a, b) {if (a.va) return !0;if (!Vc) {if (!b) a: {b = [\"window\", \"event\"];for (var c = l, d = 0; d < b.length; d++) {if (c = c[b[d]], null == c) {b = null;break a;}}b = c;}d = b;b = new Yc(d, this);c = !0;if (!(0 > d.keyCode || void 0 != d.returnValue)) {a: {var e = !1;if (0 == d.keyCode) try {d.keyCode = -1;break a;} catch (g) {e = !0;}if (e || void 0 == d.returnValue) d.returnValue = !0;}d = [];for (e = b.b; e; e = e.parentNode) {d.push(e);}a = a.type;for (e = d.length - 1; 0 <= e; e--) {b.b = d[e];var f = ud(d[e], a, !0, b);c = c && f;}for (e = 0; e < d.length; e++) {b.b = d[e], f = ud(d[e], a, !1, b), c = c && f;}}return c;}return vd(a,\n    new Yc(b, this));}function od(a) {a = a[gd];return a instanceof dd ? a : null;}var wd = \"__closure_events_fn_\" + (1E9 * Math.random() >>> 0);function ld(a) {if (na(a)) return a;a[wd] || (a[wd] = function (b) {return a.handleEvent(b);});return a[wd];};function H() {Qc.call(this);this.v = new dd(this);this.$b = this;this.fb = null;}r(H, Qc);H.prototype[$c] = !0;H.prototype.addEventListener = function (a, b, c, d) {jd(this, a, b, c, d);};H.prototype.removeEventListener = function (a, b, c, d) {G(this, a, b, c, d);};\n  H.prototype.dispatchEvent = function (a) {var b,c = this.fb;if (c) for (b = []; c; c = c.fb) {b.push(c);}c = this.$b;var d = a.type || a;if (\"string\" === typeof a) a = new F(a, c);else if (a instanceof F) a.target = a.target || c;else {var e = a;a = new F(d, c);z(a, e);}e = !0;if (b) for (var f = b.length - 1; 0 <= f; f--) {var g = a.b = b[f];e = xd(g, d, !0, a) && e;}g = a.b = c;e = xd(g, d, !0, a) && e;e = xd(g, d, !1, a) && e;if (b) for (f = 0; f < b.length; f++) {g = a.b = b[f], e = xd(g, d, !1, a) && e;}return e;};\n  H.prototype.Da = function () {H.$a.Da.call(this);if (this.v) {var a = this.v,b = 0,c;for (c in a.a) {for (var d = a.a[c], e = 0; e < d.length; e++) {++b, cd(d[e]);}delete a.a[c];a.b--;}}this.fb = null;};function md(a, b, c, d, e) {a.v.add(String(b), c, !1, d, e);}function sd(a, b, c, d, e) {a.v.add(String(b), c, !0, d, e);}\n  function xd(a, b, c, d) {b = a.v.a[String(b)];if (!b) return !0;b = b.concat();for (var e = !0, f = 0; f < b.length; ++f) {var g = b[f];if (g && !g.va && g.capture == c) {var h = g.listener,m = g.Ua || g.src;g.Oa && fd(a.v, g);e = !1 !== h.call(m, d) && e;}}return e && !d.defaultPrevented;};function zd(a, b, c) {if (na(a)) c && (a = q(a, c));else if (a && \"function\" == typeof a.handleEvent) a = q(a.handleEvent, a);else throw Error(\"Invalid listener argument\");return 2147483647 < Number(b) ? -1 : l.setTimeout(a, b || 0);}function Ad(a) {var b = null;return new C(function (c, d) {b = zd(function () {c(void 0);}, a);-1 == b && d(Error(\"Failed to schedule timer.\"));}).s(function (c) {l.clearTimeout(b);throw c;});};function Bd(a) {if (a.V && \"function\" == typeof a.V) return a.V();if (\"string\" === typeof a) return a.split(\"\");if (ma(a)) {for (var b = [], c = a.length, d = 0; d < c; d++) {b.push(a[d]);}return b;}b = [];c = 0;for (d in a) {b[c++] = a[d];}return b;}function Cd(a) {if (a.Y && \"function\" == typeof a.Y) return a.Y();if (!a.V || \"function\" != typeof a.V) {if (ma(a) || \"string\" === typeof a) {var b = [];a = a.length;for (var c = 0; c < a; c++) {b.push(c);}return b;}b = [];c = 0;for (var d in a) {b[c++] = d;}return b;}}\n  function Dd(a, b) {if (a.forEach && \"function\" == typeof a.forEach) a.forEach(b, void 0);else if (ma(a) || \"string\" === typeof a) w(a, b, void 0);else for (var c = Cd(a), d = Bd(a), e = d.length, f = 0; f < e; f++) {b.call(void 0, d[f], c && c[f], a);}};function Ed(a, b) {this.b = {};this.a = [];this.c = 0;var c = arguments.length;if (1 < c) {if (c % 2) throw Error(\"Uneven number of arguments\");for (var d = 0; d < c; d += 2) {this.set(arguments[d], arguments[d + 1]);}} else if (a) if (a instanceof Ed) for (c = a.Y(), d = 0; d < c.length; d++) {this.set(c[d], a.get(c[d]));} else for (d in a) {this.set(d, a[d]);}}k = Ed.prototype;k.V = function () {Fd(this);for (var a = [], b = 0; b < this.a.length; b++) {a.push(this.b[this.a[b]]);}return a;};k.Y = function () {Fd(this);return this.a.concat();};\n  k.clear = function () {this.b = {};this.c = this.a.length = 0;};function Fd(a) {if (a.c != a.a.length) {for (var b = 0, c = 0; b < a.a.length;) {var d = a.a[b];Gd(a.b, d) && (a.a[c++] = d);b++;}a.a.length = c;}if (a.c != a.a.length) {var e = {};for (c = b = 0; b < a.a.length;) {d = a.a[b], Gd(e, d) || (a.a[c++] = d, e[d] = 1), b++;}a.a.length = c;}}k.get = function (a, b) {return Gd(this.b, a) ? this.b[a] : b;};k.set = function (a, b) {Gd(this.b, a) || (this.c++, this.a.push(a));this.b[a] = b;};\n  k.forEach = function (a, b) {for (var c = this.Y(), d = 0; d < c.length; d++) {var e = c[d],f = this.get(e);a.call(b, f, e, this);}};function Gd(a, b) {return Object.prototype.hasOwnProperty.call(a, b);};var Hd = /^(?:([^:/?#.]+):)?(?:\\/\\/(?:([^/?#]*)@)?([^/#?]*?)(?::([0-9]+))?(?=[/\\\\#?]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$/;function Id(a, b) {if (a) {a = a.split(\"&\");for (var c = 0; c < a.length; c++) {var d = a[c].indexOf(\"=\"),e = null;if (0 <= d) {var f = a[c].substring(0, d);e = a[c].substring(d + 1);} else f = a[c];b(f, e ? decodeURIComponent(e.replace(/\\+/g, \" \")) : \"\");}}};function Jd(a, b) {this.a = this.l = this.f = \"\";this.g = null;this.h = this.c = \"\";this.i = !1;var c;a instanceof Jd ? (this.i = void 0 !== b ? b : a.i, Kd(this, a.f), this.l = a.l, this.a = a.a, Ld(this, a.g), this.c = a.c, Md(this, Nd(a.b)), this.h = a.h) : a && (c = String(a).match(Hd)) ? (this.i = !!b, Kd(this, c[1] || \"\", !0), this.l = Od(c[2] || \"\"), this.a = Od(c[3] || \"\", !0), Ld(this, c[4]), this.c = Od(c[5] || \"\", !0), Md(this, c[6] || \"\", !0), this.h = Od(c[7] || \"\")) : (this.i = !!b, this.b = new Pd(null, this.i));}\n  Jd.prototype.toString = function () {var a = [],b = this.f;b && a.push(Qd(b, Rd, !0), \":\");var c = this.a;if (c || \"file\" == b) a.push(\"//\"), (b = this.l) && a.push(Qd(b, Rd, !0), \"@\"), a.push(encodeURIComponent(String(c)).replace(/%25([0-9a-fA-F]{2})/g, \"%$1\")), c = this.g, null != c && a.push(\":\", String(c));if (c = this.c) this.a && \"/\" != c.charAt(0) && a.push(\"/\"), a.push(Qd(c, \"/\" == c.charAt(0) ? Sd : Td, !0));(c = this.b.toString()) && a.push(\"?\", c);(c = this.h) && a.push(\"#\", Qd(c, Ud));return a.join(\"\");};\n  Jd.prototype.resolve = function (a) {var b = new Jd(this),c = !!a.f;c ? Kd(b, a.f) : c = !!a.l;c ? b.l = a.l : c = !!a.a;c ? b.a = a.a : c = null != a.g;var d = a.c;if (c) Ld(b, a.g);else if (c = !!a.c) {if (\"/\" != d.charAt(0)) if (this.a && !this.c) d = \"/\" + d;else {var e = b.c.lastIndexOf(\"/\");-1 != e && (d = b.c.substr(0, e + 1) + d);}e = d;if (\"..\" == e || \".\" == e) d = \"\";else if (x(e, \"./\") || x(e, \"/.\")) {d = 0 == e.lastIndexOf(\"/\", 0);e = e.split(\"/\");for (var f = [], g = 0; g < e.length;) {var h = e[g++];\".\" == h ? d && g == e.length && f.push(\"\") : \"..\" == h ? ((1 < f.length || 1 == f.length && \"\" != f[0]) && f.pop(),\n          d && g == e.length && f.push(\"\")) : (f.push(h), d = !0);}d = f.join(\"/\");} else d = e;}c ? b.c = d : c = \"\" !== a.b.toString();c ? Md(b, Nd(a.b)) : c = !!a.h;c && (b.h = a.h);return b;};function Kd(a, b, c) {a.f = c ? Od(b, !0) : b;a.f && (a.f = a.f.replace(/:$/, \"\"));}function Ld(a, b) {if (b) {b = Number(b);if (isNaN(b) || 0 > b) throw Error(\"Bad port number \" + b);a.g = b;} else a.g = null;}function Md(a, b, c) {b instanceof Pd ? (a.b = b, Vd(a.b, a.i)) : (c || (b = Qd(b, Wd)), a.b = new Pd(b, a.i));}function I(a, b, c) {a.b.set(b, c);}function Xd(a, b) {return a.b.get(b);}\n  function J(a) {return a instanceof Jd ? new Jd(a) : new Jd(a, void 0);}function Yd(a, b, c, d) {var e = new Jd(null, void 0);a && Kd(e, a);b && (e.a = b);c && Ld(e, c);d && (e.c = d);return e;}function Od(a, b) {return a ? b ? decodeURI(a.replace(/%25/g, \"%2525\")) : decodeURIComponent(a) : \"\";}function Qd(a, b, c) {return \"string\" === typeof a ? (a = encodeURI(a).replace(b, Zd), c && (a = a.replace(/%25([0-9a-fA-F]{2})/g, \"%$1\")), a) : null;}function Zd(a) {a = a.charCodeAt(0);return \"%\" + (a >> 4 & 15).toString(16) + (a & 15).toString(16);}\n  var Rd = /[#\\/\\?@]/g,Td = /[#\\?:]/g,Sd = /[#\\?]/g,Wd = /[#\\?@]/g,Ud = /#/g;function Pd(a, b) {this.b = this.a = null;this.c = a || null;this.f = !!b;}function $d(a) {a.a || (a.a = new Ed(), a.b = 0, a.c && Id(a.c, function (b, c) {a.add(decodeURIComponent(b.replace(/\\+/g, \" \")), c);}));}function ae(a) {var b = Cd(a);if (\"undefined\" == typeof b) throw Error(\"Keys are undefined\");var c = new Pd(null, void 0);a = Bd(a);for (var d = 0; d < b.length; d++) {var e = b[d],f = a[d];Array.isArray(f) ? be(c, e, f) : c.add(e, f);}return c;}k = Pd.prototype;\n  k.add = function (a, b) {$d(this);this.c = null;a = ce(this, a);var c = this.a.get(a);c || this.a.set(a, c = []);c.push(b);this.b += 1;return this;};function de(a, b) {$d(a);b = ce(a, b);Gd(a.a.b, b) && (a.c = null, a.b -= a.a.get(b).length, a = a.a, Gd(a.b, b) && (delete a.b[b], a.c--, a.a.length > 2 * a.c && Fd(a)));}k.clear = function () {this.a = this.c = null;this.b = 0;};function ee(a, b) {$d(a);b = ce(a, b);return Gd(a.a.b, b);}k.forEach = function (a, b) {$d(this);this.a.forEach(function (c, d) {w(c, function (e) {a.call(b, e, d, this);}, this);}, this);};\n  k.Y = function () {$d(this);for (var a = this.a.V(), b = this.a.Y(), c = [], d = 0; d < b.length; d++) {for (var e = a[d], f = 0; f < e.length; f++) {c.push(b[d]);}}return c;};k.V = function (a) {$d(this);var b = [];if (\"string\" === typeof a) ee(this, a) && (b = Wa(b, this.a.get(ce(this, a))));else {a = this.a.V();for (var c = 0; c < a.length; c++) {b = Wa(b, a[c]);}}return b;};k.set = function (a, b) {$d(this);this.c = null;a = ce(this, a);ee(this, a) && (this.b -= this.a.get(a).length);this.a.set(a, [b]);this.b += 1;return this;};\n  k.get = function (a, b) {if (!a) return b;a = this.V(a);return 0 < a.length ? String(a[0]) : b;};function be(a, b, c) {de(a, b);0 < c.length && (a.c = null, a.a.set(ce(a, b), Xa(c)), a.b += c.length);}k.toString = function () {if (this.c) return this.c;if (!this.a) return \"\";for (var a = [], b = this.a.Y(), c = 0; c < b.length; c++) {var d = b[c],e = encodeURIComponent(String(d));d = this.V(d);for (var f = 0; f < d.length; f++) {var g = e;\"\" !== d[f] && (g += \"=\" + encodeURIComponent(String(d[f])));a.push(g);}}return this.c = a.join(\"&\");};\n  function Nd(a) {var b = new Pd();b.c = a.c;a.a && (b.a = new Ed(a.a), b.b = a.b);return b;}function ce(a, b) {b = String(b);a.f && (b = b.toLowerCase());return b;}function Vd(a, b) {b && !a.f && ($d(a), a.c = null, a.a.forEach(function (c, d) {var e = d.toLowerCase();d != e && (de(this, d), be(this, e, c));}, a));a.f = b;};function fe(a) {var b = [];ge(new he(), a, b);return b.join(\"\");}function he() {}\n  function ge(a, b, c) {if (null == b) c.push(\"null\");else {if (\"object\" == (typeof b === \"undefined\" ? \"undefined\" : _typeof(b))) {if (Array.isArray(b)) {var d = b;b = d.length;c.push(\"[\");for (var e = \"\", f = 0; f < b; f++) {c.push(e), ge(a, d[f], c), e = \",\";}c.push(\"]\");return;}if (b instanceof String || b instanceof Number || b instanceof Boolean) b = b.valueOf();else {c.push(\"{\");e = \"\";for (d in b) {Object.prototype.hasOwnProperty.call(b, d) && (f = b[d], \"function\" != typeof f && (c.push(e), ie(d, c), c.push(\":\"), ge(a, f, c), e = \",\"));}c.push(\"}\");return;}}switch (typeof b === \"undefined\" ? \"undefined\" : _typeof(b)) {case \"string\":ie(b, c);break;case \"number\":c.push(isFinite(b) &&\n          !isNaN(b) ? String(b) : \"null\");break;case \"boolean\":c.push(String(b));break;case \"function\":c.push(\"null\");break;default:throw Error(\"Unknown type: \" + (typeof b === \"undefined\" ? \"undefined\" : _typeof(b)));}}}var je = { '\"': '\\\\\"', \"\\\\\": \"\\\\\\\\\", \"/\": \"\\\\/\", \"\\b\": \"\\\\b\", \"\\f\": \"\\\\f\", \"\\n\": \"\\\\n\", \"\\r\": \"\\\\r\", \"\\t\": \"\\\\t\", \"\\x0B\": \"\\\\u000b\" },ke = /\\uffff/.test(\"\\uFFFF\") ? /[\\\\\"\\x00-\\x1f\\x7f-\\uffff]/g : /[\\\\\"\\x00-\\x1f\\x7f-\\xff]/g;\n  function ie(a, b) {b.push('\"', a.replace(ke, function (c) {var d = je[c];d || (d = \"\\\\u\" + (c.charCodeAt(0) | 65536).toString(16).substr(1), je[c] = d);return d;}), '\"');};function le() {var a = K();return Tb && !!dc && 11 == dc || /Edge\\/\\d+/.test(a);}function me() {return l.window && l.window.location.href || self && self.location && self.location.href || \"\";}function ne(a, b) {b = b || l.window;var c = \"about:blank\";a && (c = Db(Fb(a)));b.location.href = c;}function oe(a, b) {var c = [],d;for (d in a) {d in b ? _typeof(a[d]) != _typeof(b[d]) ? c.push(d) : \"object\" == _typeof(a[d]) && null != a[d] && null != b[d] ? 0 < oe(a[d], b[d]).length && c.push(d) : a[d] !== b[d] && c.push(d) : c.push(d);}for (d in b) {d in a || c.push(d);}return c;}\n  function pe() {var a = K();a = qe(a) != re ? null : (a = a.match(/\\sChrome\\/(\\d+)/i)) && 2 == a.length ? parseInt(a[1], 10) : null;return a && 30 > a ? !1 : !Tb || !dc || 9 < dc;}function se(a) {a = (a || K()).toLowerCase();return a.match(/android/) || a.match(/webos/) || a.match(/iphone|ipad|ipod/) || a.match(/blackberry/) || a.match(/windows phone/) || a.match(/iemobile/) ? !0 : !1;}function te(a) {a = a || l.window;try {a.close();} catch (b) {}}\n  function ue(a, b, c) {var d = Math.floor(1E9 * Math.random()).toString();b = b || 500;c = c || 600;var e = (window.screen.availHeight - c) / 2,f = (window.screen.availWidth - b) / 2;b = { width: b, height: c, top: 0 < e ? e : 0, left: 0 < f ? f : 0, location: !0, resizable: !0, statusbar: !0, toolbar: !1 };c = K().toLowerCase();d && (b.target = d, x(c, \"crios/\") && (b.target = \"_blank\"));qe(K()) == ve && (a = a || \"http://localhost\", b.scrollbars = !0);c = a || \"\";(a = b) || (a = {});d = window;b = c instanceof Ab ? c : Fb(\"undefined\" != typeof c.href ? c.href : String(c));c = a.target || c.target;e = [];\n    for (g in a) {switch (g) {case \"width\":case \"height\":case \"top\":case \"left\":e.push(g + \"=\" + a[g]);break;case \"target\":case \"noopener\":case \"noreferrer\":break;default:e.push(g + \"=\" + (a[g] ? 1 : 0));}}var g = e.join(\",\");if ((y(\"iPhone\") && !y(\"iPod\") && !y(\"iPad\") || y(\"iPad\") || y(\"iPod\")) && d.navigator && d.navigator.standalone && c && \"_self\" != c) g = jc(document, \"A\"), nb(g, \"HTMLAnchorElement\"), b instanceof Ab || b instanceof Ab || (b = \"object\" == (typeof b === \"undefined\" ? \"undefined\" : _typeof(b)) && b.sa ? b.ra() : String(b), Eb.test(b) || (b = \"about:invalid#zClosurez\"), b = new Ab(Bb, b)), g.href =\n    Db(b), g.setAttribute(\"target\", c), a.noreferrer && g.setAttribute(\"rel\", \"noreferrer\"), a = document.createEvent(\"MouseEvent\"), a.initMouseEvent(\"click\", !0, !0, d, 1), g.dispatchEvent(a), g = {};else if (a.noreferrer) {if (g = d.open(\"\", c, g), a = Db(b), g && (Vb && x(a, \";\") && (a = \"'\" + a.replace(/'/g, \"%27\") + \"'\"), g.opener = null, a = Jb('<meta name=\"referrer\" content=\"no-referrer\"><meta http-equiv=\"refresh\" content=\"0; url=' + Ob(a) + '\">'), d = g.document)) d.write(Ib(a)), d.close();} else (g = d.open(Db(b), c, g)) && a.noopener && (g.opener = null);if (g) try {g.focus();} catch (h) {}return g;}\n  function we(a) {return new C(function (b) {function c() {Ad(2E3).then(function () {if (!a || a.closed) b();else return c();});}return c();});}var xe = /^\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}$/,ye = /^[^@]+@[^@]+$/;function ze() {var a = null;return new C(function (b) {\"complete\" == l.document.readyState ? b() : (a = function a() {b();}, kd(window, \"load\", a));}).s(function (b) {G(window, \"load\", a);throw b;});}\n  function Ae() {return Be(void 0) ? ze().then(function () {return new C(function (a, b) {var c = l.document,d = setTimeout(function () {b(Error(\"Cordova framework is not ready.\"));}, 1E3);c.addEventListener(\"deviceready\", function () {clearTimeout(d);a();}, !1);});}) : E(Error(\"Cordova must run in an Android or iOS file scheme.\"));}function Be(a) {a = a || K();return !(\"file:\" !== Ce() && \"ionic:\" !== Ce() || !a.toLowerCase().match(/iphone|ipad|ipod|android/));}function De() {var a = l.window;try {return !(!a || a == a.top);} catch (b) {return !1;}}\n  function Ee() {return \"undefined\" !== typeof l.WorkerGlobalScope && \"function\" === typeof l.importScripts;}function Fe() {return firebase.INTERNAL.hasOwnProperty(\"reactNative\") ? \"ReactNative\" : firebase.INTERNAL.hasOwnProperty(\"node\") ? \"Node\" : Ee() ? \"Worker\" : \"Browser\";}function Ge() {var a = Fe();return \"ReactNative\" === a || \"Node\" === a;}function He() {for (var a = 50, b = []; 0 < a;) {b.push(\"1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ\".charAt(Math.floor(62 * Math.random()))), a--;}return b.join(\"\");}\n  var ve = \"Firefox\",re = \"Chrome\";\n  function qe(a) {var b = a.toLowerCase();if (x(b, \"opera/\") || x(b, \"opr/\") || x(b, \"opios/\")) return \"Opera\";if (x(b, \"iemobile\")) return \"IEMobile\";if (x(b, \"msie\") || x(b, \"trident/\")) return \"IE\";if (x(b, \"edge/\")) return \"Edge\";if (x(b, \"firefox/\")) return ve;if (x(b, \"silk/\")) return \"Silk\";if (x(b, \"blackberry\")) return \"Blackberry\";if (x(b, \"webos\")) return \"Webos\";if (!x(b, \"safari/\") || x(b, \"chrome/\") || x(b, \"crios/\") || x(b, \"android\")) {if (!x(b, \"chrome/\") && !x(b, \"crios/\") || x(b, \"edge/\")) {if (x(b, \"android\")) return \"Android\";if ((a = a.match(/([a-zA-Z\\d\\.]+)\\/[a-zA-Z\\d\\.]*$/)) &&\n        2 == a.length) return a[1];} else return re;} else return \"Safari\";return \"Other\";}var Ie = { ld: \"FirebaseCore-web\", nd: \"FirebaseUI-web\" };function Je(a, b) {b = b || [];var c = [],d = {},e;for (e in Ie) {d[Ie[e]] = !0;}for (e = 0; e < b.length; e++) {\"undefined\" !== typeof d[b[e]] && (delete d[b[e]], c.push(b[e]));}c.sort();b = c;b.length || (b = [\"FirebaseCore-web\"]);c = Fe();\"Browser\" === c ? (d = K(), c = qe(d)) : \"Worker\" === c && (d = K(), c = qe(d) + \"-\" + c);return c + \"/JsCore/\" + a + \"/\" + b.join(\",\");}function K() {return l.navigator && l.navigator.userAgent || \"\";}\n  function L(a, b) {a = a.split(\".\");b = b || l;for (var c = 0; c < a.length && \"object\" == (typeof b === \"undefined\" ? \"undefined\" : _typeof(b)) && null != b; c++) {b = b[a[c]];}c != a.length && (b = void 0);return b;}function Ke() {try {var a = l.localStorage,b = Le();if (a) return a.setItem(b, \"1\"), a.removeItem(b), le() ? !!l.indexedDB : !0;} catch (c) {return Ee() && !!l.indexedDB;}return !1;}function Me() {return (Ne() || \"chrome-extension:\" === Ce() || Be()) && !Ge() && Ke() && !Ee();}function Ne() {return \"http:\" === Ce() || \"https:\" === Ce();}function Ce() {return l.location && l.location.protocol || null;}\n  function Oe(a) {a = a || K();return se(a) || qe(a) == ve ? !1 : !0;}function Pe(a) {return \"undefined\" === typeof a ? null : fe(a);}function Qe(a) {var b = {},c;for (c in a) {a.hasOwnProperty(c) && null !== a[c] && void 0 !== a[c] && (b[c] = a[c]);}return b;}function Re(a) {if (null !== a) return JSON.parse(a);}function Le(a) {return a ? a : Math.floor(1E9 * Math.random()).toString();}function Se(a) {a = a || K();return \"Safari\" == qe(a) || a.toLowerCase().match(/iphone|ipad|ipod/) ? !1 : !0;}\n  function Te() {var a = l.___jsl;if (a && a.H) for (var b in a.H) {if (a.H[b].r = a.H[b].r || [], a.H[b].L = a.H[b].L || [], a.H[b].r = a.H[b].L.concat(), a.CP) for (var c = 0; c < a.CP.length; c++) {a.CP[c] = null;}}}function Ue(a, b) {if (a > b) throw Error(\"Short delay should be less than long delay!\");this.a = a;this.c = b;a = K();b = Fe();this.b = se(a) || \"ReactNative\" === b;}\n  Ue.prototype.get = function () {var a = l.navigator;return (a && \"boolean\" === typeof a.onLine && (Ne() || \"chrome-extension:\" === Ce() || \"undefined\" !== typeof a.connection) ? a.onLine : 1) ? this.b ? this.c : this.a : Math.min(5E3, this.a);};function Ve() {var a = l.document;return a && \"undefined\" !== typeof a.visibilityState ? \"visible\" == a.visibilityState : !0;}\n  function We() {var a = l.document,_b = null;return Ve() || !a ? D() : new C(function (c) {_b = function b() {Ve() && (a.removeEventListener(\"visibilitychange\", _b, !1), c());};a.addEventListener(\"visibilitychange\", _b, !1);}).s(function (c) {a.removeEventListener(\"visibilitychange\", _b, !1);throw c;});}function Xe(a) {\"undefined\" !== typeof console && \"function\" === typeof console.warn && console.warn(a);}\n  function Ye(a) {try {var b = new Date(parseInt(a, 10));if (!isNaN(b.getTime()) && !/[^0-9]/.test(a)) return b.toUTCString();} catch (c) {}return null;}function Ze() {return !(!L(\"fireauth.oauthhelper\", l) && !L(\"fireauth.iframe\", l));}function $e() {var a = l.navigator;return a && a.serviceWorker && a.serviceWorker.controller || null;}function af() {var a = l.navigator;return a && a.serviceWorker ? D().then(function () {return a.serviceWorker.ready;}).then(function (b) {return b.active || null;}).s(function () {return null;}) : D(null);};var bf = {};function cf(a) {bf[a] || (bf[a] = !0, Xe(a));};var df;try {var ef = {};Object.defineProperty(ef, \"abcd\", { configurable: !0, enumerable: !0, value: 1 });Object.defineProperty(ef, \"abcd\", { configurable: !0, enumerable: !0, value: 2 });df = 2 == ef.abcd;} catch (a) {df = !1;}function M(a, b, c) {df ? Object.defineProperty(a, b, { configurable: !0, enumerable: !0, value: c }) : a[b] = c;}function N(a, b) {if (b) for (var c in b) {b.hasOwnProperty(c) && M(a, c, b[c]);}}function ff(a) {var b = {};N(b, a);return b;}function gf(a) {var b = {},c;for (c in a) {a.hasOwnProperty(c) && (b[c] = a[c]);}return b;}\n  function hf(a, b) {if (!b || !b.length) return !0;if (!a) return !1;for (var c = 0; c < b.length; c++) {var d = a[b[c]];if (void 0 === d || null === d || \"\" === d) return !1;}return !0;}function jf(a) {var b = a;if (\"object\" == (typeof a === \"undefined\" ? \"undefined\" : _typeof(a)) && null != a) {b = \"length\" in a ? [] : {};for (var c in a) {M(b, c, jf(a[c]));}}return b;}; /*\n                                                                                                                                                                                                                                                                                                                                                                                         Copyright 2019 Google Inc.\n                                                                                                                                                                                                                                                                                                                                                                                         Licensed under the Apache License, Version 2.0 (the \"License\");\n                                                                                                                                                                                                                                                                                                                                                                                         you may not use this file except in compliance with the License.\n                                                                                                                                                                                                                                                                                                                                                                                         You may obtain a copy of the License at\n                                                                                                                                                                                                                                                                                                                                                                                         http://www.apache.org/licenses/LICENSE-2.0\n                                                                                                                                                                                                                                                                                                                                                                                         Unless required by applicable law or agreed to in writing, software\n                                                                                                                                                                                                                                                                                                                                                                                         distributed under the License is distributed on an \"AS IS\" BASIS,\n                                                                                                                                                                                                                                                                                                                                                                                         WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n                                                                                                                                                                                                                                                                                                                                                                                         See the License for the specific language governing permissions and\n                                                                                                                                                                                                                                                                                                                                                                                         limitations under the License.\n                                                                                                                                                                                                                                                                                                                                                                                         */\n\n\n\n\n  function kf(a) {var b = a && (a[lf] ? \"phone\" : null);if (b && a && a[mf]) {M(this, \"uid\", a[mf]);M(this, \"displayName\", a[nf] || null);var c = null;a[of] && (c = new Date(a[of]).toUTCString());M(this, \"enrollmentTime\", c);M(this, \"factorId\", b);} else throw new t(\"internal-error\", \"Internal assert: invalid MultiFactorInfo object\");}kf.prototype.w = function () {return { uid: this.uid, displayName: this.displayName, factorId: this.factorId, enrollmentTime: this.enrollmentTime };};function pf(a) {try {var b = new qf(a);} catch (c) {b = null;}return b;}\n  var nf = \"displayName\",of = \"enrolledAt\",mf = \"mfaEnrollmentId\",lf = \"phoneInfo\";function qf(a) {kf.call(this, a);M(this, \"phoneNumber\", a[lf]);}r(qf, kf);qf.prototype.w = function () {var a = qf.$a.w.call(this);a.phoneNumber = this.phoneNumber;return a;};function rf(a) {var b = {},c = a[sf],d = a[tf],e = a[uf];a = pf(a[vf]);if (!e || e != wf && e != xf && !c || e == xf && !d || e == yf && !a) throw Error(\"Invalid checkActionCode response!\");e == xf ? (b[zf] = c || null, b[Af] = c || null, b[Bf] = d) : (b[zf] = d || null, b[Af] = d || null, b[Bf] = c || null);b[Cf] = a || null;M(this, Df, e);M(this, Ef, jf(b));}\n  var yf = \"REVERT_SECOND_FACTOR_ADDITION\",wf = \"EMAIL_SIGNIN\",xf = \"VERIFY_AND_CHANGE_EMAIL\",sf = \"email\",vf = \"mfaInfo\",tf = \"newEmail\",uf = \"requestType\",Bf = \"email\",zf = \"fromEmail\",Cf = \"multiFactorInfo\",Af = \"previousEmail\",Ef = \"data\",Df = \"operation\";function Ff(a) {a = J(a);var b = Xd(a, Gf) || null,c = Xd(a, Hf) || null,d = Xd(a, If) || null;d = d ? Jf[d] || null : null;if (!b || !c || !d) throw new t(\"argument-error\", Gf + \", \" + Hf + \"and \" + If + \" are required in a valid action code URL.\");N(this, { apiKey: b, operation: d, code: c, continueUrl: Xd(a, Kf) || null, languageCode: Xd(a, Lf) || null, tenantId: Xd(a, Mf) || null });}\n  var Gf = \"apiKey\",Hf = \"oobCode\",Kf = \"continueUrl\",Lf = \"languageCode\",If = \"mode\",Mf = \"tenantId\",Jf = { recoverEmail: \"RECOVER_EMAIL\", resetPassword: \"PASSWORD_RESET\", revertSecondFactorAddition: yf, signIn: wf, verifyAndChangeEmail: xf, verifyEmail: \"VERIFY_EMAIL\" };function Nf(a) {try {return new Ff(a);} catch (b) {return null;}};function Of(a) {var b = a[Pf];if (\"undefined\" === typeof b) throw new t(\"missing-continue-uri\");if (\"string\" !== typeof b || \"string\" === typeof b && !b.length) throw new t(\"invalid-continue-uri\");this.h = b;this.b = this.a = null;this.g = !1;var c = a[Qf];if (c && \"object\" === (typeof c === \"undefined\" ? \"undefined\" : _typeof(c))) {b = c[Rf];var d = c[Sf];c = c[Tf];if (\"string\" === typeof b && b.length) {this.a = b;if (\"undefined\" !== typeof d && \"boolean\" !== typeof d) throw new t(\"argument-error\", Sf + \" property must be a boolean when specified.\");this.g = !!d;if (\"undefined\" !== typeof c && (\"string\" !==\n        typeof c || \"string\" === typeof c && !c.length)) throw new t(\"argument-error\", Tf + \" property must be a non empty string when specified.\");this.b = c || null;} else {if (\"undefined\" !== typeof b) throw new t(\"argument-error\", Rf + \" property must be a non empty string when specified.\");if (\"undefined\" !== typeof d || \"undefined\" !== typeof c) throw new t(\"missing-android-pkg-name\");}} else if (\"undefined\" !== typeof c) throw new t(\"argument-error\", Qf + \" property must be a non null object when specified.\");this.f = null;if ((b = a[Uf]) && \"object\" === (typeof\n    b === \"undefined\" ? \"undefined\" : _typeof(b))) {if (b = b[Vf], \"string\" === typeof b && b.length) this.f = b;else {if (\"undefined\" !== typeof b) throw new t(\"argument-error\", Vf + \" property must be a non empty string when specified.\");}} else if (\"undefined\" !== typeof b) throw new t(\"argument-error\", Uf + \" property must be a non null object when specified.\");b = a[Wf];if (\"undefined\" !== typeof b && \"boolean\" !== typeof b) throw new t(\"argument-error\", Wf + \" property must be a boolean when specified.\");this.c = !!b;a = a[Xf];if (\"undefined\" !== typeof a && (\"string\" !== typeof a || \"string\" ===\n    typeof a && !a.length)) throw new t(\"argument-error\", Xf + \" property must be a non empty string when specified.\");this.i = a || null;}var Qf = \"android\",Xf = \"dynamicLinkDomain\",Wf = \"handleCodeInApp\",Uf = \"iOS\",Pf = \"url\",Sf = \"installApp\",Tf = \"minimumVersion\",Rf = \"packageName\",Vf = \"bundleId\";\n  function Yf(a) {var b = {};b.continueUrl = a.h;b.canHandleCodeInApp = a.c;if (b.androidPackageName = a.a) b.androidMinimumVersion = a.b, b.androidInstallApp = a.g;b.iOSBundleId = a.f;b.dynamicLinkDomain = a.i;for (var c in b) {null === b[c] && delete b[c];}return b;};function Zf(a) {return Pa(a, function (b) {b = b.toString(16);return 1 < b.length ? b : \"0\" + b;}).join(\"\");};var $f = null;function ag(a) {var b = \"\";bg(a, function (c) {b += String.fromCharCode(c);});return b;}function bg(a, b) {function c(m) {for (; d < a.length;) {var p = a.charAt(d++),v = $f[p];if (null != v) return v;if (!/^[\\s\\xa0]*$/.test(p)) throw Error(\"Unknown base64 encoding at char: \" + p);}return m;}cg();for (var d = 0;;) {var e = c(-1),f = c(0),g = c(64),h = c(64);if (64 === h && -1 === e) break;b(e << 2 | f >> 4);64 != g && (b(f << 4 & 240 | g >> 2), 64 != h && b(g << 6 & 192 | h));}}\n  function cg() {if (!$f) {$f = {};for (var a = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789\".split(\"\"), b = [\"+/=\", \"+/\", \"-_=\", \"-_.\", \"-_\"], c = 0; 5 > c; c++) {for (var d = a.concat(b[c].split(\"\")), e = 0; e < d.length; e++) {var f = d[e];void 0 === $f[f] && ($f[f] = e);}}}};function dg(a) {var b = eg(a);if (!(b && b.sub && b.iss && b.aud && b.exp)) throw Error(\"Invalid JWT\");this.g = a;this.c = b.exp;this.h = b.sub;ua();this.a = b.provider_id || b.firebase && b.firebase.sign_in_provider || null;this.f = b.firebase && b.firebase.tenant || null;this.b = !!b.is_anonymous || \"anonymous\" == this.a;}dg.prototype.S = function () {return this.f;};dg.prototype.i = function () {return this.b;};dg.prototype.toString = function () {return this.g;};function fg(a) {try {return new dg(a);} catch (b) {return null;}}\n  function eg(a) {if (!a) return null;a = a.split(\".\");if (3 != a.length) return null;a = a[1];for (var b = (4 - a.length % 4) % 4, c = 0; c < b; c++) {a += \".\";}try {return JSON.parse(ag(a));} catch (d) {}return null;};var gg = \"oauth_consumer_key oauth_nonce oauth_signature oauth_signature_method oauth_timestamp oauth_token oauth_version\".split(\" \"),hg = [\"client_id\", \"response_type\", \"scope\", \"redirect_uri\", \"state\"],ig = { md: { Ja: \"locale\", ua: 700, ta: 600, fa: \"facebook.com\", Wa: hg }, od: { Ja: null, ua: 500, ta: 750, fa: \"github.com\", Wa: hg }, pd: { Ja: \"hl\", ua: 515, ta: 680, fa: \"google.com\", Wa: hg }, vd: { Ja: \"lang\", ua: 485, ta: 705, fa: \"twitter.com\", Wa: gg }, jd: { Ja: \"locale\", ua: 640, ta: 600, fa: \"apple.com\", Wa: [] } };\n  function jg(a) {for (var b in ig) {if (ig[b].fa == a) return ig[b];}return null;};function kg(a) {var b = {};b[\"facebook.com\"] = lg;b[\"google.com\"] = mg;b[\"github.com\"] = ng;b[\"twitter.com\"] = og;var c = a && a[pg];try {if (c) return b[c] ? new b[c](a) : new qg(a);if (\"undefined\" !== typeof a[rg]) return new sg(a);} catch (d) {}return null;}var rg = \"idToken\",pg = \"providerId\";\n  function sg(a) {var b = a[pg];if (!b && a[rg]) {var c = fg(a[rg]);c && c.a && (b = c.a);}if (!b) throw Error(\"Invalid additional user info!\");if (\"anonymous\" == b || \"custom\" == b) b = null;c = !1;\"undefined\" !== typeof a.isNewUser ? c = !!a.isNewUser : \"identitytoolkit#SignupNewUserResponse\" === a.kind && (c = !0);M(this, \"providerId\", b);M(this, \"isNewUser\", c);}function qg(a) {sg.call(this, a);a = Re(a.rawUserInfo || \"{}\");M(this, \"profile\", jf(a || {}));}r(qg, sg);\n  function lg(a) {qg.call(this, a);if (\"facebook.com\" != this.providerId) throw Error(\"Invalid provider ID!\");}r(lg, qg);function ng(a) {qg.call(this, a);if (\"github.com\" != this.providerId) throw Error(\"Invalid provider ID!\");M(this, \"username\", this.profile && this.profile.login || null);}r(ng, qg);function mg(a) {qg.call(this, a);if (\"google.com\" != this.providerId) throw Error(\"Invalid provider ID!\");}r(mg, qg);\n  function og(a) {qg.call(this, a);if (\"twitter.com\" != this.providerId) throw Error(\"Invalid provider ID!\");M(this, \"username\", a.screenName || null);}r(og, qg);function tg(a) {var b = J(a),c = Xd(b, \"link\"),d = Xd(J(c), \"link\");b = Xd(b, \"deep_link_id\");return Xd(J(b), \"link\") || b || d || c || a;};function ug(a, b) {if (!a && !b) throw new t(\"internal-error\", \"Internal assert: no raw session string available\");if (a && b) throw new t(\"internal-error\", \"Internal assert: unable to determine the session type\");this.a = a || null;this.b = b || null;this.type = this.a ? vg : wg;}var vg = \"enroll\",wg = \"signin\";ug.prototype.Ha = function () {return this.a ? D(this.a) : D(this.b);};ug.prototype.w = function () {return this.type == vg ? { multiFactorSession: { idToken: this.a } } : { multiFactorSession: { pendingCredential: this.b } };};function xg() {}xg.prototype.ja = function () {};xg.prototype.b = function () {};xg.prototype.c = function () {};xg.prototype.w = function () {};function yg(a, b) {return a.then(function (c) {if (c[zg]) {var d = fg(c[zg]);if (!d || b != d.h) throw new t(\"user-mismatch\");return c;}throw new t(\"user-mismatch\");}).s(function (c) {throw c && c.code && c.code == va + \"user-not-found\" ? new t(\"user-mismatch\") : c;});}\n  function Ag(a, b) {if (b) this.a = b;else throw new t(\"internal-error\", \"failed to construct a credential\");M(this, \"providerId\", a);M(this, \"signInMethod\", a);}Ag.prototype.ja = function (a) {return Bg(a, Cg(this));};Ag.prototype.b = function (a, b) {var c = Cg(this);c.idToken = b;return Dg(a, c);};Ag.prototype.c = function (a, b) {return yg(Eg(a, Cg(this)), b);};function Cg(a) {return { pendingToken: a.a, requestUri: \"http://localhost\" };}Ag.prototype.w = function () {return { providerId: this.providerId, signInMethod: this.signInMethod, pendingToken: this.a };};\n  function Fg(a) {if (a && a.providerId && a.signInMethod && 0 == a.providerId.indexOf(\"saml.\") && a.pendingToken) try {return new Ag(a.providerId, a.pendingToken);} catch (b) {}return null;}\n  function Gg(a, b, c) {this.a = null;if (b.idToken || b.accessToken) b.idToken && M(this, \"idToken\", b.idToken), b.accessToken && M(this, \"accessToken\", b.accessToken), b.nonce && !b.pendingToken && M(this, \"nonce\", b.nonce), b.pendingToken && (this.a = b.pendingToken);else if (b.oauthToken && b.oauthTokenSecret) M(this, \"accessToken\", b.oauthToken), M(this, \"secret\", b.oauthTokenSecret);else throw new t(\"internal-error\", \"failed to construct a credential\");M(this, \"providerId\", a);M(this, \"signInMethod\", c);}\n  Gg.prototype.ja = function (a) {return Bg(a, Hg(this));};Gg.prototype.b = function (a, b) {var c = Hg(this);c.idToken = b;return Dg(a, c);};Gg.prototype.c = function (a, b) {var c = Hg(this);return yg(Eg(a, c), b);};\n  function Hg(a) {var b = {};a.idToken && (b.id_token = a.idToken);a.accessToken && (b.access_token = a.accessToken);a.secret && (b.oauth_token_secret = a.secret);b.providerId = a.providerId;a.nonce && !a.a && (b.nonce = a.nonce);b = { postBody: ae(b).toString(), requestUri: \"http://localhost\" };a.a && (delete b.postBody, b.pendingToken = a.a);return b;}\n  Gg.prototype.w = function () {var a = { providerId: this.providerId, signInMethod: this.signInMethod };this.idToken && (a.oauthIdToken = this.idToken);this.accessToken && (a.oauthAccessToken = this.accessToken);this.secret && (a.oauthTokenSecret = this.secret);this.nonce && (a.nonce = this.nonce);this.a && (a.pendingToken = this.a);return a;};\n  function Ig(a) {if (a && a.providerId && a.signInMethod) {var b = { idToken: a.oauthIdToken, accessToken: a.oauthTokenSecret ? null : a.oauthAccessToken, oauthTokenSecret: a.oauthTokenSecret, oauthToken: a.oauthTokenSecret && a.oauthAccessToken, nonce: a.nonce, pendingToken: a.pendingToken };try {return new Gg(a.providerId, b, a.signInMethod);} catch (c) {}}return null;}function Jg(a, b) {this.Pc = b || [];N(this, { providerId: a, isOAuthProvider: !0 });this.Hb = {};this.ob = (jg(a) || {}).Ja || null;this.nb = null;}\n  Jg.prototype.Ka = function (a) {this.Hb = lb(a);return this;};function Kg(a) {if (\"string\" !== typeof a || 0 != a.indexOf(\"saml.\")) throw new t(\"argument-error\", 'SAML provider IDs must be prefixed with \"saml.\"');Jg.call(this, a, []);}r(Kg, Jg);function Lg(a) {Jg.call(this, a, hg);this.a = [];}r(Lg, Jg);Lg.prototype.Ca = function (a) {Ta(this.a, a) || this.a.push(a);return this;};Lg.prototype.Pb = function () {return Xa(this.a);};\n  Lg.prototype.credential = function (a, b) {var c;n(a) ? c = { idToken: a.idToken || null, accessToken: a.accessToken || null, nonce: a.rawNonce || null } : c = { idToken: a || null, accessToken: b || null };if (!c.idToken && !c.accessToken) throw new t(\"argument-error\", \"credential failed: must provide the ID token and/or the access token.\");return new Gg(this.providerId, c, this.providerId);};function Mg() {Lg.call(this, \"facebook.com\");}r(Mg, Lg);M(Mg, \"PROVIDER_ID\", \"facebook.com\");M(Mg, \"FACEBOOK_SIGN_IN_METHOD\", \"facebook.com\");\n  function Ng(a) {if (!a) throw new t(\"argument-error\", \"credential failed: expected 1 argument (the OAuth access token).\");var b = a;n(a) && (b = a.accessToken);return new Mg().credential({ accessToken: b });}function Og() {Lg.call(this, \"github.com\");}r(Og, Lg);M(Og, \"PROVIDER_ID\", \"github.com\");M(Og, \"GITHUB_SIGN_IN_METHOD\", \"github.com\");\n  function Pg(a) {if (!a) throw new t(\"argument-error\", \"credential failed: expected 1 argument (the OAuth access token).\");var b = a;n(a) && (b = a.accessToken);return new Og().credential({ accessToken: b });}function Qg() {Lg.call(this, \"google.com\");this.Ca(\"profile\");}r(Qg, Lg);M(Qg, \"PROVIDER_ID\", \"google.com\");M(Qg, \"GOOGLE_SIGN_IN_METHOD\", \"google.com\");function Rg(a, b) {var c = a;n(a) && (c = a.idToken, b = a.accessToken);return new Qg().credential({ idToken: c, accessToken: b });}function Sg() {Jg.call(this, \"twitter.com\", gg);}\n  r(Sg, Jg);M(Sg, \"PROVIDER_ID\", \"twitter.com\");M(Sg, \"TWITTER_SIGN_IN_METHOD\", \"twitter.com\");function Tg(a, b) {var c = a;n(c) || (c = { oauthToken: a, oauthTokenSecret: b });if (!c.oauthToken || !c.oauthTokenSecret) throw new t(\"argument-error\", \"credential failed: expected 2 arguments (the OAuth access token and secret).\");return new Gg(\"twitter.com\", c, \"twitter.com\");}\n  function Ug(a, b, c) {this.a = a;this.f = b;M(this, \"providerId\", \"password\");M(this, \"signInMethod\", c === Vg.EMAIL_LINK_SIGN_IN_METHOD ? Vg.EMAIL_LINK_SIGN_IN_METHOD : Vg.EMAIL_PASSWORD_SIGN_IN_METHOD);}Ug.prototype.ja = function (a) {return this.signInMethod == Vg.EMAIL_LINK_SIGN_IN_METHOD ? O(a, Wg, { email: this.a, oobCode: this.f }) : O(a, Xg, { email: this.a, password: this.f });};\n  Ug.prototype.b = function (a, b) {return this.signInMethod == Vg.EMAIL_LINK_SIGN_IN_METHOD ? O(a, Yg, { idToken: b, email: this.a, oobCode: this.f }) : O(a, Zg, { idToken: b, email: this.a, password: this.f });};Ug.prototype.c = function (a, b) {return yg(this.ja(a), b);};Ug.prototype.w = function () {return { email: this.a, password: this.f, signInMethod: this.signInMethod };};function $g(a) {return a && a.email && a.password ? new Ug(a.email, a.password, a.signInMethod) : null;}function Vg() {N(this, { providerId: \"password\", isOAuthProvider: !1 });}\n  function ah(a, b) {b = bh(b);if (!b) throw new t(\"argument-error\", \"Invalid email link!\");return new Ug(a, b.code, Vg.EMAIL_LINK_SIGN_IN_METHOD);}function bh(a) {a = tg(a);return (a = Nf(a)) && a.operation === wf ? a : null;}N(Vg, { PROVIDER_ID: \"password\" });N(Vg, { EMAIL_LINK_SIGN_IN_METHOD: \"emailLink\" });N(Vg, { EMAIL_PASSWORD_SIGN_IN_METHOD: \"password\" });function ch(a) {if (!(a.cb && a.bb || a.La && a.ea)) throw new t(\"internal-error\");this.a = a;M(this, \"providerId\", \"phone\");this.fa = \"phone\";M(this, \"signInMethod\", \"phone\");}\n  ch.prototype.ja = function (a) {return a.eb(dh(this));};ch.prototype.b = function (a, b) {var c = dh(this);c.idToken = b;return O(a, eh, c);};ch.prototype.c = function (a, b) {var c = dh(this);c.operation = \"REAUTH\";a = O(a, fh, c);return yg(a, b);};ch.prototype.w = function () {var a = { providerId: \"phone\" };this.a.cb && (a.verificationId = this.a.cb);this.a.bb && (a.verificationCode = this.a.bb);this.a.La && (a.temporaryProof = this.a.La);this.a.ea && (a.phoneNumber = this.a.ea);return a;};\n  function gh(a) {if (a && \"phone\" === a.providerId && (a.verificationId && a.verificationCode || a.temporaryProof && a.phoneNumber)) {var b = {};w([\"verificationId\", \"verificationCode\", \"temporaryProof\", \"phoneNumber\"], function (c) {a[c] && (b[c] = a[c]);});return new ch(b);}return null;}function dh(a) {return a.a.La && a.a.ea ? { temporaryProof: a.a.La, phoneNumber: a.a.ea } : { sessionInfo: a.a.cb, code: a.a.bb };}\n  function hh(a) {try {this.a = a || firebase.auth();} catch (b) {throw new t(\"argument-error\", \"Either an instance of firebase.auth.Auth must be passed as an argument to the firebase.auth.PhoneAuthProvider constructor, or the default firebase App instance must be initialized via firebase.initializeApp().\");}N(this, { providerId: \"phone\", isOAuthProvider: !1 });}\n  hh.prototype.eb = function (a, b) {var c = this.a.a;return D(b.verify()).then(function (d) {if (\"string\" !== typeof d) throw new t(\"argument-error\", \"An implementation of firebase.auth.ApplicationVerifier.prototype.verify() must return a firebase.Promise that resolves with a string.\");switch (b.type) {case \"recaptcha\":var e = n(a) ? a.session : null,f = n(a) ? a.phoneNumber : a,g;e && e.type == vg ? g = e.Ha().then(function (h) {return ih(c, { idToken: h, phoneEnrollmentInfo: { phoneNumber: f, recaptchaToken: d } });}) : e && e.type == wg ? g = e.Ha().then(function (h) {return jh(c,\n            { mfaPendingCredential: h, mfaEnrollmentId: a.multiFactorHint && a.multiFactorHint.uid || a.multiFactorUid, phoneSignInInfo: { recaptchaToken: d } });}) : g = kh(c, { phoneNumber: f, recaptchaToken: d });return g.then(function (h) {\"function\" === typeof b.reset && b.reset();return h;}, function (h) {\"function\" === typeof b.reset && b.reset();throw h;});default:throw new t(\"argument-error\", 'Only firebase.auth.ApplicationVerifiers with type=\"recaptcha\" are currently supported.');}});};\n  function lh(a, b) {if (!a) throw new t(\"missing-verification-id\");if (!b) throw new t(\"missing-verification-code\");return new ch({ cb: a, bb: b });}N(hh, { PROVIDER_ID: \"phone\" });N(hh, { PHONE_SIGN_IN_METHOD: \"phone\" });\n  function mh(a) {if (a.temporaryProof && a.phoneNumber) return new ch({ La: a.temporaryProof, ea: a.phoneNumber });var b = a && a.providerId;if (!b || \"password\" === b) return null;var c = a && a.oauthAccessToken,d = a && a.oauthTokenSecret,e = a && a.nonce,f = a && a.oauthIdToken,g = a && a.pendingToken;try {switch (b) {case \"google.com\":return Rg(f, c);case \"facebook.com\":return Ng(c);case \"github.com\":return Pg(c);case \"twitter.com\":return Tg(c, d);default:return c || d || f || g ? g ? 0 == b.indexOf(\"saml.\") ? new Ag(b, g) : new Gg(b, { pendingToken: g, idToken: a.oauthIdToken,\n            accessToken: a.oauthAccessToken }, b) : new Lg(b).credential({ idToken: f, accessToken: c, rawNonce: e }) : null;}} catch (h) {return null;}}function nh(a) {if (!a.isOAuthProvider) throw new t(\"invalid-oauth-provider\");};function oh(a, b, c, d, e, f, g) {this.c = a;this.b = b || null;this.g = c || null;this.f = d || null;this.i = f || null;this.h = g || null;this.a = e || null;if (this.g || this.a) {if (this.g && this.a) throw new t(\"invalid-auth-event\");if (this.g && !this.f) throw new t(\"invalid-auth-event\");} else throw new t(\"invalid-auth-event\");}oh.prototype.getUid = function () {var a = [];a.push(this.c);this.b && a.push(this.b);this.f && a.push(this.f);this.h && a.push(this.h);return a.join(\"-\");};oh.prototype.S = function () {return this.h;};\n  oh.prototype.w = function () {return { type: this.c, eventId: this.b, urlResponse: this.g, sessionId: this.f, postBody: this.i, tenantId: this.h, error: this.a && this.a.w() };};function ph(a) {a = a || {};return a.type ? new oh(a.type, a.eventId, a.urlResponse, a.sessionId, a.error && ya(a.error), a.postBody, a.tenantId) : null;}; /*\n                                                                                                                                                                                                                                                                                                                                                Copyright 2018 Google Inc.\n                                                                                                                                                                                                                                                                                                                                                Licensed under the Apache License, Version 2.0 (the \"License\");\n                                                                                                                                                                                                                                                                                                                                                you may not use this file except in compliance with the License.\n                                                                                                                                                                                                                                                                                                                                                You may obtain a copy of the License at\n                                                                                                                                                                                                                                                                                                                                                http://www.apache.org/licenses/LICENSE-2.0\n                                                                                                                                                                                                                                                                                                                                                Unless required by applicable law or agreed to in writing, software\n                                                                                                                                                                                                                                                                                                                                                distributed under the License is distributed on an \"AS IS\" BASIS,\n                                                                                                                                                                                                                                                                                                                                                WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n                                                                                                                                                                                                                                                                                                                                                See the License for the specific language governing permissions and\n                                                                                                                                                                                                                                                                                                                                                limitations under the License.\n                                                                                                                                                                                                                                                                                                                                                */\n\n\n\n\n  function qh() {this.b = null;this.a = [];}var rh = null;function sh(a) {var b = rh;b.a.push(a);b.b || (b.b = function (c) {for (var d = 0; d < b.a.length; d++) {b.a[d](c);}}, a = L(\"universalLinks.subscribe\", l), \"function\" === typeof a && a(null, b.b));};function th(a) {var b = \"unauthorized-domain\",c = void 0,d = J(a);a = d.a;d = d.f;\"chrome-extension\" == d ? c = Nb(\"This chrome extension ID (chrome-extension://%s) is not authorized to run this operation. Add it to the OAuth redirect domains list in the Firebase console -> Auth section -> Sign in method tab.\", a) : \"http\" == d || \"https\" == d ? c = Nb(\"This domain (%s) is not authorized to run this operation. Add it to the OAuth redirect domains list in the Firebase console -> Auth section -> Sign in method tab.\", a) : b = \"operation-not-supported-in-this-environment\";\n    t.call(this, b, c);}r(th, t);function uh(a, b, c) {t.call(this, a, c);a = b || {};a.Ib && M(this, \"email\", a.Ib);a.ea && M(this, \"phoneNumber\", a.ea);a.credential && M(this, \"credential\", a.credential);a.Yb && M(this, \"tenantId\", a.Yb);}r(uh, t);uh.prototype.w = function () {var a = { code: this.code, message: this.message };this.email && (a.email = this.email);this.phoneNumber && (a.phoneNumber = this.phoneNumber);this.tenantId && (a.tenantId = this.tenantId);var b = this.credential && this.credential.w();b && z(a, b);return a;};uh.prototype.toJSON = function () {return this.w();};\n  function vh(a) {if (a.code) {var b = a.code || \"\";0 == b.indexOf(va) && (b = b.substring(va.length));var c = { credential: mh(a), Yb: a.tenantId };if (a.email) c.Ib = a.email;else if (a.phoneNumber) c.ea = a.phoneNumber;else if (!c.credential) return new t(b, a.message || void 0);return new uh(b, c, a.message);}return null;};function wh() {}wh.prototype.c = null;function xh(a) {return a.c || (a.c = a.b());};var yh;function zh() {}r(zh, wh);zh.prototype.a = function () {var a = Ah(this);return a ? new ActiveXObject(a) : new XMLHttpRequest();};zh.prototype.b = function () {var a = {};Ah(this) && (a[0] = !0, a[1] = !0);return a;};\n  function Ah(a) {if (!a.f && \"undefined\" == typeof XMLHttpRequest && \"undefined\" != typeof ActiveXObject) {for (var b = [\"MSXML2.XMLHTTP.6.0\", \"MSXML2.XMLHTTP.3.0\", \"MSXML2.XMLHTTP\", \"Microsoft.XMLHTTP\"], c = 0; c < b.length; c++) {var d = b[c];try {return new ActiveXObject(d), a.f = d;} catch (e) {}}throw Error(\"Could not create ActiveXObject. ActiveX might be disabled, or MSXML might not be installed\");}return a.f;}yh = new zh();function Bh() {}r(Bh, wh);Bh.prototype.a = function () {var a = new XMLHttpRequest();if (\"withCredentials\" in a) return a;if (\"undefined\" != typeof XDomainRequest) return new Ch();throw Error(\"Unsupported browser\");};Bh.prototype.b = function () {return {};};\n  function Ch() {this.a = new XDomainRequest();this.readyState = 0;this.onreadystatechange = null;this.responseType = this.responseText = this.response = \"\";this.status = -1;this.statusText = \"\";this.a.onload = q(this.pc, this);this.a.onerror = q(this.Rb, this);this.a.onprogress = q(this.qc, this);this.a.ontimeout = q(this.uc, this);}k = Ch.prototype;k.open = function (a, b, c) {if (null != c && !c) throw Error(\"Only async requests are supported.\");this.a.open(a, b);};\n  k.send = function (a) {if (a) {if (\"string\" == typeof a) this.a.send(a);else throw Error(\"Only string data is supported\");} else this.a.send();};k.abort = function () {this.a.abort();};k.setRequestHeader = function () {};k.getResponseHeader = function (a) {return \"content-type\" == a.toLowerCase() ? this.a.contentType : \"\";};k.pc = function () {this.status = 200;this.response = this.responseText = this.a.responseText;Dh(this, 4);};k.Rb = function () {this.status = 500;this.response = this.responseText = \"\";Dh(this, 4);};k.uc = function () {this.Rb();};\n  k.qc = function () {this.status = 200;Dh(this, 1);};function Dh(a, b) {a.readyState = b;if (a.onreadystatechange) a.onreadystatechange();}k.getAllResponseHeaders = function () {return \"content-type: \" + this.a.contentType;};function Eh(a, b, c) {this.reset(a, b, c, void 0, void 0);}Eh.prototype.a = null;var Fh = 0;Eh.prototype.reset = function (a, b, c, d, e) {\"number\" == typeof e || Fh++;d || ua();delete this.a;};function Gh(a) {this.f = a;this.b = this.c = this.a = null;}function Hh(a, b) {this.name = a;this.value = b;}Hh.prototype.toString = function () {return this.name;};var Ih = new Hh(\"SEVERE\", 1E3),Jh = new Hh(\"WARNING\", 900),Kh = new Hh(\"CONFIG\", 700),Lh = new Hh(\"FINE\", 500);function Mh(a) {if (a.c) return a.c;if (a.a) return Mh(a.a);Ea(\"Root logger has no level set.\");return null;}Gh.prototype.log = function (a, b, c) {if (a.value >= Mh(this).value) for (na(b) && (b = b()), a = new Eh(a, String(b), this.f), c && (a.a = c), c = this; c;) {c = c.a;}};var Nh = {},Oh = null;\n  function Ph(a) {Oh || (Oh = new Gh(\"\"), Nh[\"\"] = Oh, Oh.c = Kh);var b;if (!(b = Nh[a])) {b = new Gh(a);var c = a.lastIndexOf(\".\"),d = a.substr(c + 1);c = Ph(a.substr(0, c));c.b || (c.b = {});c.b[d] = b;b.a = c;Nh[a] = b;}return b;};function Qh(a, b) {a && a.log(Lh, b, void 0);};function Rh(a) {this.f = a;}r(Rh, wh);Rh.prototype.a = function () {return new Sh(this.f);};Rh.prototype.b = function (a) {return function () {return a;};}({});function Sh(a) {H.call(this);this.o = a;this.readyState = Th;this.status = 0;this.responseType = this.responseText = this.response = this.statusText = \"\";this.onreadystatechange = null;this.i = new Headers();this.b = null;this.m = \"GET\";this.g = \"\";this.a = !1;this.h = Ph(\"goog.net.FetchXmlHttp\");this.l = this.c = this.f = null;}r(Sh, H);var Th = 0;k = Sh.prototype;\n  k.open = function (a, b) {if (this.readyState != Th) throw this.abort(), Error(\"Error reopening a connection\");this.m = a;this.g = b;this.readyState = 1;Uh(this);};k.send = function (a) {if (1 != this.readyState) throw this.abort(), Error(\"need to call open() first. \");this.a = !0;var b = { headers: this.i, method: this.m, credentials: void 0, cache: void 0 };a && (b.body = a);this.o.fetch(new Request(this.g, b)).then(this.tc.bind(this), this.Ta.bind(this));};\n  k.abort = function () {this.response = this.responseText = \"\";this.i = new Headers();this.status = 0;this.c && this.c.cancel(\"Request was aborted.\");1 <= this.readyState && this.a && 4 != this.readyState && (this.a = !1, Vh(this, !1));this.readyState = Th;};\n  k.tc = function (a) {this.a && (this.f = a, this.b || (this.b = a.headers, this.readyState = 2, Uh(this)), this.a && (this.readyState = 3, Uh(this), this.a && (\"arraybuffer\" === this.responseType ? a.arrayBuffer().then(this.rc.bind(this), this.Ta.bind(this)) : \"undefined\" !== typeof l.ReadableStream && \"body\" in a ? (this.response = this.responseText = \"\", this.c = a.body.getReader(), this.l = new TextDecoder(), Wh(this)) : a.text().then(this.sc.bind(this), this.Ta.bind(this)))));};function Wh(a) {a.c.read().then(a.oc.bind(a)).catch(a.Ta.bind(a));}\n  k.oc = function (a) {if (this.a) {var b = this.l.decode(a.value ? a.value : new Uint8Array(0), { stream: !a.done });b && (this.response = this.responseText += b);a.done ? Vh(this, !0) : Uh(this);3 == this.readyState && Wh(this);}};k.sc = function (a) {this.a && (this.response = this.responseText = a, Vh(this, !0));};k.rc = function (a) {this.a && (this.response = a, Vh(this, !0));};k.Ta = function (a) {var b = this.h;b && b.log(Jh, \"Failed to fetch url \" + this.g, a instanceof Error ? a : Error(a));this.a && Vh(this, !0);};\n  function Vh(a, b) {b && a.f && (a.status = a.f.status, a.statusText = a.f.statusText);a.readyState = 4;a.f = null;a.c = null;a.l = null;Uh(a);}k.setRequestHeader = function (a, b) {this.i.append(a, b);};k.getResponseHeader = function (a) {return this.b ? this.b.get(a.toLowerCase()) || \"\" : ((a = this.h) && a.log(Jh, \"Attempting to get response header but no headers have been received for url: \" + this.g, void 0), \"\");};\n  k.getAllResponseHeaders = function () {if (!this.b) {var a = this.h;a && a.log(Jh, \"Attempting to get all response headers but no headers have been received for url: \" + this.g, void 0);return \"\";}a = [];for (var b = this.b.entries(), c = b.next(); !c.done;) {c = c.value, a.push(c[0] + \": \" + c[1]), c = b.next();}return a.join(\"\\r\\n\");};function Uh(a) {a.onreadystatechange && a.onreadystatechange.call(a);};function Xh(a) {H.call(this);this.headers = new Ed();this.O = a || null;this.c = !1;this.A = this.a = null;this.h = this.P = this.l = \"\";this.f = this.N = this.i = this.G = !1;this.g = 0;this.o = null;this.m = Yh;this.u = this.R = !1;}r(Xh, H);var Yh = \"\";Xh.prototype.b = Ph(\"goog.net.XhrIo\");var Zh = /^https?$/i,$h = [\"POST\", \"PUT\"];\n  function ai(a, b, c, d, e) {if (a.a) throw Error(\"[goog.net.XhrIo] Object is active with another request=\" + a.l + \"; newUri=\" + b);c = c ? c.toUpperCase() : \"GET\";a.l = b;a.h = \"\";a.P = c;a.G = !1;a.c = !0;a.a = a.O ? a.O.a() : yh.a();a.A = a.O ? xh(a.O) : xh(yh);a.a.onreadystatechange = q(a.Ub, a);try {Qh(a.b, bi(a, \"Opening Xhr\")), a.N = !0, a.a.open(c, String(b), !0), a.N = !1;} catch (g) {Qh(a.b, bi(a, \"Error opening Xhr: \" + g.message));ci(a, g);return;}b = d || \"\";var f = new Ed(a.headers);e && Dd(e, function (g, h) {f.set(h, g);});e = Ra(f.Y());d = l.FormData && b instanceof\n    l.FormData;!Ta($h, c) || e || d || f.set(\"Content-Type\", \"application/x-www-form-urlencoded;charset=utf-8\");f.forEach(function (g, h) {this.a.setRequestHeader(h, g);}, a);a.m && (a.a.responseType = a.m);\"withCredentials\" in a.a && a.a.withCredentials !== a.R && (a.a.withCredentials = a.R);try {di(a), 0 < a.g && (a.u = ei(a.a), Qh(a.b, bi(a, \"Will abort after \" + a.g + \"ms if incomplete, xhr2 \" + a.u)), a.u ? (a.a.timeout = a.g, a.a.ontimeout = q(a.Ma, a)) : a.o = zd(a.Ma, a.g, a)), Qh(a.b, bi(a, \"Sending request\")), a.i = !0, a.a.send(b), a.i = !1;} catch (g) {Qh(a.b,\n      bi(a, \"Send error: \" + g.message)), ci(a, g);}}function ei(a) {return Tb && cc(9) && \"number\" === typeof a.timeout && void 0 !== a.ontimeout;}function Sa(a) {return \"content-type\" == a.toLowerCase();}k = Xh.prototype;k.Ma = function () {\"undefined\" != typeof ha && this.a && (this.h = \"Timed out after \" + this.g + \"ms, aborting\", Qh(this.b, bi(this, this.h)), this.dispatchEvent(\"timeout\"), this.abort(8));};function ci(a, b) {a.c = !1;a.a && (a.f = !0, a.a.abort(), a.f = !1);a.h = b;fi(a);gi(a);}\n  function fi(a) {a.G || (a.G = !0, a.dispatchEvent(\"complete\"), a.dispatchEvent(\"error\"));}k.abort = function () {this.a && this.c && (Qh(this.b, bi(this, \"Aborting\")), this.c = !1, this.f = !0, this.a.abort(), this.f = !1, this.dispatchEvent(\"complete\"), this.dispatchEvent(\"abort\"), gi(this));};k.Da = function () {this.a && (this.c && (this.c = !1, this.f = !0, this.a.abort(), this.f = !1), gi(this, !0));Xh.$a.Da.call(this);};k.Ub = function () {this.xa || (this.N || this.i || this.f ? hi(this) : this.Ic());};k.Ic = function () {hi(this);};\n  function hi(a) {if (a.c && \"undefined\" != typeof ha) if (a.A[1] && 4 == ii(a) && 2 == ji(a)) Qh(a.b, bi(a, \"Local request error detected and ignored\"));else if (a.i && 4 == ii(a)) zd(a.Ub, 0, a);else if (a.dispatchEvent(\"readystatechange\"), 4 == ii(a)) {Qh(a.b, bi(a, \"Request complete\"));a.c = !1;try {var b = ji(a);a: switch (b) {case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var c = !0;break a;default:c = !1;}var d;if (!(d = c)) {var e;if (e = 0 === b) {var f = String(a.l).match(Hd)[1] || null;if (!f && l.self && l.self.location) {var g = l.self.location.protocol;\n              f = g.substr(0, g.length - 1);}e = !Zh.test(f ? f.toLowerCase() : \"\");}d = e;}if (d) a.dispatchEvent(\"complete\"), a.dispatchEvent(\"success\");else {try {var h = 2 < ii(a) ? a.a.statusText : \"\";} catch (m) {Qh(a.b, \"Can not get status: \" + m.message), h = \"\";}a.h = h + \" [\" + ji(a) + \"]\";fi(a);}} finally {gi(a);}}}function gi(a, b) {if (a.a) {di(a);var c = a.a,d = a.A[0] ? ka : null;a.a = null;a.A = null;b || a.dispatchEvent(\"ready\");try {c.onreadystatechange = d;} catch (e) {(a = a.b) && a.log(Ih, \"Problem encountered resetting onreadystatechange: \" + e.message, void 0);}}}\n  function di(a) {a.a && a.u && (a.a.ontimeout = null);a.o && (l.clearTimeout(a.o), a.o = null);}function ii(a) {return a.a ? a.a.readyState : 0;}function ji(a) {try {return 2 < ii(a) ? a.a.status : -1;} catch (b) {return -1;}}function ki(a) {try {return a.a ? a.a.responseText : \"\";} catch (b) {return Qh(a.b, \"Can not get responseText: \" + b.message), \"\";}}\n  k.getResponse = function () {try {if (!this.a) return null;if (\"response\" in this.a) return this.a.response;switch (this.m) {case Yh:case \"text\":return this.a.responseText;case \"arraybuffer\":if (\"mozResponseArrayBuffer\" in this.a) return this.a.mozResponseArrayBuffer;}var a = this.b;a && a.log(Ih, \"Response type \" + this.m + \" is not supported on this browser\", void 0);return null;} catch (b) {return Qh(this.b, \"Can not get response: \" + b.message), null;}};function bi(a, b) {return b + \" [\" + a.P + \" \" + a.l + \" \" + ji(a) + \"]\";}; /*\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            Portions of this code are from MochiKit, received by\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            The Closure Authors under the MIT license. All other code is Copyright\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            2005-2009 The Closure Authors. All Rights Reserved.\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            */\n  function li(a) {var b = mi;this.g = [];this.u = b;this.o = a || null;this.f = this.a = !1;this.c = void 0;this.m = this.A = this.i = !1;this.h = 0;this.b = null;this.l = 0;}li.prototype.cancel = function (a) {if (this.a) this.c instanceof li && this.c.cancel();else {if (this.b) {var b = this.b;delete this.b;a ? b.cancel(a) : (b.l--, 0 >= b.l && b.cancel());}this.u ? this.u.call(this.o, this) : this.m = !0;this.a || (a = new ni(this), oi(this), pi(this, !1, a));}};li.prototype.v = function (a, b) {this.i = !1;pi(this, a, b);};function pi(a, b, c) {a.a = !0;a.c = c;a.f = !b;qi(a);}\n  function oi(a) {if (a.a) {if (!a.m) throw new ri(a);a.m = !1;}}function si(a, b) {ti(a, null, b, void 0);}function ti(a, b, c, d) {a.g.push([b, c, d]);a.a && qi(a);}li.prototype.then = function (a, b, c) {var d,e,f = new C(function (g, h) {d = g;e = h;});ti(this, d, function (g) {g instanceof ni ? f.cancel() : e(g);});return f.then(a, b, c);};li.prototype.$goog_Thenable = !0;function ui(a) {return Qa(a.g, function (b) {return na(b[1]);});}\n  function qi(a) {if (a.h && a.a && ui(a)) {var b = a.h,c = vi[b];c && (l.clearTimeout(c.a), delete vi[b]);a.h = 0;}a.b && (a.b.l--, delete a.b);b = a.c;for (var d = c = !1; a.g.length && !a.i;) {var e = a.g.shift(),f = e[0],g = e[1];e = e[2];if (f = a.f ? g : f) try {var h = f.call(e || a.o, b);void 0 !== h && (a.f = a.f && (h == b || h instanceof Error), a.c = b = h);if (Ca(b) || \"function\" === typeof l.Promise && b instanceof l.Promise) d = !0, a.i = !0;} catch (m) {b = m, a.f = !0, ui(a) || (c = !0);}}a.c = b;d && (h = q(a.v, a, !0), d = q(a.v, a, !1), b instanceof li ? (ti(b, h, d), b.A = !0) : b.then(h, d));c && (b =\n    new wi(b), vi[b.a] = b, a.h = b.a);}function ri() {u.call(this);}r(ri, u);ri.prototype.message = \"Deferred has already fired\";ri.prototype.name = \"AlreadyCalledError\";function ni() {u.call(this);}r(ni, u);ni.prototype.message = \"Deferred was canceled\";ni.prototype.name = \"CanceledError\";function wi(a) {this.a = l.setTimeout(q(this.c, this), 0);this.b = a;}wi.prototype.c = function () {delete vi[this.a];throw this.b;};var vi = {};function xi(a) {var b = {},c = b.document || document,d = wb(a).toString(),e = jc(document, \"SCRIPT\"),f = { Vb: e, Ma: void 0 },g = new li(f),h = null,m = null != b.timeout ? b.timeout : 5E3;0 < m && (h = window.setTimeout(function () {yi(e, !0);var p = new zi(Ai, \"Timeout reached for loading script \" + d);oi(g);pi(g, !1, p);}, m), f.Ma = h);e.onload = e.onreadystatechange = function () {e.readyState && \"loaded\" != e.readyState && \"complete\" != e.readyState || (yi(e, b.wd || !1, h), oi(g), pi(g, !0, null));};e.onerror = function () {yi(e, !0, h);var p = new zi(Bi, \"Error while loading script \" +\n      d);oi(g);pi(g, !1, p);};f = b.attributes || {};z(f, { type: \"text/javascript\", charset: \"UTF-8\" });gc(e, f);Mb(e, a);Ci(c).appendChild(e);return g;}function Ci(a) {var b;return (b = (a || document).getElementsByTagName(\"HEAD\")) && 0 != b.length ? b[0] : a.documentElement;}function mi() {if (this && this.Vb) {var a = this.Vb;a && \"SCRIPT\" == a.tagName && yi(a, !0, this.Ma);}}\n  function yi(a, b, c) {null != c && l.clearTimeout(c);a.onload = ka;a.onerror = ka;a.onreadystatechange = ka;b && window.setTimeout(function () {a && a.parentNode && a.parentNode.removeChild(a);}, 0);}var Bi = 0,Ai = 1;function zi(a, b) {var c = \"Jsloader error (code #\" + a + \")\";b && (c += \": \" + b);u.call(this, c);this.code = a;}r(zi, u);function Di(a) {this.f = a;}r(Di, wh);Di.prototype.a = function () {return new this.f();};Di.prototype.b = function () {return {};};\n  function Ei(a, b, c) {this.c = a;a = b || {};this.l = a.secureTokenEndpoint || \"https://securetoken.googleapis.com/v1/token\";this.v = a.secureTokenTimeout || Fi;this.g = lb(a.secureTokenHeaders || Gi);this.h = a.firebaseEndpoint || \"https://www.googleapis.com/identitytoolkit/v3/relyingparty/\";this.i = a.identityPlatformEndpoint || \"https://identitytoolkit.googleapis.com/v2/\";this.m = a.firebaseTimeout || Hi;this.a = lb(a.firebaseHeaders || Ii);c && (this.a[\"X-Client-Version\"] = c, this.g[\"X-Client-Version\"] = c);c = \"Node\" == Fe();c = l.XMLHttpRequest ||\n    c && firebase.INTERNAL.node && firebase.INTERNAL.node.XMLHttpRequest;if (!c && !Ee()) throw new t(\"internal-error\", \"The XMLHttpRequest compatibility library was not found.\");this.f = void 0;Ee() ? this.f = new Rh(self) : Ge() ? this.f = new Di(c) : this.f = new Bh();this.b = null;}var Ji,zg = \"idToken\",Fi = new Ue(3E4, 6E4),Gi = { \"Content-Type\": \"application/x-www-form-urlencoded\" },Hi = new Ue(3E4, 6E4),Ii = { \"Content-Type\": \"application/json\" };function Ki(a, b) {b ? a.a[\"X-Firebase-Locale\"] = b : delete a.a[\"X-Firebase-Locale\"];}\n  function Li(a, b) {b && (a.l = Mi(\"https://securetoken.googleapis.com/v1/token\", b), a.h = Mi(\"https://www.googleapis.com/identitytoolkit/v3/relyingparty/\", b), a.i = Mi(\"https://identitytoolkit.googleapis.com/v2/\", b));}function Mi(a, b) {a = J(a);b = J(b.url);a.c = a.a + a.c;Kd(a, b.f);a.a = b.a;Ld(a, b.g);return a.toString();}function Ni(a, b) {b ? (a.a[\"X-Client-Version\"] = b, a.g[\"X-Client-Version\"] = b) : (delete a.a[\"X-Client-Version\"], delete a.g[\"X-Client-Version\"]);}Ei.prototype.S = function () {return this.b;};\n  function Oi(a, b, c, d, e, f, g) {pe() || Ee() ? a = q(a.u, a) : (Ji || (Ji = new C(function (h, m) {Pi(h, m);})), a = q(a.o, a));a(b, c, d, e, f, g);}\n  Ei.prototype.u = function (a, b, c, d, e, f) {if (Ee() && (\"undefined\" === typeof l.fetch || \"undefined\" === typeof l.Headers || \"undefined\" === typeof l.Request)) throw new t(\"operation-not-supported-in-this-environment\", \"fetch, Headers and Request native APIs or equivalent Polyfills must be available to support HTTP requests from a Worker environment.\");var g = new Xh(this.f);if (f) {g.g = Math.max(0, f);var h = setTimeout(function () {g.dispatchEvent(\"timeout\");}, f);}md(g, \"complete\", function () {h && clearTimeout(h);var m = null;try {m =\n        JSON.parse(ki(this)) || null;} catch (p) {m = null;}b && b(m);});sd(g, \"ready\", function () {h && clearTimeout(h);Tc(this);});sd(g, \"timeout\", function () {h && clearTimeout(h);Tc(this);b && b(null);});ai(g, a, c, d, e);};var Qi = new ob(pb, \"https://apis.google.com/js/client.js?onload=%{onload}\"),Ri = \"__fcb\" + Math.floor(1E6 * Math.random()).toString();\n  function Pi(a, b) {if (((window.gapi || {}).client || {}).request) a();else {l[Ri] = function () {((window.gapi || {}).client || {}).request ? a() : b(Error(\"CORS_UNSUPPORTED\"));};var c = xb(Qi, { onload: Ri });si(xi(c), function () {b(Error(\"CORS_UNSUPPORTED\"));});}}\n  Ei.prototype.o = function (a, b, c, d, e) {var f = this;Ji.then(function () {window.gapi.client.setApiKey(f.c);var g = window.gapi.auth.getToken();window.gapi.auth.setToken(null);window.gapi.client.request({ path: a, method: c, body: d, headers: e, authType: \"none\", callback: function callback(h) {window.gapi.auth.setToken(g);b && b(h);} });}).s(function (g) {b && b({ error: { message: g && g.message || \"CORS_UNSUPPORTED\" } });});};\n  function Si(a, b) {return new C(function (c, d) {\"refresh_token\" == b.grant_type && b.refresh_token || \"authorization_code\" == b.grant_type && b.code ? Oi(a, a.l + \"?key=\" + encodeURIComponent(a.c), function (e) {e ? e.error ? d(Ti(e)) : e.access_token && e.refresh_token ? c(e) : d(new t(\"internal-error\")) : d(new t(\"network-request-failed\"));}, \"POST\", ae(b).toString(), a.g, a.v.get()) : d(new t(\"internal-error\"));});}\n  function Ui(a, b, c, d, e, f, g) {var h = J(b + c);I(h, \"key\", a.c);g && I(h, \"cb\", ua().toString());var m = \"GET\" == d;if (m) for (var p in e) {e.hasOwnProperty(p) && I(h, p, e[p]);}return new C(function (v, B) {Oi(a, h.toString(), function (A) {A ? A.error ? B(Ti(A, f || {})) : v(A) : B(new t(\"network-request-failed\"));}, d, m ? void 0 : fe(Qe(e)), a.a, a.m.get());});}function Vi(a) {a = a.email;if (\"string\" !== typeof a || !ye.test(a)) throw new t(\"invalid-email\");}function Wi(a) {\"email\" in a && Vi(a);}\n  function Xi(a, b) {return O(a, Yi, { identifier: b, continueUri: Ne() ? me() : \"http://localhost\" }).then(function (c) {return c.signinMethods || [];});}function Zi(a) {return O(a, $i, {}).then(function (b) {return b.authorizedDomains || [];});}function P(a) {if (!a[zg]) {if (a.mfaPendingCredential) throw new t(\"multi-factor-auth-required\", null, lb(a));throw new t(\"internal-error\");}}\n  function aj(a) {if (a.phoneNumber || a.temporaryProof) {if (!a.phoneNumber || !a.temporaryProof) throw new t(\"internal-error\");} else {if (!a.sessionInfo) throw new t(\"missing-verification-id\");if (!a.code) throw new t(\"missing-verification-code\");}}Ei.prototype.yb = function () {return O(this, bj, {});};Ei.prototype.Ab = function (a, b) {return O(this, cj, { idToken: a, email: b });};Ei.prototype.Bb = function (a, b) {return O(this, Zg, { idToken: a, password: b });};var dj = { displayName: \"DISPLAY_NAME\", photoUrl: \"PHOTO_URL\" };k = Ei.prototype;\n  k.Cb = function (a, b) {var c = { idToken: a },d = [];jb(dj, function (e, f) {var g = b[f];null === g ? d.push(e) : f in b && (c[f] = g);});d.length && (c.deleteAttribute = d);return O(this, cj, c);};k.ub = function (a, b) {a = { requestType: \"PASSWORD_RESET\", email: a };z(a, b);return O(this, ej, a);};k.vb = function (a, b) {a = { requestType: \"EMAIL_SIGNIN\", email: a };z(a, b);return O(this, fj, a);};k.tb = function (a, b) {a = { requestType: \"VERIFY_EMAIL\", idToken: a };z(a, b);return O(this, gj, a);};\n  k.Db = function (a, b, c) {a = { requestType: \"VERIFY_AND_CHANGE_EMAIL\", idToken: a, newEmail: b };z(a, c);return O(this, hj, a);};function kh(a, b) {return O(a, ij, b);}k.eb = function (a) {return O(this, jj, a);};function ih(a, b) {return O(a, kj, b).then(function (c) {return c.phoneSessionInfo.sessionInfo;});}\n  function lj(a) {if (!a.phoneVerificationInfo) throw new t(\"internal-error\");if (!a.phoneVerificationInfo.sessionInfo) throw new t(\"missing-verification-id\");if (!a.phoneVerificationInfo.code) throw new t(\"missing-verification-code\");}function jh(a, b) {return O(a, mj, b).then(function (c) {return c.phoneResponseInfo.sessionInfo;});}function nj(a, b, c) {return O(a, oj, { idToken: b, deleteProvider: c });}function pj(a) {if (!a.requestUri || !a.sessionId && !a.postBody && !a.pendingToken) throw new t(\"internal-error\");}\n  function qj(a, b) {b.oauthIdToken && b.providerId && 0 == b.providerId.indexOf(\"oidc.\") && !b.pendingToken && (a.sessionId ? b.nonce = a.sessionId : a.postBody && (a = new Pd(a.postBody), ee(a, \"nonce\") && (b.nonce = a.get(\"nonce\"))));return b;}\n  function rj(a) {var b = null;a.needConfirmation ? (a.code = \"account-exists-with-different-credential\", b = vh(a)) : \"FEDERATED_USER_ID_ALREADY_LINKED\" == a.errorMessage ? (a.code = \"credential-already-in-use\", b = vh(a)) : \"EMAIL_EXISTS\" == a.errorMessage ? (a.code = \"email-already-in-use\", b = vh(a)) : a.errorMessage && (b = sj(a.errorMessage));if (b) throw b;P(a);}function Bg(a, b) {b.returnIdpCredential = !0;return O(a, tj, b);}function Dg(a, b) {b.returnIdpCredential = !0;return O(a, uj, b);}\n  function Eg(a, b) {b.returnIdpCredential = !0;b.autoCreate = !1;return O(a, vj, b);}function wj(a) {if (!a.oobCode) throw new t(\"invalid-action-code\");}k.mb = function (a, b) {return O(this, xj, { oobCode: a, newPassword: b });};k.Qa = function (a) {return O(this, yj, { oobCode: a });};k.ib = function (a) {return O(this, zj, { oobCode: a });};\n  var zj = { endpoint: \"setAccountInfo\", B: wj, Z: \"email\", C: !0 },yj = { endpoint: \"resetPassword\", B: wj, F: function F(a) {var b = a.requestType;if (!b || !a.email && \"EMAIL_SIGNIN\" != b && \"VERIFY_AND_CHANGE_EMAIL\" != b) throw new t(\"internal-error\");}, C: !0 },Aj = { endpoint: \"signupNewUser\", B: function B(a) {Vi(a);if (!a.password) throw new t(\"weak-password\");}, F: P, U: !0, C: !0 },Yi = { endpoint: \"createAuthUri\", C: !0 },Bj = { endpoint: \"deleteAccount\", M: [\"idToken\"] },oj = { endpoint: \"setAccountInfo\", M: [\"idToken\", \"deleteProvider\"], B: function B(a) {if (\"array\" !=\n      la(a.deleteProvider)) throw new t(\"internal-error\");} },Wg = { endpoint: \"emailLinkSignin\", M: [\"email\", \"oobCode\"], B: Vi, F: P, U: !0, C: !0 },Yg = { endpoint: \"emailLinkSignin\", M: [\"idToken\", \"email\", \"oobCode\"], B: Vi, F: P, U: !0 },Cj = { endpoint: \"accounts/mfaEnrollment:finalize\", M: [\"idToken\", \"phoneVerificationInfo\"], B: lj, F: P, C: !0, Na: !0 },Dj = { endpoint: \"accounts/mfaSignIn:finalize\", M: [\"mfaPendingCredential\", \"phoneVerificationInfo\"], B: lj, F: P, C: !0, Na: !0 },Ej = { endpoint: \"getAccountInfo\" },fj = { endpoint: \"getOobConfirmationCode\", M: [\"requestType\"],\n    B: function B(a) {if (\"EMAIL_SIGNIN\" != a.requestType) throw new t(\"internal-error\");Vi(a);}, Z: \"email\", C: !0 },gj = { endpoint: \"getOobConfirmationCode\", M: [\"idToken\", \"requestType\"], B: function B(a) {if (\"VERIFY_EMAIL\" != a.requestType) throw new t(\"internal-error\");}, Z: \"email\", C: !0 },hj = { endpoint: \"getOobConfirmationCode\", M: [\"idToken\", \"newEmail\", \"requestType\"], B: function B(a) {if (\"VERIFY_AND_CHANGE_EMAIL\" != a.requestType) throw new t(\"internal-error\");}, Z: \"email\", C: !0 },ej = { endpoint: \"getOobConfirmationCode\", M: [\"requestType\"], B: function B(a) {if (\"PASSWORD_RESET\" !=\n      a.requestType) throw new t(\"internal-error\");Vi(a);}, Z: \"email\", C: !0 },$i = { kb: !0, endpoint: \"getProjectConfig\", Tb: \"GET\" },Fj = { kb: !0, endpoint: \"getRecaptchaParam\", Tb: \"GET\", F: function F(a) {if (!a.recaptchaSiteKey) throw new t(\"internal-error\");} },xj = { endpoint: \"resetPassword\", B: wj, Z: \"email\", C: !0 },ij = { endpoint: \"sendVerificationCode\", M: [\"phoneNumber\", \"recaptchaToken\"], Z: \"sessionInfo\", C: !0 },cj = { endpoint: \"setAccountInfo\", M: [\"idToken\"], B: Wi, U: !0 },Zg = { endpoint: \"setAccountInfo\", M: [\"idToken\"], B: function B(a) {Wi(a);if (!a.password) throw new t(\"weak-password\");\n    }, F: P, U: !0 },bj = { endpoint: \"signupNewUser\", F: P, U: !0, C: !0 },kj = { endpoint: \"accounts/mfaEnrollment:start\", M: [\"idToken\", \"phoneEnrollmentInfo\"], B: function B(a) {if (!a.phoneEnrollmentInfo) throw new t(\"internal-error\");if (!a.phoneEnrollmentInfo.phoneNumber) throw new t(\"missing-phone-number\");if (!a.phoneEnrollmentInfo.recaptchaToken) throw new t(\"missing-app-credential\");}, F: function F(a) {if (!a.phoneSessionInfo || !a.phoneSessionInfo.sessionInfo) throw new t(\"internal-error\");}, C: !0, Na: !0 },mj = { endpoint: \"accounts/mfaSignIn:start\",\n    M: [\"mfaPendingCredential\", \"mfaEnrollmentId\", \"phoneSignInInfo\"], B: function B(a) {if (!a.phoneSignInInfo || !a.phoneSignInInfo.recaptchaToken) throw new t(\"missing-app-credential\");}, F: function F(a) {if (!a.phoneResponseInfo || !a.phoneResponseInfo.sessionInfo) throw new t(\"internal-error\");}, C: !0, Na: !0 },tj = { endpoint: \"verifyAssertion\", B: pj, Xa: qj, F: rj, U: !0, C: !0 },vj = { endpoint: \"verifyAssertion\", B: pj, Xa: qj, F: function F(a) {if (a.errorMessage && \"USER_NOT_FOUND\" == a.errorMessage) throw new t(\"user-not-found\");if (a.errorMessage) throw sj(a.errorMessage);\n      P(a);}, U: !0, C: !0 },uj = { endpoint: \"verifyAssertion\", B: function B(a) {pj(a);if (!a.idToken) throw new t(\"internal-error\");}, Xa: qj, F: rj, U: !0 },Gj = { endpoint: \"verifyCustomToken\", B: function B(a) {if (!a.token) throw new t(\"invalid-custom-token\");}, F: P, U: !0, C: !0 },Xg = { endpoint: \"verifyPassword\", B: function B(a) {Vi(a);if (!a.password) throw new t(\"wrong-password\");}, F: P, U: !0, C: !0 },jj = { endpoint: \"verifyPhoneNumber\", B: aj, F: P, C: !0 },eh = { endpoint: \"verifyPhoneNumber\", B: function B(a) {if (!a.idToken) throw new t(\"internal-error\");aj(a);},\n    F: function F(a) {if (a.temporaryProof) throw a.code = \"credential-already-in-use\", vh(a);P(a);} },fh = { Gb: { USER_NOT_FOUND: \"user-not-found\" }, endpoint: \"verifyPhoneNumber\", B: aj, F: P, C: !0 },Hj = { endpoint: \"accounts/mfaEnrollment:withdraw\", M: [\"idToken\", \"mfaEnrollmentId\"], F: function F(a) {if (!!a[zg] ^ !!a.refreshToken) throw new t(\"internal-error\");}, C: !0, Na: !0 };\n  function O(a, b, c) {if (!hf(c, b.M)) return E(new t(\"internal-error\"));var d = !!b.Na,e = b.Tb || \"POST\",f;return D(c).then(b.B).then(function () {b.U && (c.returnSecureToken = !0);b.C && a.b && \"undefined\" === typeof c.tenantId && (c.tenantId = a.b);return d ? Ui(a, a.i, b.endpoint, e, c, b.Gb, b.kb || !1) : Ui(a, a.h, b.endpoint, e, c, b.Gb, b.kb || !1);}).then(function (g) {f = g;return b.Xa ? b.Xa(c, f) : f;}).then(b.F).then(function () {if (!b.Z) return f;if (!(b.Z in f)) throw new t(\"internal-error\");return f[b.Z];});}\n  function sj(a) {return Ti({ error: { errors: [{ message: a }], code: 400, message: a } });}\n  function Ti(a, b) {var c = (a.error && a.error.errors && a.error.errors[0] || {}).reason || \"\";var d = { keyInvalid: \"invalid-api-key\", ipRefererBlocked: \"app-not-authorized\" };if (c = d[c] ? new t(d[c]) : null) return c;c = a.error && a.error.message || \"\";d = { INVALID_CUSTOM_TOKEN: \"invalid-custom-token\", CREDENTIAL_MISMATCH: \"custom-token-mismatch\", MISSING_CUSTOM_TOKEN: \"internal-error\", INVALID_IDENTIFIER: \"invalid-email\", MISSING_CONTINUE_URI: \"internal-error\", INVALID_EMAIL: \"invalid-email\", INVALID_PASSWORD: \"wrong-password\", USER_DISABLED: \"user-disabled\",\n      MISSING_PASSWORD: \"internal-error\", EMAIL_EXISTS: \"email-already-in-use\", PASSWORD_LOGIN_DISABLED: \"operation-not-allowed\", INVALID_IDP_RESPONSE: \"invalid-credential\", INVALID_PENDING_TOKEN: \"invalid-credential\", FEDERATED_USER_ID_ALREADY_LINKED: \"credential-already-in-use\", MISSING_OR_INVALID_NONCE: \"missing-or-invalid-nonce\", INVALID_MESSAGE_PAYLOAD: \"invalid-message-payload\", INVALID_RECIPIENT_EMAIL: \"invalid-recipient-email\", INVALID_SENDER: \"invalid-sender\", EMAIL_NOT_FOUND: \"user-not-found\", RESET_PASSWORD_EXCEED_LIMIT: \"too-many-requests\",\n      EXPIRED_OOB_CODE: \"expired-action-code\", INVALID_OOB_CODE: \"invalid-action-code\", MISSING_OOB_CODE: \"internal-error\", INVALID_PROVIDER_ID: \"invalid-provider-id\", CREDENTIAL_TOO_OLD_LOGIN_AGAIN: \"requires-recent-login\", INVALID_ID_TOKEN: \"invalid-user-token\", TOKEN_EXPIRED: \"user-token-expired\", USER_NOT_FOUND: \"user-token-expired\", CORS_UNSUPPORTED: \"cors-unsupported\", DYNAMIC_LINK_NOT_ACTIVATED: \"dynamic-link-not-activated\", INVALID_APP_ID: \"invalid-app-id\", TOO_MANY_ATTEMPTS_TRY_LATER: \"too-many-requests\", WEAK_PASSWORD: \"weak-password\",\n      OPERATION_NOT_ALLOWED: \"operation-not-allowed\", USER_CANCELLED: \"user-cancelled\", CAPTCHA_CHECK_FAILED: \"captcha-check-failed\", INVALID_APP_CREDENTIAL: \"invalid-app-credential\", INVALID_CODE: \"invalid-verification-code\", INVALID_PHONE_NUMBER: \"invalid-phone-number\", INVALID_SESSION_INFO: \"invalid-verification-id\", INVALID_TEMPORARY_PROOF: \"invalid-credential\", MISSING_APP_CREDENTIAL: \"missing-app-credential\", MISSING_CODE: \"missing-verification-code\", MISSING_PHONE_NUMBER: \"missing-phone-number\", MISSING_SESSION_INFO: \"missing-verification-id\",\n      QUOTA_EXCEEDED: \"quota-exceeded\", SESSION_EXPIRED: \"code-expired\", REJECTED_CREDENTIAL: \"rejected-credential\", INVALID_CONTINUE_URI: \"invalid-continue-uri\", MISSING_ANDROID_PACKAGE_NAME: \"missing-android-pkg-name\", MISSING_IOS_BUNDLE_ID: \"missing-ios-bundle-id\", UNAUTHORIZED_DOMAIN: \"unauthorized-continue-uri\", INVALID_DYNAMIC_LINK_DOMAIN: \"invalid-dynamic-link-domain\", INVALID_OAUTH_CLIENT_ID: \"invalid-oauth-client-id\", INVALID_CERT_HASH: \"invalid-cert-hash\", UNSUPPORTED_TENANT_OPERATION: \"unsupported-tenant-operation\",\n      INVALID_TENANT_ID: \"invalid-tenant-id\", TENANT_ID_MISMATCH: \"tenant-id-mismatch\", ADMIN_ONLY_OPERATION: \"admin-restricted-operation\", INVALID_MFA_PENDING_CREDENTIAL: \"invalid-multi-factor-session\", MFA_ENROLLMENT_NOT_FOUND: \"multi-factor-info-not-found\", MISSING_MFA_PENDING_CREDENTIAL: \"missing-multi-factor-session\", MISSING_MFA_ENROLLMENT_ID: \"missing-multi-factor-info\", EMAIL_CHANGE_NEEDS_VERIFICATION: \"email-change-needs-verification\", SECOND_FACTOR_EXISTS: \"second-factor-already-in-use\", SECOND_FACTOR_LIMIT_EXCEEDED: \"maximum-second-factor-count-exceeded\",\n      UNSUPPORTED_FIRST_FACTOR: \"unsupported-first-factor\", UNVERIFIED_EMAIL: \"unverified-email\" };z(d, b || {});b = (b = c.match(/^[^\\s]+\\s*:\\s*([\\s\\S]*)$/)) && 1 < b.length ? b[1] : void 0;for (var e in d) {if (0 === c.indexOf(e)) return new t(d[e], b);}!b && a && (b = Pe(a));return new t(\"internal-error\", b);};function Ij(a) {this.b = a;this.a = null;this.qb = Jj(this);}\n  function Jj(a) {return Kj().then(function () {return new C(function (b, c) {L(\"gapi.iframes.getContext\")().open({ where: document.body, url: a.b, messageHandlersFilter: L(\"gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER\"), attributes: { style: { position: \"absolute\", top: \"-100px\", width: \"1px\", height: \"1px\" } }, dontclear: !0 }, function (d) {function e() {clearTimeout(f);b();}a.a = d;a.a.restyle({ setHideOnLeave: !1 });var f = setTimeout(function () {c(Error(\"Network Error\"));}, Lj.get());d.ping(e).then(e, function () {c(Error(\"Network Error\"));});});});});}\n  function Mj(a, b) {return a.qb.then(function () {return new C(function (c) {a.a.send(b.type, b, c, L(\"gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER\"));});});}function Nj(a, b) {a.qb.then(function () {a.a.register(\"authEvent\", b, L(\"gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER\"));});}var Oj = new ob(pb, \"https://apis.google.com/js/api.js?onload=%{onload}\"),Pj = new Ue(3E4, 6E4),Lj = new Ue(5E3, 15E3),Qj = null;\n  function Kj() {return Qj ? Qj : Qj = new C(function (a, b) {function c() {Te();L(\"gapi.load\")(\"gapi.iframes\", { callback: a, ontimeout: function ontimeout() {Te();b(Error(\"Network Error\"));}, timeout: Pj.get() });}if (L(\"gapi.iframes.Iframe\")) a();else if (L(\"gapi.load\")) c();else {var d = \"__iframefcb\" + Math.floor(1E6 * Math.random()).toString();l[d] = function () {L(\"gapi.load\") ? c() : b(Error(\"Network Error\"));};d = xb(Oj, { onload: d });D(xi(d)).s(function () {b(Error(\"Network Error\"));});}}).s(function (a) {Qj = null;throw a;});};function Rj(a, b, c, d) {this.l = a;this.h = b;this.i = c;this.g = d;this.f = null;this.g ? (a = J(this.g.url), a = Yd(a.f, a.a, a.g, \"/emulator/auth/iframe\")) : a = Yd(\"https\", this.l, null, \"/__/auth/iframe\");this.a = a;I(this.a, \"apiKey\", this.h);I(this.a, \"appName\", this.i);this.b = null;this.c = [];}Rj.prototype.toString = function () {this.f ? I(this.a, \"v\", this.f) : de(this.a.b, \"v\");this.b ? I(this.a, \"eid\", this.b) : de(this.a.b, \"eid\");this.c.length ? I(this.a, \"fw\", this.c.join(\",\")) : de(this.a.b, \"fw\");return this.a.toString();};\n  function Sj(a, b, c, d, e, f) {this.u = a;this.o = b;this.c = c;this.v = d;this.m = f;this.i = this.g = this.l = null;this.a = e;this.h = this.f = null;}Sj.prototype.xb = function (a) {this.h = a;return this;};\n  Sj.prototype.toString = function () {if (this.m) {var a = J(this.m.url);a = Yd(a.f, a.a, a.g, \"/emulator/auth/handler\");} else a = Yd(\"https\", this.u, null, \"/__/auth/handler\");I(a, \"apiKey\", this.o);I(a, \"appName\", this.c);I(a, \"authType\", this.v);if (this.a.isOAuthProvider) {var b = this.a;try {var c = firebase.app(this.c).auth().ka();} catch (h) {c = null;}b.nb = c;I(a, \"providerId\", this.a.providerId);c = this.a;b = Qe(c.Hb);for (var d in b) {b[d] = b[d].toString();}d = c.Pc;b = lb(b);for (var e = 0; e < d.length; e++) {var f = d[e];f in b && delete b[f];}c.ob &&\n      c.nb && !b[c.ob] && (b[c.ob] = c.nb);kb(b) || I(a, \"customParameters\", Pe(b));}\"function\" === typeof this.a.Pb && (c = this.a.Pb(), c.length && I(a, \"scopes\", c.join(\",\")));this.l ? I(a, \"redirectUrl\", this.l) : de(a.b, \"redirectUrl\");this.g ? I(a, \"eventId\", this.g) : de(a.b, \"eventId\");this.i ? I(a, \"v\", this.i) : de(a.b, \"v\");if (this.b) for (var g in this.b) {this.b.hasOwnProperty(g) && !Xd(a, g) && I(a, g, this.b[g]);}this.h ? I(a, \"tid\", this.h) : de(a.b, \"tid\");this.f ? I(a, \"eid\", this.f) : de(a.b, \"eid\");g = Tj(this.c);g.length && I(a, \"fw\", g.join(\",\"));return a.toString();};\n  function Tj(a) {try {return firebase.app(a).auth().Ga();} catch (b) {return [];}}function Uj(a, b, c, d, e, f) {this.o = a;this.g = b;this.b = c;this.f = f;this.c = d || null;this.i = e || null;this.l = this.u = this.A = null;this.h = [];this.v = this.a = null;}\n  function Vj(a) {var b = me();return Zi(a).then(function (c) {a: {var d = J(b),e = d.f;d = d.a;for (var f = 0; f < c.length; f++) {var g = c[f];var h = d;var m = e;0 == g.indexOf(\"chrome-extension://\") ? h = J(g).a == h && \"chrome-extension\" == m : \"http\" != m && \"https\" != m ? h = !1 : xe.test(g) ? h = h == g : (g = g.split(\".\").join(\"\\\\.\"), h = new RegExp(\"^(.+\\\\.\" + g + \"|\" + g + \")$\", \"i\").test(h));if (h) {c = !0;break a;}}c = !1;}if (!c) throw new th(me());});}\n  function Wj(a) {if (a.v) return a.v;a.v = ze().then(function () {if (!a.u) {var b = a.c,c = a.i,d = Tj(a.b),e = new Rj(a.o, a.g, a.b, a.f);e.f = b;e.b = c;e.c = Xa(d || []);a.u = e.toString();}a.m = new Ij(a.u);Xj(a);});return a.v;}k = Uj.prototype;k.Nb = function (a, b, c) {var d = new t(\"popup-closed-by-user\"),e = new t(\"web-storage-unsupported\"),f = this,g = !1;return this.la().then(function () {Yj(f).then(function (h) {h || (a && te(a), b(e), g = !0);});}).s(function () {}).then(function () {if (!g) return we(a);}).then(function () {if (!g) return Ad(c).then(function () {b(d);});});};\n  k.Wb = function () {var a = K();return !Oe(a) && !Se(a);};k.Sb = function () {return !1;};\n  k.Lb = function (a, b, c, d, e, f, g, h) {if (!a) return E(new t(\"popup-blocked\"));if (g && !Oe()) return this.la().s(function (p) {te(a);e(p);}), d(), D();this.a || (this.a = Vj(Zj(this)));var m = this;return this.a.then(function () {var p = m.la().s(function (v) {te(a);e(v);throw v;});d();return p;}).then(function () {nh(c);if (!g) {var p = ak(m.o, m.g, m.b, b, c, null, f, m.c, void 0, m.i, h, m.f);ne(p, a);}}).s(function (p) {\"auth/network-request-failed\" == p.code && (m.a = null);throw p;});};\n  function Zj(a) {a.l || (a.A = a.c ? Je(a.c, Tj(a.b)) : null, a.l = new Ei(a.g, Aa(a.i), a.A), a.f && Li(a.l, a.f));return a.l;}k.Mb = function (a, b, c, d) {this.a || (this.a = Vj(Zj(this)));var e = this;return this.a.then(function () {nh(b);var f = ak(e.o, e.g, e.b, a, b, me(), c, e.c, void 0, e.i, d, e.f);ne(f);}).s(function (f) {\"auth/network-request-failed\" == f.code && (e.a = null);throw f;});};k.la = function () {var a = this;return Wj(this).then(function () {return a.m.qb;}).s(function () {a.a = null;throw new t(\"network-request-failed\");});};k.Zb = function () {return !0;};\n  function ak(a, b, c, d, e, f, g, h, m, p, v, B) {a = new Sj(a, b, c, d, e, B);a.l = f;a.g = g;a.i = h;a.b = lb(m || null);a.f = p;return a.xb(v).toString();}function Xj(a) {if (!a.m) throw Error(\"IfcHandler must be initialized!\");Nj(a.m, function (b) {var c = {};if (b && b.authEvent) {var d = !1;b = ph(b.authEvent);for (c = 0; c < a.h.length; c++) {d = a.h[c](b) || d;}c = {};c.status = d ? \"ACK\" : \"ERROR\";return D(c);}c.status = \"ERROR\";return D(c);});}\n  function Yj(a) {var b = { type: \"webStorageSupport\" };return Wj(a).then(function () {return Mj(a.m, b);}).then(function (c) {if (c && c.length && \"undefined\" !== typeof c[0].webStorageSupport) return c[0].webStorageSupport;throw Error();});}k.Ea = function (a) {this.h.push(a);};k.Ra = function (a) {Va(this.h, function (b) {return b == a;});};function bk(a) {this.a = a || firebase.INTERNAL.reactNative && firebase.INTERNAL.reactNative.AsyncStorage;if (!this.a) throw new t(\"internal-error\", \"The React Native compatibility library was not found.\");this.type = \"asyncStorage\";}k = bk.prototype;k.get = function (a) {return D(this.a.getItem(a)).then(function (b) {return b && Re(b);});};k.set = function (a, b) {return D(this.a.setItem(a, Pe(b)));};k.T = function (a) {return D(this.a.removeItem(a));};k.ca = function () {};k.ia = function () {};function ck(a) {this.b = a;this.a = {};this.f = q(this.c, this);}var dk = [];function ek() {var a = Ee() ? self : null;w(dk, function (c) {c.b == a && (b = c);});if (!b) {var b = new ck(a);dk.push(b);}return b;}\n  ck.prototype.c = function (a) {var b = a.data.eventType,c = a.data.eventId,d = this.a[b];if (d && 0 < d.length) {a.ports[0].postMessage({ status: \"ack\", eventId: c, eventType: b, response: null });var e = [];w(d, function (f) {e.push(D().then(function () {return f(a.origin, a.data.data);}));});Fc(e).then(function (f) {var g = [];w(f, function (h) {g.push({ fulfilled: h.Ob, value: h.value, reason: h.reason ? h.reason.message : void 0 });});w(g, function (h) {for (var m in h) {\"undefined\" === typeof h[m] && delete h[m];}});a.ports[0].postMessage({ status: \"done\", eventId: c,\n          eventType: b, response: g });});}};function fk(a, b, c) {kb(a.a) && a.b.addEventListener(\"message\", a.f);\"undefined\" === typeof a.a[b] && (a.a[b] = []);a.a[b].push(c);};function gk(a) {this.a = a;}gk.prototype.postMessage = function (a, b) {this.a.postMessage(a, b);};function hk(a) {this.c = a;this.b = !1;this.a = [];}\n  function ik(a, b, c, d) {var e,f = c || {},g,h,m,p = null;if (a.b) return E(Error(\"connection_unavailable\"));var v = d ? 800 : 50,B = \"undefined\" !== typeof MessageChannel ? new MessageChannel() : null;return new C(function (A, Q) {B ? (e = Math.floor(Math.random() * Math.pow(10, 20)).toString(), B.port1.start(), h = setTimeout(function () {Q(Error(\"unsupported_event\"));}, v), g = function g(xa) {xa.data.eventId === e && (\"ack\" === xa.data.status ? (clearTimeout(h), m = setTimeout(function () {Q(Error(\"timeout\"));}, 3E3)) : \"done\" === xa.data.status ? (clearTimeout(m),\n        \"undefined\" !== typeof xa.data.response ? A(xa.data.response) : Q(Error(\"unknown_error\"))) : (clearTimeout(h), clearTimeout(m), Q(Error(\"invalid_response\"))));}, p = { messageChannel: B, onMessage: g }, a.a.push(p), B.port1.addEventListener(\"message\", g), a.c.postMessage({ eventType: b, eventId: e, data: f }, [B.port2])) : Q(Error(\"connection_unavailable\"));}).then(function (A) {jk(a, p);return A;}).s(function (A) {jk(a, p);throw A;});}\n  function jk(a, b) {if (b) {var c = b.messageChannel,d = b.onMessage;c && (c.port1.removeEventListener(\"message\", d), c.port1.close());Va(a.a, function (e) {return e == b;});}}hk.prototype.close = function () {for (; 0 < this.a.length;) {jk(this, this.a[0]);}this.b = !0;};function kk() {if (!lk()) throw new t(\"web-storage-unsupported\");this.c = {};this.a = [];this.b = 0;this.m = l.indexedDB;this.type = \"indexedDB\";this.g = this.l = this.f = this.i = null;this.o = !1;this.h = null;var a = this;Ee() && self ? (this.l = ek(), fk(this.l, \"keyChanged\", function (b, c) {return mk(a).then(function (d) {0 < d.length && w(a.a, function (e) {e(d);});return { keyProcessed: Ta(d, c.key) };});}), fk(this.l, \"ping\", function () {return D([\"keyChanged\"]);})) : af().then(function (b) {if (a.h = b) a.g = new hk(new gk(b)), ik(a.g, \"ping\", null, !0).then(function (c) {c[0].fulfilled &&\n        Ta(c[0].value, \"keyChanged\") && (a.o = !0);}).s(function () {});});}var nk;function ok(a) {return new C(function (b, c) {var d = a.m.deleteDatabase(\"firebaseLocalStorageDb\");d.onsuccess = function () {b();};d.onerror = function (e) {c(Error(e.target.error));};});}\n  function pk(a) {return new C(function (b, c) {var d = a.m.open(\"firebaseLocalStorageDb\", 1);d.onerror = function (e) {try {e.preventDefault();} catch (f) {}c(Error(e.target.error));};d.onupgradeneeded = function (e) {e = e.target.result;try {e.createObjectStore(\"firebaseLocalStorage\", { keyPath: \"fbase_key\" });} catch (f) {c(f);}};d.onsuccess = function (e) {e = e.target.result;e.objectStoreNames.contains(\"firebaseLocalStorage\") ? b(e) : ok(a).then(function () {return pk(a);}).then(function (f) {b(f);}).s(function (f) {c(f);});};});}\n  function qk(a) {a.v || (a.v = pk(a));return a.v;}function lk() {try {return !!l.indexedDB;} catch (a) {return !1;}}function rk(a) {return a.objectStore(\"firebaseLocalStorage\");}function sk(a, b) {return a.transaction([\"firebaseLocalStorage\"], b ? \"readwrite\" : \"readonly\");}function tk(a) {return new C(function (b, c) {a.onsuccess = function (d) {d && d.target ? b(d.target.result) : b();};a.onerror = function (d) {c(d.target.error);};});}k = kk.prototype;\n  k.set = function (a, b) {var c = !1,d,e = this;return qk(this).then(function (f) {d = f;f = rk(sk(d, !0));return tk(f.get(a));}).then(function (f) {var g = rk(sk(d, !0));if (f) return f.value = b, tk(g.put(f));e.b++;c = !0;f = {};f.fbase_key = a;f.value = b;return tk(g.add(f));}).then(function () {e.c[a] = b;return uk(e, a);}).na(function () {c && e.b--;});};function uk(a, b) {return a.g && a.h && $e() === a.h ? ik(a.g, \"keyChanged\", { key: b }, a.o).then(function () {}).s(function () {}) : D();}\n  k.get = function (a) {return qk(this).then(function (b) {return tk(rk(sk(b, !1)).get(a));}).then(function (b) {return b && b.value;});};k.T = function (a) {var b = !1,c = this;return qk(this).then(function (d) {b = !0;c.b++;return tk(rk(sk(d, !0))[\"delete\"](a));}).then(function () {delete c.c[a];return uk(c, a);}).na(function () {b && c.b--;});};\n  function mk(a) {return qk(a).then(function (b) {var c = rk(sk(b, !1));return c.getAll ? tk(c.getAll()) : new C(function (d, e) {var f = [],g = c.openCursor();g.onsuccess = function (h) {(h = h.target.result) ? (f.push(h.value), h[\"continue\"]()) : d(f);};g.onerror = function (h) {e(h.target.error);};});}).then(function (b) {var c = {},d = [];if (0 == a.b) {for (d = 0; d < b.length; d++) {c[b[d].fbase_key] = b[d].value;}d = oe(a.c, c);a.c = c;}return d;});}k.ca = function (a) {0 == this.a.length && vk(this);this.a.push(a);};\n  k.ia = function (a) {Va(this.a, function (b) {return b == a;});0 == this.a.length && wk(this);};function vk(a) {function b() {a.f = setTimeout(function () {a.i = mk(a).then(function (c) {0 < c.length && w(a.a, function (d) {d(c);});}).then(function () {b();}).s(function (c) {\"STOP_EVENT\" != c.message && b();});}, 800);}wk(a);b();}function wk(a) {a.i && a.i.cancel(\"STOP_EVENT\");a.f && (clearTimeout(a.f), a.f = null);};function xk(a) {var b = this,c = null;this.a = [];this.type = \"indexedDB\";this.c = a;this.b = D().then(function () {if (lk()) {var d = Le(),e = \"__sak\" + d;nk || (nk = new kk());c = nk;return c.set(e, d).then(function () {return c.get(e);}).then(function (f) {if (f !== d) throw Error(\"indexedDB not supported!\");return c.T(e);}).then(function () {return c;}).s(function () {return b.c;});}return b.c;}).then(function (d) {b.type = d.type;d.ca(function (e) {w(b.a, function (f) {f(e);});});return d;});}k = xk.prototype;k.get = function (a) {return this.b.then(function (b) {return b.get(a);});};\n  k.set = function (a, b) {return this.b.then(function (c) {return c.set(a, b);});};k.T = function (a) {return this.b.then(function (b) {return b.T(a);});};k.ca = function (a) {this.a.push(a);};k.ia = function (a) {Va(this.a, function (b) {return b == a;});};function yk() {this.a = {};this.type = \"inMemory\";}k = yk.prototype;k.get = function (a) {return D(this.a[a]);};k.set = function (a, b) {this.a[a] = b;return D();};k.T = function (a) {delete this.a[a];return D();};k.ca = function () {};k.ia = function () {};function zk() {if (!Ak()) {if (\"Node\" == Fe()) throw new t(\"internal-error\", \"The LocalStorage compatibility library was not found.\");throw new t(\"web-storage-unsupported\");}this.a = Bk() || firebase.INTERNAL.node.localStorage;this.type = \"localStorage\";}function Bk() {try {var a = l.localStorage,b = Le();a && (a.setItem(b, \"1\"), a.removeItem(b));return a;} catch (c) {return null;}}\n  function Ak() {var a = \"Node\" == Fe();a = Bk() || a && firebase.INTERNAL.node && firebase.INTERNAL.node.localStorage;if (!a) return !1;try {return a.setItem(\"__sak\", \"1\"), a.removeItem(\"__sak\"), !0;} catch (b) {return !1;}}k = zk.prototype;k.get = function (a) {var b = this;return D().then(function () {var c = b.a.getItem(a);return Re(c);});};k.set = function (a, b) {var c = this;return D().then(function () {var d = Pe(b);null === d ? c.T(a) : c.a.setItem(a, d);});};k.T = function (a) {var b = this;return D().then(function () {b.a.removeItem(a);});};\n  k.ca = function (a) {l.window && jd(l.window, \"storage\", a);};k.ia = function (a) {l.window && G(l.window, \"storage\", a);};function Ck() {this.type = \"nullStorage\";}k = Ck.prototype;k.get = function () {return D(null);};k.set = function () {return D();};k.T = function () {return D();};k.ca = function () {};k.ia = function () {};function Dk() {if (!Ek()) {if (\"Node\" == Fe()) throw new t(\"internal-error\", \"The SessionStorage compatibility library was not found.\");throw new t(\"web-storage-unsupported\");}this.a = Fk() || firebase.INTERNAL.node.sessionStorage;this.type = \"sessionStorage\";}function Fk() {try {var a = l.sessionStorage,b = Le();a && (a.setItem(b, \"1\"), a.removeItem(b));return a;} catch (c) {return null;}}\n  function Ek() {var a = \"Node\" == Fe();a = Fk() || a && firebase.INTERNAL.node && firebase.INTERNAL.node.sessionStorage;if (!a) return !1;try {return a.setItem(\"__sak\", \"1\"), a.removeItem(\"__sak\"), !0;} catch (b) {return !1;}}k = Dk.prototype;k.get = function (a) {var b = this;return D().then(function () {var c = b.a.getItem(a);return Re(c);});};k.set = function (a, b) {var c = this;return D().then(function () {var d = Pe(b);null === d ? c.T(a) : c.a.setItem(a, d);});};k.T = function (a) {var b = this;return D().then(function () {b.a.removeItem(a);});};k.ca = function () {};\n  k.ia = function () {};function Gk() {var a = {};a.Browser = Hk;a.Node = Ik;a.ReactNative = Jk;a.Worker = Kk;this.a = a[Fe()];}var Lk,Hk = { D: zk, ab: Dk },Ik = { D: zk, ab: Dk },Jk = { D: bk, ab: Ck },Kk = { D: zk, ab: Ck }; /*\n                                                                                                                                                                                                                                    Copyright 2017 Google LLC\n                                                                                                                                                                                                                                    Licensed under the Apache License, Version 2.0 (the \"License\");\n                                                                                                                                                                                                                                    you may not use this file except in compliance with the License.\n                                                                                                                                                                                                                                    You may obtain a copy of the License at\n                                                                                                                                                                                                                                    http://www.apache.org/licenses/LICENSE-2.0\n                                                                                                                                                                                                                                    Unless required by applicable law or agreed to in writing, software\n                                                                                                                                                                                                                                    distributed under the License is distributed on an \"AS IS\" BASIS,\n                                                                                                                                                                                                                                    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n                                                                                                                                                                                                                                    See the License for the specific language governing permissions and\n                                                                                                                                                                                                                                    limitations under the License.\n                                                                                                                                                                                                                                    */\n\n\n\n\n  var Mk = { qd: \"local\", NONE: \"none\", sd: \"session\" };function Nk(a) {var b = new t(\"invalid-persistence-type\"),c = new t(\"unsupported-persistence-type\");a: {for (d in Mk) {if (Mk[d] == a) {var d = !0;break a;}}d = !1;}if (!d || \"string\" !== typeof a) throw b;switch (Fe()) {case \"ReactNative\":if (\"session\" === a) throw c;break;case \"Node\":if (\"none\" !== a) throw c;break;case \"Worker\":if (\"session\" === a || !lk() && \"none\" !== a) throw c;break;default:if (!Ke() && \"none\" !== a) throw c;}}\n  function Ok() {var a = !Se(K()) && De() ? !0 : !1,b = Oe(),c = Ke();this.v = a;this.h = b;this.l = c;this.a = {};Lk || (Lk = new Gk());a = Lk;try {this.g = !le() && Ze() || !l.indexedDB ? new a.a.D() : new xk(Ee() ? new yk() : new a.a.D());} catch (d) {this.g = new yk(), this.h = !0;}try {this.i = new a.a.ab();} catch (d) {this.i = new yk();}this.m = new yk();this.f = q(this.Xb, this);this.b = {};}var Pk;function Qk() {Pk || (Pk = new Ok());return Pk;}function Rk(a, b) {switch (b) {case \"session\":return a.i;case \"none\":return a.m;default:return a.g;}}\n  function Sk(a, b) {return \"firebase:\" + a.name + (b ? \":\" + b : \"\");}function Tk(a, b, c) {var d = Sk(b, c),e = Rk(a, b.D);return a.get(b, c).then(function (f) {var g = null;try {g = Re(l.localStorage.getItem(d));} catch (h) {}if (g && !f) return l.localStorage.removeItem(d), a.set(b, g, c);g && f && \"localStorage\" != e.type && l.localStorage.removeItem(d);});}k = Ok.prototype;k.get = function (a, b) {return Rk(this, a.D).get(Sk(a, b));};function Uk(a, b, c) {c = Sk(b, c);\"local\" == b.D && (a.b[c] = null);return Rk(a, b.D).T(c);}\n  k.set = function (a, b, c) {var d = Sk(a, c),e = this,f = Rk(this, a.D);return f.set(d, b).then(function () {return f.get(d);}).then(function (g) {\"local\" == a.D && (e.b[d] = g);});};k.addListener = function (a, b, c) {a = Sk(a, b);this.l && (this.b[a] = l.localStorage.getItem(a));kb(this.a) && (Rk(this, \"local\").ca(this.f), this.h || (le() || !Ze()) && l.indexedDB || !this.l || Vk(this));this.a[a] || (this.a[a] = []);this.a[a].push(c);};\n  k.removeListener = function (a, b, c) {a = Sk(a, b);this.a[a] && (Va(this.a[a], function (d) {return d == c;}), 0 == this.a[a].length && delete this.a[a]);kb(this.a) && (Rk(this, \"local\").ia(this.f), Wk(this));};function Vk(a) {Wk(a);a.c = setInterval(function () {for (var b in a.a) {var c = l.localStorage.getItem(b),d = a.b[b];c != d && (a.b[b] = c, c = new Yc({ type: \"storage\", key: b, target: window, oldValue: d, newValue: c, a: !0 }), a.Xb(c));}}, 1E3);}function Wk(a) {a.c && (clearInterval(a.c), a.c = null);}\n  k.Xb = function (a) {if (a && a.g) {var b = a.a.key;if (null == b) for (var c in this.a) {var d = this.b[c];\"undefined\" === typeof d && (d = null);var e = l.localStorage.getItem(c);e !== d && (this.b[c] = e, this.lb(c));} else if (0 == b.indexOf(\"firebase:\") && this.a[b]) {\"undefined\" !== typeof a.a.a ? Rk(this, \"local\").ia(this.f) : Wk(this);if (this.v) if (c = l.localStorage.getItem(b), d = a.a.newValue, d !== c) null !== d ? l.localStorage.setItem(b, d) : l.localStorage.removeItem(b);else if (this.b[b] === d && \"undefined\" === typeof a.a.a) return;var f = this;c = function c() {if (\"undefined\" !==\n          typeof a.a.a || f.b[b] !== l.localStorage.getItem(b)) f.b[b] = l.localStorage.getItem(b), f.lb(b);};Tb && dc && 10 == dc && l.localStorage.getItem(b) !== a.a.newValue && a.a.newValue !== a.a.oldValue ? setTimeout(c, 10) : c();}} else w(a, q(this.lb, this));};k.lb = function (a) {this.a[a] && w(this.a[a], function (b) {b();});};function Xk(a) {this.a = a;this.b = Qk();}var Yk = { name: \"authEvent\", D: \"local\" };function Zk(a) {return a.b.get(Yk, a.a).then(function (b) {return ph(b);});};function $k() {this.a = Qk();};function al() {this.b = -1;};function bl(a, b) {this.b = cl;this.f = l.Uint8Array ? new Uint8Array(this.b) : Array(this.b);this.g = this.c = 0;this.a = [];this.i = a;this.h = b;this.l = l.Int32Array ? new Int32Array(64) : Array(64);void 0 === dl && (l.Int32Array ? dl = new Int32Array(el) : dl = el);this.reset();}var dl;r(bl, al);for (var cl = 64, fl = cl - 1, gl = [], hl = 0; hl < fl; hl++) {gl[hl] = 0;}var il = Wa(128, gl);bl.prototype.reset = function () {this.g = this.c = 0;this.a = l.Int32Array ? new Int32Array(this.h) : Xa(this.h);};\n  function jl(a) {for (var b = a.f, c = a.l, d = 0, e = 0; e < b.length;) {c[d++] = b[e] << 24 | b[e + 1] << 16 | b[e + 2] << 8 | b[e + 3], e = 4 * d;}for (b = 16; 64 > b; b++) {e = c[b - 15] | 0;d = c[b - 2] | 0;var f = (c[b - 16] | 0) + ((e >>> 7 | e << 25) ^ (e >>> 18 | e << 14) ^ e >>> 3) | 0,g = (c[b - 7] | 0) + ((d >>> 17 | d << 15) ^ (d >>> 19 | d << 13) ^ d >>> 10) | 0;c[b] = f + g | 0;}d = a.a[0] | 0;e = a.a[1] | 0;var h = a.a[2] | 0,m = a.a[3] | 0,p = a.a[4] | 0,v = a.a[5] | 0,B = a.a[6] | 0;f = a.a[7] | 0;for (b = 0; 64 > b; b++) {var A = ((d >>> 2 | d << 30) ^ (d >>> 13 | d << 19) ^ (d >>> 22 | d << 10)) + (d & e ^ d & h ^ e & h) | 0;g = p & v ^ ~p & B;f = f + ((p >>> 6 | p << 26) ^ (p >>> 11 | p << 21) ^ (p >>> 25 | p <<\n      7)) | 0;g = g + (dl[b] | 0) | 0;g = f + (g + (c[b] | 0) | 0) | 0;f = B;B = v;v = p;p = m + g | 0;m = h;h = e;e = d;d = g + A | 0;}a.a[0] = a.a[0] + d | 0;a.a[1] = a.a[1] + e | 0;a.a[2] = a.a[2] + h | 0;a.a[3] = a.a[3] + m | 0;a.a[4] = a.a[4] + p | 0;a.a[5] = a.a[5] + v | 0;a.a[6] = a.a[6] + B | 0;a.a[7] = a.a[7] + f | 0;}\n  function kl(a, b, c) {void 0 === c && (c = b.length);var d = 0,e = a.c;if (\"string\" === typeof b) for (; d < c;) {a.f[e++] = b.charCodeAt(d++), e == a.b && (jl(a), e = 0);} else if (ma(b)) for (; d < c;) {var f = b[d++];if (!(\"number\" == typeof f && 0 <= f && 255 >= f && f == (f | 0))) throw Error(\"message must be a byte array\");a.f[e++] = f;e == a.b && (jl(a), e = 0);} else throw Error(\"message must be string or array\");a.c = e;a.g += c;}\n  var el = [1116352408, 1899447441, 3049323471, 3921009573, 961987163, 1508970993, 2453635748, 2870763221, 3624381080, 310598401, 607225278, 1426881987, 1925078388, 2162078206, 2614888103, 3248222580, 3835390401, 4022224774, 264347078, 604807628, 770255983, 1249150122, 1555081692, 1996064986, 2554220882, 2821834349, 2952996808, 3210313671, 3336571891, 3584528711, 113926993, 338241895, 666307205, 773529912, 1294757372, 1396182291, 1695183700, 1986661051, 2177026350, 2456956037, 2730485921, 2820302411, 3259730800, 3345764771, 3516065817, 3600352804,\n  4094571909, 275423344, 430227734, 506948616, 659060556, 883997877, 958139571, 1322822218, 1537002063, 1747873779, 1955562222, 2024104815, 2227730452, 2361852424, 2428436474, 2756734187, 3204031479, 3329325298];function ll() {bl.call(this, 8, ml);}r(ll, bl);var ml = [1779033703, 3144134277, 1013904242, 2773480762, 1359893119, 2600822924, 528734635, 1541459225];function nl(a, b, c, d, e, f) {this.m = a;this.i = b;this.l = c;this.v = d || null;this.u = e || null;this.o = f;this.h = b + \":\" + c;this.A = new $k();this.g = new Xk(this.h);this.f = null;this.b = [];this.a = this.c = null;}function ol(a) {return new t(\"invalid-cordova-configuration\", a);}k = nl.prototype;\n  k.la = function () {return this.Ia ? this.Ia : this.Ia = Ae().then(function () {if (\"function\" !== typeof L(\"universalLinks.subscribe\", l)) throw ol(\"cordova-universal-links-plugin-fix is not installed\");if (\"undefined\" === typeof L(\"BuildInfo.packageName\", l)) throw ol(\"cordova-plugin-buildinfo is not installed\");if (\"function\" !== typeof L(\"cordova.plugins.browsertab.openUrl\", l)) throw ol(\"cordova-plugin-browsertab is not installed\");if (\"function\" !== typeof L(\"cordova.InAppBrowser.open\", l)) throw ol(\"cordova-plugin-inappbrowser is not installed\");\n    }, function () {throw new t(\"cordova-not-ready\");});};function pl() {for (var a = 20, b = []; 0 < a;) {b.push(\"1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ\".charAt(Math.floor(62 * Math.random()))), a--;}return b.join(\"\");}function ql(a) {var b = new ll();kl(b, a);a = [];var c = 8 * b.g;56 > b.c ? kl(b, il, 56 - b.c) : kl(b, il, b.b - (b.c - 56));for (var d = 63; 56 <= d; d--) {b.f[d] = c & 255, c /= 256;}jl(b);for (d = c = 0; d < b.i; d++) {for (var e = 24; 0 <= e; e -= 8) {a[c++] = b.a[d] >> e & 255;}}return Zf(a);}\n  k.Nb = function (a, b) {b(new t(\"operation-not-supported-in-this-environment\"));return D();};k.Lb = function () {return E(new t(\"operation-not-supported-in-this-environment\"));};k.Zb = function () {return !1;};k.Wb = function () {return !0;};k.Sb = function () {return !0;};\n  k.Mb = function (a, b, c, d) {if (this.c) return E(new t(\"redirect-operation-pending\"));var e = this,f = l.document,g = null,h = null,m = null,p = null;return this.c = D().then(function () {nh(b);return rl(e);}).then(function () {return sl(e, a, b, c, d);}).then(function () {return new C(function (v, B) {h = function h() {var A = L(\"cordova.plugins.browsertab.close\", l);v();\"function\" === typeof A && A();e.a && \"function\" === typeof e.a.close && (e.a.close(), e.a = null);return !1;};e.Ea(h);m = function m() {g || (g = Ad(2E3).then(function () {B(new t(\"redirect-cancelled-by-user\"));}));};\n        p = function p() {Ve() && m();};f.addEventListener(\"resume\", m, !1);K().toLowerCase().match(/android/) || f.addEventListener(\"visibilitychange\", p, !1);}).s(function (v) {return tl(e).then(function () {throw v;});});}).na(function () {m && f.removeEventListener(\"resume\", m, !1);p && f.removeEventListener(\"visibilitychange\", p, !1);g && g.cancel();h && e.Ra(h);e.c = null;});};\n  function sl(a, b, c, d, e) {var f = pl(),g = new oh(b, d, null, f, new t(\"no-auth-event\"), null, e),h = L(\"BuildInfo.packageName\", l);if (\"string\" !== typeof h) throw new t(\"invalid-cordova-configuration\");var m = L(\"BuildInfo.displayName\", l),p = {};if (K().toLowerCase().match(/iphone|ipad|ipod/)) p.ibi = h;else if (K().toLowerCase().match(/android/)) p.apn = h;else return E(new t(\"operation-not-supported-in-this-environment\"));m && (p.appDisplayName = m);f = ql(f);p.sessionId = f;var v = ak(a.m, a.i, a.l, b, c, null, d, a.v, p, a.u, e, a.o);return a.la().then(function () {var B =\n      a.h;return a.A.a.set(Yk, g.w(), B);}).then(function () {var B = L(\"cordova.plugins.browsertab.isAvailable\", l);if (\"function\" !== typeof B) throw new t(\"invalid-cordova-configuration\");var A = null;B(function (Q) {if (Q) {A = L(\"cordova.plugins.browsertab.openUrl\", l);if (\"function\" !== typeof A) throw new t(\"invalid-cordova-configuration\");A(v);} else {A = L(\"cordova.InAppBrowser.open\", l);if (\"function\" !== typeof A) throw new t(\"invalid-cordova-configuration\");Q = K();a.a = A(v, Q.match(/(iPad|iPhone|iPod).*OS 7_\\d/i) || Q.match(/(iPad|iPhone|iPod).*OS 8_\\d/i) ?\n          \"_blank\" : \"_system\", \"location=yes\");}});});}function ul(a, b) {for (var c = 0; c < a.b.length; c++) {try {a.b[c](b);} catch (d) {}}}function rl(a) {a.f || (a.f = a.la().then(function () {return new C(function (b) {function c(d) {b(d);a.Ra(c);return !1;}a.Ea(c);vl(a);});}));return a.f;}function tl(a) {var b = null;return Zk(a.g).then(function (c) {b = c;c = a.g;return Uk(c.b, Yk, c.a);}).then(function () {return b;});}\n  function vl(a) {function b(g) {d = !0;e && e.cancel();tl(a).then(function (h) {var m = c;if (h && g && g.url) {var p = null;m = tg(g.url);-1 != m.indexOf(\"/__/auth/callback\") && (p = J(m), p = Re(Xd(p, \"firebaseError\") || null), p = (p = \"object\" === (typeof p === \"undefined\" ? \"undefined\" : _typeof(p)) ? ya(p) : null) ? new oh(h.c, h.b, null, null, p, null, h.S()) : new oh(h.c, h.b, m, h.f, null, null, h.S()));m = p || c;}ul(a, m);});}var c = new oh(\"unknown\", null, null, null, new t(\"no-auth-event\")),d = !1,e = Ad(500).then(function () {return tl(a).then(function () {d || ul(a, c);});}),f = l.handleOpenURL;l.handleOpenURL = function (g) {0 ==\n      g.toLowerCase().indexOf(L(\"BuildInfo.packageName\", l).toLowerCase() + \"://\") && b({ url: g });if (\"function\" === typeof f) try {f(g);} catch (h) {console.error(h);}};rh || (rh = new qh());sh(b);}k.Ea = function (a) {this.b.push(a);rl(this).s(function (b) {\"auth/invalid-cordova-configuration\" === b.code && (b = new oh(\"unknown\", null, null, null, new t(\"no-auth-event\")), a(b));});};k.Ra = function (a) {Va(this.b, function (b) {return b == a;});};function wl(a) {this.a = a;this.b = Qk();}var xl = { name: \"pendingRedirect\", D: \"session\" };function yl(a) {return a.b.set(xl, \"pending\", a.a);}function zl(a) {return Uk(a.b, xl, a.a);}function Al(a) {return a.b.get(xl, a.a).then(function (b) {return \"pending\" == b;});};function Bl(a, b, c, d) {this.i = {};this.u = 0;this.O = a;this.m = b;this.v = c;this.G = d;this.h = [];this.f = !1;this.l = q(this.o, this);this.b = new Cl();this.A = new Dl();this.g = new wl(El(this.m, this.v));this.c = {};this.c.unknown = this.b;this.c.signInViaRedirect = this.b;this.c.linkViaRedirect = this.b;this.c.reauthViaRedirect = this.b;this.c.signInViaPopup = this.A;this.c.linkViaPopup = this.A;this.c.reauthViaPopup = this.A;this.a = Fl(this.O, this.m, this.v, Ba, this.G);}\n  function Fl(a, b, c, d, e) {var f = firebase.SDK_VERSION || null;return Be() ? new nl(a, b, c, f, d, e) : new Uj(a, b, c, f, d, e);}Bl.prototype.reset = function () {this.f = !1;this.a.Ra(this.l);this.a = Fl(this.O, this.m, this.v, null, this.G);this.i = {};};function Gl(a) {a.f || (a.f = !0, a.a.Ea(a.l));var b = a.a;return a.a.la().s(function (c) {a.a == b && a.reset();throw c;});}\n  function Hl(a) {a.a.Wb() && Gl(a).s(function (b) {var c = new oh(\"unknown\", null, null, null, new t(\"operation-not-supported-in-this-environment\"));Il(b) && a.o(c);});a.a.Sb() || Jl(a.b);}function Kl(a, b) {Ta(a.h, b) || a.h.push(b);a.f || Al(a.g).then(function (c) {c ? zl(a.g).then(function () {Gl(a).s(function (d) {var e = new oh(\"unknown\", null, null, null, new t(\"operation-not-supported-in-this-environment\"));Il(d) && a.o(e);});}) : Hl(a);}).s(function () {Hl(a);});}function Ll(a, b) {Va(a.h, function (c) {return c == b;});}\n  Bl.prototype.o = function (a) {if (!a) throw new t(\"invalid-auth-event\");6E5 <= ua() - this.u && (this.i = {}, this.u = 0);if (a && a.getUid() && this.i.hasOwnProperty(a.getUid())) return !1;for (var b = !1, c = 0; c < this.h.length; c++) {var d = this.h[c];if (d.Eb(a.c, a.b)) {if (b = this.c[a.c]) b.h(a, d), a && (a.f || a.b) && (this.i[a.getUid()] = !0, this.u = ua());b = !0;break;}}Jl(this.b);return b;};var Ml = new Ue(2E3, 1E4),Nl = new Ue(3E4, 6E4);Bl.prototype.qa = function () {return this.b.qa();};\n  function Ol(a, b, c, d, e, f, g) {return a.a.Lb(b, c, d, function () {a.f || (a.f = !0, a.a.Ea(a.l));}, function () {a.reset();}, e, f, g);}function Il(a) {return a && \"auth/cordova-not-ready\" == a.code ? !0 : !1;}\n  function Pl(a, b, c, d, e) {var f;return yl(a.g).then(function () {return a.a.Mb(b, c, d, e).s(function (g) {if (Il(g)) throw new t(\"operation-not-supported-in-this-environment\");f = g;return zl(a.g).then(function () {throw f;});}).then(function () {return a.a.Zb() ? new C(function () {}) : zl(a.g).then(function () {return a.qa();}).then(function () {}).s(function () {});});});}function Ql(a, b, c, d, e) {return a.a.Nb(d, function (f) {b.ma(c, null, f, e);}, Ml.get());}var Rl = {};function El(a, b, c) {a = a + \":\" + b;c && (a = a + \":\" + c.url);return a;}\n  function Sl(a, b, c, d) {var e = El(b, c, d);Rl[e] || (Rl[e] = new Bl(a, b, c, d));return Rl[e];}function Cl() {this.b = null;this.f = [];this.c = [];this.a = null;this.i = this.g = !1;}Cl.prototype.reset = function () {this.b = null;this.a && (this.a.cancel(), this.a = null);};\n  Cl.prototype.h = function (a, b) {if (a) {this.reset();this.g = !0;var c = a.c,d = a.b,e = a.a && \"auth/web-storage-unsupported\" == a.a.code,f = a.a && \"auth/operation-not-supported-in-this-environment\" == a.a.code;this.i = !(!e && !f);\"unknown\" != c || e || f ? a.a ? (Tl(this, !0, null, a.a), D()) : b.Fa(c, d) ? Ul(this, a, b) : E(new t(\"invalid-auth-event\")) : (Tl(this, !1, null, null), D());} else E(new t(\"invalid-auth-event\"));};function Jl(a) {a.g || (a.g = !0, Tl(a, !1, null, null));}function Vl(a) {a.g && !a.i && Tl(a, !1, null, null);}\n  function Ul(a, b, c) {c = c.Fa(b.c, b.b);var d = b.g,e = b.f,f = b.i,g = b.S(),h = !!b.c.match(/Redirect$/);c(d, e, g, f).then(function (m) {Tl(a, h, m, null);}).s(function (m) {Tl(a, h, null, m);});}function Wl(a, b) {a.b = function () {return E(b);};if (a.c.length) for (var c = 0; c < a.c.length; c++) {a.c[c](b);}}function Xl(a, b) {a.b = function () {return D(b);};if (a.f.length) for (var c = 0; c < a.f.length; c++) {a.f[c](b);}}function Tl(a, b, c, d) {b ? d ? Wl(a, d) : Xl(a, c) : Xl(a, { user: null });a.f = [];a.c = [];}\n  Cl.prototype.qa = function () {var a = this;return new C(function (b, c) {a.b ? a.b().then(b, c) : (a.f.push(b), a.c.push(c), Yl(a));});};function Yl(a) {var b = new t(\"timeout\");a.a && a.a.cancel();a.a = Ad(Nl.get()).then(function () {a.b || (a.g = !0, Tl(a, !0, null, b));});}function Dl() {}Dl.prototype.h = function (a, b) {if (a) {var c = a.c,d = a.b;a.a ? (b.ma(a.c, null, a.a, a.b), D()) : b.Fa(c, d) ? Zl(a, b) : E(new t(\"invalid-auth-event\"));} else E(new t(\"invalid-auth-event\"));};\n  function Zl(a, b) {var c = a.b,d = a.c;b.Fa(d, c)(a.g, a.f, a.S(), a.i).then(function (e) {b.ma(d, e, null, c);}).s(function (e) {b.ma(d, null, e, c);});};function $l() {this.hb = !1;Object.defineProperty(this, \"appVerificationDisabled\", { get: function get() {return this.hb;}, set: function set(a) {this.hb = a;}, enumerable: !1 });};function am(a, b) {this.a = b;M(this, \"verificationId\", a);}am.prototype.confirm = function (a) {a = lh(this.verificationId, a);return this.a(a);};function bm(a, b, c, d) {return new hh(a).eb(b, c).then(function (e) {return new am(e, d);});};function cm(a) {var b = eg(a);if (!(b && b.exp && b.auth_time && b.iat)) throw new t(\"internal-error\", \"An internal error occurred. The token obtained by Firebase appears to be malformed. Please retry the operation.\");N(this, { token: a, expirationTime: Ye(1E3 * b.exp), authTime: Ye(1E3 * b.auth_time), issuedAtTime: Ye(1E3 * b.iat), signInProvider: b.firebase && b.firebase.sign_in_provider ? b.firebase.sign_in_provider : null, signInSecondFactor: b.firebase && b.firebase.sign_in_second_factor ? b.firebase.sign_in_second_factor : null, claims: b });}\n  ;function dm(a, b, c) {var d = b && b[em];if (!d) throw new t(\"argument-error\", \"Internal assert: Invalid MultiFactorResolver\");this.a = a;this.f = lb(b);this.g = c;this.c = new ug(null, d);this.b = [];var e = this;w(b[fm] || [], function (f) {(f = pf(f)) && e.b.push(f);});M(this, \"auth\", this.a);M(this, \"session\", this.c);M(this, \"hints\", this.b);}var fm = \"mfaInfo\",em = \"mfaPendingCredential\";dm.prototype.Qc = function (a) {var b = this;return a.rb(this.a.a, this.c).then(function (c) {var d = lb(b.f);delete d[fm];delete d[em];z(d, c);return b.g(d);});};function gm(a, b, c, d) {t.call(this, \"multi-factor-auth-required\", d, b);this.b = new dm(a, b, c);M(this, \"resolver\", this.b);}r(gm, t);function hm(a, b, c) {if (a && n(a.serverResponse) && \"auth/multi-factor-auth-required\" === a.code) try {return new gm(b, a.serverResponse, c, a.message);} catch (d) {}return null;};function im() {}im.prototype.rb = function (a, b, c) {return b.type == vg ? jm(this, a, b, c) : km(this, a, b);};function jm(a, b, c, d) {return c.Ha().then(function (e) {e = { idToken: e };\"undefined\" !== typeof d && (e.displayName = d);z(e, { phoneVerificationInfo: dh(a.a) });return O(b, Cj, e);});}function km(a, b, c) {return c.Ha().then(function (d) {d = { mfaPendingCredential: d };z(d, { phoneVerificationInfo: dh(a.a) });return O(b, Dj, d);});}function lm(a) {M(this, \"factorId\", a.fa);this.a = a;}r(lm, im);\n  function mm(a) {lm.call(this, a);if (this.a.fa != hh.PROVIDER_ID) throw new t(\"argument-error\", \"firebase.auth.PhoneMultiFactorAssertion requires a valid firebase.auth.PhoneAuthCredential\");}r(mm, lm);function nm(a, b) {F.call(this, a);for (var c in b) {this[c] = b[c];}}r(nm, F);function om(a, b) {this.a = a;this.b = [];this.c = q(this.xc, this);jd(this.a, \"userReloaded\", this.c);var c = [];b && b.multiFactor && b.multiFactor.enrolledFactors && w(b.multiFactor.enrolledFactors, function (d) {var e = null,f = {};if (d) {d.uid && (f[mf] = d.uid);d.displayName && (f[nf] = d.displayName);d.enrollmentTime && (f[of] = new Date(d.enrollmentTime).toISOString());d.phoneNumber && (f[lf] = d.phoneNumber);try {e = new qf(f);} catch (g) {}d = e;} else d = null;d && c.push(d);});pm(this, c);}\n  function qm(a) {var b = [];w(a.mfaInfo || [], function (c) {(c = pf(c)) && b.push(c);});return b;}k = om.prototype;k.xc = function (a) {pm(this, qm(a.gd));};function pm(a, b) {a.b = b;M(a, \"enrolledFactors\", b);}k.Qb = function () {return this.a.I().then(function (a) {return new ug(a, null);});};k.ec = function (a, b) {var c = this,d = this.a.a;return this.Qb().then(function (e) {return a.rb(d, e, b);}).then(function (e) {rm(c.a, e);return c.a.reload();});};\n  k.ad = function (a) {var b = this,c = \"string\" === typeof a ? a : a.uid,d = this.a.a;return this.a.I().then(function (e) {return O(d, Hj, { idToken: e, mfaEnrollmentId: c });}).then(function (e) {var f = Oa(b.b, function (g) {return g.uid != c;});pm(b, f);rm(b.a, e);return b.a.reload().s(function (g) {if (\"auth/user-token-expired\" != g.code) throw g;});});};k.w = function () {return { multiFactor: { enrolledFactors: Pa(this.b, function (a) {return a.w();}) } };};function sm(a, b, c) {this.h = a;this.i = b;this.g = c;this.c = 3E4;this.f = 96E4;this.b = null;this.a = this.c;if (this.f < this.c) throw Error(\"Proactive refresh lower bound greater than upper bound!\");}sm.prototype.start = function () {this.a = this.c;tm(this, !0);};function um(a, b) {if (b) return a.a = a.c, a.g();b = a.a;a.a *= 2;a.a > a.f && (a.a = a.f);return b;}function tm(a, b) {a.stop();a.b = Ad(um(a, b)).then(function () {return We();}).then(function () {return a.h();}).then(function () {tm(a, !0);}).s(function (c) {a.i(c) && tm(a, !1);});}\n  sm.prototype.stop = function () {this.b && (this.b.cancel(), this.b = null);};function vm(a) {this.c = a;this.b = this.a = null;}vm.prototype.w = function () {return { apiKey: this.c.c, refreshToken: this.a, accessToken: this.b && this.b.toString(), expirationTime: wm(this) };};function wm(a) {return a.b && 1E3 * a.b.c || 0;}function xm(a, b) {var c = b.refreshToken;a.b = fg(b[zg] || \"\");a.a = c;}function ym(a, b) {a.b = b.b;a.a = b.a;}\n  function zm(a, b) {return Si(a.c, b).then(function (c) {a.b = fg(c.access_token);a.a = c.refresh_token;return { accessToken: a.b.toString(), refreshToken: a.a };}).s(function (c) {\"auth/user-token-expired\" == c.code && (a.a = null);throw c;});}vm.prototype.getToken = function (a) {a = !!a;return this.b && !this.a ? E(new t(\"user-token-expired\")) : a || !this.b || ua() > wm(this) - 3E4 ? this.a ? zm(this, { grant_type: \"refresh_token\", refresh_token: this.a }) : D(null) : D({ accessToken: this.b.toString(), refreshToken: this.a });};function Am(a, b) {this.a = a || null;this.b = b || null;N(this, { lastSignInTime: Ye(b || null), creationTime: Ye(a || null) });}function Bm(a) {return new Am(a.a, a.b);}Am.prototype.w = function () {return { lastLoginAt: this.b, createdAt: this.a };};function Cm(a, b, c, d, e, f) {N(this, { uid: a, displayName: d || null, photoURL: e || null, email: c || null, phoneNumber: f || null, providerId: b });}\n  function Dm(a, b, c) {this.G = [];this.l = a.apiKey;this.m = a.appName;this.o = a.authDomain || null;var d = firebase.SDK_VERSION ? Je(firebase.SDK_VERSION) : null;this.a = new Ei(this.l, Aa(Ba), d);a.emulatorConfig && Li(this.a, a.emulatorConfig);this.b = new vm(this.a);Em(this, b[zg]);xm(this.b, b);M(this, \"refreshToken\", this.b.a);Fm(this, c || {});H.call(this);this.P = !1;this.o && Me() && (this.i = Sl(this.o, this.l, this.m));this.R = [];this.f = null;this.u = Gm(this);this.$ = q(this.gb, this);var e = this;this.pa = null;this.Ba = function (f) {e.wa(f.h);};\n    this.ba = null;this.za = function (f) {Li(e.a, f.c);};this.W = null;this.X = [];this.Aa = function (f) {Hm(e, f.f);};this.aa = null;this.N = new om(this, c);M(this, \"multiFactor\", this.N);}r(Dm, H);Dm.prototype.wa = function (a) {this.pa = a;Ki(this.a, a);};Dm.prototype.ka = function () {return this.pa;};function Im(a, b) {a.ba && G(a.ba, \"languageCodeChanged\", a.Ba);(a.ba = b) && jd(b, \"languageCodeChanged\", a.Ba);}function Jm(a, b) {a.W && G(a.W, \"emulatorConfigChanged\", a.za);(a.W = b) && jd(b, \"emulatorConfigChanged\", a.za);}\n  function Hm(a, b) {a.X = b;Ni(a.a, firebase.SDK_VERSION ? Je(firebase.SDK_VERSION, a.X) : null);}Dm.prototype.Ga = function () {return Xa(this.X);};function Km(a, b) {a.aa && G(a.aa, \"frameworkChanged\", a.Aa);(a.aa = b) && jd(b, \"frameworkChanged\", a.Aa);}Dm.prototype.gb = function () {this.u.b && (this.u.stop(), this.u.start());};function Lm(a) {try {return firebase.app(a.m).auth();} catch (b) {throw new t(\"internal-error\", \"No firebase.auth.Auth instance is available for the Firebase App '\" + a.m + \"'!\");}}\n  function Gm(a) {return new sm(function () {return a.I(!0);}, function (b) {return b && \"auth/network-request-failed\" == b.code ? !0 : !1;}, function () {var b = wm(a.b) - ua() - 3E5;return 0 < b ? b : 0;});}function Mm(a) {a.A || a.u.b || (a.u.start(), G(a, \"tokenChanged\", a.$), jd(a, \"tokenChanged\", a.$));}function Nm(a) {G(a, \"tokenChanged\", a.$);a.u.stop();}function Em(a, b) {a.ya = b;M(a, \"_lat\", b);}function Om(a, b) {Va(a.R, function (c) {return c == b;});}\n  function Pm(a) {for (var b = [], c = 0; c < a.R.length; c++) {b.push(a.R[c](a));}return Fc(b).then(function () {return a;});}function Qm(a) {a.i && !a.P && (a.P = !0, Kl(a.i, a));}function Fm(a, b) {N(a, { uid: b.uid, displayName: b.displayName || null, photoURL: b.photoURL || null, email: b.email || null, emailVerified: b.emailVerified || !1, phoneNumber: b.phoneNumber || null, isAnonymous: b.isAnonymous || !1, tenantId: b.tenantId || null, metadata: new Am(b.createdAt, b.lastLoginAt), providerData: [] });a.a.b = a.tenantId;}M(Dm.prototype, \"providerId\", \"firebase\");\n  function Rm() {}function Sm(a) {return D().then(function () {if (a.A) throw new t(\"app-deleted\");});}function Tm(a) {return Pa(a.providerData, function (b) {return b.providerId;});}function Um(a, b) {b && (Vm(a, b.providerId), a.providerData.push(b));}function Vm(a, b) {Va(a.providerData, function (c) {return c.providerId == b;});}function Wm(a, b, c) {(\"uid\" != b || c) && a.hasOwnProperty(b) && M(a, b, c);}\n  function Xm(a, b) {a != b && (N(a, { uid: b.uid, displayName: b.displayName, photoURL: b.photoURL, email: b.email, emailVerified: b.emailVerified, phoneNumber: b.phoneNumber, isAnonymous: b.isAnonymous, tenantId: b.tenantId, providerData: [] }), b.metadata ? M(a, \"metadata\", Bm(b.metadata)) : M(a, \"metadata\", new Am()), w(b.providerData, function (c) {Um(a, c);}), ym(a.b, b.b), M(a, \"refreshToken\", a.b.a), pm(a.N, b.N.b));}k = Dm.prototype;k.reload = function () {var a = this;return R(this, Sm(this).then(function () {return Ym(a).then(function () {return Pm(a);}).then(Rm);}));};\n  function Ym(a) {return a.I().then(function (b) {var c = a.isAnonymous;return Zm(a, b).then(function () {c || Wm(a, \"isAnonymous\", !1);return b;});});}k.nc = function (a) {return this.I(a).then(function (b) {return new cm(b);});};k.I = function (a) {var b = this;return R(this, Sm(this).then(function () {return b.b.getToken(a);}).then(function (c) {if (!c) throw new t(\"internal-error\");c.accessToken != b.ya && (Em(b, c.accessToken), b.dispatchEvent(new nm(\"tokenChanged\")));Wm(b, \"refreshToken\", c.refreshToken);return c.accessToken;}));};\n  function rm(a, b) {b[zg] && a.ya != b[zg] && (xm(a.b, b), a.dispatchEvent(new nm(\"tokenChanged\")), Em(a, b[zg]), Wm(a, \"refreshToken\", a.b.a));}function Zm(a, b) {return O(a.a, Ej, { idToken: b }).then(q(a.Jc, a));}\n  k.Jc = function (a) {a = a.users;if (!a || !a.length) throw new t(\"internal-error\");a = a[0];Fm(this, { uid: a.localId, displayName: a.displayName, photoURL: a.photoUrl, email: a.email, emailVerified: !!a.emailVerified, phoneNumber: a.phoneNumber, lastLoginAt: a.lastLoginAt, createdAt: a.createdAt, tenantId: a.tenantId });for (var b = $m(a), c = 0; c < b.length; c++) {Um(this, b[c]);}Wm(this, \"isAnonymous\", !(this.email && a.passwordHash) && !(this.providerData && this.providerData.length));this.dispatchEvent(new nm(\"userReloaded\", { gd: a }));};\n  function $m(a) {return (a = a.providerUserInfo) && a.length ? Pa(a, function (b) {return new Cm(b.rawId, b.providerId, b.email, b.displayName, b.photoUrl, b.phoneNumber);}) : [];}k.Kc = function (a) {cf(\"firebase.User.prototype.reauthenticateAndRetrieveDataWithCredential is deprecated. Please use firebase.User.prototype.reauthenticateWithCredential instead.\");return this.sb(a);};\n  k.sb = function (a) {var b = this,c = null;return R(this, a.c(this.a, this.uid).then(function (d) {rm(b, d);c = an(b, d, \"reauthenticate\");b.f = null;return b.reload();}).then(function () {return c;}), !0);};function bn(a, b) {return Ym(a).then(function () {if (Ta(Tm(a), b)) return Pm(a).then(function () {throw new t(\"provider-already-linked\");});});}k.Bc = function (a) {cf(\"firebase.User.prototype.linkAndRetrieveDataWithCredential is deprecated. Please use firebase.User.prototype.linkWithCredential instead.\");return this.pb(a);};\n  k.pb = function (a) {var b = this,c = null;return R(this, bn(this, a.providerId).then(function () {return b.I();}).then(function (d) {return a.b(b.a, d);}).then(function (d) {c = an(b, d, \"link\");return cn(b, d);}).then(function () {return c;}));};k.Cc = function (a, b) {var c = this;return R(this, bn(this, \"phone\").then(function () {return bm(Lm(c), a, b, q(c.pb, c));}));};k.Lc = function (a, b) {var c = this;return R(this, D().then(function () {return bm(Lm(c), a, b, q(c.sb, c));}), !0);};\n  function an(a, b, c) {var d = mh(b);b = kg(b);return ff({ user: a, credential: d, additionalUserInfo: b, operationType: c });}function cn(a, b) {rm(a, b);return a.reload().then(function () {return a;});}k.Ab = function (a) {var b = this;return R(this, this.I().then(function (c) {return b.a.Ab(c, a);}).then(function (c) {rm(b, c);return b.reload();}));};k.dd = function (a) {var b = this;return R(this, this.I().then(function (c) {return a.b(b.a, c);}).then(function (c) {rm(b, c);return b.reload();}));};\n  k.Bb = function (a) {var b = this;return R(this, this.I().then(function (c) {return b.a.Bb(c, a);}).then(function (c) {rm(b, c);return b.reload();}));};\n  k.Cb = function (a) {if (void 0 === a.displayName && void 0 === a.photoURL) return Sm(this);var b = this;return R(this, this.I().then(function (c) {return b.a.Cb(c, { displayName: a.displayName, photoUrl: a.photoURL });}).then(function (c) {rm(b, c);Wm(b, \"displayName\", c.displayName || null);Wm(b, \"photoURL\", c.photoUrl || null);w(b.providerData, function (d) {\"password\" === d.providerId && (M(d, \"displayName\", b.displayName), M(d, \"photoURL\", b.photoURL));});return Pm(b);}).then(Rm));};\n  k.bd = function (a) {var b = this;return R(this, Ym(this).then(function (c) {return Ta(Tm(b), a) ? nj(b.a, c, [a]).then(function (d) {var e = {};w(d.providerUserInfo || [], function (f) {e[f.providerId] = !0;});w(Tm(b), function (f) {e[f] || Vm(b, f);});e[hh.PROVIDER_ID] || M(b, \"phoneNumber\", null);return Pm(b);}) : Pm(b).then(function () {throw new t(\"no-such-provider\");});}));};\n  k.delete = function () {var a = this;return R(this, this.I().then(function (b) {return O(a.a, Bj, { idToken: b });}).then(function () {a.dispatchEvent(new nm(\"userDeleted\"));})).then(function () {for (var b = 0; b < a.G.length; b++) {a.G[b].cancel(\"app-deleted\");}Im(a, null);Jm(a, null);Km(a, null);a.G = [];a.A = !0;Nm(a);M(a, \"refreshToken\", null);a.i && Ll(a.i, a);});};\n  k.Eb = function (a, b) {return \"linkViaPopup\" == a && (this.h || null) == b && this.g || \"reauthViaPopup\" == a && (this.h || null) == b && this.g || \"linkViaRedirect\" == a && (this.ga || null) == b || \"reauthViaRedirect\" == a && (this.ga || null) == b ? !0 : !1;};k.ma = function (a, b, c, d) {\"linkViaPopup\" != a && \"reauthViaPopup\" != a || d != (this.h || null) || (c && this.O ? this.O(c) : b && !c && this.g && this.g(b), this.c && (this.c.cancel(), this.c = null), delete this.g, delete this.O);};\n  k.Fa = function (a, b) {return \"linkViaPopup\" == a && b == (this.h || null) ? q(this.Jb, this) : \"reauthViaPopup\" == a && b == (this.h || null) ? q(this.Kb, this) : \"linkViaRedirect\" == a && (this.ga || null) == b ? q(this.Jb, this) : \"reauthViaRedirect\" == a && (this.ga || null) == b ? q(this.Kb, this) : null;};k.Dc = function (a) {var b = this;return dn(this, \"linkViaPopup\", a, function () {return bn(b, a.providerId).then(function () {return Pm(b);});}, !1);};k.Mc = function (a) {return dn(this, \"reauthViaPopup\", a, function () {return D();}, !0);};\n  function dn(a, b, c, d, e) {if (!Me()) return E(new t(\"operation-not-supported-in-this-environment\"));if (a.f && !e) return E(a.f);var f = jg(c.providerId),g = Le(a.uid + \":::\"),h = null;(!Oe() || De()) && a.o && c.isOAuthProvider && (h = ak(a.o, a.l, a.m, b, c, null, g, firebase.SDK_VERSION || null, null, null, a.tenantId));var m = ue(h, f && f.ua, f && f.ta);d = d().then(function () {en(a);if (!e) return a.I().then(function () {});}).then(function () {return Ol(a.i, m, b, c, g, !!h, a.tenantId);}).then(function () {return new C(function (p, v) {a.ma(b, null, new t(\"cancelled-popup-request\"),\n        a.h || null);a.g = p;a.O = v;a.h = g;a.c = Ql(a.i, a, b, m, g);});}).then(function (p) {m && te(m);return p ? ff(p) : null;}).s(function (p) {m && te(m);throw p;});return R(a, d, e);}k.Ec = function (a) {var b = this;return fn(this, \"linkViaRedirect\", a, function () {return bn(b, a.providerId);}, !1);};k.Nc = function (a) {return fn(this, \"reauthViaRedirect\", a, function () {return D();}, !0);};\n  function fn(a, b, c, d, e) {if (!Me()) return E(new t(\"operation-not-supported-in-this-environment\"));if (a.f && !e) return E(a.f);var f = null,g = Le(a.uid + \":::\");d = d().then(function () {en(a);if (!e) return a.I().then(function () {});}).then(function () {a.ga = g;return Pm(a);}).then(function (h) {a.ha && (h = a.ha, h = h.b.set(gn, a.w(), h.a));return h;}).then(function () {return Pl(a.i, b, c, g, a.tenantId);}).s(function (h) {f = h;if (a.ha) return hn(a.ha);throw f;}).then(function () {if (f) throw f;});return R(a, d, e);}\n  function en(a) {if (!a.i || !a.P) {if (a.i && !a.P) throw new t(\"internal-error\");throw new t(\"auth-domain-config-required\");}}k.Jb = function (a, b, c, d) {var e = this;this.c && (this.c.cancel(), this.c = null);var f = null;c = this.I().then(function (g) {return Dg(e.a, { requestUri: a, postBody: d, sessionId: b, idToken: g });}).then(function (g) {f = an(e, g, \"link\");return cn(e, g);}).then(function () {return f;});return R(this, c);};\n  k.Kb = function (a, b, c, d) {var e = this;this.c && (this.c.cancel(), this.c = null);var f = null,g = D().then(function () {return yg(Eg(e.a, { requestUri: a, sessionId: b, postBody: d, tenantId: c }), e.uid);}).then(function (h) {f = an(e, h, \"reauthenticate\");rm(e, h);e.f = null;return e.reload();}).then(function () {return f;});return R(this, g, !0);};\n  k.tb = function (a) {var b = this,c = null;return R(this, this.I().then(function (d) {c = d;return \"undefined\" === typeof a || kb(a) ? {} : Yf(new Of(a));}).then(function (d) {return b.a.tb(c, d);}).then(function (d) {if (b.email != d) return b.reload();}).then(function () {}));};k.Db = function (a, b) {var c = this,d = null;return R(this, this.I().then(function (e) {d = e;return \"undefined\" === typeof b || kb(b) ? {} : Yf(new Of(b));}).then(function (e) {return c.a.Db(d, a, e);}).then(function (e) {if (c.email != e) return c.reload();}).then(function () {}));};\n  function R(a, b, c) {var d = jn(a, b, c);a.G.push(d);d.na(function () {Ua(a.G, d);});return d.s(function (e) {var f = null;e && \"auth/multi-factor-auth-required\" === e.code && (f = hm(e.w(), Lm(a), q(a.ic, a)));throw f || e;});}k.ic = function (a) {var b = null,c = this;a = yg(D(a), c.uid).then(function (d) {b = an(c, d, \"reauthenticate\");rm(c, d);c.f = null;return c.reload();}).then(function () {return b;});return R(this, a, !0);};\n  function jn(a, b, c) {return a.f && !c ? (b.cancel(), E(a.f)) : b.s(function (d) {!d || \"auth/user-disabled\" != d.code && \"auth/user-token-expired\" != d.code || (a.f || a.dispatchEvent(new nm(\"userInvalidated\")), a.f = d);throw d;});}k.toJSON = function () {return this.w();};\n  k.w = function () {var a = { uid: this.uid, displayName: this.displayName, photoURL: this.photoURL, email: this.email, emailVerified: this.emailVerified, phoneNumber: this.phoneNumber, isAnonymous: this.isAnonymous, tenantId: this.tenantId, providerData: [], apiKey: this.l, appName: this.m, authDomain: this.o, stsTokenManager: this.b.w(), redirectEventId: this.ga || null };this.metadata && z(a, this.metadata.w());w(this.providerData, function (b) {a.providerData.push(gf(b));});z(a, this.N.w());return a;};\n  function kn(a) {if (!a.apiKey) return null;var b = { apiKey: a.apiKey, authDomain: a.authDomain, appName: a.appName, emulatorConfig: a.emulatorConfig },c = {};if (a.stsTokenManager && a.stsTokenManager.accessToken) c[zg] = a.stsTokenManager.accessToken, c.refreshToken = a.stsTokenManager.refreshToken || null;else return null;var d = new Dm(b, c, a);a.providerData && w(a.providerData, function (e) {e && Um(d, ff(e));});a.redirectEventId && (d.ga = a.redirectEventId);return d;}\n  function ln(a, b, c, d) {var e = new Dm(a, b);c && (e.ha = c);d && Hm(e, d);return e.reload().then(function () {return e;});}function mn(a, b, c, d) {var e = a.b,f = {};f[zg] = e.b && e.b.toString();f.refreshToken = e.a;b = new Dm(b || { apiKey: a.l, authDomain: a.o, appName: a.m }, f);c && (b.ha = c);d && Hm(b, d);Xm(b, a);return b;};function nn(a) {this.a = a;this.b = Qk();}var gn = { name: \"redirectUser\", D: \"session\" };function hn(a) {return Uk(a.b, gn, a.a);}function on(a, b) {return a.b.get(gn, a.a).then(function (c) {c && b && (c.authDomain = b);return kn(c || {});});};function pn(a) {this.a = a;this.b = Qk();this.c = null;this.f = qn(this);this.b.addListener(rn(\"local\"), this.a, q(this.g, this));}pn.prototype.g = function () {var a = this,b = rn(\"local\");sn(this, function () {return D().then(function () {return a.c && \"local\" != a.c.D ? a.b.get(b, a.a) : null;}).then(function (c) {if (c) return tn(a, \"local\").then(function () {a.c = b;});});});};function tn(a, b) {var c = [],d;for (d in Mk) {Mk[d] !== b && c.push(Uk(a.b, rn(Mk[d]), a.a));}c.push(Uk(a.b, un, a.a));return Ec(c);}\n  function qn(a) {var b = rn(\"local\"),c = rn(\"session\"),d = rn(\"none\");return Tk(a.b, b, a.a).then(function () {return a.b.get(c, a.a);}).then(function (e) {return e ? c : a.b.get(d, a.a).then(function (f) {return f ? d : a.b.get(b, a.a).then(function (g) {return g ? b : a.b.get(un, a.a).then(function (h) {return h ? rn(h) : b;});});});}).then(function (e) {a.c = e;return tn(a, e.D);}).s(function () {a.c || (a.c = b);});}var un = { name: \"persistence\", D: \"session\" };function rn(a) {return { name: \"authUser\", D: a };}\n  pn.prototype.wb = function (a) {var b = null,c = this;Nk(a);return sn(this, function () {return a != c.c.D ? c.b.get(c.c, c.a).then(function (d) {b = d;return tn(c, a);}).then(function () {c.c = rn(a);if (b) return c.b.set(c.c, b, c.a);}) : D();});};function vn(a) {return sn(a, function () {return a.b.set(un, a.c.D, a.a);});}function wn(a, b) {return sn(a, function () {return a.b.set(a.c, b.w(), a.a);});}function xn(a) {return sn(a, function () {return Uk(a.b, a.c, a.a);});}\n  function yn(a, b, c) {return sn(a, function () {return a.b.get(a.c, a.a).then(function (d) {d && b && (d.authDomain = b);d && c && (d.emulatorConfig = c);return kn(d || {});});});}function sn(a, b) {a.f = a.f.then(b, b);return a.f;};function zn(a) {this.m = !1;M(this, \"settings\", new $l());M(this, \"app\", a);if (S(this).options && S(this).options.apiKey) a = firebase.SDK_VERSION ? Je(firebase.SDK_VERSION) : null, this.a = new Ei(S(this).options && S(this).options.apiKey, Aa(Ba), a);else throw new t(\"invalid-api-key\");this.R = [];this.u = [];this.P = [];this.ac = firebase.INTERNAL.createSubscribe(q(this.yc, this));this.X = void 0;this.bc = firebase.INTERNAL.createSubscribe(q(this.zc, this));An(this, null);this.l = new pn(S(this).options.apiKey + \":\" + S(this).name);this.G =\n    new nn(S(this).options.apiKey + \":\" + S(this).name);this.$ = T(this, Bn(this));this.i = T(this, Cn(this));this.ba = !1;this.pa = q(this.Yc, this);this.Ba = q(this.da, this);this.ya = q(this.kc, this);this.za = q(this.vc, this);this.Aa = q(this.wc, this);this.b = null;Dn(this);this.INTERNAL = {};this.INTERNAL[\"delete\"] = q(this.delete, this);this.INTERNAL.logFramework = q(this.Fc, this);this.A = 0;H.call(this);En(this);this.N = [];this.f = null;}r(zn, H);function Fn(a) {F.call(this, \"languageCodeChanged\");this.h = a;}r(Fn, F);\n  function Gn(a) {F.call(this, \"emulatorConfigChanged\");this.c = a;}r(Gn, F);function Hn(a) {F.call(this, \"frameworkChanged\");this.f = a;}r(Hn, F);k = zn.prototype;k.wb = function (a) {a = this.l.wb(a);return T(this, a);};k.wa = function (a) {this.aa === a || this.m || (this.aa = a, Ki(this.a, this.aa), this.dispatchEvent(new Fn(this.ka())));};k.ka = function () {return this.aa;};k.ed = function () {var a = l.navigator;this.wa(a ? a.languages && a.languages[0] || a.language || a.userLanguage || null : null);};\n  k.fd = function (a) {if (!this.f) {if (!/^https?:\\/\\//.test(a)) throw new t(\"argument-error\", \"Emulator URL must start with a valid scheme (http:// or https://).\");In();this.f = { url: a };this.settings.hb = !0;Li(this.a, this.f);this.dispatchEvent(new Gn(this.f));}};\n  function In() {Xe(\"WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials.\");l.document && ze().then(function () {var a = l.document.createElement(\"div\");a.innerText = \"Running in emulator mode. Do not use with production credentials.\";a.style.position = \"fixed\";a.style.width = \"100%\";a.style.backgroundColor = \"#ffffff\";a.style.border = \".1em solid #000000\";a.style.color = \"#ff0000\";a.style.bottom = \"0px\";a.style.left = \"0px\";a.style.margin = \"0px\";a.style.zIndex =\n      1E4;a.style.textAlign = \"center\";a.classList.add(\"firebase-emulator-warning\");l.document.body.appendChild(a);});}k.Fc = function (a) {this.N.push(a);Ni(this.a, firebase.SDK_VERSION ? Je(firebase.SDK_VERSION, this.N) : null);this.dispatchEvent(new Hn(this.N));};k.Ga = function () {return Xa(this.N);};k.xb = function (a) {this.W === a || this.m || (this.W = a, this.a.b = this.W);};k.S = function () {return this.W;};\n  function En(a) {Object.defineProperty(a, \"lc\", { get: function get() {return this.ka();}, set: function set(b) {this.wa(b);}, enumerable: !1 });a.aa = null;Object.defineProperty(a, \"ti\", { get: function get() {return this.S();}, set: function set(b) {this.xb(b);}, enumerable: !1 });a.W = null;}k.toJSON = function () {return { apiKey: S(this).options.apiKey, authDomain: S(this).options.authDomain, appName: S(this).name, currentUser: U(this) && U(this).w() };};function Jn(a) {return a.gb || E(new t(\"auth-domain-config-required\"));}\n  function Dn(a) {var b = S(a).options.authDomain,c = S(a).options.apiKey;b && Me() && (a.gb = a.$.then(function () {if (!a.m) {a.b = Sl(b, c, S(a).name, a.f);Kl(a.b, a);U(a) && Qm(U(a));if (a.o) {Qm(a.o);var d = a.o;d.wa(a.ka());Im(d, a);d = a.o;Hm(d, a.N);Km(d, a);d = a.o;Li(d.a, a.f);Jm(d, a);a.o = null;}return a.b;}}));}k.Eb = function (a, b) {switch (a) {case \"unknown\":case \"signInViaRedirect\":return !0;case \"signInViaPopup\":return this.h == b && !!this.g;default:return !1;}};\n  k.ma = function (a, b, c, d) {\"signInViaPopup\" == a && this.h == d && (c && this.O ? this.O(c) : b && !c && this.g && this.g(b), this.c && (this.c.cancel(), this.c = null), delete this.g, delete this.O);};k.Fa = function (a, b) {return \"signInViaRedirect\" == a || \"signInViaPopup\" == a && this.h == b && this.g ? q(this.hc, this) : null;};k.hc = function (a, b, c, d) {var e = this,f = { requestUri: a, postBody: d, sessionId: b, tenantId: c };this.c && (this.c.cancel(), this.c = null);return e.$.then(function () {return Kn(e, Bg(e.a, f));});};\n  k.Wc = function (a) {if (!Me()) return E(new t(\"operation-not-supported-in-this-environment\"));var b = this,c = jg(a.providerId),d = Le(),e = null;(!Oe() || De()) && S(this).options.authDomain && a.isOAuthProvider && (e = ak(S(this).options.authDomain, S(this).options.apiKey, S(this).name, \"signInViaPopup\", a, null, d, firebase.SDK_VERSION || null, null, null, this.S(), this.f));var f = ue(e, c && c.ua, c && c.ta);c = Jn(this).then(function (g) {return Ol(g, f, \"signInViaPopup\", a, d, !!e, b.S());}).then(function () {return new C(function (g, h) {b.ma(\"signInViaPopup\",\n        null, new t(\"cancelled-popup-request\"), b.h);b.g = g;b.O = h;b.h = d;b.c = Ql(b.b, b, \"signInViaPopup\", f, d);});}).then(function (g) {f && te(f);return g ? ff(g) : null;}).s(function (g) {f && te(f);throw g;});return T(this, c);};k.Xc = function (a) {if (!Me()) return E(new t(\"operation-not-supported-in-this-environment\"));var b = this,c = Jn(this).then(function () {return vn(b.l);}).then(function () {return Pl(b.b, \"signInViaRedirect\", a, void 0, b.S());});return T(this, c);};\n  function Ln(a) {if (!Me()) return E(new t(\"operation-not-supported-in-this-environment\"));var b = Jn(a).then(function () {return a.b.qa();}).then(function (c) {return c ? ff(c) : null;});return T(a, b);}k.qa = function () {var a = this;return Ln(this).then(function (b) {a.b && Vl(a.b.b);return b;}).s(function (b) {a.b && Vl(a.b.b);throw b;});};\n  k.cd = function (a) {if (!a) return E(new t(\"null-user\"));if (this.W != a.tenantId) return E(new t(\"tenant-id-mismatch\"));var b = this,c = {};c.apiKey = S(this).options.apiKey;c.authDomain = S(this).options.authDomain;c.appName = S(this).name;var d = mn(a, c, b.G, b.Ga());return T(this, this.i.then(function () {if (S(b).options.apiKey != a.l) return d.reload();}).then(function () {if (U(b) && a.uid == U(b).uid) return Xm(U(b), a), b.da(a);An(b, d);Qm(d);return b.da(d);}).then(function () {Mn(b);}));};\n  function Nn(a, b) {var c = {};c.apiKey = S(a).options.apiKey;c.authDomain = S(a).options.authDomain;c.appName = S(a).name;a.f && (c.emulatorConfig = a.f);return a.$.then(function () {return ln(c, b, a.G, a.Ga());}).then(function (d) {if (U(a) && d.uid == U(a).uid) return Xm(U(a), d), a.da(d);An(a, d);Qm(d);return a.da(d);}).then(function () {Mn(a);});}\n  function An(a, b) {U(a) && (Om(U(a), a.Ba), G(U(a), \"tokenChanged\", a.ya), G(U(a), \"userDeleted\", a.za), G(U(a), \"userInvalidated\", a.Aa), Nm(U(a)));b && (b.R.push(a.Ba), jd(b, \"tokenChanged\", a.ya), jd(b, \"userDeleted\", a.za), jd(b, \"userInvalidated\", a.Aa), 0 < a.A && Mm(b));M(a, \"currentUser\", b);b && (b.wa(a.ka()), Im(b, a), Hm(b, a.N), Km(b, a), Li(b.a, a.f), Jm(b, a));}k.zb = function () {var a = this,b = this.i.then(function () {a.b && Vl(a.b.b);if (!U(a)) return D();An(a, null);return xn(a.l).then(function () {Mn(a);});});return T(this, b);};\n  function On(a) {var b = on(a.G, S(a).options.authDomain).then(function (c) {if (a.o = c) c.ha = a.G;return hn(a.G);});return T(a, b);}function Bn(a) {var b = S(a).options.authDomain,c = On(a).then(function () {return yn(a.l, b, a.f);}).then(function (d) {return d ? (d.ha = a.G, a.o && (a.o.ga || null) == (d.ga || null) ? d : d.reload().then(function () {return wn(a.l, d).then(function () {return d;});}).s(function (e) {return \"auth/network-request-failed\" == e.code ? d : xn(a.l);})) : null;}).then(function (d) {An(a, d || null);});return T(a, c);}\n  function Cn(a) {return a.$.then(function () {return Ln(a);}).s(function () {}).then(function () {if (!a.m) return a.pa();}).s(function () {}).then(function () {if (!a.m) {a.ba = !0;var b = a.l;b.b.addListener(rn(\"local\"), b.a, a.pa);}});}\n  k.Yc = function () {var a = this;return yn(this.l, S(this).options.authDomain).then(function (b) {if (!a.m) {var c;if (c = U(a) && b) {c = U(a).uid;var d = b.uid;c = void 0 === c || null === c || \"\" === c || void 0 === d || null === d || \"\" === d ? !1 : c == d;}if (c) return Xm(U(a), b), U(a).I();if (U(a) || b) An(a, b), b && (Qm(b), b.ha = a.G), a.b && Kl(a.b, a), Mn(a);}});};k.da = function (a) {return wn(this.l, a);};k.kc = function () {Mn(this);this.da(U(this));};k.vc = function () {this.zb();};k.wc = function () {this.zb();};\n  function Kn(a, b) {var c = null,d = null;return T(a, b.then(function (e) {c = mh(e);d = kg(e);return Nn(a, e);}, function (e) {var f = null;e && \"auth/multi-factor-auth-required\" === e.code && (f = hm(e.w(), a, q(a.jc, a)));throw f || e;}).then(function () {return ff({ user: U(a), credential: c, additionalUserInfo: d, operationType: \"signIn\" });}));}k.jc = function (a) {var b = this;return this.i.then(function () {return Kn(b, D(a));});};k.yc = function (a) {var b = this;this.addAuthTokenListener(function () {a.next(U(b));});};\n  k.zc = function (a) {var b = this;Pn(this, function () {a.next(U(b));});};k.Hc = function (a, b, c) {var d = this;this.ba && Promise.resolve().then(function () {\"function\" === typeof a ? a(U(d)) : \"function\" === typeof a.next && a.next(U(d));});return this.ac(a, b, c);};k.Gc = function (a, b, c) {var d = this;this.ba && Promise.resolve().then(function () {d.X = d.getUid();\"function\" === typeof a ? a(U(d)) : \"function\" === typeof a.next && a.next(U(d));});return this.bc(a, b, c);};\n  k.mc = function (a) {var b = this,c = this.i.then(function () {return U(b) ? U(b).I(a).then(function (d) {return { accessToken: d };}) : null;});return T(this, c);};k.Sc = function (a) {var b = this;return this.i.then(function () {return Kn(b, O(b.a, Gj, { token: a }));}).then(function (c) {var d = c.user;Wm(d, \"isAnonymous\", !1);b.da(d);return c;});};k.Tc = function (a, b) {var c = this;return this.i.then(function () {return Kn(c, O(c.a, Xg, { email: a, password: b }));});};\n  k.dc = function (a, b) {var c = this;return this.i.then(function () {return Kn(c, O(c.a, Aj, { email: a, password: b }));});};k.Za = function (a) {var b = this;return this.i.then(function () {return Kn(b, a.ja(b.a));});};k.Rc = function (a) {cf(\"firebase.auth.Auth.prototype.signInAndRetrieveDataWithCredential is deprecated. Please use firebase.auth.Auth.prototype.signInWithCredential instead.\");return this.Za(a);};\n  k.yb = function () {var a = this;return this.i.then(function () {var b = U(a);if (b && b.isAnonymous) {var c = ff({ providerId: null, isNewUser: !1 });return ff({ user: b, credential: null, additionalUserInfo: c, operationType: \"signIn\" });}return Kn(a, a.a.yb()).then(function (d) {var e = d.user;Wm(e, \"isAnonymous\", !0);a.da(e);return d;});});};function S(a) {return a.app;}function U(a) {return a.currentUser;}k.getUid = function () {return U(this) && U(this).uid || null;};function Qn(a) {return U(a) && U(a)._lat || null;}\n  function Mn(a) {if (a.ba) {for (var b = 0; b < a.u.length; b++) {if (a.u[b]) a.u[b](Qn(a));}if (a.X !== a.getUid() && a.P.length) for (a.X = a.getUid(), b = 0; b < a.P.length; b++) {if (a.P[b]) a.P[b](Qn(a));}}}k.cc = function (a) {this.addAuthTokenListener(a);this.A++;0 < this.A && U(this) && Mm(U(this));};k.Oc = function (a) {var b = this;w(this.u, function (c) {c == a && b.A--;});0 > this.A && (this.A = 0);0 == this.A && U(this) && Nm(U(this));this.removeAuthTokenListener(a);};\n  k.addAuthTokenListener = function (a) {var b = this;this.u.push(a);T(this, this.i.then(function () {b.m || Ta(b.u, a) && a(Qn(b));}));};k.removeAuthTokenListener = function (a) {Va(this.u, function (b) {return b == a;});};function Pn(a, b) {a.P.push(b);T(a, a.i.then(function () {!a.m && Ta(a.P, b) && a.X !== a.getUid() && (a.X = a.getUid(), b(Qn(a)));}));}\n  k.delete = function () {this.m = !0;for (var a = 0; a < this.R.length; a++) {this.R[a].cancel(\"app-deleted\");}this.R = [];this.l && (a = this.l, a.b.removeListener(rn(\"local\"), a.a, this.pa));this.b && (Ll(this.b, this), Vl(this.b.b));return Promise.resolve();};function T(a, b) {a.R.push(b);b.na(function () {Ua(a.R, b);});return b;}k.gc = function (a) {return T(this, Xi(this.a, a));};k.Ac = function (a) {return !!bh(a);};\n  k.vb = function (a, b) {var c = this;return T(this, D().then(function () {var d = new Of(b);if (!d.c) throw new t(\"argument-error\", Wf + \" must be true when sending sign in link to email\");return Yf(d);}).then(function (d) {return c.a.vb(a, d);}).then(function () {}));};k.hd = function (a) {return this.Qa(a).then(function (b) {return b.data.email;});};k.mb = function (a, b) {return T(this, this.a.mb(a, b).then(function () {}));};k.Qa = function (a) {return T(this, this.a.Qa(a).then(function (b) {return new rf(b);}));};\n  k.ib = function (a) {return T(this, this.a.ib(a).then(function () {}));};k.ub = function (a, b) {var c = this;return T(this, D().then(function () {return \"undefined\" === typeof b || kb(b) ? {} : Yf(new Of(b));}).then(function (d) {return c.a.ub(a, d);}).then(function () {}));};k.Vc = function (a, b) {return T(this, bm(this, a, b, q(this.Za, this)));};\n  k.Uc = function (a, b) {var c = this;return T(this, D().then(function () {var d = b || me(),e = ah(a, d);d = bh(d);if (!d) throw new t(\"argument-error\", \"Invalid email link!\");if (d.tenantId !== c.S()) throw new t(\"tenant-id-mismatch\");return c.Za(e);}));};function Rn() {}Rn.prototype.render = function () {};Rn.prototype.reset = function () {};Rn.prototype.getResponse = function () {};Rn.prototype.execute = function () {};function Sn() {this.a = {};this.b = 1E12;}var Tn = null;Sn.prototype.render = function (a, b) {this.a[this.b.toString()] = new Un(a, b);return this.b++;};Sn.prototype.reset = function (a) {var b = Vn(this, a);a = Wn(a);b && a && (b.delete(), delete this.a[a]);};Sn.prototype.getResponse = function (a) {return (a = Vn(this, a)) ? a.getResponse() : null;};Sn.prototype.execute = function (a) {(a = Vn(this, a)) && a.execute();};function Vn(a, b) {return (b = Wn(b)) ? a.a[b] || null : null;}function Wn(a) {return (a = \"undefined\" === typeof a ? 1E12 : a) ? a.toString() : null;}\n  function Un(a, b) {this.g = !1;this.c = b;this.a = this.b = null;this.h = \"invisible\" !== this.c.size;this.f = fc(a);var c = this;this.i = function () {c.execute();};this.h ? this.execute() : jd(this.f, \"click\", this.i);}Un.prototype.getResponse = function () {Xn(this);return this.b;};\n  Un.prototype.execute = function () {Xn(this);var a = this;this.a || (this.a = setTimeout(function () {a.b = He();var b = a.c.callback,c = a.c[\"expired-callback\"];if (b) try {b(a.b);} catch (d) {}a.a = setTimeout(function () {a.a = null;a.b = null;if (c) try {c();} catch (d) {}a.h && a.execute();}, 6E4);}, 500));};Un.prototype.delete = function () {Xn(this);this.g = !0;clearTimeout(this.a);this.a = null;G(this.f, \"click\", this.i);};function Xn(a) {if (a.g) throw Error(\"reCAPTCHA mock was already deleted!\");};function Yn() {}M(Yn, \"FACTOR_ID\", \"phone\");function Zn() {}Zn.prototype.g = function () {Tn || (Tn = new Sn());return D(Tn);};Zn.prototype.c = function () {};var $n = null;function ao() {this.b = l.grecaptcha ? Infinity : 0;this.f = null;this.a = \"__rcb\" + Math.floor(1E6 * Math.random()).toString();}var bo = new ob(pb, \"https://www.google.com/recaptcha/api.js?onload=%{onload}&render=explicit&hl=%{hl}\"),co = new Ue(3E4, 6E4);\n  ao.prototype.g = function (a) {var b = this;return new C(function (c, d) {var e = setTimeout(function () {d(new t(\"network-request-failed\"));}, co.get());if (!l.grecaptcha || a !== b.f && !b.b) {l[b.a] = function () {if (l.grecaptcha) {b.f = a;var g = l.grecaptcha.render;l.grecaptcha.render = function (h, m) {h = g(h, m);b.b++;return h;};clearTimeout(e);c(l.grecaptcha);} else clearTimeout(e), d(new t(\"internal-error\"));delete l[b.a];};var f = xb(bo, { onload: b.a, hl: a || \"\" });D(xi(f)).s(function () {clearTimeout(e);d(new t(\"internal-error\", \"Unable to load external reCAPTCHA dependencies!\"));});} else clearTimeout(e),\n      c(l.grecaptcha);});};ao.prototype.c = function () {this.b--;};var eo = null;function fo(a, b, c, d, e, f, g) {M(this, \"type\", \"recaptcha\");this.c = this.f = null;this.A = !1;this.m = b;this.g = null;g ? ($n || ($n = new Zn()), g = $n) : (eo || (eo = new ao()), g = eo);this.v = g;this.a = c || { theme: \"light\", type: \"image\" };this.h = [];if (this.a[go]) throw new t(\"argument-error\", \"sitekey should not be provided for reCAPTCHA as one is automatically provisioned for the current project.\");this.i = \"invisible\" === this.a[ho];if (!l.document) throw new t(\"operation-not-supported-in-this-environment\", \"RecaptchaVerifier is only supported in a browser HTTP/HTTPS environment with DOM support.\");\n    if (!fc(b) || !this.i && fc(b).hasChildNodes()) throw new t(\"argument-error\", \"reCAPTCHA container is either not found or already contains inner elements!\");this.o = new Ei(a, f || null, e || null);this.u = d || function () {return null;};var h = this;this.l = [];var m = this.a[io];this.a[io] = function (v) {jo(h, v);if (\"function\" === typeof m) m(v);else if (\"string\" === typeof m) {var B = L(m, l);\"function\" === typeof B && B(v);}};var p = this.a[ko];this.a[ko] = function () {jo(h, null);if (\"function\" === typeof p) p();else if (\"string\" === typeof p) {var v =\n        L(p, l);\"function\" === typeof v && v();}};}var io = \"callback\",ko = \"expired-callback\",go = \"sitekey\",ho = \"size\";function jo(a, b) {for (var c = 0; c < a.l.length; c++) {try {a.l[c](b);} catch (d) {}}}function lo(a, b) {Va(a.l, function (c) {return c == b;});}function mo(a, b) {a.h.push(b);b.na(function () {Ua(a.h, b);});return b;}k = fo.prototype;\n  k.Ia = function () {var a = this;return this.f ? this.f : this.f = mo(this, D().then(function () {if (Ne() && !Ee()) return ze();throw new t(\"operation-not-supported-in-this-environment\", \"RecaptchaVerifier is only supported in a browser HTTP/HTTPS environment.\");}).then(function () {return a.v.g(a.u());}).then(function (b) {a.g = b;return O(a.o, Fj, {});}).then(function (b) {a.a[go] = b.recaptchaSiteKey;}).s(function (b) {a.f = null;throw b;}));};\n  k.render = function () {no(this);var a = this;return mo(this, this.Ia().then(function () {if (null === a.c) {var b = a.m;if (!a.i) {var c = fc(b);b = ic(\"DIV\");c.appendChild(b);}a.c = a.g.render(b, a.a);}return a.c;}));};k.verify = function () {no(this);var a = this;return mo(this, this.render().then(function (b) {return new C(function (c) {var d = a.g.getResponse(b);if (d) c(d);else {var e = function e(f) {f && (lo(a, e), c(f));};a.l.push(e);a.i && a.g.execute(a.c);}});}));};k.reset = function () {no(this);null !== this.c && this.g.reset(this.c);};\n  function no(a) {if (a.A) throw new t(\"internal-error\", \"RecaptchaVerifier instance has been destroyed.\");}k.clear = function () {no(this);this.A = !0;this.v.c();for (var a = 0; a < this.h.length; a++) {this.h[a].cancel(\"RecaptchaVerifier instance has been destroyed.\");}if (!this.i) {a = fc(this.m);for (var b; b = a.firstChild;) {a.removeChild(b);}}};\n  function oo(a, b, c) {var d = !1;try {this.b = c || firebase.app();} catch (g) {throw new t(\"argument-error\", \"No firebase.app.App instance is currently initialized.\");}if (this.b.options && this.b.options.apiKey) c = this.b.options.apiKey;else throw new t(\"invalid-api-key\");var e = this,f = null;try {f = this.b.auth().Ga();} catch (g) {}try {d = this.b.auth().settings.appVerificationDisabledForTesting;} catch (g) {}f = firebase.SDK_VERSION ? Je(firebase.SDK_VERSION, f) : null;fo.call(this, c, a, b, function () {try {var g = e.b.auth().ka();} catch (h) {g =\n        null;}return g;}, f, Aa(Ba), d);}r(oo, fo);function po(a, b, c, d) {a: {c = Array.prototype.slice.call(c);var e = 0;for (var f = !1, g = 0; g < b.length; g++) {if (b[g].optional) f = !0;else {if (f) throw new t(\"internal-error\", \"Argument validator encountered a required argument after an optional argument.\");e++;}}f = b.length;if (c.length < e || f < c.length) d = \"Expected \" + (e == f ? 1 == e ? \"1 argument\" : e + \" arguments\" : e + \"-\" + f + \" arguments\") + \" but got \" + c.length + \".\";else {for (e = 0; e < c.length; e++) {if (f = b[e].optional && void 0 === c[e], !b[e].K(c[e]) && !f) {b = b[e];if (0 > e || e >= qo.length) throw new t(\"internal-error\",\n            \"Argument validator received an unsupported number of arguments.\");c = qo[e];d = (d ? \"\" : c + \" argument \") + (b.name ? '\"' + b.name + '\" ' : \"\") + \"must be \" + b.J + \".\";break a;}}d = null;}}if (d) throw new t(\"argument-error\", a + \" failed: \" + d);}var qo = \"First Second Third Fourth Fifth Sixth Seventh Eighth Ninth\".split(\" \");function V(a, b) {return { name: a || \"\", J: \"a valid string\", optional: !!b, K: function K(c) {return \"string\" === typeof c;} };}\n  function ro(a, b) {return { name: a || \"\", J: \"a boolean\", optional: !!b, K: function K(c) {return \"boolean\" === typeof c;} };}function W(a, b) {return { name: a || \"\", J: \"a valid object\", optional: !!b, K: n };}function so(a, b) {return { name: a || \"\", J: \"a function\", optional: !!b, K: function K(c) {return \"function\" === typeof c;} };}function to(a, b) {return { name: a || \"\", J: \"null\", optional: !!b, K: function K(c) {return null === c;} };}function uo() {return { name: \"\", J: \"an HTML element\", optional: !1, K: function K(a) {return !!(a && a instanceof Element);} };}\n  function vo() {return { name: \"auth\", J: \"an instance of Firebase Auth\", optional: !0, K: function K(a) {return !!(a && a instanceof zn);} };}function wo() {return { name: \"app\", J: \"an instance of Firebase App\", optional: !0, K: function K(a) {return !!(a && a instanceof firebase.app.App);} };}function xo(a) {return { name: a ? a + \"Credential\" : \"credential\", J: a ? \"a valid \" + a + \" credential\" : \"a valid credential\", optional: !1, K: function K(b) {if (!b) return !1;var c = !a || b.providerId === a;return !(!b.ja || !c);} };}\n  function yo() {return { name: \"multiFactorAssertion\", J: \"a valid multiFactorAssertion\", optional: !1, K: function K(a) {return a ? !!a.rb : !1;} };}function zo() {return { name: \"authProvider\", J: \"a valid Auth provider\", optional: !1, K: function K(a) {return !!(a && a.providerId && a.hasOwnProperty && a.hasOwnProperty(\"isOAuthProvider\"));} };}function Ao(a, b) {return n(a) && \"string\" === typeof a.type && a.type === b && \"function\" === typeof a.Ha;}function Bo(a) {return n(a) && \"string\" === typeof a.uid;}\n  function Co() {return { name: \"applicationVerifier\", J: \"an implementation of firebase.auth.ApplicationVerifier\", optional: !1, K: function K(a) {return !(!a || \"string\" !== typeof a.type || \"function\" !== typeof a.verify);} };}function X(a, b, c, d) {return { name: c || \"\", J: a.J + \" or \" + b.J, optional: !!d, K: function K(e) {return a.K(e) || b.K(e);} };};function Y(a, b) {for (var c in b) {var d = b[c].name;a[d] = Do(d, a[c], b[c].j);}}function Eo(a, b) {for (var c in b) {var d = b[c].name;d !== c && Object.defineProperty(a, d, { get: ta(function (e) {return this[e];}, c), set: ta(function (e, f, g, h) {po(e, [g], [h], !0);this[f] = h;}, d, c, b[c].jb), enumerable: !0 });}}function Z(a, b, c, d) {a[b] = Do(b, c, d);}\n  function Do(a, b, c) {function d() {var g = Array.prototype.slice.call(arguments);po(e, c, g);return b.apply(this, g);}if (!c) return b;var e = Fo(a),f;for (f in b) {d[f] = b[f];}for (f in b.prototype) {d.prototype[f] = b.prototype[f];}return d;}function Fo(a) {a = a.split(\".\");return a[a.length - 1];};Y(zn.prototype, { ib: { name: \"applyActionCode\", j: [V(\"code\")] }, Qa: { name: \"checkActionCode\", j: [V(\"code\")] }, mb: { name: \"confirmPasswordReset\", j: [V(\"code\"), V(\"newPassword\")] }, dc: { name: \"createUserWithEmailAndPassword\", j: [V(\"email\"), V(\"password\")] }, gc: { name: \"fetchSignInMethodsForEmail\", j: [V(\"email\")] }, qa: { name: \"getRedirectResult\", j: [] }, Ac: { name: \"isSignInWithEmailLink\", j: [V(\"emailLink\")] }, Gc: { name: \"onAuthStateChanged\", j: [X(W(), so(), \"nextOrObserver\"), so(\"opt_error\", !0), so(\"opt_completed\", !0)] }, Hc: { name: \"onIdTokenChanged\",\n      j: [X(W(), so(), \"nextOrObserver\"), so(\"opt_error\", !0), so(\"opt_completed\", !0)] }, ub: { name: \"sendPasswordResetEmail\", j: [V(\"email\"), X(W(\"opt_actionCodeSettings\", !0), to(null, !0), \"opt_actionCodeSettings\", !0)] }, vb: { name: \"sendSignInLinkToEmail\", j: [V(\"email\"), W(\"actionCodeSettings\")] }, wb: { name: \"setPersistence\", j: [V(\"persistence\")] }, Rc: { name: \"signInAndRetrieveDataWithCredential\", j: [xo()] }, yb: { name: \"signInAnonymously\", j: [] }, Za: { name: \"signInWithCredential\", j: [xo()] }, Sc: { name: \"signInWithCustomToken\", j: [V(\"token\")] },\n    Tc: { name: \"signInWithEmailAndPassword\", j: [V(\"email\"), V(\"password\")] }, Uc: { name: \"signInWithEmailLink\", j: [V(\"email\"), V(\"emailLink\", !0)] }, Vc: { name: \"signInWithPhoneNumber\", j: [V(\"phoneNumber\"), Co()] }, Wc: { name: \"signInWithPopup\", j: [zo()] }, Xc: { name: \"signInWithRedirect\", j: [zo()] }, cd: { name: \"updateCurrentUser\", j: [X(function (a) {return { name: \"user\", J: \"an instance of Firebase User\", optional: !!a, K: function K(b) {return !!(b && b instanceof Dm);} };}(), to(), \"user\")] }, zb: { name: \"signOut\", j: [] }, toJSON: { name: \"toJSON\", j: [V(null,\n      !0)] }, ed: { name: \"useDeviceLanguage\", j: [] }, fd: { name: \"useEmulator\", j: [V(\"url\")] }, hd: { name: \"verifyPasswordResetCode\", j: [V(\"code\")] } });Eo(zn.prototype, { lc: { name: \"languageCode\", jb: X(V(), to(), \"languageCode\") }, ti: { name: \"tenantId\", jb: X(V(), to(), \"tenantId\") } });zn.Persistence = Mk;zn.Persistence.LOCAL = \"local\";zn.Persistence.SESSION = \"session\";zn.Persistence.NONE = \"none\";\n  Y(Dm.prototype, { \"delete\": { name: \"delete\", j: [] }, nc: { name: \"getIdTokenResult\", j: [ro(\"opt_forceRefresh\", !0)] }, I: { name: \"getIdToken\", j: [ro(\"opt_forceRefresh\", !0)] }, Bc: { name: \"linkAndRetrieveDataWithCredential\", j: [xo()] }, pb: { name: \"linkWithCredential\", j: [xo()] }, Cc: { name: \"linkWithPhoneNumber\", j: [V(\"phoneNumber\"), Co()] }, Dc: { name: \"linkWithPopup\", j: [zo()] }, Ec: { name: \"linkWithRedirect\", j: [zo()] }, Kc: { name: \"reauthenticateAndRetrieveDataWithCredential\", j: [xo()] }, sb: { name: \"reauthenticateWithCredential\", j: [xo()] }, Lc: { name: \"reauthenticateWithPhoneNumber\",\n      j: [V(\"phoneNumber\"), Co()] }, Mc: { name: \"reauthenticateWithPopup\", j: [zo()] }, Nc: { name: \"reauthenticateWithRedirect\", j: [zo()] }, reload: { name: \"reload\", j: [] }, tb: { name: \"sendEmailVerification\", j: [X(W(\"opt_actionCodeSettings\", !0), to(null, !0), \"opt_actionCodeSettings\", !0)] }, toJSON: { name: \"toJSON\", j: [V(null, !0)] }, bd: { name: \"unlink\", j: [V(\"provider\")] }, Ab: { name: \"updateEmail\", j: [V(\"email\")] }, Bb: { name: \"updatePassword\", j: [V(\"password\")] }, dd: { name: \"updatePhoneNumber\", j: [xo(\"phone\")] }, Cb: { name: \"updateProfile\", j: [W(\"profile\")] },\n    Db: { name: \"verifyBeforeUpdateEmail\", j: [V(\"email\"), X(W(\"opt_actionCodeSettings\", !0), to(null, !0), \"opt_actionCodeSettings\", !0)] } });Y(Sn.prototype, { execute: { name: \"execute\" }, render: { name: \"render\" }, reset: { name: \"reset\" }, getResponse: { name: \"getResponse\" } });Y(Rn.prototype, { execute: { name: \"execute\" }, render: { name: \"render\" }, reset: { name: \"reset\" }, getResponse: { name: \"getResponse\" } });Y(C.prototype, { na: { name: \"finally\" }, s: { name: \"catch\" }, then: { name: \"then\" } });\n  Eo($l.prototype, { appVerificationDisabled: { name: \"appVerificationDisabledForTesting\", jb: ro(\"appVerificationDisabledForTesting\") } });Y(am.prototype, { confirm: { name: \"confirm\", j: [V(\"verificationCode\")] } });Z(xg, \"fromJSON\", function (a) {a = \"string\" === typeof a ? JSON.parse(a) : a;for (var b, c = [Ig, $g, gh, Fg], d = 0; d < c.length; d++) {if (b = c[d](a)) return b;}return null;}, [X(V(), W(), \"json\")]);Z(Vg, \"credential\", function (a, b) {return new Ug(a, b);}, [V(\"email\"), V(\"password\")]);Y(Ug.prototype, { w: { name: \"toJSON\", j: [V(null, !0)] } });\n  Y(Mg.prototype, { Ca: { name: \"addScope\", j: [V(\"scope\")] }, Ka: { name: \"setCustomParameters\", j: [W(\"customOAuthParameters\")] } });Z(Mg, \"credential\", Ng, [X(V(), W(), \"token\")]);Z(Vg, \"credentialWithLink\", ah, [V(\"email\"), V(\"emailLink\")]);Y(Og.prototype, { Ca: { name: \"addScope\", j: [V(\"scope\")] }, Ka: { name: \"setCustomParameters\", j: [W(\"customOAuthParameters\")] } });Z(Og, \"credential\", Pg, [X(V(), W(), \"token\")]);Y(Qg.prototype, { Ca: { name: \"addScope\", j: [V(\"scope\")] }, Ka: { name: \"setCustomParameters\", j: [W(\"customOAuthParameters\")] } });\n  Z(Qg, \"credential\", Rg, [X(V(), X(W(), to()), \"idToken\"), X(V(), to(), \"accessToken\", !0)]);Y(Sg.prototype, { Ka: { name: \"setCustomParameters\", j: [W(\"customOAuthParameters\")] } });Z(Sg, \"credential\", Tg, [X(V(), W(), \"token\"), V(\"secret\", !0)]);Y(Lg.prototype, { Ca: { name: \"addScope\", j: [V(\"scope\")] }, credential: { name: \"credential\", j: [X(V(), X(W(), to()), \"optionsOrIdToken\"), X(V(), to(), \"accessToken\", !0)] }, Ka: { name: \"setCustomParameters\", j: [W(\"customOAuthParameters\")] } });Y(Gg.prototype, { w: { name: \"toJSON\", j: [V(null, !0)] } });\n  Y(Ag.prototype, { w: { name: \"toJSON\", j: [V(null, !0)] } });Z(hh, \"credential\", lh, [V(\"verificationId\"), V(\"verificationCode\")]);\n  Y(hh.prototype, { eb: { name: \"verifyPhoneNumber\", j: [X(V(), function (a, b) {return { name: a || \"phoneInfoOptions\", J: \"valid phone info options\", optional: !!b, K: function K(c) {return c ? c.session && c.phoneNumber ? Ao(c.session, vg) && \"string\" === typeof c.phoneNumber : c.session && c.multiFactorHint ? Ao(c.session, wg) && Bo(c.multiFactorHint) : c.session && c.multiFactorUid ? Ao(c.session, wg) && \"string\" === typeof c.multiFactorUid : c.phoneNumber ? \"string\" === typeof c.phoneNumber : !1 : !1;} };}(), \"phoneInfoOptions\"), Co()] } });\n  Y(ch.prototype, { w: { name: \"toJSON\", j: [V(null, !0)] } });Y(t.prototype, { toJSON: { name: \"toJSON\", j: [V(null, !0)] } });Y(uh.prototype, { toJSON: { name: \"toJSON\", j: [V(null, !0)] } });Y(th.prototype, { toJSON: { name: \"toJSON\", j: [V(null, !0)] } });Y(gm.prototype, { toJSON: { name: \"toJSON\", j: [V(null, !0)] } });Y(dm.prototype, { Qc: { name: \"resolveSignIn\", j: [yo()] } });\n  Y(om.prototype, { Qb: { name: \"getSession\", j: [] }, ec: { name: \"enroll\", j: [yo(), V(\"displayName\", !0)] }, ad: { name: \"unenroll\", j: [X({ name: \"multiFactorInfo\", J: \"a valid multiFactorInfo\", optional: !1, K: Bo }, V(), \"multiFactorInfoIdentifier\")] } });Y(oo.prototype, { clear: { name: \"clear\", j: [] }, render: { name: \"render\", j: [] }, verify: { name: \"verify\", j: [] } });Z(Ff, \"parseLink\", Nf, [V(\"link\")]);Z(Yn, \"assertion\", function (a) {return new mm(a);}, [xo(\"phone\")]);\n  (function () {if (\"undefined\" !== typeof firebase && firebase.INTERNAL && firebase.INTERNAL.registerComponent) {var a = { ActionCodeInfo: { Operation: { EMAIL_SIGNIN: wf, PASSWORD_RESET: \"PASSWORD_RESET\", RECOVER_EMAIL: \"RECOVER_EMAIL\", REVERT_SECOND_FACTOR_ADDITION: yf, VERIFY_AND_CHANGE_EMAIL: xf, VERIFY_EMAIL: \"VERIFY_EMAIL\" } }, Auth: zn, AuthCredential: xg, Error: t };Z(a, \"EmailAuthProvider\", Vg, []);Z(a, \"FacebookAuthProvider\", Mg, []);Z(a, \"GithubAuthProvider\", Og, []);Z(a, \"GoogleAuthProvider\", Qg, []);Z(a, \"TwitterAuthProvider\", Sg, []);\n      Z(a, \"OAuthProvider\", Lg, [V(\"providerId\")]);Z(a, \"SAMLAuthProvider\", Kg, [V(\"providerId\")]);Z(a, \"PhoneAuthProvider\", hh, [vo()]);Z(a, \"RecaptchaVerifier\", oo, [X(V(), uo(), \"recaptchaContainer\"), W(\"recaptchaParameters\", !0), wo()]);Z(a, \"ActionCodeURL\", Ff, []);Z(a, \"PhoneMultiFactorGenerator\", Yn, []);firebase.INTERNAL.registerComponent({ name: \"auth\", instanceFactory: function instanceFactory(b) {b = b.getProvider(\"app\").getImmediate();return new zn(b);}, multipleInstances: !1, serviceProps: a, instantiationMode: \"LAZY\", type: \"PUBLIC\" });firebase.INTERNAL.registerComponent({ name: \"auth-internal\",\n        instanceFactory: function instanceFactory(b) {b = b.getProvider(\"auth\").getImmediate();return { getUid: q(b.getUid, b), getToken: q(b.mc, b), addAuthTokenListener: q(b.cc, b), removeAuthTokenListener: q(b.Oc, b) };}, multipleInstances: !1, instantiationMode: \"LAZY\", type: \"PRIVATE\" });firebase.registerVersion(\"@firebase/auth\", \"0.15.0\");firebase.INTERNAL.extendNamespace({ User: Dm });} else throw Error(\"Cannot find the firebase namespace; be sure to include firebase-app.js before this library.\");})();}).apply(typeof global !== 'undefined' ? global : typeof self !== 'undefined' ? self : typeof window !== 'undefined' ? window : {});\n\n//# sourceMappingURL=auth.js.map\n/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(14)))\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/@firebase/auth/dist/auth.js\n// module id = 19\n// module chunks = 0\n\n//# sourceURL=webpack:///./~/@firebase/auth/dist/auth.js?");

/***/ }),
/* 20 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("/* WEBPACK VAR INJECTION */(function(process) {var _typeof=typeof Symbol===\"function\"&&typeof Symbol.iterator===\"symbol\"?function(obj){return typeof obj;}:function(obj){return obj&&typeof Symbol===\"function\"&&obj.constructor===Symbol&&obj!==Symbol.prototype?\"symbol\":typeof obj;};\n\nObject.defineProperty(exports,'__esModule',{value:true});\n\nvar firebase=__webpack_require__(6);\nvar tslib=__webpack_require__(3);\nvar util=__webpack_require__(9);\nvar logger$1=__webpack_require__(11);\nvar component=__webpack_require__(8);\n\nfunction _interopDefaultLegacy(e){return e&&(typeof e==='undefined'?'undefined':_typeof(e))==='object'&&'default'in e?e:{'default':e};}\n\nvar firebase__default=/*#__PURE__*/_interopDefaultLegacy(firebase);\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n/**\r\n * Wraps a DOM Storage object and:\r\n * - automatically encode objects as JSON strings before storing them to allow us to store arbitrary types.\r\n * - prefixes names with \"firebase:\" to avoid collisions with app data.\r\n *\r\n * We automatically (see storage.js) create two such wrappers, one for sessionStorage,\r\n * and one for localStorage.\r\n *\r\n * @constructor\r\n */\nvar DOMStorageWrapper=/** @class */function(){\n/**\r\n     * @param {Storage} domStorage_ The underlying storage object (e.g. localStorage or sessionStorage)\r\n     */\nfunction DOMStorageWrapper(domStorage_){\nthis.domStorage_=domStorage_;\n// Use a prefix to avoid collisions with other stuff saved by the app.\nthis.prefix_='firebase:';\n}\n/**\r\n     * @param {string} key The key to save the value under\r\n     * @param {?Object} value The value being stored, or null to remove the key.\r\n     */\nDOMStorageWrapper.prototype.set=function(key,value){\nif(value==null){\nthis.domStorage_.removeItem(this.prefixedName_(key));\n}else\n{\nthis.domStorage_.setItem(this.prefixedName_(key),util.stringify(value));\n}\n};\n/**\r\n     * @param {string} key\r\n     * @return {*} The value that was stored under this key, or null\r\n     */\nDOMStorageWrapper.prototype.get=function(key){\nvar storedVal=this.domStorage_.getItem(this.prefixedName_(key));\nif(storedVal==null){\nreturn null;\n}else\n{\nreturn util.jsonEval(storedVal);\n}\n};\n/**\r\n     * @param {string} key\r\n     */\nDOMStorageWrapper.prototype.remove=function(key){\nthis.domStorage_.removeItem(this.prefixedName_(key));\n};\n/**\r\n     * @param {string} name\r\n     * @return {string}\r\n     */\nDOMStorageWrapper.prototype.prefixedName_=function(name){\nreturn this.prefix_+name;\n};\nDOMStorageWrapper.prototype.toString=function(){\nreturn this.domStorage_.toString();\n};\nreturn DOMStorageWrapper;\n}();\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n/**\r\n * An in-memory storage implementation that matches the API of DOMStorageWrapper\r\n * (TODO: create interface for both to implement).\r\n *\r\n * @constructor\r\n */\nvar MemoryStorage=/** @class */function(){\nfunction MemoryStorage(){\nthis.cache_={};\nthis.isInMemoryStorage=true;\n}\nMemoryStorage.prototype.set=function(key,value){\nif(value==null){\ndelete this.cache_[key];\n}else\n{\nthis.cache_[key]=value;\n}\n};\nMemoryStorage.prototype.get=function(key){\nif(util.contains(this.cache_,key)){\nreturn this.cache_[key];\n}\nreturn null;\n};\nMemoryStorage.prototype.remove=function(key){\ndelete this.cache_[key];\n};\nreturn MemoryStorage;\n}();\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n/**\r\n * Helper to create a DOMStorageWrapper or else fall back to MemoryStorage.\r\n * TODO: Once MemoryStorage and DOMStorageWrapper have a shared interface this method annotation should change\r\n * to reflect this type\r\n *\r\n * @param {string} domStorageName Name of the underlying storage object\r\n *   (e.g. 'localStorage' or 'sessionStorage').\r\n * @return {?} Turning off type information until a common interface is defined.\r\n */\nvar createStoragefor=function createStoragefor(domStorageName){\ntry{\n// NOTE: just accessing \"localStorage\" or \"window['localStorage']\" may throw a security exception,\n// so it must be inside the try/catch.\nif(typeof window!=='undefined'&&\ntypeof window[domStorageName]!=='undefined'){\n// Need to test cache. Just because it's here doesn't mean it works\nvar domStorage=window[domStorageName];\ndomStorage.setItem('firebase:sentinel','cache');\ndomStorage.removeItem('firebase:sentinel');\nreturn new DOMStorageWrapper(domStorage);\n}\n}\ncatch(e){}\n// Failed to create wrapper.  Just return in-memory storage.\n// TODO: log?\nreturn new MemoryStorage();\n};\n/** A storage object that lasts across sessions */\nvar PersistentStorage=createStoragefor('localStorage');\n/** A storage object that only lasts one session */\nvar SessionStorage=createStoragefor('sessionStorage');\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\nvar logClient=new logger$1.Logger('@firebase/database');\n/**\r\n * Returns a locally-unique ID (generated by just incrementing up from 0 each time its called).\r\n * @type {function(): number} Generated ID.\r\n */\nvar LUIDGenerator=function(){\nvar id=1;\nreturn function(){\nreturn id++;\n};\n}();\n/**\r\n * Sha1 hash of the input string\r\n * @param {!string} str The string to hash\r\n * @return {!string} The resulting hash\r\n */\nvar sha1=function sha1(str){\nvar utf8Bytes=util.stringToByteArray(str);\nvar sha1=new util.Sha1();\nsha1.update(utf8Bytes);\nvar sha1Bytes=sha1.digest();\nreturn util.base64.encodeByteArray(sha1Bytes);\n};\n/**\r\n * @param {...*} varArgs\r\n * @return {string}\r\n * @private\r\n */\nvar buildLogMessage_=function buildLogMessage_(){\nvar varArgs=[];\nfor(var _i=0;_i<arguments.length;_i++){\nvarArgs[_i]=arguments[_i];\n}\nvar message='';\nfor(var i=0;i<varArgs.length;i++){\nvar arg=varArgs[i];\nif(Array.isArray(arg)||\narg&&\n(typeof arg==='undefined'?'undefined':_typeof(arg))==='object'&&\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\ntypeof arg.length==='number'){\nmessage+=buildLogMessage_.apply(null,arg);\n}else\nif((typeof arg==='undefined'?'undefined':_typeof(arg))==='object'){\nmessage+=util.stringify(arg);\n}else\n{\nmessage+=arg;\n}\nmessage+=' ';\n}\nreturn message;\n};\n/**\r\n * Use this for all debug messages in Firebase.\r\n * @type {?function(string)}\r\n */\nvar logger=null;\n/**\r\n * Flag to check for log availability on first log message\r\n * @type {boolean}\r\n * @private\r\n */\nvar firstLog_=true;\n/**\r\n * The implementation of Firebase.enableLogging (defined here to break dependencies)\r\n * @param {boolean|?function(string)} logger_ A flag to turn on logging, or a custom logger\r\n * @param {boolean=} persistent Whether or not to persist logging settings across refreshes\r\n */\nvar enableLogging=function enableLogging(logger_,persistent){\nutil.assert(!persistent||logger_===true||logger_===false,\"Can't turn on custom loggers persistently.\");\nif(logger_===true){\nlogClient.logLevel=logger$1.LogLevel.VERBOSE;\nlogger=logClient.log.bind(logClient);\nif(persistent){\nSessionStorage.set('logging_enabled',true);\n}\n}else\nif(typeof logger_==='function'){\nlogger=logger_;\n}else\n{\nlogger=null;\nSessionStorage.remove('logging_enabled');\n}\n};\n/**\r\n *\r\n * @param {...(string|Arguments)} varArgs\r\n */\nvar log=function log(){\nvar varArgs=[];\nfor(var _i=0;_i<arguments.length;_i++){\nvarArgs[_i]=arguments[_i];\n}\nif(firstLog_===true){\nfirstLog_=false;\nif(logger===null&&SessionStorage.get('logging_enabled')===true){\nenableLogging(true);\n}\n}\nif(logger){\nvar message=buildLogMessage_.apply(null,varArgs);\nlogger(message);\n}\n};\n/**\r\n * @param {!string} prefix\r\n * @return {function(...[*])}\r\n */\nvar logWrapper=function logWrapper(prefix){\nreturn function(){\nvar varArgs=[];\nfor(var _i=0;_i<arguments.length;_i++){\nvarArgs[_i]=arguments[_i];\n}\nlog.apply(void 0,tslib.__spread([prefix],varArgs));\n};\n};\n/**\r\n * @param {...string} varArgs\r\n */\nvar error=function error(){\nvar varArgs=[];\nfor(var _i=0;_i<arguments.length;_i++){\nvarArgs[_i]=arguments[_i];\n}\nvar message='FIREBASE INTERNAL ERROR: '+buildLogMessage_.apply(void 0,tslib.__spread(varArgs));\nlogClient.error(message);\n};\n/**\r\n * @param {...string} varArgs\r\n */\nvar fatal=function fatal(){\nvar varArgs=[];\nfor(var _i=0;_i<arguments.length;_i++){\nvarArgs[_i]=arguments[_i];\n}\nvar message=\"FIREBASE FATAL ERROR: \"+buildLogMessage_.apply(void 0,tslib.__spread(varArgs));\nlogClient.error(message);\nthrow new Error(message);\n};\n/**\r\n * @param {...*} varArgs\r\n */\nvar warn=function warn(){\nvar varArgs=[];\nfor(var _i=0;_i<arguments.length;_i++){\nvarArgs[_i]=arguments[_i];\n}\nvar message='FIREBASE WARNING: '+buildLogMessage_.apply(void 0,tslib.__spread(varArgs));\nlogClient.warn(message);\n};\n/**\r\n * Logs a warning if the containing page uses https. Called when a call to new Firebase\r\n * does not use https.\r\n */\nvar warnIfPageIsSecure=function warnIfPageIsSecure(){\n// Be very careful accessing browser globals. Who knows what may or may not exist.\nif(typeof window!=='undefined'&&\nwindow.location&&\nwindow.location.protocol&&\nwindow.location.protocol.indexOf('https:')!==-1){\nwarn('Insecure Firebase access from a secure page. '+\n'Please use https in calls to new Firebase().');\n}\n};\n/**\r\n * Returns true if data is NaN, or +/- Infinity.\r\n * @param {*} data\r\n * @return {boolean}\r\n */\nvar isInvalidJSONNumber=function isInvalidJSONNumber(data){\nreturn typeof data==='number'&&(\ndata!==data||// NaN\ndata===Number.POSITIVE_INFINITY||\ndata===Number.NEGATIVE_INFINITY);\n};\n/**\r\n * @param {function()} fn\r\n */\nvar executeWhenDOMReady=function executeWhenDOMReady(fn){\nif(util.isNodeSdk()||document.readyState==='complete'){\nfn();\n}else\n{\n// Modeled after jQuery. Try DOMContentLoaded and onreadystatechange (which\n// fire before onload), but fall back to onload.\nvar called_1=false;\nvar wrappedFn_1=function wrappedFn_1(){\nif(!document.body){\nsetTimeout(wrappedFn_1,Math.floor(10));\nreturn;\n}\nif(!called_1){\ncalled_1=true;\nfn();\n}\n};\nif(document.addEventListener){\ndocument.addEventListener('DOMContentLoaded',wrappedFn_1,false);\n// fallback to onload.\nwindow.addEventListener('load',wrappedFn_1,false);\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\n}else\nif(document.attachEvent){\n// IE.\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\ndocument.attachEvent('onreadystatechange',function(){\nif(document.readyState==='complete'){\nwrappedFn_1();\n}\n});\n// fallback to onload.\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nwindow.attachEvent('onload',wrappedFn_1);\n// jQuery has an extra hack for IE that we could employ (based on\n// http://javascript.nwbox.com/IEContentLoaded/) But it looks really old.\n// I'm hoping we don't need it.\n}\n}\n};\n/**\r\n * Minimum key name. Invalid for actual data, used as a marker to sort before any valid names\r\n * @type {!string}\r\n */\nvar MIN_NAME='[MIN_NAME]';\n/**\r\n * Maximum key name. Invalid for actual data, used as a marker to sort above any valid names\r\n * @type {!string}\r\n */\nvar MAX_NAME='[MAX_NAME]';\n/**\r\n * Compares valid Firebase key names, plus min and max name\r\n * @param {!string} a\r\n * @param {!string} b\r\n * @return {!number}\r\n */\nvar nameCompare=function nameCompare(a,b){\nif(a===b){\nreturn 0;\n}else\nif(a===MIN_NAME||b===MAX_NAME){\nreturn-1;\n}else\nif(b===MIN_NAME||a===MAX_NAME){\nreturn 1;\n}else\n{\nvar aAsInt=tryParseInt(a),bAsInt=tryParseInt(b);\nif(aAsInt!==null){\nif(bAsInt!==null){\nreturn aAsInt-bAsInt===0?a.length-b.length:aAsInt-bAsInt;\n}else\n{\nreturn-1;\n}\n}else\nif(bAsInt!==null){\nreturn 1;\n}else\n{\nreturn a<b?-1:1;\n}\n}\n};\n/**\r\n * @param {!string} a\r\n * @param {!string} b\r\n * @return {!number} comparison result.\r\n */\nvar stringCompare=function stringCompare(a,b){\nif(a===b){\nreturn 0;\n}else\nif(a<b){\nreturn-1;\n}else\n{\nreturn 1;\n}\n};\n/**\r\n * @param {string} key\r\n * @param {Object} obj\r\n * @return {*}\r\n */\nvar requireKey=function requireKey(key,obj){\nif(obj&&key in obj){\nreturn obj[key];\n}else\n{\nthrow new Error('Missing required key ('+key+') in object: '+util.stringify(obj));\n}\n};\n/**\r\n * @param {*} obj\r\n * @return {string}\r\n */\nvar ObjectToUniqueKey=function ObjectToUniqueKey(obj){\nif((typeof obj==='undefined'?'undefined':_typeof(obj))!=='object'||obj===null){\nreturn util.stringify(obj);\n}\nvar keys=[];\n// eslint-disable-next-line guard-for-in\nfor(var k in obj){\nkeys.push(k);\n}\n// Export as json, but with the keys sorted.\nkeys.sort();\nvar key='{';\nfor(var i=0;i<keys.length;i++){\nif(i!==0){\nkey+=',';\n}\nkey+=util.stringify(keys[i]);\nkey+=':';\nkey+=ObjectToUniqueKey(obj[keys[i]]);\n}\nkey+='}';\nreturn key;\n};\n/**\r\n * Splits a string into a number of smaller segments of maximum size\r\n * @param {!string} str The string\r\n * @param {!number} segsize The maximum number of chars in the string.\r\n * @return {Array.<string>} The string, split into appropriately-sized chunks\r\n */\nvar splitStringBySize=function splitStringBySize(str,segsize){\nvar len=str.length;\nif(len<=segsize){\nreturn[str];\n}\nvar dataSegs=[];\nfor(var c=0;c<len;c+=segsize){\nif(c+segsize>len){\ndataSegs.push(str.substring(c,len));\n}else\n{\ndataSegs.push(str.substring(c,c+segsize));\n}\n}\nreturn dataSegs;\n};\n/**\r\n * Apply a function to each (key, value) pair in an object or\r\n * apply a function to each (index, value) pair in an array\r\n * @param obj The object or array to iterate over\r\n * @param fn The function to apply\r\n */\nfunction each(obj,fn){\nfor(var key in obj){\nif(obj.hasOwnProperty(key)){\nfn(key,obj[key]);\n}\n}\n}\n/**\r\n * Borrowed from http://hg.secondlife.com/llsd/src/tip/js/typedarray.js (MIT License)\r\n * I made one modification at the end and removed the NaN / Infinity\r\n * handling (since it seemed broken [caused an overflow] and we don't need it).  See MJL comments.\r\n * @param {!number} v A double\r\n * @return {string}\r\n */\nvar doubleToIEEE754String=function doubleToIEEE754String(v){\nutil.assert(!isInvalidJSONNumber(v),'Invalid JSON number');// MJL\nvar ebits=11,fbits=52;\nvar bias=(1<<ebits-1)-1;\nvar s,e,f,ln,i;\n// Compute sign, exponent, fraction\n// Skip NaN / Infinity handling --MJL.\nif(v===0){\ne=0;\nf=0;\ns=1/v===-Infinity?1:0;\n}else\n{\ns=v<0;\nv=Math.abs(v);\nif(v>=Math.pow(2,1-bias)){\n// Normalized\nln=Math.min(Math.floor(Math.log(v)/Math.LN2),bias);\ne=ln+bias;\nf=Math.round(v*Math.pow(2,fbits-ln)-Math.pow(2,fbits));\n}else\n{\n// Denormalized\ne=0;\nf=Math.round(v/Math.pow(2,1-bias-fbits));\n}\n}\n// Pack sign, exponent, fraction\nvar bits=[];\nfor(i=fbits;i;i-=1){\nbits.push(f%2?1:0);\nf=Math.floor(f/2);\n}\nfor(i=ebits;i;i-=1){\nbits.push(e%2?1:0);\ne=Math.floor(e/2);\n}\nbits.push(s?1:0);\nbits.reverse();\nvar str=bits.join('');\n// Return the data as a hex string. --MJL\nvar hexByteString='';\nfor(i=0;i<64;i+=8){\nvar hexByte=parseInt(str.substr(i,8),2).toString(16);\nif(hexByte.length===1){\nhexByte='0'+hexByte;\n}\nhexByteString=hexByteString+hexByte;\n}\nreturn hexByteString.toLowerCase();\n};\n/**\r\n * Used to detect if we're in a Chrome content script (which executes in an\r\n * isolated environment where long-polling doesn't work).\r\n * @return {boolean}\r\n */\nvar isChromeExtensionContentScript=function isChromeExtensionContentScript(){\nreturn!!((typeof window==='undefined'?'undefined':_typeof(window))==='object'&&\nwindow['chrome']&&\nwindow['chrome']['extension']&&\n!/^chrome/.test(window.location.href));\n};\n/**\r\n * Used to detect if we're in a Windows 8 Store app.\r\n * @return {boolean}\r\n */\nvar isWindowsStoreApp=function isWindowsStoreApp(){\n// Check for the presence of a couple WinRT globals\nreturn(typeof Windows==='undefined'?'undefined':_typeof(Windows))==='object'&&_typeof(Windows.UI)==='object';\n};\n/**\r\n * Converts a server error code to a Javascript Error\r\n * @param {!string} code\r\n * @param {!Query} query\r\n * @return {Error}\r\n */\nvar errorForServerCode=function errorForServerCode(code,query){\nvar reason='Unknown Error';\nif(code==='too_big'){\nreason=\n'The data requested exceeds the maximum size '+\n'that can be accessed with a single request.';\n}else\nif(code==='permission_denied'){\nreason=\"Client doesn't have permission to access the desired data.\";\n}else\nif(code==='unavailable'){\nreason='The service is unavailable';\n}\nvar error=new Error(code+' at '+query.path.toString()+': '+reason);\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nerror.code=code.toUpperCase();\nreturn error;\n};\n/**\r\n * Used to test for integer-looking strings\r\n * @type {RegExp}\r\n * @private\r\n */\nvar INTEGER_REGEXP_=new RegExp('^-?(0*)\\\\d{1,10}$');\n/**\r\n * If the string contains a 32-bit integer, return it.  Else return null.\r\n * @param {!string} str\r\n * @return {?number}\r\n */\nvar tryParseInt=function tryParseInt(str){\nif(INTEGER_REGEXP_.test(str)){\nvar intVal=Number(str);\nif(intVal>=-2147483648&&intVal<=2147483647){\nreturn intVal;\n}\n}\nreturn null;\n};\n/**\r\n * Helper to run some code but catch any exceptions and re-throw them later.\r\n * Useful for preventing user callbacks from breaking internal code.\r\n *\r\n * Re-throwing the exception from a setTimeout is a little evil, but it's very\r\n * convenient (we don't have to try to figure out when is a safe point to\r\n * re-throw it), and the behavior seems reasonable:\r\n *\r\n * * If you aren't pausing on exceptions, you get an error in the console with\r\n *   the correct stack trace.\r\n * * If you're pausing on all exceptions, the debugger will pause on your\r\n *   exception and then again when we rethrow it.\r\n * * If you're only pausing on uncaught exceptions, the debugger will only pause\r\n *   on us re-throwing it.\r\n *\r\n * @param {!function()} fn The code to guard.\r\n */\nvar exceptionGuard=function exceptionGuard(fn){\ntry{\nfn();\n}\ncatch(e){\n// Re-throw exception when it's safe.\nsetTimeout(function(){\n// It used to be that \"throw e\" would result in a good console error with\n// relevant context, but as of Chrome 39, you just get the firebase.js\n// file/line number where we re-throw it, which is useless. So we log\n// e.stack explicitly.\nvar stack=e.stack||'';\nwarn('Exception was thrown by user callback.',stack);\nthrow e;\n},Math.floor(0));\n}\n};\n/**\r\n * @return {boolean} true if we think we're currently being crawled.\r\n */\nvar beingCrawled=function beingCrawled(){\nvar userAgent=(typeof window==='undefined'?'undefined':_typeof(window))==='object'&&\nwindow['navigator']&&\nwindow['navigator']['userAgent']||\n'';\n// For now we whitelist the most popular crawlers.  We should refine this to be the set of crawlers we\n// believe to support JavaScript/AJAX rendering.\n// NOTE: Google Webmaster Tools doesn't really belong, but their \"This is how a visitor to your website\n// would have seen the page\" is flaky if we don't treat it as a crawler.\nreturn userAgent.search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0;\n};\n/**\r\n * Same as setTimeout() except on Node.JS it will /not/ prevent the process from exiting.\r\n *\r\n * It is removed with clearTimeout() as normal.\r\n *\r\n * @param {Function} fn Function to run.\r\n * @param {number} time Milliseconds to wait before running.\r\n * @return {number|Object} The setTimeout() return value.\r\n */\nvar setTimeoutNonBlocking=function setTimeoutNonBlocking(fn,time){\nvar timeout=setTimeout(fn,time);\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nif((typeof timeout==='undefined'?'undefined':_typeof(timeout))==='object'&&timeout['unref']){\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\ntimeout['unref']();\n}\nreturn timeout;\n};\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n/**\r\n * An immutable object representing a parsed path.  It's immutable so that you\r\n * can pass them around to other functions without worrying about them changing\r\n * it.\r\n */\nvar Path=/** @class */function(){\n/**\r\n     * @param {string|Array.<string>} pathOrString Path string to parse,\r\n     *      or another path, or the raw tokens array\r\n     * @param {number=} pieceNum\r\n     */\nfunction Path(pathOrString,pieceNum){\nif(pieceNum===void 0){\nthis.pieces_=pathOrString.split('/');\n// Remove empty pieces.\nvar copyTo=0;\nfor(var i=0;i<this.pieces_.length;i++){\nif(this.pieces_[i].length>0){\nthis.pieces_[copyTo]=this.pieces_[i];\ncopyTo++;\n}\n}\nthis.pieces_.length=copyTo;\nthis.pieceNum_=0;\n}else\n{\nthis.pieces_=pathOrString;\nthis.pieceNum_=pieceNum;\n}\n}\nObject.defineProperty(Path,\"Empty\",{\n/**\r\n         * Singleton to represent an empty path\r\n         *\r\n         * @const\r\n         */\nget:function get(){\nreturn new Path('');\n},\nenumerable:false,\nconfigurable:true});\n\nPath.prototype.getFront=function(){\nif(this.pieceNum_>=this.pieces_.length){\nreturn null;\n}\nreturn this.pieces_[this.pieceNum_];\n};\n/**\r\n     * @return {number} The number of segments in this path\r\n     */\nPath.prototype.getLength=function(){\nreturn this.pieces_.length-this.pieceNum_;\n};\n/**\r\n     * @return {!Path}\r\n     */\nPath.prototype.popFront=function(){\nvar pieceNum=this.pieceNum_;\nif(pieceNum<this.pieces_.length){\npieceNum++;\n}\nreturn new Path(this.pieces_,pieceNum);\n};\n/**\r\n     * @return {?string}\r\n     */\nPath.prototype.getBack=function(){\nif(this.pieceNum_<this.pieces_.length){\nreturn this.pieces_[this.pieces_.length-1];\n}\nreturn null;\n};\nPath.prototype.toString=function(){\nvar pathString='';\nfor(var i=this.pieceNum_;i<this.pieces_.length;i++){\nif(this.pieces_[i]!==''){\npathString+='/'+this.pieces_[i];\n}\n}\nreturn pathString||'/';\n};\nPath.prototype.toUrlEncodedString=function(){\nvar pathString='';\nfor(var i=this.pieceNum_;i<this.pieces_.length;i++){\nif(this.pieces_[i]!==''){\npathString+='/'+encodeURIComponent(String(this.pieces_[i]));\n}\n}\nreturn pathString||'/';\n};\n/**\r\n     * Shallow copy of the parts of the path.\r\n     *\r\n     * @param {number=} begin\r\n     * @return {!Array<string>}\r\n     */\nPath.prototype.slice=function(begin){\nif(begin===void 0){begin=0;}\nreturn this.pieces_.slice(this.pieceNum_+begin);\n};\n/**\r\n     * @return {?Path}\r\n     */\nPath.prototype.parent=function(){\nif(this.pieceNum_>=this.pieces_.length){\nreturn null;\n}\nvar pieces=[];\nfor(var i=this.pieceNum_;i<this.pieces_.length-1;i++){\npieces.push(this.pieces_[i]);\n}\nreturn new Path(pieces,0);\n};\n/**\r\n     * @param {string|!Path} childPathObj\r\n     * @return {!Path}\r\n     */\nPath.prototype.child=function(childPathObj){\nvar pieces=[];\nfor(var i=this.pieceNum_;i<this.pieces_.length;i++){\npieces.push(this.pieces_[i]);\n}\nif(childPathObj instanceof Path){\nfor(var i=childPathObj.pieceNum_;i<childPathObj.pieces_.length;i++){\npieces.push(childPathObj.pieces_[i]);\n}\n}else\n{\nvar childPieces=childPathObj.split('/');\nfor(var i=0;i<childPieces.length;i++){\nif(childPieces[i].length>0){\npieces.push(childPieces[i]);\n}\n}\n}\nreturn new Path(pieces,0);\n};\n/**\r\n     * @return {boolean} True if there are no segments in this path\r\n     */\nPath.prototype.isEmpty=function(){\nreturn this.pieceNum_>=this.pieces_.length;\n};\n/**\r\n     * @param {!Path} outerPath\r\n     * @param {!Path} innerPath\r\n     * @return {!Path} The path from outerPath to innerPath\r\n     */\nPath.relativePath=function(outerPath,innerPath){\nvar outer=outerPath.getFront(),inner=innerPath.getFront();\nif(outer===null){\nreturn innerPath;\n}else\nif(outer===inner){\nreturn Path.relativePath(outerPath.popFront(),innerPath.popFront());\n}else\n{\nthrow new Error('INTERNAL ERROR: innerPath ('+\ninnerPath+\n') is not within '+\n'outerPath ('+\nouterPath+\n')');\n}\n};\n/**\r\n     * @param {!Path} left\r\n     * @param {!Path} right\r\n     * @return {number} -1, 0, 1 if left is less, equal, or greater than the right.\r\n     */\nPath.comparePaths=function(left,right){\nvar leftKeys=left.slice();\nvar rightKeys=right.slice();\nfor(var i=0;i<leftKeys.length&&i<rightKeys.length;i++){\nvar cmp=nameCompare(leftKeys[i],rightKeys[i]);\nif(cmp!==0){\nreturn cmp;\n}\n}\nif(leftKeys.length===rightKeys.length){\nreturn 0;\n}\nreturn leftKeys.length<rightKeys.length?-1:1;\n};\n/**\r\n     *\r\n     * @param {Path} other\r\n     * @return {boolean} true if paths are the same.\r\n     */\nPath.prototype.equals=function(other){\nif(this.getLength()!==other.getLength()){\nreturn false;\n}\nfor(var i=this.pieceNum_,j=other.pieceNum_;i<=this.pieces_.length;i++,j++){\nif(this.pieces_[i]!==other.pieces_[j]){\nreturn false;\n}\n}\nreturn true;\n};\n/**\r\n     *\r\n     * @param {!Path} other\r\n     * @return {boolean} True if this path is a parent (or the same as) other\r\n     */\nPath.prototype.contains=function(other){\nvar i=this.pieceNum_;\nvar j=other.pieceNum_;\nif(this.getLength()>other.getLength()){\nreturn false;\n}\nwhile(i<this.pieces_.length){\nif(this.pieces_[i]!==other.pieces_[j]){\nreturn false;\n}\n++i;\n++j;\n}\nreturn true;\n};\nreturn Path;\n}();// end Path\n/**\r\n * Dynamic (mutable) path used to count path lengths.\r\n *\r\n * This class is used to efficiently check paths for valid\r\n * length (in UTF8 bytes) and depth (used in path validation).\r\n *\r\n * Throws Error exception if path is ever invalid.\r\n *\r\n * The definition of a path always begins with '/'.\r\n */\nvar ValidationPath=/** @class */function(){\n/**\r\n     * @param {!Path} path Initial Path.\r\n     * @param {string} errorPrefix_ Prefix for any error messages.\r\n     */\nfunction ValidationPath(path,errorPrefix_){\nthis.errorPrefix_=errorPrefix_;\n/** @type {!Array<string>} */\nthis.parts_=path.slice();\n/** @type {number} Initialize to number of '/' chars needed in path. */\nthis.byteLength_=Math.max(1,this.parts_.length);\nfor(var i=0;i<this.parts_.length;i++){\nthis.byteLength_+=util.stringLength(this.parts_[i]);\n}\nthis.checkValid_();\n}\nObject.defineProperty(ValidationPath,\"MAX_PATH_DEPTH\",{\n/** @const {number} Maximum key depth. */\nget:function get(){\nreturn 32;\n},\nenumerable:false,\nconfigurable:true});\n\nObject.defineProperty(ValidationPath,\"MAX_PATH_LENGTH_BYTES\",{\n/** @const {number} Maximum number of (UTF8) bytes in a Firebase path. */\nget:function get(){\nreturn 768;\n},\nenumerable:false,\nconfigurable:true});\n\n/** @param {string} child */\nValidationPath.prototype.push=function(child){\n// Count the needed '/'\nif(this.parts_.length>0){\nthis.byteLength_+=1;\n}\nthis.parts_.push(child);\nthis.byteLength_+=util.stringLength(child);\nthis.checkValid_();\n};\nValidationPath.prototype.pop=function(){\nvar last=this.parts_.pop();\nthis.byteLength_-=util.stringLength(last);\n// Un-count the previous '/'\nif(this.parts_.length>0){\nthis.byteLength_-=1;\n}\n};\nValidationPath.prototype.checkValid_=function(){\nif(this.byteLength_>ValidationPath.MAX_PATH_LENGTH_BYTES){\nthrow new Error(this.errorPrefix_+\n'has a key path longer than '+\nValidationPath.MAX_PATH_LENGTH_BYTES+\n' bytes ('+\nthis.byteLength_+\n').');\n}\nif(this.parts_.length>ValidationPath.MAX_PATH_DEPTH){\nthrow new Error(this.errorPrefix_+\n'path specified exceeds the maximum depth that can be written ('+\nValidationPath.MAX_PATH_DEPTH+\n') or object contains a cycle '+\nthis.toErrorString());\n}\n};\n/**\r\n     * String for use in error messages - uses '.' notation for path.\r\n     *\r\n     * @return {string}\r\n     */\nValidationPath.prototype.toErrorString=function(){\nif(this.parts_.length===0){\nreturn'';\n}\nreturn\"in property '\"+this.parts_.join('.')+\"'\";\n};\nreturn ValidationPath;\n}();\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\nvar PROTOCOL_VERSION='5';\nvar VERSION_PARAM='v';\nvar TRANSPORT_SESSION_PARAM='s';\nvar REFERER_PARAM='r';\nvar FORGE_REF='f';\nvar FORGE_DOMAIN='firebaseio.com';\nvar LAST_SESSION_PARAM='ls';\nvar APPLICATION_ID_PARAM='p';\nvar WEBSOCKET='websocket';\nvar LONG_POLLING='long_polling';\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n/**\r\n * A class that holds metadata about a Repo object\r\n *\r\n * @constructor\r\n */\nvar RepoInfo=/** @class */function(){\n/**\r\n     * @param host Hostname portion of the url for the repo\r\n     * @param secure Whether or not this repo is accessed over ssl\r\n     * @param namespace The namespace represented by the repo\r\n     * @param webSocketOnly Whether to prefer websockets over all other transports (used by Nest).\r\n     * @param nodeAdmin Whether this instance uses Admin SDK credentials\r\n     * @param persistenceKey Override the default session persistence storage key\r\n     */\nfunction RepoInfo(host,secure,namespace,webSocketOnly,nodeAdmin,persistenceKey,includeNamespaceInQueryParams){\nif(nodeAdmin===void 0){nodeAdmin=false;}\nif(persistenceKey===void 0){persistenceKey='';}\nif(includeNamespaceInQueryParams===void 0){includeNamespaceInQueryParams=false;}\nthis.secure=secure;\nthis.namespace=namespace;\nthis.webSocketOnly=webSocketOnly;\nthis.nodeAdmin=nodeAdmin;\nthis.persistenceKey=persistenceKey;\nthis.includeNamespaceInQueryParams=includeNamespaceInQueryParams;\nthis.host=host.toLowerCase();\nthis.domain=this.host.substr(this.host.indexOf('.')+1);\nthis.internalHost=\nPersistentStorage.get('host:'+host)||this.host;\n}\nRepoInfo.prototype.needsQueryParam=function(){\nreturn this.host!==this.internalHost||\nthis.isCustomHost()||\nthis.includeNamespaceInQueryParams;\n};\nRepoInfo.prototype.isCacheableHost=function(){\nreturn this.internalHost.substr(0,2)==='s-';\n};\nRepoInfo.prototype.isDemoHost=function(){\nreturn this.domain==='firebaseio-demo.com';\n};\nRepoInfo.prototype.isCustomHost=function(){\nreturn this.domain!=='firebaseio.com'&&this.domain!=='firebaseio-demo.com';\n};\nRepoInfo.prototype.updateHost=function(newHost){\nif(newHost!==this.internalHost){\nthis.internalHost=newHost;\nif(this.isCacheableHost()){\nPersistentStorage.set('host:'+this.host,this.internalHost);\n}\n}\n};\n/**\r\n     * Returns the websocket URL for this repo\r\n     * @param {string} type of connection\r\n     * @param {Object} params list\r\n     * @return {string} The URL for this repo\r\n     */\nRepoInfo.prototype.connectionURL=function(type,params){\nutil.assert(typeof type==='string','typeof type must == string');\nutil.assert((typeof params==='undefined'?'undefined':_typeof(params))==='object','typeof params must == object');\nvar connURL;\nif(type===WEBSOCKET){\nconnURL=\n(this.secure?'wss://':'ws://')+this.internalHost+'/.ws?';\n}else\nif(type===LONG_POLLING){\nconnURL=\n(this.secure?'https://':'http://')+this.internalHost+'/.lp?';\n}else\n{\nthrow new Error('Unknown connection type: '+type);\n}\nif(this.needsQueryParam()){\nparams['ns']=this.namespace;\n}\nvar pairs=[];\neach(params,function(key,value){\npairs.push(key+'='+value);\n});\nreturn connURL+pairs.join('&');\n};\n/** @return {string} */\nRepoInfo.prototype.toString=function(){\nvar str=this.toURLString();\nif(this.persistenceKey){\nstr+='<'+this.persistenceKey+'>';\n}\nreturn str;\n};\n/** @return {string} */\nRepoInfo.prototype.toURLString=function(){\nreturn(this.secure?'https://':'http://')+this.host;\n};\nreturn RepoInfo;\n}();\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n/**\r\n * @param {!string} pathString\r\n * @return {string}\r\n */\nfunction decodePath(pathString){\nvar pathStringDecoded='';\nvar pieces=pathString.split('/');\nfor(var i=0;i<pieces.length;i++){\nif(pieces[i].length>0){\nvar piece=pieces[i];\ntry{\npiece=decodeURIComponent(piece.replace(/\\+/g,' '));\n}\ncatch(e){}\npathStringDecoded+='/'+piece;\n}\n}\nreturn pathStringDecoded;\n}\n/**\r\n * @param {!string} queryString\r\n * @return {!{[key:string]:string}} key value hash\r\n */\nfunction decodeQuery(queryString){\nvar e_1,_a;\nvar results={};\nif(queryString.charAt(0)==='?'){\nqueryString=queryString.substring(1);\n}\ntry{\nfor(var _b=tslib.__values(queryString.split('&')),_c=_b.next();!_c.done;_c=_b.next()){\nvar segment=_c.value;\nif(segment.length===0){\ncontinue;\n}\nvar kv=segment.split('=');\nif(kv.length===2){\nresults[decodeURIComponent(kv[0])]=decodeURIComponent(kv[1]);\n}else\n{\nwarn(\"Invalid query segment '\"+segment+\"' in query '\"+queryString+\"'\");\n}\n}\n}\ncatch(e_1_1){e_1={error:e_1_1};}finally\n{\ntry{\nif(_c&&!_c.done&&(_a=_b.return))_a.call(_b);\n}finally\n{if(e_1)throw e_1.error;}\n}\nreturn results;\n}\nvar parseRepoInfo=function parseRepoInfo(dataURL,nodeAdmin){\nvar parsedUrl=parseDatabaseURL(dataURL),namespace=parsedUrl.namespace;\nif(parsedUrl.domain==='firebase.com'){\nfatal(parsedUrl.host+\n' is no longer supported. '+\n'Please use <YOUR FIREBASE>.firebaseio.com instead');\n}\n// Catch common error of uninitialized namespace value.\nif((!namespace||namespace==='undefined')&&\nparsedUrl.domain!=='localhost'){\nfatal('Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com');\n}\nif(!parsedUrl.secure){\nwarnIfPageIsSecure();\n}\nvar webSocketOnly=parsedUrl.scheme==='ws'||parsedUrl.scheme==='wss';\nreturn{\nrepoInfo:new RepoInfo(parsedUrl.host,parsedUrl.secure,namespace,nodeAdmin,webSocketOnly,\n/*persistenceKey=*/'',\n/*includeNamespaceInQueryParams=*/namespace!==parsedUrl.subdomain),\npath:new Path(parsedUrl.pathString)};\n\n};\n/**\r\n *\r\n * @param {!string} dataURL\r\n * @return {{host: string, port: number, domain: string, subdomain: string, secure: boolean, scheme: string, pathString: string, namespace: string}}\r\n */\nvar parseDatabaseURL=function parseDatabaseURL(dataURL){\n// Default to empty strings in the event of a malformed string.\nvar host='',domain='',subdomain='',pathString='',namespace='';\n// Always default to SSL, unless otherwise specified.\nvar secure=true,scheme='https',port=443;\n// Don't do any validation here. The caller is responsible for validating the result of parsing.\nif(typeof dataURL==='string'){\n// Parse scheme.\nvar colonInd=dataURL.indexOf('//');\nif(colonInd>=0){\nscheme=dataURL.substring(0,colonInd-1);\ndataURL=dataURL.substring(colonInd+2);\n}\n// Parse host, path, and query string.\nvar slashInd=dataURL.indexOf('/');\nif(slashInd===-1){\nslashInd=dataURL.length;\n}\nvar questionMarkInd=dataURL.indexOf('?');\nif(questionMarkInd===-1){\nquestionMarkInd=dataURL.length;\n}\nhost=dataURL.substring(0,Math.min(slashInd,questionMarkInd));\nif(slashInd<questionMarkInd){\n// For pathString, questionMarkInd will always come after slashInd\npathString=decodePath(dataURL.substring(slashInd,questionMarkInd));\n}\nvar queryParams=decodeQuery(dataURL.substring(Math.min(dataURL.length,questionMarkInd)));\n// If we have a port, use scheme for determining if it's secure.\ncolonInd=host.indexOf(':');\nif(colonInd>=0){\nsecure=scheme==='https'||scheme==='wss';\nport=parseInt(host.substring(colonInd+1),10);\n}else\n{\ncolonInd=host.length;\n}\nvar hostWithoutPort=host.slice(0,colonInd);\nif(hostWithoutPort.toLowerCase()==='localhost'){\ndomain='localhost';\n}else\nif(hostWithoutPort.split('.').length<=2){\ndomain=hostWithoutPort;\n}else\n{\n// Interpret the subdomain of a 3 or more component URL as the namespace name.\nvar dotInd=host.indexOf('.');\nsubdomain=host.substring(0,dotInd).toLowerCase();\ndomain=host.substring(dotInd+1);\n// Normalize namespaces to lowercase to share storage / connection.\nnamespace=subdomain;\n}\n// Always treat the value of the `ns` as the namespace name if it is present.\nif('ns'in queryParams){\nnamespace=queryParams['ns'];\n}\n}\nreturn{\nhost:host,\nport:port,\ndomain:domain,\nsubdomain:subdomain,\nsecure:secure,\nscheme:scheme,\npathString:pathString,\nnamespace:namespace};\n\n};\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n/**\r\n * True for invalid Firebase keys\r\n * @type {RegExp}\r\n * @private\r\n */\nvar INVALID_KEY_REGEX_=/[\\[\\].#$\\/\\u0000-\\u001F\\u007F]/;\n/**\r\n * True for invalid Firebase paths.\r\n * Allows '/' in paths.\r\n * @type {RegExp}\r\n * @private\r\n */\nvar INVALID_PATH_REGEX_=/[\\[\\].#$\\u0000-\\u001F\\u007F]/;\n/**\r\n * Maximum number of characters to allow in leaf value\r\n * @type {number}\r\n * @private\r\n */\nvar MAX_LEAF_SIZE_=10*1024*1024;\n/**\r\n * @param {*} key\r\n * @return {boolean}\r\n */\nvar isValidKey=function isValidKey(key){\nreturn typeof key==='string'&&key.length!==0&&!INVALID_KEY_REGEX_.test(key);\n};\n/**\r\n * @param {string} pathString\r\n * @return {boolean}\r\n */\nvar isValidPathString=function isValidPathString(pathString){\nreturn typeof pathString==='string'&&\npathString.length!==0&&\n!INVALID_PATH_REGEX_.test(pathString);\n};\n/**\r\n * @param {string} pathString\r\n * @return {boolean}\r\n */\nvar isValidRootPathString=function isValidRootPathString(pathString){\nif(pathString){\n// Allow '/.info/' at the beginning.\npathString=pathString.replace(/^\\/*\\.info(\\/|$)/,'/');\n}\nreturn isValidPathString(pathString);\n};\n/**\r\n * @param {*} priority\r\n * @return {boolean}\r\n */\nvar isValidPriority=function isValidPriority(priority){\nreturn priority===null||\ntypeof priority==='string'||\ntypeof priority==='number'&&!isInvalidJSONNumber(priority)||\npriority&&\n(typeof priority==='undefined'?'undefined':_typeof(priority))==='object'&&\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nutil.contains(priority,'.sv');\n};\n/**\r\n * Pre-validate a datum passed as an argument to Firebase function.\r\n *\r\n * @param {string} fnName\r\n * @param {number} argumentNumber\r\n * @param {*} data\r\n * @param {!Path} path\r\n * @param {boolean} optional\r\n */\nvar validateFirebaseDataArg=function validateFirebaseDataArg(fnName,argumentNumber,data,path,optional){\nif(optional&&data===undefined){\nreturn;\n}\nvalidateFirebaseData(util.errorPrefix(fnName,argumentNumber,optional),data,path);\n};\n/**\r\n * Validate a data object client-side before sending to server.\r\n *\r\n * @param {string} errorPrefix\r\n * @param {*} data\r\n * @param {!Path|!ValidationPath} path_\r\n */\nvar validateFirebaseData=function validateFirebaseData(errorPrefix,data,path_){\nvar path=path_ instanceof Path?new ValidationPath(path_,errorPrefix):path_;\nif(data===undefined){\nthrow new Error(errorPrefix+'contains undefined '+path.toErrorString());\n}\nif(typeof data==='function'){\nthrow new Error(errorPrefix+\n'contains a function '+\npath.toErrorString()+\n' with contents = '+\ndata.toString());\n}\nif(isInvalidJSONNumber(data)){\nthrow new Error(errorPrefix+'contains '+data.toString()+' '+path.toErrorString());\n}\n// Check max leaf size, but try to avoid the utf8 conversion if we can.\nif(typeof data==='string'&&\ndata.length>MAX_LEAF_SIZE_/3&&\nutil.stringLength(data)>MAX_LEAF_SIZE_){\nthrow new Error(errorPrefix+\n'contains a string greater than '+\nMAX_LEAF_SIZE_+\n' utf8 bytes '+\npath.toErrorString()+\n\" ('\"+\ndata.substring(0,50)+\n\"...')\");\n}\n// TODO = Perf = Consider combining the recursive validation of keys into NodeFromJSON\n// to save extra walking of large objects.\nif(data&&(typeof data==='undefined'?'undefined':_typeof(data))==='object'){\nvar hasDotValue_1=false;\nvar hasActualChild_1=false;\neach(data,function(key,value){\nif(key==='.value'){\nhasDotValue_1=true;\n}else\nif(key!=='.priority'&&key!=='.sv'){\nhasActualChild_1=true;\nif(!isValidKey(key)){\nthrow new Error(errorPrefix+\n' contains an invalid key ('+\nkey+\n') '+\npath.toErrorString()+\n'.  Keys must be non-empty strings '+\n'and can\\'t contain \".\", \"#\", \"$\", \"/\", \"[\", or \"]\"');\n}\n}\npath.push(key);\nvalidateFirebaseData(errorPrefix,value,path);\npath.pop();\n});\nif(hasDotValue_1&&hasActualChild_1){\nthrow new Error(errorPrefix+\n' contains \".value\" child '+\npath.toErrorString()+\n' in addition to actual children.');\n}\n}\n};\n/**\r\n * Pre-validate paths passed in the firebase function.\r\n *\r\n * @param {string} errorPrefix\r\n * @param {Array<!Path>} mergePaths\r\n */\nvar validateFirebaseMergePaths=function validateFirebaseMergePaths(errorPrefix,mergePaths){\nvar i,curPath;\nfor(i=0;i<mergePaths.length;i++){\ncurPath=mergePaths[i];\nvar keys=curPath.slice();\nfor(var j=0;j<keys.length;j++){\nif(keys[j]==='.priority'&&j===keys.length-1);else\nif(!isValidKey(keys[j])){\nthrow new Error(errorPrefix+\n'contains an invalid key ('+\nkeys[j]+\n') in path '+\ncurPath.toString()+\n'. Keys must be non-empty strings '+\n'and can\\'t contain \".\", \"#\", \"$\", \"/\", \"[\", or \"]\"');\n}\n}\n}\n// Check that update keys are not descendants of each other.\n// We rely on the property that sorting guarantees that ancestors come\n// right before descendants.\nmergePaths.sort(Path.comparePaths);\nvar prevPath=null;\nfor(i=0;i<mergePaths.length;i++){\ncurPath=mergePaths[i];\nif(prevPath!==null&&prevPath.contains(curPath)){\nthrow new Error(errorPrefix+\n'contains a path '+\nprevPath.toString()+\n' that is ancestor of another path '+\ncurPath.toString());\n}\nprevPath=curPath;\n}\n};\n/**\r\n * pre-validate an object passed as an argument to firebase function (\r\n * must be an object - e.g. for firebase.update()).\r\n *\r\n * @param {string} fnName\r\n * @param {number} argumentNumber\r\n * @param {*} data\r\n * @param {!Path} path\r\n * @param {boolean} optional\r\n */\nvar validateFirebaseMergeDataArg=function validateFirebaseMergeDataArg(fnName,argumentNumber,data,path,optional){\nif(optional&&data===undefined){\nreturn;\n}\nvar errorPrefix=util.errorPrefix(fnName,argumentNumber,optional);\nif(!(data&&(typeof data==='undefined'?'undefined':_typeof(data))==='object')||Array.isArray(data)){\nthrow new Error(errorPrefix+' must be an object containing the children to replace.');\n}\nvar mergePaths=[];\neach(data,function(key,value){\nvar curPath=new Path(key);\nvalidateFirebaseData(errorPrefix,value,path.child(curPath));\nif(curPath.getBack()==='.priority'){\nif(!isValidPriority(value)){\nthrow new Error(errorPrefix+\n\"contains an invalid value for '\"+\ncurPath.toString()+\n\"', which must be a valid \"+\n'Firebase priority (a string, finite number, server value, or null).');\n}\n}\nmergePaths.push(curPath);\n});\nvalidateFirebaseMergePaths(errorPrefix,mergePaths);\n};\nvar validatePriority=function validatePriority(fnName,argumentNumber,priority,optional){\nif(optional&&priority===undefined){\nreturn;\n}\nif(isInvalidJSONNumber(priority)){\nthrow new Error(util.errorPrefix(fnName,argumentNumber,optional)+\n'is '+\npriority.toString()+\n', but must be a valid Firebase priority (a string, finite number, '+\n'server value, or null).');\n}\n// Special case to allow importing data with a .sv.\nif(!isValidPriority(priority)){\nthrow new Error(util.errorPrefix(fnName,argumentNumber,optional)+\n'must be a valid Firebase priority '+\n'(a string, finite number, server value, or null).');\n}\n};\nvar validateEventType=function validateEventType(fnName,argumentNumber,eventType,optional){\nif(optional&&eventType===undefined){\nreturn;\n}\nswitch(eventType){\ncase'value':\ncase'child_added':\ncase'child_removed':\ncase'child_changed':\ncase'child_moved':\nbreak;\ndefault:\nthrow new Error(util.errorPrefix(fnName,argumentNumber,optional)+\n'must be a valid event type = \"value\", \"child_added\", \"child_removed\", '+\n'\"child_changed\", or \"child_moved\".');}\n\n};\nvar validateKey=function validateKey(fnName,argumentNumber,key,optional){\nif(optional&&key===undefined){\nreturn;\n}\nif(!isValidKey(key)){\nthrow new Error(util.errorPrefix(fnName,argumentNumber,optional)+\n'was an invalid key = \"'+\nkey+\n'\".  Firebase keys must be non-empty strings and '+\n'can\\'t contain \".\", \"#\", \"$\", \"/\", \"[\", or \"]\").');\n}\n};\nvar validatePathString=function validatePathString(fnName,argumentNumber,pathString,optional){\nif(optional&&pathString===undefined){\nreturn;\n}\nif(!isValidPathString(pathString)){\nthrow new Error(util.errorPrefix(fnName,argumentNumber,optional)+\n'was an invalid path = \"'+\npathString+\n'\". Paths must be non-empty strings and '+\n'can\\'t contain \".\", \"#\", \"$\", \"[\", or \"]\"');\n}\n};\nvar validateRootPathString=function validateRootPathString(fnName,argumentNumber,pathString,optional){\nif(pathString){\n// Allow '/.info/' at the beginning.\npathString=pathString.replace(/^\\/*\\.info(\\/|$)/,'/');\n}\nvalidatePathString(fnName,argumentNumber,pathString,optional);\n};\nvar validateWritablePath=function validateWritablePath(fnName,path){\nif(path.getFront()==='.info'){\nthrow new Error(fnName+\" failed = Can't modify data under /.info/\");\n}\n};\nvar validateUrl=function validateUrl(fnName,argumentNumber,parsedUrl){\n// TODO = Validate server better.\nvar pathString=parsedUrl.path.toString();\nif(!(typeof parsedUrl.repoInfo.host==='string')||\nparsedUrl.repoInfo.host.length===0||\n!isValidKey(parsedUrl.repoInfo.namespace)&&\nparsedUrl.repoInfo.host.split(':')[0]!=='localhost'||\npathString.length!==0&&!isValidRootPathString(pathString)){\nthrow new Error(util.errorPrefix(fnName,argumentNumber,false)+\n'must be a valid firebase URL and '+\n'the path can\\'t contain \".\", \"#\", \"$\", \"[\", or \"]\".');\n}\n};\nvar validateBoolean=function validateBoolean(fnName,argumentNumber,bool,optional){\nif(optional&&bool===undefined){\nreturn;\n}\nif(typeof bool!=='boolean'){\nthrow new Error(util.errorPrefix(fnName,argumentNumber,optional)+'must be a boolean.');\n}\n};\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n/**\r\n * @constructor\r\n */\nvar OnDisconnect=/** @class */function(){\n/**\r\n     * @param {!Repo} repo_\r\n     * @param {!Path} path_\r\n     */\nfunction OnDisconnect(repo_,path_){\nthis.repo_=repo_;\nthis.path_=path_;\n}\n/**\r\n     * @param {function(?Error)=} onComplete\r\n     * @return {!firebase.Promise}\r\n     */\nOnDisconnect.prototype.cancel=function(onComplete){\nutil.validateArgCount('OnDisconnect.cancel',0,1,arguments.length);\nutil.validateCallback('OnDisconnect.cancel',1,onComplete,true);\nvar deferred=new util.Deferred();\nthis.repo_.onDisconnectCancel(this.path_,deferred.wrapCallback(onComplete));\nreturn deferred.promise;\n};\n/**\r\n     * @param {function(?Error)=} onComplete\r\n     * @return {!firebase.Promise}\r\n     */\nOnDisconnect.prototype.remove=function(onComplete){\nutil.validateArgCount('OnDisconnect.remove',0,1,arguments.length);\nvalidateWritablePath('OnDisconnect.remove',this.path_);\nutil.validateCallback('OnDisconnect.remove',1,onComplete,true);\nvar deferred=new util.Deferred();\nthis.repo_.onDisconnectSet(this.path_,null,deferred.wrapCallback(onComplete));\nreturn deferred.promise;\n};\n/**\r\n     * @param {*} value\r\n     * @param {function(?Error)=} onComplete\r\n     * @return {!firebase.Promise}\r\n     */\nOnDisconnect.prototype.set=function(value,onComplete){\nutil.validateArgCount('OnDisconnect.set',1,2,arguments.length);\nvalidateWritablePath('OnDisconnect.set',this.path_);\nvalidateFirebaseDataArg('OnDisconnect.set',1,value,this.path_,false);\nutil.validateCallback('OnDisconnect.set',2,onComplete,true);\nvar deferred=new util.Deferred();\nthis.repo_.onDisconnectSet(this.path_,value,deferred.wrapCallback(onComplete));\nreturn deferred.promise;\n};\n/**\r\n     * @param {*} value\r\n     * @param {number|string|null} priority\r\n     * @param {function(?Error)=} onComplete\r\n     * @return {!firebase.Promise}\r\n     */\nOnDisconnect.prototype.setWithPriority=function(value,priority,onComplete){\nutil.validateArgCount('OnDisconnect.setWithPriority',2,3,arguments.length);\nvalidateWritablePath('OnDisconnect.setWithPriority',this.path_);\nvalidateFirebaseDataArg('OnDisconnect.setWithPriority',1,value,this.path_,false);\nvalidatePriority('OnDisconnect.setWithPriority',2,priority,false);\nutil.validateCallback('OnDisconnect.setWithPriority',3,onComplete,true);\nvar deferred=new util.Deferred();\nthis.repo_.onDisconnectSetWithPriority(this.path_,value,priority,deferred.wrapCallback(onComplete));\nreturn deferred.promise;\n};\n/**\r\n     * @param {!Object} objectToMerge\r\n     * @param {function(?Error)=} onComplete\r\n     * @return {!firebase.Promise}\r\n     */\nOnDisconnect.prototype.update=function(objectToMerge,onComplete){\nutil.validateArgCount('OnDisconnect.update',1,2,arguments.length);\nvalidateWritablePath('OnDisconnect.update',this.path_);\nif(Array.isArray(objectToMerge)){\nvar newObjectToMerge={};\nfor(var i=0;i<objectToMerge.length;++i){\nnewObjectToMerge[''+i]=objectToMerge[i];\n}\nobjectToMerge=newObjectToMerge;\nwarn('Passing an Array to firebase.database.onDisconnect().update() is deprecated. Use set() if you want to overwrite the '+\n'existing data, or an Object with integer keys if you really do want to only update some of the children.');\n}\nvalidateFirebaseMergeDataArg('OnDisconnect.update',1,objectToMerge,this.path_,false);\nutil.validateCallback('OnDisconnect.update',2,onComplete,true);\nvar deferred=new util.Deferred();\nthis.repo_.onDisconnectUpdate(this.path_,objectToMerge,deferred.wrapCallback(onComplete));\nreturn deferred.promise;\n};\nreturn OnDisconnect;\n}();\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\nvar TransactionResult=/** @class */function(){\n/**\r\n     * A type for the resolve value of Firebase.transaction.\r\n     * @constructor\r\n     * @dict\r\n     * @param {boolean} committed\r\n     * @param {DataSnapshot} snapshot\r\n     */\nfunction TransactionResult(committed,snapshot){\nthis.committed=committed;\nthis.snapshot=snapshot;\n}\n// Do not create public documentation. This is intended to make JSON serialization work but is otherwise unnecessary\n// for end-users\nTransactionResult.prototype.toJSON=function(){\nutil.validateArgCount('TransactionResult.toJSON',0,1,arguments.length);\nreturn{committed:this.committed,snapshot:this.snapshot.toJSON()};\n};\nreturn TransactionResult;\n}();\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n/**\r\n * Fancy ID generator that creates 20-character string identifiers with the\r\n * following properties:\r\n *\r\n * 1. They're based on timestamp so that they sort *after* any existing ids.\r\n * 2. They contain 72-bits of random data after the timestamp so that IDs won't\r\n *    collide with other clients' IDs.\r\n * 3. They sort *lexicographically* (so the timestamp is converted to characters\r\n *    that will sort properly).\r\n * 4. They're monotonically increasing. Even if you generate more than one in\r\n *    the same timestamp, the latter ones will sort after the former ones. We do\r\n *    this by using the previous random bits but \"incrementing\" them by 1 (only\r\n *    in the case of a timestamp collision).\r\n */\nvar nextPushId=function(){\n// Modeled after base64 web-safe chars, but ordered by ASCII.\nvar PUSH_CHARS='-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz';\n// Timestamp of last push, used to prevent local collisions if you push twice\n// in one ms.\nvar lastPushTime=0;\n// We generate 72-bits of randomness which get turned into 12 characters and\n// appended to the timestamp to prevent collisions with other clients. We\n// store the last characters we generated because in the event of a collision,\n// we'll use those same characters except \"incremented\" by one.\nvar lastRandChars=[];\nreturn function(now){\nvar duplicateTime=now===lastPushTime;\nlastPushTime=now;\nvar i;\nvar timeStampChars=new Array(8);\nfor(i=7;i>=0;i--){\ntimeStampChars[i]=PUSH_CHARS.charAt(now%64);\n// NOTE: Can't use << here because javascript will convert to int and lose\n// the upper bits.\nnow=Math.floor(now/64);\n}\nutil.assert(now===0,'Cannot push at time == 0');\nvar id=timeStampChars.join('');\nif(!duplicateTime){\nfor(i=0;i<12;i++){\nlastRandChars[i]=Math.floor(Math.random()*64);\n}\n}else\n{\n// If the timestamp hasn't changed since last push, use the same random\n// number, except incremented by 1.\nfor(i=11;i>=0&&lastRandChars[i]===63;i--){\nlastRandChars[i]=0;\n}\nlastRandChars[i]++;\n}\nfor(i=0;i<12;i++){\nid+=PUSH_CHARS.charAt(lastRandChars[i]);\n}\nutil.assert(id.length===20,'nextPushId: Length should be 20.');\nreturn id;\n};\n}();\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n/**\r\n *\r\n * @param {!string} name\r\n * @param {!Node} node\r\n * @constructor\r\n * @struct\r\n */\nvar NamedNode=/** @class */function(){\nfunction NamedNode(name,node){\nthis.name=name;\nthis.node=node;\n}\n/**\r\n     *\r\n     * @param {!string} name\r\n     * @param {!Node} node\r\n     * @return {NamedNode}\r\n     */\nNamedNode.Wrap=function(name,node){\nreturn new NamedNode(name,node);\n};\nreturn NamedNode;\n}();\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n/**\r\n *\r\n * @constructor\r\n */\nvar Index=/** @class */function(){\nfunction Index(){\n}\n/**\r\n     * @return {function(!NamedNode, !NamedNode):number} A standalone comparison function for\r\n     * this index\r\n     */\nIndex.prototype.getCompare=function(){\nreturn this.compare.bind(this);\n};\n/**\r\n     * Given a before and after value for a node, determine if the indexed value has changed. Even if they are different,\r\n     * it's possible that the changes are isolated to parts of the snapshot that are not indexed.\r\n     *\r\n     * @param {!Node} oldNode\r\n     * @param {!Node} newNode\r\n     * @return {boolean} True if the portion of the snapshot being indexed changed between oldNode and newNode\r\n     */\nIndex.prototype.indexedValueChanged=function(oldNode,newNode){\nvar oldWrapped=new NamedNode(MIN_NAME,oldNode);\nvar newWrapped=new NamedNode(MIN_NAME,newNode);\nreturn this.compare(oldWrapped,newWrapped)!==0;\n};\n/**\r\n     * @return {!NamedNode} a node wrapper that will sort equal to or less than\r\n     * any other node wrapper, using this index\r\n     */\nIndex.prototype.minPost=function(){\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nreturn NamedNode.MIN;\n};\nreturn Index;\n}();\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\nvar __EMPTY_NODE;\nvar KeyIndex=/** @class */function(_super){\ntslib.__extends(KeyIndex,_super);\nfunction KeyIndex(){\nreturn _super!==null&&_super.apply(this,arguments)||this;\n}\nObject.defineProperty(KeyIndex,\"__EMPTY_NODE\",{\nget:function get(){\nreturn __EMPTY_NODE;\n},\nset:function set(val){\n__EMPTY_NODE=val;\n},\nenumerable:false,\nconfigurable:true});\n\n/**\r\n     * @inheritDoc\r\n     */\nKeyIndex.prototype.compare=function(a,b){\nreturn nameCompare(a.name,b.name);\n};\n/**\r\n     * @inheritDoc\r\n     */\nKeyIndex.prototype.isDefinedOn=function(node){\n// We could probably return true here (since every node has a key), but it's never called\n// so just leaving unimplemented for now.\nthrow util.assertionError('KeyIndex.isDefinedOn not expected to be called.');\n};\n/**\r\n     * @inheritDoc\r\n     */\nKeyIndex.prototype.indexedValueChanged=function(oldNode,newNode){\nreturn false;// The key for a node never changes.\n};\n/**\r\n     * @inheritDoc\r\n     */\nKeyIndex.prototype.minPost=function(){\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nreturn NamedNode.MIN;\n};\n/**\r\n     * @inheritDoc\r\n     */\nKeyIndex.prototype.maxPost=function(){\n// TODO: This should really be created once and cached in a static property, but\n// NamedNode isn't defined yet, so I can't use it in a static.  Bleh.\nreturn new NamedNode(MAX_NAME,__EMPTY_NODE);\n};\n/**\r\n     * @param {*} indexValue\r\n     * @param {string} name\r\n     * @return {!NamedNode}\r\n     */\nKeyIndex.prototype.makePost=function(indexValue,name){\nutil.assert(typeof indexValue==='string','KeyIndex indexValue must always be a string.');\n// We just use empty node, but it'll never be compared, since our comparator only looks at name.\nreturn new NamedNode(indexValue,__EMPTY_NODE);\n};\n/**\r\n     * @return {!string} String representation for inclusion in a query spec\r\n     */\nKeyIndex.prototype.toString=function(){\nreturn'.key';\n};\nreturn KeyIndex;\n}(Index);\nvar KEY_INDEX=new KeyIndex();\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\nvar MAX_NODE;\nfunction setMaxNode(val){\nMAX_NODE=val;\n}\n/**\r\n * @param {(!string|!number)} priority\r\n * @return {!string}\r\n */\nvar priorityHashText=function priorityHashText(priority){\nif(typeof priority==='number'){\nreturn'number:'+doubleToIEEE754String(priority);\n}else\n{\nreturn'string:'+priority;\n}\n};\n/**\r\n * Validates that a priority snapshot Node is valid.\r\n *\r\n * @param {!Node} priorityNode\r\n */\nvar validatePriorityNode=function validatePriorityNode(priorityNode){\nif(priorityNode.isLeafNode()){\nvar val=priorityNode.val();\nutil.assert(typeof val==='string'||\ntypeof val==='number'||\n(typeof val==='undefined'?'undefined':_typeof(val))==='object'&&util.contains(val,'.sv'),'Priority must be a string or number.');\n}else\n{\nutil.assert(priorityNode===MAX_NODE||priorityNode.isEmpty(),'priority of unexpected type.');\n}\n// Don't call getPriority() on MAX_NODE to avoid hitting assertion.\nutil.assert(priorityNode===MAX_NODE||priorityNode.getPriority().isEmpty(),\"Priority nodes can't have a priority of their own.\");\n};\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\nvar __childrenNodeConstructor;\n/**\r\n * LeafNode is a class for storing leaf nodes in a DataSnapshot.  It\r\n * implements Node and stores the value of the node (a string,\r\n * number, or boolean) accessible via getValue().\r\n */\nvar LeafNode=/** @class */function(){\n/**\r\n     * @implements {Node}\r\n     * @param {!(string|number|boolean|Object)} value_ The value to store in this leaf node.\r\n     *                                         The object type is possible in the event of a deferred value\r\n     * @param {!Node=} priorityNode_ The priority of this node.\r\n     */\nfunction LeafNode(value_,priorityNode_){\nif(priorityNode_===void 0){priorityNode_=LeafNode.__childrenNodeConstructor.EMPTY_NODE;}\nthis.value_=value_;\nthis.priorityNode_=priorityNode_;\nthis.lazyHash_=null;\nutil.assert(this.value_!==undefined&&this.value_!==null,\"LeafNode shouldn't be created with null/undefined value.\");\nvalidatePriorityNode(this.priorityNode_);\n}\nObject.defineProperty(LeafNode,\"__childrenNodeConstructor\",{\nget:function get(){\nreturn __childrenNodeConstructor;\n},\nset:function set(val){\n__childrenNodeConstructor=val;\n},\nenumerable:false,\nconfigurable:true});\n\n/** @inheritDoc */\nLeafNode.prototype.isLeafNode=function(){\nreturn true;\n};\n/** @inheritDoc */\nLeafNode.prototype.getPriority=function(){\nreturn this.priorityNode_;\n};\n/** @inheritDoc */\nLeafNode.prototype.updatePriority=function(newPriorityNode){\nreturn new LeafNode(this.value_,newPriorityNode);\n};\n/** @inheritDoc */\nLeafNode.prototype.getImmediateChild=function(childName){\n// Hack to treat priority as a regular child\nif(childName==='.priority'){\nreturn this.priorityNode_;\n}else\n{\nreturn LeafNode.__childrenNodeConstructor.EMPTY_NODE;\n}\n};\n/** @inheritDoc */\nLeafNode.prototype.getChild=function(path){\nif(path.isEmpty()){\nreturn this;\n}else\nif(path.getFront()==='.priority'){\nreturn this.priorityNode_;\n}else\n{\nreturn LeafNode.__childrenNodeConstructor.EMPTY_NODE;\n}\n};\n/**\r\n     * @inheritDoc\r\n     */\nLeafNode.prototype.hasChild=function(){\nreturn false;\n};\n/** @inheritDoc */\nLeafNode.prototype.getPredecessorChildName=function(childName,childNode){\nreturn null;\n};\n/** @inheritDoc */\nLeafNode.prototype.updateImmediateChild=function(childName,newChildNode){\nif(childName==='.priority'){\nreturn this.updatePriority(newChildNode);\n}else\nif(newChildNode.isEmpty()&&childName!=='.priority'){\nreturn this;\n}else\n{\nreturn LeafNode.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(childName,newChildNode).updatePriority(this.priorityNode_);\n}\n};\n/** @inheritDoc */\nLeafNode.prototype.updateChild=function(path,newChildNode){\nvar front=path.getFront();\nif(front===null){\nreturn newChildNode;\n}else\nif(newChildNode.isEmpty()&&front!=='.priority'){\nreturn this;\n}else\n{\nutil.assert(front!=='.priority'||path.getLength()===1,'.priority must be the last token in a path');\nreturn this.updateImmediateChild(front,LeafNode.__childrenNodeConstructor.EMPTY_NODE.updateChild(path.popFront(),newChildNode));\n}\n};\n/** @inheritDoc */\nLeafNode.prototype.isEmpty=function(){\nreturn false;\n};\n/** @inheritDoc */\nLeafNode.prototype.numChildren=function(){\nreturn 0;\n};\n/** @inheritDoc */\nLeafNode.prototype.forEachChild=function(index,action){\nreturn false;\n};\n/**\r\n     * @inheritDoc\r\n     */\nLeafNode.prototype.val=function(exportFormat){\nif(exportFormat&&!this.getPriority().isEmpty()){\nreturn{\n'.value':this.getValue(),\n'.priority':this.getPriority().val()};\n\n}else\n{\nreturn this.getValue();\n}\n};\n/** @inheritDoc */\nLeafNode.prototype.hash=function(){\nif(this.lazyHash_===null){\nvar toHash='';\nif(!this.priorityNode_.isEmpty()){\ntoHash+=\n'priority:'+\npriorityHashText(this.priorityNode_.val())+\n':';\n}\nvar type=_typeof(this.value_);\ntoHash+=type+':';\nif(type==='number'){\ntoHash+=doubleToIEEE754String(this.value_);\n}else\n{\ntoHash+=this.value_;\n}\nthis.lazyHash_=sha1(toHash);\n}\nreturn this.lazyHash_;\n};\n/**\r\n     * Returns the value of the leaf node.\r\n     * @return {Object|string|number|boolean} The value of the node.\r\n     */\nLeafNode.prototype.getValue=function(){\nreturn this.value_;\n};\n/**\r\n     * @inheritDoc\r\n     */\nLeafNode.prototype.compareTo=function(other){\nif(other===LeafNode.__childrenNodeConstructor.EMPTY_NODE){\nreturn 1;\n}else\nif(other instanceof LeafNode.__childrenNodeConstructor){\nreturn-1;\n}else\n{\nutil.assert(other.isLeafNode(),'Unknown node type');\nreturn this.compareToLeafNode_(other);\n}\n};\n/**\r\n     * Comparison specifically for two leaf nodes\r\n     * @param {!LeafNode} otherLeaf\r\n     * @return {!number}\r\n     * @private\r\n     */\nLeafNode.prototype.compareToLeafNode_=function(otherLeaf){\nvar otherLeafType=_typeof(otherLeaf.value_);\nvar thisLeafType=_typeof(this.value_);\nvar otherIndex=LeafNode.VALUE_TYPE_ORDER.indexOf(otherLeafType);\nvar thisIndex=LeafNode.VALUE_TYPE_ORDER.indexOf(thisLeafType);\nutil.assert(otherIndex>=0,'Unknown leaf type: '+otherLeafType);\nutil.assert(thisIndex>=0,'Unknown leaf type: '+thisLeafType);\nif(otherIndex===thisIndex){\n// Same type, compare values\nif(thisLeafType==='object'){\n// Deferred value nodes are all equal, but we should also never get to this point...\nreturn 0;\n}else\n{\n// Note that this works because true > false, all others are number or string comparisons\nif(this.value_<otherLeaf.value_){\nreturn-1;\n}else\nif(this.value_===otherLeaf.value_){\nreturn 0;\n}else\n{\nreturn 1;\n}\n}\n}else\n{\nreturn thisIndex-otherIndex;\n}\n};\n/**\r\n     * @inheritDoc\r\n     */\nLeafNode.prototype.withIndex=function(){\nreturn this;\n};\n/**\r\n     * @inheritDoc\r\n     */\nLeafNode.prototype.isIndexed=function(){\nreturn true;\n};\n/**\r\n     * @inheritDoc\r\n     */\nLeafNode.prototype.equals=function(other){\n/**\r\n         * @inheritDoc\r\n         */\nif(other===this){\nreturn true;\n}else\nif(other.isLeafNode()){\nvar otherLeaf=other;\nreturn this.value_===otherLeaf.value_&&\nthis.priorityNode_.equals(otherLeaf.priorityNode_);\n}else\n{\nreturn false;\n}\n};\n/**\r\n     * The sort order for comparing leaf nodes of different types. If two leaf nodes have\r\n     * the same type, the comparison falls back to their value\r\n     * @type {Array.<!string>}\r\n     * @const\r\n     */\nLeafNode.VALUE_TYPE_ORDER=['object','boolean','number','string'];\nreturn LeafNode;\n}();\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\nvar nodeFromJSON;\nvar MAX_NODE$1;\nfunction setNodeFromJSON(val){\nnodeFromJSON=val;\n}\nfunction setMaxNode$1(val){\nMAX_NODE$1=val;\n}\n/**\r\n * @constructor\r\n * @extends {Index}\r\n * @private\r\n */\nvar PriorityIndex=/** @class */function(_super){\ntslib.__extends(PriorityIndex,_super);\nfunction PriorityIndex(){\nreturn _super!==null&&_super.apply(this,arguments)||this;\n}\n/**\r\n     * @inheritDoc\r\n     */\nPriorityIndex.prototype.compare=function(a,b){\nvar aPriority=a.node.getPriority();\nvar bPriority=b.node.getPriority();\nvar indexCmp=aPriority.compareTo(bPriority);\nif(indexCmp===0){\nreturn nameCompare(a.name,b.name);\n}else\n{\nreturn indexCmp;\n}\n};\n/**\r\n     * @inheritDoc\r\n     */\nPriorityIndex.prototype.isDefinedOn=function(node){\nreturn!node.getPriority().isEmpty();\n};\n/**\r\n     * @inheritDoc\r\n     */\nPriorityIndex.prototype.indexedValueChanged=function(oldNode,newNode){\nreturn!oldNode.getPriority().equals(newNode.getPriority());\n};\n/**\r\n     * @inheritDoc\r\n     */\nPriorityIndex.prototype.minPost=function(){\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nreturn NamedNode.MIN;\n};\n/**\r\n     * @inheritDoc\r\n     */\nPriorityIndex.prototype.maxPost=function(){\nreturn new NamedNode(MAX_NAME,new LeafNode('[PRIORITY-POST]',MAX_NODE$1));\n};\n/**\r\n     * @param {*} indexValue\r\n     * @param {string} name\r\n     * @return {!NamedNode}\r\n     */\nPriorityIndex.prototype.makePost=function(indexValue,name){\nvar priorityNode=nodeFromJSON(indexValue);\nreturn new NamedNode(name,new LeafNode('[PRIORITY-POST]',priorityNode));\n};\n/**\r\n     * @return {!string} String representation for inclusion in a query spec\r\n     */\nPriorityIndex.prototype.toString=function(){\nreturn'.priority';\n};\nreturn PriorityIndex;\n}(Index);\nvar PRIORITY_INDEX=new PriorityIndex();\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n/**\r\n * An iterator over an LLRBNode.\r\n */\nvar SortedMapIterator=/** @class */function(){\n/**\r\n     * @template K, V, T\r\n     * @param {LLRBNode|LLRBEmptyNode} node Node to iterate.\r\n     * @param {?K} startKey\r\n     * @param {function(K, K): number} comparator\r\n     * @param {boolean} isReverse_ Whether or not to iterate in reverse\r\n     * @param {(function(K, V):T)=} resultGenerator_\r\n     */\nfunction SortedMapIterator(node,startKey,comparator,isReverse_,resultGenerator_){\nif(resultGenerator_===void 0){resultGenerator_=null;}\nthis.isReverse_=isReverse_;\nthis.resultGenerator_=resultGenerator_;\n/** @private\r\n         * @type {Array.<!LLRBNode>}\r\n         */\nthis.nodeStack_=[];\nvar cmp=1;\nwhile(!node.isEmpty()){\nnode=node;\ncmp=startKey?comparator(node.key,startKey):1;\n// flip the comparison if we're going in reverse\nif(isReverse_){\ncmp*=-1;\n}\nif(cmp<0){\n// This node is less than our start key. ignore it\nif(this.isReverse_){\nnode=node.left;\n}else\n{\nnode=node.right;\n}\n}else\nif(cmp===0){\n// This node is exactly equal to our start key. Push it on the stack, but stop iterating;\nthis.nodeStack_.push(node);\nbreak;\n}else\n{\n// This node is greater than our start key, add it to the stack and move to the next one\nthis.nodeStack_.push(node);\nif(this.isReverse_){\nnode=node.right;\n}else\n{\nnode=node.left;\n}\n}\n}\n}\nSortedMapIterator.prototype.getNext=function(){\nif(this.nodeStack_.length===0){\nreturn null;\n}\nvar node=this.nodeStack_.pop();\nvar result;\nif(this.resultGenerator_){\nresult=this.resultGenerator_(node.key,node.value);\n}else\n{\nresult={key:node.key,value:node.value};\n}\nif(this.isReverse_){\nnode=node.left;\nwhile(!node.isEmpty()){\nthis.nodeStack_.push(node);\nnode=node.right;\n}\n}else\n{\nnode=node.right;\nwhile(!node.isEmpty()){\nthis.nodeStack_.push(node);\nnode=node.left;\n}\n}\nreturn result;\n};\nSortedMapIterator.prototype.hasNext=function(){\nreturn this.nodeStack_.length>0;\n};\nSortedMapIterator.prototype.peek=function(){\nif(this.nodeStack_.length===0){\nreturn null;\n}\nvar node=this.nodeStack_[this.nodeStack_.length-1];\nif(this.resultGenerator_){\nreturn this.resultGenerator_(node.key,node.value);\n}else\n{\nreturn{key:node.key,value:node.value};\n}\n};\nreturn SortedMapIterator;\n}();\n/**\r\n * Represents a node in a Left-leaning Red-Black tree.\r\n */\nvar LLRBNode=/** @class */function(){\n/**\r\n     * @template K, V\r\n     * @param {!K} key Key associated with this node.\r\n     * @param {!V} value Value associated with this node.\r\n     * @param {?boolean} color Whether this node is red.\r\n     * @param {?(LLRBNode|LLRBEmptyNode)=} left Left child.\r\n     * @param {?(LLRBNode|LLRBEmptyNode)=} right Right child.\r\n     */\nfunction LLRBNode(key,value,color,left,right){\nthis.key=key;\nthis.value=value;\nthis.color=color!=null?color:LLRBNode.RED;\nthis.left=\nleft!=null?left:SortedMap.EMPTY_NODE;\nthis.right=\nright!=null?right:SortedMap.EMPTY_NODE;\n}\n/**\r\n     * Returns a copy of the current node, optionally replacing pieces of it.\r\n     *\r\n     * @param {?K} key New key for the node, or null.\r\n     * @param {?V} value New value for the node, or null.\r\n     * @param {?boolean} color New color for the node, or null.\r\n     * @param {?LLRBNode|LLRBEmptyNode} left New left child for the node, or null.\r\n     * @param {?LLRBNode|LLRBEmptyNode} right New right child for the node, or null.\r\n     * @return {!LLRBNode} The node copy.\r\n     */\nLLRBNode.prototype.copy=function(key,value,color,left,right){\nreturn new LLRBNode(key!=null?key:this.key,value!=null?value:this.value,color!=null?color:this.color,left!=null?left:this.left,right!=null?right:this.right);\n};\n/**\r\n     * @return {number} The total number of nodes in the tree.\r\n     */\nLLRBNode.prototype.count=function(){\nreturn this.left.count()+1+this.right.count();\n};\n/**\r\n     * @return {boolean} True if the tree is empty.\r\n     */\nLLRBNode.prototype.isEmpty=function(){\nreturn false;\n};\n/**\r\n     * Traverses the tree in key order and calls the specified action function\r\n     * for each node.\r\n     *\r\n     * @param {function(!K, !V):*} action Callback function to be called for each\r\n     *   node.  If it returns true, traversal is aborted.\r\n     * @return {*} The first truthy value returned by action, or the last falsey\r\n     *   value returned by action\r\n     */\nLLRBNode.prototype.inorderTraversal=function(action){\nreturn this.left.inorderTraversal(action)||\n!!action(this.key,this.value)||\nthis.right.inorderTraversal(action);\n};\n/**\r\n     * Traverses the tree in reverse key order and calls the specified action function\r\n     * for each node.\r\n     *\r\n     * @param {function(!Object, !Object)} action Callback function to be called for each\r\n     * node.  If it returns true, traversal is aborted.\r\n     * @return {*} True if traversal was aborted.\r\n     */\nLLRBNode.prototype.reverseTraversal=function(action){\nreturn this.right.reverseTraversal(action)||\naction(this.key,this.value)||\nthis.left.reverseTraversal(action);\n};\n/**\r\n     * @return {!Object} The minimum node in the tree.\r\n     * @private\r\n     */\nLLRBNode.prototype.min_=function(){\nif(this.left.isEmpty()){\nreturn this;\n}else\n{\nreturn this.left.min_();\n}\n};\n/**\r\n     * @return {!K} The maximum key in the tree.\r\n     */\nLLRBNode.prototype.minKey=function(){\nreturn this.min_().key;\n};\n/**\r\n     * @return {!K} The maximum key in the tree.\r\n     */\nLLRBNode.prototype.maxKey=function(){\nif(this.right.isEmpty()){\nreturn this.key;\n}else\n{\nreturn this.right.maxKey();\n}\n};\n/**\r\n     *\r\n     * @param {!Object} key Key to insert.\r\n     * @param {!Object} value Value to insert.\r\n     * @param {Comparator} comparator Comparator.\r\n     * @return {!LLRBNode} New tree, with the key/value added.\r\n     */\nLLRBNode.prototype.insert=function(key,value,comparator){\nvar n=this;\nvar cmp=comparator(key,n.key);\nif(cmp<0){\nn=n.copy(null,null,null,n.left.insert(key,value,comparator),null);\n}else\nif(cmp===0){\nn=n.copy(null,value,null,null,null);\n}else\n{\nn=n.copy(null,null,null,null,n.right.insert(key,value,comparator));\n}\nreturn n.fixUp_();\n};\n/**\r\n     * @private\r\n     * @return {!LLRBNode|LLRBEmptyNode} New tree, with the minimum key removed.\r\n     */\nLLRBNode.prototype.removeMin_=function(){\nif(this.left.isEmpty()){\nreturn SortedMap.EMPTY_NODE;\n}\nvar n=this;\nif(!n.left.isRed_()&&!n.left.left.isRed_()){\nn=n.moveRedLeft_();\n}\nn=n.copy(null,null,null,n.left.removeMin_(),null);\nreturn n.fixUp_();\n};\n/**\r\n     * @param {!Object} key The key of the item to remove.\r\n     * @param {Comparator} comparator Comparator.\r\n     * @return {!LLRBNode|LLRBEmptyNode} New tree, with the specified item removed.\r\n     */\nLLRBNode.prototype.remove=function(key,comparator){\nvar n,smallest;\nn=this;\nif(comparator(key,n.key)<0){\nif(!n.left.isEmpty()&&!n.left.isRed_()&&!n.left.left.isRed_()){\nn=n.moveRedLeft_();\n}\nn=n.copy(null,null,null,n.left.remove(key,comparator),null);\n}else\n{\nif(n.left.isRed_()){\nn=n.rotateRight_();\n}\nif(!n.right.isEmpty()&&!n.right.isRed_()&&!n.right.left.isRed_()){\nn=n.moveRedRight_();\n}\nif(comparator(key,n.key)===0){\nif(n.right.isEmpty()){\nreturn SortedMap.EMPTY_NODE;\n}else\n{\nsmallest=n.right.min_();\nn=n.copy(smallest.key,smallest.value,null,null,n.right.removeMin_());\n}\n}\nn=n.copy(null,null,null,null,n.right.remove(key,comparator));\n}\nreturn n.fixUp_();\n};\n/**\r\n     * @private\r\n     * @return {boolean} Whether this is a RED node.\r\n     */\nLLRBNode.prototype.isRed_=function(){\nreturn this.color;\n};\n/**\r\n     * @private\r\n     * @return {!LLRBNode} New tree after performing any needed rotations.\r\n     */\nLLRBNode.prototype.fixUp_=function(){\nvar n=this;\nif(n.right.isRed_()&&!n.left.isRed_()){\nn=n.rotateLeft_();\n}\nif(n.left.isRed_()&&n.left.left.isRed_()){\nn=n.rotateRight_();\n}\nif(n.left.isRed_()&&n.right.isRed_()){\nn=n.colorFlip_();\n}\nreturn n;\n};\n/**\r\n     * @private\r\n     * @return {!LLRBNode} New tree, after moveRedLeft.\r\n     */\nLLRBNode.prototype.moveRedLeft_=function(){\nvar n=this.colorFlip_();\nif(n.right.left.isRed_()){\nn=n.copy(null,null,null,null,n.right.rotateRight_());\nn=n.rotateLeft_();\nn=n.colorFlip_();\n}\nreturn n;\n};\n/**\r\n     * @private\r\n     * @return {!LLRBNode} New tree, after moveRedRight.\r\n     */\nLLRBNode.prototype.moveRedRight_=function(){\nvar n=this.colorFlip_();\nif(n.left.left.isRed_()){\nn=n.rotateRight_();\nn=n.colorFlip_();\n}\nreturn n;\n};\n/**\r\n     * @private\r\n     * @return {!LLRBNode} New tree, after rotateLeft.\r\n     */\nLLRBNode.prototype.rotateLeft_=function(){\nvar nl=this.copy(null,null,LLRBNode.RED,null,this.right.left);\nreturn this.right.copy(null,null,this.color,nl,null);\n};\n/**\r\n     * @private\r\n     * @return {!LLRBNode} New tree, after rotateRight.\r\n     */\nLLRBNode.prototype.rotateRight_=function(){\nvar nr=this.copy(null,null,LLRBNode.RED,this.left.right,null);\nreturn this.left.copy(null,null,this.color,null,nr);\n};\n/**\r\n     * @private\r\n     * @return {!LLRBNode} New tree, after colorFlip.\r\n     */\nLLRBNode.prototype.colorFlip_=function(){\nvar left=this.left.copy(null,null,!this.left.color,null,null);\nvar right=this.right.copy(null,null,!this.right.color,null,null);\nreturn this.copy(null,null,!this.color,left,right);\n};\n/**\r\n     * For testing.\r\n     *\r\n     * @private\r\n     * @return {boolean} True if all is well.\r\n     */\nLLRBNode.prototype.checkMaxDepth_=function(){\nvar blackDepth=this.check_();\nreturn Math.pow(2.0,blackDepth)<=this.count()+1;\n};\n/**\r\n     * @private\r\n     * @return {number} Not sure what this returns exactly. :-).\r\n     */\nLLRBNode.prototype.check_=function(){\nif(this.isRed_()&&this.left.isRed_()){\nthrow new Error('Red node has red child('+this.key+','+this.value+')');\n}\nif(this.right.isRed_()){\nthrow new Error('Right child of ('+this.key+','+this.value+') is red');\n}\nvar blackDepth=this.left.check_();\nif(blackDepth!==this.right.check_()){\nthrow new Error('Black depths differ');\n}else\n{\nreturn blackDepth+(this.isRed_()?0:1);\n}\n};\nLLRBNode.RED=true;\nLLRBNode.BLACK=false;\nreturn LLRBNode;\n}();\n/**\r\n * Represents an empty node (a leaf node in the Red-Black Tree).\r\n */\nvar LLRBEmptyNode=/** @class */function(){\nfunction LLRBEmptyNode(){\n}\n/**\r\n     * Returns a copy of the current node.\r\n     *\r\n     * @return {!LLRBEmptyNode} The node copy.\r\n     */\nLLRBEmptyNode.prototype.copy=function(key,value,color,left,right){\nreturn this;\n};\n/**\r\n     * Returns a copy of the tree, with the specified key/value added.\r\n     *\r\n     * @param {!K} key Key to be added.\r\n     * @param {!V} value Value to be added.\r\n     * @param {Comparator} comparator Comparator.\r\n     * @return {!LLRBNode} New tree, with item added.\r\n     */\nLLRBEmptyNode.prototype.insert=function(key,value,comparator){\nreturn new LLRBNode(key,value,null);\n};\n/**\r\n     * Returns a copy of the tree, with the specified key removed.\r\n     *\r\n     * @param {!K} key The key to remove.\r\n     * @param {Comparator} comparator Comparator.\r\n     * @return {!LLRBEmptyNode} New tree, with item removed.\r\n     */\nLLRBEmptyNode.prototype.remove=function(key,comparator){\nreturn this;\n};\n/**\r\n     * @return {number} The total number of nodes in the tree.\r\n     */\nLLRBEmptyNode.prototype.count=function(){\nreturn 0;\n};\n/**\r\n     * @return {boolean} True if the tree is empty.\r\n     */\nLLRBEmptyNode.prototype.isEmpty=function(){\nreturn true;\n};\n/**\r\n     * Traverses the tree in key order and calls the specified action function\r\n     * for each node.\r\n     *\r\n     * @param {function(!K, !V):*} action Callback function to be called for each\r\n     * node.  If it returns true, traversal is aborted.\r\n     * @return {boolean} True if traversal was aborted.\r\n     */\nLLRBEmptyNode.prototype.inorderTraversal=function(action){\nreturn false;\n};\n/**\r\n     * Traverses the tree in reverse key order and calls the specified action function\r\n     * for each node.\r\n     *\r\n     * @param {function(!K, !V)} action Callback function to be called for each\r\n     * node.  If it returns true, traversal is aborted.\r\n     * @return {boolean} True if traversal was aborted.\r\n     */\nLLRBEmptyNode.prototype.reverseTraversal=function(action){\nreturn false;\n};\n/**\r\n     * @return {null}\r\n     */\nLLRBEmptyNode.prototype.minKey=function(){\nreturn null;\n};\n/**\r\n     * @return {null}\r\n     */\nLLRBEmptyNode.prototype.maxKey=function(){\nreturn null;\n};\n/**\r\n     * @private\r\n     * @return {number} Not sure what this returns exactly. :-).\r\n     */\nLLRBEmptyNode.prototype.check_=function(){\nreturn 0;\n};\n/**\r\n     * @private\r\n     * @return {boolean} Whether this node is red.\r\n     */\nLLRBEmptyNode.prototype.isRed_=function(){\nreturn false;\n};\nreturn LLRBEmptyNode;\n}();\n/**\r\n * An immutable sorted map implementation, based on a Left-leaning Red-Black\r\n * tree.\r\n */\nvar SortedMap=/** @class */function(){\n/**\r\n     * @template K, V\r\n     * @param {function(K, K):number} comparator_ Key comparator.\r\n     * @param {LLRBNode=} root_ (Optional) Root node for the map.\r\n     */\nfunction SortedMap(comparator_,root_){\nif(root_===void 0){root_=SortedMap.EMPTY_NODE;}\nthis.comparator_=comparator_;\nthis.root_=root_;\n}\n/**\r\n     * Returns a copy of the map, with the specified key/value added or replaced.\r\n     * (TODO: We should perhaps rename this method to 'put')\r\n     *\r\n     * @param {!K} key Key to be added.\r\n     * @param {!V} value Value to be added.\r\n     * @return {!SortedMap.<K, V>} New map, with item added.\r\n     */\nSortedMap.prototype.insert=function(key,value){\nreturn new SortedMap(this.comparator_,this.root_.\ninsert(key,value,this.comparator_).\ncopy(null,null,LLRBNode.BLACK,null,null));\n};\n/**\r\n     * Returns a copy of the map, with the specified key removed.\r\n     *\r\n     * @param {!K} key The key to remove.\r\n     * @return {!SortedMap.<K, V>} New map, with item removed.\r\n     */\nSortedMap.prototype.remove=function(key){\nreturn new SortedMap(this.comparator_,this.root_.\nremove(key,this.comparator_).\ncopy(null,null,LLRBNode.BLACK,null,null));\n};\n/**\r\n     * Returns the value of the node with the given key, or null.\r\n     *\r\n     * @param {!K} key The key to look up.\r\n     * @return {?V} The value of the node with the given key, or null if the\r\n     * key doesn't exist.\r\n     */\nSortedMap.prototype.get=function(key){\nvar cmp;\nvar node=this.root_;\nwhile(!node.isEmpty()){\ncmp=this.comparator_(key,node.key);\nif(cmp===0){\nreturn node.value;\n}else\nif(cmp<0){\nnode=node.left;\n}else\nif(cmp>0){\nnode=node.right;\n}\n}\nreturn null;\n};\n/**\r\n     * Returns the key of the item *before* the specified key, or null if key is the first item.\r\n     * @param {K} key The key to find the predecessor of\r\n     * @return {?K} The predecessor key.\r\n     */\nSortedMap.prototype.getPredecessorKey=function(key){\nvar cmp,node=this.root_,rightParent=null;\nwhile(!node.isEmpty()){\ncmp=this.comparator_(key,node.key);\nif(cmp===0){\nif(!node.left.isEmpty()){\nnode=node.left;\nwhile(!node.right.isEmpty()){\nnode=node.right;\n}\nreturn node.key;\n}else\nif(rightParent){\nreturn rightParent.key;\n}else\n{\nreturn null;// first item.\n}\n}else\nif(cmp<0){\nnode=node.left;\n}else\nif(cmp>0){\nrightParent=node;\nnode=node.right;\n}\n}\nthrow new Error('Attempted to find predecessor key for a nonexistent key.  What gives?');\n};\n/**\r\n     * @return {boolean} True if the map is empty.\r\n     */\nSortedMap.prototype.isEmpty=function(){\nreturn this.root_.isEmpty();\n};\n/**\r\n     * @return {number} The total number of nodes in the map.\r\n     */\nSortedMap.prototype.count=function(){\nreturn this.root_.count();\n};\n/**\r\n     * @return {?K} The minimum key in the map.\r\n     */\nSortedMap.prototype.minKey=function(){\nreturn this.root_.minKey();\n};\n/**\r\n     * @return {?K} The maximum key in the map.\r\n     */\nSortedMap.prototype.maxKey=function(){\nreturn this.root_.maxKey();\n};\n/**\r\n     * Traverses the map in key order and calls the specified action function\r\n     * for each key/value pair.\r\n     *\r\n     * @param {function(!K, !V):*} action Callback function to be called\r\n     * for each key/value pair.  If action returns true, traversal is aborted.\r\n     * @return {*} The first truthy value returned by action, or the last falsey\r\n     *   value returned by action\r\n     */\nSortedMap.prototype.inorderTraversal=function(action){\nreturn this.root_.inorderTraversal(action);\n};\n/**\r\n     * Traverses the map in reverse key order and calls the specified action function\r\n     * for each key/value pair.\r\n     *\r\n     * @param {function(!Object, !Object)} action Callback function to be called\r\n     * for each key/value pair.  If action returns true, traversal is aborted.\r\n     * @return {*} True if the traversal was aborted.\r\n     */\nSortedMap.prototype.reverseTraversal=function(action){\nreturn this.root_.reverseTraversal(action);\n};\n/**\r\n     * Returns an iterator over the SortedMap.\r\n     * @template T\r\n     * @param {(function(K, V):T)=} resultGenerator\r\n     * @return {SortedMapIterator.<K, V, T>} The iterator.\r\n     */\nSortedMap.prototype.getIterator=function(resultGenerator){\nreturn new SortedMapIterator(this.root_,null,this.comparator_,false,resultGenerator);\n};\nSortedMap.prototype.getIteratorFrom=function(key,resultGenerator){\nreturn new SortedMapIterator(this.root_,key,this.comparator_,false,resultGenerator);\n};\nSortedMap.prototype.getReverseIteratorFrom=function(key,resultGenerator){\nreturn new SortedMapIterator(this.root_,key,this.comparator_,true,resultGenerator);\n};\nSortedMap.prototype.getReverseIterator=function(resultGenerator){\nreturn new SortedMapIterator(this.root_,null,this.comparator_,true,resultGenerator);\n};\n/**\r\n     * Always use the same empty node, to reduce memory.\r\n     * @const\r\n     */\nSortedMap.EMPTY_NODE=new LLRBEmptyNode();\nreturn SortedMap;\n}();\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\nvar LOG_2=Math.log(2);\n/**\r\n * @constructor\r\n */\nvar Base12Num=/** @class */function(){\n/**\r\n     * @param {number} length\r\n     */\nfunction Base12Num(length){\nvar logBase2=function logBase2(num){\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nreturn parseInt(Math.log(num)/LOG_2,10);\n};\nvar bitMask=function bitMask(bits){return parseInt(Array(bits+1).join('1'),2);};\nthis.count=logBase2(length+1);\nthis.current_=this.count-1;\nvar mask=bitMask(this.count);\nthis.bits_=length+1&mask;\n}\n/**\r\n     * @return {boolean}\r\n     */\nBase12Num.prototype.nextBitIsOne=function(){\n//noinspection JSBitwiseOperatorUsage\nvar result=!(this.bits_&0x1<<this.current_);\nthis.current_--;\nreturn result;\n};\nreturn Base12Num;\n}();\n/**\r\n * Takes a list of child nodes and constructs a SortedSet using the given comparison\r\n * function\r\n *\r\n * Uses the algorithm described in the paper linked here:\r\n * http://citeseerx.ist.psu.edu/viewdoc/summary?doi=10.1.1.46.1458\r\n *\r\n * @template K, V\r\n * @param {Array.<!NamedNode>} childList Unsorted list of children\r\n * @param {function(!NamedNode, !NamedNode):number} cmp The comparison method to be used\r\n * @param {(function(NamedNode):K)=} keyFn An optional function to extract K from a node wrapper, if K's\r\n *                                                        type is not NamedNode\r\n * @param {(function(K, K):number)=} mapSortFn An optional override for comparator used by the generated sorted map\r\n * @return {SortedMap.<K, V>}\r\n */\nvar buildChildSet=function buildChildSet(childList,cmp,keyFn,mapSortFn){\nchildList.sort(cmp);\nvar buildBalancedTree=function buildBalancedTree(low,high){\nvar length=high-low;\nvar namedNode;\nvar key;\nif(length===0){\nreturn null;\n}else\nif(length===1){\nnamedNode=childList[low];\nkey=keyFn?keyFn(namedNode):namedNode;\nreturn new LLRBNode(key,namedNode.node,LLRBNode.BLACK,null,null);\n}else\n{\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nvar middle=parseInt(length/2,10)+low;\nvar left=buildBalancedTree(low,middle);\nvar right=buildBalancedTree(middle+1,high);\nnamedNode=childList[middle];\nkey=keyFn?keyFn(namedNode):namedNode;\nreturn new LLRBNode(key,namedNode.node,LLRBNode.BLACK,left,right);\n}\n};\nvar buildFrom12Array=function buildFrom12Array(base12){\nvar node=null;\nvar root=null;\nvar index=childList.length;\nvar buildPennant=function buildPennant(chunkSize,color){\nvar low=index-chunkSize;\nvar high=index;\nindex-=chunkSize;\nvar childTree=buildBalancedTree(low+1,high);\nvar namedNode=childList[low];\nvar key=keyFn?keyFn(namedNode):namedNode;\nattachPennant(new LLRBNode(key,namedNode.node,color,null,childTree));\n};\nvar attachPennant=function attachPennant(pennant){\nif(node){\nnode.left=pennant;\nnode=pennant;\n}else\n{\nroot=pennant;\nnode=pennant;\n}\n};\nfor(var i=0;i<base12.count;++i){\nvar isOne=base12.nextBitIsOne();\n// The number of nodes taken in each slice is 2^(arr.length - (i + 1))\nvar chunkSize=Math.pow(2,base12.count-(i+1));\nif(isOne){\nbuildPennant(chunkSize,LLRBNode.BLACK);\n}else\n{\n// current == 2\nbuildPennant(chunkSize,LLRBNode.BLACK);\nbuildPennant(chunkSize,LLRBNode.RED);\n}\n}\nreturn root;\n};\nvar base12=new Base12Num(childList.length);\nvar root=buildFrom12Array(base12);\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nreturn new SortedMap(mapSortFn||cmp,root);\n};\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\nvar _defaultIndexMap;\nvar fallbackObject={};\nvar IndexMap=/** @class */function(){\nfunction IndexMap(indexes_,indexSet_){\nthis.indexes_=indexes_;\nthis.indexSet_=indexSet_;\n}\nObject.defineProperty(IndexMap,\"Default\",{\n/**\r\n         * The default IndexMap for nodes without a priority\r\n         */\nget:function get(){\nutil.assert(fallbackObject&&PRIORITY_INDEX,'ChildrenNode.ts has not been loaded');\n_defaultIndexMap=\n_defaultIndexMap||\nnew IndexMap({'.priority':fallbackObject},{'.priority':PRIORITY_INDEX});\nreturn _defaultIndexMap;\n},\nenumerable:false,\nconfigurable:true});\n\nIndexMap.prototype.get=function(indexKey){\nvar sortedMap=util.safeGet(this.indexes_,indexKey);\nif(!sortedMap){\nthrow new Error('No index defined for '+indexKey);\n}\nif(sortedMap instanceof SortedMap){\nreturn sortedMap;\n}else\n{\n// The index exists, but it falls back to just name comparison. Return null so that the calling code uses the\n// regular child map\nreturn null;\n}\n};\nIndexMap.prototype.hasIndex=function(indexDefinition){\nreturn util.contains(this.indexSet_,indexDefinition.toString());\n};\nIndexMap.prototype.addIndex=function(indexDefinition,existingChildren){\nutil.assert(indexDefinition!==KEY_INDEX,\"KeyIndex always exists and isn't meant to be added to the IndexMap.\");\nvar childList=[];\nvar sawIndexedValue=false;\nvar iter=existingChildren.getIterator(NamedNode.Wrap);\nvar next=iter.getNext();\nwhile(next){\nsawIndexedValue=\nsawIndexedValue||indexDefinition.isDefinedOn(next.node);\nchildList.push(next);\nnext=iter.getNext();\n}\nvar newIndex;\nif(sawIndexedValue){\nnewIndex=buildChildSet(childList,indexDefinition.getCompare());\n}else\n{\nnewIndex=fallbackObject;\n}\nvar indexName=indexDefinition.toString();\nvar newIndexSet=tslib.__assign({},this.indexSet_);\nnewIndexSet[indexName]=indexDefinition;\nvar newIndexes=tslib.__assign({},this.indexes_);\nnewIndexes[indexName]=newIndex;\nreturn new IndexMap(newIndexes,newIndexSet);\n};\n/**\r\n     * Ensure that this node is properly tracked in any indexes that we're maintaining\r\n     */\nIndexMap.prototype.addToIndexes=function(namedNode,existingChildren){\nvar _this=this;\nvar newIndexes=util.map(this.indexes_,function(indexedChildren,indexName){\nvar index=util.safeGet(_this.indexSet_,indexName);\nutil.assert(index,'Missing index implementation for '+indexName);\nif(indexedChildren===fallbackObject){\n// Check to see if we need to index everything\nif(index.isDefinedOn(namedNode.node)){\n// We need to build this index\nvar childList=[];\nvar iter=existingChildren.getIterator(NamedNode.Wrap);\nvar next=iter.getNext();\nwhile(next){\nif(next.name!==namedNode.name){\nchildList.push(next);\n}\nnext=iter.getNext();\n}\nchildList.push(namedNode);\nreturn buildChildSet(childList,index.getCompare());\n}else\n{\n// No change, this remains a fallback\nreturn fallbackObject;\n}\n}else\n{\nvar existingSnap=existingChildren.get(namedNode.name);\nvar newChildren=indexedChildren;\nif(existingSnap){\nnewChildren=newChildren.remove(new NamedNode(namedNode.name,existingSnap));\n}\nreturn newChildren.insert(namedNode,namedNode.node);\n}\n});\nreturn new IndexMap(newIndexes,this.indexSet_);\n};\n/**\r\n     * Create a new IndexMap instance with the given value removed\r\n     */\nIndexMap.prototype.removeFromIndexes=function(namedNode,existingChildren){\nvar newIndexes=util.map(this.indexes_,function(indexedChildren){\nif(indexedChildren===fallbackObject){\n// This is the fallback. Just return it, nothing to do in this case\nreturn indexedChildren;\n}else\n{\nvar existingSnap=existingChildren.get(namedNode.name);\nif(existingSnap){\nreturn indexedChildren.remove(new NamedNode(namedNode.name,existingSnap));\n}else\n{\n// No record of this child\nreturn indexedChildren;\n}\n}\n});\nreturn new IndexMap(newIndexes,this.indexSet_);\n};\nreturn IndexMap;\n}();\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\nfunction NAME_ONLY_COMPARATOR(left,right){\nreturn nameCompare(left.name,right.name);\n}\nfunction NAME_COMPARATOR(left,right){\nreturn nameCompare(left,right);\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n// TODO: For memory savings, don't store priorityNode_ if it's empty.\nvar EMPTY_NODE;\n/**\r\n * ChildrenNode is a class for storing internal nodes in a DataSnapshot\r\n * (i.e. nodes with children).  It implements Node and stores the\r\n * list of children in the children property, sorted by child name.\r\n *\r\n * @constructor\r\n * @implements {Node}\r\n */\nvar ChildrenNode=/** @class */function(){\n/**\r\n     *\r\n     * @param {!SortedMap.<string, !Node>} children_ List of children\r\n     * of this node..\r\n     * @param {?Node} priorityNode_ The priority of this node (as a snapshot node).\r\n     * @param {!IndexMap} indexMap_\r\n     */\nfunction ChildrenNode(children_,priorityNode_,indexMap_){\nthis.children_=children_;\nthis.priorityNode_=priorityNode_;\nthis.indexMap_=indexMap_;\nthis.lazyHash_=null;\n/**\r\n         * Note: The only reason we allow null priority is for EMPTY_NODE, since we can't use\r\n         * EMPTY_NODE as the priority of EMPTY_NODE.  We might want to consider making EMPTY_NODE its own\r\n         * class instead of an empty ChildrenNode.\r\n         */\nif(this.priorityNode_){\nvalidatePriorityNode(this.priorityNode_);\n}\nif(this.children_.isEmpty()){\nutil.assert(!this.priorityNode_||this.priorityNode_.isEmpty(),'An empty node cannot have a priority');\n}\n}\nObject.defineProperty(ChildrenNode,\"EMPTY_NODE\",{\nget:function get(){\nreturn EMPTY_NODE||(\nEMPTY_NODE=new ChildrenNode(new SortedMap(NAME_COMPARATOR),null,IndexMap.Default));\n},\nenumerable:false,\nconfigurable:true});\n\n/** @inheritDoc */\nChildrenNode.prototype.isLeafNode=function(){\nreturn false;\n};\n/** @inheritDoc */\nChildrenNode.prototype.getPriority=function(){\nreturn this.priorityNode_||EMPTY_NODE;\n};\n/** @inheritDoc */\nChildrenNode.prototype.updatePriority=function(newPriorityNode){\nif(this.children_.isEmpty()){\n// Don't allow priorities on empty nodes\nreturn this;\n}else\n{\nreturn new ChildrenNode(this.children_,newPriorityNode,this.indexMap_);\n}\n};\n/** @inheritDoc */\nChildrenNode.prototype.getImmediateChild=function(childName){\n// Hack to treat priority as a regular child\nif(childName==='.priority'){\nreturn this.getPriority();\n}else\n{\nvar child=this.children_.get(childName);\nreturn child===null?EMPTY_NODE:child;\n}\n};\n/** @inheritDoc */\nChildrenNode.prototype.getChild=function(path){\nvar front=path.getFront();\nif(front===null){\nreturn this;\n}\nreturn this.getImmediateChild(front).getChild(path.popFront());\n};\n/** @inheritDoc */\nChildrenNode.prototype.hasChild=function(childName){\nreturn this.children_.get(childName)!==null;\n};\n/** @inheritDoc */\nChildrenNode.prototype.updateImmediateChild=function(childName,newChildNode){\nutil.assert(newChildNode,'We should always be passing snapshot nodes');\nif(childName==='.priority'){\nreturn this.updatePriority(newChildNode);\n}else\n{\nvar namedNode=new NamedNode(childName,newChildNode);\nvar newChildren=void 0,newIndexMap=void 0;\nif(newChildNode.isEmpty()){\nnewChildren=this.children_.remove(childName);\nnewIndexMap=this.indexMap_.removeFromIndexes(namedNode,this.children_);\n}else\n{\nnewChildren=this.children_.insert(childName,newChildNode);\nnewIndexMap=this.indexMap_.addToIndexes(namedNode,this.children_);\n}\nvar newPriority=newChildren.isEmpty()?\nEMPTY_NODE:\nthis.priorityNode_;\nreturn new ChildrenNode(newChildren,newPriority,newIndexMap);\n}\n};\n/** @inheritDoc */\nChildrenNode.prototype.updateChild=function(path,newChildNode){\nvar front=path.getFront();\nif(front===null){\nreturn newChildNode;\n}else\n{\nutil.assert(path.getFront()!=='.priority'||path.getLength()===1,'.priority must be the last token in a path');\nvar newImmediateChild=this.getImmediateChild(front).updateChild(path.popFront(),newChildNode);\nreturn this.updateImmediateChild(front,newImmediateChild);\n}\n};\n/** @inheritDoc */\nChildrenNode.prototype.isEmpty=function(){\nreturn this.children_.isEmpty();\n};\n/** @inheritDoc */\nChildrenNode.prototype.numChildren=function(){\nreturn this.children_.count();\n};\n/** @inheritDoc */\nChildrenNode.prototype.val=function(exportFormat){\nif(this.isEmpty()){\nreturn null;\n}\nvar obj={};\nvar numKeys=0,maxKey=0,allIntegerKeys=true;\nthis.forEachChild(PRIORITY_INDEX,function(key,childNode){\nobj[key]=childNode.val(exportFormat);\nnumKeys++;\nif(allIntegerKeys&&ChildrenNode.INTEGER_REGEXP_.test(key)){\nmaxKey=Math.max(maxKey,Number(key));\n}else\n{\nallIntegerKeys=false;\n}\n});\nif(!exportFormat&&allIntegerKeys&&maxKey<2*numKeys){\n// convert to array.\nvar array=[];\n// eslint-disable-next-line guard-for-in\nfor(var key in obj){\narray[key]=obj[key];\n}\nreturn array;\n}else\n{\nif(exportFormat&&!this.getPriority().isEmpty()){\nobj['.priority']=this.getPriority().val();\n}\nreturn obj;\n}\n};\n/** @inheritDoc */\nChildrenNode.prototype.hash=function(){\nif(this.lazyHash_===null){\nvar toHash_1='';\nif(!this.getPriority().isEmpty()){\ntoHash_1+=\n'priority:'+\npriorityHashText(this.getPriority().val())+\n':';\n}\nthis.forEachChild(PRIORITY_INDEX,function(key,childNode){\nvar childHash=childNode.hash();\nif(childHash!==''){\ntoHash_1+=':'+key+':'+childHash;\n}\n});\nthis.lazyHash_=toHash_1===''?'':sha1(toHash_1);\n}\nreturn this.lazyHash_;\n};\n/** @inheritDoc */\nChildrenNode.prototype.getPredecessorChildName=function(childName,childNode,index){\nvar idx=this.resolveIndex_(index);\nif(idx){\nvar predecessor=idx.getPredecessorKey(new NamedNode(childName,childNode));\nreturn predecessor?predecessor.name:null;\n}else\n{\nreturn this.children_.getPredecessorKey(childName);\n}\n};\n/**\r\n     * @param {!Index} indexDefinition\r\n     * @return {?string}\r\n     */\nChildrenNode.prototype.getFirstChildName=function(indexDefinition){\nvar idx=this.resolveIndex_(indexDefinition);\nif(idx){\nvar minKey=idx.minKey();\nreturn minKey&&minKey.name;\n}else\n{\nreturn this.children_.minKey();\n}\n};\n/**\r\n     * @param {!Index} indexDefinition\r\n     * @return {?NamedNode}\r\n     */\nChildrenNode.prototype.getFirstChild=function(indexDefinition){\nvar minKey=this.getFirstChildName(indexDefinition);\nif(minKey){\nreturn new NamedNode(minKey,this.children_.get(minKey));\n}else\n{\nreturn null;\n}\n};\n/**\r\n     * Given an index, return the key name of the largest value we have, according to that index\r\n     * @param {!Index} indexDefinition\r\n     * @return {?string}\r\n     */\nChildrenNode.prototype.getLastChildName=function(indexDefinition){\nvar idx=this.resolveIndex_(indexDefinition);\nif(idx){\nvar maxKey=idx.maxKey();\nreturn maxKey&&maxKey.name;\n}else\n{\nreturn this.children_.maxKey();\n}\n};\n/**\r\n     * @param {!Index} indexDefinition\r\n     * @return {?NamedNode}\r\n     */\nChildrenNode.prototype.getLastChild=function(indexDefinition){\nvar maxKey=this.getLastChildName(indexDefinition);\nif(maxKey){\nreturn new NamedNode(maxKey,this.children_.get(maxKey));\n}else\n{\nreturn null;\n}\n};\n/**\r\n     * @inheritDoc\r\n     */\nChildrenNode.prototype.forEachChild=function(index,action){\nvar idx=this.resolveIndex_(index);\nif(idx){\nreturn idx.inorderTraversal(function(wrappedNode){\nreturn action(wrappedNode.name,wrappedNode.node);\n});\n}else\n{\nreturn this.children_.inorderTraversal(action);\n}\n};\n/**\r\n     * @param {!Index} indexDefinition\r\n     * @return {SortedMapIterator}\r\n     */\nChildrenNode.prototype.getIterator=function(indexDefinition){\nreturn this.getIteratorFrom(indexDefinition.minPost(),indexDefinition);\n};\n/**\r\n     *\r\n     * @param {!NamedNode} startPost\r\n     * @param {!Index} indexDefinition\r\n     * @return {!SortedMapIterator}\r\n     */\nChildrenNode.prototype.getIteratorFrom=function(startPost,indexDefinition){\nvar idx=this.resolveIndex_(indexDefinition);\nif(idx){\nreturn idx.getIteratorFrom(startPost,function(key){return key;});\n}else\n{\nvar iterator=this.children_.getIteratorFrom(startPost.name,NamedNode.Wrap);\nvar next=iterator.peek();\nwhile(next!=null&&indexDefinition.compare(next,startPost)<0){\niterator.getNext();\nnext=iterator.peek();\n}\nreturn iterator;\n}\n};\n/**\r\n     * @param {!Index} indexDefinition\r\n     * @return {!SortedMapIterator}\r\n     */\nChildrenNode.prototype.getReverseIterator=function(indexDefinition){\nreturn this.getReverseIteratorFrom(indexDefinition.maxPost(),indexDefinition);\n};\n/**\r\n     * @param {!NamedNode} endPost\r\n     * @param {!Index} indexDefinition\r\n     * @return {!SortedMapIterator}\r\n     */\nChildrenNode.prototype.getReverseIteratorFrom=function(endPost,indexDefinition){\nvar idx=this.resolveIndex_(indexDefinition);\nif(idx){\nreturn idx.getReverseIteratorFrom(endPost,function(key){\nreturn key;\n});\n}else\n{\nvar iterator=this.children_.getReverseIteratorFrom(endPost.name,NamedNode.Wrap);\nvar next=iterator.peek();\nwhile(next!=null&&indexDefinition.compare(next,endPost)>0){\niterator.getNext();\nnext=iterator.peek();\n}\nreturn iterator;\n}\n};\n/**\r\n     * @inheritDoc\r\n     */\nChildrenNode.prototype.compareTo=function(other){\nif(this.isEmpty()){\nif(other.isEmpty()){\nreturn 0;\n}else\n{\nreturn-1;\n}\n}else\nif(other.isLeafNode()||other.isEmpty()){\nreturn 1;\n}else\nif(other===MAX_NODE$2){\nreturn-1;\n}else\n{\n// Must be another node with children.\nreturn 0;\n}\n};\n/**\r\n     * @inheritDoc\r\n     */\nChildrenNode.prototype.withIndex=function(indexDefinition){\nif(indexDefinition===KEY_INDEX||\nthis.indexMap_.hasIndex(indexDefinition)){\nreturn this;\n}else\n{\nvar newIndexMap=this.indexMap_.addIndex(indexDefinition,this.children_);\nreturn new ChildrenNode(this.children_,this.priorityNode_,newIndexMap);\n}\n};\n/**\r\n     * @inheritDoc\r\n     */\nChildrenNode.prototype.isIndexed=function(index){\nreturn index===KEY_INDEX||this.indexMap_.hasIndex(index);\n};\n/**\r\n     * @inheritDoc\r\n     */\nChildrenNode.prototype.equals=function(other){\nif(other===this){\nreturn true;\n}else\nif(other.isLeafNode()){\nreturn false;\n}else\n{\nvar otherChildrenNode=other;\nif(!this.getPriority().equals(otherChildrenNode.getPriority())){\nreturn false;\n}else\nif(this.children_.count()===otherChildrenNode.children_.count()){\nvar thisIter=this.getIterator(PRIORITY_INDEX);\nvar otherIter=otherChildrenNode.getIterator(PRIORITY_INDEX);\nvar thisCurrent=thisIter.getNext();\nvar otherCurrent=otherIter.getNext();\nwhile(thisCurrent&&otherCurrent){\nif(thisCurrent.name!==otherCurrent.name||\n!thisCurrent.node.equals(otherCurrent.node)){\nreturn false;\n}\nthisCurrent=thisIter.getNext();\notherCurrent=otherIter.getNext();\n}\nreturn thisCurrent===null&&otherCurrent===null;\n}else\n{\nreturn false;\n}\n}\n};\n/**\r\n     * Returns a SortedMap ordered by index, or null if the default (by-key) ordering can be used\r\n     * instead.\r\n     *\r\n     * @private\r\n     * @param {!Index} indexDefinition\r\n     * @return {?SortedMap.<NamedNode, Node>}\r\n     */\nChildrenNode.prototype.resolveIndex_=function(indexDefinition){\nif(indexDefinition===KEY_INDEX){\nreturn null;\n}else\n{\nreturn this.indexMap_.get(indexDefinition.toString());\n}\n};\n/**\r\n     * @private\r\n     * @type {RegExp}\r\n     */\nChildrenNode.INTEGER_REGEXP_=/^(0|[1-9]\\d*)$/;\nreturn ChildrenNode;\n}();\n/**\r\n * @constructor\r\n * @extends {ChildrenNode}\r\n * @private\r\n */\nvar MaxNode=/** @class */function(_super){\ntslib.__extends(MaxNode,_super);\nfunction MaxNode(){\nreturn _super.call(this,new SortedMap(NAME_COMPARATOR),ChildrenNode.EMPTY_NODE,IndexMap.Default)||this;\n}\nMaxNode.prototype.compareTo=function(other){\nif(other===this){\nreturn 0;\n}else\n{\nreturn 1;\n}\n};\nMaxNode.prototype.equals=function(other){\n// Not that we every compare it, but MAX_NODE is only ever equal to itself\nreturn other===this;\n};\nMaxNode.prototype.getPriority=function(){\nreturn this;\n};\nMaxNode.prototype.getImmediateChild=function(childName){\nreturn ChildrenNode.EMPTY_NODE;\n};\nMaxNode.prototype.isEmpty=function(){\nreturn false;\n};\nreturn MaxNode;\n}(ChildrenNode);\n/**\r\n * Marker that will sort higher than any other snapshot.\r\n * @type {!MAX_NODE}\r\n * @const\r\n */\nvar MAX_NODE$2=new MaxNode();\nObject.defineProperties(NamedNode,{\nMIN:{\nvalue:new NamedNode(MIN_NAME,ChildrenNode.EMPTY_NODE)},\n\nMAX:{\nvalue:new NamedNode(MAX_NAME,MAX_NODE$2)}});\n\n\n/**\r\n * Reference Extensions\r\n */\nKeyIndex.__EMPTY_NODE=ChildrenNode.EMPTY_NODE;\nLeafNode.__childrenNodeConstructor=ChildrenNode;\nsetMaxNode(MAX_NODE$2);\nsetMaxNode$1(MAX_NODE$2);\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\nvar USE_HINZE=true;\n/**\r\n * Constructs a snapshot node representing the passed JSON and returns it.\r\n * @param {*} json JSON to create a node for.\r\n * @param {?string|?number=} priority Optional priority to use.  This will be ignored if the\r\n * passed JSON contains a .priority property.\r\n * @return {!Node}\r\n */\nfunction nodeFromJSON$1(json,priority){\nif(priority===void 0){priority=null;}\nif(json===null){\nreturn ChildrenNode.EMPTY_NODE;\n}\nif((typeof json==='undefined'?'undefined':_typeof(json))==='object'&&'.priority'in json){\npriority=json['.priority'];\n}\nutil.assert(priority===null||\ntypeof priority==='string'||\ntypeof priority==='number'||\n(typeof priority==='undefined'?'undefined':_typeof(priority))==='object'&&'.sv'in priority,'Invalid priority type found: '+(typeof priority==='undefined'?'undefined':_typeof(priority)));\nif((typeof json==='undefined'?'undefined':_typeof(json))==='object'&&'.value'in json&&json['.value']!==null){\njson=json['.value'];\n}\n// Valid leaf nodes include non-objects or server-value wrapper objects\nif((typeof json==='undefined'?'undefined':_typeof(json))!=='object'||'.sv'in json){\nvar jsonLeaf=json;\nreturn new LeafNode(jsonLeaf,nodeFromJSON$1(priority));\n}\nif(!(json instanceof Array)&&USE_HINZE){\nvar children_1=[];\nvar childrenHavePriority_1=false;\nvar hinzeJsonObj=json;\neach(hinzeJsonObj,function(key,child){\nif(key.substring(0,1)!=='.'){\n// Ignore metadata nodes\nvar childNode=nodeFromJSON$1(child);\nif(!childNode.isEmpty()){\nchildrenHavePriority_1=\nchildrenHavePriority_1||!childNode.getPriority().isEmpty();\nchildren_1.push(new NamedNode(key,childNode));\n}\n}\n});\nif(children_1.length===0){\nreturn ChildrenNode.EMPTY_NODE;\n}\nvar childSet=buildChildSet(children_1,NAME_ONLY_COMPARATOR,function(namedNode){return namedNode.name;},NAME_COMPARATOR);\nif(childrenHavePriority_1){\nvar sortedChildSet=buildChildSet(children_1,PRIORITY_INDEX.getCompare());\nreturn new ChildrenNode(childSet,nodeFromJSON$1(priority),new IndexMap({'.priority':sortedChildSet},{'.priority':PRIORITY_INDEX}));\n}else\n{\nreturn new ChildrenNode(childSet,nodeFromJSON$1(priority),IndexMap.Default);\n}\n}else\n{\nvar node_1=ChildrenNode.EMPTY_NODE;\neach(json,function(key,childData){\nif(util.contains(json,key)){\nif(key.substring(0,1)!=='.'){\n// ignore metadata nodes.\nvar childNode=nodeFromJSON$1(childData);\nif(childNode.isLeafNode()||!childNode.isEmpty()){\nnode_1=node_1.updateImmediateChild(key,childNode);\n}\n}\n}\n});\nreturn node_1.updatePriority(nodeFromJSON$1(priority));\n}\n}\nsetNodeFromJSON(nodeFromJSON$1);\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n/**\r\n * @constructor\r\n * @extends {Index}\r\n * @private\r\n */\nvar ValueIndex=/** @class */function(_super){\ntslib.__extends(ValueIndex,_super);\nfunction ValueIndex(){\nreturn _super!==null&&_super.apply(this,arguments)||this;\n}\n/**\r\n     * @inheritDoc\r\n     */\nValueIndex.prototype.compare=function(a,b){\nvar indexCmp=a.node.compareTo(b.node);\nif(indexCmp===0){\nreturn nameCompare(a.name,b.name);\n}else\n{\nreturn indexCmp;\n}\n};\n/**\r\n     * @inheritDoc\r\n     */\nValueIndex.prototype.isDefinedOn=function(node){\nreturn true;\n};\n/**\r\n     * @inheritDoc\r\n     */\nValueIndex.prototype.indexedValueChanged=function(oldNode,newNode){\nreturn!oldNode.equals(newNode);\n};\n/**\r\n     * @inheritDoc\r\n     */\nValueIndex.prototype.minPost=function(){\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nreturn NamedNode.MIN;\n};\n/**\r\n     * @inheritDoc\r\n     */\nValueIndex.prototype.maxPost=function(){\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nreturn NamedNode.MAX;\n};\n/**\r\n     * @param {*} indexValue\r\n     * @param {string} name\r\n     * @return {!NamedNode}\r\n     */\nValueIndex.prototype.makePost=function(indexValue,name){\nvar valueNode=nodeFromJSON$1(indexValue);\nreturn new NamedNode(name,valueNode);\n};\n/**\r\n     * @return {!string} String representation for inclusion in a query spec\r\n     */\nValueIndex.prototype.toString=function(){\nreturn'.value';\n};\nreturn ValueIndex;\n}(Index);\nvar VALUE_INDEX=new ValueIndex();\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n/**\r\n * @param {!Path} indexPath\r\n * @constructor\r\n * @extends {Index}\r\n */\nvar PathIndex=/** @class */function(_super){\ntslib.__extends(PathIndex,_super);\nfunction PathIndex(indexPath_){\nvar _this=_super.call(this)||this;\n_this.indexPath_=indexPath_;\nutil.assert(!indexPath_.isEmpty()&&indexPath_.getFront()!=='.priority',\"Can't create PathIndex with empty path or .priority key\");\nreturn _this;\n}\n/**\r\n     * @param {!Node} snap\r\n     * @return {!Node}\r\n     * @protected\r\n     */\nPathIndex.prototype.extractChild=function(snap){\nreturn snap.getChild(this.indexPath_);\n};\n/**\r\n     * @inheritDoc\r\n     */\nPathIndex.prototype.isDefinedOn=function(node){\nreturn!node.getChild(this.indexPath_).isEmpty();\n};\n/**\r\n     * @inheritDoc\r\n     */\nPathIndex.prototype.compare=function(a,b){\nvar aChild=this.extractChild(a.node);\nvar bChild=this.extractChild(b.node);\nvar indexCmp=aChild.compareTo(bChild);\nif(indexCmp===0){\nreturn nameCompare(a.name,b.name);\n}else\n{\nreturn indexCmp;\n}\n};\n/**\r\n     * @inheritDoc\r\n     */\nPathIndex.prototype.makePost=function(indexValue,name){\nvar valueNode=nodeFromJSON$1(indexValue);\nvar node=ChildrenNode.EMPTY_NODE.updateChild(this.indexPath_,valueNode);\nreturn new NamedNode(name,node);\n};\n/**\r\n     * @inheritDoc\r\n     */\nPathIndex.prototype.maxPost=function(){\nvar node=ChildrenNode.EMPTY_NODE.updateChild(this.indexPath_,MAX_NODE$2);\nreturn new NamedNode(MAX_NAME,node);\n};\n/**\r\n     * @inheritDoc\r\n     */\nPathIndex.prototype.toString=function(){\nreturn this.indexPath_.slice().join('/');\n};\nreturn PathIndex;\n}(Index);\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n/**\r\n * Class representing a firebase data snapshot.  It wraps a SnapshotNode and\r\n * surfaces the public methods (val, forEach, etc.) we want to expose.\r\n */\nvar DataSnapshot=/** @class */function(){\n/**\r\n     * @param {!Node} node_ A SnapshotNode to wrap.\r\n     * @param {!Reference} ref_ The ref of the location this snapshot came from.\r\n     * @param {!Index} index_ The iteration order for this snapshot\r\n     */\nfunction DataSnapshot(node_,ref_,index_){\nthis.node_=node_;\nthis.ref_=ref_;\nthis.index_=index_;\n}\n/**\r\n     * Retrieves the snapshot contents as JSON.  Returns null if the snapshot is\r\n     * empty.\r\n     *\r\n     * @return {*} JSON representation of the DataSnapshot contents, or null if empty.\r\n     */\nDataSnapshot.prototype.val=function(){\nutil.validateArgCount('DataSnapshot.val',0,0,arguments.length);\nreturn this.node_.val();\n};\n/**\r\n     * Returns the snapshot contents as JSON, including priorities of node.  Suitable for exporting\r\n     * the entire node contents.\r\n     * @return {*} JSON representation of the DataSnapshot contents, or null if empty.\r\n     */\nDataSnapshot.prototype.exportVal=function(){\nutil.validateArgCount('DataSnapshot.exportVal',0,0,arguments.length);\nreturn this.node_.val(true);\n};\n// Do not create public documentation. This is intended to make JSON serialization work but is otherwise unnecessary\n// for end-users\nDataSnapshot.prototype.toJSON=function(){\n// Optional spacer argument is unnecessary because we're depending on recursion rather than stringifying the content\nutil.validateArgCount('DataSnapshot.toJSON',0,1,arguments.length);\nreturn this.exportVal();\n};\n/**\r\n     * Returns whether the snapshot contains a non-null value.\r\n     *\r\n     * @return {boolean} Whether the snapshot contains a non-null value, or is empty.\r\n     */\nDataSnapshot.prototype.exists=function(){\nutil.validateArgCount('DataSnapshot.exists',0,0,arguments.length);\nreturn!this.node_.isEmpty();\n};\n/**\r\n     * Returns a DataSnapshot of the specified child node's contents.\r\n     *\r\n     * @param {!string} childPathString Path to a child.\r\n     * @return {!DataSnapshot} DataSnapshot for child node.\r\n     */\nDataSnapshot.prototype.child=function(childPathString){\nutil.validateArgCount('DataSnapshot.child',0,1,arguments.length);\n// Ensure the childPath is a string (can be a number)\nchildPathString=String(childPathString);\nvalidatePathString('DataSnapshot.child',1,childPathString,false);\nvar childPath=new Path(childPathString);\nvar childRef=this.ref_.child(childPath);\nreturn new DataSnapshot(this.node_.getChild(childPath),childRef,PRIORITY_INDEX);\n};\n/**\r\n     * Returns whether the snapshot contains a child at the specified path.\r\n     *\r\n     * @param {!string} childPathString Path to a child.\r\n     * @return {boolean} Whether the child exists.\r\n     */\nDataSnapshot.prototype.hasChild=function(childPathString){\nutil.validateArgCount('DataSnapshot.hasChild',1,1,arguments.length);\nvalidatePathString('DataSnapshot.hasChild',1,childPathString,false);\nvar childPath=new Path(childPathString);\nreturn!this.node_.getChild(childPath).isEmpty();\n};\n/**\r\n     * Returns the priority of the object, or null if no priority was set.\r\n     *\r\n     * @return {string|number|null} The priority.\r\n     */\nDataSnapshot.prototype.getPriority=function(){\nutil.validateArgCount('DataSnapshot.getPriority',0,0,arguments.length);\n// typecast here because we never return deferred values or internal priorities (MAX_PRIORITY)\nreturn this.node_.getPriority().val();\n};\n/**\r\n     * Iterates through child nodes and calls the specified action for each one.\r\n     *\r\n     * @param {function(!DataSnapshot)} action Callback function to be called\r\n     * for each child.\r\n     * @return {boolean} True if forEach was canceled by action returning true for\r\n     * one of the child nodes.\r\n     */\nDataSnapshot.prototype.forEach=function(action){\nvar _this=this;\nutil.validateArgCount('DataSnapshot.forEach',1,1,arguments.length);\nutil.validateCallback('DataSnapshot.forEach',1,action,false);\nif(this.node_.isLeafNode()){\nreturn false;\n}\nvar childrenNode=this.node_;\n// Sanitize the return value to a boolean. ChildrenNode.forEachChild has a weird return type...\nreturn!!childrenNode.forEachChild(this.index_,function(key,node){\nreturn action(new DataSnapshot(node,_this.ref_.child(key),PRIORITY_INDEX));\n});\n};\n/**\r\n     * Returns whether this DataSnapshot has children.\r\n     * @return {boolean} True if the DataSnapshot contains 1 or more child nodes.\r\n     */\nDataSnapshot.prototype.hasChildren=function(){\nutil.validateArgCount('DataSnapshot.hasChildren',0,0,arguments.length);\nif(this.node_.isLeafNode()){\nreturn false;\n}else\n{\nreturn!this.node_.isEmpty();\n}\n};\nObject.defineProperty(DataSnapshot.prototype,\"key\",{\nget:function get(){\nreturn this.ref_.getKey();\n},\nenumerable:false,\nconfigurable:true});\n\n/**\r\n     * Returns the number of children for this DataSnapshot.\r\n     * @return {number} The number of children that this DataSnapshot contains.\r\n     */\nDataSnapshot.prototype.numChildren=function(){\nutil.validateArgCount('DataSnapshot.numChildren',0,0,arguments.length);\nreturn this.node_.numChildren();\n};\n/**\r\n     * @return {Reference} The Firebase reference for the location this snapshot's data came from.\r\n     */\nDataSnapshot.prototype.getRef=function(){\nutil.validateArgCount('DataSnapshot.ref',0,0,arguments.length);\nreturn this.ref_;\n};\nObject.defineProperty(DataSnapshot.prototype,\"ref\",{\nget:function get(){\nreturn this.getRef();\n},\nenumerable:false,\nconfigurable:true});\n\nreturn DataSnapshot;\n}();\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n/**\r\n * Encapsulates the data needed to raise an event\r\n * @implements {Event}\r\n */\nvar DataEvent=/** @class */function(){\n/**\r\n     * @param {!string} eventType One of: value, child_added, child_changed, child_moved, child_removed\r\n     * @param {!EventRegistration} eventRegistration The function to call to with the event data. User provided\r\n     * @param {!DataSnapshot} snapshot The data backing the event\r\n     * @param {?string=} prevName Optional, the name of the previous child for child_* events.\r\n     */\nfunction DataEvent(eventType,eventRegistration,snapshot,prevName){\nthis.eventType=eventType;\nthis.eventRegistration=eventRegistration;\nthis.snapshot=snapshot;\nthis.prevName=prevName;\n}\n/**\r\n     * @inheritDoc\r\n     */\nDataEvent.prototype.getPath=function(){\nvar ref=this.snapshot.getRef();\nif(this.eventType==='value'){\nreturn ref.path;\n}else\n{\nreturn ref.getParent().path;\n}\n};\n/**\r\n     * @inheritDoc\r\n     */\nDataEvent.prototype.getEventType=function(){\nreturn this.eventType;\n};\n/**\r\n     * @inheritDoc\r\n     */\nDataEvent.prototype.getEventRunner=function(){\nreturn this.eventRegistration.getEventRunner(this);\n};\n/**\r\n     * @inheritDoc\r\n     */\nDataEvent.prototype.toString=function(){\nreturn this.getPath().toString()+\n':'+\nthis.eventType+\n':'+\nutil.stringify(this.snapshot.exportVal());\n};\nreturn DataEvent;\n}();\nvar CancelEvent=/** @class */function(){\n/**\r\n     * @param {EventRegistration} eventRegistration\r\n     * @param {Error} error\r\n     * @param {!Path} path\r\n     */\nfunction CancelEvent(eventRegistration,error,path){\nthis.eventRegistration=eventRegistration;\nthis.error=error;\nthis.path=path;\n}\n/**\r\n     * @inheritDoc\r\n     */\nCancelEvent.prototype.getPath=function(){\nreturn this.path;\n};\n/**\r\n     * @inheritDoc\r\n     */\nCancelEvent.prototype.getEventType=function(){\nreturn'cancel';\n};\n/**\r\n     * @inheritDoc\r\n     */\nCancelEvent.prototype.getEventRunner=function(){\nreturn this.eventRegistration.getEventRunner(this);\n};\n/**\r\n     * @inheritDoc\r\n     */\nCancelEvent.prototype.toString=function(){\nreturn this.path.toString()+':cancel';\n};\nreturn CancelEvent;\n}();\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n/**\r\n * Represents registration for 'value' events.\r\n */\nvar ValueEventRegistration=/** @class */function(){\n/**\r\n     * @param {?function(!DataSnapshot)} callback_\r\n     * @param {?function(Error)} cancelCallback_\r\n     * @param {?Object} context_\r\n     */\nfunction ValueEventRegistration(callback_,cancelCallback_,context_){\nthis.callback_=callback_;\nthis.cancelCallback_=cancelCallback_;\nthis.context_=context_;\n}\n/**\r\n     * @inheritDoc\r\n     */\nValueEventRegistration.prototype.respondsTo=function(eventType){\nreturn eventType==='value';\n};\n/**\r\n     * @inheritDoc\r\n     */\nValueEventRegistration.prototype.createEvent=function(change,query){\nvar index=query.getQueryParams().getIndex();\nreturn new DataEvent('value',this,new DataSnapshot(change.snapshotNode,query.getRef(),index));\n};\n/**\r\n     * @inheritDoc\r\n     */\nValueEventRegistration.prototype.getEventRunner=function(eventData){\nvar ctx=this.context_;\nif(eventData.getEventType()==='cancel'){\nutil.assert(this.cancelCallback_,'Raising a cancel event on a listener with no cancel callback');\nvar cancelCB_1=this.cancelCallback_;\nreturn function(){\n// We know that error exists, we checked above that this is a cancel event\ncancelCB_1.call(ctx,eventData.error);\n};\n}else\n{\nvar cb_1=this.callback_;\nreturn function(){\ncb_1.call(ctx,eventData.snapshot);\n};\n}\n};\n/**\r\n     * @inheritDoc\r\n     */\nValueEventRegistration.prototype.createCancelEvent=function(error,path){\nif(this.cancelCallback_){\nreturn new CancelEvent(this,error,path);\n}else\n{\nreturn null;\n}\n};\n/**\r\n     * @inheritDoc\r\n     */\nValueEventRegistration.prototype.matches=function(other){\nif(!(other instanceof ValueEventRegistration)){\nreturn false;\n}else\nif(!other.callback_||!this.callback_){\n// If no callback specified, we consider it to match any callback.\nreturn true;\n}else\n{\nreturn other.callback_===this.callback_&&other.context_===this.context_;\n}\n};\n/**\r\n     * @inheritDoc\r\n     */\nValueEventRegistration.prototype.hasAnyCallback=function(){\nreturn this.callback_!==null;\n};\nreturn ValueEventRegistration;\n}();\n/**\r\n * Represents the registration of 1 or more child_xxx events.\r\n *\r\n * Currently, it is always exactly 1 child_xxx event, but the idea is we might let you\r\n * register a group of callbacks together in the future.\r\n *\r\n * @constructor\r\n * @implements {EventRegistration}\r\n */\nvar ChildEventRegistration=/** @class */function(){\n/**\r\n     * @param {?Object.<string, function(!DataSnapshot, ?string=)>} callbacks_\r\n     * @param {?function(Error)} cancelCallback_\r\n     * @param {Object=} context_\r\n     */\nfunction ChildEventRegistration(callbacks_,cancelCallback_,context_){\nthis.callbacks_=callbacks_;\nthis.cancelCallback_=cancelCallback_;\nthis.context_=context_;\n}\n/**\r\n     * @inheritDoc\r\n     */\nChildEventRegistration.prototype.respondsTo=function(eventType){\nvar eventToCheck=eventType==='children_added'?'child_added':eventType;\neventToCheck=\neventToCheck==='children_removed'?'child_removed':eventToCheck;\nreturn util.contains(this.callbacks_,eventToCheck);\n};\n/**\r\n     * @inheritDoc\r\n     */\nChildEventRegistration.prototype.createCancelEvent=function(error,path){\nif(this.cancelCallback_){\nreturn new CancelEvent(this,error,path);\n}else\n{\nreturn null;\n}\n};\n/**\r\n     * @inheritDoc\r\n     */\nChildEventRegistration.prototype.createEvent=function(change,query){\nutil.assert(change.childName!=null,'Child events should have a childName.');\nvar ref=query.getRef().child(/** @type {!string} */change.childName);\nvar index=query.getQueryParams().getIndex();\nreturn new DataEvent(change.type,this,new DataSnapshot(change.snapshotNode,ref,index),change.prevName);\n};\n/**\r\n     * @inheritDoc\r\n     */\nChildEventRegistration.prototype.getEventRunner=function(eventData){\nvar ctx=this.context_;\nif(eventData.getEventType()==='cancel'){\nutil.assert(this.cancelCallback_,'Raising a cancel event on a listener with no cancel callback');\nvar cancelCB_2=this.cancelCallback_;\nreturn function(){\n// We know that error exists, we checked above that this is a cancel event\ncancelCB_2.call(ctx,eventData.error);\n};\n}else\n{\nvar cb_2=this.callbacks_[eventData.eventType];\nreturn function(){\ncb_2.call(ctx,eventData.snapshot,eventData.prevName);\n};\n}\n};\n/**\r\n     * @inheritDoc\r\n     */\nChildEventRegistration.prototype.matches=function(other){\nvar _this=this;\nif(other instanceof ChildEventRegistration){\nif(!this.callbacks_||!other.callbacks_){\nreturn true;\n}else\nif(this.context_===other.context_){\nvar otherKeys=Object.keys(other.callbacks_);\nvar thisKeys=Object.keys(this.callbacks_);\nvar otherCount=otherKeys.length;\nvar thisCount=thisKeys.length;\nif(otherCount===thisCount){\n// If count is 1, do an exact match on eventType, if either is defined but null, it's a match.\n// If event types don't match, not a match\n// If count is not 1, exact match across all\nif(otherCount===1){\nvar otherKey=otherKeys[0];\nvar thisKey=thisKeys[0];\nreturn thisKey===otherKey&&(\n!other.callbacks_[otherKey]||\n!this.callbacks_[thisKey]||\nother.callbacks_[otherKey]===this.callbacks_[thisKey]);\n}else\n{\n// Exact match on each key.\nreturn thisKeys.every(function(eventType){\nreturn other.callbacks_[eventType]===_this.callbacks_[eventType];\n});\n}\n}\n}\n}\nreturn false;\n};\n/**\r\n     * @inheritDoc\r\n     */\nChildEventRegistration.prototype.hasAnyCallback=function(){\nreturn this.callbacks_!==null;\n};\nreturn ChildEventRegistration;\n}();\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\nvar __referenceConstructor;\n/**\r\n * A Query represents a filter to be applied to a firebase location.  This object purely represents the\r\n * query expression (and exposes our public API to build the query).  The actual query logic is in ViewBase.js.\r\n *\r\n * Since every Firebase reference is a query, Firebase inherits from this object.\r\n */\nvar Query=/** @class */function(){\nfunction Query(repo,path,queryParams_,orderByCalled_){\nthis.repo=repo;\nthis.path=path;\nthis.queryParams_=queryParams_;\nthis.orderByCalled_=orderByCalled_;\n}\nObject.defineProperty(Query,\"__referenceConstructor\",{\nget:function get(){\nutil.assert(__referenceConstructor,'Reference.ts has not been loaded');\nreturn __referenceConstructor;\n},\nset:function set(val){\n__referenceConstructor=val;\n},\nenumerable:false,\nconfigurable:true});\n\n/**\r\n     * Validates start/end values for queries.\r\n     * @param {!QueryParams} params\r\n     * @private\r\n     */\nQuery.validateQueryEndpoints_=function(params){\nvar startNode=null;\nvar endNode=null;\nif(params.hasStart()){\nstartNode=params.getIndexStartValue();\n}\nif(params.hasEnd()){\nendNode=params.getIndexEndValue();\n}\nif(params.getIndex()===KEY_INDEX){\nvar tooManyArgsError='Query: When ordering by key, you may only pass one argument to '+\n'startAt(), endAt(), or equalTo().';\nvar wrongArgTypeError='Query: When ordering by key, the argument passed to startAt(), endAt(),'+\n'or equalTo() must be a string.';\nif(params.hasStart()){\nvar startName=params.getIndexStartName();\nif(startName!==MIN_NAME){\nthrow new Error(tooManyArgsError);\n}else\nif(typeof startNode!=='string'){\nthrow new Error(wrongArgTypeError);\n}\n}\nif(params.hasEnd()){\nvar endName=params.getIndexEndName();\nif(endName!==MAX_NAME){\nthrow new Error(tooManyArgsError);\n}else\nif(typeof endNode!=='string'){\nthrow new Error(wrongArgTypeError);\n}\n}\n}else\nif(params.getIndex()===PRIORITY_INDEX){\nif(startNode!=null&&!isValidPriority(startNode)||\nendNode!=null&&!isValidPriority(endNode)){\nthrow new Error('Query: When ordering by priority, the first argument passed to startAt(), '+\n'endAt(), or equalTo() must be a valid priority value (null, a number, or a string).');\n}\n}else\n{\nutil.assert(params.getIndex()instanceof PathIndex||\nparams.getIndex()===VALUE_INDEX,'unknown index type.');\nif(startNode!=null&&(typeof startNode==='undefined'?'undefined':_typeof(startNode))==='object'||\nendNode!=null&&(typeof endNode==='undefined'?'undefined':_typeof(endNode))==='object'){\nthrow new Error('Query: First argument passed to startAt(), endAt(), or equalTo() cannot be '+\n'an object.');\n}\n}\n};\n/**\r\n     * Validates that limit* has been called with the correct combination of parameters\r\n     * @param {!QueryParams} params\r\n     * @private\r\n     */\nQuery.validateLimit_=function(params){\nif(params.hasStart()&&\nparams.hasEnd()&&\nparams.hasLimit()&&\n!params.hasAnchoredLimit()){\nthrow new Error(\"Query: Can't combine startAt(), endAt(), and limit(). Use limitToFirst() or limitToLast() instead.\");\n}\n};\n/**\r\n     * Validates that no other order by call has been made\r\n     * @param {!string} fnName\r\n     * @private\r\n     */\nQuery.prototype.validateNoPreviousOrderByCall_=function(fnName){\nif(this.orderByCalled_===true){\nthrow new Error(fnName+\": You can't combine multiple orderBy calls.\");\n}\n};\n/**\r\n     * @return {!QueryParams}\r\n     */\nQuery.prototype.getQueryParams=function(){\nreturn this.queryParams_;\n};\n/**\r\n     * @return {!Reference}\r\n     */\nQuery.prototype.getRef=function(){\nutil.validateArgCount('Query.ref',0,0,arguments.length);\n// This is a slight hack. We cannot goog.require('fb.api.Firebase'), since Firebase requires fb.api.Query.\n// However, we will always export 'Firebase' to the global namespace, so it's guaranteed to exist by the time this\n// method gets called.\nreturn new Query.__referenceConstructor(this.repo,this.path);\n};\n/**\r\n     * @param {!string} eventType\r\n     * @param {!function(DataSnapshot, string=)} callback\r\n     * @param {(function(Error)|Object)=} cancelCallbackOrContext\r\n     * @param {Object=} context\r\n     * @return {!function(DataSnapshot, string=)}\r\n     */\nQuery.prototype.on=function(eventType,callback,cancelCallbackOrContext,context){\nutil.validateArgCount('Query.on',2,4,arguments.length);\nvalidateEventType('Query.on',1,eventType,false);\nutil.validateCallback('Query.on',2,callback,false);\nvar ret=Query.getCancelAndContextArgs_('Query.on',cancelCallbackOrContext,context);\nif(eventType==='value'){\nthis.onValueEvent(callback,ret.cancel,ret.context);\n}else\n{\nvar callbacks={};\ncallbacks[eventType]=callback;\nthis.onChildEvent(callbacks,ret.cancel,ret.context);\n}\nreturn callback;\n};\n/**\r\n     * @param {!function(!DataSnapshot)} callback\r\n     * @param {?function(Error)} cancelCallback\r\n     * @param {?Object} context\r\n     * @protected\r\n     */\nQuery.prototype.onValueEvent=function(callback,cancelCallback,context){\nvar container=new ValueEventRegistration(callback,cancelCallback||null,context||null);\nthis.repo.addEventCallbackForQuery(this,container);\n};\n/**\r\n     * @param {!Object.<string, !function(!DataSnapshot, ?string)>} callbacks\r\n     * @param {?function(Error)} cancelCallback\r\n     * @param {?Object} context\r\n     * @protected\r\n     */\nQuery.prototype.onChildEvent=function(callbacks,cancelCallback,context){\nvar container=new ChildEventRegistration(callbacks,cancelCallback,context);\nthis.repo.addEventCallbackForQuery(this,container);\n};\n/**\r\n     * @param {string=} eventType\r\n     * @param {(function(!DataSnapshot, ?string=))=} callback\r\n     * @param {Object=} context\r\n     */\nQuery.prototype.off=function(eventType,callback,context){\nutil.validateArgCount('Query.off',0,3,arguments.length);\nvalidateEventType('Query.off',1,eventType,true);\nutil.validateCallback('Query.off',2,callback,true);\nutil.validateContextObject('Query.off',3,context,true);\nvar container=null;\nvar callbacks=null;\nif(eventType==='value'){\nvar valueCallback=callback||null;\ncontainer=new ValueEventRegistration(valueCallback,null,context||null);\n}else\nif(eventType){\nif(callback){\ncallbacks={};\ncallbacks[eventType]=callback;\n}\ncontainer=new ChildEventRegistration(callbacks,null,context||null);\n}\nthis.repo.removeEventCallbackForQuery(this,container);\n};\n/**\r\n     * Attaches a listener, waits for the first event, and then removes the listener\r\n     * @param {!string} eventType\r\n     * @param {!function(!DataSnapshot, string=)} userCallback\r\n     * @param failureCallbackOrContext\r\n     * @param context\r\n     * @return {!firebase.Promise}\r\n     */\nQuery.prototype.once=function(eventType,userCallback,failureCallbackOrContext,context){\nvar _this=this;\nutil.validateArgCount('Query.once',1,4,arguments.length);\nvalidateEventType('Query.once',1,eventType,false);\nutil.validateCallback('Query.once',2,userCallback,true);\nvar ret=Query.getCancelAndContextArgs_('Query.once',failureCallbackOrContext,context);\n// TODO: Implement this more efficiently (in particular, use 'get' wire protocol for 'value' event)\n// TODO: consider actually wiring the callbacks into the promise. We cannot do this without a breaking change\n// because the API currently expects callbacks will be called synchronously if the data is cached, but this is\n// against the Promise specification.\nvar firstCall=true;\nvar deferred=new util.Deferred();\n// A dummy error handler in case a user wasn't expecting promises\ndeferred.promise.catch(function(){});\nvar onceCallback=function onceCallback(snapshot){\n// NOTE: Even though we unsubscribe, we may get called multiple times if a single action (e.g. set() with JSON)\n// triggers multiple events (e.g. child_added or child_changed).\nif(firstCall){\nfirstCall=false;\n_this.off(eventType,onceCallback);\nif(userCallback){\nuserCallback.bind(ret.context)(snapshot);\n}\ndeferred.resolve(snapshot);\n}\n};\nthis.on(eventType,onceCallback,\n/*cancel=*/function(err){\n_this.off(eventType,onceCallback);\nif(ret.cancel){\nret.cancel.bind(ret.context)(err);\n}\ndeferred.reject(err);\n});\nreturn deferred.promise;\n};\n/**\r\n     * Set a limit and anchor it to the start of the window.\r\n     * @param {!number} limit\r\n     * @return {!Query}\r\n     */\nQuery.prototype.limitToFirst=function(limit){\nutil.validateArgCount('Query.limitToFirst',1,1,arguments.length);\nif(typeof limit!=='number'||\nMath.floor(limit)!==limit||\nlimit<=0){\nthrow new Error('Query.limitToFirst: First argument must be a positive integer.');\n}\nif(this.queryParams_.hasLimit()){\nthrow new Error('Query.limitToFirst: Limit was already set (by another call to limit, '+\n'limitToFirst, or limitToLast).');\n}\nreturn new Query(this.repo,this.path,this.queryParams_.limitToFirst(limit),this.orderByCalled_);\n};\n/**\r\n     * Set a limit and anchor it to the end of the window.\r\n     * @param {!number} limit\r\n     * @return {!Query}\r\n     */\nQuery.prototype.limitToLast=function(limit){\nutil.validateArgCount('Query.limitToLast',1,1,arguments.length);\nif(typeof limit!=='number'||\nMath.floor(limit)!==limit||\nlimit<=0){\nthrow new Error('Query.limitToLast: First argument must be a positive integer.');\n}\nif(this.queryParams_.hasLimit()){\nthrow new Error('Query.limitToLast: Limit was already set (by another call to limit, '+\n'limitToFirst, or limitToLast).');\n}\nreturn new Query(this.repo,this.path,this.queryParams_.limitToLast(limit),this.orderByCalled_);\n};\n/**\r\n     * Given a child path, return a new query ordered by the specified grandchild path.\r\n     * @param {!string} path\r\n     * @return {!Query}\r\n     */\nQuery.prototype.orderByChild=function(path){\nutil.validateArgCount('Query.orderByChild',1,1,arguments.length);\nif(path==='$key'){\nthrow new Error('Query.orderByChild: \"$key\" is invalid.  Use Query.orderByKey() instead.');\n}else\nif(path==='$priority'){\nthrow new Error('Query.orderByChild: \"$priority\" is invalid.  Use Query.orderByPriority() instead.');\n}else\nif(path==='$value'){\nthrow new Error('Query.orderByChild: \"$value\" is invalid.  Use Query.orderByValue() instead.');\n}\nvalidatePathString('Query.orderByChild',1,path,false);\nthis.validateNoPreviousOrderByCall_('Query.orderByChild');\nvar parsedPath=new Path(path);\nif(parsedPath.isEmpty()){\nthrow new Error('Query.orderByChild: cannot pass in empty path.  Use Query.orderByValue() instead.');\n}\nvar index=new PathIndex(parsedPath);\nvar newParams=this.queryParams_.orderBy(index);\nQuery.validateQueryEndpoints_(newParams);\nreturn new Query(this.repo,this.path,newParams,/*orderByCalled=*/true);\n};\n/**\r\n     * Return a new query ordered by the KeyIndex\r\n     * @return {!Query}\r\n     */\nQuery.prototype.orderByKey=function(){\nutil.validateArgCount('Query.orderByKey',0,0,arguments.length);\nthis.validateNoPreviousOrderByCall_('Query.orderByKey');\nvar newParams=this.queryParams_.orderBy(KEY_INDEX);\nQuery.validateQueryEndpoints_(newParams);\nreturn new Query(this.repo,this.path,newParams,/*orderByCalled=*/true);\n};\n/**\r\n     * Return a new query ordered by the PriorityIndex\r\n     * @return {!Query}\r\n     */\nQuery.prototype.orderByPriority=function(){\nutil.validateArgCount('Query.orderByPriority',0,0,arguments.length);\nthis.validateNoPreviousOrderByCall_('Query.orderByPriority');\nvar newParams=this.queryParams_.orderBy(PRIORITY_INDEX);\nQuery.validateQueryEndpoints_(newParams);\nreturn new Query(this.repo,this.path,newParams,/*orderByCalled=*/true);\n};\n/**\r\n     * Return a new query ordered by the ValueIndex\r\n     * @return {!Query}\r\n     */\nQuery.prototype.orderByValue=function(){\nutil.validateArgCount('Query.orderByValue',0,0,arguments.length);\nthis.validateNoPreviousOrderByCall_('Query.orderByValue');\nvar newParams=this.queryParams_.orderBy(VALUE_INDEX);\nQuery.validateQueryEndpoints_(newParams);\nreturn new Query(this.repo,this.path,newParams,/*orderByCalled=*/true);\n};\n/**\r\n     * @param {number|string|boolean|null} value\r\n     * @param {?string=} name\r\n     * @return {!Query}\r\n     */\nQuery.prototype.startAt=function(value,name){\nif(value===void 0){value=null;}\nutil.validateArgCount('Query.startAt',0,2,arguments.length);\nvalidateFirebaseDataArg('Query.startAt',1,value,this.path,true);\nvalidateKey('Query.startAt',2,name,true);\nvar newParams=this.queryParams_.startAt(value,name);\nQuery.validateLimit_(newParams);\nQuery.validateQueryEndpoints_(newParams);\nif(this.queryParams_.hasStart()){\nthrow new Error('Query.startAt: Starting point was already set (by another call to startAt '+\n'or equalTo).');\n}\n// Calling with no params tells us to start at the beginning.\nif(value===undefined){\nvalue=null;\nname=null;\n}\nreturn new Query(this.repo,this.path,newParams,this.orderByCalled_);\n};\n/**\r\n     * @param {number|string|boolean|null} value\r\n     * @param {?string=} name\r\n     * @return {!Query}\r\n     */\nQuery.prototype.endAt=function(value,name){\nif(value===void 0){value=null;}\nutil.validateArgCount('Query.endAt',0,2,arguments.length);\nvalidateFirebaseDataArg('Query.endAt',1,value,this.path,true);\nvalidateKey('Query.endAt',2,name,true);\nvar newParams=this.queryParams_.endAt(value,name);\nQuery.validateLimit_(newParams);\nQuery.validateQueryEndpoints_(newParams);\nif(this.queryParams_.hasEnd()){\nthrow new Error('Query.endAt: Ending point was already set (by another call to endAt or '+\n'equalTo).');\n}\nreturn new Query(this.repo,this.path,newParams,this.orderByCalled_);\n};\n/**\r\n     * Load the selection of children with exactly the specified value, and, optionally,\r\n     * the specified name.\r\n     * @param {number|string|boolean|null} value\r\n     * @param {string=} name\r\n     * @return {!Query}\r\n     */\nQuery.prototype.equalTo=function(value,name){\nutil.validateArgCount('Query.equalTo',1,2,arguments.length);\nvalidateFirebaseDataArg('Query.equalTo',1,value,this.path,false);\nvalidateKey('Query.equalTo',2,name,true);\nif(this.queryParams_.hasStart()){\nthrow new Error('Query.equalTo: Starting point was already set (by another call to startAt or '+\n'equalTo).');\n}\nif(this.queryParams_.hasEnd()){\nthrow new Error('Query.equalTo: Ending point was already set (by another call to endAt or '+\n'equalTo).');\n}\nreturn this.startAt(value,name).endAt(value,name);\n};\n/**\r\n     * @return {!string} URL for this location.\r\n     */\nQuery.prototype.toString=function(){\nutil.validateArgCount('Query.toString',0,0,arguments.length);\nreturn this.repo.toString()+this.path.toUrlEncodedString();\n};\n// Do not create public documentation. This is intended to make JSON serialization work but is otherwise unnecessary\n// for end-users.\nQuery.prototype.toJSON=function(){\n// An optional spacer argument is unnecessary for a string.\nutil.validateArgCount('Query.toJSON',0,1,arguments.length);\nreturn this.toString();\n};\n/**\r\n     * An object representation of the query parameters used by this Query.\r\n     * @return {!Object}\r\n     */\nQuery.prototype.queryObject=function(){\nreturn this.queryParams_.getQueryObject();\n};\n/**\r\n     * @return {!string}\r\n     */\nQuery.prototype.queryIdentifier=function(){\nvar obj=this.queryObject();\nvar id=ObjectToUniqueKey(obj);\nreturn id==='{}'?'default':id;\n};\n/**\r\n     * Return true if this query and the provided query are equivalent; otherwise, return false.\r\n     * @param {Query} other\r\n     * @return {boolean}\r\n     */\nQuery.prototype.isEqual=function(other){\nutil.validateArgCount('Query.isEqual',1,1,arguments.length);\nif(!(other instanceof Query)){\nvar error='Query.isEqual failed: First argument must be an instance of firebase.database.Query.';\nthrow new Error(error);\n}\nvar sameRepo=this.repo===other.repo;\nvar samePath=this.path.equals(other.path);\nvar sameQueryIdentifier=this.queryIdentifier()===other.queryIdentifier();\nreturn sameRepo&&samePath&&sameQueryIdentifier;\n};\n/**\r\n     * Helper used by .on and .once to extract the context and or cancel arguments.\r\n     * @param {!string} fnName The function name (on or once)\r\n     * @param {(function(Error)|Object)=} cancelOrContext\r\n     * @param {Object=} context\r\n     * @return {{cancel: ?function(Error), context: ?Object}}\r\n     * @private\r\n     */\nQuery.getCancelAndContextArgs_=function(fnName,cancelOrContext,context){\nvar ret={cancel:null,context:null};\nif(cancelOrContext&&context){\nret.cancel=cancelOrContext;\nutil.validateCallback(fnName,3,ret.cancel,true);\nret.context=context;\nutil.validateContextObject(fnName,4,ret.context,true);\n}else\nif(cancelOrContext){\n// we have either a cancel callback or a context.\nif((typeof cancelOrContext==='undefined'?'undefined':_typeof(cancelOrContext))==='object'&&cancelOrContext!==null){\n// it's a context!\nret.context=cancelOrContext;\n}else\nif(typeof cancelOrContext==='function'){\nret.cancel=cancelOrContext;\n}else\n{\nthrow new Error(util.errorPrefix(fnName,3,true)+\n' must either be a cancel callback or a context object.');\n}\n}\nreturn ret;\n};\nObject.defineProperty(Query.prototype,\"ref\",{\nget:function get(){\nreturn this.getRef();\n},\nenumerable:false,\nconfigurable:true});\n\nreturn Query;\n}();\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\nvar ExistingValueProvider=/** @class */function(){\nfunction ExistingValueProvider(node_){\nthis.node_=node_;\n}\nExistingValueProvider.prototype.getImmediateChild=function(childName){\nvar child=this.node_.getImmediateChild(childName);\nreturn new ExistingValueProvider(child);\n};\nExistingValueProvider.prototype.node=function(){\nreturn this.node_;\n};\nreturn ExistingValueProvider;\n}();\nvar DeferredValueProvider=/** @class */function(){\nfunction DeferredValueProvider(syncTree,path){\nthis.syncTree_=syncTree;\nthis.path_=path;\n}\nDeferredValueProvider.prototype.getImmediateChild=function(childName){\nvar childPath=this.path_.child(childName);\nreturn new DeferredValueProvider(this.syncTree_,childPath);\n};\nDeferredValueProvider.prototype.node=function(){\nreturn this.syncTree_.calcCompleteEventCache(this.path_);\n};\nreturn DeferredValueProvider;\n}();\n/**\r\n * Generate placeholders for deferred values.\r\n * @param {?Object} values\r\n * @return {!Object}\r\n */\nvar generateWithValues=function generateWithValues(values){\nvalues=values||{};\nvalues['timestamp']=values['timestamp']||new Date().getTime();\nreturn values;\n};\n/**\r\n * Value to use when firing local events. When writing server values, fire\r\n * local events with an approximate value, otherwise return value as-is.\r\n * @param {(Object|string|number|boolean)} value\r\n * @param {!Object} serverValues\r\n * @return {!(string|number|boolean)}\r\n */\nvar resolveDeferredLeafValue=function resolveDeferredLeafValue(value,existingVal,serverValues){\nif(!value||(typeof value==='undefined'?'undefined':_typeof(value))!=='object'){\nreturn value;\n}\nutil.assert('.sv'in value,'Unexpected leaf node or priority contents');\nif(typeof value['.sv']==='string'){\nreturn resolveScalarDeferredValue(value['.sv'],existingVal,serverValues);\n}else\nif(_typeof(value['.sv'])==='object'){\nreturn resolveComplexDeferredValue(value['.sv'],existingVal);\n}else\n{\nutil.assert(false,'Unexpected server value: '+JSON.stringify(value,null,2));\n}\n};\nvar resolveScalarDeferredValue=function resolveScalarDeferredValue(op,existing,serverValues){\nswitch(op){\ncase'timestamp':\nreturn serverValues['timestamp'];\ndefault:\nutil.assert(false,'Unexpected server value: '+op);}\n\n};\nvar resolveComplexDeferredValue=function resolveComplexDeferredValue(op,existing,unused){\nif(!op.hasOwnProperty('increment')){\nutil.assert(false,'Unexpected server value: '+JSON.stringify(op,null,2));\n}\nvar delta=op['increment'];\nif(typeof delta!=='number'){\nutil.assert(false,'Unexpected increment value: '+delta);\n}\nvar existingNode=existing.node();\nutil.assert(existingNode!==null&&typeof existingNode!=='undefined','Expected ChildrenNode.EMPTY_NODE for nulls');\n// Incrementing a non-number sets the value to the incremented amount\nif(!existingNode.isLeafNode()){\nreturn delta;\n}\nvar leaf=existingNode;\nvar existingVal=leaf.getValue();\nif(typeof existingVal!=='number'){\nreturn delta;\n}\n// No need to do over/underflow arithmetic here because JS only handles floats under the covers\nreturn existingVal+delta;\n};\n/**\r\n * Recursively replace all deferred values and priorities in the tree with the\r\n * specified generated replacement values.\r\n * @param {!Path} path path to which write is relative\r\n * @param {!Node} node new data written at path\r\n * @param {!SyncTree} syncTree current data\r\n * @param {!Object} serverValues\r\n * @return {!SparseSnapshotTree}\r\n */\nvar resolveDeferredValueTree=function resolveDeferredValueTree(path,node,syncTree,serverValues){\nreturn resolveDeferredValue(node,new DeferredValueProvider(syncTree,path),serverValues);\n};\n/**\r\n * Recursively replace all deferred values and priorities in the node with the\r\n * specified generated replacement values.  If there are no server values in the node,\r\n * it'll be returned as-is.\r\n * @param {!Node} node\r\n * @param {!Object} serverValues\r\n * @return {!Node}\r\n */\nvar resolveDeferredValueSnapshot=function resolveDeferredValueSnapshot(node,existing,serverValues){\nreturn resolveDeferredValue(node,new ExistingValueProvider(existing),serverValues);\n};\nfunction resolveDeferredValue(node,existingVal,serverValues){\nvar rawPri=node.getPriority().val();\nvar priority=resolveDeferredLeafValue(rawPri,existingVal.getImmediateChild('.priority'),serverValues);\nvar newNode;\nif(node.isLeafNode()){\nvar leafNode=node;\nvar value=resolveDeferredLeafValue(leafNode.getValue(),existingVal,serverValues);\nif(value!==leafNode.getValue()||\npriority!==leafNode.getPriority().val()){\nreturn new LeafNode(value,nodeFromJSON$1(priority));\n}else\n{\nreturn node;\n}\n}else\n{\nvar childrenNode=node;\nnewNode=childrenNode;\nif(priority!==childrenNode.getPriority().val()){\nnewNode=newNode.updatePriority(new LeafNode(priority));\n}\nchildrenNode.forEachChild(PRIORITY_INDEX,function(childName,childNode){\nvar newChildNode=resolveDeferredValue(childNode,existingVal.getImmediateChild(childName),serverValues);\nif(newChildNode!==childNode){\nnewNode=newNode.updateImmediateChild(childName,newChildNode);\n}\n});\nreturn newNode;\n}\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n/**\r\n * Helper class to store a sparse set of snapshots.\r\n */\nvar SparseSnapshotTree=/** @class */function(){\nfunction SparseSnapshotTree(){\nthis.value=null;\nthis.children=new Map();\n}\n/**\r\n     * Gets the node stored at the given path if one exists.\r\n     *\r\n     * @param path Path to look up snapshot for.\r\n     * @return The retrieved node, or null.\r\n     */\nSparseSnapshotTree.prototype.find=function(path){\nif(this.value!=null){\nreturn this.value.getChild(path);\n}else\nif(!path.isEmpty()&&this.children.size>0){\nvar childKey=path.getFront();\npath=path.popFront();\nif(this.children.has(childKey)){\nvar childTree=this.children.get(childKey);\nreturn childTree.find(path);\n}else\n{\nreturn null;\n}\n}else\n{\nreturn null;\n}\n};\n/**\r\n     * Stores the given node at the specified path. If there is already a node\r\n     * at a shallower path, it merges the new data into that snapshot node.\r\n     *\r\n     * @param path Path to look up snapshot for.\r\n     * @param data The new data, or null.\r\n     */\nSparseSnapshotTree.prototype.remember=function(path,data){\nif(path.isEmpty()){\nthis.value=data;\nthis.children.clear();\n}else\nif(this.value!==null){\nthis.value=this.value.updateChild(path,data);\n}else\n{\nvar childKey=path.getFront();\nif(!this.children.has(childKey)){\nthis.children.set(childKey,new SparseSnapshotTree());\n}\nvar child=this.children.get(childKey);\npath=path.popFront();\nchild.remember(path,data);\n}\n};\n/**\r\n     * Purge the data at path from the cache.\r\n     *\r\n     * @param path Path to look up snapshot for.\r\n     * @return True if this node should now be removed.\r\n     */\nSparseSnapshotTree.prototype.forget=function(path){\nif(path.isEmpty()){\nthis.value=null;\nthis.children.clear();\nreturn true;\n}else\n{\nif(this.value!==null){\nif(this.value.isLeafNode()){\n// We're trying to forget a node that doesn't exist\nreturn false;\n}else\n{\nvar value=this.value;\nthis.value=null;\nvar self_1=this;\nvalue.forEachChild(PRIORITY_INDEX,function(key,tree){\nself_1.remember(new Path(key),tree);\n});\nreturn this.forget(path);\n}\n}else\nif(this.children.size>0){\nvar childKey=path.getFront();\npath=path.popFront();\nif(this.children.has(childKey)){\nvar safeToRemove=this.children.get(childKey).forget(path);\nif(safeToRemove){\nthis.children.delete(childKey);\n}\n}\nreturn this.children.size===0;\n}else\n{\nreturn true;\n}\n}\n};\n/**\r\n     * Recursively iterates through all of the stored tree and calls the\r\n     * callback on each one.\r\n     *\r\n     * @param prefixPath Path to look up node for.\r\n     * @param func The function to invoke for each tree.\r\n     */\nSparseSnapshotTree.prototype.forEachTree=function(prefixPath,func){\nif(this.value!==null){\nfunc(prefixPath,this.value);\n}else\n{\nthis.forEachChild(function(key,tree){\nvar path=new Path(prefixPath.toString()+'/'+key);\ntree.forEachTree(path,func);\n});\n}\n};\n/**\r\n     * Iterates through each immediate child and triggers the callback.\r\n     *\r\n     * @param func The function to invoke for each child.\r\n     */\nSparseSnapshotTree.prototype.forEachChild=function(func){\nthis.children.forEach(function(tree,key){\nfunc(key,tree);\n});\n};\nreturn SparseSnapshotTree;\n}();\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n/**\r\n *\r\n * @enum\r\n */\nvar OperationType;\n(function(OperationType){\nOperationType[OperationType[\"OVERWRITE\"]=0]=\"OVERWRITE\";\nOperationType[OperationType[\"MERGE\"]=1]=\"MERGE\";\nOperationType[OperationType[\"ACK_USER_WRITE\"]=2]=\"ACK_USER_WRITE\";\nOperationType[OperationType[\"LISTEN_COMPLETE\"]=3]=\"LISTEN_COMPLETE\";\n})(OperationType||(OperationType={}));\n/**\r\n * @param {boolean} fromUser\r\n * @param {boolean} fromServer\r\n * @param {?string} queryId\r\n * @param {boolean} tagged\r\n * @constructor\r\n */\nvar OperationSource=/** @class */function(){\nfunction OperationSource(fromUser,fromServer,queryId,tagged){\nthis.fromUser=fromUser;\nthis.fromServer=fromServer;\nthis.queryId=queryId;\nthis.tagged=tagged;\nutil.assert(!tagged||fromServer,'Tagged queries must be from server.');\n}\n/**\r\n     * @const\r\n     * @type {!OperationSource}\r\n     */\nOperationSource.User=new OperationSource(\n/*fromUser=*/true,false,null,\n/*tagged=*/false);\n/**\r\n     * @const\r\n     * @type {!OperationSource}\r\n     */\nOperationSource.Server=new OperationSource(false,\n/*fromServer=*/true,null,\n/*tagged=*/false);\n/**\r\n     * @param {string} queryId\r\n     * @return {!OperationSource}\r\n     */\nOperationSource.forServerTaggedQuery=function(queryId){\nreturn new OperationSource(false,\n/*fromServer=*/true,queryId,\n/*tagged=*/true);\n};\nreturn OperationSource;\n}();\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\nvar AckUserWrite=/** @class */function(){\n/**\r\n     *\r\n     * @param {!Path} path\r\n     * @param {!ImmutableTree<!boolean>} affectedTree A tree containing true for each affected path. Affected paths can't overlap.\r\n     * @param {!boolean} revert\r\n     */\nfunction AckUserWrite(\n/** @inheritDoc */path,\n/** @inheritDoc */affectedTree,\n/** @inheritDoc */revert){\nthis.path=path;\nthis.affectedTree=affectedTree;\nthis.revert=revert;\n/** @inheritDoc */\nthis.type=OperationType.ACK_USER_WRITE;\n/** @inheritDoc */\nthis.source=OperationSource.User;\n}\n/**\r\n     * @inheritDoc\r\n     */\nAckUserWrite.prototype.operationForChild=function(childName){\nif(!this.path.isEmpty()){\nutil.assert(this.path.getFront()===childName,'operationForChild called for unrelated child.');\nreturn new AckUserWrite(this.path.popFront(),this.affectedTree,this.revert);\n}else\nif(this.affectedTree.value!=null){\nutil.assert(this.affectedTree.children.isEmpty(),'affectedTree should not have overlapping affected paths.');\n// All child locations are affected as well; just return same operation.\nreturn this;\n}else\n{\nvar childTree=this.affectedTree.subtree(new Path(childName));\nreturn new AckUserWrite(Path.Empty,childTree,this.revert);\n}\n};\nreturn AckUserWrite;\n}();\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\nvar emptyChildrenSingleton;\n/**\r\n * Singleton empty children collection.\r\n *\r\n * @const\r\n * @type {!SortedMap.<string, !ImmutableTree.<?>>}\r\n */\nvar EmptyChildren=function EmptyChildren(){\nif(!emptyChildrenSingleton){\nemptyChildrenSingleton=new SortedMap(stringCompare);\n}\nreturn emptyChildrenSingleton;\n};\n/**\r\n * A tree with immutable elements.\r\n */\nvar ImmutableTree=/** @class */function(){\n/**\r\n     * @template T\r\n     * @param {?T} value\r\n     * @param {SortedMap.<string, !ImmutableTree.<T>>=} children\r\n     */\nfunction ImmutableTree(value,children){\nif(children===void 0){children=EmptyChildren();}\nthis.value=value;\nthis.children=children;\n}\n/**\r\n     * @template T\r\n     * @param {!Object.<string, !T>} obj\r\n     * @return {!ImmutableTree.<!T>}\r\n     */\nImmutableTree.fromObject=function(obj){\nvar tree=ImmutableTree.Empty;\neach(obj,function(childPath,childSnap){\ntree=tree.set(new Path(childPath),childSnap);\n});\nreturn tree;\n};\n/**\r\n     * True if the value is empty and there are no children\r\n     * @return {boolean}\r\n     */\nImmutableTree.prototype.isEmpty=function(){\nreturn this.value===null&&this.children.isEmpty();\n};\n/**\r\n     * Given a path and predicate, return the first node and the path to that node\r\n     * where the predicate returns true.\r\n     *\r\n     * TODO Do a perf test -- If we're creating a bunch of {path: value:} objects\r\n     * on the way back out, it may be better to pass down a pathSoFar obj.\r\n     *\r\n     * @param {!Path} relativePath The remainder of the path\r\n     * @param {function(T):boolean} predicate The predicate to satisfy to return a\r\n     *   node\r\n     * @return {?{path:!Path, value:!T}}\r\n     */\nImmutableTree.prototype.findRootMostMatchingPathAndValue=function(relativePath,predicate){\nif(this.value!=null&&predicate(this.value)){\nreturn{path:Path.Empty,value:this.value};\n}else\n{\nif(relativePath.isEmpty()){\nreturn null;\n}else\n{\nvar front=relativePath.getFront();\nvar child=this.children.get(front);\nif(child!==null){\nvar childExistingPathAndValue=child.findRootMostMatchingPathAndValue(relativePath.popFront(),predicate);\nif(childExistingPathAndValue!=null){\nvar fullPath=new Path(front).child(childExistingPathAndValue.path);\nreturn{path:fullPath,value:childExistingPathAndValue.value};\n}else\n{\nreturn null;\n}\n}else\n{\nreturn null;\n}\n}\n}\n};\n/**\r\n     * Find, if it exists, the shortest subpath of the given path that points a defined\r\n     * value in the tree\r\n     * @param {!Path} relativePath\r\n     * @return {?{path: !Path, value: !T}}\r\n     */\nImmutableTree.prototype.findRootMostValueAndPath=function(relativePath){\nreturn this.findRootMostMatchingPathAndValue(relativePath,function(){return true;});\n};\n/**\r\n     * @param {!Path} relativePath\r\n     * @return {!ImmutableTree.<T>} The subtree at the given path\r\n     */\nImmutableTree.prototype.subtree=function(relativePath){\nif(relativePath.isEmpty()){\nreturn this;\n}else\n{\nvar front=relativePath.getFront();\nvar childTree=this.children.get(front);\nif(childTree!==null){\nreturn childTree.subtree(relativePath.popFront());\n}else\n{\nreturn ImmutableTree.Empty;\n}\n}\n};\n/**\r\n     * Sets a value at the specified path.\r\n     *\r\n     * @param {!Path} relativePath Path to set value at.\r\n     * @param {?T} toSet Value to set.\r\n     * @return {!ImmutableTree.<T>} Resulting tree.\r\n     */\nImmutableTree.prototype.set=function(relativePath,toSet){\nif(relativePath.isEmpty()){\nreturn new ImmutableTree(toSet,this.children);\n}else\n{\nvar front=relativePath.getFront();\nvar child=this.children.get(front)||ImmutableTree.Empty;\nvar newChild=child.set(relativePath.popFront(),toSet);\nvar newChildren=this.children.insert(front,newChild);\nreturn new ImmutableTree(this.value,newChildren);\n}\n};\n/**\r\n     * Removes the value at the specified path.\r\n     *\r\n     * @param {!Path} relativePath Path to value to remove.\r\n     * @return {!ImmutableTree.<T>} Resulting tree.\r\n     */\nImmutableTree.prototype.remove=function(relativePath){\nif(relativePath.isEmpty()){\nif(this.children.isEmpty()){\nreturn ImmutableTree.Empty;\n}else\n{\nreturn new ImmutableTree(null,this.children);\n}\n}else\n{\nvar front=relativePath.getFront();\nvar child=this.children.get(front);\nif(child){\nvar newChild=child.remove(relativePath.popFront());\nvar newChildren=void 0;\nif(newChild.isEmpty()){\nnewChildren=this.children.remove(front);\n}else\n{\nnewChildren=this.children.insert(front,newChild);\n}\nif(this.value===null&&newChildren.isEmpty()){\nreturn ImmutableTree.Empty;\n}else\n{\nreturn new ImmutableTree(this.value,newChildren);\n}\n}else\n{\nreturn this;\n}\n}\n};\n/**\r\n     * Gets a value from the tree.\r\n     *\r\n     * @param {!Path} relativePath Path to get value for.\r\n     * @return {?T} Value at path, or null.\r\n     */\nImmutableTree.prototype.get=function(relativePath){\nif(relativePath.isEmpty()){\nreturn this.value;\n}else\n{\nvar front=relativePath.getFront();\nvar child=this.children.get(front);\nif(child){\nreturn child.get(relativePath.popFront());\n}else\n{\nreturn null;\n}\n}\n};\n/**\r\n     * Replace the subtree at the specified path with the given new tree.\r\n     *\r\n     * @param {!Path} relativePath Path to replace subtree for.\r\n     * @param {!ImmutableTree} newTree New tree.\r\n     * @return {!ImmutableTree} Resulting tree.\r\n     */\nImmutableTree.prototype.setTree=function(relativePath,newTree){\nif(relativePath.isEmpty()){\nreturn newTree;\n}else\n{\nvar front=relativePath.getFront();\nvar child=this.children.get(front)||ImmutableTree.Empty;\nvar newChild=child.setTree(relativePath.popFront(),newTree);\nvar newChildren=void 0;\nif(newChild.isEmpty()){\nnewChildren=this.children.remove(front);\n}else\n{\nnewChildren=this.children.insert(front,newChild);\n}\nreturn new ImmutableTree(this.value,newChildren);\n}\n};\n/**\r\n     * Performs a depth first fold on this tree. Transforms a tree into a single\r\n     * value, given a function that operates on the path to a node, an optional\r\n     * current value, and a map of child names to folded subtrees\r\n     * @template V\r\n     * @param {function(Path, ?T, Object.<string, V>):V} fn\r\n     * @return {V}\r\n     */\nImmutableTree.prototype.fold=function(fn){\nreturn this.fold_(Path.Empty,fn);\n};\n/**\r\n     * Recursive helper for public-facing fold() method\r\n     * @template V\r\n     * @param {!Path} pathSoFar\r\n     * @param {function(Path, ?T, Object.<string, V>):V} fn\r\n     * @return {V}\r\n     * @private\r\n     */\nImmutableTree.prototype.fold_=function(pathSoFar,fn){\nvar accum={};\nthis.children.inorderTraversal(function(childKey,childTree){\naccum[childKey]=childTree.fold_(pathSoFar.child(childKey),fn);\n});\nreturn fn(pathSoFar,this.value,accum);\n};\n/**\r\n     * Find the first matching value on the given path. Return the result of applying f to it.\r\n     * @template V\r\n     * @param {!Path} path\r\n     * @param {!function(!Path, !T):?V} f\r\n     * @return {?V}\r\n     */\nImmutableTree.prototype.findOnPath=function(path,f){\nreturn this.findOnPath_(path,Path.Empty,f);\n};\nImmutableTree.prototype.findOnPath_=function(pathToFollow,pathSoFar,f){\nvar result=this.value?f(pathSoFar,this.value):false;\nif(result){\nreturn result;\n}else\n{\nif(pathToFollow.isEmpty()){\nreturn null;\n}else\n{\nvar front=pathToFollow.getFront();\nvar nextChild=this.children.get(front);\nif(nextChild){\nreturn nextChild.findOnPath_(pathToFollow.popFront(),pathSoFar.child(front),f);\n}else\n{\nreturn null;\n}\n}\n}\n};\n/**\r\n     *\r\n     * @param {!Path} path\r\n     * @param {!function(!Path, !T)} f\r\n     * @returns {!ImmutableTree.<T>}\r\n     */\nImmutableTree.prototype.foreachOnPath=function(path,f){\nreturn this.foreachOnPath_(path,Path.Empty,f);\n};\nImmutableTree.prototype.foreachOnPath_=function(pathToFollow,currentRelativePath,f){\nif(pathToFollow.isEmpty()){\nreturn this;\n}else\n{\nif(this.value){\nf(currentRelativePath,this.value);\n}\nvar front=pathToFollow.getFront();\nvar nextChild=this.children.get(front);\nif(nextChild){\nreturn nextChild.foreachOnPath_(pathToFollow.popFront(),currentRelativePath.child(front),f);\n}else\n{\nreturn ImmutableTree.Empty;\n}\n}\n};\n/**\r\n     * Calls the given function for each node in the tree that has a value.\r\n     *\r\n     * @param {function(!Path, !T)} f A function to be called with\r\n     *   the path from the root of the tree to a node, and the value at that node.\r\n     *   Called in depth-first order.\r\n     */\nImmutableTree.prototype.foreach=function(f){\nthis.foreach_(Path.Empty,f);\n};\nImmutableTree.prototype.foreach_=function(currentRelativePath,f){\nthis.children.inorderTraversal(function(childName,childTree){\nchildTree.foreach_(currentRelativePath.child(childName),f);\n});\nif(this.value){\nf(currentRelativePath,this.value);\n}\n};\n/**\r\n     *\r\n     * @param {function(string, !T)} f\r\n     */\nImmutableTree.prototype.foreachChild=function(f){\nthis.children.inorderTraversal(function(childName,childTree){\nif(childTree.value){\nf(childName,childTree.value);\n}\n});\n};\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nImmutableTree.Empty=new ImmutableTree(null);\nreturn ImmutableTree;\n}();\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n/**\r\n * @param {!OperationSource} source\r\n * @param {!Path} path\r\n * @constructor\r\n * @implements {Operation}\r\n */\nvar ListenComplete=/** @class */function(){\nfunction ListenComplete(source,path){\nthis.source=source;\nthis.path=path;\n/** @inheritDoc */\nthis.type=OperationType.LISTEN_COMPLETE;\n}\nListenComplete.prototype.operationForChild=function(childName){\nif(this.path.isEmpty()){\nreturn new ListenComplete(this.source,Path.Empty);\n}else\n{\nreturn new ListenComplete(this.source,this.path.popFront());\n}\n};\nreturn ListenComplete;\n}();\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n/**\r\n * @param {!OperationSource} source\r\n * @param {!Path} path\r\n * @param {!Node} snap\r\n * @constructor\r\n * @implements {Operation}\r\n */\nvar Overwrite=/** @class */function(){\nfunction Overwrite(source,path,snap){\nthis.source=source;\nthis.path=path;\nthis.snap=snap;\n/** @inheritDoc */\nthis.type=OperationType.OVERWRITE;\n}\nOverwrite.prototype.operationForChild=function(childName){\nif(this.path.isEmpty()){\nreturn new Overwrite(this.source,Path.Empty,this.snap.getImmediateChild(childName));\n}else\n{\nreturn new Overwrite(this.source,this.path.popFront(),this.snap);\n}\n};\nreturn Overwrite;\n}();\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n/**\r\n * @param {!OperationSource} source\r\n * @param {!Path} path\r\n * @param {!ImmutableTree.<!Node>} children\r\n * @constructor\r\n * @implements {Operation}\r\n */\nvar Merge=/** @class */function(){\nfunction Merge(\n/** @inheritDoc */source,\n/** @inheritDoc */path,\n/** @inheritDoc */children){\nthis.source=source;\nthis.path=path;\nthis.children=children;\n/** @inheritDoc */\nthis.type=OperationType.MERGE;\n}\n/**\r\n     * @inheritDoc\r\n     */\nMerge.prototype.operationForChild=function(childName){\nif(this.path.isEmpty()){\nvar childTree=this.children.subtree(new Path(childName));\nif(childTree.isEmpty()){\n// This child is unaffected\nreturn null;\n}else\nif(childTree.value){\n// We have a snapshot for the child in question.  This becomes an overwrite of the child.\nreturn new Overwrite(this.source,Path.Empty,childTree.value);\n}else\n{\n// This is a merge at a deeper level\nreturn new Merge(this.source,Path.Empty,childTree);\n}\n}else\n{\nutil.assert(this.path.getFront()===childName,\"Can't get a merge for a child not on the path of the operation\");\nreturn new Merge(this.source,this.path.popFront(),this.children);\n}\n};\n/**\r\n     * @inheritDoc\r\n     */\nMerge.prototype.toString=function(){\nreturn'Operation('+\nthis.path+\n': '+\nthis.source.toString()+\n' merge: '+\nthis.children.toString()+\n')';\n};\nreturn Merge;\n}();\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n/**\r\n * A cache node only stores complete children. Additionally it holds a flag whether the node can be considered fully\r\n * initialized in the sense that we know at one point in time this represented a valid state of the world, e.g.\r\n * initialized with data from the server, or a complete overwrite by the client. The filtered flag also tracks\r\n * whether a node potentially had children removed due to a filter.\r\n */\nvar CacheNode=/** @class */function(){\n/**\r\n     * @param {!Node} node_\r\n     * @param {boolean} fullyInitialized_\r\n     * @param {boolean} filtered_\r\n     */\nfunction CacheNode(node_,fullyInitialized_,filtered_){\nthis.node_=node_;\nthis.fullyInitialized_=fullyInitialized_;\nthis.filtered_=filtered_;\n}\n/**\r\n     * Returns whether this node was fully initialized with either server data or a complete overwrite by the client\r\n     * @return {boolean}\r\n     */\nCacheNode.prototype.isFullyInitialized=function(){\nreturn this.fullyInitialized_;\n};\n/**\r\n     * Returns whether this node is potentially missing children due to a filter applied to the node\r\n     * @return {boolean}\r\n     */\nCacheNode.prototype.isFiltered=function(){\nreturn this.filtered_;\n};\n/**\r\n     * @param {!Path} path\r\n     * @return {boolean}\r\n     */\nCacheNode.prototype.isCompleteForPath=function(path){\nif(path.isEmpty()){\nreturn this.isFullyInitialized()&&!this.filtered_;\n}\nvar childKey=path.getFront();\nreturn this.isCompleteForChild(childKey);\n};\n/**\r\n     * @param {!string} key\r\n     * @return {boolean}\r\n     */\nCacheNode.prototype.isCompleteForChild=function(key){\nreturn this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(key);\n};\n/**\r\n     * @return {!Node}\r\n     */\nCacheNode.prototype.getNode=function(){\nreturn this.node_;\n};\nreturn CacheNode;\n}();\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n/**\r\n * Stores the data we have cached for a view.\r\n *\r\n * serverSnap is the cached server data, eventSnap is the cached event data (server data plus any local writes).\r\n *\r\n * @constructor\r\n */\nvar ViewCache=/** @class */function(){\n/**\r\n     *\r\n     * @param {!CacheNode} eventCache_\r\n     * @param {!CacheNode} serverCache_\r\n     */\nfunction ViewCache(eventCache_,serverCache_){\nthis.eventCache_=eventCache_;\nthis.serverCache_=serverCache_;\n}\n/**\r\n     * @param {!Node} eventSnap\r\n     * @param {boolean} complete\r\n     * @param {boolean} filtered\r\n     * @return {!ViewCache}\r\n     */\nViewCache.prototype.updateEventSnap=function(eventSnap,complete,filtered){\nreturn new ViewCache(new CacheNode(eventSnap,complete,filtered),this.serverCache_);\n};\n/**\r\n     * @param {!Node} serverSnap\r\n     * @param {boolean} complete\r\n     * @param {boolean} filtered\r\n     * @return {!ViewCache}\r\n     */\nViewCache.prototype.updateServerSnap=function(serverSnap,complete,filtered){\nreturn new ViewCache(this.eventCache_,new CacheNode(serverSnap,complete,filtered));\n};\n/**\r\n     * @return {!CacheNode}\r\n     */\nViewCache.prototype.getEventCache=function(){\nreturn this.eventCache_;\n};\n/**\r\n     * @return {?Node}\r\n     */\nViewCache.prototype.getCompleteEventSnap=function(){\nreturn this.eventCache_.isFullyInitialized()?\nthis.eventCache_.getNode():\nnull;\n};\n/**\r\n     * @return {!CacheNode}\r\n     */\nViewCache.prototype.getServerCache=function(){\nreturn this.serverCache_;\n};\n/**\r\n     * @return {?Node}\r\n     */\nViewCache.prototype.getCompleteServerSnap=function(){\nreturn this.serverCache_.isFullyInitialized()?\nthis.serverCache_.getNode():\nnull;\n};\n/**\r\n     * @const\r\n     * @type {ViewCache}\r\n     */\nViewCache.Empty=new ViewCache(new CacheNode(ChildrenNode.EMPTY_NODE,\n/*fullyInitialized=*/false,\n/*filtered=*/false),new CacheNode(ChildrenNode.EMPTY_NODE,\n/*fullyInitialized=*/false,\n/*filtered=*/false));\nreturn ViewCache;\n}();\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n/**\r\n * @constructor\r\n * @struct\r\n * @param {!string} type The event type\r\n * @param {!Node} snapshotNode The data\r\n * @param {string=} childName The name for this child, if it's a child event\r\n * @param {Node=} oldSnap Used for intermediate processing of child changed events\r\n * @param {string=} prevName The name for the previous child, if applicable\r\n */\nvar Change=/** @class */function(){\nfunction Change(type,snapshotNode,childName,oldSnap,prevName){\nthis.type=type;\nthis.snapshotNode=snapshotNode;\nthis.childName=childName;\nthis.oldSnap=oldSnap;\nthis.prevName=prevName;\n}\n/**\r\n     * @param {!Node} snapshot\r\n     * @return {!Change}\r\n     */\nChange.valueChange=function(snapshot){\nreturn new Change(Change.VALUE,snapshot);\n};\n/**\r\n     * @param {string} childKey\r\n     * @param {!Node} snapshot\r\n     * @return {!Change}\r\n     */\nChange.childAddedChange=function(childKey,snapshot){\nreturn new Change(Change.CHILD_ADDED,snapshot,childKey);\n};\n/**\r\n     * @param {string} childKey\r\n     * @param {!Node} snapshot\r\n     * @return {!Change}\r\n     */\nChange.childRemovedChange=function(childKey,snapshot){\nreturn new Change(Change.CHILD_REMOVED,snapshot,childKey);\n};\n/**\r\n     * @param {string} childKey\r\n     * @param {!Node} newSnapshot\r\n     * @param {!Node} oldSnapshot\r\n     * @return {!Change}\r\n     */\nChange.childChangedChange=function(childKey,newSnapshot,oldSnapshot){\nreturn new Change(Change.CHILD_CHANGED,newSnapshot,childKey,oldSnapshot);\n};\n/**\r\n     * @param {string} childKey\r\n     * @param {!Node} snapshot\r\n     * @return {!Change}\r\n     */\nChange.childMovedChange=function(childKey,snapshot){\nreturn new Change(Change.CHILD_MOVED,snapshot,childKey);\n};\n//event types\n/** Event type for a child added */\nChange.CHILD_ADDED='child_added';\n/** Event type for a child removed */\nChange.CHILD_REMOVED='child_removed';\n/** Event type for a child changed */\nChange.CHILD_CHANGED='child_changed';\n/** Event type for a child moved */\nChange.CHILD_MOVED='child_moved';\n/** Event type for a value change */\nChange.VALUE='value';\nreturn Change;\n}();\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n/**\r\n * Doesn't really filter nodes but applies an index to the node and keeps track of any changes\r\n *\r\n * @constructor\r\n * @implements {NodeFilter}\r\n * @param {!Index} index\r\n */\nvar IndexedFilter=/** @class */function(){\nfunction IndexedFilter(index_){\nthis.index_=index_;\n}\nIndexedFilter.prototype.updateChild=function(snap,key,newChild,affectedPath,source,optChangeAccumulator){\nutil.assert(snap.isIndexed(this.index_),'A node must be indexed if only a child is updated');\nvar oldChild=snap.getImmediateChild(key);\n// Check if anything actually changed.\nif(oldChild.getChild(affectedPath).equals(newChild.getChild(affectedPath))){\n// There's an edge case where a child can enter or leave the view because affectedPath was set to null.\n// In this case, affectedPath will appear null in both the old and new snapshots.  So we need\n// to avoid treating these cases as \"nothing changed.\"\nif(oldChild.isEmpty()===newChild.isEmpty()){\n// Nothing changed.\n// This assert should be valid, but it's expensive (can dominate perf testing) so don't actually do it.\n//assert(oldChild.equals(newChild), 'Old and new snapshots should be equal.');\nreturn snap;\n}\n}\nif(optChangeAccumulator!=null){\nif(newChild.isEmpty()){\nif(snap.hasChild(key)){\noptChangeAccumulator.trackChildChange(Change.childRemovedChange(key,oldChild));\n}else\n{\nutil.assert(snap.isLeafNode(),'A child remove without an old child only makes sense on a leaf node');\n}\n}else\nif(oldChild.isEmpty()){\noptChangeAccumulator.trackChildChange(Change.childAddedChange(key,newChild));\n}else\n{\noptChangeAccumulator.trackChildChange(Change.childChangedChange(key,newChild,oldChild));\n}\n}\nif(snap.isLeafNode()&&newChild.isEmpty()){\nreturn snap;\n}else\n{\n// Make sure the node is indexed\nreturn snap.updateImmediateChild(key,newChild).withIndex(this.index_);\n}\n};\n/**\r\n     * @inheritDoc\r\n     */\nIndexedFilter.prototype.updateFullNode=function(oldSnap,newSnap,optChangeAccumulator){\nif(optChangeAccumulator!=null){\nif(!oldSnap.isLeafNode()){\noldSnap.forEachChild(PRIORITY_INDEX,function(key,childNode){\nif(!newSnap.hasChild(key)){\noptChangeAccumulator.trackChildChange(Change.childRemovedChange(key,childNode));\n}\n});\n}\nif(!newSnap.isLeafNode()){\nnewSnap.forEachChild(PRIORITY_INDEX,function(key,childNode){\nif(oldSnap.hasChild(key)){\nvar oldChild=oldSnap.getImmediateChild(key);\nif(!oldChild.equals(childNode)){\noptChangeAccumulator.trackChildChange(Change.childChangedChange(key,childNode,oldChild));\n}\n}else\n{\noptChangeAccumulator.trackChildChange(Change.childAddedChange(key,childNode));\n}\n});\n}\n}\nreturn newSnap.withIndex(this.index_);\n};\n/**\r\n     * @inheritDoc\r\n     */\nIndexedFilter.prototype.updatePriority=function(oldSnap,newPriority){\nif(oldSnap.isEmpty()){\nreturn ChildrenNode.EMPTY_NODE;\n}else\n{\nreturn oldSnap.updatePriority(newPriority);\n}\n};\n/**\r\n     * @inheritDoc\r\n     */\nIndexedFilter.prototype.filtersNodes=function(){\nreturn false;\n};\n/**\r\n     * @inheritDoc\r\n     */\nIndexedFilter.prototype.getIndexedFilter=function(){\nreturn this;\n};\n/**\r\n     * @inheritDoc\r\n     */\nIndexedFilter.prototype.getIndex=function(){\nreturn this.index_;\n};\nreturn IndexedFilter;\n}();\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\nvar ChildChangeAccumulator=/** @class */function(){\nfunction ChildChangeAccumulator(){\nthis.changeMap=new Map();\n}\nChildChangeAccumulator.prototype.trackChildChange=function(change){\nvar type=change.type;\nvar childKey=change.childName;\nutil.assert(type===Change.CHILD_ADDED||\ntype===Change.CHILD_CHANGED||\ntype===Change.CHILD_REMOVED,'Only child changes supported for tracking');\nutil.assert(childKey!=='.priority','Only non-priority child changes can be tracked.');\nvar oldChange=this.changeMap.get(childKey);\nif(oldChange){\nvar oldType=oldChange.type;\nif(type===Change.CHILD_ADDED&&oldType===Change.CHILD_REMOVED){\nthis.changeMap.set(childKey,Change.childChangedChange(childKey,change.snapshotNode,oldChange.snapshotNode));\n}else\nif(type===Change.CHILD_REMOVED&&\noldType===Change.CHILD_ADDED){\nthis.changeMap.delete(childKey);\n}else\nif(type===Change.CHILD_REMOVED&&\noldType===Change.CHILD_CHANGED){\nthis.changeMap.set(childKey,Change.childRemovedChange(childKey,oldChange.oldSnap));\n}else\nif(type===Change.CHILD_CHANGED&&\noldType===Change.CHILD_ADDED){\nthis.changeMap.set(childKey,Change.childAddedChange(childKey,change.snapshotNode));\n}else\nif(type===Change.CHILD_CHANGED&&\noldType===Change.CHILD_CHANGED){\nthis.changeMap.set(childKey,Change.childChangedChange(childKey,change.snapshotNode,oldChange.oldSnap));\n}else\n{\nthrow util.assertionError('Illegal combination of changes: '+\nchange+\n' occurred after '+\noldChange);\n}\n}else\n{\nthis.changeMap.set(childKey,change);\n}\n};\nChildChangeAccumulator.prototype.getChanges=function(){\nreturn Array.from(this.changeMap.values());\n};\nreturn ChildChangeAccumulator;\n}();\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n/**\r\n * An implementation of CompleteChildSource that never returns any additional children\r\n *\r\n * @private\r\n * @constructor\r\n * @implements CompleteChildSource\r\n */\n// eslint-disable-next-line @typescript-eslint/naming-convention\nvar NoCompleteChildSource_=/** @class */function(){\nfunction NoCompleteChildSource_(){\n}\n/**\r\n     * @inheritDoc\r\n     */\nNoCompleteChildSource_.prototype.getCompleteChild=function(childKey){\nreturn null;\n};\n/**\r\n     * @inheritDoc\r\n     */\nNoCompleteChildSource_.prototype.getChildAfterChild=function(index,child,reverse){\nreturn null;\n};\nreturn NoCompleteChildSource_;\n}();\n/**\r\n * Singleton instance.\r\n * @const\r\n * @type {!CompleteChildSource}\r\n */\nvar NO_COMPLETE_CHILD_SOURCE=new NoCompleteChildSource_();\n/**\r\n * An implementation of CompleteChildSource that uses a WriteTree in addition to any other server data or\r\n * old event caches available to calculate complete children.\r\n *\r\n *\r\n * @implements CompleteChildSource\r\n */\nvar WriteTreeCompleteChildSource=/** @class */function(){\n/**\r\n     * @param {!WriteTreeRef} writes_\r\n     * @param {!ViewCache} viewCache_\r\n     * @param {?Node} optCompleteServerCache_\r\n     */\nfunction WriteTreeCompleteChildSource(writes_,viewCache_,optCompleteServerCache_){\nif(optCompleteServerCache_===void 0){optCompleteServerCache_=null;}\nthis.writes_=writes_;\nthis.viewCache_=viewCache_;\nthis.optCompleteServerCache_=optCompleteServerCache_;\n}\n/**\r\n     * @inheritDoc\r\n     */\nWriteTreeCompleteChildSource.prototype.getCompleteChild=function(childKey){\nvar node=this.viewCache_.getEventCache();\nif(node.isCompleteForChild(childKey)){\nreturn node.getNode().getImmediateChild(childKey);\n}else\n{\nvar serverNode=this.optCompleteServerCache_!=null?\nnew CacheNode(this.optCompleteServerCache_,true,false):\nthis.viewCache_.getServerCache();\nreturn this.writes_.calcCompleteChild(childKey,serverNode);\n}\n};\n/**\r\n     * @inheritDoc\r\n     */\nWriteTreeCompleteChildSource.prototype.getChildAfterChild=function(index,child,reverse){\nvar completeServerData=this.optCompleteServerCache_!=null?\nthis.optCompleteServerCache_:\nthis.viewCache_.getCompleteServerSnap();\nvar nodes=this.writes_.calcIndexedSlice(completeServerData,child,1,reverse,index);\nif(nodes.length===0){\nreturn null;\n}else\n{\nreturn nodes[0];\n}\n};\nreturn WriteTreeCompleteChildSource;\n}();\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n/**\r\n * @constructor\r\n * @struct\r\n */\nvar ProcessorResult=/** @class */function(){\n/**\r\n     * @param {!ViewCache} viewCache\r\n     * @param {!Array.<!Change>} changes\r\n     */\nfunction ProcessorResult(viewCache,changes){\nthis.viewCache=viewCache;\nthis.changes=changes;\n}\nreturn ProcessorResult;\n}();\n/**\r\n * @constructor\r\n */\nvar ViewProcessor=/** @class */function(){\n/**\r\n     * @param {!NodeFilter} filter_\r\n     */\nfunction ViewProcessor(filter_){\nthis.filter_=filter_;\n}\n/**\r\n     * @param {!ViewCache} viewCache\r\n     */\nViewProcessor.prototype.assertIndexed=function(viewCache){\nutil.assert(viewCache.getEventCache().getNode().isIndexed(this.filter_.getIndex()),'Event snap not indexed');\nutil.assert(viewCache.getServerCache().getNode().isIndexed(this.filter_.getIndex()),'Server snap not indexed');\n};\n/**\r\n     * @param {!ViewCache} oldViewCache\r\n     * @param {!Operation} operation\r\n     * @param {!WriteTreeRef} writesCache\r\n     * @param {?Node} completeCache\r\n     * @return {!ProcessorResult}\r\n     */\nViewProcessor.prototype.applyOperation=function(oldViewCache,operation,writesCache,completeCache){\nvar accumulator=new ChildChangeAccumulator();\nvar newViewCache,filterServerNode;\nif(operation.type===OperationType.OVERWRITE){\nvar overwrite=operation;\nif(overwrite.source.fromUser){\nnewViewCache=this.applyUserOverwrite_(oldViewCache,overwrite.path,overwrite.snap,writesCache,completeCache,accumulator);\n}else\n{\nutil.assert(overwrite.source.fromServer,'Unknown source.');\n// We filter the node if it's a tagged update or the node has been previously filtered  and the\n// update is not at the root in which case it is ok (and necessary) to mark the node unfiltered\n// again\nfilterServerNode=\noverwrite.source.tagged||\noldViewCache.getServerCache().isFiltered()&&\n!overwrite.path.isEmpty();\nnewViewCache=this.applyServerOverwrite_(oldViewCache,overwrite.path,overwrite.snap,writesCache,completeCache,filterServerNode,accumulator);\n}\n}else\nif(operation.type===OperationType.MERGE){\nvar merge=operation;\nif(merge.source.fromUser){\nnewViewCache=this.applyUserMerge_(oldViewCache,merge.path,merge.children,writesCache,completeCache,accumulator);\n}else\n{\nutil.assert(merge.source.fromServer,'Unknown source.');\n// We filter the node if it's a tagged update or the node has been previously filtered\nfilterServerNode=\nmerge.source.tagged||oldViewCache.getServerCache().isFiltered();\nnewViewCache=this.applyServerMerge_(oldViewCache,merge.path,merge.children,writesCache,completeCache,filterServerNode,accumulator);\n}\n}else\nif(operation.type===OperationType.ACK_USER_WRITE){\nvar ackUserWrite=operation;\nif(!ackUserWrite.revert){\nnewViewCache=this.ackUserWrite_(oldViewCache,ackUserWrite.path,ackUserWrite.affectedTree,writesCache,completeCache,accumulator);\n}else\n{\nnewViewCache=this.revertUserWrite_(oldViewCache,ackUserWrite.path,writesCache,completeCache,accumulator);\n}\n}else\nif(operation.type===OperationType.LISTEN_COMPLETE){\nnewViewCache=this.listenComplete_(oldViewCache,operation.path,writesCache,accumulator);\n}else\n{\nthrow util.assertionError('Unknown operation type: '+operation.type);\n}\nvar changes=accumulator.getChanges();\nViewProcessor.maybeAddValueEvent_(oldViewCache,newViewCache,changes);\nreturn new ProcessorResult(newViewCache,changes);\n};\n/**\r\n     * @param {!ViewCache} oldViewCache\r\n     * @param {!ViewCache} newViewCache\r\n     * @param {!Array.<!Change>} accumulator\r\n     * @private\r\n     */\nViewProcessor.maybeAddValueEvent_=function(oldViewCache,newViewCache,accumulator){\nvar eventSnap=newViewCache.getEventCache();\nif(eventSnap.isFullyInitialized()){\nvar isLeafOrEmpty=eventSnap.getNode().isLeafNode()||eventSnap.getNode().isEmpty();\nvar oldCompleteSnap=oldViewCache.getCompleteEventSnap();\nif(accumulator.length>0||\n!oldViewCache.getEventCache().isFullyInitialized()||\nisLeafOrEmpty&&\n!eventSnap.getNode().equals(/** @type {!Node} */oldCompleteSnap)||\n!eventSnap.getNode().getPriority().equals(oldCompleteSnap.getPriority())){\naccumulator.push(Change.valueChange(\n/** @type {!Node} */newViewCache.getCompleteEventSnap()));\n}\n}\n};\n/**\r\n     * @param {!ViewCache} viewCache\r\n     * @param {!Path} changePath\r\n     * @param {!WriteTreeRef} writesCache\r\n     * @param {!CompleteChildSource} source\r\n     * @param {!ChildChangeAccumulator} accumulator\r\n     * @return {!ViewCache}\r\n     * @private\r\n     */\nViewProcessor.prototype.generateEventCacheAfterServerEvent_=function(viewCache,changePath,writesCache,source,accumulator){\nvar oldEventSnap=viewCache.getEventCache();\nif(writesCache.shadowingWrite(changePath)!=null){\n// we have a shadowing write, ignore changes\nreturn viewCache;\n}else\n{\nvar newEventCache=void 0,serverNode=void 0;\nif(changePath.isEmpty()){\n// TODO: figure out how this plays with \"sliding ack windows\"\nutil.assert(viewCache.getServerCache().isFullyInitialized(),'If change path is empty, we must have complete server data');\nif(viewCache.getServerCache().isFiltered()){\n// We need to special case this, because we need to only apply writes to complete children, or\n// we might end up raising events for incomplete children. If the server data is filtered deep\n// writes cannot be guaranteed to be complete\nvar serverCache=viewCache.getCompleteServerSnap();\nvar completeChildren=serverCache instanceof ChildrenNode?\nserverCache:\nChildrenNode.EMPTY_NODE;\nvar completeEventChildren=writesCache.calcCompleteEventChildren(completeChildren);\nnewEventCache=this.filter_.updateFullNode(viewCache.getEventCache().getNode(),completeEventChildren,accumulator);\n}else\n{\nvar completeNode=writesCache.calcCompleteEventCache(viewCache.getCompleteServerSnap());\nnewEventCache=this.filter_.updateFullNode(viewCache.getEventCache().getNode(),completeNode,accumulator);\n}\n}else\n{\nvar childKey=changePath.getFront();\nif(childKey==='.priority'){\nutil.assert(changePath.getLength()===1,\"Can't have a priority with additional path components\");\nvar oldEventNode=oldEventSnap.getNode();\nserverNode=viewCache.getServerCache().getNode();\n// we might have overwrites for this priority\nvar updatedPriority=writesCache.calcEventCacheAfterServerOverwrite(changePath,oldEventNode,serverNode);\nif(updatedPriority!=null){\nnewEventCache=this.filter_.updatePriority(oldEventNode,updatedPriority);\n}else\n{\n// priority didn't change, keep old node\nnewEventCache=oldEventSnap.getNode();\n}\n}else\n{\nvar childChangePath=changePath.popFront();\n// update child\nvar newEventChild=void 0;\nif(oldEventSnap.isCompleteForChild(childKey)){\nserverNode=viewCache.getServerCache().getNode();\nvar eventChildUpdate=writesCache.calcEventCacheAfterServerOverwrite(changePath,oldEventSnap.getNode(),serverNode);\nif(eventChildUpdate!=null){\nnewEventChild=oldEventSnap.\ngetNode().\ngetImmediateChild(childKey).\nupdateChild(childChangePath,eventChildUpdate);\n}else\n{\n// Nothing changed, just keep the old child\nnewEventChild=oldEventSnap.\ngetNode().\ngetImmediateChild(childKey);\n}\n}else\n{\nnewEventChild=writesCache.calcCompleteChild(childKey,viewCache.getServerCache());\n}\nif(newEventChild!=null){\nnewEventCache=this.filter_.updateChild(oldEventSnap.getNode(),childKey,newEventChild,childChangePath,source,accumulator);\n}else\n{\n// no complete child available or no change\nnewEventCache=oldEventSnap.getNode();\n}\n}\n}\nreturn viewCache.updateEventSnap(newEventCache,oldEventSnap.isFullyInitialized()||changePath.isEmpty(),this.filter_.filtersNodes());\n}\n};\n/**\r\n     * @param {!ViewCache} oldViewCache\r\n     * @param {!Path} changePath\r\n     * @param {!Node} changedSnap\r\n     * @param {!WriteTreeRef} writesCache\r\n     * @param {?Node} completeCache\r\n     * @param {boolean} filterServerNode\r\n     * @param {!ChildChangeAccumulator} accumulator\r\n     * @return {!ViewCache}\r\n     * @private\r\n     */\nViewProcessor.prototype.applyServerOverwrite_=function(oldViewCache,changePath,changedSnap,writesCache,completeCache,filterServerNode,accumulator){\nvar oldServerSnap=oldViewCache.getServerCache();\nvar newServerCache;\nvar serverFilter=filterServerNode?\nthis.filter_:\nthis.filter_.getIndexedFilter();\nif(changePath.isEmpty()){\nnewServerCache=serverFilter.updateFullNode(oldServerSnap.getNode(),changedSnap,null);\n}else\nif(serverFilter.filtersNodes()&&!oldServerSnap.isFiltered()){\n// we want to filter the server node, but we didn't filter the server node yet, so simulate a full update\nvar newServerNode=oldServerSnap.\ngetNode().\nupdateChild(changePath,changedSnap);\nnewServerCache=serverFilter.updateFullNode(oldServerSnap.getNode(),newServerNode,null);\n}else\n{\nvar childKey=changePath.getFront();\nif(!oldServerSnap.isCompleteForPath(changePath)&&\nchangePath.getLength()>1){\n// We don't update incomplete nodes with updates intended for other listeners\nreturn oldViewCache;\n}\nvar childChangePath=changePath.popFront();\nvar childNode=oldServerSnap.getNode().getImmediateChild(childKey);\nvar newChildNode=childNode.updateChild(childChangePath,changedSnap);\nif(childKey==='.priority'){\nnewServerCache=serverFilter.updatePriority(oldServerSnap.getNode(),newChildNode);\n}else\n{\nnewServerCache=serverFilter.updateChild(oldServerSnap.getNode(),childKey,newChildNode,childChangePath,NO_COMPLETE_CHILD_SOURCE,null);\n}\n}\nvar newViewCache=oldViewCache.updateServerSnap(newServerCache,oldServerSnap.isFullyInitialized()||changePath.isEmpty(),serverFilter.filtersNodes());\nvar source=new WriteTreeCompleteChildSource(writesCache,newViewCache,completeCache);\nreturn this.generateEventCacheAfterServerEvent_(newViewCache,changePath,writesCache,source,accumulator);\n};\n/**\r\n     * @param {!ViewCache} oldViewCache\r\n     * @param {!Path} changePath\r\n     * @param {!Node} changedSnap\r\n     * @param {!WriteTreeRef} writesCache\r\n     * @param {?Node} completeCache\r\n     * @param {!ChildChangeAccumulator} accumulator\r\n     * @return {!ViewCache}\r\n     * @private\r\n     */\nViewProcessor.prototype.applyUserOverwrite_=function(oldViewCache,changePath,changedSnap,writesCache,completeCache,accumulator){\nvar oldEventSnap=oldViewCache.getEventCache();\nvar newViewCache,newEventCache;\nvar source=new WriteTreeCompleteChildSource(writesCache,oldViewCache,completeCache);\nif(changePath.isEmpty()){\nnewEventCache=this.filter_.updateFullNode(oldViewCache.getEventCache().getNode(),changedSnap,accumulator);\nnewViewCache=oldViewCache.updateEventSnap(newEventCache,true,this.filter_.filtersNodes());\n}else\n{\nvar childKey=changePath.getFront();\nif(childKey==='.priority'){\nnewEventCache=this.filter_.updatePriority(oldViewCache.getEventCache().getNode(),changedSnap);\nnewViewCache=oldViewCache.updateEventSnap(newEventCache,oldEventSnap.isFullyInitialized(),oldEventSnap.isFiltered());\n}else\n{\nvar childChangePath=changePath.popFront();\nvar oldChild=oldEventSnap.getNode().getImmediateChild(childKey);\nvar newChild=void 0;\nif(childChangePath.isEmpty()){\n// Child overwrite, we can replace the child\nnewChild=changedSnap;\n}else\n{\nvar childNode=source.getCompleteChild(childKey);\nif(childNode!=null){\nif(childChangePath.getBack()==='.priority'&&\nchildNode.getChild(childChangePath.parent()).isEmpty()){\n// This is a priority update on an empty node. If this node exists on the server, the\n// server will send down the priority in the update, so ignore for now\nnewChild=childNode;\n}else\n{\nnewChild=childNode.updateChild(childChangePath,changedSnap);\n}\n}else\n{\n// There is no complete child node available\nnewChild=ChildrenNode.EMPTY_NODE;\n}\n}\nif(!oldChild.equals(newChild)){\nvar newEventSnap=this.filter_.updateChild(oldEventSnap.getNode(),childKey,newChild,childChangePath,source,accumulator);\nnewViewCache=oldViewCache.updateEventSnap(newEventSnap,oldEventSnap.isFullyInitialized(),this.filter_.filtersNodes());\n}else\n{\nnewViewCache=oldViewCache;\n}\n}\n}\nreturn newViewCache;\n};\n/**\r\n     * @param {!ViewCache} viewCache\r\n     * @param {string} childKey\r\n     * @return {boolean}\r\n     * @private\r\n     */\nViewProcessor.cacheHasChild_=function(viewCache,childKey){\nreturn viewCache.getEventCache().isCompleteForChild(childKey);\n};\n/**\r\n     * @param {!ViewCache} viewCache\r\n     * @param {!Path} path\r\n     * @param {ImmutableTree.<!Node>} changedChildren\r\n     * @param {!WriteTreeRef} writesCache\r\n     * @param {?Node} serverCache\r\n     * @param {!ChildChangeAccumulator} accumulator\r\n     * @return {!ViewCache}\r\n     * @private\r\n     */\nViewProcessor.prototype.applyUserMerge_=function(viewCache,path,changedChildren,writesCache,serverCache,accumulator){\nvar _this=this;\n// HACK: In the case of a limit query, there may be some changes that bump things out of the\n// window leaving room for new items.  It's important we process these changes first, so we\n// iterate the changes twice, first processing any that affect items currently in view.\n// TODO: I consider an item \"in view\" if cacheHasChild is true, which checks both the server\n// and event snap.  I'm not sure if this will result in edge cases when a child is in one but\n// not the other.\nvar curViewCache=viewCache;\nchangedChildren.foreach(function(relativePath,childNode){\nvar writePath=path.child(relativePath);\nif(ViewProcessor.cacheHasChild_(viewCache,writePath.getFront())){\ncurViewCache=_this.applyUserOverwrite_(curViewCache,writePath,childNode,writesCache,serverCache,accumulator);\n}\n});\nchangedChildren.foreach(function(relativePath,childNode){\nvar writePath=path.child(relativePath);\nif(!ViewProcessor.cacheHasChild_(viewCache,writePath.getFront())){\ncurViewCache=_this.applyUserOverwrite_(curViewCache,writePath,childNode,writesCache,serverCache,accumulator);\n}\n});\nreturn curViewCache;\n};\n/**\r\n     * @param {!Node} node\r\n     * @param {ImmutableTree.<!Node>} merge\r\n     * @return {!Node}\r\n     * @private\r\n     */\nViewProcessor.prototype.applyMerge_=function(node,merge){\nmerge.foreach(function(relativePath,childNode){\nnode=node.updateChild(relativePath,childNode);\n});\nreturn node;\n};\n/**\r\n     * @param {!ViewCache} viewCache\r\n     * @param {!Path} path\r\n     * @param {!ImmutableTree.<!Node>} changedChildren\r\n     * @param {!WriteTreeRef} writesCache\r\n     * @param {?Node} serverCache\r\n     * @param {boolean} filterServerNode\r\n     * @param {!ChildChangeAccumulator} accumulator\r\n     * @return {!ViewCache}\r\n     * @private\r\n     */\nViewProcessor.prototype.applyServerMerge_=function(viewCache,path,changedChildren,writesCache,serverCache,filterServerNode,accumulator){\nvar _this=this;\n// If we don't have a cache yet, this merge was intended for a previously listen in the same location. Ignore it and\n// wait for the complete data update coming soon.\nif(viewCache.getServerCache().getNode().isEmpty()&&\n!viewCache.getServerCache().isFullyInitialized()){\nreturn viewCache;\n}\n// HACK: In the case of a limit query, there may be some changes that bump things out of the\n// window leaving room for new items.  It's important we process these changes first, so we\n// iterate the changes twice, first processing any that affect items currently in view.\n// TODO: I consider an item \"in view\" if cacheHasChild is true, which checks both the server\n// and event snap.  I'm not sure if this will result in edge cases when a child is in one but\n// not the other.\nvar curViewCache=viewCache;\nvar viewMergeTree;\nif(path.isEmpty()){\nviewMergeTree=changedChildren;\n}else\n{\nviewMergeTree=ImmutableTree.Empty.setTree(path,changedChildren);\n}\nvar serverNode=viewCache.getServerCache().getNode();\nviewMergeTree.children.inorderTraversal(function(childKey,childTree){\nif(serverNode.hasChild(childKey)){\nvar serverChild=viewCache.\ngetServerCache().\ngetNode().\ngetImmediateChild(childKey);\nvar newChild=_this.applyMerge_(serverChild,childTree);\ncurViewCache=_this.applyServerOverwrite_(curViewCache,new Path(childKey),newChild,writesCache,serverCache,filterServerNode,accumulator);\n}\n});\nviewMergeTree.children.inorderTraversal(function(childKey,childMergeTree){\nvar isUnknownDeepMerge=!viewCache.getServerCache().isCompleteForChild(childKey)&&\nchildMergeTree.value==null;\nif(!serverNode.hasChild(childKey)&&!isUnknownDeepMerge){\nvar serverChild=viewCache.\ngetServerCache().\ngetNode().\ngetImmediateChild(childKey);\nvar newChild=_this.applyMerge_(serverChild,childMergeTree);\ncurViewCache=_this.applyServerOverwrite_(curViewCache,new Path(childKey),newChild,writesCache,serverCache,filterServerNode,accumulator);\n}\n});\nreturn curViewCache;\n};\n/**\r\n     * @param {!ViewCache} viewCache\r\n     * @param {!Path} ackPath\r\n     * @param {!ImmutableTree<!boolean>} affectedTree\r\n     * @param {!WriteTreeRef} writesCache\r\n     * @param {?Node} completeCache\r\n     * @param {!ChildChangeAccumulator} accumulator\r\n     * @return {!ViewCache}\r\n     * @private\r\n     */\nViewProcessor.prototype.ackUserWrite_=function(viewCache,ackPath,affectedTree,writesCache,completeCache,accumulator){\nif(writesCache.shadowingWrite(ackPath)!=null){\nreturn viewCache;\n}\n// Only filter server node if it is currently filtered\nvar filterServerNode=viewCache.getServerCache().isFiltered();\n// Essentially we'll just get our existing server cache for the affected paths and re-apply it as a server update\n// now that it won't be shadowed.\nvar serverCache=viewCache.getServerCache();\nif(affectedTree.value!=null){\n// This is an overwrite.\nif(ackPath.isEmpty()&&serverCache.isFullyInitialized()||\nserverCache.isCompleteForPath(ackPath)){\nreturn this.applyServerOverwrite_(viewCache,ackPath,serverCache.getNode().getChild(ackPath),writesCache,completeCache,filterServerNode,accumulator);\n}else\nif(ackPath.isEmpty()){\n// This is a goofy edge case where we are acking data at this location but don't have full data.  We\n// should just re-apply whatever we have in our cache as a merge.\nvar changedChildren_1=ImmutableTree.Empty;\nserverCache.getNode().forEachChild(KEY_INDEX,function(name,node){\nchangedChildren_1=changedChildren_1.set(new Path(name),node);\n});\nreturn this.applyServerMerge_(viewCache,ackPath,changedChildren_1,writesCache,completeCache,filterServerNode,accumulator);\n}else\n{\nreturn viewCache;\n}\n}else\n{\n// This is a merge.\nvar changedChildren_2=ImmutableTree.Empty;\naffectedTree.foreach(function(mergePath,value){\nvar serverCachePath=ackPath.child(mergePath);\nif(serverCache.isCompleteForPath(serverCachePath)){\nchangedChildren_2=changedChildren_2.set(mergePath,serverCache.getNode().getChild(serverCachePath));\n}\n});\nreturn this.applyServerMerge_(viewCache,ackPath,changedChildren_2,writesCache,completeCache,filterServerNode,accumulator);\n}\n};\n/**\r\n     * @param {!ViewCache} viewCache\r\n     * @param {!Path} path\r\n     * @param {!WriteTreeRef} writesCache\r\n     * @param {!ChildChangeAccumulator} accumulator\r\n     * @return {!ViewCache}\r\n     * @private\r\n     */\nViewProcessor.prototype.listenComplete_=function(viewCache,path,writesCache,accumulator){\nvar oldServerNode=viewCache.getServerCache();\nvar newViewCache=viewCache.updateServerSnap(oldServerNode.getNode(),oldServerNode.isFullyInitialized()||path.isEmpty(),oldServerNode.isFiltered());\nreturn this.generateEventCacheAfterServerEvent_(newViewCache,path,writesCache,NO_COMPLETE_CHILD_SOURCE,accumulator);\n};\n/**\r\n     * @param {!ViewCache} viewCache\r\n     * @param {!Path} path\r\n     * @param {!WriteTreeRef} writesCache\r\n     * @param {?Node} completeServerCache\r\n     * @param {!ChildChangeAccumulator} accumulator\r\n     * @return {!ViewCache}\r\n     * @private\r\n     */\nViewProcessor.prototype.revertUserWrite_=function(viewCache,path,writesCache,completeServerCache,accumulator){\nvar complete;\nif(writesCache.shadowingWrite(path)!=null){\nreturn viewCache;\n}else\n{\nvar source=new WriteTreeCompleteChildSource(writesCache,viewCache,completeServerCache);\nvar oldEventCache=viewCache.getEventCache().getNode();\nvar newEventCache=void 0;\nif(path.isEmpty()||path.getFront()==='.priority'){\nvar newNode=void 0;\nif(viewCache.getServerCache().isFullyInitialized()){\nnewNode=writesCache.calcCompleteEventCache(viewCache.getCompleteServerSnap());\n}else\n{\nvar serverChildren=viewCache.getServerCache().getNode();\nutil.assert(serverChildren instanceof ChildrenNode,'serverChildren would be complete if leaf node');\nnewNode=writesCache.calcCompleteEventChildren(serverChildren);\n}\nnewNode=newNode;\nnewEventCache=this.filter_.updateFullNode(oldEventCache,newNode,accumulator);\n}else\n{\nvar childKey=path.getFront();\nvar newChild=writesCache.calcCompleteChild(childKey,viewCache.getServerCache());\nif(newChild==null&&\nviewCache.getServerCache().isCompleteForChild(childKey)){\nnewChild=oldEventCache.getImmediateChild(childKey);\n}\nif(newChild!=null){\nnewEventCache=this.filter_.updateChild(oldEventCache,childKey,newChild,path.popFront(),source,accumulator);\n}else\nif(viewCache.getEventCache().getNode().hasChild(childKey)){\n// No complete child available, delete the existing one, if any\nnewEventCache=this.filter_.updateChild(oldEventCache,childKey,ChildrenNode.EMPTY_NODE,path.popFront(),source,accumulator);\n}else\n{\nnewEventCache=oldEventCache;\n}\nif(newEventCache.isEmpty()&&\nviewCache.getServerCache().isFullyInitialized()){\n// We might have reverted all child writes. Maybe the old event was a leaf node\ncomplete=writesCache.calcCompleteEventCache(viewCache.getCompleteServerSnap());\nif(complete.isLeafNode()){\nnewEventCache=this.filter_.updateFullNode(newEventCache,complete,accumulator);\n}\n}\n}\ncomplete=\nviewCache.getServerCache().isFullyInitialized()||\nwritesCache.shadowingWrite(Path.Empty)!=null;\nreturn viewCache.updateEventSnap(newEventCache,complete,this.filter_.filtersNodes());\n}\n};\nreturn ViewProcessor;\n}();\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n/**\r\n * An EventGenerator is used to convert \"raw\" changes (Change) as computed by the\r\n * CacheDiffer into actual events (Event) that can be raised.  See generateEventsForChanges()\r\n * for details.\r\n *\r\n * @constructor\r\n */\nvar EventGenerator=/** @class */function(){\n/**\r\n     *\r\n     * @param {!Query} query_\r\n     */\nfunction EventGenerator(query_){\nthis.query_=query_;\n/**\r\n         * @private\r\n         * @type {!Index}\r\n         */\nthis.index_=this.query_.getQueryParams().getIndex();\n}\n/**\r\n     * Given a set of raw changes (no moved events and prevName not specified yet), and a set of\r\n     * EventRegistrations that should be notified of these changes, generate the actual events to be raised.\r\n     *\r\n     * Notes:\r\n     *  - child_moved events will be synthesized at this time for any child_changed events that affect\r\n     *    our index.\r\n     *  - prevName will be calculated based on the index ordering.\r\n     *\r\n     * @param {!Array.<!Change>} changes\r\n     * @param {!Node} eventCache\r\n     * @param {!Array.<!EventRegistration>} eventRegistrations\r\n     * @return {!Array.<!Event>}\r\n     */\nEventGenerator.prototype.generateEventsForChanges=function(changes,eventCache,eventRegistrations){\nvar _this=this;\nvar events=[];\nvar moves=[];\nchanges.forEach(function(change){\nif(change.type===Change.CHILD_CHANGED&&\n_this.index_.indexedValueChanged(change.oldSnap,change.snapshotNode)){\nmoves.push(Change.childMovedChange(change.childName,change.snapshotNode));\n}\n});\nthis.generateEventsForType_(events,Change.CHILD_REMOVED,changes,eventRegistrations,eventCache);\nthis.generateEventsForType_(events,Change.CHILD_ADDED,changes,eventRegistrations,eventCache);\nthis.generateEventsForType_(events,Change.CHILD_MOVED,moves,eventRegistrations,eventCache);\nthis.generateEventsForType_(events,Change.CHILD_CHANGED,changes,eventRegistrations,eventCache);\nthis.generateEventsForType_(events,Change.VALUE,changes,eventRegistrations,eventCache);\nreturn events;\n};\n/**\r\n     * Given changes of a single change type, generate the corresponding events.\r\n     *\r\n     * @param {!Array.<!Event>} events\r\n     * @param {!string} eventType\r\n     * @param {!Array.<!Change>} changes\r\n     * @param {!Array.<!EventRegistration>} registrations\r\n     * @param {!Node} eventCache\r\n     * @private\r\n     */\nEventGenerator.prototype.generateEventsForType_=function(events,eventType,changes,registrations,eventCache){\nvar _this=this;\nvar filteredChanges=changes.filter(function(change){return change.type===eventType;});\nfilteredChanges.sort(this.compareChanges_.bind(this));\nfilteredChanges.forEach(function(change){\nvar materializedChange=_this.materializeSingleChange_(change,eventCache);\nregistrations.forEach(function(registration){\nif(registration.respondsTo(change.type)){\nevents.push(registration.createEvent(materializedChange,_this.query_));\n}\n});\n});\n};\n/**\r\n     * @param {!Change} change\r\n     * @param {!Node} eventCache\r\n     * @return {!Change}\r\n     * @private\r\n     */\nEventGenerator.prototype.materializeSingleChange_=function(change,eventCache){\nif(change.type==='value'||change.type==='child_removed'){\nreturn change;\n}else\n{\nchange.prevName=eventCache.getPredecessorChildName(\n/** @type {!string} */\nchange.childName,change.snapshotNode,this.index_);\nreturn change;\n}\n};\n/**\r\n     * @param {!Change} a\r\n     * @param {!Change} b\r\n     * @return {number}\r\n     * @private\r\n     */\nEventGenerator.prototype.compareChanges_=function(a,b){\nif(a.childName==null||b.childName==null){\nthrow util.assertionError('Should only compare child_ events.');\n}\nvar aWrapped=new NamedNode(a.childName,a.snapshotNode);\nvar bWrapped=new NamedNode(b.childName,b.snapshotNode);\nreturn this.index_.compare(aWrapped,bWrapped);\n};\nreturn EventGenerator;\n}();\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n/**\r\n * A view represents a specific location and query that has 1 or more event registrations.\r\n *\r\n * It does several things:\r\n *  - Maintains the list of event registrations for this location/query.\r\n *  - Maintains a cache of the data visible for this location/query.\r\n *  - Applies new operations (via applyOperation), updates the cache, and based on the event\r\n *    registrations returns the set of events to be raised.\r\n * @constructor\r\n */\nvar View=/** @class */function(){\n/**\r\n     *\r\n     * @param {!Query} query_\r\n     * @param {!ViewCache} initialViewCache\r\n     */\nfunction View(query_,initialViewCache){\nthis.query_=query_;\nthis.eventRegistrations_=[];\nvar params=this.query_.getQueryParams();\nvar indexFilter=new IndexedFilter(params.getIndex());\nvar filter=params.getNodeFilter();\n/**\r\n         * @type {ViewProcessor}\r\n         * @private\r\n         */\nthis.processor_=new ViewProcessor(filter);\nvar initialServerCache=initialViewCache.getServerCache();\nvar initialEventCache=initialViewCache.getEventCache();\n// Don't filter server node with other filter than index, wait for tagged listen\nvar serverSnap=indexFilter.updateFullNode(ChildrenNode.EMPTY_NODE,initialServerCache.getNode(),null);\nvar eventSnap=filter.updateFullNode(ChildrenNode.EMPTY_NODE,initialEventCache.getNode(),null);\nvar newServerCache=new CacheNode(serverSnap,initialServerCache.isFullyInitialized(),indexFilter.filtersNodes());\nvar newEventCache=new CacheNode(eventSnap,initialEventCache.isFullyInitialized(),filter.filtersNodes());\n/**\r\n         * @type {!ViewCache}\r\n         * @private\r\n         */\nthis.viewCache_=new ViewCache(newEventCache,newServerCache);\n/**\r\n         * @type {!EventGenerator}\r\n         * @private\r\n         */\nthis.eventGenerator_=new EventGenerator(this.query_);\n}\n/**\r\n     * @return {!Query}\r\n     */\nView.prototype.getQuery=function(){\nreturn this.query_;\n};\n/**\r\n     * @return {?Node}\r\n     */\nView.prototype.getServerCache=function(){\nreturn this.viewCache_.getServerCache().getNode();\n};\n/**\r\n     * @param {!Path} path\r\n     * @return {?Node}\r\n     */\nView.prototype.getCompleteServerCache=function(path){\nvar cache=this.viewCache_.getCompleteServerSnap();\nif(cache){\n// If this isn't a \"loadsAllData\" view, then cache isn't actually a complete cache and\n// we need to see if it contains the child we're interested in.\nif(this.query_.getQueryParams().loadsAllData()||\n!path.isEmpty()&&!cache.getImmediateChild(path.getFront()).isEmpty()){\nreturn cache.getChild(path);\n}\n}\nreturn null;\n};\n/**\r\n     * @return {boolean}\r\n     */\nView.prototype.isEmpty=function(){\nreturn this.eventRegistrations_.length===0;\n};\n/**\r\n     * @param {!EventRegistration} eventRegistration\r\n     */\nView.prototype.addEventRegistration=function(eventRegistration){\nthis.eventRegistrations_.push(eventRegistration);\n};\n/**\r\n     * @param {?EventRegistration} eventRegistration If null, remove all callbacks.\r\n     * @param {Error=} cancelError If a cancelError is provided, appropriate cancel events will be returned.\r\n     * @return {!Array.<!Event>} Cancel events, if cancelError was provided.\r\n     */\nView.prototype.removeEventRegistration=function(eventRegistration,cancelError){\nvar cancelEvents=[];\nif(cancelError){\nutil.assert(eventRegistration==null,'A cancel should cancel all event registrations.');\nvar path_1=this.query_.path;\nthis.eventRegistrations_.forEach(function(registration){\ncancelError/** @type {!Error} */=cancelError;\nvar maybeEvent=registration.createCancelEvent(cancelError,path_1);\nif(maybeEvent){\ncancelEvents.push(maybeEvent);\n}\n});\n}\nif(eventRegistration){\nvar remaining=[];\nfor(var i=0;i<this.eventRegistrations_.length;++i){\nvar existing=this.eventRegistrations_[i];\nif(!existing.matches(eventRegistration)){\nremaining.push(existing);\n}else\nif(eventRegistration.hasAnyCallback()){\n// We're removing just this one\nremaining=remaining.concat(this.eventRegistrations_.slice(i+1));\nbreak;\n}\n}\nthis.eventRegistrations_=remaining;\n}else\n{\nthis.eventRegistrations_=[];\n}\nreturn cancelEvents;\n};\n/**\r\n     * Applies the given Operation, updates our cache, and returns the appropriate events.\r\n     *\r\n     * @param {!Operation} operation\r\n     * @param {!WriteTreeRef} writesCache\r\n     * @param {?Node} completeServerCache\r\n     * @return {!Array.<!Event>}\r\n     */\nView.prototype.applyOperation=function(operation,writesCache,completeServerCache){\nif(operation.type===OperationType.MERGE&&\noperation.source.queryId!==null){\nutil.assert(this.viewCache_.getCompleteServerSnap(),'We should always have a full cache before handling merges');\nutil.assert(this.viewCache_.getCompleteEventSnap(),'Missing event cache, even though we have a server cache');\n}\nvar oldViewCache=this.viewCache_;\nvar result=this.processor_.applyOperation(oldViewCache,operation,writesCache,completeServerCache);\nthis.processor_.assertIndexed(result.viewCache);\nutil.assert(result.viewCache.getServerCache().isFullyInitialized()||\n!oldViewCache.getServerCache().isFullyInitialized(),'Once a server snap is complete, it should never go back');\nthis.viewCache_=result.viewCache;\nreturn this.generateEventsForChanges_(result.changes,result.viewCache.getEventCache().getNode(),null);\n};\n/**\r\n     * @param {!EventRegistration} registration\r\n     * @return {!Array.<!Event>}\r\n     */\nView.prototype.getInitialEvents=function(registration){\nvar eventSnap=this.viewCache_.getEventCache();\nvar initialChanges=[];\nif(!eventSnap.getNode().isLeafNode()){\nvar eventNode=eventSnap.getNode();\neventNode.forEachChild(PRIORITY_INDEX,function(key,childNode){\ninitialChanges.push(Change.childAddedChange(key,childNode));\n});\n}\nif(eventSnap.isFullyInitialized()){\ninitialChanges.push(Change.valueChange(eventSnap.getNode()));\n}\nreturn this.generateEventsForChanges_(initialChanges,eventSnap.getNode(),registration);\n};\n/**\r\n     * @private\r\n     * @param {!Array.<!Change>} changes\r\n     * @param {!Node} eventCache\r\n     * @param {EventRegistration=} eventRegistration\r\n     * @return {!Array.<!Event>}\r\n     */\nView.prototype.generateEventsForChanges_=function(changes,eventCache,eventRegistration){\nvar registrations=eventRegistration?\n[eventRegistration]:\nthis.eventRegistrations_;\nreturn this.eventGenerator_.generateEventsForChanges(changes,eventCache,registrations);\n};\nreturn View;\n}();\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\nvar __referenceConstructor$1;\n/**\r\n * SyncPoint represents a single location in a SyncTree with 1 or more event registrations, meaning we need to\r\n * maintain 1 or more Views at this location to cache server data and raise appropriate events for server changes\r\n * and user writes (set, transaction, update).\r\n *\r\n * It's responsible for:\r\n *  - Maintaining the set of 1 or more views necessary at this location (a SyncPoint with 0 views should be removed).\r\n *  - Proxying user / server operations to the views as appropriate (i.e. applyServerOverwrite,\r\n *    applyUserOverwrite, etc.)\r\n */\nvar SyncPoint=/** @class */function(){\nfunction SyncPoint(){\n/**\r\n         * The Views being tracked at this location in the tree, stored as a map where the key is a\r\n         * queryId and the value is the View for that query.\r\n         *\r\n         * NOTE: This list will be quite small (usually 1, but perhaps 2 or 3; any more is an odd use case).\r\n         */\nthis.views=new Map();\n}\nObject.defineProperty(SyncPoint,\"__referenceConstructor\",{\nget:function get(){\nutil.assert(__referenceConstructor$1,'Reference.ts has not been loaded');\nreturn __referenceConstructor$1;\n},\nset:function set(val){\nutil.assert(!__referenceConstructor$1,'__referenceConstructor has already been defined');\n__referenceConstructor$1=val;\n},\nenumerable:false,\nconfigurable:true});\n\nSyncPoint.prototype.isEmpty=function(){\nreturn this.views.size===0;\n};\nSyncPoint.prototype.applyOperation=function(operation,writesCache,optCompleteServerCache){\nvar e_1,_a;\nvar queryId=operation.source.queryId;\nif(queryId!==null){\nvar view=this.views.get(queryId);\nutil.assert(view!=null,'SyncTree gave us an op for an invalid query.');\nreturn view.applyOperation(operation,writesCache,optCompleteServerCache);\n}else\n{\nvar events=[];\ntry{\nfor(var _b=tslib.__values(this.views.values()),_c=_b.next();!_c.done;_c=_b.next()){\nvar view=_c.value;\nevents=events.concat(view.applyOperation(operation,writesCache,optCompleteServerCache));\n}\n}\ncatch(e_1_1){e_1={error:e_1_1};}finally\n{\ntry{\nif(_c&&!_c.done&&(_a=_b.return))_a.call(_b);\n}finally\n{if(e_1)throw e_1.error;}\n}\nreturn events;\n}\n};\n/**\r\n     * Add an event callback for the specified query.\r\n     *\r\n     * @param {!Query} query\r\n     * @param {!EventRegistration} eventRegistration\r\n     * @param {!WriteTreeRef} writesCache\r\n     * @param {?Node} serverCache Complete server cache, if we have it.\r\n     * @param {boolean} serverCacheComplete\r\n     * @return {!Array.<!Event>} Events to raise.\r\n     */\nSyncPoint.prototype.addEventRegistration=function(query,eventRegistration,writesCache,serverCache,serverCacheComplete){\nvar queryId=query.queryIdentifier();\nvar view=this.views.get(queryId);\nif(!view){\n// TODO: make writesCache take flag for complete server node\nvar eventCache=writesCache.calcCompleteEventCache(serverCacheComplete?serverCache:null);\nvar eventCacheComplete=false;\nif(eventCache){\neventCacheComplete=true;\n}else\nif(serverCache instanceof ChildrenNode){\neventCache=writesCache.calcCompleteEventChildren(serverCache);\neventCacheComplete=false;\n}else\n{\neventCache=ChildrenNode.EMPTY_NODE;\neventCacheComplete=false;\n}\nvar viewCache=new ViewCache(new CacheNode(\n/** @type {!Node} */eventCache,eventCacheComplete,false),new CacheNode(\n/** @type {!Node} */serverCache,serverCacheComplete,false));\nview=new View(query,viewCache);\nthis.views.set(queryId,view);\n}\n// This is guaranteed to exist now, we just created anything that was missing\nview.addEventRegistration(eventRegistration);\nreturn view.getInitialEvents(eventRegistration);\n};\n/**\r\n     * Remove event callback(s).  Return cancelEvents if a cancelError is specified.\r\n     *\r\n     * If query is the default query, we'll check all views for the specified eventRegistration.\r\n     * If eventRegistration is null, we'll remove all callbacks for the specified view(s).\r\n     *\r\n     * @param {!Query} query\r\n     * @param {?EventRegistration} eventRegistration If null, remove all callbacks.\r\n     * @param {Error=} cancelError If a cancelError is provided, appropriate cancel events will be returned.\r\n     * @return {{removed:!Array.<!Query>, events:!Array.<!Event>}} removed queries and any cancel events\r\n     */\nSyncPoint.prototype.removeEventRegistration=function(query,eventRegistration,cancelError){\nvar e_2,_a;\nvar queryId=query.queryIdentifier();\nvar removed=[];\nvar cancelEvents=[];\nvar hadCompleteView=this.hasCompleteView();\nif(queryId==='default'){\ntry{\n// When you do ref.off(...), we search all views for the registration to remove.\nfor(var _b=tslib.__values(this.views.entries()),_c=_b.next();!_c.done;_c=_b.next()){\nvar _d=tslib.__read(_c.value,2),viewQueryId=_d[0],view=_d[1];\ncancelEvents=cancelEvents.concat(view.removeEventRegistration(eventRegistration,cancelError));\nif(view.isEmpty()){\nthis.views.delete(viewQueryId);\n// We'll deal with complete views later.\nif(!view.getQuery().getQueryParams().loadsAllData()){\nremoved.push(view.getQuery());\n}\n}\n}\n}\ncatch(e_2_1){e_2={error:e_2_1};}finally\n{\ntry{\nif(_c&&!_c.done&&(_a=_b.return))_a.call(_b);\n}finally\n{if(e_2)throw e_2.error;}\n}\n}else\n{\n// remove the callback from the specific view.\nvar view=this.views.get(queryId);\nif(view){\ncancelEvents=cancelEvents.concat(view.removeEventRegistration(eventRegistration,cancelError));\nif(view.isEmpty()){\nthis.views.delete(queryId);\n// We'll deal with complete views later.\nif(!view.getQuery().getQueryParams().loadsAllData()){\nremoved.push(view.getQuery());\n}\n}\n}\n}\nif(hadCompleteView&&!this.hasCompleteView()){\n// We removed our last complete view.\nremoved.push(new SyncPoint.__referenceConstructor(query.repo,query.path));\n}\nreturn{removed:removed,events:cancelEvents};\n};\nSyncPoint.prototype.getQueryViews=function(){\nvar e_3,_a;\nvar result=[];\ntry{\nfor(var _b=tslib.__values(this.views.values()),_c=_b.next();!_c.done;_c=_b.next()){\nvar view=_c.value;\nif(!view.getQuery().getQueryParams().loadsAllData()){\nresult.push(view);\n}\n}\n}\ncatch(e_3_1){e_3={error:e_3_1};}finally\n{\ntry{\nif(_c&&!_c.done&&(_a=_b.return))_a.call(_b);\n}finally\n{if(e_3)throw e_3.error;}\n}\nreturn result;\n};\n/**\r\n     * @param path The path to the desired complete snapshot\r\n     * @return A complete cache, if it exists\r\n     */\nSyncPoint.prototype.getCompleteServerCache=function(path){\nvar e_4,_a;\nvar serverCache=null;\ntry{\nfor(var _b=tslib.__values(this.views.values()),_c=_b.next();!_c.done;_c=_b.next()){\nvar view=_c.value;\nserverCache=serverCache||view.getCompleteServerCache(path);\n}\n}\ncatch(e_4_1){e_4={error:e_4_1};}finally\n{\ntry{\nif(_c&&!_c.done&&(_a=_b.return))_a.call(_b);\n}finally\n{if(e_4)throw e_4.error;}\n}\nreturn serverCache;\n};\nSyncPoint.prototype.viewForQuery=function(query){\nvar params=query.getQueryParams();\nif(params.loadsAllData()){\nreturn this.getCompleteView();\n}else\n{\nvar queryId=query.queryIdentifier();\nreturn this.views.get(queryId);\n}\n};\nSyncPoint.prototype.viewExistsForQuery=function(query){\nreturn this.viewForQuery(query)!=null;\n};\nSyncPoint.prototype.hasCompleteView=function(){\nreturn this.getCompleteView()!=null;\n};\nSyncPoint.prototype.getCompleteView=function(){\nvar e_5,_a;\ntry{\nfor(var _b=tslib.__values(this.views.values()),_c=_b.next();!_c.done;_c=_b.next()){\nvar view=_c.value;\nif(view.getQuery().getQueryParams().loadsAllData()){\nreturn view;\n}\n}\n}\ncatch(e_5_1){e_5={error:e_5_1};}finally\n{\ntry{\nif(_c&&!_c.done&&(_a=_b.return))_a.call(_b);\n}finally\n{if(e_5)throw e_5.error;}\n}\nreturn null;\n};\nreturn SyncPoint;\n}();\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n/**\r\n * This class holds a collection of writes that can be applied to nodes in unison. It abstracts away the logic with\r\n * dealing with priority writes and multiple nested writes. At any given path there is only allowed to be one write\r\n * modifying that path. Any write to an existing path or shadowing an existing path will modify that existing write\r\n * to reflect the write added.\r\n */\nvar CompoundWrite=/** @class */function(){\nfunction CompoundWrite(writeTree_){\nthis.writeTree_=writeTree_;\n}\nCompoundWrite.prototype.addWrite=function(path,node){\nif(path.isEmpty()){\nreturn new CompoundWrite(new ImmutableTree(node));\n}else\n{\nvar rootmost=this.writeTree_.findRootMostValueAndPath(path);\nif(rootmost!=null){\nvar rootMostPath=rootmost.path;\nvar value=rootmost.value;\nvar relativePath=Path.relativePath(rootMostPath,path);\nvalue=value.updateChild(relativePath,node);\nreturn new CompoundWrite(this.writeTree_.set(rootMostPath,value));\n}else\n{\nvar subtree=new ImmutableTree(node);\nvar newWriteTree=this.writeTree_.setTree(path,subtree);\nreturn new CompoundWrite(newWriteTree);\n}\n}\n};\nCompoundWrite.prototype.addWrites=function(path,updates){\nvar newWrite=this;\neach(updates,function(childKey,node){\nnewWrite=newWrite.addWrite(path.child(childKey),node);\n});\nreturn newWrite;\n};\n/**\r\n     * Will remove a write at the given path and deeper paths. This will <em>not</em> modify a write at a higher\r\n     * location, which must be removed by calling this method with that path.\r\n     *\r\n     * @param path The path at which a write and all deeper writes should be removed\r\n     * @return {!CompoundWrite} The new CompoundWrite with the removed path\r\n     */\nCompoundWrite.prototype.removeWrite=function(path){\nif(path.isEmpty()){\nreturn CompoundWrite.Empty;\n}else\n{\nvar newWriteTree=this.writeTree_.setTree(path,ImmutableTree.Empty);\nreturn new CompoundWrite(newWriteTree);\n}\n};\n/**\r\n     * Returns whether this CompoundWrite will fully overwrite a node at a given location and can therefore be\r\n     * considered \"complete\".\r\n     *\r\n     * @param path The path to check for\r\n     * @return Whether there is a complete write at that path\r\n     */\nCompoundWrite.prototype.hasCompleteWrite=function(path){\nreturn this.getCompleteNode(path)!=null;\n};\n/**\r\n     * Returns a node for a path if and only if the node is a \"complete\" overwrite at that path. This will not aggregate\r\n     * writes from deeper paths, but will return child nodes from a more shallow path.\r\n     *\r\n     * @param path The path to get a complete write\r\n     * @return The node if complete at that path, or null otherwise.\r\n     */\nCompoundWrite.prototype.getCompleteNode=function(path){\nvar rootmost=this.writeTree_.findRootMostValueAndPath(path);\nif(rootmost!=null){\nreturn this.writeTree_.\nget(rootmost.path).\ngetChild(Path.relativePath(rootmost.path,path));\n}else\n{\nreturn null;\n}\n};\n/**\r\n     * Returns all children that are guaranteed to be a complete overwrite.\r\n     *\r\n     * @return A list of all complete children.\r\n     */\nCompoundWrite.prototype.getCompleteChildren=function(){\nvar children=[];\nvar node=this.writeTree_.value;\nif(node!=null){\n// If it's a leaf node, it has no children; so nothing to do.\nif(!node.isLeafNode()){\nnode.forEachChild(PRIORITY_INDEX,function(childName,childNode){\nchildren.push(new NamedNode(childName,childNode));\n});\n}\n}else\n{\nthis.writeTree_.children.inorderTraversal(function(childName,childTree){\nif(childTree.value!=null){\nchildren.push(new NamedNode(childName,childTree.value));\n}\n});\n}\nreturn children;\n};\nCompoundWrite.prototype.childCompoundWrite=function(path){\nif(path.isEmpty()){\nreturn this;\n}else\n{\nvar shadowingNode=this.getCompleteNode(path);\nif(shadowingNode!=null){\nreturn new CompoundWrite(new ImmutableTree(shadowingNode));\n}else\n{\nreturn new CompoundWrite(this.writeTree_.subtree(path));\n}\n}\n};\n/**\r\n     * Returns true if this CompoundWrite is empty and therefore does not modify any nodes.\r\n     * @return Whether this CompoundWrite is empty\r\n     */\nCompoundWrite.prototype.isEmpty=function(){\nreturn this.writeTree_.isEmpty();\n};\n/**\r\n     * Applies this CompoundWrite to a node. The node is returned with all writes from this CompoundWrite applied to the\r\n     * node\r\n     * @param node The node to apply this CompoundWrite to\r\n     * @return The node with all writes applied\r\n     */\nCompoundWrite.prototype.apply=function(node){\nreturn applySubtreeWrite(Path.Empty,this.writeTree_,node);\n};\nCompoundWrite.Empty=new CompoundWrite(new ImmutableTree(null));\nreturn CompoundWrite;\n}();\nfunction applySubtreeWrite(relativePath,writeTree,node){\nif(writeTree.value!=null){\n// Since there a write is always a leaf, we're done here\nreturn node.updateChild(relativePath,writeTree.value);\n}else\n{\nvar priorityWrite_1=null;\nwriteTree.children.inorderTraversal(function(childKey,childTree){\nif(childKey==='.priority'){\n// Apply priorities at the end so we don't update priorities for either empty nodes or forget\n// to apply priorities to empty nodes that are later filled\nutil.assert(childTree.value!==null,'Priority writes must always be leaf nodes');\npriorityWrite_1=childTree.value;\n}else\n{\nnode=applySubtreeWrite(relativePath.child(childKey),childTree,node);\n}\n});\n// If there was a priority write, we only apply it if the node is not empty\nif(!node.getChild(relativePath).isEmpty()&&priorityWrite_1!==null){\nnode=node.updateChild(relativePath.child('.priority'),priorityWrite_1);\n}\nreturn node;\n}\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n/**\r\n * WriteTree tracks all pending user-initiated writes and has methods to calculate the result of merging them\r\n * with underlying server data (to create \"event cache\" data).  Pending writes are added with addOverwrite()\r\n * and addMerge(), and removed with removeWrite().\r\n *\r\n * @constructor\r\n */\nvar WriteTree=/** @class */function(){\nfunction WriteTree(){\n/**\r\n         * A tree tracking the result of applying all visible writes.  This does not include transactions with\r\n         * applyLocally=false or writes that are completely shadowed by other writes.\r\n         *\r\n         * @type {!CompoundWrite}\r\n         * @private\r\n         */\nthis.visibleWrites_=CompoundWrite.Empty;\n/**\r\n         * A list of all pending writes, regardless of visibility and shadowed-ness.  Used to calculate arbitrary\r\n         * sets of the changed data, such as hidden writes (from transactions) or changes with certain writes excluded (also\r\n         * used by transactions).\r\n         *\r\n         * @type {!Array.<!WriteRecord>}\r\n         * @private\r\n         */\nthis.allWrites_=[];\nthis.lastWriteId_=-1;\n}\n/**\r\n     * Create a new WriteTreeRef for the given path. For use with a new sync point at the given path.\r\n     *\r\n     * @param {!Path} path\r\n     * @return {!WriteTreeRef}\r\n     */\nWriteTree.prototype.childWrites=function(path){\nreturn new WriteTreeRef(path,this);\n};\n/**\r\n     * Record a new overwrite from user code.\r\n     *\r\n     * @param {!Path} path\r\n     * @param {!Node} snap\r\n     * @param {!number} writeId\r\n     * @param {boolean=} visible This is set to false by some transactions. It should be excluded from event caches\r\n     */\nWriteTree.prototype.addOverwrite=function(path,snap,writeId,visible){\nutil.assert(writeId>this.lastWriteId_,'Stacking an older write on top of newer ones');\nif(visible===undefined){\nvisible=true;\n}\nthis.allWrites_.push({\npath:path,\nsnap:snap,\nwriteId:writeId,\nvisible:visible});\n\nif(visible){\nthis.visibleWrites_=this.visibleWrites_.addWrite(path,snap);\n}\nthis.lastWriteId_=writeId;\n};\n/**\r\n     * Record a new merge from user code.\r\n     *\r\n     * @param {!Path} path\r\n     * @param {!Object.<string, !Node>} changedChildren\r\n     * @param {!number} writeId\r\n     */\nWriteTree.prototype.addMerge=function(path,changedChildren,writeId){\nutil.assert(writeId>this.lastWriteId_,'Stacking an older merge on top of newer ones');\nthis.allWrites_.push({\npath:path,\nchildren:changedChildren,\nwriteId:writeId,\nvisible:true});\n\nthis.visibleWrites_=this.visibleWrites_.addWrites(path,changedChildren);\nthis.lastWriteId_=writeId;\n};\n/**\r\n     * @param {!number} writeId\r\n     * @return {?WriteRecord}\r\n     */\nWriteTree.prototype.getWrite=function(writeId){\nfor(var i=0;i<this.allWrites_.length;i++){\nvar record=this.allWrites_[i];\nif(record.writeId===writeId){\nreturn record;\n}\n}\nreturn null;\n};\n/**\r\n     * Remove a write (either an overwrite or merge) that has been successfully acknowledge by the server. Recalculates\r\n     * the tree if necessary.  We return true if it may have been visible, meaning views need to reevaluate.\r\n     *\r\n     * @param {!number} writeId\r\n     * @return {boolean} true if the write may have been visible (meaning we'll need to reevaluate / raise\r\n     * events as a result).\r\n     */\nWriteTree.prototype.removeWrite=function(writeId){\n// Note: disabling this check. It could be a transaction that preempted another transaction, and thus was applied\n// out of order.\n//const validClear = revert || this.allWrites_.length === 0 || writeId <= this.allWrites_[0].writeId;\n//assert(validClear, \"Either we don't have this write, or it's the first one in the queue\");\nvar _this=this;\nvar idx=this.allWrites_.findIndex(function(s){\nreturn s.writeId===writeId;\n});\nutil.assert(idx>=0,'removeWrite called with nonexistent writeId.');\nvar writeToRemove=this.allWrites_[idx];\nthis.allWrites_.splice(idx,1);\nvar removedWriteWasVisible=writeToRemove.visible;\nvar removedWriteOverlapsWithOtherWrites=false;\nvar i=this.allWrites_.length-1;\nwhile(removedWriteWasVisible&&i>=0){\nvar currentWrite=this.allWrites_[i];\nif(currentWrite.visible){\nif(i>=idx&&\nthis.recordContainsPath_(currentWrite,writeToRemove.path)){\n// The removed write was completely shadowed by a subsequent write.\nremovedWriteWasVisible=false;\n}else\nif(writeToRemove.path.contains(currentWrite.path)){\n// Either we're covering some writes or they're covering part of us (depending on which came first).\nremovedWriteOverlapsWithOtherWrites=true;\n}\n}\ni--;\n}\nif(!removedWriteWasVisible){\nreturn false;\n}else\nif(removedWriteOverlapsWithOtherWrites){\n// There's some shadowing going on. Just rebuild the visible writes from scratch.\nthis.resetTree_();\nreturn true;\n}else\n{\n// There's no shadowing.  We can safely just remove the write(s) from visibleWrites.\nif(writeToRemove.snap){\nthis.visibleWrites_=this.visibleWrites_.removeWrite(writeToRemove.path);\n}else\n{\nvar children=writeToRemove.children;\neach(children,function(childName){\n_this.visibleWrites_=_this.visibleWrites_.removeWrite(writeToRemove.path.child(childName));\n});\n}\nreturn true;\n}\n};\n/**\r\n     * Return a complete snapshot for the given path if there's visible write data at that path, else null.\r\n     * No server data is considered.\r\n     *\r\n     * @param {!Path} path\r\n     * @return {?Node}\r\n     */\nWriteTree.prototype.getCompleteWriteData=function(path){\nreturn this.visibleWrites_.getCompleteNode(path);\n};\n/**\r\n     * Given optional, underlying server data, and an optional set of constraints (exclude some sets, include hidden\r\n     * writes), attempt to calculate a complete snapshot for the given path\r\n     *\r\n     * @param {!Path} treePath\r\n     * @param {?Node} completeServerCache\r\n     * @param {Array.<number>=} writeIdsToExclude An optional set to be excluded\r\n     * @param {boolean=} includeHiddenWrites Defaults to false, whether or not to layer on writes with visible set to false\r\n     * @return {?Node}\r\n     */\nWriteTree.prototype.calcCompleteEventCache=function(treePath,completeServerCache,writeIdsToExclude,includeHiddenWrites){\nif(!writeIdsToExclude&&!includeHiddenWrites){\nvar shadowingNode=this.visibleWrites_.getCompleteNode(treePath);\nif(shadowingNode!=null){\nreturn shadowingNode;\n}else\n{\nvar subMerge=this.visibleWrites_.childCompoundWrite(treePath);\nif(subMerge.isEmpty()){\nreturn completeServerCache;\n}else\nif(completeServerCache==null&&\n!subMerge.hasCompleteWrite(Path.Empty)){\n// We wouldn't have a complete snapshot, since there's no underlying data and no complete shadow\nreturn null;\n}else\n{\nvar layeredCache=completeServerCache||ChildrenNode.EMPTY_NODE;\nreturn subMerge.apply(layeredCache);\n}\n}\n}else\n{\nvar merge=this.visibleWrites_.childCompoundWrite(treePath);\nif(!includeHiddenWrites&&merge.isEmpty()){\nreturn completeServerCache;\n}else\n{\n// If the server cache is null, and we don't have a complete cache, we need to return null\nif(!includeHiddenWrites&&\ncompleteServerCache==null&&\n!merge.hasCompleteWrite(Path.Empty)){\nreturn null;\n}else\n{\nvar filter=function filter(write){\nreturn(write.visible||includeHiddenWrites)&&(\n!writeIdsToExclude||\n!~writeIdsToExclude.indexOf(write.writeId))&&(\nwrite.path.contains(treePath)||treePath.contains(write.path));\n};\nvar mergeAtPath=WriteTree.layerTree_(this.allWrites_,filter,treePath);\nvar layeredCache=completeServerCache||ChildrenNode.EMPTY_NODE;\nreturn mergeAtPath.apply(layeredCache);\n}\n}\n}\n};\n/**\r\n     * With optional, underlying server data, attempt to return a children node of children that we have complete data for.\r\n     * Used when creating new views, to pre-fill their complete event children snapshot.\r\n     *\r\n     * @param {!Path} treePath\r\n     * @param {?ChildrenNode} completeServerChildren\r\n     * @return {!ChildrenNode}\r\n     */\nWriteTree.prototype.calcCompleteEventChildren=function(treePath,completeServerChildren){\nvar completeChildren=ChildrenNode.EMPTY_NODE;\nvar topLevelSet=this.visibleWrites_.getCompleteNode(treePath);\nif(topLevelSet){\nif(!topLevelSet.isLeafNode()){\n// we're shadowing everything. Return the children.\ntopLevelSet.forEachChild(PRIORITY_INDEX,function(childName,childSnap){\ncompleteChildren=completeChildren.updateImmediateChild(childName,childSnap);\n});\n}\nreturn completeChildren;\n}else\nif(completeServerChildren){\n// Layer any children we have on top of this\n// We know we don't have a top-level set, so just enumerate existing children\nvar merge_1=this.visibleWrites_.childCompoundWrite(treePath);\ncompleteServerChildren.forEachChild(PRIORITY_INDEX,function(childName,childNode){\nvar node=merge_1.\nchildCompoundWrite(new Path(childName)).\napply(childNode);\ncompleteChildren=completeChildren.updateImmediateChild(childName,node);\n});\n// Add any complete children we have from the set\nmerge_1.getCompleteChildren().forEach(function(namedNode){\ncompleteChildren=completeChildren.updateImmediateChild(namedNode.name,namedNode.node);\n});\nreturn completeChildren;\n}else\n{\n// We don't have anything to layer on top of. Layer on any children we have\n// Note that we can return an empty snap if we have a defined delete\nvar merge=this.visibleWrites_.childCompoundWrite(treePath);\nmerge.getCompleteChildren().forEach(function(namedNode){\ncompleteChildren=completeChildren.updateImmediateChild(namedNode.name,namedNode.node);\n});\nreturn completeChildren;\n}\n};\n/**\r\n     * Given that the underlying server data has updated, determine what, if anything, needs to be\r\n     * applied to the event cache.\r\n     *\r\n     * Possibilities:\r\n     *\r\n     * 1. No writes are shadowing. Events should be raised, the snap to be applied comes from the server data\r\n     *\r\n     * 2. Some write is completely shadowing. No events to be raised\r\n     *\r\n     * 3. Is partially shadowed. Events\r\n     *\r\n     * Either existingEventSnap or existingServerSnap must exist\r\n     *\r\n     * @param {!Path} treePath\r\n     * @param {!Path} childPath\r\n     * @param {?Node} existingEventSnap\r\n     * @param {?Node} existingServerSnap\r\n     * @return {?Node}\r\n     */\nWriteTree.prototype.calcEventCacheAfterServerOverwrite=function(treePath,childPath,existingEventSnap,existingServerSnap){\nutil.assert(existingEventSnap||existingServerSnap,'Either existingEventSnap or existingServerSnap must exist');\nvar path=treePath.child(childPath);\nif(this.visibleWrites_.hasCompleteWrite(path)){\n// At this point we can probably guarantee that we're in case 2, meaning no events\n// May need to check visibility while doing the findRootMostValueAndPath call\nreturn null;\n}else\n{\n// No complete shadowing. We're either partially shadowing or not shadowing at all.\nvar childMerge=this.visibleWrites_.childCompoundWrite(path);\nif(childMerge.isEmpty()){\n// We're not shadowing at all. Case 1\nreturn existingServerSnap.getChild(childPath);\n}else\n{\n// This could be more efficient if the serverNode + updates doesn't change the eventSnap\n// However this is tricky to find out, since user updates don't necessary change the server\n// snap, e.g. priority updates on empty nodes, or deep deletes. Another special case is if the server\n// adds nodes, but doesn't change any existing writes. It is therefore not enough to\n// only check if the updates change the serverNode.\n// Maybe check if the merge tree contains these special cases and only do a full overwrite in that case?\nreturn childMerge.apply(existingServerSnap.getChild(childPath));\n}\n}\n};\n/**\r\n     * Returns a complete child for a given server snap after applying all user writes or null if there is no\r\n     * complete child for this ChildKey.\r\n     *\r\n     * @param {!Path} treePath\r\n     * @param {!string} childKey\r\n     * @param {!CacheNode} existingServerSnap\r\n     * @return {?Node}\r\n     */\nWriteTree.prototype.calcCompleteChild=function(treePath,childKey,existingServerSnap){\nvar path=treePath.child(childKey);\nvar shadowingNode=this.visibleWrites_.getCompleteNode(path);\nif(shadowingNode!=null){\nreturn shadowingNode;\n}else\n{\nif(existingServerSnap.isCompleteForChild(childKey)){\nvar childMerge=this.visibleWrites_.childCompoundWrite(path);\nreturn childMerge.apply(existingServerSnap.getNode().getImmediateChild(childKey));\n}else\n{\nreturn null;\n}\n}\n};\n/**\r\n     * Returns a node if there is a complete overwrite for this path. More specifically, if there is a write at\r\n     * a higher path, this will return the child of that write relative to the write and this path.\r\n     * Returns null if there is no write at this path.\r\n     */\nWriteTree.prototype.shadowingWrite=function(path){\nreturn this.visibleWrites_.getCompleteNode(path);\n};\n/**\r\n     * This method is used when processing child remove events on a query. If we can, we pull in children that were outside\r\n     * the window, but may now be in the window.\r\n     */\nWriteTree.prototype.calcIndexedSlice=function(treePath,completeServerData,startPost,count,reverse,index){\nvar toIterate;\nvar merge=this.visibleWrites_.childCompoundWrite(treePath);\nvar shadowingNode=merge.getCompleteNode(Path.Empty);\nif(shadowingNode!=null){\ntoIterate=shadowingNode;\n}else\nif(completeServerData!=null){\ntoIterate=merge.apply(completeServerData);\n}else\n{\n// no children to iterate on\nreturn[];\n}\ntoIterate=toIterate.withIndex(index);\nif(!toIterate.isEmpty()&&!toIterate.isLeafNode()){\nvar nodes=[];\nvar cmp=index.getCompare();\nvar iter=reverse?\ntoIterate.getReverseIteratorFrom(startPost,index):\ntoIterate.getIteratorFrom(startPost,index);\nvar next=iter.getNext();\nwhile(next&&nodes.length<count){\nif(cmp(next,startPost)!==0){\nnodes.push(next);\n}\nnext=iter.getNext();\n}\nreturn nodes;\n}else\n{\nreturn[];\n}\n};\nWriteTree.prototype.recordContainsPath_=function(writeRecord,path){\nif(writeRecord.snap){\nreturn writeRecord.path.contains(path);\n}else\n{\nfor(var childName in writeRecord.children){\nif(writeRecord.children.hasOwnProperty(childName)&&\nwriteRecord.path.child(childName).contains(path)){\nreturn true;\n}\n}\nreturn false;\n}\n};\n/**\r\n     * Re-layer the writes and merges into a tree so we can efficiently calculate event snapshots\r\n     */\nWriteTree.prototype.resetTree_=function(){\nthis.visibleWrites_=WriteTree.layerTree_(this.allWrites_,WriteTree.DefaultFilter_,Path.Empty);\nif(this.allWrites_.length>0){\nthis.lastWriteId_=this.allWrites_[this.allWrites_.length-1].writeId;\n}else\n{\nthis.lastWriteId_=-1;\n}\n};\n/**\r\n     * The default filter used when constructing the tree. Keep everything that's visible.\r\n     */\nWriteTree.DefaultFilter_=function(write){\nreturn write.visible;\n};\n/**\r\n     * Static method. Given an array of WriteRecords, a filter for which ones to include, and a path, construct the tree of\r\n     * event data at that path.\r\n     */\nWriteTree.layerTree_=function(writes,filter,treeRoot){\nvar compoundWrite=CompoundWrite.Empty;\nfor(var i=0;i<writes.length;++i){\nvar write=writes[i];\n// Theory, a later set will either:\n// a) abort a relevant transaction, so no need to worry about excluding it from calculating that transaction\n// b) not be relevant to a transaction (separate branch), so again will not affect the data for that transaction\nif(filter(write)){\nvar writePath=write.path;\nvar relativePath=void 0;\nif(write.snap){\nif(treeRoot.contains(writePath)){\nrelativePath=Path.relativePath(treeRoot,writePath);\ncompoundWrite=compoundWrite.addWrite(relativePath,write.snap);\n}else\nif(writePath.contains(treeRoot)){\nrelativePath=Path.relativePath(writePath,treeRoot);\ncompoundWrite=compoundWrite.addWrite(Path.Empty,write.snap.getChild(relativePath));\n}else\n;\n}else\nif(write.children){\nif(treeRoot.contains(writePath)){\nrelativePath=Path.relativePath(treeRoot,writePath);\ncompoundWrite=compoundWrite.addWrites(relativePath,write.children);\n}else\nif(writePath.contains(treeRoot)){\nrelativePath=Path.relativePath(writePath,treeRoot);\nif(relativePath.isEmpty()){\ncompoundWrite=compoundWrite.addWrites(Path.Empty,write.children);\n}else\n{\nvar child=util.safeGet(write.children,relativePath.getFront());\nif(child){\n// There exists a child in this node that matches the root path\nvar deepNode=child.getChild(relativePath.popFront());\ncompoundWrite=compoundWrite.addWrite(Path.Empty,deepNode);\n}\n}\n}else\n;\n}else\n{\nthrow util.assertionError('WriteRecord should have .snap or .children');\n}\n}\n}\nreturn compoundWrite;\n};\nreturn WriteTree;\n}();\n/**\r\n * A WriteTreeRef wraps a WriteTree and a path, for convenient access to a particular subtree.  All of the methods\r\n * just proxy to the underlying WriteTree.\r\n *\r\n * @constructor\r\n */\nvar WriteTreeRef=/** @class */function(){\n/**\r\n     * @param {!Path} path\r\n     * @param {!WriteTree} writeTree\r\n     */\nfunction WriteTreeRef(path,writeTree){\nthis.treePath_=path;\nthis.writeTree_=writeTree;\n}\n/**\r\n     * If possible, returns a complete event cache, using the underlying server data if possible. In addition, can be used\r\n     * to get a cache that includes hidden writes, and excludes arbitrary writes. Note that customizing the returned node\r\n     * can lead to a more expensive calculation.\r\n     *\r\n     * @param {?Node} completeServerCache\r\n     * @param {Array.<number>=} writeIdsToExclude Optional writes to exclude.\r\n     * @param {boolean=} includeHiddenWrites Defaults to false, whether or not to layer on writes with visible set to false\r\n     * @return {?Node}\r\n     */\nWriteTreeRef.prototype.calcCompleteEventCache=function(completeServerCache,writeIdsToExclude,includeHiddenWrites){\nreturn this.writeTree_.calcCompleteEventCache(this.treePath_,completeServerCache,writeIdsToExclude,includeHiddenWrites);\n};\n/**\r\n     * If possible, returns a children node containing all of the complete children we have data for. The returned data is a\r\n     * mix of the given server data and write data.\r\n     *\r\n     * @param {?ChildrenNode} completeServerChildren\r\n     * @return {!ChildrenNode}\r\n     */\nWriteTreeRef.prototype.calcCompleteEventChildren=function(completeServerChildren){\nreturn this.writeTree_.calcCompleteEventChildren(this.treePath_,completeServerChildren);\n};\n/**\r\n     * Given that either the underlying server data has updated or the outstanding writes have updated, determine what,\r\n     * if anything, needs to be applied to the event cache.\r\n     *\r\n     * Possibilities:\r\n     *\r\n     * 1. No writes are shadowing. Events should be raised, the snap to be applied comes from the server data\r\n     *\r\n     * 2. Some write is completely shadowing. No events to be raised\r\n     *\r\n     * 3. Is partially shadowed. Events should be raised\r\n     *\r\n     * Either existingEventSnap or existingServerSnap must exist, this is validated via an assert\r\n     *\r\n     * @param {!Path} path\r\n     * @param {?Node} existingEventSnap\r\n     * @param {?Node} existingServerSnap\r\n     * @return {?Node}\r\n     */\nWriteTreeRef.prototype.calcEventCacheAfterServerOverwrite=function(path,existingEventSnap,existingServerSnap){\nreturn this.writeTree_.calcEventCacheAfterServerOverwrite(this.treePath_,path,existingEventSnap,existingServerSnap);\n};\n/**\r\n     * Returns a node if there is a complete overwrite for this path. More specifically, if there is a write at\r\n     * a higher path, this will return the child of that write relative to the write and this path.\r\n     * Returns null if there is no write at this path.\r\n     *\r\n     * @param {!Path} path\r\n     * @return {?Node}\r\n     */\nWriteTreeRef.prototype.shadowingWrite=function(path){\nreturn this.writeTree_.shadowingWrite(this.treePath_.child(path));\n};\n/**\r\n     * This method is used when processing child remove events on a query. If we can, we pull in children that were outside\r\n     * the window, but may now be in the window\r\n     *\r\n     * @param {?Node} completeServerData\r\n     * @param {!NamedNode} startPost\r\n     * @param {!number} count\r\n     * @param {boolean} reverse\r\n     * @param {!Index} index\r\n     * @return {!Array.<!NamedNode>}\r\n     */\nWriteTreeRef.prototype.calcIndexedSlice=function(completeServerData,startPost,count,reverse,index){\nreturn this.writeTree_.calcIndexedSlice(this.treePath_,completeServerData,startPost,count,reverse,index);\n};\n/**\r\n     * Returns a complete child for a given server snap after applying all user writes or null if there is no\r\n     * complete child for this ChildKey.\r\n     *\r\n     * @param {!string} childKey\r\n     * @param {!CacheNode} existingServerCache\r\n     * @return {?Node}\r\n     */\nWriteTreeRef.prototype.calcCompleteChild=function(childKey,existingServerCache){\nreturn this.writeTree_.calcCompleteChild(this.treePath_,childKey,existingServerCache);\n};\n/**\r\n     * Return a WriteTreeRef for a child.\r\n     *\r\n     * @param {string} childName\r\n     * @return {!WriteTreeRef}\r\n     */\nWriteTreeRef.prototype.child=function(childName){\nreturn new WriteTreeRef(this.treePath_.child(childName),this.writeTree_);\n};\nreturn WriteTreeRef;\n}();\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n/**\r\n * SyncTree is the central class for managing event callback registration, data caching, views\r\n * (query processing), and event generation.  There are typically two SyncTree instances for\r\n * each Repo, one for the normal Firebase data, and one for the .info data.\r\n *\r\n * It has a number of responsibilities, including:\r\n *  - Tracking all user event callbacks (registered via addEventRegistration() and removeEventRegistration()).\r\n *  - Applying and caching data changes for user set(), transaction(), and update() calls\r\n *    (applyUserOverwrite(), applyUserMerge()).\r\n *  - Applying and caching data changes for server data changes (applyServerOverwrite(),\r\n *    applyServerMerge()).\r\n *  - Generating user-facing events for server and user changes (all of the apply* methods\r\n *    return the set of events that need to be raised as a result).\r\n *  - Maintaining the appropriate set of server listens to ensure we are always subscribed\r\n *    to the correct set of paths and queries to satisfy the current set of user event\r\n *    callbacks (listens are started/stopped using the provided listenProvider).\r\n *\r\n * NOTE: Although SyncTree tracks event callbacks and calculates events to raise, the actual\r\n * events are returned to the caller rather than raised synchronously.\r\n *\r\n * @constructor\r\n */\nvar SyncTree=/** @class */function(){\n/**\r\n     * @param {!ListenProvider} listenProvider_ Used by SyncTree to start / stop listening\r\n     *   to server data.\r\n     */\nfunction SyncTree(listenProvider_){\nthis.listenProvider_=listenProvider_;\n/**\r\n         * Tree of SyncPoints.  There's a SyncPoint at any location that has 1 or more views.\r\n         */\nthis.syncPointTree_=ImmutableTree.Empty;\n/**\r\n         * A tree of all pending user writes (user-initiated set()'s, transaction()'s, update()'s, etc.).\r\n         */\nthis.pendingWriteTree_=new WriteTree();\nthis.tagToQueryMap=new Map();\nthis.queryToTagMap=new Map();\n}\n/**\r\n     * Apply the data changes for a user-generated set() or transaction() call.\r\n     *\r\n     * @return Events to raise.\r\n     */\nSyncTree.prototype.applyUserOverwrite=function(path,newData,writeId,visible){\n// Record pending write.\nthis.pendingWriteTree_.addOverwrite(path,newData,writeId,visible);\nif(!visible){\nreturn[];\n}else\n{\nreturn this.applyOperationToSyncPoints_(new Overwrite(OperationSource.User,path,newData));\n}\n};\n/**\r\n     * Apply the data from a user-generated update() call\r\n     *\r\n     * @return Events to raise.\r\n     */\nSyncTree.prototype.applyUserMerge=function(path,changedChildren,writeId){\n// Record pending merge.\nthis.pendingWriteTree_.addMerge(path,changedChildren,writeId);\nvar changeTree=ImmutableTree.fromObject(changedChildren);\nreturn this.applyOperationToSyncPoints_(new Merge(OperationSource.User,path,changeTree));\n};\n/**\r\n     * Acknowledge a pending user write that was previously registered with applyUserOverwrite() or applyUserMerge().\r\n     *\r\n     * @param revert True if the given write failed and needs to be reverted\r\n     * @return Events to raise.\r\n     */\nSyncTree.prototype.ackUserWrite=function(writeId,revert){\nif(revert===void 0){revert=false;}\nvar write=this.pendingWriteTree_.getWrite(writeId);\nvar needToReevaluate=this.pendingWriteTree_.removeWrite(writeId);\nif(!needToReevaluate){\nreturn[];\n}else\n{\nvar affectedTree_1=ImmutableTree.Empty;\nif(write.snap!=null){\n// overwrite\naffectedTree_1=affectedTree_1.set(Path.Empty,true);\n}else\n{\neach(write.children,function(pathString,node){\naffectedTree_1=affectedTree_1.set(new Path(pathString),node);\n});\n}\nreturn this.applyOperationToSyncPoints_(new AckUserWrite(write.path,affectedTree_1,revert));\n}\n};\n/**\r\n     * Apply new server data for the specified path..\r\n     *\r\n     * @return Events to raise.\r\n     */\nSyncTree.prototype.applyServerOverwrite=function(path,newData){\nreturn this.applyOperationToSyncPoints_(new Overwrite(OperationSource.Server,path,newData));\n};\n/**\r\n     * Apply new server data to be merged in at the specified path.\r\n     *\r\n     * @return Events to raise.\r\n     */\nSyncTree.prototype.applyServerMerge=function(path,changedChildren){\nvar changeTree=ImmutableTree.fromObject(changedChildren);\nreturn this.applyOperationToSyncPoints_(new Merge(OperationSource.Server,path,changeTree));\n};\n/**\r\n     * Apply a listen complete for a query\r\n     *\r\n     * @return Events to raise.\r\n     */\nSyncTree.prototype.applyListenComplete=function(path){\nreturn this.applyOperationToSyncPoints_(new ListenComplete(OperationSource.Server,path));\n};\n/**\r\n     * Apply new server data for the specified tagged query.\r\n     *\r\n     * @return Events to raise.\r\n     */\nSyncTree.prototype.applyTaggedQueryOverwrite=function(path,snap,tag){\nvar queryKey=this.queryKeyForTag_(tag);\nif(queryKey!=null){\nvar r=SyncTree.parseQueryKey_(queryKey);\nvar queryPath=r.path,queryId=r.queryId;\nvar relativePath=Path.relativePath(queryPath,path);\nvar op=new Overwrite(OperationSource.forServerTaggedQuery(queryId),relativePath,snap);\nreturn this.applyTaggedOperation_(queryPath,op);\n}else\n{\n// Query must have been removed already\nreturn[];\n}\n};\n/**\r\n     * Apply server data to be merged in for the specified tagged query.\r\n     *\r\n     * @return Events to raise.\r\n     */\nSyncTree.prototype.applyTaggedQueryMerge=function(path,changedChildren,tag){\nvar queryKey=this.queryKeyForTag_(tag);\nif(queryKey){\nvar r=SyncTree.parseQueryKey_(queryKey);\nvar queryPath=r.path,queryId=r.queryId;\nvar relativePath=Path.relativePath(queryPath,path);\nvar changeTree=ImmutableTree.fromObject(changedChildren);\nvar op=new Merge(OperationSource.forServerTaggedQuery(queryId),relativePath,changeTree);\nreturn this.applyTaggedOperation_(queryPath,op);\n}else\n{\n// We've already removed the query. No big deal, ignore the update\nreturn[];\n}\n};\n/**\r\n     * Apply a listen complete for a tagged query\r\n     *\r\n     * @return Events to raise.\r\n     */\nSyncTree.prototype.applyTaggedListenComplete=function(path,tag){\nvar queryKey=this.queryKeyForTag_(tag);\nif(queryKey){\nvar r=SyncTree.parseQueryKey_(queryKey);\nvar queryPath=r.path,queryId=r.queryId;\nvar relativePath=Path.relativePath(queryPath,path);\nvar op=new ListenComplete(OperationSource.forServerTaggedQuery(queryId),relativePath);\nreturn this.applyTaggedOperation_(queryPath,op);\n}else\n{\n// We've already removed the query. No big deal, ignore the update\nreturn[];\n}\n};\n/**\r\n     * Add an event callback for the specified query.\r\n     *\r\n     * @return Events to raise.\r\n     */\nSyncTree.prototype.addEventRegistration=function(query,eventRegistration){\nvar path=query.path;\nvar serverCache=null;\nvar foundAncestorDefaultView=false;\n// Any covering writes will necessarily be at the root, so really all we need to find is the server cache.\n// Consider optimizing this once there's a better understanding of what actual behavior will be.\nthis.syncPointTree_.foreachOnPath(path,function(pathToSyncPoint,sp){\nvar relativePath=Path.relativePath(pathToSyncPoint,path);\nserverCache=serverCache||sp.getCompleteServerCache(relativePath);\nfoundAncestorDefaultView=\nfoundAncestorDefaultView||sp.hasCompleteView();\n});\nvar syncPoint=this.syncPointTree_.get(path);\nif(!syncPoint){\nsyncPoint=new SyncPoint();\nthis.syncPointTree_=this.syncPointTree_.set(path,syncPoint);\n}else\n{\nfoundAncestorDefaultView=\nfoundAncestorDefaultView||syncPoint.hasCompleteView();\nserverCache=serverCache||syncPoint.getCompleteServerCache(Path.Empty);\n}\nvar serverCacheComplete;\nif(serverCache!=null){\nserverCacheComplete=true;\n}else\n{\nserverCacheComplete=false;\nserverCache=ChildrenNode.EMPTY_NODE;\nvar subtree=this.syncPointTree_.subtree(path);\nsubtree.foreachChild(function(childName,childSyncPoint){\nvar completeCache=childSyncPoint.getCompleteServerCache(Path.Empty);\nif(completeCache){\nserverCache=serverCache.updateImmediateChild(childName,completeCache);\n}\n});\n}\nvar viewAlreadyExists=syncPoint.viewExistsForQuery(query);\nif(!viewAlreadyExists&&!query.getQueryParams().loadsAllData()){\n// We need to track a tag for this query\nvar queryKey=SyncTree.makeQueryKey_(query);\nutil.assert(!this.queryToTagMap.has(queryKey),'View does not exist, but we have a tag');\nvar tag=SyncTree.getNextQueryTag_();\nthis.queryToTagMap.set(queryKey,tag);\nthis.tagToQueryMap.set(tag,queryKey);\n}\nvar writesCache=this.pendingWriteTree_.childWrites(path);\nvar events=syncPoint.addEventRegistration(query,eventRegistration,writesCache,serverCache,serverCacheComplete);\nif(!viewAlreadyExists&&!foundAncestorDefaultView){\nvar view/** @type !View */=syncPoint.viewForQuery(query);\nevents=events.concat(this.setupListener_(query,view));\n}\nreturn events;\n};\n/**\r\n     * Remove event callback(s).\r\n     *\r\n     * If query is the default query, we'll check all queries for the specified eventRegistration.\r\n     * If eventRegistration is null, we'll remove all callbacks for the specified query/queries.\r\n     *\r\n     * @param eventRegistration If null, all callbacks are removed.\r\n     * @param cancelError If a cancelError is provided, appropriate cancel events will be returned.\r\n     * @return Cancel events, if cancelError was provided.\r\n     */\nSyncTree.prototype.removeEventRegistration=function(query,eventRegistration,cancelError){\nvar _this=this;\n// Find the syncPoint first. Then deal with whether or not it has matching listeners\nvar path=query.path;\nvar maybeSyncPoint=this.syncPointTree_.get(path);\nvar cancelEvents=[];\n// A removal on a default query affects all queries at that location. A removal on an indexed query, even one without\n// other query constraints, does *not* affect all queries at that location. So this check must be for 'default', and\n// not loadsAllData().\nif(maybeSyncPoint&&(\nquery.queryIdentifier()==='default'||\nmaybeSyncPoint.viewExistsForQuery(query))){\n/**\r\n             * @type {{removed: !Array.<!Query>, events: !Array.<!Event>}}\r\n             */\nvar removedAndEvents=maybeSyncPoint.removeEventRegistration(query,eventRegistration,cancelError);\nif(maybeSyncPoint.isEmpty()){\nthis.syncPointTree_=this.syncPointTree_.remove(path);\n}\nvar removed=removedAndEvents.removed;\ncancelEvents=removedAndEvents.events;\n// We may have just removed one of many listeners and can short-circuit this whole process\n// We may also not have removed a default listener, in which case all of the descendant listeners should already be\n// properly set up.\n//\n// Since indexed queries can shadow if they don't have other query constraints, check for loadsAllData(), instead of\n// queryId === 'default'\nvar removingDefault=-1!==\nremoved.findIndex(function(query){\nreturn query.getQueryParams().loadsAllData();\n});\nvar covered=this.syncPointTree_.findOnPath(path,function(relativePath,parentSyncPoint){\nreturn parentSyncPoint.hasCompleteView();\n});\nif(removingDefault&&!covered){\nvar subtree=this.syncPointTree_.subtree(path);\n// There are potentially child listeners. Determine what if any listens we need to send before executing the\n// removal\nif(!subtree.isEmpty()){\n// We need to fold over our subtree and collect the listeners to send\nvar newViews=this.collectDistinctViewsForSubTree_(subtree);\n// Ok, we've collected all the listens we need. Set them up.\nfor(var i=0;i<newViews.length;++i){\nvar view=newViews[i],newQuery=view.getQuery();\nvar listener=this.createListenerForView_(view);\nthis.listenProvider_.startListening(SyncTree.queryForListening_(newQuery),this.tagForQuery_(newQuery),listener.hashFn,listener.onComplete);\n}\n}\n}\n// If we removed anything and we're not covered by a higher up listen, we need to stop listening on this query\n// The above block has us covered in terms of making sure we're set up on listens lower in the tree.\n// Also, note that if we have a cancelError, it's already been removed at the provider level.\nif(!covered&&removed.length>0&&!cancelError){\n// If we removed a default, then we weren't listening on any of the other queries here. Just cancel the one\n// default. Otherwise, we need to iterate through and cancel each individual query\nif(removingDefault){\n// We don't tag default listeners\nvar defaultTag=null;\nthis.listenProvider_.stopListening(SyncTree.queryForListening_(query),defaultTag);\n}else\n{\nremoved.forEach(function(queryToRemove){\nvar tagToRemove=_this.queryToTagMap.get(SyncTree.makeQueryKey_(queryToRemove));\n_this.listenProvider_.stopListening(SyncTree.queryForListening_(queryToRemove),tagToRemove);\n});\n}\n}\n// Now, clear all of the tags we're tracking for the removed listens\nthis.removeTags_(removed);\n}\nreturn cancelEvents;\n};\n/**\r\n     * Returns a complete cache, if we have one, of the data at a particular path. If the location does not have a\r\n     * listener above it, we will get a false \"null\". This shouldn't be a problem because transactions will always\r\n     * have a listener above, and atomic operations would correctly show a jitter of <increment value> ->\r\n     *     <incremented total> as the write is applied locally and then acknowledged at the server.\r\n     *\r\n     * Note: this method will *include* hidden writes from transaction with applyLocally set to false.\r\n     *\r\n     * @param path The path to the data we want\r\n     * @param writeIdsToExclude A specific set to be excluded\r\n     */\nSyncTree.prototype.calcCompleteEventCache=function(path,writeIdsToExclude){\nvar includeHiddenSets=true;\nvar writeTree=this.pendingWriteTree_;\nvar serverCache=this.syncPointTree_.findOnPath(path,function(pathSoFar,syncPoint){\nvar relativePath=Path.relativePath(pathSoFar,path);\nvar serverCache=syncPoint.getCompleteServerCache(relativePath);\nif(serverCache){\nreturn serverCache;\n}\n});\nreturn writeTree.calcCompleteEventCache(path,serverCache,writeIdsToExclude,includeHiddenSets);\n};\n/**\r\n     * This collapses multiple unfiltered views into a single view, since we only need a single\r\n     * listener for them.\r\n     */\nSyncTree.prototype.collectDistinctViewsForSubTree_=function(subtree){\nreturn subtree.fold(function(relativePath,maybeChildSyncPoint,childMap){\nif(maybeChildSyncPoint&&maybeChildSyncPoint.hasCompleteView()){\nvar completeView=maybeChildSyncPoint.getCompleteView();\nreturn[completeView];\n}else\n{\n// No complete view here, flatten any deeper listens into an array\nvar views_1=[];\nif(maybeChildSyncPoint){\nviews_1=maybeChildSyncPoint.getQueryViews();\n}\neach(childMap,function(_key,childViews){\nviews_1=views_1.concat(childViews);\n});\nreturn views_1;\n}\n});\n};\nSyncTree.prototype.removeTags_=function(queries){\nfor(var j=0;j<queries.length;++j){\nvar removedQuery=queries[j];\nif(!removedQuery.getQueryParams().loadsAllData()){\n// We should have a tag for this\nvar removedQueryKey=SyncTree.makeQueryKey_(removedQuery);\nvar removedQueryTag=this.queryToTagMap.get(removedQueryKey);\nthis.queryToTagMap.delete(removedQueryKey);\nthis.tagToQueryMap.delete(removedQueryTag);\n}\n}\n};\n/**\r\n     * Normalizes a query to a query we send the server for listening\r\n     *\r\n     * @return The normalized query\r\n     */\nSyncTree.queryForListening_=function(query){\nif(query.getQueryParams().loadsAllData()&&\n!query.getQueryParams().isDefault()){\n// We treat queries that load all data as default queries\n// Cast is necessary because ref() technically returns Firebase which is actually fb.api.Firebase which inherits\n// from Query\nreturn query.getRef();\n}else\n{\nreturn query;\n}\n};\n/**\r\n     * For a given new listen, manage the de-duplication of outstanding subscriptions.\r\n     *\r\n     * @return This method can return events to support synchronous data sources\r\n     */\nSyncTree.prototype.setupListener_=function(query,view){\nvar path=query.path;\nvar tag=this.tagForQuery_(query);\nvar listener=this.createListenerForView_(view);\nvar events=this.listenProvider_.startListening(SyncTree.queryForListening_(query),tag,listener.hashFn,listener.onComplete);\nvar subtree=this.syncPointTree_.subtree(path);\n// The root of this subtree has our query. We're here because we definitely need to send a listen for that, but we\n// may need to shadow other listens as well.\nif(tag){\nutil.assert(!subtree.value.hasCompleteView(),\"If we're adding a query, it shouldn't be shadowed\");\n}else\n{\n// Shadow everything at or below this location, this is a default listener.\nvar queriesToStop=subtree.fold(function(relativePath,maybeChildSyncPoint,childMap){\nif(!relativePath.isEmpty()&&\nmaybeChildSyncPoint&&\nmaybeChildSyncPoint.hasCompleteView()){\nreturn[maybeChildSyncPoint.getCompleteView().getQuery()];\n}else\n{\n// No default listener here, flatten any deeper queries into an array\nvar queries_1=[];\nif(maybeChildSyncPoint){\nqueries_1=queries_1.concat(maybeChildSyncPoint.getQueryViews().map(function(view){return view.getQuery();}));\n}\neach(childMap,function(_key,childQueries){\nqueries_1=queries_1.concat(childQueries);\n});\nreturn queries_1;\n}\n});\nfor(var i=0;i<queriesToStop.length;++i){\nvar queryToStop=queriesToStop[i];\nthis.listenProvider_.stopListening(SyncTree.queryForListening_(queryToStop),this.tagForQuery_(queryToStop));\n}\n}\nreturn events;\n};\nSyncTree.prototype.createListenerForView_=function(view){\nvar _this=this;\nvar query=view.getQuery();\nvar tag=this.tagForQuery_(query);\nreturn{\nhashFn:function hashFn(){\nvar cache=view.getServerCache()||ChildrenNode.EMPTY_NODE;\nreturn cache.hash();\n},\nonComplete:function onComplete(status){\nif(status==='ok'){\nif(tag){\nreturn _this.applyTaggedListenComplete(query.path,tag);\n}else\n{\nreturn _this.applyListenComplete(query.path);\n}\n}else\n{\n// If a listen failed, kill all of the listeners here, not just the one that triggered the error.\n// Note that this may need to be scoped to just this listener if we change permissions on filtered children\nvar error=errorForServerCode(status,query);\nreturn _this.removeEventRegistration(query,\n/*eventRegistration*/null,error);\n}\n}};\n\n};\n/**\r\n     * Given a query, computes a \"queryKey\" suitable for use in our queryToTagMap_.\r\n     */\nSyncTree.makeQueryKey_=function(query){\nreturn query.path.toString()+'$'+query.queryIdentifier();\n};\n/**\r\n     * Given a queryKey (created by makeQueryKey), parse it back into a path and queryId.\r\n     */\nSyncTree.parseQueryKey_=function(queryKey){\nvar splitIndex=queryKey.indexOf('$');\nutil.assert(splitIndex!==-1&&splitIndex<queryKey.length-1,'Bad queryKey.');\nreturn{\nqueryId:queryKey.substr(splitIndex+1),\npath:new Path(queryKey.substr(0,splitIndex))};\n\n};\n/**\r\n     * Return the query associated with the given tag, if we have one\r\n     */\nSyncTree.prototype.queryKeyForTag_=function(tag){\nreturn this.tagToQueryMap.get(tag);\n};\n/**\r\n     * Return the tag associated with the given query.\r\n     */\nSyncTree.prototype.tagForQuery_=function(query){\nvar queryKey=SyncTree.makeQueryKey_(query);\nreturn this.queryToTagMap.get(queryKey);\n};\n/**\r\n     * Static accessor for query tags.\r\n     */\nSyncTree.getNextQueryTag_=function(){\nreturn SyncTree.nextQueryTag_++;\n};\n/**\r\n     * A helper method to apply tagged operations\r\n     */\nSyncTree.prototype.applyTaggedOperation_=function(queryPath,operation){\nvar syncPoint=this.syncPointTree_.get(queryPath);\nutil.assert(syncPoint,\"Missing sync point for query tag that we're tracking\");\nvar writesCache=this.pendingWriteTree_.childWrites(queryPath);\nreturn syncPoint.applyOperation(operation,writesCache,\n/*serverCache=*/null);\n};\n/**\r\n     * A helper method that visits all descendant and ancestor SyncPoints, applying the operation.\r\n     *\r\n     * NOTES:\r\n     * - Descendant SyncPoints will be visited first (since we raise events depth-first).\r\n     *\r\n     * - We call applyOperation() on each SyncPoint passing three things:\r\n     *   1. A version of the Operation that has been made relative to the SyncPoint location.\r\n     *   2. A WriteTreeRef of any writes we have cached at the SyncPoint location.\r\n     *   3. A snapshot Node with cached server data, if we have it.\r\n     *\r\n     * - We concatenate all of the events returned by each SyncPoint and return the result.\r\n     */\nSyncTree.prototype.applyOperationToSyncPoints_=function(operation){\nreturn this.applyOperationHelper_(operation,this.syncPointTree_,\n/*serverCache=*/null,this.pendingWriteTree_.childWrites(Path.Empty));\n};\n/**\r\n     * Recursive helper for applyOperationToSyncPoints_\r\n     */\nSyncTree.prototype.applyOperationHelper_=function(operation,syncPointTree,serverCache,writesCache){\nif(operation.path.isEmpty()){\nreturn this.applyOperationDescendantsHelper_(operation,syncPointTree,serverCache,writesCache);\n}else\n{\nvar syncPoint=syncPointTree.get(Path.Empty);\n// If we don't have cached server data, see if we can get it from this SyncPoint.\nif(serverCache==null&&syncPoint!=null){\nserverCache=syncPoint.getCompleteServerCache(Path.Empty);\n}\nvar events=[];\nvar childName=operation.path.getFront();\nvar childOperation=operation.operationForChild(childName);\nvar childTree=syncPointTree.children.get(childName);\nif(childTree&&childOperation){\nvar childServerCache=serverCache?\nserverCache.getImmediateChild(childName):\nnull;\nvar childWritesCache=writesCache.child(childName);\nevents=events.concat(this.applyOperationHelper_(childOperation,childTree,childServerCache,childWritesCache));\n}\nif(syncPoint){\nevents=events.concat(syncPoint.applyOperation(operation,writesCache,serverCache));\n}\nreturn events;\n}\n};\n/**\r\n     * Recursive helper for applyOperationToSyncPoints_\r\n     */\nSyncTree.prototype.applyOperationDescendantsHelper_=function(operation,syncPointTree,serverCache,writesCache){\nvar _this=this;\nvar syncPoint=syncPointTree.get(Path.Empty);\n// If we don't have cached server data, see if we can get it from this SyncPoint.\nif(serverCache==null&&syncPoint!=null){\nserverCache=syncPoint.getCompleteServerCache(Path.Empty);\n}\nvar events=[];\nsyncPointTree.children.inorderTraversal(function(childName,childTree){\nvar childServerCache=serverCache?\nserverCache.getImmediateChild(childName):\nnull;\nvar childWritesCache=writesCache.child(childName);\nvar childOperation=operation.operationForChild(childName);\nif(childOperation){\nevents=events.concat(_this.applyOperationDescendantsHelper_(childOperation,childTree,childServerCache,childWritesCache));\n}\n});\nif(syncPoint){\nevents=events.concat(syncPoint.applyOperation(operation,writesCache,serverCache));\n}\nreturn events;\n};\n/**\r\n     * Static tracker for next query tag.\r\n     */\nSyncTree.nextQueryTag_=1;\nreturn SyncTree;\n}();\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n/**\r\n * Mutable object which basically just stores a reference to the \"latest\" immutable snapshot.\r\n *\r\n * @constructor\r\n */\nvar SnapshotHolder=/** @class */function(){\nfunction SnapshotHolder(){\nthis.rootNode_=ChildrenNode.EMPTY_NODE;\n}\nSnapshotHolder.prototype.getNode=function(path){\nreturn this.rootNode_.getChild(path);\n};\nSnapshotHolder.prototype.updateSnapshot=function(path,newSnapshotNode){\nthis.rootNode_=this.rootNode_.updateChild(path,newSnapshotNode);\n};\nreturn SnapshotHolder;\n}();\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n/**\r\n * Tracks a collection of stats.\r\n *\r\n * @constructor\r\n */\nvar StatsCollection=/** @class */function(){\nfunction StatsCollection(){\nthis.counters_={};\n}\nStatsCollection.prototype.incrementCounter=function(name,amount){\nif(amount===void 0){amount=1;}\nif(!util.contains(this.counters_,name)){\nthis.counters_[name]=0;\n}\nthis.counters_[name]+=amount;\n};\nStatsCollection.prototype.get=function(){\nreturn util.deepCopy(this.counters_);\n};\nreturn StatsCollection;\n}();\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\nvar StatsManager=/** @class */function(){\nfunction StatsManager(){\n}\nStatsManager.getCollection=function(repoInfo){\nvar hashString=repoInfo.toString();\nif(!this.collections_[hashString]){\nthis.collections_[hashString]=new StatsCollection();\n}\nreturn this.collections_[hashString];\n};\nStatsManager.getOrCreateReporter=function(repoInfo,creatorFunction){\nvar hashString=repoInfo.toString();\nif(!this.reporters_[hashString]){\nthis.reporters_[hashString]=creatorFunction();\n}\nreturn this.reporters_[hashString];\n};\nStatsManager.collections_={};\nStatsManager.reporters_={};\nreturn StatsManager;\n}();\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n/**\r\n * Returns the delta from the previous call to get stats.\r\n *\r\n * @param collection_ The collection to \"listen\" to.\r\n * @constructor\r\n */\nvar StatsListener=/** @class */function(){\nfunction StatsListener(collection_){\nthis.collection_=collection_;\nthis.last_=null;\n}\nStatsListener.prototype.get=function(){\nvar newStats=this.collection_.get();\nvar delta=tslib.__assign({},newStats);\nif(this.last_){\neach(this.last_,function(stat,value){\ndelta[stat]=delta[stat]-value;\n});\n}\nthis.last_=newStats;\nreturn delta;\n};\nreturn StatsListener;\n}();\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n// Assuming some apps may have a short amount of time on page, and a bulk of firebase operations probably\n// happen on page load, we try to report our first set of stats pretty quickly, but we wait at least 10\n// seconds to try to ensure the Firebase connection is established / settled.\nvar FIRST_STATS_MIN_TIME=10*1000;\nvar FIRST_STATS_MAX_TIME=30*1000;\n// We'll continue to report stats on average every 5 minutes.\nvar REPORT_STATS_INTERVAL=5*60*1000;\n/**\r\n * @constructor\r\n */\nvar StatsReporter=/** @class */function(){\n/**\r\n     * @param collection\r\n     * @param server_\r\n     */\nfunction StatsReporter(collection,server_){\nthis.server_=server_;\nthis.statsToReport_={};\nthis.statsListener_=new StatsListener(collection);\nvar timeout=FIRST_STATS_MIN_TIME+\n(FIRST_STATS_MAX_TIME-FIRST_STATS_MIN_TIME)*Math.random();\nsetTimeoutNonBlocking(this.reportStats_.bind(this),Math.floor(timeout));\n}\nStatsReporter.prototype.includeStat=function(stat){\nthis.statsToReport_[stat]=true;\n};\nStatsReporter.prototype.reportStats_=function(){\nvar _this=this;\nvar stats=this.statsListener_.get();\nvar reportedStats={};\nvar haveStatsToReport=false;\neach(stats,function(stat,value){\nif(value>0&&util.contains(_this.statsToReport_,stat)){\nreportedStats[stat]=value;\nhaveStatsToReport=true;\n}\n});\nif(haveStatsToReport){\nthis.server_.reportStats(reportedStats);\n}\n// queue our next run.\nsetTimeoutNonBlocking(this.reportStats_.bind(this),Math.floor(Math.random()*2*REPORT_STATS_INTERVAL));\n};\nreturn StatsReporter;\n}();\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n/**\r\n * The event queue serves a few purposes:\r\n * 1. It ensures we maintain event order in the face of event callbacks doing operations that result in more\r\n *    events being queued.\r\n * 2. raiseQueuedEvents() handles being called reentrantly nicely.  That is, if in the course of raising events,\r\n *    raiseQueuedEvents() is called again, the \"inner\" call will pick up raising events where the \"outer\" call\r\n *    left off, ensuring that the events are still raised synchronously and in order.\r\n * 3. You can use raiseEventsAtPath and raiseEventsForChangedPath to ensure only relevant previously-queued\r\n *    events are raised synchronously.\r\n *\r\n * NOTE: This can all go away if/when we move to async events.\r\n *\r\n * @constructor\r\n */\nvar EventQueue=/** @class */function(){\nfunction EventQueue(){\n/**\r\n         * @private\r\n         * @type {!Array.<EventList>}\r\n         */\nthis.eventLists_=[];\n/**\r\n         * Tracks recursion depth of raiseQueuedEvents_, for debugging purposes.\r\n         * @private\r\n         * @type {!number}\r\n         */\nthis.recursionDepth_=0;\n}\n/**\r\n     * @param {!Array.<Event>} eventDataList The new events to queue.\r\n     */\nEventQueue.prototype.queueEvents=function(eventDataList){\n// We group events by path, storing them in a single EventList, to make it easier to skip over them quickly.\nvar currList=null;\nfor(var i=0;i<eventDataList.length;i++){\nvar eventData=eventDataList[i];\nvar eventPath=eventData.getPath();\nif(currList!==null&&!eventPath.equals(currList.getPath())){\nthis.eventLists_.push(currList);\ncurrList=null;\n}\nif(currList===null){\ncurrList=new EventList(eventPath);\n}\ncurrList.add(eventData);\n}\nif(currList){\nthis.eventLists_.push(currList);\n}\n};\n/**\r\n     * Queues the specified events and synchronously raises all events (including previously queued ones)\r\n     * for the specified path.\r\n     *\r\n     * It is assumed that the new events are all for the specified path.\r\n     *\r\n     * @param {!Path} path The path to raise events for.\r\n     * @param {!Array.<Event>} eventDataList The new events to raise.\r\n     */\nEventQueue.prototype.raiseEventsAtPath=function(path,eventDataList){\nthis.queueEvents(eventDataList);\nthis.raiseQueuedEventsMatchingPredicate_(function(eventPath){\nreturn eventPath.equals(path);\n});\n};\n/**\r\n     * Queues the specified events and synchronously raises all events (including previously queued ones) for\r\n     * locations related to the specified change path (i.e. all ancestors and descendants).\r\n     *\r\n     * It is assumed that the new events are all related (ancestor or descendant) to the specified path.\r\n     *\r\n     * @param {!Path} changedPath The path to raise events for.\r\n     * @param {!Array.<!Event>} eventDataList The events to raise\r\n     */\nEventQueue.prototype.raiseEventsForChangedPath=function(changedPath,eventDataList){\nthis.queueEvents(eventDataList);\nthis.raiseQueuedEventsMatchingPredicate_(function(eventPath){\nreturn eventPath.contains(changedPath)||changedPath.contains(eventPath);\n});\n};\n/**\r\n     * @param {!function(!Path):boolean} predicate\r\n     * @private\r\n     */\nEventQueue.prototype.raiseQueuedEventsMatchingPredicate_=function(predicate){\nthis.recursionDepth_++;\nvar sentAll=true;\nfor(var i=0;i<this.eventLists_.length;i++){\nvar eventList=this.eventLists_[i];\nif(eventList){\nvar eventPath=eventList.getPath();\nif(predicate(eventPath)){\nthis.eventLists_[i].raise();\nthis.eventLists_[i]=null;\n}else\n{\nsentAll=false;\n}\n}\n}\nif(sentAll){\nthis.eventLists_=[];\n}\nthis.recursionDepth_--;\n};\nreturn EventQueue;\n}();\n/**\r\n * @param {!Path} path\r\n * @constructor\r\n */\nvar EventList=/** @class */function(){\nfunction EventList(path_){\nthis.path_=path_;\n/**\r\n         * @type {!Array.<Event>}\r\n         * @private\r\n         */\nthis.events_=[];\n}\n/**\r\n     * @param {!Event} eventData\r\n     */\nEventList.prototype.add=function(eventData){\nthis.events_.push(eventData);\n};\n/**\r\n     * Iterates through the list and raises each event\r\n     */\nEventList.prototype.raise=function(){\nfor(var i=0;i<this.events_.length;i++){\nvar eventData=this.events_[i];\nif(eventData!==null){\nthis.events_[i]=null;\nvar eventFn=eventData.getEventRunner();\nif(logger){\nlog('event: '+eventData.toString());\n}\nexceptionGuard(eventFn);\n}\n}\n};\n/**\r\n     * @return {!Path}\r\n     */\nEventList.prototype.getPath=function(){\nreturn this.path_;\n};\nreturn EventList;\n}();\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n/**\r\n * Base class to be used if you want to emit events. Call the constructor with\r\n * the set of allowed event names.\r\n */\nvar EventEmitter=/** @class */function(){\n/**\r\n     * @param {!Array.<string>} allowedEvents_\r\n     */\nfunction EventEmitter(allowedEvents_){\nthis.allowedEvents_=allowedEvents_;\nthis.listeners_={};\nutil.assert(Array.isArray(allowedEvents_)&&allowedEvents_.length>0,'Requires a non-empty array');\n}\n/**\r\n     * To be called by derived classes to trigger events.\r\n     * @param {!string} eventType\r\n     * @param {...*} varArgs\r\n     */\nEventEmitter.prototype.trigger=function(eventType){\nvar varArgs=[];\nfor(var _i=1;_i<arguments.length;_i++){\nvarArgs[_i-1]=arguments[_i];\n}\nif(Array.isArray(this.listeners_[eventType])){\n// Clone the list, since callbacks could add/remove listeners.\nvar listeners=tslib.__spread(this.listeners_[eventType]);\nfor(var i=0;i<listeners.length;i++){\nlisteners[i].callback.apply(listeners[i].context,varArgs);\n}\n}\n};\nEventEmitter.prototype.on=function(eventType,callback,context){\nthis.validateEventType_(eventType);\nthis.listeners_[eventType]=this.listeners_[eventType]||[];\nthis.listeners_[eventType].push({callback:callback,context:context});\nvar eventData=this.getInitialEvent(eventType);\nif(eventData){\ncallback.apply(context,eventData);\n}\n};\nEventEmitter.prototype.off=function(eventType,callback,context){\nthis.validateEventType_(eventType);\nvar listeners=this.listeners_[eventType]||[];\nfor(var i=0;i<listeners.length;i++){\nif(listeners[i].callback===callback&&(\n!context||context===listeners[i].context)){\nlisteners.splice(i,1);\nreturn;\n}\n}\n};\nEventEmitter.prototype.validateEventType_=function(eventType){\nutil.assert(this.allowedEvents_.find(function(et){\nreturn et===eventType;\n}),'Unknown event: '+eventType);\n};\nreturn EventEmitter;\n}();\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n/**\r\n * @extends {EventEmitter}\r\n */\nvar VisibilityMonitor=/** @class */function(_super){\ntslib.__extends(VisibilityMonitor,_super);\nfunction VisibilityMonitor(){\nvar _this=_super.call(this,['visible'])||this;\nvar hidden;\nvar visibilityChange;\nif(typeof document!=='undefined'&&\ntypeof document.addEventListener!=='undefined'){\nif(typeof document['hidden']!=='undefined'){\n// Opera 12.10 and Firefox 18 and later support\nvisibilityChange='visibilitychange';\nhidden='hidden';\n}else\nif(typeof document['mozHidden']!=='undefined'){\nvisibilityChange='mozvisibilitychange';\nhidden='mozHidden';\n}else\nif(typeof document['msHidden']!=='undefined'){\nvisibilityChange='msvisibilitychange';\nhidden='msHidden';\n}else\nif(typeof document['webkitHidden']!=='undefined'){\nvisibilityChange='webkitvisibilitychange';\nhidden='webkitHidden';\n}\n}\n// Initially, we always assume we are visible. This ensures that in browsers\n// without page visibility support or in cases where we are never visible\n// (e.g. chrome extension), we act as if we are visible, i.e. don't delay\n// reconnects\n_this.visible_=true;\nif(visibilityChange){\ndocument.addEventListener(visibilityChange,function(){\nvar visible=!document[hidden];\nif(visible!==_this.visible_){\n_this.visible_=visible;\n_this.trigger('visible',visible);\n}\n},false);\n}\nreturn _this;\n}\nVisibilityMonitor.getInstance=function(){\nreturn new VisibilityMonitor();\n};\n/**\r\n     * @param {!string} eventType\r\n     * @return {Array.<boolean>}\r\n     */\nVisibilityMonitor.prototype.getInitialEvent=function(eventType){\nutil.assert(eventType==='visible','Unknown event type: '+eventType);\nreturn[this.visible_];\n};\nreturn VisibilityMonitor;\n}(EventEmitter);\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n/**\r\n * Monitors online state (as reported by window.online/offline events).\r\n *\r\n * The expectation is that this could have many false positives (thinks we are online\r\n * when we're not), but no false negatives.  So we can safely use it to determine when\r\n * we definitely cannot reach the internet.\r\n *\r\n * @extends {EventEmitter}\r\n */\nvar OnlineMonitor=/** @class */function(_super){\ntslib.__extends(OnlineMonitor,_super);\nfunction OnlineMonitor(){\nvar _this=_super.call(this,['online'])||this;\n_this.online_=true;\n// We've had repeated complaints that Cordova apps can get stuck \"offline\", e.g.\n// https://forum.ionicframework.com/t/firebase-connection-is-lost-and-never-come-back/43810\n// It would seem that the 'online' event does not always fire consistently. So we disable it\n// for Cordova.\nif(typeof window!=='undefined'&&\ntypeof window.addEventListener!=='undefined'&&\n!util.isMobileCordova()){\nwindow.addEventListener('online',function(){\nif(!_this.online_){\n_this.online_=true;\n_this.trigger('online',true);\n}\n},false);\nwindow.addEventListener('offline',function(){\nif(_this.online_){\n_this.online_=false;\n_this.trigger('online',false);\n}\n},false);\n}\nreturn _this;\n}\nOnlineMonitor.getInstance=function(){\nreturn new OnlineMonitor();\n};\n/**\r\n     * @param {!string} eventType\r\n     * @return {Array.<boolean>}\r\n     */\nOnlineMonitor.prototype.getInitialEvent=function(eventType){\nutil.assert(eventType==='online','Unknown event type: '+eventType);\nreturn[this.online_];\n};\n/**\r\n     * @return {boolean}\r\n     */\nOnlineMonitor.prototype.currentlyOnline=function(){\nreturn this.online_;\n};\nreturn OnlineMonitor;\n}(EventEmitter);\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n/**\r\n * This class ensures the packets from the server arrive in order\r\n * This class takes data from the server and ensures it gets passed into the callbacks in order.\r\n * @constructor\r\n */\nvar PacketReceiver=/** @class */function(){\n/**\r\n     * @param onMessage_\r\n     */\nfunction PacketReceiver(onMessage_){\nthis.onMessage_=onMessage_;\nthis.pendingResponses=[];\nthis.currentResponseNum=0;\nthis.closeAfterResponse=-1;\nthis.onClose=null;\n}\nPacketReceiver.prototype.closeAfter=function(responseNum,callback){\nthis.closeAfterResponse=responseNum;\nthis.onClose=callback;\nif(this.closeAfterResponse<this.currentResponseNum){\nthis.onClose();\nthis.onClose=null;\n}\n};\n/**\r\n     * Each message from the server comes with a response number, and an array of data. The responseNumber\r\n     * allows us to ensure that we process them in the right order, since we can't be guaranteed that all\r\n     * browsers will respond in the same order as the requests we sent\r\n     * @param {number} requestNum\r\n     * @param {Array} data\r\n     */\nPacketReceiver.prototype.handleResponse=function(requestNum,data){\nvar _this=this;\nthis.pendingResponses[requestNum]=data;\nvar _loop_1=function _loop_1(){\nvar toProcess=this_1.pendingResponses[this_1.currentResponseNum];\ndelete this_1.pendingResponses[this_1.currentResponseNum];\nvar _loop_2=function _loop_2(i){\nif(toProcess[i]){\nexceptionGuard(function(){\n_this.onMessage_(toProcess[i]);\n});\n}\n};\nfor(var i=0;i<toProcess.length;++i){\n_loop_2(i);\n}\nif(this_1.currentResponseNum===this_1.closeAfterResponse){\nif(this_1.onClose){\nthis_1.onClose();\nthis_1.onClose=null;\n}\nreturn\"break\";\n}\nthis_1.currentResponseNum++;\n};\nvar this_1=this;\nwhile(this.pendingResponses[this.currentResponseNum]){\nvar state_1=_loop_1();\nif(state_1===\"break\")\nbreak;\n}\n};\nreturn PacketReceiver;\n}();\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n// URL query parameters associated with longpolling\nvar FIREBASE_LONGPOLL_START_PARAM='start';\nvar FIREBASE_LONGPOLL_CLOSE_COMMAND='close';\nvar FIREBASE_LONGPOLL_COMMAND_CB_NAME='pLPCommand';\nvar FIREBASE_LONGPOLL_DATA_CB_NAME='pRTLPCB';\nvar FIREBASE_LONGPOLL_ID_PARAM='id';\nvar FIREBASE_LONGPOLL_PW_PARAM='pw';\nvar FIREBASE_LONGPOLL_SERIAL_PARAM='ser';\nvar FIREBASE_LONGPOLL_CALLBACK_ID_PARAM='cb';\nvar FIREBASE_LONGPOLL_SEGMENT_NUM_PARAM='seg';\nvar FIREBASE_LONGPOLL_SEGMENTS_IN_PACKET='ts';\nvar FIREBASE_LONGPOLL_DATA_PARAM='d';\nvar FIREBASE_LONGPOLL_DISCONN_FRAME_REQUEST_PARAM='dframe';\n//Data size constants.\n//TODO: Perf: the maximum length actually differs from browser to browser.\n// We should check what browser we're on and set accordingly.\nvar MAX_URL_DATA_SIZE=1870;\nvar SEG_HEADER_SIZE=30;//ie: &seg=8299234&ts=982389123&d=\nvar MAX_PAYLOAD_SIZE=MAX_URL_DATA_SIZE-SEG_HEADER_SIZE;\n/**\r\n * Keepalive period\r\n * send a fresh request at minimum every 25 seconds. Opera has a maximum request\r\n * length of 30 seconds that we can't exceed.\r\n * @const\r\n * @type {number}\r\n */\nvar KEEPALIVE_REQUEST_INTERVAL=25000;\n/**\r\n * How long to wait before aborting a long-polling connection attempt.\r\n * @const\r\n * @type {number}\r\n */\nvar LP_CONNECT_TIMEOUT=30000;\n/**\r\n * This class manages a single long-polling connection.\r\n *\r\n * @constructor\r\n * @implements {Transport}\r\n */\nvar BrowserPollConnection=/** @class */function(){\n/**\r\n     * @param connId An identifier for this connection, used for logging\r\n     * @param repoInfo The info for the endpoint to send data to.\r\n     * @param applicationId The Firebase App ID for this project.\r\n     * @param transportSessionId Optional transportSessionid if we are reconnecting for an existing\r\n     *                                         transport session\r\n     * @param lastSessionId Optional lastSessionId if the PersistentConnection has already created a\r\n     *                                     connection previously\r\n     */\nfunction BrowserPollConnection(connId,repoInfo,applicationId,transportSessionId,lastSessionId){\nthis.connId=connId;\nthis.repoInfo=repoInfo;\nthis.applicationId=applicationId;\nthis.transportSessionId=transportSessionId;\nthis.lastSessionId=lastSessionId;\nthis.bytesSent=0;\nthis.bytesReceived=0;\nthis.everConnected_=false;\nthis.log_=logWrapper(connId);\nthis.stats_=StatsManager.getCollection(repoInfo);\nthis.urlFn=function(params){\nreturn repoInfo.connectionURL(LONG_POLLING,params);\n};\n}\n/**\r\n     *\r\n     * @param {function(Object)} onMessage Callback when messages arrive\r\n     * @param {function()} onDisconnect Callback with connection lost.\r\n     */\nBrowserPollConnection.prototype.open=function(onMessage,onDisconnect){\nvar _this=this;\nthis.curSegmentNum=0;\nthis.onDisconnect_=onDisconnect;\nthis.myPacketOrderer=new PacketReceiver(onMessage);\nthis.isClosed_=false;\nthis.connectTimeoutTimer_=setTimeout(function(){\n_this.log_('Timed out trying to connect.');\n// Make sure we clear the host cache\n_this.onClosed_();\n_this.connectTimeoutTimer_=null;\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\n},Math.floor(LP_CONNECT_TIMEOUT));\n// Ensure we delay the creation of the iframe until the DOM is loaded.\nexecuteWhenDOMReady(function(){\nif(_this.isClosed_){\nreturn;\n}\n//Set up a callback that gets triggered once a connection is set up.\n_this.scriptTagHolder=new FirebaseIFrameScriptHolder(function(){\nvar args=[];\nfor(var _i=0;_i<arguments.length;_i++){\nargs[_i]=arguments[_i];\n}\nvar _a=tslib.__read(args,5),command=_a[0],arg1=_a[1],arg2=_a[2],arg3=_a[3],arg4=_a[4];\n_this.incrementIncomingBytes_(args);\nif(!_this.scriptTagHolder){\nreturn;// we closed the connection.\n}\nif(_this.connectTimeoutTimer_){\nclearTimeout(_this.connectTimeoutTimer_);\n_this.connectTimeoutTimer_=null;\n}\n_this.everConnected_=true;\nif(command===FIREBASE_LONGPOLL_START_PARAM){\n_this.id=arg1;\n_this.password=arg2;\n}else\nif(command===FIREBASE_LONGPOLL_CLOSE_COMMAND){\n// Don't clear the host cache. We got a response from the server, so we know it's reachable\nif(arg1){\n// We aren't expecting any more data (other than what the server's already in the process of sending us\n// through our already open polls), so don't send any more.\n_this.scriptTagHolder.sendNewPolls=false;\n// arg1 in this case is the last response number sent by the server. We should try to receive\n// all of the responses up to this one before closing\n_this.myPacketOrderer.closeAfter(arg1,function(){\n_this.onClosed_();\n});\n}else\n{\n_this.onClosed_();\n}\n}else\n{\nthrow new Error('Unrecognized command received: '+command);\n}\n},function(){\nvar args=[];\nfor(var _i=0;_i<arguments.length;_i++){\nargs[_i]=arguments[_i];\n}\nvar _a=tslib.__read(args,2),pN=_a[0],data=_a[1];\n_this.incrementIncomingBytes_(args);\n_this.myPacketOrderer.handleResponse(pN,data);\n},function(){\n_this.onClosed_();\n},_this.urlFn);\n//Send the initial request to connect. The serial number is simply to keep the browser from pulling previous results\n//from cache.\nvar urlParams={};\nurlParams[FIREBASE_LONGPOLL_START_PARAM]='t';\nurlParams[FIREBASE_LONGPOLL_SERIAL_PARAM]=Math.floor(Math.random()*100000000);\nif(_this.scriptTagHolder.uniqueCallbackIdentifier){\nurlParams[FIREBASE_LONGPOLL_CALLBACK_ID_PARAM]=_this.scriptTagHolder.uniqueCallbackIdentifier;\n}\nurlParams[VERSION_PARAM]=PROTOCOL_VERSION;\nif(_this.transportSessionId){\nurlParams[TRANSPORT_SESSION_PARAM]=_this.transportSessionId;\n}\nif(_this.lastSessionId){\nurlParams[LAST_SESSION_PARAM]=_this.lastSessionId;\n}\nif(_this.applicationId){\nurlParams[APPLICATION_ID_PARAM]=_this.applicationId;\n}\nif(typeof location!=='undefined'&&\nlocation.href&&\nlocation.href.indexOf(FORGE_DOMAIN)!==-1){\nurlParams[REFERER_PARAM]=FORGE_REF;\n}\nvar connectURL=_this.urlFn(urlParams);\n_this.log_('Connecting via long-poll to '+connectURL);\n_this.scriptTagHolder.addTag(connectURL,function(){\n/* do nothing */\n});\n});\n};\n/**\r\n     * Call this when a handshake has completed successfully and we want to consider the connection established\r\n     */\nBrowserPollConnection.prototype.start=function(){\nthis.scriptTagHolder.startLongPoll(this.id,this.password);\nthis.addDisconnectPingFrame(this.id,this.password);\n};\n/**\r\n     * Forces long polling to be considered as a potential transport\r\n     */\nBrowserPollConnection.forceAllow=function(){\nBrowserPollConnection.forceAllow_=true;\n};\n/**\r\n     * Forces longpolling to not be considered as a potential transport\r\n     */\nBrowserPollConnection.forceDisallow=function(){\nBrowserPollConnection.forceDisallow_=true;\n};\n// Static method, use string literal so it can be accessed in a generic way\nBrowserPollConnection.isAvailable=function(){\nif(util.isNodeSdk()){\nreturn false;\n}else\nif(BrowserPollConnection.forceAllow_){\nreturn true;\n}else\n{\n// NOTE: In React-Native there's normally no 'document', but if you debug a React-Native app in\n// the Chrome debugger, 'document' is defined, but document.createElement is null (2015/06/08).\nreturn!BrowserPollConnection.forceDisallow_&&\ntypeof document!=='undefined'&&\ndocument.createElement!=null&&\n!isChromeExtensionContentScript()&&\n!isWindowsStoreApp();\n}\n};\n/**\r\n     * No-op for polling\r\n     */\nBrowserPollConnection.prototype.markConnectionHealthy=function(){};\n/**\r\n     * Stops polling and cleans up the iframe\r\n     * @private\r\n     */\nBrowserPollConnection.prototype.shutdown_=function(){\nthis.isClosed_=true;\nif(this.scriptTagHolder){\nthis.scriptTagHolder.close();\nthis.scriptTagHolder=null;\n}\n//remove the disconnect frame, which will trigger an XHR call to the server to tell it we're leaving.\nif(this.myDisconnFrame){\ndocument.body.removeChild(this.myDisconnFrame);\nthis.myDisconnFrame=null;\n}\nif(this.connectTimeoutTimer_){\nclearTimeout(this.connectTimeoutTimer_);\nthis.connectTimeoutTimer_=null;\n}\n};\n/**\r\n     * Triggered when this transport is closed\r\n     * @private\r\n     */\nBrowserPollConnection.prototype.onClosed_=function(){\nif(!this.isClosed_){\nthis.log_('Longpoll is closing itself');\nthis.shutdown_();\nif(this.onDisconnect_){\nthis.onDisconnect_(this.everConnected_);\nthis.onDisconnect_=null;\n}\n}\n};\n/**\r\n     * External-facing close handler. RealTime has requested we shut down. Kill our connection and tell the server\r\n     * that we've left.\r\n     */\nBrowserPollConnection.prototype.close=function(){\nif(!this.isClosed_){\nthis.log_('Longpoll is being closed.');\nthis.shutdown_();\n}\n};\n/**\r\n     * Send the JSON object down to the server. It will need to be stringified, base64 encoded, and then\r\n     * broken into chunks (since URLs have a small maximum length).\r\n     * @param {!Object} data The JSON data to transmit.\r\n     */\nBrowserPollConnection.prototype.send=function(data){\nvar dataStr=util.stringify(data);\nthis.bytesSent+=dataStr.length;\nthis.stats_.incrementCounter('bytes_sent',dataStr.length);\n//first, lets get the base64-encoded data\nvar base64data=util.base64Encode(dataStr);\n//We can only fit a certain amount in each URL, so we need to split this request\n//up into multiple pieces if it doesn't fit in one request.\nvar dataSegs=splitStringBySize(base64data,MAX_PAYLOAD_SIZE);\n//Enqueue each segment for transmission. We assign each chunk a sequential ID and a total number\n//of segments so that we can reassemble the packet on the server.\nfor(var i=0;i<dataSegs.length;i++){\nthis.scriptTagHolder.enqueueSegment(this.curSegmentNum,dataSegs.length,dataSegs[i]);\nthis.curSegmentNum++;\n}\n};\n/**\r\n     * This is how we notify the server that we're leaving.\r\n     * We aren't able to send requests with DHTML on a window close event, but we can\r\n     * trigger XHR requests in some browsers (everything but Opera basically).\r\n     * @param {!string} id\r\n     * @param {!string} pw\r\n     */\nBrowserPollConnection.prototype.addDisconnectPingFrame=function(id,pw){\nif(util.isNodeSdk()){\nreturn;\n}\nthis.myDisconnFrame=document.createElement('iframe');\nvar urlParams={};\nurlParams[FIREBASE_LONGPOLL_DISCONN_FRAME_REQUEST_PARAM]='t';\nurlParams[FIREBASE_LONGPOLL_ID_PARAM]=id;\nurlParams[FIREBASE_LONGPOLL_PW_PARAM]=pw;\nthis.myDisconnFrame.src=this.urlFn(urlParams);\nthis.myDisconnFrame.style.display='none';\ndocument.body.appendChild(this.myDisconnFrame);\n};\n/**\r\n     * Used to track the bytes received by this client\r\n     * @param {*} args\r\n     * @private\r\n     */\nBrowserPollConnection.prototype.incrementIncomingBytes_=function(args){\n// TODO: This is an annoying perf hit just to track the number of incoming bytes.  Maybe it should be opt-in.\nvar bytesReceived=util.stringify(args).length;\nthis.bytesReceived+=bytesReceived;\nthis.stats_.incrementCounter('bytes_received',bytesReceived);\n};\nreturn BrowserPollConnection;\n}();\n/*********************************************************************************************\r\n * A wrapper around an iframe that is used as a long-polling script holder.\r\n * @constructor\r\n *********************************************************************************************/\nvar FirebaseIFrameScriptHolder=/** @class */function(){\n/**\r\n     * @param commandCB - The callback to be called when control commands are recevied from the server.\r\n     * @param onMessageCB - The callback to be triggered when responses arrive from the server.\r\n     * @param onDisconnect - The callback to be triggered when this tag holder is closed\r\n     * @param urlFn - A function that provides the URL of the endpoint to send data to.\r\n     */\nfunction FirebaseIFrameScriptHolder(commandCB,onMessageCB,onDisconnect,urlFn){\nthis.onDisconnect=onDisconnect;\nthis.urlFn=urlFn;\n//We maintain a count of all of the outstanding requests, because if we have too many active at once it can cause\n//problems in some browsers.\nthis.outstandingRequests=new Set();\n//A queue of the pending segments waiting for transmission to the server.\nthis.pendingSegs=[];\n//A serial number. We use this for two things:\n// 1) A way to ensure the browser doesn't cache responses to polls\n// 2) A way to make the server aware when long-polls arrive in a different order than we started them. The\n//    server needs to release both polls in this case or it will cause problems in Opera since Opera can only execute\n//    JSONP code in the order it was added to the iframe.\nthis.currentSerial=Math.floor(Math.random()*100000000);\n// This gets set to false when we're \"closing down\" the connection (e.g. we're switching transports but there's still\n// incoming data from the server that we're waiting for).\nthis.sendNewPolls=true;\nif(!util.isNodeSdk()){\n//Each script holder registers a couple of uniquely named callbacks with the window. These are called from the\n//iframes where we put the long-polling script tags. We have two callbacks:\n//   1) Command Callback - Triggered for control issues, like starting a connection.\n//   2) Message Callback - Triggered when new data arrives.\nthis.uniqueCallbackIdentifier=LUIDGenerator();\nwindow[FIREBASE_LONGPOLL_COMMAND_CB_NAME+this.uniqueCallbackIdentifier]=commandCB;\nwindow[FIREBASE_LONGPOLL_DATA_CB_NAME+this.uniqueCallbackIdentifier]=onMessageCB;\n//Create an iframe for us to add script tags to.\nthis.myIFrame=FirebaseIFrameScriptHolder.createIFrame_();\n// Set the iframe's contents.\nvar script='';\n// if we set a javascript url, it's IE and we need to set the document domain. The javascript url is sufficient\n// for ie9, but ie8 needs to do it again in the document itself.\nif(this.myIFrame.src&&\nthis.myIFrame.src.substr(0,'javascript:'.length)==='javascript:'){\nvar currentDomain=document.domain;\nscript='<script>document.domain=\"'+currentDomain+'\";</script>';\n}\nvar iframeContents='<html><body>'+script+'</body></html>';\ntry{\nthis.myIFrame.doc.open();\nthis.myIFrame.doc.write(iframeContents);\nthis.myIFrame.doc.close();\n}\ncatch(e){\nlog('frame writing exception');\nif(e.stack){\nlog(e.stack);\n}\nlog(e);\n}\n}else\n{\nthis.commandCB=commandCB;\nthis.onMessageCB=onMessageCB;\n}\n}\n/**\r\n     * Each browser has its own funny way to handle iframes. Here we mush them all together into one object that I can\r\n     * actually use.\r\n     * @private\r\n     * @return {Element}\r\n     */\nFirebaseIFrameScriptHolder.createIFrame_=function(){\nvar iframe=document.createElement('iframe');\niframe.style.display='none';\n// This is necessary in order to initialize the document inside the iframe\nif(document.body){\ndocument.body.appendChild(iframe);\ntry{\n// If document.domain has been modified in IE, this will throw an error, and we need to set the\n// domain of the iframe's document manually. We can do this via a javascript: url as the src attribute\n// Also note that we must do this *after* the iframe has been appended to the page. Otherwise it doesn't work.\nvar a=iframe.contentWindow.document;\nif(!a){\n// Apologies for the log-spam, I need to do something to keep closure from optimizing out the assignment above.\nlog('No IE domain setting required');\n}\n}\ncatch(e){\nvar domain=document.domain;\niframe.src=\n\"javascript:void((function(){document.open();document.domain='\"+\ndomain+\n\"';document.close();})())\";\n}\n}else\n{\n// LongPollConnection attempts to delay initialization until the document is ready, so hopefully this\n// never gets hit.\nthrow'Document body has not initialized. Wait to initialize Firebase until after the document is ready.';\n}\n// Get the document of the iframe in a browser-specific way.\nif(iframe.contentDocument){\niframe.doc=iframe.contentDocument;// Firefox, Opera, Safari\n}else\nif(iframe.contentWindow){\niframe.doc=iframe.contentWindow.document;// Internet Explorer\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\n}else\nif(iframe.document){\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\niframe.doc=iframe.document;//others?\n}\nreturn iframe;\n};\n/**\r\n     * Cancel all outstanding queries and remove the frame.\r\n     */\nFirebaseIFrameScriptHolder.prototype.close=function(){\nvar _this=this;\n//Mark this iframe as dead, so no new requests are sent.\nthis.alive=false;\nif(this.myIFrame){\n//We have to actually remove all of the html inside this iframe before removing it from the\n//window, or IE will continue loading and executing the script tags we've already added, which\n//can lead to some errors being thrown. Setting innerHTML seems to be the easiest way to do this.\nthis.myIFrame.doc.body.innerHTML='';\nsetTimeout(function(){\nif(_this.myIFrame!==null){\ndocument.body.removeChild(_this.myIFrame);\n_this.myIFrame=null;\n}\n},Math.floor(0));\n}\n// Protect from being called recursively.\nvar onDisconnect=this.onDisconnect;\nif(onDisconnect){\nthis.onDisconnect=null;\nonDisconnect();\n}\n};\n/**\r\n     * Actually start the long-polling session by adding the first script tag(s) to the iframe.\r\n     * @param {!string} id - The ID of this connection\r\n     * @param {!string} pw - The password for this connection\r\n     */\nFirebaseIFrameScriptHolder.prototype.startLongPoll=function(id,pw){\nthis.myID=id;\nthis.myPW=pw;\nthis.alive=true;\n//send the initial request. If there are requests queued, make sure that we transmit as many as we are currently able to.\nwhile(this.newRequest_()){}\n};\n/**\r\n     * This is called any time someone might want a script tag to be added. It adds a script tag when there aren't\r\n     * too many outstanding requests and we are still alive.\r\n     *\r\n     * If there are outstanding packet segments to send, it sends one. If there aren't, it sends a long-poll anyways if\r\n     * needed.\r\n     */\nFirebaseIFrameScriptHolder.prototype.newRequest_=function(){\n// We keep one outstanding request open all the time to receive data, but if we need to send data\n// (pendingSegs.length > 0) then we create a new request to send the data.  The server will automatically\n// close the old request.\nif(this.alive&&\nthis.sendNewPolls&&\nthis.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){\n//construct our url\nthis.currentSerial++;\nvar urlParams={};\nurlParams[FIREBASE_LONGPOLL_ID_PARAM]=this.myID;\nurlParams[FIREBASE_LONGPOLL_PW_PARAM]=this.myPW;\nurlParams[FIREBASE_LONGPOLL_SERIAL_PARAM]=this.currentSerial;\nvar theURL=this.urlFn(urlParams);\n//Now add as much data as we can.\nvar curDataString='';\nvar i=0;\nwhile(this.pendingSegs.length>0){\n//first, lets see if the next segment will fit.\nvar nextSeg=this.pendingSegs[0];\nif(nextSeg.d.length+\nSEG_HEADER_SIZE+\ncurDataString.length<=\nMAX_URL_DATA_SIZE){\n//great, the segment will fit. Lets append it.\nvar theSeg=this.pendingSegs.shift();\ncurDataString=\ncurDataString+\n'&'+\nFIREBASE_LONGPOLL_SEGMENT_NUM_PARAM+\ni+\n'='+\ntheSeg.seg+\n'&'+\nFIREBASE_LONGPOLL_SEGMENTS_IN_PACKET+\ni+\n'='+\ntheSeg.ts+\n'&'+\nFIREBASE_LONGPOLL_DATA_PARAM+\ni+\n'='+\ntheSeg.d;\ni++;\n}else\n{\nbreak;\n}\n}\ntheURL=theURL+curDataString;\nthis.addLongPollTag_(theURL,this.currentSerial);\nreturn true;\n}else\n{\nreturn false;\n}\n};\n/**\r\n     * Queue a packet for transmission to the server.\r\n     * @param segnum - A sequential id for this packet segment used for reassembly\r\n     * @param totalsegs - The total number of segments in this packet\r\n     * @param data - The data for this segment.\r\n     */\nFirebaseIFrameScriptHolder.prototype.enqueueSegment=function(segnum,totalsegs,data){\n//add this to the queue of segments to send.\nthis.pendingSegs.push({seg:segnum,ts:totalsegs,d:data});\n//send the data immediately if there isn't already data being transmitted, unless\n//startLongPoll hasn't been called yet.\nif(this.alive){\nthis.newRequest_();\n}\n};\n/**\r\n     * Add a script tag for a regular long-poll request.\r\n     * @param {!string} url - The URL of the script tag.\r\n     * @param {!number} serial - The serial number of the request.\r\n     * @private\r\n     */\nFirebaseIFrameScriptHolder.prototype.addLongPollTag_=function(url,serial){\nvar _this=this;\n//remember that we sent this request.\nthis.outstandingRequests.add(serial);\nvar doNewRequest=function doNewRequest(){\n_this.outstandingRequests.delete(serial);\n_this.newRequest_();\n};\n// If this request doesn't return on its own accord (by the server sending us some data), we'll\n// create a new one after the KEEPALIVE interval to make sure we always keep a fresh request open.\nvar keepaliveTimeout=setTimeout(doNewRequest,Math.floor(KEEPALIVE_REQUEST_INTERVAL));\nvar readyStateCB=function readyStateCB(){\n// Request completed.  Cancel the keepalive.\nclearTimeout(keepaliveTimeout);\n// Trigger a new request so we can continue receiving data.\ndoNewRequest();\n};\nthis.addTag(url,readyStateCB);\n};\n/**\r\n     * Add an arbitrary script tag to the iframe.\r\n     * @param {!string} url - The URL for the script tag source.\r\n     * @param {!function()} loadCB - A callback to be triggered once the script has loaded.\r\n     */\nFirebaseIFrameScriptHolder.prototype.addTag=function(url,loadCB){\nvar _this=this;\nif(util.isNodeSdk()){\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nthis.doNodeLongPoll(url,loadCB);\n}else\n{\nsetTimeout(function(){\ntry{\n// if we're already closed, don't add this poll\nif(!_this.sendNewPolls){\nreturn;\n}\nvar newScript_1=_this.myIFrame.doc.createElement('script');\nnewScript_1.type='text/javascript';\nnewScript_1.async=true;\nnewScript_1.src=url;\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nnewScript_1.onload=newScript_1.onreadystatechange=function(){\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nvar rstate=newScript_1.readyState;\nif(!rstate||rstate==='loaded'||rstate==='complete'){\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nnewScript_1.onload=newScript_1.onreadystatechange=null;\nif(newScript_1.parentNode){\nnewScript_1.parentNode.removeChild(newScript_1);\n}\nloadCB();\n}\n};\nnewScript_1.onerror=function(){\nlog('Long-poll script failed to load: '+url);\n_this.sendNewPolls=false;\n_this.close();\n};\n_this.myIFrame.doc.body.appendChild(newScript_1);\n}\ncatch(e){\n// TODO: we should make this error visible somehow\n}\n},Math.floor(1));\n}\n};\nreturn FirebaseIFrameScriptHolder;\n}();\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n/** The semver (www.semver.org) version of the SDK. */\nvar SDK_VERSION='';\n// SDK_VERSION should be set before any database instance is created\nfunction setSDKVersion(version){\nSDK_VERSION=version;\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\nvar WEBSOCKET_MAX_FRAME_SIZE=16384;\nvar WEBSOCKET_KEEPALIVE_INTERVAL=45000;\nvar WebSocketImpl=null;\nif(typeof MozWebSocket!=='undefined'){\nWebSocketImpl=MozWebSocket;\n}else\nif(typeof WebSocket!=='undefined'){\nWebSocketImpl=WebSocket;\n}\n/**\r\n * Create a new websocket connection with the given callbacks.\r\n * @constructor\r\n * @implements {Transport}\r\n */\nvar WebSocketConnection=/** @class */function(){\n/**\r\n     * @param connId identifier for this transport\r\n     * @param repoInfo The info for the websocket endpoint.\r\n     * @param applicationId The Firebase App ID for this project.\r\n     * @param transportSessionId Optional transportSessionId if this is connecting to an existing transport\r\n     *                                         session\r\n     * @param lastSessionId Optional lastSessionId if there was a previous connection\r\n     */\nfunction WebSocketConnection(connId,repoInfo,applicationId,transportSessionId,lastSessionId){\nthis.connId=connId;\nthis.applicationId=applicationId;\nthis.keepaliveTimer=null;\nthis.frames=null;\nthis.totalFrames=0;\nthis.bytesSent=0;\nthis.bytesReceived=0;\nthis.log_=logWrapper(this.connId);\nthis.stats_=StatsManager.getCollection(repoInfo);\nthis.connURL=WebSocketConnection.connectionURL_(repoInfo,transportSessionId,lastSessionId);\nthis.nodeAdmin=repoInfo.nodeAdmin;\n}\n/**\r\n     * @param {RepoInfo} repoInfo The info for the websocket endpoint.\r\n     * @param {string=} transportSessionId Optional transportSessionId if this is connecting to an existing transport\r\n     *                                         session\r\n     * @param {string=} lastSessionId Optional lastSessionId if there was a previous connection\r\n     * @return {string} connection url\r\n     * @private\r\n     */\nWebSocketConnection.connectionURL_=function(repoInfo,transportSessionId,lastSessionId){\nvar urlParams={};\nurlParams[VERSION_PARAM]=PROTOCOL_VERSION;\nif(!util.isNodeSdk()&&\ntypeof location!=='undefined'&&\nlocation.href&&\nlocation.href.indexOf(FORGE_DOMAIN)!==-1){\nurlParams[REFERER_PARAM]=FORGE_REF;\n}\nif(transportSessionId){\nurlParams[TRANSPORT_SESSION_PARAM]=transportSessionId;\n}\nif(lastSessionId){\nurlParams[LAST_SESSION_PARAM]=lastSessionId;\n}\nreturn repoInfo.connectionURL(WEBSOCKET,urlParams);\n};\n/**\r\n     *\r\n     * @param onMessage Callback when messages arrive\r\n     * @param onDisconnect Callback with connection lost.\r\n     */\nWebSocketConnection.prototype.open=function(onMessage,onDisconnect){\nvar _this=this;\nthis.onDisconnect=onDisconnect;\nthis.onMessage=onMessage;\nthis.log_('Websocket connecting to '+this.connURL);\nthis.everConnected_=false;\n// Assume failure until proven otherwise.\nPersistentStorage.set('previous_websocket_failure',true);\ntry{\nif(util.isNodeSdk()){\nvar device=this.nodeAdmin?'AdminNode':'Node';\n// UA Format: Firebase/<wire_protocol>/<sdk_version>/<platform>/<device>\nvar options={\nheaders:{\n'User-Agent':\"Firebase/\"+PROTOCOL_VERSION+\"/\"+SDK_VERSION+\"/\"+process.platform+\"/\"+device,\n'X-Firebase-GMPID':this.applicationId||''}};\n\n\n// Plumb appropriate http_proxy environment variable into faye-websocket if it exists.\nvar env=process['env'];\nvar proxy=this.connURL.indexOf('wss://')===0?\nenv['HTTPS_PROXY']||env['https_proxy']:\nenv['HTTP_PROXY']||env['http_proxy'];\nif(proxy){\noptions['proxy']={origin:proxy};\n}\nthis.mySock=new WebSocketImpl(this.connURL,[],options);\n}else\n{\nvar options={\nheaders:{\n'X-Firebase-GMPID':this.applicationId||''}};\n\n\nthis.mySock=new WebSocketImpl(this.connURL,[],options);\n}\n}\ncatch(e){\nthis.log_('Error instantiating WebSocket.');\nvar error=e.message||e.data;\nif(error){\nthis.log_(error);\n}\nthis.onClosed_();\nreturn;\n}\nthis.mySock.onopen=function(){\n_this.log_('Websocket connected.');\n_this.everConnected_=true;\n};\nthis.mySock.onclose=function(){\n_this.log_('Websocket connection was disconnected.');\n_this.mySock=null;\n_this.onClosed_();\n};\nthis.mySock.onmessage=function(m){\n_this.handleIncomingFrame(m);\n};\nthis.mySock.onerror=function(e){\n_this.log_('WebSocket error.  Closing connection.');\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nvar error=e.message||e.data;\nif(error){\n_this.log_(error);\n}\n_this.onClosed_();\n};\n};\n/**\r\n     * No-op for websockets, we don't need to do anything once the connection is confirmed as open\r\n     */\nWebSocketConnection.prototype.start=function(){};\nWebSocketConnection.forceDisallow=function(){\nWebSocketConnection.forceDisallow_=true;\n};\nWebSocketConnection.isAvailable=function(){\nvar isOldAndroid=false;\nif(typeof navigator!=='undefined'&&navigator.userAgent){\nvar oldAndroidRegex=/Android ([0-9]{0,}\\.[0-9]{0,})/;\nvar oldAndroidMatch=navigator.userAgent.match(oldAndroidRegex);\nif(oldAndroidMatch&&oldAndroidMatch.length>1){\nif(parseFloat(oldAndroidMatch[1])<4.4){\nisOldAndroid=true;\n}\n}\n}\nreturn!isOldAndroid&&\nWebSocketImpl!==null&&\n!WebSocketConnection.forceDisallow_;\n};\n/**\r\n     * Returns true if we previously failed to connect with this transport.\r\n     * @return {boolean}\r\n     */\nWebSocketConnection.previouslyFailed=function(){\n// If our persistent storage is actually only in-memory storage,\n// we default to assuming that it previously failed to be safe.\nreturn PersistentStorage.isInMemoryStorage||\nPersistentStorage.get('previous_websocket_failure')===true;\n};\nWebSocketConnection.prototype.markConnectionHealthy=function(){\nPersistentStorage.remove('previous_websocket_failure');\n};\nWebSocketConnection.prototype.appendFrame_=function(data){\nthis.frames.push(data);\nif(this.frames.length===this.totalFrames){\nvar fullMess=this.frames.join('');\nthis.frames=null;\nvar jsonMess=util.jsonEval(fullMess);\n//handle the message\nthis.onMessage(jsonMess);\n}\n};\n/**\r\n     * @param {number} frameCount The number of frames we are expecting from the server\r\n     * @private\r\n     */\nWebSocketConnection.prototype.handleNewFrameCount_=function(frameCount){\nthis.totalFrames=frameCount;\nthis.frames=[];\n};\n/**\r\n     * Attempts to parse a frame count out of some text. If it can't, assumes a value of 1\r\n     * @param {!String} data\r\n     * @return {?String} Any remaining data to be process, or null if there is none\r\n     * @private\r\n     */\nWebSocketConnection.prototype.extractFrameCount_=function(data){\nutil.assert(this.frames===null,'We already have a frame buffer');\n// TODO: The server is only supposed to send up to 9999 frames (i.e. length <= 4), but that isn't being enforced\n// currently.  So allowing larger frame counts (length <= 6).  See https://app.asana.com/0/search/8688598998380/8237608042508\nif(data.length<=6){\nvar frameCount=Number(data);\nif(!isNaN(frameCount)){\nthis.handleNewFrameCount_(frameCount);\nreturn null;\n}\n}\nthis.handleNewFrameCount_(1);\nreturn data;\n};\n/**\r\n     * Process a websocket frame that has arrived from the server.\r\n     * @param mess The frame data\r\n     */\nWebSocketConnection.prototype.handleIncomingFrame=function(mess){\nif(this.mySock===null){\nreturn;// Chrome apparently delivers incoming packets even after we .close() the connection sometimes.\n}\nvar data=mess['data'];\nthis.bytesReceived+=data.length;\nthis.stats_.incrementCounter('bytes_received',data.length);\nthis.resetKeepAlive();\nif(this.frames!==null){\n// we're buffering\nthis.appendFrame_(data);\n}else\n{\n// try to parse out a frame count, otherwise, assume 1 and process it\nvar remainingData=this.extractFrameCount_(data);\nif(remainingData!==null){\nthis.appendFrame_(remainingData);\n}\n}\n};\n/**\r\n     * Send a message to the server\r\n     * @param {Object} data The JSON object to transmit\r\n     */\nWebSocketConnection.prototype.send=function(data){\nthis.resetKeepAlive();\nvar dataStr=util.stringify(data);\nthis.bytesSent+=dataStr.length;\nthis.stats_.incrementCounter('bytes_sent',dataStr.length);\n//We can only fit a certain amount in each websocket frame, so we need to split this request\n//up into multiple pieces if it doesn't fit in one request.\nvar dataSegs=splitStringBySize(dataStr,WEBSOCKET_MAX_FRAME_SIZE);\n//Send the length header\nif(dataSegs.length>1){\nthis.sendString_(String(dataSegs.length));\n}\n//Send the actual data in segments.\nfor(var i=0;i<dataSegs.length;i++){\nthis.sendString_(dataSegs[i]);\n}\n};\nWebSocketConnection.prototype.shutdown_=function(){\nthis.isClosed_=true;\nif(this.keepaliveTimer){\nclearInterval(this.keepaliveTimer);\nthis.keepaliveTimer=null;\n}\nif(this.mySock){\nthis.mySock.close();\nthis.mySock=null;\n}\n};\nWebSocketConnection.prototype.onClosed_=function(){\nif(!this.isClosed_){\nthis.log_('WebSocket is closing itself');\nthis.shutdown_();\n// since this is an internal close, trigger the close listener\nif(this.onDisconnect){\nthis.onDisconnect(this.everConnected_);\nthis.onDisconnect=null;\n}\n}\n};\n/**\r\n     * External-facing close handler.\r\n     * Close the websocket and kill the connection.\r\n     */\nWebSocketConnection.prototype.close=function(){\nif(!this.isClosed_){\nthis.log_('WebSocket is being closed');\nthis.shutdown_();\n}\n};\n/**\r\n     * Kill the current keepalive timer and start a new one, to ensure that it always fires N seconds after\r\n     * the last activity.\r\n     */\nWebSocketConnection.prototype.resetKeepAlive=function(){\nvar _this=this;\nclearInterval(this.keepaliveTimer);\nthis.keepaliveTimer=setInterval(function(){\n//If there has been no websocket activity for a while, send a no-op\nif(_this.mySock){\n_this.sendString_('0');\n}\n_this.resetKeepAlive();\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\n},Math.floor(WEBSOCKET_KEEPALIVE_INTERVAL));\n};\n/**\r\n     * Send a string over the websocket.\r\n     *\r\n     * @param {string} str String to send.\r\n     * @private\r\n     */\nWebSocketConnection.prototype.sendString_=function(str){\n// Firefox seems to sometimes throw exceptions (NS_ERROR_UNEXPECTED) from websocket .send()\n// calls for some unknown reason.  We treat these as an error and disconnect.\n// See https://app.asana.com/0/58926111402292/68021340250410\ntry{\nthis.mySock.send(str);\n}\ncatch(e){\nthis.log_('Exception thrown from WebSocket.send():',e.message||e.data,'Closing connection.');\nsetTimeout(this.onClosed_.bind(this),0);\n}\n};\n/**\r\n     * Number of response before we consider the connection \"healthy.\"\r\n     * @type {number}\r\n     */\nWebSocketConnection.responsesRequiredToBeHealthy=2;\n/**\r\n     * Time to wait for the connection te become healthy before giving up.\r\n     * @type {number}\r\n     */\nWebSocketConnection.healthyTimeout=30000;\nreturn WebSocketConnection;\n}();\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n/**\r\n * Currently simplistic, this class manages what transport a Connection should use at various stages of its\r\n * lifecycle.\r\n *\r\n * It starts with longpolling in a browser, and httppolling on node. It then upgrades to websockets if\r\n * they are available.\r\n * @constructor\r\n */\nvar TransportManager=/** @class */function(){\n/**\r\n     * @param {!RepoInfo} repoInfo Metadata around the namespace we're connecting to\r\n     */\nfunction TransportManager(repoInfo){\nthis.initTransports_(repoInfo);\n}\nObject.defineProperty(TransportManager,\"ALL_TRANSPORTS\",{\n/**\r\n         * @const\r\n         * @type {!Array.<function(new:Transport, string, RepoInfo, string=)>}\r\n         */\nget:function get(){\nreturn[BrowserPollConnection,WebSocketConnection];\n},\nenumerable:false,\nconfigurable:true});\n\n/**\r\n     * @param {!RepoInfo} repoInfo\r\n     * @private\r\n     */\nTransportManager.prototype.initTransports_=function(repoInfo){\nvar e_1,_a;\nvar isWebSocketsAvailable=WebSocketConnection&&WebSocketConnection['isAvailable']();\nvar isSkipPollConnection=isWebSocketsAvailable&&!WebSocketConnection.previouslyFailed();\nif(repoInfo.webSocketOnly){\nif(!isWebSocketsAvailable){\nwarn(\"wss:// URL used, but browser isn't known to support websockets.  Trying anyway.\");\n}\nisSkipPollConnection=true;\n}\nif(isSkipPollConnection){\nthis.transports_=[WebSocketConnection];\n}else\n{\nvar transports=this.transports_=[];\ntry{\nfor(var _b=tslib.__values(TransportManager.ALL_TRANSPORTS),_c=_b.next();!_c.done;_c=_b.next()){\nvar transport=_c.value;\nif(transport&&transport['isAvailable']()){\ntransports.push(transport);\n}\n}\n}\ncatch(e_1_1){e_1={error:e_1_1};}finally\n{\ntry{\nif(_c&&!_c.done&&(_a=_b.return))_a.call(_b);\n}finally\n{if(e_1)throw e_1.error;}\n}\n}\n};\n/**\r\n     * @return {function(new:Transport, !string, !RepoInfo, string=, string=)} The constructor for the\r\n     * initial transport to use\r\n     */\nTransportManager.prototype.initialTransport=function(){\nif(this.transports_.length>0){\nreturn this.transports_[0];\n}else\n{\nthrow new Error('No transports available');\n}\n};\n/**\r\n     * @return {?function(new:Transport, function(),function(), string=)} The constructor for the next\r\n     * transport, or null\r\n     */\nTransportManager.prototype.upgradeTransport=function(){\nif(this.transports_.length>1){\nreturn this.transports_[1];\n}else\n{\nreturn null;\n}\n};\nreturn TransportManager;\n}();\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n// Abort upgrade attempt if it takes longer than 60s.\nvar UPGRADE_TIMEOUT=60000;\n// For some transports (WebSockets), we need to \"validate\" the transport by exchanging a few requests and responses.\n// If we haven't sent enough requests within 5s, we'll start sending noop ping requests.\nvar DELAY_BEFORE_SENDING_EXTRA_REQUESTS=5000;\n// If the initial data sent triggers a lot of bandwidth (i.e. it's a large put or a listen for a large amount of data)\n// then we may not be able to exchange our ping/pong requests within the healthy timeout.  So if we reach the timeout\n// but we've sent/received enough bytes, we don't cancel the connection.\nvar BYTES_SENT_HEALTHY_OVERRIDE=10*1024;\nvar BYTES_RECEIVED_HEALTHY_OVERRIDE=100*1024;\nvar MESSAGE_TYPE='t';\nvar MESSAGE_DATA='d';\nvar CONTROL_SHUTDOWN='s';\nvar CONTROL_RESET='r';\nvar CONTROL_ERROR='e';\nvar CONTROL_PONG='o';\nvar SWITCH_ACK='a';\nvar END_TRANSMISSION='n';\nvar PING='p';\nvar SERVER_HELLO='h';\n/**\r\n * Creates a new real-time connection to the server using whichever method works\r\n * best in the current browser.\r\n *\r\n * @constructor\r\n */\nvar Connection=/** @class */function(){\n/**\r\n     * @param id - an id for this connection\r\n     * @param repoInfo_ - the info for the endpoint to connect to\r\n     * @param applicationId_ - the Firebase App ID for this project\r\n     * @param onMessage_ - the callback to be triggered when a server-push message arrives\r\n     * @param onReady_ - the callback to be triggered when this connection is ready to send messages.\r\n     * @param onDisconnect_ - the callback to be triggered when a connection was lost\r\n     * @param onKill_ - the callback to be triggered when this connection has permanently shut down.\r\n     * @param lastSessionId - last session id in persistent connection. is used to clean up old session in real-time server\r\n     */\nfunction Connection(id,repoInfo_,applicationId_,onMessage_,onReady_,onDisconnect_,onKill_,lastSessionId){\nthis.id=id;\nthis.repoInfo_=repoInfo_;\nthis.applicationId_=applicationId_;\nthis.onMessage_=onMessage_;\nthis.onReady_=onReady_;\nthis.onDisconnect_=onDisconnect_;\nthis.onKill_=onKill_;\nthis.lastSessionId=lastSessionId;\nthis.connectionCount=0;\nthis.pendingDataMessages=[];\nthis.state_=0/* CONNECTING */;\nthis.log_=logWrapper('c:'+this.id+':');\nthis.transportManager_=new TransportManager(repoInfo_);\nthis.log_('Connection created');\nthis.start_();\n}\n/**\r\n     * Starts a connection attempt\r\n     * @private\r\n     */\nConnection.prototype.start_=function(){\nvar _this=this;\nvar conn=this.transportManager_.initialTransport();\nthis.conn_=new conn(this.nextTransportId_(),this.repoInfo_,this.applicationId_,undefined,this.lastSessionId);\n// For certain transports (WebSockets), we need to send and receive several messages back and forth before we\n// can consider the transport healthy.\nthis.primaryResponsesRequired_=conn['responsesRequiredToBeHealthy']||0;\nvar onMessageReceived=this.connReceiver_(this.conn_);\nvar onConnectionLost=this.disconnReceiver_(this.conn_);\nthis.tx_=this.conn_;\nthis.rx_=this.conn_;\nthis.secondaryConn_=null;\nthis.isHealthy_=false;\n/*\r\n         * Firefox doesn't like when code from one iframe tries to create another iframe by way of the parent frame.\r\n         * This can occur in the case of a redirect, i.e. we guessed wrong on what server to connect to and received a reset.\r\n         * Somehow, setTimeout seems to make this ok. That doesn't make sense from a security perspective, since you should\r\n         * still have the context of your originating frame.\r\n         */\nsetTimeout(function(){\n// this.conn_ gets set to null in some of the tests. Check to make sure it still exists before using it\n_this.conn_&&_this.conn_.open(onMessageReceived,onConnectionLost);\n},Math.floor(0));\nvar healthyTimeoutMS=conn['healthyTimeout']||0;\nif(healthyTimeoutMS>0){\nthis.healthyTimeout_=setTimeoutNonBlocking(function(){\n_this.healthyTimeout_=null;\nif(!_this.isHealthy_){\nif(_this.conn_&&\n_this.conn_.bytesReceived>BYTES_RECEIVED_HEALTHY_OVERRIDE){\n_this.log_('Connection exceeded healthy timeout but has received '+\n_this.conn_.bytesReceived+\n' bytes.  Marking connection healthy.');\n_this.isHealthy_=true;\n_this.conn_.markConnectionHealthy();\n}else\nif(_this.conn_&&\n_this.conn_.bytesSent>BYTES_SENT_HEALTHY_OVERRIDE){\n_this.log_('Connection exceeded healthy timeout but has sent '+\n_this.conn_.bytesSent+\n' bytes.  Leaving connection alive.');\n// NOTE: We don't want to mark it healthy, since we have no guarantee that the bytes have made it to\n// the server.\n}else\n{\n_this.log_('Closing unhealthy connection after timeout.');\n_this.close();\n}\n}\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\n},Math.floor(healthyTimeoutMS));\n}\n};\n/**\r\n     * @return {!string}\r\n     * @private\r\n     */\nConnection.prototype.nextTransportId_=function(){\nreturn'c:'+this.id+':'+this.connectionCount++;\n};\nConnection.prototype.disconnReceiver_=function(conn){\nvar _this=this;\nreturn function(everConnected){\nif(conn===_this.conn_){\n_this.onConnectionLost_(everConnected);\n}else\nif(conn===_this.secondaryConn_){\n_this.log_('Secondary connection lost.');\n_this.onSecondaryConnectionLost_();\n}else\n{\n_this.log_('closing an old connection');\n}\n};\n};\nConnection.prototype.connReceiver_=function(conn){\nvar _this=this;\nreturn function(message){\nif(_this.state_!==2/* DISCONNECTED */){\nif(conn===_this.rx_){\n_this.onPrimaryMessageReceived_(message);\n}else\nif(conn===_this.secondaryConn_){\n_this.onSecondaryMessageReceived_(message);\n}else\n{\n_this.log_('message on old connection');\n}\n}\n};\n};\n/**\r\n     *\r\n     * @param {Object} dataMsg An arbitrary data message to be sent to the server\r\n     */\nConnection.prototype.sendRequest=function(dataMsg){\n// wrap in a data message envelope and send it on\nvar msg={t:'d',d:dataMsg};\nthis.sendData_(msg);\n};\nConnection.prototype.tryCleanupConnection=function(){\nif(this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_){\nthis.log_('cleaning up and promoting a connection: '+this.secondaryConn_.connId);\nthis.conn_=this.secondaryConn_;\nthis.secondaryConn_=null;\n// the server will shutdown the old connection\n}\n};\nConnection.prototype.onSecondaryControl_=function(controlData){\nif(MESSAGE_TYPE in controlData){\nvar cmd=controlData[MESSAGE_TYPE];\nif(cmd===SWITCH_ACK){\nthis.upgradeIfSecondaryHealthy_();\n}else\nif(cmd===CONTROL_RESET){\n// Most likely the session wasn't valid. Abandon the switch attempt\nthis.log_('Got a reset on secondary, closing it');\nthis.secondaryConn_.close();\n// If we were already using this connection for something, than we need to fully close\nif(this.tx_===this.secondaryConn_||\nthis.rx_===this.secondaryConn_){\nthis.close();\n}\n}else\nif(cmd===CONTROL_PONG){\nthis.log_('got pong on secondary.');\nthis.secondaryResponsesRequired_--;\nthis.upgradeIfSecondaryHealthy_();\n}\n}\n};\nConnection.prototype.onSecondaryMessageReceived_=function(parsedData){\nvar layer=requireKey('t',parsedData);\nvar data=requireKey('d',parsedData);\nif(layer==='c'){\nthis.onSecondaryControl_(data);\n}else\nif(layer==='d'){\n// got a data message, but we're still second connection. Need to buffer it up\nthis.pendingDataMessages.push(data);\n}else\n{\nthrow new Error('Unknown protocol layer: '+layer);\n}\n};\nConnection.prototype.upgradeIfSecondaryHealthy_=function(){\nif(this.secondaryResponsesRequired_<=0){\nthis.log_('Secondary connection is healthy.');\nthis.isHealthy_=true;\nthis.secondaryConn_.markConnectionHealthy();\nthis.proceedWithUpgrade_();\n}else\n{\n// Send a ping to make sure the connection is healthy.\nthis.log_('sending ping on secondary.');\nthis.secondaryConn_.send({t:'c',d:{t:PING,d:{}}});\n}\n};\nConnection.prototype.proceedWithUpgrade_=function(){\n// tell this connection to consider itself open\nthis.secondaryConn_.start();\n// send ack\nthis.log_('sending client ack on secondary');\nthis.secondaryConn_.send({t:'c',d:{t:SWITCH_ACK,d:{}}});\n// send end packet on primary transport, switch to sending on this one\n// can receive on this one, buffer responses until end received on primary transport\nthis.log_('Ending transmission on primary');\nthis.conn_.send({t:'c',d:{t:END_TRANSMISSION,d:{}}});\nthis.tx_=this.secondaryConn_;\nthis.tryCleanupConnection();\n};\nConnection.prototype.onPrimaryMessageReceived_=function(parsedData){\n// Must refer to parsedData properties in quotes, so closure doesn't touch them.\nvar layer=requireKey('t',parsedData);\nvar data=requireKey('d',parsedData);\nif(layer==='c'){\nthis.onControl_(data);\n}else\nif(layer==='d'){\nthis.onDataMessage_(data);\n}\n};\nConnection.prototype.onDataMessage_=function(message){\nthis.onPrimaryResponse_();\n// We don't do anything with data messages, just kick them up a level\nthis.onMessage_(message);\n};\nConnection.prototype.onPrimaryResponse_=function(){\nif(!this.isHealthy_){\nthis.primaryResponsesRequired_--;\nif(this.primaryResponsesRequired_<=0){\nthis.log_('Primary connection is healthy.');\nthis.isHealthy_=true;\nthis.conn_.markConnectionHealthy();\n}\n}\n};\nConnection.prototype.onControl_=function(controlData){\nvar cmd=requireKey(MESSAGE_TYPE,controlData);\nif(MESSAGE_DATA in controlData){\nvar payload=controlData[MESSAGE_DATA];\nif(cmd===SERVER_HELLO){\nthis.onHandshake_(payload);\n}else\nif(cmd===END_TRANSMISSION){\nthis.log_('recvd end transmission on primary');\nthis.rx_=this.secondaryConn_;\nfor(var i=0;i<this.pendingDataMessages.length;++i){\nthis.onDataMessage_(this.pendingDataMessages[i]);\n}\nthis.pendingDataMessages=[];\nthis.tryCleanupConnection();\n}else\nif(cmd===CONTROL_SHUTDOWN){\n// This was previously the 'onKill' callback passed to the lower-level connection\n// payload in this case is the reason for the shutdown. Generally a human-readable error\nthis.onConnectionShutdown_(payload);\n}else\nif(cmd===CONTROL_RESET){\n// payload in this case is the host we should contact\nthis.onReset_(payload);\n}else\nif(cmd===CONTROL_ERROR){\nerror('Server Error: '+payload);\n}else\nif(cmd===CONTROL_PONG){\nthis.log_('got pong on primary.');\nthis.onPrimaryResponse_();\nthis.sendPingOnPrimaryIfNecessary_();\n}else\n{\nerror('Unknown control packet command: '+cmd);\n}\n}\n};\n/**\r\n     *\r\n     * @param {Object} handshake The handshake data returned from the server\r\n     * @private\r\n     */\nConnection.prototype.onHandshake_=function(handshake){\nvar timestamp=handshake.ts;\nvar version=handshake.v;\nvar host=handshake.h;\nthis.sessionId=handshake.s;\nthis.repoInfo_.updateHost(host);\n// if we've already closed the connection, then don't bother trying to progress further\nif(this.state_===0/* CONNECTING */){\nthis.conn_.start();\nthis.onConnectionEstablished_(this.conn_,timestamp);\nif(PROTOCOL_VERSION!==version){\nwarn('Protocol version mismatch detected');\n}\n// TODO: do we want to upgrade? when? maybe a delay?\nthis.tryStartUpgrade_();\n}\n};\nConnection.prototype.tryStartUpgrade_=function(){\nvar conn=this.transportManager_.upgradeTransport();\nif(conn){\nthis.startUpgrade_(conn);\n}\n};\nConnection.prototype.startUpgrade_=function(conn){\nvar _this=this;\nthis.secondaryConn_=new conn(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.sessionId);\n// For certain transports (WebSockets), we need to send and receive several messages back and forth before we\n// can consider the transport healthy.\nthis.secondaryResponsesRequired_=\nconn['responsesRequiredToBeHealthy']||0;\nvar onMessage=this.connReceiver_(this.secondaryConn_);\nvar onDisconnect=this.disconnReceiver_(this.secondaryConn_);\nthis.secondaryConn_.open(onMessage,onDisconnect);\n// If we haven't successfully upgraded after UPGRADE_TIMEOUT, give up and kill the secondary.\nsetTimeoutNonBlocking(function(){\nif(_this.secondaryConn_){\n_this.log_('Timed out trying to upgrade.');\n_this.secondaryConn_.close();\n}\n},Math.floor(UPGRADE_TIMEOUT));\n};\nConnection.prototype.onReset_=function(host){\nthis.log_('Reset packet received.  New host: '+host);\nthis.repoInfo_.updateHost(host);\n// TODO: if we're already \"connected\", we need to trigger a disconnect at the next layer up.\n// We don't currently support resets after the connection has already been established\nif(this.state_===1/* CONNECTED */){\nthis.close();\n}else\n{\n// Close whatever connections we have open and start again.\nthis.closeConnections_();\nthis.start_();\n}\n};\nConnection.prototype.onConnectionEstablished_=function(conn,timestamp){\nvar _this=this;\nthis.log_('Realtime connection established.');\nthis.conn_=conn;\nthis.state_=1/* CONNECTED */;\nif(this.onReady_){\nthis.onReady_(timestamp,this.sessionId);\nthis.onReady_=null;\n}\n// If after 5 seconds we haven't sent enough requests to the server to get the connection healthy,\n// send some pings.\nif(this.primaryResponsesRequired_===0){\nthis.log_('Primary connection is healthy.');\nthis.isHealthy_=true;\n}else\n{\nsetTimeoutNonBlocking(function(){\n_this.sendPingOnPrimaryIfNecessary_();\n},Math.floor(DELAY_BEFORE_SENDING_EXTRA_REQUESTS));\n}\n};\nConnection.prototype.sendPingOnPrimaryIfNecessary_=function(){\n// If the connection isn't considered healthy yet, we'll send a noop ping packet request.\nif(!this.isHealthy_&&this.state_===1/* CONNECTED */){\nthis.log_('sending ping on primary.');\nthis.sendData_({t:'c',d:{t:PING,d:{}}});\n}\n};\nConnection.prototype.onSecondaryConnectionLost_=function(){\nvar conn=this.secondaryConn_;\nthis.secondaryConn_=null;\nif(this.tx_===conn||this.rx_===conn){\n// we are relying on this connection already in some capacity. Therefore, a failure is real\nthis.close();\n}\n};\n/**\r\n     *\r\n     * @param {boolean} everConnected Whether or not the connection ever reached a server. Used to determine if\r\n     * we should flush the host cache\r\n     * @private\r\n     */\nConnection.prototype.onConnectionLost_=function(everConnected){\nthis.conn_=null;\n// NOTE: IF you're seeing a Firefox error for this line, I think it might be because it's getting\n// called on window close and RealtimeState.CONNECTING is no longer defined.  Just a guess.\nif(!everConnected&&this.state_===0/* CONNECTING */){\nthis.log_('Realtime connection failed.');\n// Since we failed to connect at all, clear any cached entry for this namespace in case the machine went away\nif(this.repoInfo_.isCacheableHost()){\nPersistentStorage.remove('host:'+this.repoInfo_.host);\n// reset the internal host to what we would show the user, i.e. <ns>.firebaseio.com\nthis.repoInfo_.internalHost=this.repoInfo_.host;\n}\n}else\nif(this.state_===1/* CONNECTED */){\nthis.log_('Realtime connection lost.');\n}\nthis.close();\n};\n/**\r\n     *\r\n     * @param {string} reason\r\n     * @private\r\n     */\nConnection.prototype.onConnectionShutdown_=function(reason){\nthis.log_('Connection shutdown command received. Shutting down...');\nif(this.onKill_){\nthis.onKill_(reason);\nthis.onKill_=null;\n}\n// We intentionally don't want to fire onDisconnect (kill is a different case),\n// so clear the callback.\nthis.onDisconnect_=null;\nthis.close();\n};\nConnection.prototype.sendData_=function(data){\nif(this.state_!==1/* CONNECTED */){\nthrow'Connection is not connected';\n}else\n{\nthis.tx_.send(data);\n}\n};\n/**\r\n     * Cleans up this connection, calling the appropriate callbacks\r\n     */\nConnection.prototype.close=function(){\nif(this.state_!==2/* DISCONNECTED */){\nthis.log_('Closing realtime connection.');\nthis.state_=2/* DISCONNECTED */;\nthis.closeConnections_();\nif(this.onDisconnect_){\nthis.onDisconnect_();\nthis.onDisconnect_=null;\n}\n}\n};\n/**\r\n     *\r\n     * @private\r\n     */\nConnection.prototype.closeConnections_=function(){\nthis.log_('Shutting down all connections');\nif(this.conn_){\nthis.conn_.close();\nthis.conn_=null;\n}\nif(this.secondaryConn_){\nthis.secondaryConn_.close();\nthis.secondaryConn_=null;\n}\nif(this.healthyTimeout_){\nclearTimeout(this.healthyTimeout_);\nthis.healthyTimeout_=null;\n}\n};\nreturn Connection;\n}();\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n/**\r\n * Interface defining the set of actions that can be performed against the Firebase server\r\n * (basically corresponds to our wire protocol).\r\n *\r\n * @interface\r\n */\nvar ServerActions=/** @class */function(){\nfunction ServerActions(){\n}\n/**\r\n     * @param {string} pathString\r\n     * @param {*} data\r\n     * @param {function(string, string)=} onComplete\r\n     * @param {string=} hash\r\n     */\nServerActions.prototype.put=function(pathString,data,onComplete,hash){};\n/**\r\n     * @param {string} pathString\r\n     * @param {*} data\r\n     * @param {function(string, ?string)} onComplete\r\n     * @param {string=} hash\r\n     */\nServerActions.prototype.merge=function(pathString,data,onComplete,hash){};\n/**\r\n     * Refreshes the auth token for the current connection.\r\n     * @param {string} token The authentication token\r\n     */\nServerActions.prototype.refreshAuthToken=function(token){};\n/**\r\n     * @param {string} pathString\r\n     * @param {*} data\r\n     * @param {function(string, string)=} onComplete\r\n     */\nServerActions.prototype.onDisconnectPut=function(pathString,data,onComplete){};\n/**\r\n     * @param {string} pathString\r\n     * @param {*} data\r\n     * @param {function(string, string)=} onComplete\r\n     */\nServerActions.prototype.onDisconnectMerge=function(pathString,data,onComplete){};\n/**\r\n     * @param {string} pathString\r\n     * @param {function(string, string)=} onComplete\r\n     */\nServerActions.prototype.onDisconnectCancel=function(pathString,onComplete){};\n/**\r\n     * @param {Object.<string, *>} stats\r\n     */\nServerActions.prototype.reportStats=function(stats){};\nreturn ServerActions;\n}();\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\nvar RECONNECT_MIN_DELAY=1000;\nvar RECONNECT_MAX_DELAY_DEFAULT=60*5*1000;// 5 minutes in milliseconds (Case: 1858)\nvar RECONNECT_MAX_DELAY_FOR_ADMINS=30*1000;// 30 seconds for admin clients (likely to be a backend server)\nvar RECONNECT_DELAY_MULTIPLIER=1.3;\nvar RECONNECT_DELAY_RESET_TIMEOUT=30000;// Reset delay back to MIN_DELAY after being connected for 30sec.\nvar SERVER_KILL_INTERRUPT_REASON='server_kill';\n// If auth fails repeatedly, we'll assume something is wrong and log a warning / back off.\nvar INVALID_AUTH_TOKEN_THRESHOLD=3;\n/**\r\n * Firebase connection.  Abstracts wire protocol and handles reconnecting.\r\n *\r\n * NOTE: All JSON objects sent to the realtime connection must have property names enclosed\r\n * in quotes to make sure the closure compiler does not minify them.\r\n */\nvar PersistentConnection=/** @class */function(_super){\ntslib.__extends(PersistentConnection,_super);\n/**\r\n     * @implements {ServerActions}\r\n     * @param repoInfo_ Data about the namespace we are connecting to\r\n     * @param applicationId_ The Firebase App ID for this project\r\n     * @param onDataUpdate_ A callback for new data from the server\r\n     */\nfunction PersistentConnection(repoInfo_,applicationId_,onDataUpdate_,onConnectStatus_,onServerInfoUpdate_,authTokenProvider_,authOverride_){\nvar _this=_super.call(this)||this;\n_this.repoInfo_=repoInfo_;\n_this.applicationId_=applicationId_;\n_this.onDataUpdate_=onDataUpdate_;\n_this.onConnectStatus_=onConnectStatus_;\n_this.onServerInfoUpdate_=onServerInfoUpdate_;\n_this.authTokenProvider_=authTokenProvider_;\n_this.authOverride_=authOverride_;\n// Used for diagnostic logging.\n_this.id=PersistentConnection.nextPersistentConnectionId_++;\n_this.log_=logWrapper('p:'+_this.id+':');\n_this.interruptReasons_={};\n/** Map<path, Map<queryId, ListenSpec>> */\n_this.listens=new Map();\n_this.outstandingPuts_=[];\n_this.outstandingPutCount_=0;\n_this.onDisconnectRequestQueue_=[];\n_this.connected_=false;\n_this.reconnectDelay_=RECONNECT_MIN_DELAY;\n_this.maxReconnectDelay_=RECONNECT_MAX_DELAY_DEFAULT;\n_this.securityDebugCallback_=null;\n_this.lastSessionId=null;\n_this.establishConnectionTimer_=null;\n_this.visible_=false;\n// Before we get connected, we keep a queue of pending messages to send.\n_this.requestCBHash_={};\n_this.requestNumber_=0;\n_this.realtime_=null;\n_this.authToken_=null;\n_this.forceTokenRefresh_=false;\n_this.invalidAuthTokenCount_=0;\n_this.firstConnection_=true;\n_this.lastConnectionAttemptTime_=null;\n_this.lastConnectionEstablishedTime_=null;\nif(authOverride_&&!util.isNodeSdk()){\nthrow new Error('Auth override specified in options, but not supported on non Node.js platforms');\n}\n_this.scheduleConnect_(0);\nVisibilityMonitor.getInstance().on('visible',_this.onVisible_,_this);\nif(repoInfo_.host.indexOf('fblocal')===-1){\nOnlineMonitor.getInstance().on('online',_this.onOnline_,_this);\n}\nreturn _this;\n}\nPersistentConnection.prototype.sendRequest=function(action,body,onResponse){\nvar curReqNum=++this.requestNumber_;\nvar msg={r:curReqNum,a:action,b:body};\nthis.log_(util.stringify(msg));\nutil.assert(this.connected_,\"sendRequest call when we're not connected not allowed.\");\nthis.realtime_.sendRequest(msg);\nif(onResponse){\nthis.requestCBHash_[curReqNum]=onResponse;\n}\n};\n/**\r\n     * @inheritDoc\r\n     */\nPersistentConnection.prototype.listen=function(query,currentHashFn,tag,onComplete){\nvar queryId=query.queryIdentifier();\nvar pathString=query.path.toString();\nthis.log_('Listen called for '+pathString+' '+queryId);\nif(!this.listens.has(pathString)){\nthis.listens.set(pathString,new Map());\n}\nutil.assert(query.getQueryParams().isDefault()||\n!query.getQueryParams().loadsAllData(),'listen() called for non-default but complete query');\nutil.assert(!this.listens.get(pathString).has(queryId),'listen() called twice for same path/queryId.');\nvar listenSpec={\nonComplete:onComplete,\nhashFn:currentHashFn,\nquery:query,\ntag:tag};\n\nthis.listens.get(pathString).set(queryId,listenSpec);\nif(this.connected_){\nthis.sendListen_(listenSpec);\n}\n};\nPersistentConnection.prototype.sendListen_=function(listenSpec){\nvar _this=this;\nvar query=listenSpec.query;\nvar pathString=query.path.toString();\nvar queryId=query.queryIdentifier();\nthis.log_('Listen on '+pathString+' for '+queryId);\nvar req={/*path*/p:pathString};\nvar action='q';\n// Only bother to send query if it's non-default.\nif(listenSpec.tag){\nreq['q']=query.queryObject();\nreq['t']=listenSpec.tag;\n}\nreq[/*hash*/'h']=listenSpec.hashFn();\nthis.sendRequest(action,req,function(message){\nvar payload=message[/*data*/'d'];\nvar status=message[/*status*/'s'];\n// print warnings in any case...\nPersistentConnection.warnOnListenWarnings_(payload,query);\nvar currentListenSpec=_this.listens.get(pathString)&&\n_this.listens.get(pathString).get(queryId);\n// only trigger actions if the listen hasn't been removed and readded\nif(currentListenSpec===listenSpec){\n_this.log_('listen response',message);\nif(status!=='ok'){\n_this.removeListen_(pathString,queryId);\n}\nif(listenSpec.onComplete){\nlistenSpec.onComplete(status,payload);\n}\n}\n});\n};\nPersistentConnection.warnOnListenWarnings_=function(payload,query){\nif(payload&&(typeof payload==='undefined'?'undefined':_typeof(payload))==='object'&&util.contains(payload,'w')){\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nvar warnings=util.safeGet(payload,'w');\nif(Array.isArray(warnings)&&~warnings.indexOf('no_index')){\nvar indexSpec='\".indexOn\": \"'+query.getQueryParams().getIndex().toString()+'\"';\nvar indexPath=query.path.toString();\nwarn(\"Using an unspecified index. Your data will be downloaded and \"+(\n\"filtered on the client. Consider adding \"+indexSpec+\" at \")+(\nindexPath+\" to your security rules for better performance.\"));\n}\n}\n};\n/**\r\n     * @inheritDoc\r\n     */\nPersistentConnection.prototype.refreshAuthToken=function(token){\nthis.authToken_=token;\nthis.log_('Auth token refreshed');\nif(this.authToken_){\nthis.tryAuth();\n}else\n{\n//If we're connected we want to let the server know to unauthenticate us. If we're not connected, simply delete\n//the credential so we dont become authenticated next time we connect.\nif(this.connected_){\nthis.sendRequest('unauth',{},function(){});\n}\n}\nthis.reduceReconnectDelayIfAdminCredential_(token);\n};\nPersistentConnection.prototype.reduceReconnectDelayIfAdminCredential_=function(credential){\n// NOTE: This isn't intended to be bulletproof (a malicious developer can always just modify the client).\n// Additionally, we don't bother resetting the max delay back to the default if auth fails / expires.\nvar isFirebaseSecret=credential&&credential.length===40;\nif(isFirebaseSecret||util.isAdmin(credential)){\nthis.log_('Admin auth credential detected.  Reducing max reconnect time.');\nthis.maxReconnectDelay_=RECONNECT_MAX_DELAY_FOR_ADMINS;\n}\n};\n/**\r\n     * Attempts to authenticate with the given credentials. If the authentication attempt fails, it's triggered like\r\n     * a auth revoked (the connection is closed).\r\n     */\nPersistentConnection.prototype.tryAuth=function(){\nvar _this=this;\nif(this.connected_&&this.authToken_){\nvar token_1=this.authToken_;\nvar authMethod=util.isValidFormat(token_1)?'auth':'gauth';\nvar requestData={cred:token_1};\nif(this.authOverride_===null){\nrequestData['noauth']=true;\n}else\nif(_typeof(this.authOverride_)==='object'){\nrequestData['authvar']=this.authOverride_;\n}\nthis.sendRequest(authMethod,requestData,function(res){\nvar status=res[/*status*/'s'];\nvar data=res[/*data*/'d']||'error';\nif(_this.authToken_===token_1){\nif(status==='ok'){\n_this.invalidAuthTokenCount_=0;\n}else\n{\n// Triggers reconnect and force refresh for auth token\n_this.onAuthRevoked_(status,data);\n}\n}\n});\n}\n};\n/**\r\n     * @inheritDoc\r\n     */\nPersistentConnection.prototype.unlisten=function(query,tag){\nvar pathString=query.path.toString();\nvar queryId=query.queryIdentifier();\nthis.log_('Unlisten called for '+pathString+' '+queryId);\nutil.assert(query.getQueryParams().isDefault()||\n!query.getQueryParams().loadsAllData(),'unlisten() called for non-default but complete query');\nvar listen=this.removeListen_(pathString,queryId);\nif(listen&&this.connected_){\nthis.sendUnlisten_(pathString,queryId,query.queryObject(),tag);\n}\n};\nPersistentConnection.prototype.sendUnlisten_=function(pathString,queryId,queryObj,tag){\nthis.log_('Unlisten on '+pathString+' for '+queryId);\nvar req={/*path*/p:pathString};\nvar action='n';\n// Only bother sending queryId if it's non-default.\nif(tag){\nreq['q']=queryObj;\nreq['t']=tag;\n}\nthis.sendRequest(action,req);\n};\n/**\r\n     * @inheritDoc\r\n     */\nPersistentConnection.prototype.onDisconnectPut=function(pathString,data,onComplete){\nif(this.connected_){\nthis.sendOnDisconnect_('o',pathString,data,onComplete);\n}else\n{\nthis.onDisconnectRequestQueue_.push({\npathString:pathString,\naction:'o',\ndata:data,\nonComplete:onComplete});\n\n}\n};\n/**\r\n     * @inheritDoc\r\n     */\nPersistentConnection.prototype.onDisconnectMerge=function(pathString,data,onComplete){\nif(this.connected_){\nthis.sendOnDisconnect_('om',pathString,data,onComplete);\n}else\n{\nthis.onDisconnectRequestQueue_.push({\npathString:pathString,\naction:'om',\ndata:data,\nonComplete:onComplete});\n\n}\n};\n/**\r\n     * @inheritDoc\r\n     */\nPersistentConnection.prototype.onDisconnectCancel=function(pathString,onComplete){\nif(this.connected_){\nthis.sendOnDisconnect_('oc',pathString,null,onComplete);\n}else\n{\nthis.onDisconnectRequestQueue_.push({\npathString:pathString,\naction:'oc',\ndata:null,\nonComplete:onComplete});\n\n}\n};\nPersistentConnection.prototype.sendOnDisconnect_=function(action,pathString,data,onComplete){\nvar request={/*path*/p:pathString,/*data*/d:data};\nthis.log_('onDisconnect '+action,request);\nthis.sendRequest(action,request,function(response){\nif(onComplete){\nsetTimeout(function(){\nonComplete(response[/*status*/'s'],response[/* data */'d']);\n},Math.floor(0));\n}\n});\n};\n/**\r\n     * @inheritDoc\r\n     */\nPersistentConnection.prototype.put=function(pathString,data,onComplete,hash){\nthis.putInternal('p',pathString,data,onComplete,hash);\n};\n/**\r\n     * @inheritDoc\r\n     */\nPersistentConnection.prototype.merge=function(pathString,data,onComplete,hash){\nthis.putInternal('m',pathString,data,onComplete,hash);\n};\nPersistentConnection.prototype.putInternal=function(action,pathString,data,onComplete,hash){\nvar request={\n/*path*/p:pathString,\n/*data*/d:data};\n\nif(hash!==undefined){\nrequest[/*hash*/'h']=hash;\n}\n// TODO: Only keep track of the most recent put for a given path?\nthis.outstandingPuts_.push({\naction:action,\nrequest:request,\nonComplete:onComplete});\n\nthis.outstandingPutCount_++;\nvar index=this.outstandingPuts_.length-1;\nif(this.connected_){\nthis.sendPut_(index);\n}else\n{\nthis.log_('Buffering put: '+pathString);\n}\n};\nPersistentConnection.prototype.sendPut_=function(index){\nvar _this=this;\nvar action=this.outstandingPuts_[index].action;\nvar request=this.outstandingPuts_[index].request;\nvar onComplete=this.outstandingPuts_[index].onComplete;\nthis.outstandingPuts_[index].queued=this.connected_;\nthis.sendRequest(action,request,function(message){\n_this.log_(action+' response',message);\ndelete _this.outstandingPuts_[index];\n_this.outstandingPutCount_--;\n// Clean up array occasionally.\nif(_this.outstandingPutCount_===0){\n_this.outstandingPuts_=[];\n}\nif(onComplete){\nonComplete(message[/*status*/'s'],message[/* data */'d']);\n}\n});\n};\n/**\r\n     * @inheritDoc\r\n     */\nPersistentConnection.prototype.reportStats=function(stats){\nvar _this=this;\n// If we're not connected, we just drop the stats.\nif(this.connected_){\nvar request={/*counters*/c:stats};\nthis.log_('reportStats',request);\nthis.sendRequest(/*stats*/'s',request,function(result){\nvar status=result[/*status*/'s'];\nif(status!=='ok'){\nvar errorReason=result[/* data */'d'];\n_this.log_('reportStats','Error sending stats: '+errorReason);\n}\n});\n}\n};\nPersistentConnection.prototype.onDataMessage_=function(message){\nif('r'in message){\n// this is a response\nthis.log_('from server: '+util.stringify(message));\nvar reqNum=message['r'];\nvar onResponse=this.requestCBHash_[reqNum];\nif(onResponse){\ndelete this.requestCBHash_[reqNum];\nonResponse(message[/*body*/'b']);\n}\n}else\nif('error'in message){\nthrow'A server-side error has occurred: '+message['error'];\n}else\nif('a'in message){\n// a and b are action and body, respectively\nthis.onDataPush_(message['a'],message['b']);\n}\n};\nPersistentConnection.prototype.onDataPush_=function(action,body){\nthis.log_('handleServerMessage',action,body);\nif(action==='d'){\nthis.onDataUpdate_(body[/*path*/'p'],body[/*data*/'d'],\n/*isMerge*/false,body['t']);\n}else\nif(action==='m'){\nthis.onDataUpdate_(body[/*path*/'p'],body[/*data*/'d'],\n/*isMerge=*/true,body['t']);\n}else\nif(action==='c'){\nthis.onListenRevoked_(body[/*path*/'p'],body[/*query*/'q']);\n}else\nif(action==='ac'){\nthis.onAuthRevoked_(body[/*status code*/'s'],body[/* explanation */'d']);\n}else\nif(action==='sd'){\nthis.onSecurityDebugPacket_(body);\n}else\n{\nerror('Unrecognized action received from server: '+\nutil.stringify(action)+\n'\\nAre you using the latest client?');\n}\n};\nPersistentConnection.prototype.onReady_=function(timestamp,sessionId){\nthis.log_('connection ready');\nthis.connected_=true;\nthis.lastConnectionEstablishedTime_=new Date().getTime();\nthis.handleTimestamp_(timestamp);\nthis.lastSessionId=sessionId;\nif(this.firstConnection_){\nthis.sendConnectStats_();\n}\nthis.restoreState_();\nthis.firstConnection_=false;\nthis.onConnectStatus_(true);\n};\nPersistentConnection.prototype.scheduleConnect_=function(timeout){\nvar _this=this;\nutil.assert(!this.realtime_,\"Scheduling a connect when we're already connected/ing?\");\nif(this.establishConnectionTimer_){\nclearTimeout(this.establishConnectionTimer_);\n}\n// NOTE: Even when timeout is 0, it's important to do a setTimeout to work around an infuriating \"Security Error\" in\n// Firefox when trying to write to our long-polling iframe in some scenarios (e.g. Forge or our unit tests).\nthis.establishConnectionTimer_=setTimeout(function(){\n_this.establishConnectionTimer_=null;\n_this.establishConnection_();\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\n},Math.floor(timeout));\n};\nPersistentConnection.prototype.onVisible_=function(visible){\n// NOTE: Tabbing away and back to a window will defeat our reconnect backoff, but I think that's fine.\nif(visible&&\n!this.visible_&&\nthis.reconnectDelay_===this.maxReconnectDelay_){\nthis.log_('Window became visible.  Reducing delay.');\nthis.reconnectDelay_=RECONNECT_MIN_DELAY;\nif(!this.realtime_){\nthis.scheduleConnect_(0);\n}\n}\nthis.visible_=visible;\n};\nPersistentConnection.prototype.onOnline_=function(online){\nif(online){\nthis.log_('Browser went online.');\nthis.reconnectDelay_=RECONNECT_MIN_DELAY;\nif(!this.realtime_){\nthis.scheduleConnect_(0);\n}\n}else\n{\nthis.log_('Browser went offline.  Killing connection.');\nif(this.realtime_){\nthis.realtime_.close();\n}\n}\n};\nPersistentConnection.prototype.onRealtimeDisconnect_=function(){\nthis.log_('data client disconnected');\nthis.connected_=false;\nthis.realtime_=null;\n// Since we don't know if our sent transactions succeeded or not, we need to cancel them.\nthis.cancelSentTransactions_();\n// Clear out the pending requests.\nthis.requestCBHash_={};\nif(this.shouldReconnect_()){\nif(!this.visible_){\nthis.log_(\"Window isn't visible.  Delaying reconnect.\");\nthis.reconnectDelay_=this.maxReconnectDelay_;\nthis.lastConnectionAttemptTime_=new Date().getTime();\n}else\nif(this.lastConnectionEstablishedTime_){\n// If we've been connected long enough, reset reconnect delay to minimum.\nvar timeSinceLastConnectSucceeded=new Date().getTime()-this.lastConnectionEstablishedTime_;\nif(timeSinceLastConnectSucceeded>RECONNECT_DELAY_RESET_TIMEOUT){\nthis.reconnectDelay_=RECONNECT_MIN_DELAY;\n}\nthis.lastConnectionEstablishedTime_=null;\n}\nvar timeSinceLastConnectAttempt=new Date().getTime()-this.lastConnectionAttemptTime_;\nvar reconnectDelay=Math.max(0,this.reconnectDelay_-timeSinceLastConnectAttempt);\nreconnectDelay=Math.random()*reconnectDelay;\nthis.log_('Trying to reconnect in '+reconnectDelay+'ms');\nthis.scheduleConnect_(reconnectDelay);\n// Adjust reconnect delay for next time.\nthis.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*RECONNECT_DELAY_MULTIPLIER);\n}\nthis.onConnectStatus_(false);\n};\nPersistentConnection.prototype.establishConnection_=function(){\nvar _this=this;\nif(this.shouldReconnect_()){\nthis.log_('Making a connection attempt');\nthis.lastConnectionAttemptTime_=new Date().getTime();\nthis.lastConnectionEstablishedTime_=null;\nvar onDataMessage_1=this.onDataMessage_.bind(this);\nvar onReady_1=this.onReady_.bind(this);\nvar onDisconnect_1=this.onRealtimeDisconnect_.bind(this);\nvar connId_1=this.id+':'+PersistentConnection.nextConnectionId_++;\nvar self_1=this;\nvar lastSessionId_1=this.lastSessionId;\nvar canceled_1=false;\nvar connection_1=null;\nvar closeFn_1=function closeFn_1(){\nif(connection_1){\nconnection_1.close();\n}else\n{\ncanceled_1=true;\nonDisconnect_1();\n}\n};\nvar sendRequestFn=function sendRequestFn(msg){\nutil.assert(connection_1,\"sendRequest call when we're not connected not allowed.\");\nconnection_1.sendRequest(msg);\n};\nthis.realtime_={\nclose:closeFn_1,\nsendRequest:sendRequestFn};\n\nvar forceRefresh=this.forceTokenRefresh_;\nthis.forceTokenRefresh_=false;\n// First fetch auth token, and establish connection after fetching the token was successful\nthis.authTokenProvider_.\ngetToken(forceRefresh).\nthen(function(result){\nif(!canceled_1){\nlog('getToken() completed. Creating connection.');\nself_1.authToken_=result&&result.accessToken;\nconnection_1=new Connection(connId_1,self_1.repoInfo_,self_1.applicationId_,onDataMessage_1,onReady_1,onDisconnect_1,\n/* onKill= */function(reason){\nwarn(reason+' ('+self_1.repoInfo_.toString()+')');\nself_1.interrupt(SERVER_KILL_INTERRUPT_REASON);\n},lastSessionId_1);\n}else\n{\nlog('getToken() completed but was canceled');\n}\n}).\nthen(null,function(error){\nself_1.log_('Failed to get token: '+error);\nif(!canceled_1){\nif(_this.repoInfo_.nodeAdmin){\n// This may be a critical error for the Admin Node.js SDK, so log a warning.\n// But getToken() may also just have temporarily failed, so we still want to\n// continue retrying.\nwarn(error);\n}\ncloseFn_1();\n}\n});\n}\n};\nPersistentConnection.prototype.interrupt=function(reason){\nlog('Interrupting connection for reason: '+reason);\nthis.interruptReasons_[reason]=true;\nif(this.realtime_){\nthis.realtime_.close();\n}else\n{\nif(this.establishConnectionTimer_){\nclearTimeout(this.establishConnectionTimer_);\nthis.establishConnectionTimer_=null;\n}\nif(this.connected_){\nthis.onRealtimeDisconnect_();\n}\n}\n};\nPersistentConnection.prototype.resume=function(reason){\nlog('Resuming connection for reason: '+reason);\ndelete this.interruptReasons_[reason];\nif(util.isEmpty(this.interruptReasons_)){\nthis.reconnectDelay_=RECONNECT_MIN_DELAY;\nif(!this.realtime_){\nthis.scheduleConnect_(0);\n}\n}\n};\nPersistentConnection.prototype.handleTimestamp_=function(timestamp){\nvar delta=timestamp-new Date().getTime();\nthis.onServerInfoUpdate_({serverTimeOffset:delta});\n};\nPersistentConnection.prototype.cancelSentTransactions_=function(){\nfor(var i=0;i<this.outstandingPuts_.length;i++){\nvar put=this.outstandingPuts_[i];\nif(put&&/*hash*/'h'in put.request&&put.queued){\nif(put.onComplete){\nput.onComplete('disconnect');\n}\ndelete this.outstandingPuts_[i];\nthis.outstandingPutCount_--;\n}\n}\n// Clean up array occasionally.\nif(this.outstandingPutCount_===0){\nthis.outstandingPuts_=[];\n}\n};\nPersistentConnection.prototype.onListenRevoked_=function(pathString,query){\n// Remove the listen and manufacture a \"permission_denied\" error for the failed listen.\nvar queryId;\nif(!query){\nqueryId='default';\n}else\n{\nqueryId=query.map(function(q){return ObjectToUniqueKey(q);}).join('$');\n}\nvar listen=this.removeListen_(pathString,queryId);\nif(listen&&listen.onComplete){\nlisten.onComplete('permission_denied');\n}\n};\nPersistentConnection.prototype.removeListen_=function(pathString,queryId){\nvar normalizedPathString=new Path(pathString).toString();// normalize path.\nvar listen;\nif(this.listens.has(normalizedPathString)){\nvar map=this.listens.get(normalizedPathString);\nlisten=map.get(queryId);\nmap.delete(queryId);\nif(map.size===0){\nthis.listens.delete(normalizedPathString);\n}\n}else\n{\n// all listens for this path has already been removed\nlisten=undefined;\n}\nreturn listen;\n};\nPersistentConnection.prototype.onAuthRevoked_=function(statusCode,explanation){\nlog('Auth token revoked: '+statusCode+'/'+explanation);\nthis.authToken_=null;\nthis.forceTokenRefresh_=true;\nthis.realtime_.close();\nif(statusCode==='invalid_token'||statusCode==='permission_denied'){\n// We'll wait a couple times before logging the warning / increasing the\n// retry period since oauth tokens will report as \"invalid\" if they're\n// just expired. Plus there may be transient issues that resolve themselves.\nthis.invalidAuthTokenCount_++;\nif(this.invalidAuthTokenCount_>=INVALID_AUTH_TOKEN_THRESHOLD){\n// Set a long reconnect delay because recovery is unlikely\nthis.reconnectDelay_=RECONNECT_MAX_DELAY_FOR_ADMINS;\n// Notify the auth token provider that the token is invalid, which will log\n// a warning\nthis.authTokenProvider_.notifyForInvalidToken();\n}\n}\n};\nPersistentConnection.prototype.onSecurityDebugPacket_=function(body){\nif(this.securityDebugCallback_){\nthis.securityDebugCallback_(body);\n}else\n{\nif('msg'in body){\nconsole.log('FIREBASE: '+body['msg'].replace('\\n','\\nFIREBASE: '));\n}\n}\n};\nPersistentConnection.prototype.restoreState_=function(){\nvar e_1,_a,e_2,_b;\n//Re-authenticate ourselves if we have a credential stored.\nthis.tryAuth();\ntry{\n// Puts depend on having received the corresponding data update from the server before they complete, so we must\n// make sure to send listens before puts.\nfor(var _c=tslib.__values(this.listens.values()),_d=_c.next();!_d.done;_d=_c.next()){\nvar queries=_d.value;\ntry{\nfor(var _e=(e_2=void 0,tslib.__values(queries.values())),_f=_e.next();!_f.done;_f=_e.next()){\nvar listenSpec=_f.value;\nthis.sendListen_(listenSpec);\n}\n}\ncatch(e_2_1){e_2={error:e_2_1};}finally\n{\ntry{\nif(_f&&!_f.done&&(_b=_e.return))_b.call(_e);\n}finally\n{if(e_2)throw e_2.error;}\n}\n}\n}\ncatch(e_1_1){e_1={error:e_1_1};}finally\n{\ntry{\nif(_d&&!_d.done&&(_a=_c.return))_a.call(_c);\n}finally\n{if(e_1)throw e_1.error;}\n}\nfor(var i=0;i<this.outstandingPuts_.length;i++){\nif(this.outstandingPuts_[i]){\nthis.sendPut_(i);\n}\n}\nwhile(this.onDisconnectRequestQueue_.length){\nvar request=this.onDisconnectRequestQueue_.shift();\nthis.sendOnDisconnect_(request.action,request.pathString,request.data,request.onComplete);\n}\n};\n/**\r\n     * Sends client stats for first connection\r\n     */\nPersistentConnection.prototype.sendConnectStats_=function(){\nvar stats={};\nvar clientName='js';\nif(util.isNodeSdk()){\nif(this.repoInfo_.nodeAdmin){\nclientName='admin_node';\n}else\n{\nclientName='node';\n}\n}\nstats['sdk.'+clientName+'.'+SDK_VERSION.replace(/\\./g,'-')]=1;\nif(util.isMobileCordova()){\nstats['framework.cordova']=1;\n}else\nif(util.isReactNative()){\nstats['framework.reactnative']=1;\n}\nthis.reportStats(stats);\n};\nPersistentConnection.prototype.shouldReconnect_=function(){\nvar online=OnlineMonitor.getInstance().currentlyOnline();\nreturn util.isEmpty(this.interruptReasons_)&&online;\n};\nPersistentConnection.nextPersistentConnectionId_=0;\n/**\r\n     * Counter for number of connections created. Mainly used for tagging in the logs\r\n     */\nPersistentConnection.nextConnectionId_=0;\nreturn PersistentConnection;\n}(ServerActions);\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n/**\r\n * An implementation of ServerActions that communicates with the server via REST requests.\r\n * This is mostly useful for compatibility with crawlers, where we don't want to spin up a full\r\n * persistent connection (using WebSockets or long-polling)\r\n */\nvar ReadonlyRestClient=/** @class */function(_super){\ntslib.__extends(ReadonlyRestClient,_super);\n/**\r\n     * @param {!RepoInfo} repoInfo_ Data about the namespace we are connecting to\r\n     * @param {function(string, *, boolean, ?number)} onDataUpdate_ A callback for new data from the server\r\n     * @param {AuthTokenProvider} authTokenProvider_\r\n     * @implements {ServerActions}\r\n     */\nfunction ReadonlyRestClient(repoInfo_,onDataUpdate_,authTokenProvider_){\nvar _this=_super.call(this)||this;\n_this.repoInfo_=repoInfo_;\n_this.onDataUpdate_=onDataUpdate_;\n_this.authTokenProvider_=authTokenProvider_;\n/** @private {function(...[*])} */\n_this.log_=logWrapper('p:rest:');\n/**\r\n         * We don't actually need to track listens, except to prevent us calling an onComplete for a listen\r\n         * that's been removed. :-/\r\n         *\r\n         * @private {!Object.<string, !Object>}\r\n         */\n_this.listens_={};\nreturn _this;\n}\nReadonlyRestClient.prototype.reportStats=function(stats){\nthrow new Error('Method not implemented.');\n};\n/**\r\n     * @param {!Query} query\r\n     * @param {?number=} tag\r\n     * @return {string}\r\n     * @private\r\n     */\nReadonlyRestClient.getListenId_=function(query,tag){\nif(tag!==undefined){\nreturn'tag$'+tag;\n}else\n{\nutil.assert(query.getQueryParams().isDefault(),\"should have a tag if it's not a default query.\");\nreturn query.path.toString();\n}\n};\n/** @inheritDoc */\nReadonlyRestClient.prototype.listen=function(query,currentHashFn,tag,onComplete){\nvar _this=this;\nvar pathString=query.path.toString();\nthis.log_('Listen called for '+pathString+' '+query.queryIdentifier());\n// Mark this listener so we can tell if it's removed.\nvar listenId=ReadonlyRestClient.getListenId_(query,tag);\nvar thisListen={};\nthis.listens_[listenId]=thisListen;\nvar queryStringParameters=query.\ngetQueryParams().\ntoRestQueryStringParameters();\nthis.restRequest_(pathString+'.json',queryStringParameters,function(error,result){\nvar data=result;\nif(error===404){\ndata=null;\nerror=null;\n}\nif(error===null){\n_this.onDataUpdate_(pathString,data,/*isMerge=*/false,tag);\n}\nif(util.safeGet(_this.listens_,listenId)===thisListen){\nvar status_1;\nif(!error){\nstatus_1='ok';\n}else\nif(error===401){\nstatus_1='permission_denied';\n}else\n{\nstatus_1='rest_error:'+error;\n}\nonComplete(status_1,null);\n}\n});\n};\n/** @inheritDoc */\nReadonlyRestClient.prototype.unlisten=function(query,tag){\nvar listenId=ReadonlyRestClient.getListenId_(query,tag);\ndelete this.listens_[listenId];\n};\n/** @inheritDoc */\nReadonlyRestClient.prototype.refreshAuthToken=function(token){\n// no-op since we just always call getToken.\n};\n/**\r\n     * Performs a REST request to the given path, with the provided query string parameters,\r\n     * and any auth credentials we have.\r\n     *\r\n     * @param {!string} pathString\r\n     * @param {!Object.<string, *>} queryStringParameters\r\n     * @param {?function(?number, *=)} callback\r\n     * @private\r\n     */\nReadonlyRestClient.prototype.restRequest_=function(pathString,queryStringParameters,callback){\nvar _this=this;\nif(queryStringParameters===void 0){queryStringParameters={};}\nqueryStringParameters['format']='export';\nthis.authTokenProvider_.\ngetToken(/*forceRefresh=*/false).\nthen(function(authTokenData){\nvar authToken=authTokenData&&authTokenData.accessToken;\nif(authToken){\nqueryStringParameters['auth']=authToken;\n}\nvar url=(_this.repoInfo_.secure?'https://':'http://')+\n_this.repoInfo_.host+\npathString+\n'?'+\n'ns='+\n_this.repoInfo_.namespace+\nutil.querystring(queryStringParameters);\n_this.log_('Sending REST request for '+url);\nvar xhr=new XMLHttpRequest();\nxhr.onreadystatechange=function(){\nif(callback&&xhr.readyState===4){\n_this.log_('REST Response for '+url+' received. status:',xhr.status,'response:',xhr.responseText);\nvar res=null;\nif(xhr.status>=200&&xhr.status<300){\ntry{\nres=util.jsonEval(xhr.responseText);\n}\ncatch(e){\nwarn('Failed to parse JSON response for '+\nurl+\n': '+\nxhr.responseText);\n}\ncallback(null,res);\n}else\n{\n// 401 and 404 are expected.\nif(xhr.status!==401&&xhr.status!==404){\nwarn('Got unsuccessful REST response for '+\nurl+\n' Status: '+\nxhr.status);\n}\ncallback(xhr.status);\n}\ncallback=null;\n}\n};\nxhr.open('GET',url,/*asynchronous=*/true);\nxhr.send();\n});\n};\nreturn ReadonlyRestClient;\n}(ServerActions);\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\nvar INTERRUPT_REASON='repo_interrupt';\n/**\r\n * A connection to a single data repository.\r\n */\nvar Repo=/** @class */function(){\nfunction Repo(repoInfo_,forceRestClient,app,authTokenProvider){\nvar _this=this;\nthis.repoInfo_=repoInfo_;\nthis.app=app;\nthis.dataUpdateCount=0;\nthis.statsListener_=null;\nthis.eventQueue_=new EventQueue();\nthis.nextWriteId_=1;\nthis.interceptServerDataCallback_=null;\n/** A list of data pieces and paths to be set when this client disconnects. */\nthis.onDisconnect_=new SparseSnapshotTree();\n// TODO: This should be @private but it's used by test_access.js and internal.js\nthis.persistentConnection_=null;\nthis.stats_=StatsManager.getCollection(repoInfo_);\nif(forceRestClient||beingCrawled()){\nthis.server_=new ReadonlyRestClient(this.repoInfo_,this.onDataUpdate_.bind(this),authTokenProvider);\n// Minor hack: Fire onConnect immediately, since there's no actual connection.\nsetTimeout(this.onConnectStatus_.bind(this,true),0);\n}else\n{\nvar authOverride=app.options['databaseAuthVariableOverride'];\n// Validate authOverride\nif(typeof authOverride!=='undefined'&&authOverride!==null){\nif((typeof authOverride==='undefined'?'undefined':_typeof(authOverride))!=='object'){\nthrow new Error('Only objects are supported for option databaseAuthVariableOverride');\n}\ntry{\nutil.stringify(authOverride);\n}\ncatch(e){\nthrow new Error('Invalid authOverride provided: '+e);\n}\n}\nthis.persistentConnection_=new PersistentConnection(this.repoInfo_,app.options.appId,this.onDataUpdate_.bind(this),this.onConnectStatus_.bind(this),this.onServerInfoUpdate_.bind(this),authTokenProvider,authOverride);\nthis.server_=this.persistentConnection_;\n}\nauthTokenProvider.addTokenChangeListener(function(token){\n_this.server_.refreshAuthToken(token);\n});\n// In the case of multiple Repos for the same repoInfo (i.e. there are multiple Firebase.Contexts being used),\n// we only want to create one StatsReporter.  As such, we'll report stats over the first Repo created.\nthis.statsReporter_=StatsManager.getOrCreateReporter(repoInfo_,function(){return new StatsReporter(_this.stats_,_this.server_);});\nthis.transactionsInit_();\n// Used for .info.\nthis.infoData_=new SnapshotHolder();\nthis.infoSyncTree_=new SyncTree({\nstartListening:function startListening(query,tag,currentHashFn,onComplete){\nvar infoEvents=[];\nvar node=_this.infoData_.getNode(query.path);\n// This is possibly a hack, but we have different semantics for .info endpoints. We don't raise null events\n// on initial data...\nif(!node.isEmpty()){\ninfoEvents=_this.infoSyncTree_.applyServerOverwrite(query.path,node);\nsetTimeout(function(){\nonComplete('ok');\n},0);\n}\nreturn infoEvents;\n},\nstopListening:function stopListening(){}});\n\nthis.updateInfo_('connected',false);\nthis.serverSyncTree_=new SyncTree({\nstartListening:function startListening(query,tag,currentHashFn,onComplete){\n_this.server_.listen(query,currentHashFn,tag,function(status,data){\nvar events=onComplete(status,data);\n_this.eventQueue_.raiseEventsForChangedPath(query.path,events);\n});\n// No synchronous events for network-backed sync trees\nreturn[];\n},\nstopListening:function stopListening(query,tag){\n_this.server_.unlisten(query,tag);\n}});\n\n}\n/**\r\n     * @return The URL corresponding to the root of this Firebase.\r\n     */\nRepo.prototype.toString=function(){\nreturn(this.repoInfo_.secure?'https://':'http://')+this.repoInfo_.host;\n};\n/**\r\n     * @return The namespace represented by the repo.\r\n     */\nRepo.prototype.name=function(){\nreturn this.repoInfo_.namespace;\n};\n/**\r\n     * @return The time in milliseconds, taking the server offset into account if we have one.\r\n     */\nRepo.prototype.serverTime=function(){\nvar offsetNode=this.infoData_.getNode(new Path('.info/serverTimeOffset'));\nvar offset=offsetNode.val()||0;\nreturn new Date().getTime()+offset;\n};\n/**\r\n     * Generate ServerValues using some variables from the repo object.\r\n     */\nRepo.prototype.generateServerValues=function(){\nreturn generateWithValues({\ntimestamp:this.serverTime()});\n\n};\n/**\r\n     * Called by realtime when we get new messages from the server.\r\n     */\nRepo.prototype.onDataUpdate_=function(pathString,data,isMerge,tag){\n// For testing.\nthis.dataUpdateCount++;\nvar path=new Path(pathString);\ndata=this.interceptServerDataCallback_?\nthis.interceptServerDataCallback_(pathString,data):\ndata;\nvar events=[];\nif(tag){\nif(isMerge){\nvar taggedChildren=util.map(data,function(raw){return nodeFromJSON$1(raw);});\nevents=this.serverSyncTree_.applyTaggedQueryMerge(path,taggedChildren,tag);\n}else\n{\nvar taggedSnap=nodeFromJSON$1(data);\nevents=this.serverSyncTree_.applyTaggedQueryOverwrite(path,taggedSnap,tag);\n}\n}else\nif(isMerge){\nvar changedChildren=util.map(data,function(raw){return nodeFromJSON$1(raw);});\nevents=this.serverSyncTree_.applyServerMerge(path,changedChildren);\n}else\n{\nvar snap=nodeFromJSON$1(data);\nevents=this.serverSyncTree_.applyServerOverwrite(path,snap);\n}\nvar affectedPath=path;\nif(events.length>0){\n// Since we have a listener outstanding for each transaction, receiving any events\n// is a proxy for some change having occurred.\naffectedPath=this.rerunTransactions_(path);\n}\nthis.eventQueue_.raiseEventsForChangedPath(affectedPath,events);\n};\n// TODO: This should be @private but it's used by test_access.js and internal.js\nRepo.prototype.interceptServerData_=function(callback){\nthis.interceptServerDataCallback_=callback;\n};\nRepo.prototype.onConnectStatus_=function(connectStatus){\nthis.updateInfo_('connected',connectStatus);\nif(connectStatus===false){\nthis.runOnDisconnectEvents_();\n}\n};\nRepo.prototype.onServerInfoUpdate_=function(updates){\nvar _this=this;\neach(updates,function(key,value){\n_this.updateInfo_(key,value);\n});\n};\nRepo.prototype.updateInfo_=function(pathString,value){\nvar path=new Path('/.info/'+pathString);\nvar newNode=nodeFromJSON$1(value);\nthis.infoData_.updateSnapshot(path,newNode);\nvar events=this.infoSyncTree_.applyServerOverwrite(path,newNode);\nthis.eventQueue_.raiseEventsForChangedPath(path,events);\n};\nRepo.prototype.getNextWriteId_=function(){\nreturn this.nextWriteId_++;\n};\nRepo.prototype.setWithPriority=function(path,newVal,newPriority,onComplete){\nvar _this=this;\nthis.log_('set',{\npath:path.toString(),\nvalue:newVal,\npriority:newPriority});\n\n// TODO: Optimize this behavior to either (a) store flag to skip resolving where possible and / or\n// (b) store unresolved paths on JSON parse\nvar serverValues=this.generateServerValues();\nvar newNodeUnresolved=nodeFromJSON$1(newVal,newPriority);\nvar existing=this.serverSyncTree_.calcCompleteEventCache(path);\nvar newNode=resolveDeferredValueSnapshot(newNodeUnresolved,existing,serverValues);\nvar writeId=this.getNextWriteId_();\nvar events=this.serverSyncTree_.applyUserOverwrite(path,newNode,writeId,true);\nthis.eventQueue_.queueEvents(events);\nthis.server_.put(path.toString(),newNodeUnresolved.val(/*export=*/true),function(status,errorReason){\nvar success=status==='ok';\nif(!success){\nwarn('set at '+path+' failed: '+status);\n}\nvar clearEvents=_this.serverSyncTree_.ackUserWrite(writeId,!success);\n_this.eventQueue_.raiseEventsForChangedPath(path,clearEvents);\n_this.callOnCompleteCallback(onComplete,status,errorReason);\n});\nvar affectedPath=this.abortTransactions_(path);\nthis.rerunTransactions_(affectedPath);\n// We queued the events above, so just flush the queue here\nthis.eventQueue_.raiseEventsForChangedPath(affectedPath,[]);\n};\nRepo.prototype.update=function(path,childrenToMerge,onComplete){\nvar _this=this;\nthis.log_('update',{path:path.toString(),value:childrenToMerge});\n// Start with our existing data and merge each child into it.\nvar empty=true;\nvar serverValues=this.generateServerValues();\nvar changedChildren={};\neach(childrenToMerge,function(changedKey,changedValue){\nempty=false;\nchangedChildren[changedKey]=resolveDeferredValueTree(path.child(changedKey),nodeFromJSON$1(changedValue),_this.serverSyncTree_,serverValues);\n});\nif(!empty){\nvar writeId_1=this.getNextWriteId_();\nvar events=this.serverSyncTree_.applyUserMerge(path,changedChildren,writeId_1);\nthis.eventQueue_.queueEvents(events);\nthis.server_.merge(path.toString(),childrenToMerge,function(status,errorReason){\nvar success=status==='ok';\nif(!success){\nwarn('update at '+path+' failed: '+status);\n}\nvar clearEvents=_this.serverSyncTree_.ackUserWrite(writeId_1,!success);\nvar affectedPath=clearEvents.length>0?_this.rerunTransactions_(path):path;\n_this.eventQueue_.raiseEventsForChangedPath(affectedPath,clearEvents);\n_this.callOnCompleteCallback(onComplete,status,errorReason);\n});\neach(childrenToMerge,function(changedPath){\nvar affectedPath=_this.abortTransactions_(path.child(changedPath));\n_this.rerunTransactions_(affectedPath);\n});\n// We queued the events above, so just flush the queue here\nthis.eventQueue_.raiseEventsForChangedPath(path,[]);\n}else\n{\nlog(\"update() called with empty data.  Don't do anything.\");\nthis.callOnCompleteCallback(onComplete,'ok');\n}\n};\n/**\r\n     * Applies all of the changes stored up in the onDisconnect_ tree.\r\n     */\nRepo.prototype.runOnDisconnectEvents_=function(){\nvar _this=this;\nthis.log_('onDisconnectEvents');\nvar serverValues=this.generateServerValues();\nvar resolvedOnDisconnectTree=new SparseSnapshotTree();\nthis.onDisconnect_.forEachTree(Path.Empty,function(path,node){\nvar resolved=resolveDeferredValueTree(path,node,_this.serverSyncTree_,serverValues);\nresolvedOnDisconnectTree.remember(path,resolved);\n});\nvar events=[];\nresolvedOnDisconnectTree.forEachTree(Path.Empty,function(path,snap){\nevents=events.concat(_this.serverSyncTree_.applyServerOverwrite(path,snap));\nvar affectedPath=_this.abortTransactions_(path);\n_this.rerunTransactions_(affectedPath);\n});\nthis.onDisconnect_=new SparseSnapshotTree();\nthis.eventQueue_.raiseEventsForChangedPath(Path.Empty,events);\n};\nRepo.prototype.onDisconnectCancel=function(path,onComplete){\nvar _this=this;\nthis.server_.onDisconnectCancel(path.toString(),function(status,errorReason){\nif(status==='ok'){\n_this.onDisconnect_.forget(path);\n}\n_this.callOnCompleteCallback(onComplete,status,errorReason);\n});\n};\nRepo.prototype.onDisconnectSet=function(path,value,onComplete){\nvar _this=this;\nvar newNode=nodeFromJSON$1(value);\nthis.server_.onDisconnectPut(path.toString(),newNode.val(/*export=*/true),function(status,errorReason){\nif(status==='ok'){\n_this.onDisconnect_.remember(path,newNode);\n}\n_this.callOnCompleteCallback(onComplete,status,errorReason);\n});\n};\nRepo.prototype.onDisconnectSetWithPriority=function(path,value,priority,onComplete){\nvar _this=this;\nvar newNode=nodeFromJSON$1(value,priority);\nthis.server_.onDisconnectPut(path.toString(),newNode.val(/*export=*/true),function(status,errorReason){\nif(status==='ok'){\n_this.onDisconnect_.remember(path,newNode);\n}\n_this.callOnCompleteCallback(onComplete,status,errorReason);\n});\n};\nRepo.prototype.onDisconnectUpdate=function(path,childrenToMerge,onComplete){\nvar _this=this;\nif(util.isEmpty(childrenToMerge)){\nlog(\"onDisconnect().update() called with empty data.  Don't do anything.\");\nthis.callOnCompleteCallback(onComplete,'ok');\nreturn;\n}\nthis.server_.onDisconnectMerge(path.toString(),childrenToMerge,function(status,errorReason){\nif(status==='ok'){\neach(childrenToMerge,function(childName,childNode){\nvar newChildNode=nodeFromJSON$1(childNode);\n_this.onDisconnect_.remember(path.child(childName),newChildNode);\n});\n}\n_this.callOnCompleteCallback(onComplete,status,errorReason);\n});\n};\nRepo.prototype.addEventCallbackForQuery=function(query,eventRegistration){\nvar events;\nif(query.path.getFront()==='.info'){\nevents=this.infoSyncTree_.addEventRegistration(query,eventRegistration);\n}else\n{\nevents=this.serverSyncTree_.addEventRegistration(query,eventRegistration);\n}\nthis.eventQueue_.raiseEventsAtPath(query.path,events);\n};\nRepo.prototype.removeEventCallbackForQuery=function(query,eventRegistration){\n// These are guaranteed not to raise events, since we're not passing in a cancelError. However, we can future-proof\n// a little bit by handling the return values anyways.\nvar events;\nif(query.path.getFront()==='.info'){\nevents=this.infoSyncTree_.removeEventRegistration(query,eventRegistration);\n}else\n{\nevents=this.serverSyncTree_.removeEventRegistration(query,eventRegistration);\n}\nthis.eventQueue_.raiseEventsAtPath(query.path,events);\n};\nRepo.prototype.interrupt=function(){\nif(this.persistentConnection_){\nthis.persistentConnection_.interrupt(INTERRUPT_REASON);\n}\n};\nRepo.prototype.resume=function(){\nif(this.persistentConnection_){\nthis.persistentConnection_.resume(INTERRUPT_REASON);\n}\n};\nRepo.prototype.stats=function(showDelta){\nif(showDelta===void 0){showDelta=false;}\nif(typeof console==='undefined'){\nreturn;\n}\nvar stats;\nif(showDelta){\nif(!this.statsListener_){\nthis.statsListener_=new StatsListener(this.stats_);\n}\nstats=this.statsListener_.get();\n}else\n{\nstats=this.stats_.get();\n}\nvar longestName=Object.keys(stats).reduce(function(previousValue,currentValue){\nreturn Math.max(currentValue.length,previousValue);\n},0);\neach(stats,function(stat,value){\nvar paddedStat=stat;\n// pad stat names to be the same length (plus 2 extra spaces).\nfor(var i=stat.length;i<longestName+2;i++){\npaddedStat+=' ';\n}\nconsole.log(paddedStat+value);\n});\n};\nRepo.prototype.statsIncrementCounter=function(metric){\nthis.stats_.incrementCounter(metric);\nthis.statsReporter_.includeStat(metric);\n};\nRepo.prototype.log_=function(){\nvar varArgs=[];\nfor(var _i=0;_i<arguments.length;_i++){\nvarArgs[_i]=arguments[_i];\n}\nvar prefix='';\nif(this.persistentConnection_){\nprefix=this.persistentConnection_.id+':';\n}\nlog.apply(void 0,tslib.__spread([prefix],varArgs));\n};\nRepo.prototype.callOnCompleteCallback=function(callback,status,errorReason){\nif(callback){\nexceptionGuard(function(){\nif(status==='ok'){\ncallback(null);\n}else\n{\nvar code=(status||'error').toUpperCase();\nvar message=code;\nif(errorReason){\nmessage+=': '+errorReason;\n}\nvar error=new Error(message);\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nerror.code=code;\ncallback(error);\n}\n});\n}\n};\nObject.defineProperty(Repo.prototype,\"database\",{\nget:function get(){\nreturn this.__database||(this.__database=new Database(this));\n},\nenumerable:false,\nconfigurable:true});\n\nreturn Repo;\n}();\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n/**\r\n * Filters nodes by range and uses an IndexFilter to track any changes after filtering the node\r\n *\r\n * @constructor\r\n * @implements {NodeFilter}\r\n */\nvar RangedFilter=/** @class */function(){\n/**\r\n     * @param {!QueryParams} params\r\n     */\nfunction RangedFilter(params){\nthis.indexedFilter_=new IndexedFilter(params.getIndex());\nthis.index_=params.getIndex();\nthis.startPost_=RangedFilter.getStartPost_(params);\nthis.endPost_=RangedFilter.getEndPost_(params);\n}\n/**\r\n     * @return {!NamedNode}\r\n     */\nRangedFilter.prototype.getStartPost=function(){\nreturn this.startPost_;\n};\n/**\r\n     * @return {!NamedNode}\r\n     */\nRangedFilter.prototype.getEndPost=function(){\nreturn this.endPost_;\n};\n/**\r\n     * @param {!NamedNode} node\r\n     * @return {boolean}\r\n     */\nRangedFilter.prototype.matches=function(node){\nreturn this.index_.compare(this.getStartPost(),node)<=0&&\nthis.index_.compare(node,this.getEndPost())<=0;\n};\n/**\r\n     * @inheritDoc\r\n     */\nRangedFilter.prototype.updateChild=function(snap,key,newChild,affectedPath,source,optChangeAccumulator){\nif(!this.matches(new NamedNode(key,newChild))){\nnewChild=ChildrenNode.EMPTY_NODE;\n}\nreturn this.indexedFilter_.updateChild(snap,key,newChild,affectedPath,source,optChangeAccumulator);\n};\n/**\r\n     * @inheritDoc\r\n     */\nRangedFilter.prototype.updateFullNode=function(oldSnap,newSnap,optChangeAccumulator){\nif(newSnap.isLeafNode()){\n// Make sure we have a children node with the correct index, not a leaf node;\nnewSnap=ChildrenNode.EMPTY_NODE;\n}\nvar filtered=newSnap.withIndex(this.index_);\n// Don't support priorities on queries\nfiltered=filtered.updatePriority(ChildrenNode.EMPTY_NODE);\nvar self=this;\nnewSnap.forEachChild(PRIORITY_INDEX,function(key,childNode){\nif(!self.matches(new NamedNode(key,childNode))){\nfiltered=filtered.updateImmediateChild(key,ChildrenNode.EMPTY_NODE);\n}\n});\nreturn this.indexedFilter_.updateFullNode(oldSnap,filtered,optChangeAccumulator);\n};\n/**\r\n     * @inheritDoc\r\n     */\nRangedFilter.prototype.updatePriority=function(oldSnap,newPriority){\n// Don't support priorities on queries\nreturn oldSnap;\n};\n/**\r\n     * @inheritDoc\r\n     */\nRangedFilter.prototype.filtersNodes=function(){\nreturn true;\n};\n/**\r\n     * @inheritDoc\r\n     */\nRangedFilter.prototype.getIndexedFilter=function(){\nreturn this.indexedFilter_;\n};\n/**\r\n     * @inheritDoc\r\n     */\nRangedFilter.prototype.getIndex=function(){\nreturn this.index_;\n};\n/**\r\n     * @param {!QueryParams} params\r\n     * @return {!NamedNode}\r\n     * @private\r\n     */\nRangedFilter.getStartPost_=function(params){\nif(params.hasStart()){\nvar startName=params.getIndexStartName();\nreturn params.getIndex().makePost(params.getIndexStartValue(),startName);\n}else\n{\nreturn params.getIndex().minPost();\n}\n};\n/**\r\n     * @param {!QueryParams} params\r\n     * @return {!NamedNode}\r\n     * @private\r\n     */\nRangedFilter.getEndPost_=function(params){\nif(params.hasEnd()){\nvar endName=params.getIndexEndName();\nreturn params.getIndex().makePost(params.getIndexEndValue(),endName);\n}else\n{\nreturn params.getIndex().maxPost();\n}\n};\nreturn RangedFilter;\n}();\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n/**\r\n * Applies a limit and a range to a node and uses RangedFilter to do the heavy lifting where possible\r\n *\r\n * @constructor\r\n * @implements {NodeFilter}\r\n */\nvar LimitedFilter=/** @class */function(){\n/**\r\n     * @param {!QueryParams} params\r\n     */\nfunction LimitedFilter(params){\nthis.rangedFilter_=new RangedFilter(params);\nthis.index_=params.getIndex();\nthis.limit_=params.getLimit();\nthis.reverse_=!params.isViewFromLeft();\n}\n/**\r\n     * @inheritDoc\r\n     */\nLimitedFilter.prototype.updateChild=function(snap,key,newChild,affectedPath,source,optChangeAccumulator){\nif(!this.rangedFilter_.matches(new NamedNode(key,newChild))){\nnewChild=ChildrenNode.EMPTY_NODE;\n}\nif(snap.getImmediateChild(key).equals(newChild)){\n// No change\nreturn snap;\n}else\nif(snap.numChildren()<this.limit_){\nreturn this.rangedFilter_.\ngetIndexedFilter().\nupdateChild(snap,key,newChild,affectedPath,source,optChangeAccumulator);\n}else\n{\nreturn this.fullLimitUpdateChild_(snap,key,newChild,source,optChangeAccumulator);\n}\n};\n/**\r\n     * @inheritDoc\r\n     */\nLimitedFilter.prototype.updateFullNode=function(oldSnap,newSnap,optChangeAccumulator){\nvar filtered;\nif(newSnap.isLeafNode()||newSnap.isEmpty()){\n// Make sure we have a children node with the correct index, not a leaf node;\nfiltered=ChildrenNode.EMPTY_NODE.withIndex(this.index_);\n}else\n{\nif(this.limit_*2<newSnap.numChildren()&&\nnewSnap.isIndexed(this.index_)){\n// Easier to build up a snapshot, since what we're given has more than twice the elements we want\nfiltered=ChildrenNode.EMPTY_NODE.withIndex(this.index_);\n// anchor to the startPost, endPost, or last element as appropriate\nvar iterator=void 0;\nif(this.reverse_){\niterator=newSnap.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_);\n}else\n{\niterator=newSnap.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);\n}\nvar count=0;\nwhile(iterator.hasNext()&&count<this.limit_){\nvar next=iterator.getNext();\nvar inRange=void 0;\nif(this.reverse_){\ninRange=\nthis.index_.compare(this.rangedFilter_.getStartPost(),next)<=0;\n}else\n{\ninRange=\nthis.index_.compare(next,this.rangedFilter_.getEndPost())<=0;\n}\nif(inRange){\nfiltered=filtered.updateImmediateChild(next.name,next.node);\ncount++;\n}else\n{\n// if we have reached the end post, we cannot keep adding elemments\nbreak;\n}\n}\n}else\n{\n// The snap contains less than twice the limit. Faster to delete from the snap than build up a new one\nfiltered=newSnap.withIndex(this.index_);\n// Don't support priorities on queries\nfiltered=filtered.updatePriority(ChildrenNode.EMPTY_NODE);\nvar startPost=void 0;\nvar endPost=void 0;\nvar cmp=void 0;\nvar iterator=void 0;\nif(this.reverse_){\niterator=filtered.getReverseIterator(this.index_);\nstartPost=this.rangedFilter_.getEndPost();\nendPost=this.rangedFilter_.getStartPost();\nvar indexCompare_1=this.index_.getCompare();\ncmp=function cmp(a,b){return indexCompare_1(b,a);};\n}else\n{\niterator=filtered.getIterator(this.index_);\nstartPost=this.rangedFilter_.getStartPost();\nendPost=this.rangedFilter_.getEndPost();\ncmp=this.index_.getCompare();\n}\nvar count=0;\nvar foundStartPost=false;\nwhile(iterator.hasNext()){\nvar next=iterator.getNext();\nif(!foundStartPost&&cmp(startPost,next)<=0){\n// start adding\nfoundStartPost=true;\n}\nvar inRange=foundStartPost&&count<this.limit_&&cmp(next,endPost)<=0;\nif(inRange){\ncount++;\n}else\n{\nfiltered=filtered.updateImmediateChild(next.name,ChildrenNode.EMPTY_NODE);\n}\n}\n}\n}\nreturn this.rangedFilter_.\ngetIndexedFilter().\nupdateFullNode(oldSnap,filtered,optChangeAccumulator);\n};\n/**\r\n     * @inheritDoc\r\n     */\nLimitedFilter.prototype.updatePriority=function(oldSnap,newPriority){\n// Don't support priorities on queries\nreturn oldSnap;\n};\n/**\r\n     * @inheritDoc\r\n     */\nLimitedFilter.prototype.filtersNodes=function(){\nreturn true;\n};\n/**\r\n     * @inheritDoc\r\n     */\nLimitedFilter.prototype.getIndexedFilter=function(){\nreturn this.rangedFilter_.getIndexedFilter();\n};\n/**\r\n     * @inheritDoc\r\n     */\nLimitedFilter.prototype.getIndex=function(){\nreturn this.index_;\n};\n/**\r\n     * @param {!Node} snap\r\n     * @param {string} childKey\r\n     * @param {!Node} childSnap\r\n     * @param {!CompleteChildSource} source\r\n     * @param {?ChildChangeAccumulator} changeAccumulator\r\n     * @return {!Node}\r\n     * @private\r\n     */\nLimitedFilter.prototype.fullLimitUpdateChild_=function(snap,childKey,childSnap,source,changeAccumulator){\n// TODO: rename all cache stuff etc to general snap terminology\nvar cmp;\nif(this.reverse_){\nvar indexCmp_1=this.index_.getCompare();\ncmp=function cmp(a,b){return indexCmp_1(b,a);};\n}else\n{\ncmp=this.index_.getCompare();\n}\nvar oldEventCache=snap;\nutil.assert(oldEventCache.numChildren()===this.limit_,'');\nvar newChildNamedNode=new NamedNode(childKey,childSnap);\nvar windowBoundary=this.reverse_?\noldEventCache.getFirstChild(this.index_):\noldEventCache.getLastChild(this.index_);\nvar inRange=this.rangedFilter_.matches(newChildNamedNode);\nif(oldEventCache.hasChild(childKey)){\nvar oldChildSnap=oldEventCache.getImmediateChild(childKey);\nvar nextChild=source.getChildAfterChild(this.index_,windowBoundary,this.reverse_);\nwhile(nextChild!=null&&(\nnextChild.name===childKey||oldEventCache.hasChild(nextChild.name))){\n// There is a weird edge case where a node is updated as part of a merge in the write tree, but hasn't\n// been applied to the limited filter yet. Ignore this next child which will be updated later in\n// the limited filter...\nnextChild=source.getChildAfterChild(this.index_,nextChild,this.reverse_);\n}\nvar compareNext=nextChild==null?1:cmp(nextChild,newChildNamedNode);\nvar remainsInWindow=inRange&&!childSnap.isEmpty()&&compareNext>=0;\nif(remainsInWindow){\nif(changeAccumulator!=null){\nchangeAccumulator.trackChildChange(Change.childChangedChange(childKey,childSnap,oldChildSnap));\n}\nreturn oldEventCache.updateImmediateChild(childKey,childSnap);\n}else\n{\nif(changeAccumulator!=null){\nchangeAccumulator.trackChildChange(Change.childRemovedChange(childKey,oldChildSnap));\n}\nvar newEventCache=oldEventCache.updateImmediateChild(childKey,ChildrenNode.EMPTY_NODE);\nvar nextChildInRange=nextChild!=null&&this.rangedFilter_.matches(nextChild);\nif(nextChildInRange){\nif(changeAccumulator!=null){\nchangeAccumulator.trackChildChange(Change.childAddedChange(nextChild.name,nextChild.node));\n}\nreturn newEventCache.updateImmediateChild(nextChild.name,nextChild.node);\n}else\n{\nreturn newEventCache;\n}\n}\n}else\nif(childSnap.isEmpty()){\n// we're deleting a node, but it was not in the window, so ignore it\nreturn snap;\n}else\nif(inRange){\nif(cmp(windowBoundary,newChildNamedNode)>=0){\nif(changeAccumulator!=null){\nchangeAccumulator.trackChildChange(Change.childRemovedChange(windowBoundary.name,windowBoundary.node));\nchangeAccumulator.trackChildChange(Change.childAddedChange(childKey,childSnap));\n}\nreturn oldEventCache.\nupdateImmediateChild(childKey,childSnap).\nupdateImmediateChild(windowBoundary.name,ChildrenNode.EMPTY_NODE);\n}else\n{\nreturn snap;\n}\n}else\n{\nreturn snap;\n}\n};\nreturn LimitedFilter;\n}();\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n/**\r\n * This class is an immutable-from-the-public-api struct containing a set of query parameters defining a\r\n * range to be returned for a particular location. It is assumed that validation of parameters is done at the\r\n * user-facing API level, so it is not done here.\r\n * @constructor\r\n */\nvar QueryParams=/** @class */function(){\nfunction QueryParams(){\nthis.limitSet_=false;\nthis.startSet_=false;\nthis.startNameSet_=false;\nthis.endSet_=false;\nthis.endNameSet_=false;\nthis.limit_=0;\nthis.viewFrom_='';\nthis.indexStartValue_=null;\nthis.indexStartName_='';\nthis.indexEndValue_=null;\nthis.indexEndName_='';\nthis.index_=PRIORITY_INDEX;\n}\n/**\r\n     * @return {boolean}\r\n     */\nQueryParams.prototype.hasStart=function(){\nreturn this.startSet_;\n};\n/**\r\n     * @return {boolean} True if it would return from left.\r\n     */\nQueryParams.prototype.isViewFromLeft=function(){\nif(this.viewFrom_===''){\n// limit(), rather than limitToFirst or limitToLast was called.\n// This means that only one of startSet_ and endSet_ is true. Use them\n// to calculate which side of the view to anchor to. If neither is set,\n// anchor to the end.\nreturn this.startSet_;\n}else\n{\nreturn this.viewFrom_===QueryParams.WIRE_PROTOCOL_CONSTANTS_.VIEW_FROM_LEFT;\n}\n};\n/**\r\n     * Only valid to call if hasStart() returns true\r\n     * @return {*}\r\n     */\nQueryParams.prototype.getIndexStartValue=function(){\nutil.assert(this.startSet_,'Only valid if start has been set');\nreturn this.indexStartValue_;\n};\n/**\r\n     * Only valid to call if hasStart() returns true.\r\n     * Returns the starting key name for the range defined by these query parameters\r\n     * @return {!string}\r\n     */\nQueryParams.prototype.getIndexStartName=function(){\nutil.assert(this.startSet_,'Only valid if start has been set');\nif(this.startNameSet_){\nreturn this.indexStartName_;\n}else\n{\nreturn MIN_NAME;\n}\n};\n/**\r\n     * @return {boolean}\r\n     */\nQueryParams.prototype.hasEnd=function(){\nreturn this.endSet_;\n};\n/**\r\n     * Only valid to call if hasEnd() returns true.\r\n     * @return {*}\r\n     */\nQueryParams.prototype.getIndexEndValue=function(){\nutil.assert(this.endSet_,'Only valid if end has been set');\nreturn this.indexEndValue_;\n};\n/**\r\n     * Only valid to call if hasEnd() returns true.\r\n     * Returns the end key name for the range defined by these query parameters\r\n     * @return {!string}\r\n     */\nQueryParams.prototype.getIndexEndName=function(){\nutil.assert(this.endSet_,'Only valid if end has been set');\nif(this.endNameSet_){\nreturn this.indexEndName_;\n}else\n{\nreturn MAX_NAME;\n}\n};\n/**\r\n     * @return {boolean}\r\n     */\nQueryParams.prototype.hasLimit=function(){\nreturn this.limitSet_;\n};\n/**\r\n     * @return {boolean} True if a limit has been set and it has been explicitly anchored\r\n     */\nQueryParams.prototype.hasAnchoredLimit=function(){\nreturn this.limitSet_&&this.viewFrom_!=='';\n};\n/**\r\n     * Only valid to call if hasLimit() returns true\r\n     * @return {!number}\r\n     */\nQueryParams.prototype.getLimit=function(){\nutil.assert(this.limitSet_,'Only valid if limit has been set');\nreturn this.limit_;\n};\n/**\r\n     * @return {!Index}\r\n     */\nQueryParams.prototype.getIndex=function(){\nreturn this.index_;\n};\n/**\r\n     * @return {!QueryParams}\r\n     * @private\r\n     */\nQueryParams.prototype.copy_=function(){\nvar copy=new QueryParams();\ncopy.limitSet_=this.limitSet_;\ncopy.limit_=this.limit_;\ncopy.startSet_=this.startSet_;\ncopy.indexStartValue_=this.indexStartValue_;\ncopy.startNameSet_=this.startNameSet_;\ncopy.indexStartName_=this.indexStartName_;\ncopy.endSet_=this.endSet_;\ncopy.indexEndValue_=this.indexEndValue_;\ncopy.endNameSet_=this.endNameSet_;\ncopy.indexEndName_=this.indexEndName_;\ncopy.index_=this.index_;\ncopy.viewFrom_=this.viewFrom_;\nreturn copy;\n};\n/**\r\n     * @param {!number} newLimit\r\n     * @return {!QueryParams}\r\n     */\nQueryParams.prototype.limit=function(newLimit){\nvar newParams=this.copy_();\nnewParams.limitSet_=true;\nnewParams.limit_=newLimit;\nnewParams.viewFrom_='';\nreturn newParams;\n};\n/**\r\n     * @param {!number} newLimit\r\n     * @return {!QueryParams}\r\n     */\nQueryParams.prototype.limitToFirst=function(newLimit){\nvar newParams=this.copy_();\nnewParams.limitSet_=true;\nnewParams.limit_=newLimit;\nnewParams.viewFrom_=QueryParams.WIRE_PROTOCOL_CONSTANTS_.VIEW_FROM_LEFT;\nreturn newParams;\n};\n/**\r\n     * @param {!number} newLimit\r\n     * @return {!QueryParams}\r\n     */\nQueryParams.prototype.limitToLast=function(newLimit){\nvar newParams=this.copy_();\nnewParams.limitSet_=true;\nnewParams.limit_=newLimit;\nnewParams.viewFrom_=QueryParams.WIRE_PROTOCOL_CONSTANTS_.VIEW_FROM_RIGHT;\nreturn newParams;\n};\n/**\r\n     * @param {*} indexValue\r\n     * @param {?string=} key\r\n     * @return {!QueryParams}\r\n     */\nQueryParams.prototype.startAt=function(indexValue,key){\nvar newParams=this.copy_();\nnewParams.startSet_=true;\nif(indexValue===undefined){\nindexValue=null;\n}\nnewParams.indexStartValue_=indexValue;\nif(key!=null){\nnewParams.startNameSet_=true;\nnewParams.indexStartName_=key;\n}else\n{\nnewParams.startNameSet_=false;\nnewParams.indexStartName_='';\n}\nreturn newParams;\n};\n/**\r\n     * @param {*} indexValue\r\n     * @param {?string=} key\r\n     * @return {!QueryParams}\r\n     */\nQueryParams.prototype.endAt=function(indexValue,key){\nvar newParams=this.copy_();\nnewParams.endSet_=true;\nif(indexValue===undefined){\nindexValue=null;\n}\nnewParams.indexEndValue_=indexValue;\nif(key!==undefined){\nnewParams.endNameSet_=true;\nnewParams.indexEndName_=key;\n}else\n{\nnewParams.endNameSet_=false;\nnewParams.indexEndName_='';\n}\nreturn newParams;\n};\n/**\r\n     * @param {!Index} index\r\n     * @return {!QueryParams}\r\n     */\nQueryParams.prototype.orderBy=function(index){\nvar newParams=this.copy_();\nnewParams.index_=index;\nreturn newParams;\n};\n/**\r\n     * @return {!Object}\r\n     */\nQueryParams.prototype.getQueryObject=function(){\nvar WIRE_PROTOCOL_CONSTANTS=QueryParams.WIRE_PROTOCOL_CONSTANTS_;\nvar obj={};\nif(this.startSet_){\nobj[WIRE_PROTOCOL_CONSTANTS.INDEX_START_VALUE]=this.indexStartValue_;\nif(this.startNameSet_){\nobj[WIRE_PROTOCOL_CONSTANTS.INDEX_START_NAME]=this.indexStartName_;\n}\n}\nif(this.endSet_){\nobj[WIRE_PROTOCOL_CONSTANTS.INDEX_END_VALUE]=this.indexEndValue_;\nif(this.endNameSet_){\nobj[WIRE_PROTOCOL_CONSTANTS.INDEX_END_NAME]=this.indexEndName_;\n}\n}\nif(this.limitSet_){\nobj[WIRE_PROTOCOL_CONSTANTS.LIMIT]=this.limit_;\nvar viewFrom=this.viewFrom_;\nif(viewFrom===''){\nif(this.isViewFromLeft()){\nviewFrom=WIRE_PROTOCOL_CONSTANTS.VIEW_FROM_LEFT;\n}else\n{\nviewFrom=WIRE_PROTOCOL_CONSTANTS.VIEW_FROM_RIGHT;\n}\n}\nobj[WIRE_PROTOCOL_CONSTANTS.VIEW_FROM]=viewFrom;\n}\n// For now, priority index is the default, so we only specify if it's some other index\nif(this.index_!==PRIORITY_INDEX){\nobj[WIRE_PROTOCOL_CONSTANTS.INDEX]=this.index_.toString();\n}\nreturn obj;\n};\n/**\r\n     * @return {boolean}\r\n     */\nQueryParams.prototype.loadsAllData=function(){\nreturn!(this.startSet_||this.endSet_||this.limitSet_);\n};\n/**\r\n     * @return {boolean}\r\n     */\nQueryParams.prototype.isDefault=function(){\nreturn this.loadsAllData()&&this.index_===PRIORITY_INDEX;\n};\n/**\r\n     * @return {!NodeFilter}\r\n     */\nQueryParams.prototype.getNodeFilter=function(){\nif(this.loadsAllData()){\nreturn new IndexedFilter(this.getIndex());\n}else\nif(this.hasLimit()){\nreturn new LimitedFilter(this);\n}else\n{\nreturn new RangedFilter(this);\n}\n};\n/**\r\n     * Returns a set of REST query string parameters representing this query.\r\n     *\r\n     * @return {!Object.<string,*>} query string parameters\r\n     */\nQueryParams.prototype.toRestQueryStringParameters=function(){\nvar REST_CONSTANTS=QueryParams.REST_QUERY_CONSTANTS_;\nvar qs={};\nif(this.isDefault()){\nreturn qs;\n}\nvar orderBy;\nif(this.index_===PRIORITY_INDEX){\norderBy=REST_CONSTANTS.PRIORITY_INDEX;\n}else\nif(this.index_===VALUE_INDEX){\norderBy=REST_CONSTANTS.VALUE_INDEX;\n}else\nif(this.index_===KEY_INDEX){\norderBy=REST_CONSTANTS.KEY_INDEX;\n}else\n{\nutil.assert(this.index_ instanceof PathIndex,'Unrecognized index type!');\norderBy=this.index_.toString();\n}\nqs[REST_CONSTANTS.ORDER_BY]=util.stringify(orderBy);\nif(this.startSet_){\nqs[REST_CONSTANTS.START_AT]=util.stringify(this.indexStartValue_);\nif(this.startNameSet_){\nqs[REST_CONSTANTS.START_AT]+=','+util.stringify(this.indexStartName_);\n}\n}\nif(this.endSet_){\nqs[REST_CONSTANTS.END_AT]=util.stringify(this.indexEndValue_);\nif(this.endNameSet_){\nqs[REST_CONSTANTS.END_AT]+=','+util.stringify(this.indexEndName_);\n}\n}\nif(this.limitSet_){\nif(this.isViewFromLeft()){\nqs[REST_CONSTANTS.LIMIT_TO_FIRST]=this.limit_;\n}else\n{\nqs[REST_CONSTANTS.LIMIT_TO_LAST]=this.limit_;\n}\n}\nreturn qs;\n};\n/**\r\n     * Wire Protocol Constants\r\n     * @const\r\n     * @enum {string}\r\n     * @private\r\n     */\nQueryParams.WIRE_PROTOCOL_CONSTANTS_={\nINDEX_START_VALUE:'sp',\nINDEX_START_NAME:'sn',\nINDEX_END_VALUE:'ep',\nINDEX_END_NAME:'en',\nLIMIT:'l',\nVIEW_FROM:'vf',\nVIEW_FROM_LEFT:'l',\nVIEW_FROM_RIGHT:'r',\nINDEX:'i'};\n\n/**\r\n     * REST Query Constants\r\n     * @const\r\n     * @enum {string}\r\n     * @private\r\n     */\nQueryParams.REST_QUERY_CONSTANTS_={\nORDER_BY:'orderBy',\nPRIORITY_INDEX:'$priority',\nVALUE_INDEX:'$value',\nKEY_INDEX:'$key',\nSTART_AT:'startAt',\nEND_AT:'endAt',\nLIMIT_TO_FIRST:'limitToFirst',\nLIMIT_TO_LAST:'limitToLast'};\n\n/**\r\n     * Default, empty query parameters\r\n     * @type {!QueryParams}\r\n     * @const\r\n     */\nQueryParams.DEFAULT=new QueryParams();\nreturn QueryParams;\n}();\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\nvar Reference=/** @class */function(_super){\ntslib.__extends(Reference,_super);\n/**\r\n     * Call options:\r\n     *   new Reference(Repo, Path) or\r\n     *   new Reference(url: string, string|RepoManager)\r\n     *\r\n     * Externally - this is the firebase.database.Reference type.\r\n     *\r\n     * @param {!Repo} repo\r\n     * @param {(!Path)} path\r\n     * @extends {Query}\r\n     */\nfunction Reference(repo,path){\nvar _this=this;\nif(!(repo instanceof Repo)){\nthrow new Error('new Reference() no longer supported - use app.database().');\n}\n// call Query's constructor, passing in the repo and path.\n_this=_super.call(this,repo,path,QueryParams.DEFAULT,false)||this;\nreturn _this;\n}\n/** @return {?string} */\nReference.prototype.getKey=function(){\nutil.validateArgCount('Reference.key',0,0,arguments.length);\nif(this.path.isEmpty()){\nreturn null;\n}else\n{\nreturn this.path.getBack();\n}\n};\n/**\r\n     * @param {!(string|Path)} pathString\r\n     * @return {!Reference}\r\n     */\nReference.prototype.child=function(pathString){\nutil.validateArgCount('Reference.child',1,1,arguments.length);\nif(typeof pathString==='number'){\npathString=String(pathString);\n}else\nif(!(pathString instanceof Path)){\nif(this.path.getFront()===null){\nvalidateRootPathString('Reference.child',1,pathString,false);\n}else\n{\nvalidatePathString('Reference.child',1,pathString,false);\n}\n}\nreturn new Reference(this.repo,this.path.child(pathString));\n};\n/** @return {?Reference} */\nReference.prototype.getParent=function(){\nutil.validateArgCount('Reference.parent',0,0,arguments.length);\nvar parentPath=this.path.parent();\nreturn parentPath===null?null:new Reference(this.repo,parentPath);\n};\n/** @return {!Reference} */\nReference.prototype.getRoot=function(){\nutil.validateArgCount('Reference.root',0,0,arguments.length);\nvar ref=this;\nwhile(ref.getParent()!==null){\nref=ref.getParent();\n}\nreturn ref;\n};\n/** @return {!Database} */\nReference.prototype.databaseProp=function(){\nreturn this.repo.database;\n};\n/**\r\n     * @param {*} newVal\r\n     * @param {function(?Error)=} onComplete\r\n     * @return {!Promise}\r\n     */\nReference.prototype.set=function(newVal,onComplete){\nutil.validateArgCount('Reference.set',1,2,arguments.length);\nvalidateWritablePath('Reference.set',this.path);\nvalidateFirebaseDataArg('Reference.set',1,newVal,this.path,false);\nutil.validateCallback('Reference.set',2,onComplete,true);\nvar deferred=new util.Deferred();\nthis.repo.setWithPriority(this.path,newVal,\n/*priority=*/null,deferred.wrapCallback(onComplete));\nreturn deferred.promise;\n};\n/**\r\n     * @param {!Object} objectToMerge\r\n     * @param {function(?Error)=} onComplete\r\n     * @return {!Promise}\r\n     */\nReference.prototype.update=function(objectToMerge,onComplete){\nutil.validateArgCount('Reference.update',1,2,arguments.length);\nvalidateWritablePath('Reference.update',this.path);\nif(Array.isArray(objectToMerge)){\nvar newObjectToMerge={};\nfor(var i=0;i<objectToMerge.length;++i){\nnewObjectToMerge[''+i]=objectToMerge[i];\n}\nobjectToMerge=newObjectToMerge;\nwarn('Passing an Array to Firebase.update() is deprecated. '+\n'Use set() if you want to overwrite the existing data, or '+\n'an Object with integer keys if you really do want to '+\n'only update some of the children.');\n}\nvalidateFirebaseMergeDataArg('Reference.update',1,objectToMerge,this.path,false);\nutil.validateCallback('Reference.update',2,onComplete,true);\nvar deferred=new util.Deferred();\nthis.repo.update(this.path,objectToMerge,deferred.wrapCallback(onComplete));\nreturn deferred.promise;\n};\n/**\r\n     * @param {*} newVal\r\n     * @param {string|number|null} newPriority\r\n     * @param {function(?Error)=} onComplete\r\n     * @return {!Promise}\r\n     */\nReference.prototype.setWithPriority=function(newVal,newPriority,onComplete){\nutil.validateArgCount('Reference.setWithPriority',2,3,arguments.length);\nvalidateWritablePath('Reference.setWithPriority',this.path);\nvalidateFirebaseDataArg('Reference.setWithPriority',1,newVal,this.path,false);\nvalidatePriority('Reference.setWithPriority',2,newPriority,false);\nutil.validateCallback('Reference.setWithPriority',3,onComplete,true);\nif(this.getKey()==='.length'||this.getKey()==='.keys'){\nthrow'Reference.setWithPriority failed: '+\nthis.getKey()+\n' is a read-only object.';\n}\nvar deferred=new util.Deferred();\nthis.repo.setWithPriority(this.path,newVal,newPriority,deferred.wrapCallback(onComplete));\nreturn deferred.promise;\n};\n/**\r\n     * @param {function(?Error)=} onComplete\r\n     * @return {!Promise}\r\n     */\nReference.prototype.remove=function(onComplete){\nutil.validateArgCount('Reference.remove',0,1,arguments.length);\nvalidateWritablePath('Reference.remove',this.path);\nutil.validateCallback('Reference.remove',1,onComplete,true);\nreturn this.set(null,onComplete);\n};\n/**\r\n     * @param {function(*):*} transactionUpdate\r\n     * @param {(function(?Error, boolean, ?DataSnapshot))=} onComplete\r\n     * @param {boolean=} applyLocally\r\n     * @return {!Promise}\r\n     */\nReference.prototype.transaction=function(transactionUpdate,onComplete,applyLocally){\nutil.validateArgCount('Reference.transaction',1,3,arguments.length);\nvalidateWritablePath('Reference.transaction',this.path);\nutil.validateCallback('Reference.transaction',1,transactionUpdate,false);\nutil.validateCallback('Reference.transaction',2,onComplete,true);\n// NOTE: applyLocally is an internal-only option for now.  We need to decide if we want to keep it and how\n// to expose it.\nvalidateBoolean('Reference.transaction',3,applyLocally,true);\nif(this.getKey()==='.length'||this.getKey()==='.keys'){\nthrow'Reference.transaction failed: '+\nthis.getKey()+\n' is a read-only object.';\n}\nif(applyLocally===undefined){\napplyLocally=true;\n}\nvar deferred=new util.Deferred();\nif(typeof onComplete==='function'){\ndeferred.promise.catch(function(){});\n}\nvar promiseComplete=function promiseComplete(error,committed,snapshot){\nif(error){\ndeferred.reject(error);\n}else\n{\ndeferred.resolve(new TransactionResult(committed,snapshot));\n}\nif(typeof onComplete==='function'){\nonComplete(error,committed,snapshot);\n}\n};\nthis.repo.startTransaction(this.path,transactionUpdate,promiseComplete,applyLocally);\nreturn deferred.promise;\n};\n/**\r\n     * @param {string|number|null} priority\r\n     * @param {function(?Error)=} onComplete\r\n     * @return {!Promise}\r\n     */\nReference.prototype.setPriority=function(priority,onComplete){\nutil.validateArgCount('Reference.setPriority',1,2,arguments.length);\nvalidateWritablePath('Reference.setPriority',this.path);\nvalidatePriority('Reference.setPriority',1,priority,false);\nutil.validateCallback('Reference.setPriority',2,onComplete,true);\nvar deferred=new util.Deferred();\nthis.repo.setWithPriority(this.path.child('.priority'),priority,null,deferred.wrapCallback(onComplete));\nreturn deferred.promise;\n};\n/**\r\n     * @param {*=} value\r\n     * @param {function(?Error)=} onComplete\r\n     * @return {!Reference}\r\n     */\nReference.prototype.push=function(value,onComplete){\nutil.validateArgCount('Reference.push',0,2,arguments.length);\nvalidateWritablePath('Reference.push',this.path);\nvalidateFirebaseDataArg('Reference.push',1,value,this.path,true);\nutil.validateCallback('Reference.push',2,onComplete,true);\nvar now=this.repo.serverTime();\nvar name=nextPushId(now);\n// push() returns a ThennableReference whose promise is fulfilled with a regular Reference.\n// We use child() to create handles to two different references. The first is turned into a\n// ThennableReference below by adding then() and catch() methods and is used as the\n// return value of push(). The second remains a regular Reference and is used as the fulfilled\n// value of the first ThennableReference.\nvar thennablePushRef=this.child(name);\nvar pushRef=this.child(name);\nvar promise;\nif(value!=null){\npromise=thennablePushRef.set(value,onComplete).then(function(){return pushRef;});\n}else\n{\npromise=Promise.resolve(pushRef);\n}\nthennablePushRef.then=promise.then.bind(promise);\nthennablePushRef.catch=promise.then.bind(promise,undefined);\nif(typeof onComplete==='function'){\npromise.catch(function(){});\n}\nreturn thennablePushRef;\n};\n/**\r\n     * @return {!OnDisconnect}\r\n     */\nReference.prototype.onDisconnect=function(){\nvalidateWritablePath('Reference.onDisconnect',this.path);\nreturn new OnDisconnect(this.repo,this.path);\n};\nObject.defineProperty(Reference.prototype,\"database\",{\nget:function get(){\nreturn this.databaseProp();\n},\nenumerable:false,\nconfigurable:true});\n\nObject.defineProperty(Reference.prototype,\"key\",{\nget:function get(){\nreturn this.getKey();\n},\nenumerable:false,\nconfigurable:true});\n\nObject.defineProperty(Reference.prototype,\"parent\",{\nget:function get(){\nreturn this.getParent();\n},\nenumerable:false,\nconfigurable:true});\n\nObject.defineProperty(Reference.prototype,\"root\",{\nget:function get(){\nreturn this.getRoot();\n},\nenumerable:false,\nconfigurable:true});\n\nreturn Reference;\n}(Query);\n/**\r\n * Define reference constructor in various modules\r\n *\r\n * We are doing this here to avoid several circular\r\n * dependency issues\r\n */\nQuery.__referenceConstructor=Reference;\nSyncPoint.__referenceConstructor=Reference;\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n/**\r\n * Node in a Tree.\r\n */\nvar TreeNode=/** @class */function(){\nfunction TreeNode(){\n// TODO: Consider making accessors that create children and value lazily or\n// separate Internal / Leaf 'types'.\nthis.children={};\nthis.childCount=0;\nthis.value=null;\n}\nreturn TreeNode;\n}();\n/**\r\n * A light-weight tree, traversable by path.  Nodes can have both values and children.\r\n * Nodes are not enumerated (by forEachChild) unless they have a value or non-empty\r\n * children.\r\n */\nvar Tree=/** @class */function(){\n/**\r\n     * @template T\r\n     * @param {string=} name_ Optional name of the node.\r\n     * @param {Tree=} parent_ Optional parent node.\r\n     * @param {TreeNode=} node_ Optional node to wrap.\r\n     */\nfunction Tree(name_,parent_,node_){\nif(name_===void 0){name_='';}\nif(parent_===void 0){parent_=null;}\nif(node_===void 0){node_=new TreeNode();}\nthis.name_=name_;\nthis.parent_=parent_;\nthis.node_=node_;\n}\n/**\r\n     * Returns a sub-Tree for the given path.\r\n     *\r\n     * @param {!(string|Path)} pathObj Path to look up.\r\n     * @return {!Tree.<T>} Tree for path.\r\n     */\nTree.prototype.subTree=function(pathObj){\n// TODO: Require pathObj to be Path?\nvar path=pathObj instanceof Path?pathObj:new Path(pathObj);\nvar child=this,next=path.getFront();\nwhile(next!==null){\nvar childNode=util.safeGet(child.node_.children,next)||new TreeNode();\nchild=new Tree(next,child,childNode);\npath=path.popFront();\nnext=path.getFront();\n}\nreturn child;\n};\n/**\r\n     * Returns the data associated with this tree node.\r\n     *\r\n     * @return {?T} The data or null if no data exists.\r\n     */\nTree.prototype.getValue=function(){\nreturn this.node_.value;\n};\n/**\r\n     * Sets data to this tree node.\r\n     *\r\n     * @param {!T} value Value to set.\r\n     */\nTree.prototype.setValue=function(value){\nutil.assert(typeof value!=='undefined','Cannot set value to undefined');\nthis.node_.value=value;\nthis.updateParents_();\n};\n/**\r\n     * Clears the contents of the tree node (its value and all children).\r\n     */\nTree.prototype.clear=function(){\nthis.node_.value=null;\nthis.node_.children={};\nthis.node_.childCount=0;\nthis.updateParents_();\n};\n/**\r\n     * @return {boolean} Whether the tree has any children.\r\n     */\nTree.prototype.hasChildren=function(){\nreturn this.node_.childCount>0;\n};\n/**\r\n     * @return {boolean} Whether the tree is empty (no value or children).\r\n     */\nTree.prototype.isEmpty=function(){\nreturn this.getValue()===null&&!this.hasChildren();\n};\n/**\r\n     * Calls action for each child of this tree node.\r\n     *\r\n     * @param {function(!Tree.<T>)} action Action to be called for each child.\r\n     */\nTree.prototype.forEachChild=function(action){\nvar _this=this;\neach(this.node_.children,function(child,childTree){\naction(new Tree(child,_this,childTree));\n});\n};\n/**\r\n     * Does a depth-first traversal of this node's descendants, calling action for each one.\r\n     *\r\n     * @param {function(!Tree.<T>)} action Action to be called for each child.\r\n     * @param {boolean=} includeSelf Whether to call action on this node as well. Defaults to\r\n     *   false.\r\n     * @param {boolean=} childrenFirst Whether to call action on children before calling it on\r\n     *   parent.\r\n     */\nTree.prototype.forEachDescendant=function(action,includeSelf,childrenFirst){\nif(includeSelf&&!childrenFirst){\naction(this);\n}\nthis.forEachChild(function(child){\nchild.forEachDescendant(action,/*includeSelf=*/true,childrenFirst);\n});\nif(includeSelf&&childrenFirst){\naction(this);\n}\n};\n/**\r\n     * Calls action on each ancestor node.\r\n     *\r\n     * @param {function(!Tree.<T>)} action Action to be called on each parent; return\r\n     *   true to abort.\r\n     * @param {boolean=} includeSelf Whether to call action on this node as well.\r\n     * @return {boolean} true if the action callback returned true.\r\n     */\nTree.prototype.forEachAncestor=function(action,includeSelf){\nvar node=includeSelf?this:this.parent();\nwhile(node!==null){\nif(action(node)){\nreturn true;\n}\nnode=node.parent();\n}\nreturn false;\n};\n/**\r\n     * Does a depth-first traversal of this node's descendants.  When a descendant with a value\r\n     * is found, action is called on it and traversal does not continue inside the node.\r\n     * Action is *not* called on this node.\r\n     *\r\n     * @param {function(!Tree.<T>)} action Action to be called for each child.\r\n     */\nTree.prototype.forEachImmediateDescendantWithValue=function(action){\nthis.forEachChild(function(child){\nif(child.getValue()!==null){\naction(child);\n}else\n{\nchild.forEachImmediateDescendantWithValue(action);\n}\n});\n};\n/**\r\n     * @return {!Path} The path of this tree node, as a Path.\r\n     */\nTree.prototype.path=function(){\nreturn new Path(this.parent_===null?\nthis.name_:\nthis.parent_.path()+'/'+this.name_);\n};\n/**\r\n     * @return {string} The name of the tree node.\r\n     */\nTree.prototype.name=function(){\nreturn this.name_;\n};\n/**\r\n     * @return {?Tree} The parent tree node, or null if this is the root of the tree.\r\n     */\nTree.prototype.parent=function(){\nreturn this.parent_;\n};\n/**\r\n     * Adds or removes this child from its parent based on whether it's empty or not.\r\n     *\r\n     * @private\r\n     */\nTree.prototype.updateParents_=function(){\nif(this.parent_!==null){\nthis.parent_.updateChild_(this.name_,this);\n}\n};\n/**\r\n     * Adds or removes the passed child to this tree node, depending on whether it's empty.\r\n     *\r\n     * @param {string} childName The name of the child to update.\r\n     * @param {!Tree.<T>} child The child to update.\r\n     * @private\r\n     */\nTree.prototype.updateChild_=function(childName,child){\nvar childEmpty=child.isEmpty();\nvar childExists=util.contains(this.node_.children,childName);\nif(childEmpty&&childExists){\ndelete this.node_.children[childName];\nthis.node_.childCount--;\nthis.updateParents_();\n}else\nif(!childEmpty&&!childExists){\nthis.node_.children[childName]=child.node_;\nthis.node_.childCount++;\nthis.updateParents_();\n}\n};\nreturn Tree;\n}();\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n// TODO: This is pretty messy.  Ideally, a lot of this would move into FirebaseData, or a transaction-specific\n// component used by FirebaseData, but it has ties to user callbacks (transaction update and onComplete) as well\n// as the realtime connection (to send transactions to the server).  So that all needs to be decoupled first.\n// For now it's part of Repo, but in its own file.\n/**\r\n * @enum {number}\r\n */\nvar TransactionStatus;\n(function(TransactionStatus){\n// We've run the transaction and updated transactionResultData_ with the result, but it isn't currently sent to the\n// server. A transaction will go from RUN -> SENT -> RUN if it comes back from the server as rejected due to\n// mismatched hash.\nTransactionStatus[TransactionStatus[\"RUN\"]=0]=\"RUN\";\n// We've run the transaction and sent it to the server and it's currently outstanding (hasn't come back as accepted\n// or rejected yet).\nTransactionStatus[TransactionStatus[\"SENT\"]=1]=\"SENT\";\n// Temporary state used to mark completed transactions (whether successful or aborted).  The transaction will be\n// removed when we get a chance to prune completed ones.\nTransactionStatus[TransactionStatus[\"COMPLETED\"]=2]=\"COMPLETED\";\n// Used when an already-sent transaction needs to be aborted (e.g. due to a conflicting set() call that was made).\n// If it comes back as unsuccessful, we'll abort it.\nTransactionStatus[TransactionStatus[\"SENT_NEEDS_ABORT\"]=3]=\"SENT_NEEDS_ABORT\";\n// Temporary state used to mark transactions that need to be aborted.\nTransactionStatus[TransactionStatus[\"NEEDS_ABORT\"]=4]=\"NEEDS_ABORT\";\n})(TransactionStatus||(TransactionStatus={}));\n/**\r\n * If a transaction does not succeed after 25 retries, we abort it.  Among other things this ensure that if there's\r\n * ever a bug causing a mismatch between client / server hashes for some data, we won't retry indefinitely.\r\n * @type {number}\r\n * @const\r\n * @private\r\n */\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nRepo.MAX_TRANSACTION_RETRIES_=25;\n/**\r\n * Setup the transaction data structures\r\n * @private\r\n */\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nRepo.prototype.transactionsInit_=function(){\n/**\r\n     * Stores queues of outstanding transactions for Firebase locations.\r\n     *\r\n     * @type {!Tree.<Array.<!Transaction>>}\r\n     * @private\r\n     */\nthis.transactionQueueTree_=new Tree();\n};\n/**\r\n * Creates a new transaction, adds it to the transactions we're tracking, and sends it to the server if possible.\r\n *\r\n * @param {!Path} path Path at which to do transaction.\r\n * @param {function(*):*} transactionUpdate Update callback.\r\n * @param {?function(?Error, boolean, ?DataSnapshot)} onComplete Completion callback.\r\n * @param {boolean} applyLocally Whether or not to make intermediate results visible\r\n */\nRepo.prototype.startTransaction=function(path,transactionUpdate,onComplete,applyLocally){\nthis.log_('transaction on '+path);\n// Add a watch to make sure we get server updates.\nvar valueCallback=function valueCallback(){};\nvar watchRef=new Reference(this,path);\nwatchRef.on('value',valueCallback);\nvar unwatcher=function unwatcher(){\nwatchRef.off('value',valueCallback);\n};\n// Initialize transaction.\nvar transaction={\npath:path,\nupdate:transactionUpdate,\nonComplete:onComplete,\n// One of TransactionStatus enums.\nstatus:null,\n// Used when combining transactions at different locations to figure out which one goes first.\norder:LUIDGenerator(),\n// Whether to raise local events for this transaction.\napplyLocally:applyLocally,\n// Count of how many times we've retried the transaction.\nretryCount:0,\n// Function to call to clean up our .on() listener.\nunwatcher:unwatcher,\n// Stores why a transaction was aborted.\nabortReason:null,\ncurrentWriteId:null,\ncurrentInputSnapshot:null,\ncurrentOutputSnapshotRaw:null,\ncurrentOutputSnapshotResolved:null};\n\n// Run transaction initially.\nvar currentState=this.getLatestState_(path);\ntransaction.currentInputSnapshot=currentState;\nvar newVal=transaction.update(currentState.val());\nif(newVal===undefined){\n// Abort transaction.\ntransaction.unwatcher();\ntransaction.currentOutputSnapshotRaw=null;\ntransaction.currentOutputSnapshotResolved=null;\nif(transaction.onComplete){\n// We just set the input snapshot, so this cast should be safe\nvar snapshot=new DataSnapshot(transaction.currentInputSnapshot,new Reference(this,transaction.path),PRIORITY_INDEX);\ntransaction.onComplete(null,false,snapshot);\n}\n}else\n{\nvalidateFirebaseData('transaction failed: Data returned ',newVal,transaction.path);\n// Mark as run and add to our queue.\ntransaction.status=TransactionStatus.RUN;\nvar queueNode=this.transactionQueueTree_.subTree(path);\nvar nodeQueue=queueNode.getValue()||[];\nnodeQueue.push(transaction);\nqueueNode.setValue(nodeQueue);\n// Update visibleData and raise events\n// Note: We intentionally raise events after updating all of our transaction state, since the user could\n// start new transactions from the event callbacks.\nvar priorityForNode=void 0;\nif((typeof newVal==='undefined'?'undefined':_typeof(newVal))==='object'&&\nnewVal!==null&&\nutil.contains(newVal,'.priority')){\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\npriorityForNode=util.safeGet(newVal,'.priority');\nutil.assert(isValidPriority(priorityForNode),'Invalid priority returned by transaction. '+\n'Priority must be a valid string, finite number, server value, or null.');\n}else\n{\nvar currentNode=this.serverSyncTree_.calcCompleteEventCache(path)||\nChildrenNode.EMPTY_NODE;\npriorityForNode=currentNode.getPriority().val();\n}\npriorityForNode/** @type {null|number|string} */=priorityForNode;\nvar serverValues=this.generateServerValues();\nvar newNodeUnresolved=nodeFromJSON$1(newVal,priorityForNode);\nvar newNode=resolveDeferredValueSnapshot(newNodeUnresolved,currentState,serverValues);\ntransaction.currentOutputSnapshotRaw=newNodeUnresolved;\ntransaction.currentOutputSnapshotResolved=newNode;\ntransaction.currentWriteId=this.getNextWriteId_();\nvar events=this.serverSyncTree_.applyUserOverwrite(path,newNode,transaction.currentWriteId,transaction.applyLocally);\nthis.eventQueue_.raiseEventsForChangedPath(path,events);\nthis.sendReadyTransactions_();\n}\n};\n/**\r\n * @param {!Path} path\r\n * @param {Array.<number>=} excludeSets A specific set to exclude\r\n * @return {Node}\r\n * @private\r\n */\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nRepo.prototype.getLatestState_=function(path,excludeSets){\nreturn this.serverSyncTree_.calcCompleteEventCache(path,excludeSets)||\nChildrenNode.EMPTY_NODE;\n};\n/**\r\n * Sends any already-run transactions that aren't waiting for outstanding transactions to\r\n * complete.\r\n *\r\n * Externally it's called with no arguments, but it calls itself recursively with a particular\r\n * transactionQueueTree node to recurse through the tree.\r\n *\r\n * @param {Tree.<Array.<Transaction>>=} node  transactionQueueTree node to start at.\r\n * @private\r\n */\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nRepo.prototype.sendReadyTransactions_=function(node){\nvar _this=this;\nif(node===void 0){node=this.transactionQueueTree_;}\n// Before recursing, make sure any completed transactions are removed.\nif(!node){\nthis.pruneCompletedTransactionsBelowNode_(node);\n}\nif(node.getValue()!==null){\nvar queue=this.buildTransactionQueue_(node);\nutil.assert(queue.length>0,'Sending zero length transaction queue');\nvar allRun=queue.every(function(transaction){return transaction.status===TransactionStatus.RUN;});\n// If they're all run (and not sent), we can send them.  Else, we must wait.\nif(allRun){\nthis.sendTransactionQueue_(node.path(),queue);\n}\n}else\nif(node.hasChildren()){\nnode.forEachChild(function(childNode){\n_this.sendReadyTransactions_(childNode);\n});\n}\n};\n/**\r\n * Given a list of run transactions, send them to the server and then handle the result (success or failure).\r\n *\r\n * @param {!Path} path The location of the queue.\r\n * @param {!Array.<Transaction>} queue Queue of transactions under the specified location.\r\n * @private\r\n */\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nRepo.prototype.sendTransactionQueue_=function(path,queue){\nvar _this=this;\n// Mark transactions as sent and increment retry count!\nvar setsToIgnore=queue.map(function(txn){\nreturn txn.currentWriteId;\n});\nvar latestState=this.getLatestState_(path,setsToIgnore);\nvar snapToSend=latestState;\nvar latestHash=latestState.hash();\nfor(var i=0;i<queue.length;i++){\nvar txn=queue[i];\nutil.assert(txn.status===TransactionStatus.RUN,'tryToSendTransactionQueue_: items in queue should all be run.');\ntxn.status=TransactionStatus.SENT;\ntxn.retryCount++;\nvar relativePath=Path.relativePath(path,txn.path);\n// If we've gotten to this point, the output snapshot must be defined.\nsnapToSend=snapToSend.updateChild(relativePath/** @type {!Node} */,txn.currentOutputSnapshotRaw);\n}\nvar dataToSend=snapToSend.val(true);\nvar pathToSend=path;\n// Send the put.\nthis.server_.put(pathToSend.toString(),dataToSend,function(status){\n_this.log_('transaction put response',{\npath:pathToSend.toString(),\nstatus:status});\n\nvar events=[];\nif(status==='ok'){\n// Queue up the callbacks and fire them after cleaning up all of our transaction state, since\n// the callback could trigger more transactions or sets.\nvar callbacks=[];\nfor(var i=0;i<queue.length;i++){\nqueue[i].status=TransactionStatus.COMPLETED;\nevents=events.concat(_this.serverSyncTree_.ackUserWrite(queue[i].currentWriteId));\nif(queue[i].onComplete){\n// We never unset the output snapshot, and given that this transaction is complete, it should be set\nvar node=queue[i].currentOutputSnapshotResolved;\nvar ref=new Reference(_this,queue[i].path);\nvar snapshot=new DataSnapshot(node,ref,PRIORITY_INDEX);\ncallbacks.push(queue[i].onComplete.bind(null,null,true,snapshot));\n}\nqueue[i].unwatcher();\n}\n// Now remove the completed transactions.\n_this.pruneCompletedTransactionsBelowNode_(_this.transactionQueueTree_.subTree(path));\n// There may be pending transactions that we can now send.\n_this.sendReadyTransactions_();\n_this.eventQueue_.raiseEventsForChangedPath(path,events);\n// Finally, trigger onComplete callbacks.\nfor(var i=0;i<callbacks.length;i++){\nexceptionGuard(callbacks[i]);\n}\n}else\n{\n// transactions are no longer sent.  Update their status appropriately.\nif(status==='datastale'){\nfor(var i=0;i<queue.length;i++){\nif(queue[i].status===TransactionStatus.SENT_NEEDS_ABORT){\nqueue[i].status=TransactionStatus.NEEDS_ABORT;\n}else\n{\nqueue[i].status=TransactionStatus.RUN;\n}\n}\n}else\n{\nwarn('transaction at '+pathToSend.toString()+' failed: '+status);\nfor(var i=0;i<queue.length;i++){\nqueue[i].status=TransactionStatus.NEEDS_ABORT;\nqueue[i].abortReason=status;\n}\n}\n_this.rerunTransactions_(path);\n}\n},latestHash);\n};\n/**\r\n * Finds all transactions dependent on the data at changedPath and reruns them.\r\n *\r\n * Should be called any time cached data changes.\r\n *\r\n * Return the highest path that was affected by rerunning transactions.  This is the path at which events need to\r\n * be raised for.\r\n *\r\n * @param {!Path} changedPath The path in mergedData that changed.\r\n * @return {!Path} The rootmost path that was affected by rerunning transactions.\r\n * @private\r\n */\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nRepo.prototype.rerunTransactions_=function(changedPath){\nvar rootMostTransactionNode=this.getAncestorTransactionNode_(changedPath);\nvar path=rootMostTransactionNode.path();\nvar queue=this.buildTransactionQueue_(rootMostTransactionNode);\nthis.rerunTransactionQueue_(queue,path);\nreturn path;\n};\n/**\r\n * Does all the work of rerunning transactions (as well as cleans up aborted transactions and whatnot).\r\n *\r\n * @param {Array.<Transaction>} queue The queue of transactions to run.\r\n * @param {!Path} path The path the queue is for.\r\n * @private\r\n */\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nRepo.prototype.rerunTransactionQueue_=function(queue,path){\nif(queue.length===0){\nreturn;// Nothing to do!\n}\n// Queue up the callbacks and fire them after cleaning up all of our transaction state, since\n// the callback could trigger more transactions or sets.\nvar callbacks=[];\nvar events=[];\n// Ignore all of the sets we're going to re-run.\nvar txnsToRerun=queue.filter(function(q){\nreturn q.status===TransactionStatus.RUN;\n});\nvar setsToIgnore=txnsToRerun.map(function(q){\nreturn q.currentWriteId;\n});\nfor(var i=0;i<queue.length;i++){\nvar transaction=queue[i];\nvar relativePath=Path.relativePath(path,transaction.path);\nvar abortTransaction=false,abortReason=void 0;\nutil.assert(relativePath!==null,'rerunTransactionsUnderNode_: relativePath should not be null.');\nif(transaction.status===TransactionStatus.NEEDS_ABORT){\nabortTransaction=true;\nabortReason=transaction.abortReason;\nevents=events.concat(this.serverSyncTree_.ackUserWrite(transaction.currentWriteId,true));\n}else\nif(transaction.status===TransactionStatus.RUN){\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nif(transaction.retryCount>=Repo.MAX_TRANSACTION_RETRIES_){\nabortTransaction=true;\nabortReason='maxretry';\nevents=events.concat(this.serverSyncTree_.ackUserWrite(transaction.currentWriteId,true));\n}else\n{\n// This code reruns a transaction\nvar currentNode=this.getLatestState_(transaction.path,setsToIgnore);\ntransaction.currentInputSnapshot=currentNode;\nvar newData=queue[i].update(currentNode.val());\nif(newData!==undefined){\nvalidateFirebaseData('transaction failed: Data returned ',newData,transaction.path);\nvar newDataNode=nodeFromJSON$1(newData);\nvar hasExplicitPriority=(typeof newData==='undefined'?'undefined':_typeof(newData))==='object'&&\nnewData!=null&&\nutil.contains(newData,'.priority');\nif(!hasExplicitPriority){\n// Keep the old priority if there wasn't a priority explicitly specified.\nnewDataNode=newDataNode.updatePriority(currentNode.getPriority());\n}\nvar oldWriteId=transaction.currentWriteId;\nvar serverValues=this.generateServerValues();\nvar newNodeResolved=resolveDeferredValueSnapshot(newDataNode,currentNode,serverValues);\ntransaction.currentOutputSnapshotRaw=newDataNode;\ntransaction.currentOutputSnapshotResolved=newNodeResolved;\ntransaction.currentWriteId=this.getNextWriteId_();\n// Mutates setsToIgnore in place\nsetsToIgnore.splice(setsToIgnore.indexOf(oldWriteId),1);\nevents=events.concat(this.serverSyncTree_.applyUserOverwrite(transaction.path,newNodeResolved,transaction.currentWriteId,transaction.applyLocally));\nevents=events.concat(this.serverSyncTree_.ackUserWrite(oldWriteId,true));\n}else\n{\nabortTransaction=true;\nabortReason='nodata';\nevents=events.concat(this.serverSyncTree_.ackUserWrite(transaction.currentWriteId,true));\n}\n}\n}\nthis.eventQueue_.raiseEventsForChangedPath(path,events);\nevents=[];\nif(abortTransaction){\n// Abort.\nqueue[i].status=TransactionStatus.COMPLETED;\n// Removing a listener can trigger pruning which can muck with mergedData/visibleData (as it prunes data).\n// So defer the unwatcher until we're done.\n(function(unwatcher){\nsetTimeout(unwatcher,Math.floor(0));\n})(queue[i].unwatcher);\nif(queue[i].onComplete){\nif(abortReason==='nodata'){\nvar ref=new Reference(this,queue[i].path);\n// We set this field immediately, so it's safe to cast to an actual snapshot\nvar lastInput/** @type {!Node} */=queue[i].currentInputSnapshot;\nvar snapshot=new DataSnapshot(lastInput,ref,PRIORITY_INDEX);\ncallbacks.push(queue[i].onComplete.bind(null,null,false,snapshot));\n}else\n{\ncallbacks.push(queue[i].onComplete.bind(null,new Error(abortReason),false,null));\n}\n}\n}\n}\n// Clean up completed transactions.\nthis.pruneCompletedTransactionsBelowNode_(this.transactionQueueTree_);\n// Now fire callbacks, now that we're in a good, known state.\nfor(var i=0;i<callbacks.length;i++){\nexceptionGuard(callbacks[i]);\n}\n// Try to send the transaction result to the server.\nthis.sendReadyTransactions_();\n};\n/**\r\n * Returns the rootmost ancestor node of the specified path that has a pending transaction on it, or just returns\r\n * the node for the given path if there are no pending transactions on any ancestor.\r\n *\r\n * @param {!Path} path The location to start at.\r\n * @return {!Tree.<Array.<!Transaction>>} The rootmost node with a transaction.\r\n * @private\r\n */\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nRepo.prototype.getAncestorTransactionNode_=function(path){\nvar front;\n// Start at the root and walk deeper into the tree towards path until we find a node with pending transactions.\nvar transactionNode=this.transactionQueueTree_;\nfront=path.getFront();\nwhile(front!==null&&transactionNode.getValue()===null){\ntransactionNode=transactionNode.subTree(front);\npath=path.popFront();\nfront=path.getFront();\n}\nreturn transactionNode;\n};\n/**\r\n * Builds the queue of all transactions at or below the specified transactionNode.\r\n *\r\n * @param {!Tree.<Array.<Transaction>>} transactionNode\r\n * @return {Array.<Transaction>} The generated queue.\r\n * @private\r\n */\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nRepo.prototype.buildTransactionQueue_=function(transactionNode){\n// Walk any child transaction queues and aggregate them into a single queue.\nvar transactionQueue=[];\nthis.aggregateTransactionQueuesForNode_(transactionNode,transactionQueue);\n// Sort them by the order the transactions were created.\ntransactionQueue.sort(function(a,b){\nreturn a.order-b.order;\n});\nreturn transactionQueue;\n};\n/**\r\n * @param {!Tree.<Array.<Transaction>>} node\r\n * @param {Array.<Transaction>} queue\r\n * @private\r\n */\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nRepo.prototype.aggregateTransactionQueuesForNode_=function(node,queue){\nvar _this=this;\nvar nodeQueue=node.getValue();\nif(nodeQueue!==null){\nfor(var i=0;i<nodeQueue.length;i++){\nqueue.push(nodeQueue[i]);\n}\n}\nnode.forEachChild(function(child){\n_this.aggregateTransactionQueuesForNode_(child,queue);\n});\n};\n/**\r\n * Remove COMPLETED transactions at or below this node in the transactionQueueTree_.\r\n *\r\n * @param {!Tree.<Array.<!Transaction>>} node\r\n * @private\r\n */\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nRepo.prototype.pruneCompletedTransactionsBelowNode_=function(node){\nvar _this=this;\nvar queue=node.getValue();\nif(queue){\nvar to=0;\nfor(var from=0;from<queue.length;from++){\nif(queue[from].status!==TransactionStatus.COMPLETED){\nqueue[to]=queue[from];\nto++;\n}\n}\nqueue.length=to;\nnode.setValue(queue.length>0?queue:null);\n}\nnode.forEachChild(function(childNode){\n_this.pruneCompletedTransactionsBelowNode_(childNode);\n});\n};\n/**\r\n * Aborts all transactions on ancestors or descendants of the specified path.  Called when doing a set() or update()\r\n * since we consider them incompatible with transactions.\r\n *\r\n * @param {!Path} path Path for which we want to abort related transactions.\r\n * @return {!Path}\r\n * @private\r\n */\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nRepo.prototype.abortTransactions_=function(path){\nvar _this=this;\nvar affectedPath=this.getAncestorTransactionNode_(path).path();\nvar transactionNode=this.transactionQueueTree_.subTree(path);\ntransactionNode.forEachAncestor(function(node){\n_this.abortTransactionsOnNode_(node);\n});\nthis.abortTransactionsOnNode_(transactionNode);\ntransactionNode.forEachDescendant(function(node){\n_this.abortTransactionsOnNode_(node);\n});\nreturn affectedPath;\n};\n/**\r\n * Abort transactions stored in this transaction queue node.\r\n *\r\n * @param {!Tree.<Array.<Transaction>>} node Node to abort transactions for.\r\n * @private\r\n */\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nRepo.prototype.abortTransactionsOnNode_=function(node){\nvar queue=node.getValue();\nif(queue!==null){\n// Queue up the callbacks and fire them after cleaning up all of our transaction state, since\n// the callback could trigger more transactions or sets.\nvar callbacks=[];\n// Go through queue.  Any already-sent transactions must be marked for abort, while the unsent ones\n// can be immediately aborted and removed.\nvar events=[];\nvar lastSent=-1;\nfor(var i=0;i<queue.length;i++){\nif(queue[i].status===TransactionStatus.SENT_NEEDS_ABORT);else\nif(queue[i].status===TransactionStatus.SENT){\nutil.assert(lastSent===i-1,'All SENT items should be at beginning of queue.');\nlastSent=i;\n// Mark transaction for abort when it comes back.\nqueue[i].status=TransactionStatus.SENT_NEEDS_ABORT;\nqueue[i].abortReason='set';\n}else\n{\nutil.assert(queue[i].status===TransactionStatus.RUN,'Unexpected transaction status in abort');\n// We can abort it immediately.\nqueue[i].unwatcher();\nevents=events.concat(this.serverSyncTree_.ackUserWrite(queue[i].currentWriteId,true));\nif(queue[i].onComplete){\nvar snapshot=null;\ncallbacks.push(queue[i].onComplete.bind(null,new Error('set'),false,snapshot));\n}\n}\n}\nif(lastSent===-1){\n// We're not waiting for any sent transactions.  We can clear the queue.\nnode.setValue(null);\n}else\n{\n// Remove the transactions we aborted.\nqueue.length=lastSent+1;\n}\n// Now fire the callbacks.\nthis.eventQueue_.raiseEventsForChangedPath(node.path(),events);\nfor(var i=0;i<callbacks.length;i++){\nexceptionGuard(callbacks[i]);\n}\n}\n};\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n/**\r\n * Abstraction around FirebaseApp's token fetching capabilities.\r\n */\nvar FirebaseAuthTokenProvider=/** @class */function(){\nfunction FirebaseAuthTokenProvider(app_,authProvider_){\nvar _this=this;\nthis.app_=app_;\nthis.authProvider_=authProvider_;\nthis.auth_=null;\nthis.auth_=authProvider_.getImmediate({optional:true});\nif(!this.auth_){\nauthProvider_.get().then(function(auth){return _this.auth_=auth;});\n}\n}\n/**\r\n     * @param {boolean} forceRefresh\r\n     * @return {!Promise<FirebaseAuthTokenData>}\r\n     */\nFirebaseAuthTokenProvider.prototype.getToken=function(forceRefresh){\nif(!this.auth_){\nreturn Promise.resolve(null);\n}\nreturn this.auth_.getToken(forceRefresh).catch(function(error){\n// TODO: Need to figure out all the cases this is raised and whether\n// this makes sense.\nif(error&&error.code==='auth/token-not-initialized'){\nlog('Got auth/token-not-initialized error.  Treating as null token.');\nreturn null;\n}else\n{\nreturn Promise.reject(error);\n}\n});\n};\nFirebaseAuthTokenProvider.prototype.addTokenChangeListener=function(listener){\n// TODO: We might want to wrap the listener and call it with no args to\n// avoid a leaky abstraction, but that makes removing the listener harder.\nif(this.auth_){\nthis.auth_.addAuthTokenListener(listener);\n}else\n{\nsetTimeout(function(){return listener(null);},0);\nthis.authProvider_.\nget().\nthen(function(auth){return auth.addAuthTokenListener(listener);});\n}\n};\nFirebaseAuthTokenProvider.prototype.removeTokenChangeListener=function(listener){\nthis.authProvider_.\nget().\nthen(function(auth){return auth.removeAuthTokenListener(listener);});\n};\nFirebaseAuthTokenProvider.prototype.notifyForInvalidToken=function(){\nvar errorMessage='Provided authentication credentials for the app named \"'+\nthis.app_.name+\n'\" are invalid. This usually indicates your app was not '+\n'initialized correctly. ';\nif('credential'in this.app_.options){\nerrorMessage+=\n'Make sure the \"credential\" property provided to initializeApp() '+\n'is authorized to access the specified \"databaseURL\" and is from the correct '+\n'project.';\n}else\nif('serviceAccount'in this.app_.options){\nerrorMessage+=\n'Make sure the \"serviceAccount\" property provided to initializeApp() '+\n'is authorized to access the specified \"databaseURL\" and is from the correct '+\n'project.';\n}else\n{\nerrorMessage+=\n'Make sure the \"apiKey\" and \"databaseURL\" properties provided to '+\n'initializeApp() match the values provided for your app at '+\n'https://console.firebase.google.com/.';\n}\nwarn(errorMessage);\n};\nreturn FirebaseAuthTokenProvider;\n}();\n/* Auth token provider that the Admin SDK uses to connect to the Emulator. */\nvar EmulatorAdminTokenProvider=/** @class */function(){\nfunction EmulatorAdminTokenProvider(){\n}\nEmulatorAdminTokenProvider.prototype.getToken=function(forceRefresh){\nreturn Promise.resolve({\naccessToken:EmulatorAdminTokenProvider.EMULATOR_AUTH_TOKEN});\n\n};\nEmulatorAdminTokenProvider.prototype.addTokenChangeListener=function(listener){\n// Invoke the listener immediately to match the behavior in Firebase Auth\n// (see packages/auth/src/auth.js#L1807)\nlistener(EmulatorAdminTokenProvider.EMULATOR_AUTH_TOKEN);\n};\nEmulatorAdminTokenProvider.prototype.removeTokenChangeListener=function(listener){};\nEmulatorAdminTokenProvider.prototype.notifyForInvalidToken=function(){};\nEmulatorAdminTokenProvider.EMULATOR_AUTH_TOKEN='owner';\nreturn EmulatorAdminTokenProvider;\n}();\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n/**\r\n * This variable is also defined in the firebase node.js admin SDK. Before\r\n * modifying this definition, consult the definition in:\r\n *\r\n * https://github.com/firebase/firebase-admin-node\r\n *\r\n * and make sure the two are consistent.\r\n */\nvar FIREBASE_DATABASE_EMULATOR_HOST_VAR='FIREBASE_DATABASE_EMULATOR_HOST';\nvar _staticInstance;\n/**\r\n * Creates and caches Repo instances.\r\n */\nvar RepoManager=/** @class */function(){\nfunction RepoManager(){\n/**\r\n         * @private {!Object.<string, Object<string, !fb.core.Repo>>}\r\n         */\nthis.repos_={};\n/**\r\n         * If true, new Repos will be created to use ReadonlyRestClient (for testing purposes).\r\n         * @private {boolean}\r\n         */\nthis.useRestClient_=false;\n}\nRepoManager.getInstance=function(){\nif(!_staticInstance){\n_staticInstance=new RepoManager();\n}\nreturn _staticInstance;\n};\n// TODO(koss): Remove these functions unless used in tests?\nRepoManager.prototype.interrupt=function(){\nvar e_1,_a,e_2,_b;\ntry{\nfor(var _c=tslib.__values(Object.keys(this.repos_)),_d=_c.next();!_d.done;_d=_c.next()){\nvar appName=_d.value;\ntry{\nfor(var _e=(e_2=void 0,tslib.__values(Object.keys(this.repos_[appName]))),_f=_e.next();!_f.done;_f=_e.next()){\nvar dbUrl=_f.value;\nthis.repos_[appName][dbUrl].interrupt();\n}\n}\ncatch(e_2_1){e_2={error:e_2_1};}finally\n{\ntry{\nif(_f&&!_f.done&&(_b=_e.return))_b.call(_e);\n}finally\n{if(e_2)throw e_2.error;}\n}\n}\n}\ncatch(e_1_1){e_1={error:e_1_1};}finally\n{\ntry{\nif(_d&&!_d.done&&(_a=_c.return))_a.call(_c);\n}finally\n{if(e_1)throw e_1.error;}\n}\n};\nRepoManager.prototype.resume=function(){\nvar e_3,_a,e_4,_b;\ntry{\nfor(var _c=tslib.__values(Object.keys(this.repos_)),_d=_c.next();!_d.done;_d=_c.next()){\nvar appName=_d.value;\ntry{\nfor(var _e=(e_4=void 0,tslib.__values(Object.keys(this.repos_[appName]))),_f=_e.next();!_f.done;_f=_e.next()){\nvar dbUrl=_f.value;\nthis.repos_[appName][dbUrl].resume();\n}\n}\ncatch(e_4_1){e_4={error:e_4_1};}finally\n{\ntry{\nif(_f&&!_f.done&&(_b=_e.return))_b.call(_e);\n}finally\n{if(e_4)throw e_4.error;}\n}\n}\n}\ncatch(e_3_1){e_3={error:e_3_1};}finally\n{\ntry{\nif(_d&&!_d.done&&(_a=_c.return))_a.call(_c);\n}finally\n{if(e_3)throw e_3.error;}\n}\n};\n/**\r\n     * This function should only ever be called to CREATE a new database instance.\r\n     *\r\n     * @param {!FirebaseApp} app\r\n     * @return {!Database}\r\n     */\nRepoManager.prototype.databaseFromApp=function(app,authProvider,url,nodeAdmin){\nvar dbUrl=url||app.options.databaseURL;\nif(dbUrl===undefined){\nif(!app.options.projectId){\nfatal(\"Can't determine Firebase Database URL. Be sure to include \"+\n' a Project ID when calling firebase.initializeApp().');\n}\nlog('Using default host for project ',app.options.projectId);\ndbUrl=app.options.projectId+\"-default-rtdb.firebaseio.com\";\n}\nvar parsedUrl=parseRepoInfo(dbUrl,nodeAdmin);\nvar repoInfo=parsedUrl.repoInfo;\nvar isEmulator;\nvar dbEmulatorHost=undefined;\nif(typeof process!=='undefined'){\ndbEmulatorHost=process.env[FIREBASE_DATABASE_EMULATOR_HOST_VAR];\n}\nif(dbEmulatorHost){\nisEmulator=true;\ndbUrl=\"http://\"+dbEmulatorHost+\"?ns=\"+repoInfo.namespace;\nparsedUrl=parseRepoInfo(dbUrl,nodeAdmin);\nrepoInfo=parsedUrl.repoInfo;\n}else\n{\nisEmulator=!parsedUrl.repoInfo.secure;\n}\nvar authTokenProvider=nodeAdmin&&isEmulator?\nnew EmulatorAdminTokenProvider():\nnew FirebaseAuthTokenProvider(app,authProvider);\nvalidateUrl('Invalid Firebase Database URL',1,parsedUrl);\nif(!parsedUrl.path.isEmpty()){\nfatal('Database URL must point to the root of a Firebase Database '+\n'(not including a child path).');\n}\nvar repo=this.createRepo(repoInfo,app,authTokenProvider);\nreturn repo.database;\n};\n/**\r\n     * Remove the repo and make sure it is disconnected.\r\n     *\r\n     * @param {!Repo} repo\r\n     */\nRepoManager.prototype.deleteRepo=function(repo){\nvar appRepos=util.safeGet(this.repos_,repo.app.name);\n// This should never happen...\nif(!appRepos||util.safeGet(appRepos,repo.repoInfo_.toURLString())!==repo){\nfatal(\"Database \"+repo.app.name+\"(\"+repo.repoInfo_+\") has already been deleted.\");\n}\nrepo.interrupt();\ndelete appRepos[repo.repoInfo_.toURLString()];\n};\n/**\r\n     * Ensures a repo doesn't already exist and then creates one using the\r\n     * provided app.\r\n     *\r\n     * @param {!RepoInfo} repoInfo The metadata about the Repo\r\n     * @param {!FirebaseApp} app\r\n     * @return {!Repo} The Repo object for the specified server / repoName.\r\n     */\nRepoManager.prototype.createRepo=function(repoInfo,app,authTokenProvider){\nvar appRepos=util.safeGet(this.repos_,app.name);\nif(!appRepos){\nappRepos={};\nthis.repos_[app.name]=appRepos;\n}\nvar repo=util.safeGet(appRepos,repoInfo.toURLString());\nif(repo){\nfatal('Database initialized multiple times. Please make sure the format of the database URL matches with each database() call.');\n}\nrepo=new Repo(repoInfo,this.useRestClient_,app,authTokenProvider);\nappRepos[repoInfo.toURLString()]=repo;\nreturn repo;\n};\n/**\r\n     * Forces us to use ReadonlyRestClient instead of PersistentConnection for new Repos.\r\n     * @param {boolean} forceRestClient\r\n     */\nRepoManager.prototype.forceRestClient=function(forceRestClient){\nthis.useRestClient_=forceRestClient;\n};\nreturn RepoManager;\n}();\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n/**\r\n * Class representing a firebase database.\r\n * @implements {FirebaseService}\r\n */\nvar Database=/** @class */function(){\n/**\r\n     * The constructor should not be called by users of our public API.\r\n     * @param {!Repo} repo_\r\n     */\nfunction Database(repo_){\nthis.repo_=repo_;\nif(!(repo_ instanceof Repo)){\nfatal(\"Don't call new Database() directly - please use firebase.database().\");\n}\n/** @type {Reference} */\nthis.root_=new Reference(repo_,Path.Empty);\nthis.INTERNAL=new DatabaseInternals(this);\n}\nObject.defineProperty(Database.prototype,\"app\",{\nget:function get(){\nreturn this.repo_.app;\n},\nenumerable:false,\nconfigurable:true});\n\nDatabase.prototype.ref=function(path){\nthis.checkDeleted_('ref');\nutil.validateArgCount('database.ref',0,1,arguments.length);\nif(path instanceof Reference){\nreturn this.refFromURL(path.toString());\n}\nreturn path!==undefined?this.root_.child(path):this.root_;\n};\n/**\r\n     * Returns a reference to the root or the path specified in url.\r\n     * We throw a exception if the url is not in the same domain as the\r\n     * current repo.\r\n     * @param {string} url\r\n     * @return {!Reference} Firebase reference.\r\n     */\nDatabase.prototype.refFromURL=function(url){\n/** @const {string} */\nvar apiName='database.refFromURL';\nthis.checkDeleted_(apiName);\nutil.validateArgCount(apiName,1,1,arguments.length);\nvar parsedURL=parseRepoInfo(url,this.repo_.repoInfo_.nodeAdmin);\nvalidateUrl(apiName,1,parsedURL);\nvar repoInfo=parsedURL.repoInfo;\nif(repoInfo.host!==this.repo_.repoInfo_.host){\nfatal(apiName+\n': Host name does not match the current database: '+\n'(found '+\nrepoInfo.host+\n' but expected '+\nthis.repo_.repoInfo_.host+\n')');\n}\nreturn this.ref(parsedURL.path.toString());\n};\n/**\r\n     * @param {string} apiName\r\n     */\nDatabase.prototype.checkDeleted_=function(apiName){\nif(this.repo_===null){\nfatal('Cannot call '+apiName+' on a deleted database.');\n}\n};\n// Make individual repo go offline.\nDatabase.prototype.goOffline=function(){\nutil.validateArgCount('database.goOffline',0,0,arguments.length);\nthis.checkDeleted_('goOffline');\nthis.repo_.interrupt();\n};\nDatabase.prototype.goOnline=function(){\nutil.validateArgCount('database.goOnline',0,0,arguments.length);\nthis.checkDeleted_('goOnline');\nthis.repo_.resume();\n};\nDatabase.ServerValue={\nTIMESTAMP:{\n'.sv':'timestamp'},\n\nincrement:function increment(delta){\nreturn{\n'.sv':{\n'increment':delta}};\n\n\n}};\n\nreturn Database;\n}();\nvar DatabaseInternals=/** @class */function(){\n/** @param {!Database} database */\nfunction DatabaseInternals(database){\nthis.database=database;\n}\n/** @return {Promise<void>} */\nDatabaseInternals.prototype.delete=function(){\nreturn tslib.__awaiter(this,void 0,void 0,function(){\nreturn tslib.__generator(this,function(_a){\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nthis.database.checkDeleted_('delete');\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nRepoManager.getInstance().deleteRepo(this.database.repo_);\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nthis.database.repo_=null;\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nthis.database.root_=null;\nthis.database.INTERNAL=null;\nthis.database=null;\nreturn[2/*return*/];\n});\n});\n};\nreturn DatabaseInternals;\n}();\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n/**\r\n * INTERNAL methods for internal-use only (tests, etc.).\r\n *\r\n * Customers shouldn't use these or else should be aware that they could break at any time.\r\n *\r\n * @const\r\n */\nvar forceLongPolling=function forceLongPolling(){\nWebSocketConnection.forceDisallow();\nBrowserPollConnection.forceAllow();\n};\nvar forceWebSockets=function forceWebSockets(){\nBrowserPollConnection.forceDisallow();\n};\n/* Used by App Manager */\nvar isWebSocketsAvailable=function isWebSocketsAvailable(){\nreturn WebSocketConnection['isAvailable']();\n};\nvar setSecurityDebugCallback=function setSecurityDebugCallback(ref,callback){\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nref.repo.persistentConnection_.securityDebugCallback_=callback;\n};\nvar stats=function stats(ref,showDelta){\nref.repo.stats(showDelta);\n};\nvar statsIncrementCounter=function statsIncrementCounter(ref,metric){\nref.repo.statsIncrementCounter(metric);\n};\nvar dataUpdateCount=function dataUpdateCount(ref){\nreturn ref.repo.dataUpdateCount;\n};\nvar interceptServerData=function interceptServerData(ref,callback){\nreturn ref.repo.interceptServerData_(callback);\n};\n\nvar INTERNAL=/*#__PURE__*/Object.freeze({\n__proto__:null,\nforceLongPolling:forceLongPolling,\nforceWebSockets:forceWebSockets,\nisWebSocketsAvailable:isWebSocketsAvailable,\nsetSecurityDebugCallback:setSecurityDebugCallback,\nstats:stats,\nstatsIncrementCounter:statsIncrementCounter,\ndataUpdateCount:dataUpdateCount,\ninterceptServerData:interceptServerData});\n\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\nvar DataConnection=PersistentConnection;\n/**\r\n * @param {!string} pathString\r\n * @param {function(*)} onComplete\r\n */\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nPersistentConnection.prototype.simpleListen=function(pathString,onComplete){\nthis.sendRequest('q',{p:pathString},onComplete);\n};\n/**\r\n * @param {*} data\r\n * @param {function(*)} onEcho\r\n */\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nPersistentConnection.prototype.echo=function(data,onEcho){\nthis.sendRequest('echo',{d:data},onEcho);\n};\n// RealTimeConnection properties that we use in tests.\nvar RealTimeConnection=Connection;\n/**\r\n * @param {function(): string} newHash\r\n * @return {function()}\r\n */\nvar hijackHash=function hijackHash(newHash){\nvar oldPut=PersistentConnection.prototype.put;\nPersistentConnection.prototype.put=function(pathString,data,onComplete,hash){\nif(hash!==undefined){\nhash=newHash();\n}\noldPut.call(this,pathString,data,onComplete,hash);\n};\nreturn function(){\nPersistentConnection.prototype.put=oldPut;\n};\n};\n/**\r\n * @type {function(new:RepoInfo, !string, boolean, !string, boolean): undefined}\r\n */\nvar ConnectionTarget=RepoInfo;\n/**\r\n * @param {!Query} query\r\n * @return {!string}\r\n */\nvar queryIdentifier=function queryIdentifier(query){\nreturn query.queryIdentifier();\n};\n/**\r\n * Forces the RepoManager to create Repos that use ReadonlyRestClient instead of PersistentConnection.\r\n *\r\n * @param {boolean} forceRestClient\r\n */\nvar forceRestClient=function forceRestClient(_forceRestClient){\nRepoManager.getInstance().forceRestClient(_forceRestClient);\n};\n\nvar TEST_ACCESS=/*#__PURE__*/Object.freeze({\n__proto__:null,\nDataConnection:DataConnection,\nRealTimeConnection:RealTimeConnection,\nhijackHash:hijackHash,\nConnectionTarget:ConnectionTarget,\nqueryIdentifier:queryIdentifier,\nforceRestClient:forceRestClient});\n\n\nvar name=\"@firebase/database\";\nvar version=\"0.6.13\";\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\nvar ServerValue=Database.ServerValue;\nfunction registerDatabase(instance){\n// set SDK_VERSION\nsetSDKVersion(instance.SDK_VERSION);\n// Register the Database Service with the 'firebase' namespace.\nvar namespace=instance.INTERNAL.registerComponent(new component.Component('database',function(container,url){\n/* Dependencies */\n// getImmediate for FirebaseApp will always succeed\nvar app=container.getProvider('app').getImmediate();\nvar authProvider=container.getProvider('auth-internal');\nreturn RepoManager.getInstance().databaseFromApp(app,authProvider,url);\n},\"PUBLIC\"/* PUBLIC */).\nsetServiceProps(\n// firebase.database namespace properties\n{\nReference:Reference,\nQuery:Query,\nDatabase:Database,\nDataSnapshot:DataSnapshot,\nenableLogging:enableLogging,\nINTERNAL:INTERNAL,\nServerValue:ServerValue,\nTEST_ACCESS:TEST_ACCESS}).\n\nsetMultipleInstances(true));\ninstance.registerVersion(name,version);\nif(util.isNodeSdk()){\nmodule.exports=namespace;\n}\n}\nregisterDatabase(firebase__default['default']);\n\nexports.DataSnapshot=DataSnapshot;\nexports.Database=Database;\nexports.OnDisconnect=OnDisconnect;\nexports.Query=Query;\nexports.Reference=Reference;\nexports.ServerValue=ServerValue;\nexports.enableLogging=enableLogging;\nexports.registerDatabase=registerDatabase;\n//# sourceMappingURL=index.cjs.js.map\n/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(12)))\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/@firebase/database/dist/index.cjs.js\n// module id = 20\n// module chunks = 0\n\n//# sourceURL=webpack:///./~/@firebase/database/dist/index.cjs.js?");

/***/ }),
/* 21 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("Object.defineProperty(exports, \"__esModule\", { value: true });exports.registerStorage = undefined;var _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) {return typeof obj;} : function (obj) {return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;};var _app = __webpack_require__(6);var _app2 = _interopRequireDefault(_app);\nvar _tslib = __webpack_require__(3);\nvar _component = __webpack_require__(8);function _interopRequireDefault(obj) {return obj && obj.__esModule ? obj : { default: obj };}\n\n/**\r\n                                                                                                                                               * @license\r\n                                                                                                                                               * Copyright 2017 Google LLC\r\n                                                                                                                                               *\r\n                                                                                                                                               * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n                                                                                                                                               * you may not use this file except in compliance with the License.\r\n                                                                                                                                               * You may obtain a copy of the License at\r\n                                                                                                                                               *\r\n                                                                                                                                               *   http://www.apache.org/licenses/LICENSE-2.0\r\n                                                                                                                                               *\r\n                                                                                                                                               * Unless required by applicable law or agreed to in writing, software\r\n                                                                                                                                               * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n                                                                                                                                               * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n                                                                                                                                               * See the License for the specific language governing permissions and\r\n                                                                                                                                               * limitations under the License.\r\n                                                                                                                                               */\n/**\r\n                                                                                                                                                   * @fileoverview Constants used in the Firebase Storage library.\r\n                                                                                                                                                   */\n/**\r\n                                                                                                                                                       * Domain name for firebase storage.\r\n                                                                                                                                                       */\nvar DEFAULT_HOST = 'firebasestorage.googleapis.com';\n/**\r\n                                                      * The key in Firebase config json for the storage bucket.\r\n                                                      */\nvar CONFIG_STORAGE_BUCKET_KEY = 'storageBucket';\n/**\r\n                                                  * 2 minutes\r\n                                                  *\r\n                                                  * The timeout for all operations except upload.\r\n                                                  */\nvar DEFAULT_MAX_OPERATION_RETRY_TIME = 2 * 60 * 1000;\n/**\r\n                                                       * 10 minutes\r\n                                                       *\r\n                                                       * The timeout for upload.\r\n                                                       */\nvar DEFAULT_MAX_UPLOAD_RETRY_TIME = 10 * 60 * 1000;\n\n/**\r\n                                                     * @license\r\n                                                     * Copyright 2017 Google LLC\r\n                                                     *\r\n                                                     * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n                                                     * you may not use this file except in compliance with the License.\r\n                                                     * You may obtain a copy of the License at\r\n                                                     *\r\n                                                     *   http://www.apache.org/licenses/LICENSE-2.0\r\n                                                     *\r\n                                                     * Unless required by applicable law or agreed to in writing, software\r\n                                                     * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n                                                     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n                                                     * See the License for the specific language governing permissions and\r\n                                                     * limitations under the License.\r\n                                                     */\nvar FirebaseStorageError = /** @class */function () {\n    function FirebaseStorageError(code, message) {\n        this.code_ = prependCode(code);\n        this.message_ = 'Firebase Storage: ' + message;\n        this.serverResponse_ = null;\n        this.name_ = 'FirebaseError';\n    }\n    FirebaseStorageError.prototype.codeProp = function () {\n        return this.code;\n    };\n    FirebaseStorageError.prototype.codeEquals = function (code) {\n        return prependCode(code) === this.codeProp();\n    };\n    FirebaseStorageError.prototype.serverResponseProp = function () {\n        return this.serverResponse_;\n    };\n    FirebaseStorageError.prototype.setServerResponseProp = function (serverResponse) {\n        this.serverResponse_ = serverResponse;\n    };\n    Object.defineProperty(FirebaseStorageError.prototype, \"name\", {\n        get: function get() {\n            return this.name_;\n        },\n        enumerable: false,\n        configurable: true });\n\n    Object.defineProperty(FirebaseStorageError.prototype, \"code\", {\n        get: function get() {\n            return this.code_;\n        },\n        enumerable: false,\n        configurable: true });\n\n    Object.defineProperty(FirebaseStorageError.prototype, \"message\", {\n        get: function get() {\n            if (this.serverResponse_) {\n                return this.message_ + '\\n' + this.serverResponse_;\n            } else\n            {\n                return this.message_;\n            }\n        },\n        enumerable: false,\n        configurable: true });\n\n    Object.defineProperty(FirebaseStorageError.prototype, \"serverResponse\", {\n        get: function get() {\n            return this.serverResponse_;\n        },\n        enumerable: false,\n        configurable: true });\n\n    return FirebaseStorageError;\n}();\nvar Code = {\n    // Shared between all platforms\n    UNKNOWN: 'unknown',\n    OBJECT_NOT_FOUND: 'object-not-found',\n    BUCKET_NOT_FOUND: 'bucket-not-found',\n    PROJECT_NOT_FOUND: 'project-not-found',\n    QUOTA_EXCEEDED: 'quota-exceeded',\n    UNAUTHENTICATED: 'unauthenticated',\n    UNAUTHORIZED: 'unauthorized',\n    RETRY_LIMIT_EXCEEDED: 'retry-limit-exceeded',\n    INVALID_CHECKSUM: 'invalid-checksum',\n    CANCELED: 'canceled',\n    // JS specific\n    INVALID_EVENT_NAME: 'invalid-event-name',\n    INVALID_URL: 'invalid-url',\n    INVALID_DEFAULT_BUCKET: 'invalid-default-bucket',\n    NO_DEFAULT_BUCKET: 'no-default-bucket',\n    CANNOT_SLICE_BLOB: 'cannot-slice-blob',\n    SERVER_FILE_WRONG_SIZE: 'server-file-wrong-size',\n    NO_DOWNLOAD_URL: 'no-download-url',\n    INVALID_ARGUMENT: 'invalid-argument',\n    INVALID_ARGUMENT_COUNT: 'invalid-argument-count',\n    APP_DELETED: 'app-deleted',\n    INVALID_ROOT_OPERATION: 'invalid-root-operation',\n    INVALID_FORMAT: 'invalid-format',\n    INTERNAL_ERROR: 'internal-error' };\n\nfunction prependCode(code) {\n    return 'storage/' + code;\n}\nfunction unknown() {\n    var message = 'An unknown error occurred, please check the error payload for ' +\n    'server response.';\n    return new FirebaseStorageError(Code.UNKNOWN, message);\n}\nfunction objectNotFound(path) {\n    return new FirebaseStorageError(Code.OBJECT_NOT_FOUND, \"Object '\" + path + \"' does not exist.\");\n}\nfunction quotaExceeded(bucket) {\n    return new FirebaseStorageError(Code.QUOTA_EXCEEDED, \"Quota for bucket '\" +\n    bucket +\n    \"' exceeded, please view quota on \" +\n    'https://firebase.google.com/pricing/.');\n}\nfunction unauthenticated() {\n    var message = 'User is not authenticated, please authenticate using Firebase ' +\n    'Authentication and try again.';\n    return new FirebaseStorageError(Code.UNAUTHENTICATED, message);\n}\nfunction unauthorized(path) {\n    return new FirebaseStorageError(Code.UNAUTHORIZED, \"User does not have permission to access '\" + path + \"'.\");\n}\nfunction retryLimitExceeded() {\n    return new FirebaseStorageError(Code.RETRY_LIMIT_EXCEEDED, 'Max retry time for operation exceeded, please try again.');\n}\nfunction canceled() {\n    return new FirebaseStorageError(Code.CANCELED, 'User canceled the upload/download.');\n}\nfunction invalidUrl(url) {\n    return new FirebaseStorageError(Code.INVALID_URL, \"Invalid URL '\" + url + \"'.\");\n}\nfunction invalidDefaultBucket(bucket) {\n    return new FirebaseStorageError(Code.INVALID_DEFAULT_BUCKET, \"Invalid default bucket '\" + bucket + \"'.\");\n}\nfunction cannotSliceBlob() {\n    return new FirebaseStorageError(Code.CANNOT_SLICE_BLOB, 'Cannot slice blob for upload. Please retry the upload.');\n}\nfunction serverFileWrongSize() {\n    return new FirebaseStorageError(Code.SERVER_FILE_WRONG_SIZE, 'Server recorded incorrect upload file size, please retry the upload.');\n}\nfunction noDownloadURL() {\n    return new FirebaseStorageError(Code.NO_DOWNLOAD_URL, 'The given file does not have any download URLs.');\n}\nfunction invalidArgument(index, fnName, message) {\n    return new FirebaseStorageError(Code.INVALID_ARGUMENT, 'Invalid argument in `' + fnName + '` at index ' + index + ': ' + message);\n}\nfunction invalidArgumentCount(argMin, argMax, fnName, real) {\n    var countPart;\n    var plural;\n    if (argMin === argMax) {\n        countPart = argMin;\n        plural = argMin === 1 ? 'argument' : 'arguments';\n    } else\n    {\n        countPart = 'between ' + argMin + ' and ' + argMax;\n        plural = 'arguments';\n    }\n    return new FirebaseStorageError(Code.INVALID_ARGUMENT_COUNT, 'Invalid argument count in `' +\n    fnName +\n    '`: Expected ' +\n    countPart +\n    ' ' +\n    plural +\n    ', received ' +\n    real +\n    '.');\n}\nfunction appDeleted() {\n    return new FirebaseStorageError(Code.APP_DELETED, 'The Firebase app was deleted.');\n}\n/**\r\n   * @param name The name of the operation that was invalid.\r\n   */\nfunction invalidRootOperation(name) {\n    return new FirebaseStorageError(Code.INVALID_ROOT_OPERATION, \"The operation '\" +\n    name +\n    \"' cannot be performed on a root reference, create a non-root \" +\n    \"reference using child, such as .child('file.png').\");\n}\n/**\r\n   * @param format The format that was not valid.\r\n   * @param message A message describing the format violation.\r\n   */\nfunction invalidFormat(format, message) {\n    return new FirebaseStorageError(Code.INVALID_FORMAT, \"String does not match format '\" + format + \"': \" + message);\n}\n/**\r\n   * @param message A message describing the internal error.\r\n   */\nfunction internalError(message) {\n    throw new FirebaseStorageError(Code.INTERNAL_ERROR, 'Internal error: ' + message);\n}\n\n/**\r\n   * @license\r\n   * Copyright 2017 Google LLC\r\n   *\r\n   * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n   * you may not use this file except in compliance with the License.\r\n   * You may obtain a copy of the License at\r\n   *\r\n   *   http://www.apache.org/licenses/LICENSE-2.0\r\n   *\r\n   * Unless required by applicable law or agreed to in writing, software\r\n   * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n   * See the License for the specific language governing permissions and\r\n   * limitations under the License.\r\n   */\nvar StringFormat = {\n    RAW: 'raw',\n    BASE64: 'base64',\n    BASE64URL: 'base64url',\n    DATA_URL: 'data_url' };\n\nfunction formatValidator(stringFormat) {\n    switch (stringFormat) {\n        case StringFormat.RAW:\n        case StringFormat.BASE64:\n        case StringFormat.BASE64URL:\n        case StringFormat.DATA_URL:\n            return;\n        default:\n            throw 'Expected one of the event types: [' +\n            StringFormat.RAW +\n            ', ' +\n            StringFormat.BASE64 +\n            ', ' +\n            StringFormat.BASE64URL +\n            ', ' +\n            StringFormat.DATA_URL +\n            '].';}\n\n}\n/**\r\n   * @struct\r\n   */\nvar StringData = /** @class */function () {\n    function StringData(data, contentType) {\n        this.data = data;\n        this.contentType = contentType || null;\n    }\n    return StringData;\n}();\nfunction dataFromString(format, stringData) {\n    switch (format) {\n        case StringFormat.RAW:\n            return new StringData(utf8Bytes_(stringData));\n        case StringFormat.BASE64:\n        case StringFormat.BASE64URL:\n            return new StringData(base64Bytes_(format, stringData));\n        case StringFormat.DATA_URL:\n            return new StringData(dataURLBytes_(stringData), dataURLContentType_(stringData));\n        // do nothing\n    }\n    // assert(false);\n    throw unknown();\n}\nfunction utf8Bytes_(value) {\n    var b = [];\n    for (var i = 0; i < value.length; i++) {\n        var c = value.charCodeAt(i);\n        if (c <= 127) {\n            b.push(c);\n        } else\n        {\n            if (c <= 2047) {\n                b.push(192 | c >> 6, 128 | c & 63);\n            } else\n            {\n                if ((c & 64512) === 55296) {\n                    // The start of a surrogate pair.\n                    var valid = i < value.length - 1 && (value.charCodeAt(i + 1) & 64512) === 56320;\n                    if (!valid) {\n                        // The second surrogate wasn't there.\n                        b.push(239, 191, 189);\n                    } else\n                    {\n                        var hi = c;\n                        var lo = value.charCodeAt(++i);\n                        c = 65536 | (hi & 1023) << 10 | lo & 1023;\n                        b.push(240 | c >> 18, 128 | c >> 12 & 63, 128 | c >> 6 & 63, 128 | c & 63);\n                    }\n                } else\n                {\n                    if ((c & 64512) === 56320) {\n                        // Invalid low surrogate.\n                        b.push(239, 191, 189);\n                    } else\n                    {\n                        b.push(224 | c >> 12, 128 | c >> 6 & 63, 128 | c & 63);\n                    }\n                }\n            }\n        }\n    }\n    return new Uint8Array(b);\n}\nfunction percentEncodedBytes_(value) {\n    var decoded;\n    try {\n        decoded = decodeURIComponent(value);\n    }\n    catch (e) {\n        throw invalidFormat(StringFormat.DATA_URL, 'Malformed data URL.');\n    }\n    return utf8Bytes_(decoded);\n}\nfunction base64Bytes_(format, value) {\n    switch (format) {\n        case StringFormat.BASE64:{\n                var hasMinus = value.indexOf('-') !== -1;\n                var hasUnder = value.indexOf('_') !== -1;\n                if (hasMinus || hasUnder) {\n                    var invalidChar = hasMinus ? '-' : '_';\n                    throw invalidFormat(format, \"Invalid character '\" +\n                    invalidChar +\n                    \"' found: is it base64url encoded?\");\n                }\n                break;\n            }\n        case StringFormat.BASE64URL:{\n                var hasPlus = value.indexOf('+') !== -1;\n                var hasSlash = value.indexOf('/') !== -1;\n                if (hasPlus || hasSlash) {\n                    var invalidChar = hasPlus ? '+' : '/';\n                    throw invalidFormat(format, \"Invalid character '\" + invalidChar + \"' found: is it base64 encoded?\");\n                }\n                value = value.replace(/-/g, '+').replace(/_/g, '/');\n                break;\n            }\n        // do nothing\n    }\n    var bytes;\n    try {\n        bytes = atob(value);\n    }\n    catch (e) {\n        throw invalidFormat(format, 'Invalid character found');\n    }\n    var array = new Uint8Array(bytes.length);\n    for (var i = 0; i < bytes.length; i++) {\n        array[i] = bytes.charCodeAt(i);\n    }\n    return array;\n}\n/**\r\n   * @struct\r\n   */\nvar DataURLParts = /** @class */function () {\n    function DataURLParts(dataURL) {\n        this.base64 = false;\n        this.contentType = null;\n        var matches = dataURL.match(/^data:([^,]+)?,/);\n        if (matches === null) {\n            throw invalidFormat(StringFormat.DATA_URL, \"Must be formatted 'data:[<mediatype>][;base64],<data>\");\n        }\n        var middle = matches[1] || null;\n        if (middle != null) {\n            this.base64 = endsWith(middle, ';base64');\n            this.contentType = this.base64 ?\n            middle.substring(0, middle.length - ';base64'.length) :\n            middle;\n        }\n        this.rest = dataURL.substring(dataURL.indexOf(',') + 1);\n    }\n    return DataURLParts;\n}();\nfunction dataURLBytes_(dataUrl) {\n    var parts = new DataURLParts(dataUrl);\n    if (parts.base64) {\n        return base64Bytes_(StringFormat.BASE64, parts.rest);\n    } else\n    {\n        return percentEncodedBytes_(parts.rest);\n    }\n}\nfunction dataURLContentType_(dataUrl) {\n    var parts = new DataURLParts(dataUrl);\n    return parts.contentType;\n}\nfunction endsWith(s, end) {\n    var longEnough = s.length >= end.length;\n    if (!longEnough) {\n        return false;\n    }\n    return s.substring(s.length - end.length) === end;\n}\n\n/**\r\n   * @license\r\n   * Copyright 2017 Google LLC\r\n   *\r\n   * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n   * you may not use this file except in compliance with the License.\r\n   * You may obtain a copy of the License at\r\n   *\r\n   *   http://www.apache.org/licenses/LICENSE-2.0\r\n   *\r\n   * Unless required by applicable law or agreed to in writing, software\r\n   * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n   * See the License for the specific language governing permissions and\r\n   * limitations under the License.\r\n   */\nvar TaskEvent = {\n    /** Triggered whenever the task changes or progress is updated. */\n    STATE_CHANGED: 'state_changed' };\n\nvar InternalTaskState = {\n    RUNNING: 'running',\n    PAUSING: 'pausing',\n    PAUSED: 'paused',\n    SUCCESS: 'success',\n    CANCELING: 'canceling',\n    CANCELED: 'canceled',\n    ERROR: 'error' };\n\nvar TaskState = {\n    /** The task is currently transferring data. */\n    RUNNING: 'running',\n    /** The task was paused by the user. */\n    PAUSED: 'paused',\n    /** The task completed successfully. */\n    SUCCESS: 'success',\n    /** The task was canceled. */\n    CANCELED: 'canceled',\n    /** The task failed with an error. */\n    ERROR: 'error' };\n\nfunction taskStateFromInternalTaskState(state) {\n    switch (state) {\n        case InternalTaskState.RUNNING:\n        case InternalTaskState.PAUSING:\n        case InternalTaskState.CANCELING:\n            return TaskState.RUNNING;\n        case InternalTaskState.PAUSED:\n            return TaskState.PAUSED;\n        case InternalTaskState.SUCCESS:\n            return TaskState.SUCCESS;\n        case InternalTaskState.CANCELED:\n            return TaskState.CANCELED;\n        case InternalTaskState.ERROR:\n            return TaskState.ERROR;\n        default:\n            // TODO(andysoto): assert(false);\n            return TaskState.ERROR;}\n\n}\n\n/**\r\n   * @license\r\n   * Copyright 2017 Google LLC\r\n   *\r\n   * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n   * you may not use this file except in compliance with the License.\r\n   * You may obtain a copy of the License at\r\n   *\r\n   *   http://www.apache.org/licenses/LICENSE-2.0\r\n   *\r\n   * Unless required by applicable law or agreed to in writing, software\r\n   * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n   * See the License for the specific language governing permissions and\r\n   * limitations under the License.\r\n   */\n/**\r\n       * @return False if the object is undefined or null, true otherwise.\r\n       */\nfunction isDef(p) {\n    return p != null;\n}\nfunction isJustDef(p) {\n    return p !== void 0;\n}\n// eslint-disable-next-line @typescript-eslint/ban-types\nfunction isFunction(p) {\n    return typeof p === 'function';\n}\nfunction isObject(p) {\n    return (typeof p === 'undefined' ? 'undefined' : _typeof(p)) === 'object';\n}\nfunction isNonNullObject(p) {\n    return isObject(p) && p !== null;\n}\nfunction isNonArrayObject(p) {\n    return isObject(p) && !Array.isArray(p);\n}\nfunction isString(p) {\n    return typeof p === 'string' || p instanceof String;\n}\nfunction isInteger(p) {\n    return isNumber(p) && Number.isInteger(p);\n}\nfunction isNumber(p) {\n    return typeof p === 'number' || p instanceof Number;\n}\nfunction isNativeBlob(p) {\n    return isNativeBlobDefined() && p instanceof Blob;\n}\nfunction isNativeBlobDefined() {\n    return typeof Blob !== 'undefined';\n}\n\n/**\r\n   * @license\r\n   * Copyright 2017 Google LLC\r\n   *\r\n   * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n   * you may not use this file except in compliance with the License.\r\n   * You may obtain a copy of the License at\r\n   *\r\n   *   http://www.apache.org/licenses/LICENSE-2.0\r\n   *\r\n   * Unless required by applicable law or agreed to in writing, software\r\n   * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n   * See the License for the specific language governing permissions and\r\n   * limitations under the License.\r\n   */\n/**\r\n       * @enum{number}\r\n       */\nvar ErrorCode;\n(function (ErrorCode) {\n    ErrorCode[ErrorCode[\"NO_ERROR\"] = 0] = \"NO_ERROR\";\n    ErrorCode[ErrorCode[\"NETWORK_ERROR\"] = 1] = \"NETWORK_ERROR\";\n    ErrorCode[ErrorCode[\"ABORT\"] = 2] = \"ABORT\";\n})(ErrorCode || (ErrorCode = {}));\n\n/**\r\n                                    * @license\r\n                                    * Copyright 2017 Google LLC\r\n                                    *\r\n                                    * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n                                    * you may not use this file except in compliance with the License.\r\n                                    * You may obtain a copy of the License at\r\n                                    *\r\n                                    *   http://www.apache.org/licenses/LICENSE-2.0\r\n                                    *\r\n                                    * Unless required by applicable law or agreed to in writing, software\r\n                                    * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n                                    * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n                                    * See the License for the specific language governing permissions and\r\n                                    * limitations under the License.\r\n                                    */\n/**\r\n                                        * We use this instead of goog.net.XhrIo because goog.net.XhrIo is hyuuuuge and\r\n                                        * doesn't work in React Native on Android.\r\n                                        */\nvar NetworkXhrIo = /** @class */function () {\n    function NetworkXhrIo() {\n        var _this = this;\n        this.sent_ = false;\n        this.xhr_ = new XMLHttpRequest();\n        this.errorCode_ = ErrorCode.NO_ERROR;\n        this.sendPromise_ = new Promise(function (resolve) {\n            _this.xhr_.addEventListener('abort', function () {\n                _this.errorCode_ = ErrorCode.ABORT;\n                resolve(_this);\n            });\n            _this.xhr_.addEventListener('error', function () {\n                _this.errorCode_ = ErrorCode.NETWORK_ERROR;\n                resolve(_this);\n            });\n            _this.xhr_.addEventListener('load', function () {\n                resolve(_this);\n            });\n        });\n    }\n    /**\r\n       * @override\r\n       */\n    NetworkXhrIo.prototype.send = function (url, method, body, headers) {\n        if (this.sent_) {\n            throw internalError('cannot .send() more than once');\n        }\n        this.sent_ = true;\n        this.xhr_.open(method, url, true);\n        if (isDef(headers)) {\n            for (var key in headers) {\n                if (headers.hasOwnProperty(key)) {\n                    this.xhr_.setRequestHeader(key, headers[key].toString());\n                }\n            }\n        }\n        if (isDef(body)) {\n            this.xhr_.send(body);\n        } else\n        {\n            this.xhr_.send();\n        }\n        return this.sendPromise_;\n    };\n    /**\r\n        * @override\r\n        */\n    NetworkXhrIo.prototype.getErrorCode = function () {\n        if (!this.sent_) {\n            throw internalError('cannot .getErrorCode() before sending');\n        }\n        return this.errorCode_;\n    };\n    /**\r\n        * @override\r\n        */\n    NetworkXhrIo.prototype.getStatus = function () {\n        if (!this.sent_) {\n            throw internalError('cannot .getStatus() before sending');\n        }\n        try {\n            return this.xhr_.status;\n        }\n        catch (e) {\n            return -1;\n        }\n    };\n    /**\r\n        * @override\r\n        */\n    NetworkXhrIo.prototype.getResponseText = function () {\n        if (!this.sent_) {\n            throw internalError('cannot .getResponseText() before sending');\n        }\n        return this.xhr_.responseText;\n    };\n    /**\r\n        * Aborts the request.\r\n        * @override\r\n        */\n    NetworkXhrIo.prototype.abort = function () {\n        this.xhr_.abort();\n    };\n    /**\r\n        * @override\r\n        */\n    NetworkXhrIo.prototype.getResponseHeader = function (header) {\n        return this.xhr_.getResponseHeader(header);\n    };\n    /**\r\n        * @override\r\n        */\n    NetworkXhrIo.prototype.addUploadProgressListener = function (listener) {\n        if (isDef(this.xhr_.upload)) {\n            this.xhr_.upload.addEventListener('progress', listener);\n        }\n    };\n    /**\r\n        * @override\r\n        */\n    NetworkXhrIo.prototype.removeUploadProgressListener = function (listener) {\n        if (isDef(this.xhr_.upload)) {\n            this.xhr_.upload.removeEventListener('progress', listener);\n        }\n    };\n    return NetworkXhrIo;\n}();\n\n/**\r\n      * @license\r\n      * Copyright 2017 Google LLC\r\n      *\r\n      * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n      * you may not use this file except in compliance with the License.\r\n      * You may obtain a copy of the License at\r\n      *\r\n      *   http://www.apache.org/licenses/LICENSE-2.0\r\n      *\r\n      * Unless required by applicable law or agreed to in writing, software\r\n      * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n      * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n      * See the License for the specific language governing permissions and\r\n      * limitations under the License.\r\n      */\n/**\r\n          * Factory-like class for creating XhrIo instances.\r\n          */\nvar XhrIoPool = /** @class */function () {\n    function XhrIoPool() {\n    }\n    XhrIoPool.prototype.createXhrIo = function () {\n        return new NetworkXhrIo();\n    };\n    return XhrIoPool;\n}();\n\n/**\r\n      * @license\r\n      * Copyright 2017 Google LLC\r\n      *\r\n      * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n      * you may not use this file except in compliance with the License.\r\n      * You may obtain a copy of the License at\r\n      *\r\n      *   http://www.apache.org/licenses/LICENSE-2.0\r\n      *\r\n      * Unless required by applicable law or agreed to in writing, software\r\n      * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n      * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n      * See the License for the specific language governing permissions and\r\n      * limitations under the License.\r\n      */\nfunction getBlobBuilder() {\n    if (typeof BlobBuilder !== 'undefined') {\n        return BlobBuilder;\n    } else\n    if (typeof WebKitBlobBuilder !== 'undefined') {\n        return WebKitBlobBuilder;\n    } else\n    {\n        return undefined;\n    }\n}\n/**\r\n   * Concatenates one or more values together and converts them to a Blob.\r\n   *\r\n   * @param args The values that will make up the resulting blob.\r\n   * @return The blob.\r\n   */\nfunction getBlob() {\n    var args = [];\n    for (var _i = 0; _i < arguments.length; _i++) {\n        args[_i] = arguments[_i];\n    }\n    var BlobBuilder = getBlobBuilder();\n    if (BlobBuilder !== undefined) {\n        var bb = new BlobBuilder();\n        for (var i = 0; i < args.length; i++) {\n            bb.append(args[i]);\n        }\n        return bb.getBlob();\n    } else\n    {\n        if (isNativeBlobDefined()) {\n            return new Blob(args);\n        } else\n        {\n            throw Error(\"This browser doesn't seem to support creating Blobs\");\n        }\n    }\n}\n/**\r\n   * Slices the blob. The returned blob contains data from the start byte\r\n   * (inclusive) till the end byte (exclusive). Negative indices cannot be used.\r\n   *\r\n   * @param blob The blob to be sliced.\r\n   * @param start Index of the starting byte.\r\n   * @param end Index of the ending byte.\r\n   * @return The blob slice or null if not supported.\r\n   */\nfunction sliceBlob(blob, start, end) {\n    if (blob.webkitSlice) {\n        return blob.webkitSlice(start, end);\n    } else\n    if (blob.mozSlice) {\n        return blob.mozSlice(start, end);\n    } else\n    if (blob.slice) {\n        return blob.slice(start, end);\n    }\n    return null;\n}\n\n/**\r\n   * @license\r\n   * Copyright 2017 Google LLC\r\n   *\r\n   * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n   * you may not use this file except in compliance with the License.\r\n   * You may obtain a copy of the License at\r\n   *\r\n   *   http://www.apache.org/licenses/LICENSE-2.0\r\n   *\r\n   * Unless required by applicable law or agreed to in writing, software\r\n   * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n   * See the License for the specific language governing permissions and\r\n   * limitations under the License.\r\n   */\n/**\r\n       * @param opt_elideCopy If true, doesn't copy mutable input data\r\n       *     (e.g. Uint8Arrays). Pass true only if you know the objects will not be\r\n       *     modified after this blob's construction.\r\n       */\nvar FbsBlob = /** @class */function () {\n    function FbsBlob(data, elideCopy) {\n        var size = 0;\n        var blobType = '';\n        if (isNativeBlob(data)) {\n            this.data_ = data;\n            size = data.size;\n            blobType = data.type;\n        } else\n        if (data instanceof ArrayBuffer) {\n            if (elideCopy) {\n                this.data_ = new Uint8Array(data);\n            } else\n            {\n                this.data_ = new Uint8Array(data.byteLength);\n                this.data_.set(new Uint8Array(data));\n            }\n            size = this.data_.length;\n        } else\n        if (data instanceof Uint8Array) {\n            if (elideCopy) {\n                this.data_ = data;\n            } else\n            {\n                this.data_ = new Uint8Array(data.length);\n                this.data_.set(data);\n            }\n            size = data.length;\n        }\n        this.size_ = size;\n        this.type_ = blobType;\n    }\n    FbsBlob.prototype.size = function () {\n        return this.size_;\n    };\n    FbsBlob.prototype.type = function () {\n        return this.type_;\n    };\n    FbsBlob.prototype.slice = function (startByte, endByte) {\n        if (isNativeBlob(this.data_)) {\n            var realBlob = this.data_;\n            var sliced = sliceBlob(realBlob, startByte, endByte);\n            if (sliced === null) {\n                return null;\n            }\n            return new FbsBlob(sliced);\n        } else\n        {\n            var slice = new Uint8Array(this.data_.buffer, startByte, endByte - startByte);\n            return new FbsBlob(slice, true);\n        }\n    };\n    FbsBlob.getBlob = function () {\n        var args = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            args[_i] = arguments[_i];\n        }\n        if (isNativeBlobDefined()) {\n            var blobby = args.map(function (val) {\n                if (val instanceof FbsBlob) {\n                    return val.data_;\n                } else\n                {\n                    return val;\n                }\n            });\n            return new FbsBlob(getBlob.apply(null, blobby));\n        } else\n        {\n            var uint8Arrays = args.map(function (val) {\n                if (isString(val)) {\n                    return dataFromString(StringFormat.RAW, val).data;\n                } else\n                {\n                    // Blobs don't exist, so this has to be a Uint8Array.\n                    return val.data_;\n                }\n            });\n            var finalLength_1 = 0;\n            uint8Arrays.forEach(function (array) {\n                finalLength_1 += array.byteLength;\n            });\n            var merged_1 = new Uint8Array(finalLength_1);\n            var index_1 = 0;\n            uint8Arrays.forEach(function (array) {\n                for (var i = 0; i < array.length; i++) {\n                    merged_1[index_1++] = array[i];\n                }\n            });\n            return new FbsBlob(merged_1, true);\n        }\n    };\n    FbsBlob.prototype.uploadData = function () {\n        return this.data_;\n    };\n    return FbsBlob;\n}();\n\n/**\r\n      * @license\r\n      * Copyright 2017 Google LLC\r\n      *\r\n      * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n      * you may not use this file except in compliance with the License.\r\n      * You may obtain a copy of the License at\r\n      *\r\n      *   http://www.apache.org/licenses/LICENSE-2.0\r\n      *\r\n      * Unless required by applicable law or agreed to in writing, software\r\n      * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n      * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n      * See the License for the specific language governing permissions and\r\n      * limitations under the License.\r\n      */\n/**\r\n          * @struct\r\n          */\nvar Location = /** @class */function () {\n    function Location(bucket, path) {\n        this.bucket = bucket;\n        this.path_ = path;\n    }\n    Object.defineProperty(Location.prototype, \"path\", {\n        get: function get() {\n            return this.path_;\n        },\n        enumerable: false,\n        configurable: true });\n\n    Object.defineProperty(Location.prototype, \"isRoot\", {\n        get: function get() {\n            return this.path.length === 0;\n        },\n        enumerable: false,\n        configurable: true });\n\n    Location.prototype.fullServerUrl = function () {\n        var encode = encodeURIComponent;\n        return '/b/' + encode(this.bucket) + '/o/' + encode(this.path);\n    };\n    Location.prototype.bucketOnlyServerUrl = function () {\n        var encode = encodeURIComponent;\n        return '/b/' + encode(this.bucket) + '/o';\n    };\n    Location.makeFromBucketSpec = function (bucketString) {\n        var bucketLocation;\n        try {\n            bucketLocation = Location.makeFromUrl(bucketString);\n        }\n        catch (e) {\n            // Not valid URL, use as-is. This lets you put bare bucket names in\n            // config.\n            return new Location(bucketString, '');\n        }\n        if (bucketLocation.path === '') {\n            return bucketLocation;\n        } else\n        {\n            throw invalidDefaultBucket(bucketString);\n        }\n    };\n    Location.makeFromUrl = function (url) {\n        var location = null;\n        var bucketDomain = '([A-Za-z0-9.\\\\-_]+)';\n        function gsModify(loc) {\n            if (loc.path.charAt(loc.path.length - 1) === '/') {\n                loc.path_ = loc.path_.slice(0, -1);\n            }\n        }\n        var gsPath = '(/(.*))?$';\n        var gsRegex = new RegExp('^gs://' + bucketDomain + gsPath, 'i');\n        var gsIndices = { bucket: 1, path: 3 };\n        function httpModify(loc) {\n            loc.path_ = decodeURIComponent(loc.path);\n        }\n        var version = 'v[A-Za-z0-9_]+';\n        var firebaseStorageHost = DEFAULT_HOST.replace(/[.]/g, '\\\\.');\n        var firebaseStoragePath = '(/([^?#]*).*)?$';\n        var firebaseStorageRegExp = new RegExp(\"^https?://\" + firebaseStorageHost + \"/\" + version + \"/b/\" + bucketDomain + \"/o\" + firebaseStoragePath, 'i');\n        var firebaseStorageIndices = { bucket: 1, path: 3 };\n        var cloudStorageHost = '(?:storage.googleapis.com|storage.cloud.google.com)';\n        var cloudStoragePath = '([^?#]*)';\n        var cloudStorageRegExp = new RegExp(\"^https?://\" + cloudStorageHost + \"/\" + bucketDomain + \"/\" + cloudStoragePath, 'i');\n        var cloudStorageIndices = { bucket: 1, path: 2 };\n        var groups = [\n        { regex: gsRegex, indices: gsIndices, postModify: gsModify },\n        {\n            regex: firebaseStorageRegExp,\n            indices: firebaseStorageIndices,\n            postModify: httpModify },\n\n        {\n            regex: cloudStorageRegExp,\n            indices: cloudStorageIndices,\n            postModify: httpModify }];\n\n\n        for (var i = 0; i < groups.length; i++) {\n            var group = groups[i];\n            var captures = group.regex.exec(url);\n            if (captures) {\n                var bucketValue = captures[group.indices.bucket];\n                var pathValue = captures[group.indices.path];\n                if (!pathValue) {\n                    pathValue = '';\n                }\n                location = new Location(bucketValue, pathValue);\n                group.postModify(location);\n                break;\n            }\n        }\n        if (location == null) {\n            throw invalidUrl(url);\n        }\n        return location;\n    };\n    return Location;\n}();\n\n/**\r\n      * @license\r\n      * Copyright 2017 Google LLC\r\n      *\r\n      * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n      * you may not use this file except in compliance with the License.\r\n      * You may obtain a copy of the License at\r\n      *\r\n      *   http://www.apache.org/licenses/LICENSE-2.0\r\n      *\r\n      * Unless required by applicable law or agreed to in writing, software\r\n      * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n      * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n      * See the License for the specific language governing permissions and\r\n      * limitations under the License.\r\n      */\n/**\r\n          * Returns the Object resulting from parsing the given JSON, or null if the\r\n          * given string does not represent a JSON object.\r\n          */\nfunction jsonObjectOrNull(s) {\n    var obj;\n    try {\n        obj = JSON.parse(s);\n    }\n    catch (e) {\n        return null;\n    }\n    if (isNonArrayObject(obj)) {\n        return obj;\n    } else\n    {\n        return null;\n    }\n}\n\n/**\r\n   * @license\r\n   * Copyright 2017 Google LLC\r\n   *\r\n   * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n   * you may not use this file except in compliance with the License.\r\n   * You may obtain a copy of the License at\r\n   *\r\n   *   http://www.apache.org/licenses/LICENSE-2.0\r\n   *\r\n   * Unless required by applicable law or agreed to in writing, software\r\n   * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n   * See the License for the specific language governing permissions and\r\n   * limitations under the License.\r\n   */\n/**\r\n       * @fileoverview Contains helper methods for manipulating paths.\r\n       */\n/**\r\n           * @return Null if the path is already at the root.\r\n           */\nfunction parent(path) {\n    if (path.length === 0) {\n        return null;\n    }\n    var index = path.lastIndexOf('/');\n    if (index === -1) {\n        return '';\n    }\n    var newPath = path.slice(0, index);\n    return newPath;\n}\nfunction child(path, childPath) {\n    var canonicalChildPath = childPath.\n    split('/').\n    filter(function (component) {return component.length > 0;}).\n    join('/');\n    if (path.length === 0) {\n        return canonicalChildPath;\n    } else\n    {\n        return path + '/' + canonicalChildPath;\n    }\n}\n/**\r\n   * Returns the last component of a path.\r\n   * '/foo/bar' -> 'bar'\r\n   * '/foo/bar/baz/' -> 'baz/'\r\n   * '/a' -> 'a'\r\n   */\nfunction lastComponent(path) {\n    var index = path.lastIndexOf('/', path.length - 2);\n    if (index === -1) {\n        return path;\n    } else\n    {\n        return path.slice(index + 1);\n    }\n}\n\n/**\r\n   * @license\r\n   * Copyright 2017 Google LLC\r\n   *\r\n   * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n   * you may not use this file except in compliance with the License.\r\n   * You may obtain a copy of the License at\r\n   *\r\n   *   http://www.apache.org/licenses/LICENSE-2.0\r\n   *\r\n   * Unless required by applicable law or agreed to in writing, software\r\n   * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n   * See the License for the specific language governing permissions and\r\n   * limitations under the License.\r\n   */\nfunction makeUrl(urlPart) {\n    return \"https://\" + DEFAULT_HOST + \"/v0\" + urlPart;\n}\nfunction makeQueryString(params) {\n    var encode = encodeURIComponent;\n    var queryPart = '?';\n    for (var key in params) {\n        if (params.hasOwnProperty(key)) {\n            // @ts-ignore TODO: remove once typescript is upgraded to 3.5.x\n            var nextPart = encode(key) + '=' + encode(params[key]);\n            queryPart = queryPart + nextPart + '&';\n        }\n    }\n    // Chop off the extra '&' or '?' on the end\n    queryPart = queryPart.slice(0, -1);\n    return queryPart;\n}\n\n/**\r\n   * @license\r\n   * Copyright 2017 Google LLC\r\n   *\r\n   * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n   * you may not use this file except in compliance with the License.\r\n   * You may obtain a copy of the License at\r\n   *\r\n   *   http://www.apache.org/licenses/LICENSE-2.0\r\n   *\r\n   * Unless required by applicable law or agreed to in writing, software\r\n   * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n   * See the License for the specific language governing permissions and\r\n   * limitations under the License.\r\n   */\nfunction noXform_(metadata, value) {\n    return value;\n}\n/**\r\n   * @struct\r\n   */\nvar Mapping = /** @class */function () {\n    function Mapping(server, local, writable, xform) {\n        this.server = server;\n        this.local = local || server;\n        this.writable = !!writable;\n        this.xform = xform || noXform_;\n    }\n    return Mapping;\n}();\nvar mappings_ = null;\nfunction xformPath(fullPath) {\n    if (!isString(fullPath) || fullPath.length < 2) {\n        return fullPath;\n    } else\n    {\n        return lastComponent(fullPath);\n    }\n}\nfunction getMappings() {\n    if (mappings_) {\n        return mappings_;\n    }\n    var mappings = [];\n    mappings.push(new Mapping('bucket'));\n    mappings.push(new Mapping('generation'));\n    mappings.push(new Mapping('metageneration'));\n    mappings.push(new Mapping('name', 'fullPath', true));\n    function mappingsXformPath(_metadata, fullPath) {\n        return xformPath(fullPath);\n    }\n    var nameMapping = new Mapping('name');\n    nameMapping.xform = mappingsXformPath;\n    mappings.push(nameMapping);\n    /**\r\n                                 * Coerces the second param to a number, if it is defined.\r\n                                 */\n    function xformSize(_metadata, size) {\n        if (isDef(size)) {\n            return Number(size);\n        } else\n        {\n            return size;\n        }\n    }\n    var sizeMapping = new Mapping('size');\n    sizeMapping.xform = xformSize;\n    mappings.push(sizeMapping);\n    mappings.push(new Mapping('timeCreated'));\n    mappings.push(new Mapping('updated'));\n    mappings.push(new Mapping('md5Hash', null, true));\n    mappings.push(new Mapping('cacheControl', null, true));\n    mappings.push(new Mapping('contentDisposition', null, true));\n    mappings.push(new Mapping('contentEncoding', null, true));\n    mappings.push(new Mapping('contentLanguage', null, true));\n    mappings.push(new Mapping('contentType', null, true));\n    mappings.push(new Mapping('metadata', 'customMetadata', true));\n    mappings_ = mappings;\n    return mappings_;\n}\nfunction addRef(metadata, service) {\n    function generateRef() {\n        var bucket = metadata['bucket'];\n        var path = metadata['fullPath'];\n        var loc = new Location(bucket, path);\n        return service.makeStorageReference(loc);\n    }\n    Object.defineProperty(metadata, 'ref', { get: generateRef });\n}\nfunction fromResource(service, resource, mappings) {\n    var metadata = {};\n    metadata['type'] = 'file';\n    var len = mappings.length;\n    for (var i = 0; i < len; i++) {\n        var mapping = mappings[i];\n        metadata[mapping.local] = mapping.xform(metadata, resource[mapping.server]);\n    }\n    addRef(metadata, service);\n    return metadata;\n}\nfunction fromResourceString(service, resourceString, mappings) {\n    var obj = jsonObjectOrNull(resourceString);\n    if (obj === null) {\n        return null;\n    }\n    var resource = obj;\n    return fromResource(service, resource, mappings);\n}\nfunction downloadUrlFromResourceString(metadata, resourceString) {\n    var obj = jsonObjectOrNull(resourceString);\n    if (obj === null) {\n        return null;\n    }\n    if (!isString(obj['downloadTokens'])) {\n        // This can happen if objects are uploaded through GCS and retrieved\n        // through list, so we don't want to throw an Error.\n        return null;\n    }\n    var tokens = obj['downloadTokens'];\n    if (tokens.length === 0) {\n        return null;\n    }\n    var encode = encodeURIComponent;\n    var tokensList = tokens.split(',');\n    var urls = tokensList.map(function (token) {\n        var bucket = metadata['bucket'];\n        var path = metadata['fullPath'];\n        var urlPart = '/b/' + encode(bucket) + '/o/' + encode(path);\n        var base = makeUrl(urlPart);\n        var queryString = makeQueryString({\n            alt: 'media',\n            token: token });\n\n        return base + queryString;\n    });\n    return urls[0];\n}\nfunction toResourceString(metadata, mappings) {\n    var resource = {};\n    var len = mappings.length;\n    for (var i = 0; i < len; i++) {\n        var mapping = mappings[i];\n        if (mapping.writable) {\n            resource[mapping.server] = metadata[mapping.local];\n        }\n    }\n    return JSON.stringify(resource);\n}\nfunction metadataValidator(p) {\n    if (!isObject(p) || !p) {\n        throw 'Expected Metadata object.';\n    }\n    for (var key in p) {\n        if (p.hasOwnProperty(key)) {\n            var val = p[key];\n            if (key === 'customMetadata') {\n                if (!isObject(val)) {\n                    throw 'Expected object for \\'customMetadata\\' mapping.';\n                }\n            } else\n            {\n                if (isNonNullObject(val)) {\n                    throw \"Mapping for '\" + key + \"' cannot be an object.\";\n                }\n            }\n        }\n    }\n}\n\n/**\r\n   * @license\r\n   * Copyright 2019 Google LLC\r\n   *\r\n   * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n   * you may not use this file except in compliance with the License.\r\n   * You may obtain a copy of the License at\r\n   *\r\n   *   http://www.apache.org/licenses/LICENSE-2.0\r\n   *\r\n   * Unless required by applicable law or agreed to in writing, software\r\n   * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n   * See the License for the specific language governing permissions and\r\n   * limitations under the License.\r\n   */\nvar MAX_RESULTS_KEY = 'maxResults';\nvar MAX_MAX_RESULTS = 1000;\nvar PAGE_TOKEN_KEY = 'pageToken';\nvar PREFIXES_KEY = 'prefixes';\nvar ITEMS_KEY = 'items';\nfunction fromBackendResponse(service, bucket, resource) {\n    var listResult = {\n        prefixes: [],\n        items: [],\n        nextPageToken: resource['nextPageToken'] };\n\n    if (resource[PREFIXES_KEY]) {\n        for (var _i = 0, _a = resource[PREFIXES_KEY]; _i < _a.length; _i++) {\n            var path = _a[_i];\n            var pathWithoutTrailingSlash = path.replace(/\\/$/, '');\n            var reference = service.makeStorageReference(new Location(bucket, pathWithoutTrailingSlash));\n            listResult.prefixes.push(reference);\n        }\n    }\n    if (resource[ITEMS_KEY]) {\n        for (var _b = 0, _c = resource[ITEMS_KEY]; _b < _c.length; _b++) {\n            var item = _c[_b];\n            var reference = service.makeStorageReference(new Location(bucket, item['name']));\n            listResult.items.push(reference);\n        }\n    }\n    return listResult;\n}\nfunction fromResponseString(service, bucket, resourceString) {\n    var obj = jsonObjectOrNull(resourceString);\n    if (obj === null) {\n        return null;\n    }\n    var resource = obj;\n    return fromBackendResponse(service, bucket, resource);\n}\nfunction listOptionsValidator(p) {\n    if (!isObject(p) || !p) {\n        throw 'Expected ListOptions object.';\n    }\n    for (var key in p) {\n        if (key === MAX_RESULTS_KEY) {\n            if (!isInteger(p[MAX_RESULTS_KEY]) ||\n            p[MAX_RESULTS_KEY] <= 0) {\n                throw 'Expected maxResults to be a positive number.';\n            }\n            if (p[MAX_RESULTS_KEY] > 1000) {\n                throw \"Expected maxResults to be less than or equal to \" + MAX_MAX_RESULTS + \".\";\n            }\n        } else\n        if (key === PAGE_TOKEN_KEY) {\n            if (p[PAGE_TOKEN_KEY] && !isString(p[PAGE_TOKEN_KEY])) {\n                throw 'Expected pageToken to be string.';\n            }\n        } else\n        {\n            throw 'Unknown option: ' + key;\n        }\n    }\n}\n\nvar RequestInfo = /** @class */function () {\n    function RequestInfo(url, method,\n    /**\r\n                                       * Returns the value with which to resolve the request's promise. Only called\r\n                                       * if the request is successful. Throw from this function to reject the\r\n                                       * returned Request's promise with the thrown error.\r\n                                       * Note: The XhrIo passed to this function may be reused after this callback\r\n                                       * returns. Do not keep a reference to it in any way.\r\n                                       */\n    handler, timeout) {\n        this.url = url;\n        this.method = method;\n        this.handler = handler;\n        this.timeout = timeout;\n        this.urlParams = {};\n        this.headers = {};\n        this.body = null;\n        this.errorHandler = null;\n        /**\r\n                                   * Called with the current number of bytes uploaded and total size (-1 if not\r\n                                   * computable) of the request body (i.e. used to report upload progress).\r\n                                   */\n        this.progressCallback = null;\n        this.successCodes = [200];\n        this.additionalRetryCodes = [];\n    }\n    return RequestInfo;\n}();\n\n/**\r\n      * @license\r\n      * Copyright 2017 Google LLC\r\n      *\r\n      * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n      * you may not use this file except in compliance with the License.\r\n      * You may obtain a copy of the License at\r\n      *\r\n      *   http://www.apache.org/licenses/LICENSE-2.0\r\n      *\r\n      * Unless required by applicable law or agreed to in writing, software\r\n      * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n      * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n      * See the License for the specific language governing permissions and\r\n      * limitations under the License.\r\n      */\n/**\r\n          * Throws the UNKNOWN FirebaseStorageError if cndn is false.\r\n          */\nfunction handlerCheck(cndn) {\n    if (!cndn) {\n        throw unknown();\n    }\n}\nfunction metadataHandler(service, mappings) {\n    function handler(xhr, text) {\n        var metadata = fromResourceString(service, text, mappings);\n        handlerCheck(metadata !== null);\n        return metadata;\n    }\n    return handler;\n}\nfunction listHandler(service, bucket) {\n    function handler(xhr, text) {\n        var listResult = fromResponseString(service, bucket, text);\n        handlerCheck(listResult !== null);\n        return listResult;\n    }\n    return handler;\n}\nfunction downloadUrlHandler(service, mappings) {\n    function handler(xhr, text) {\n        var metadata = fromResourceString(service, text, mappings);\n        handlerCheck(metadata !== null);\n        return downloadUrlFromResourceString(metadata, text);\n    }\n    return handler;\n}\nfunction sharedErrorHandler(location) {\n    function errorHandler(xhr, err) {\n        var newErr;\n        if (xhr.getStatus() === 401) {\n            newErr = unauthenticated();\n        } else\n        {\n            if (xhr.getStatus() === 402) {\n                newErr = quotaExceeded(location.bucket);\n            } else\n            {\n                if (xhr.getStatus() === 403) {\n                    newErr = unauthorized(location.path);\n                } else\n                {\n                    newErr = err;\n                }\n            }\n        }\n        newErr.setServerResponseProp(err.serverResponseProp());\n        return newErr;\n    }\n    return errorHandler;\n}\nfunction objectErrorHandler(location) {\n    var shared = sharedErrorHandler(location);\n    function errorHandler(xhr, err) {\n        var newErr = shared(xhr, err);\n        if (xhr.getStatus() === 404) {\n            newErr = objectNotFound(location.path);\n        }\n        newErr.setServerResponseProp(err.serverResponseProp());\n        return newErr;\n    }\n    return errorHandler;\n}\nfunction getMetadata(service, location, mappings) {\n    var urlPart = location.fullServerUrl();\n    var url = makeUrl(urlPart);\n    var method = 'GET';\n    var timeout = service.maxOperationRetryTime;\n    var requestInfo = new RequestInfo(url, method, metadataHandler(service, mappings), timeout);\n    requestInfo.errorHandler = objectErrorHandler(location);\n    return requestInfo;\n}\nfunction list(service, location, delimiter, pageToken, maxResults) {\n    var urlParams = {};\n    if (location.isRoot) {\n        urlParams['prefix'] = '';\n    } else\n    {\n        urlParams['prefix'] = location.path + '/';\n    }\n    if (delimiter && delimiter.length > 0) {\n        urlParams['delimiter'] = delimiter;\n    }\n    if (pageToken) {\n        urlParams['pageToken'] = pageToken;\n    }\n    if (maxResults) {\n        urlParams['maxResults'] = maxResults;\n    }\n    var urlPart = location.bucketOnlyServerUrl();\n    var url = makeUrl(urlPart);\n    var method = 'GET';\n    var timeout = service.maxOperationRetryTime;\n    var requestInfo = new RequestInfo(url, method, listHandler(service, location.bucket), timeout);\n    requestInfo.urlParams = urlParams;\n    requestInfo.errorHandler = sharedErrorHandler(location);\n    return requestInfo;\n}\nfunction getDownloadUrl(service, location, mappings) {\n    var urlPart = location.fullServerUrl();\n    var url = makeUrl(urlPart);\n    var method = 'GET';\n    var timeout = service.maxOperationRetryTime;\n    var requestInfo = new RequestInfo(url, method, downloadUrlHandler(service, mappings), timeout);\n    requestInfo.errorHandler = objectErrorHandler(location);\n    return requestInfo;\n}\nfunction updateMetadata(service, location, metadata, mappings) {\n    var urlPart = location.fullServerUrl();\n    var url = makeUrl(urlPart);\n    var method = 'PATCH';\n    var body = toResourceString(metadata, mappings);\n    var headers = { 'Content-Type': 'application/json; charset=utf-8' };\n    var timeout = service.maxOperationRetryTime;\n    var requestInfo = new RequestInfo(url, method, metadataHandler(service, mappings), timeout);\n    requestInfo.headers = headers;\n    requestInfo.body = body;\n    requestInfo.errorHandler = objectErrorHandler(location);\n    return requestInfo;\n}\nfunction deleteObject(service, location) {\n    var urlPart = location.fullServerUrl();\n    var url = makeUrl(urlPart);\n    var method = 'DELETE';\n    var timeout = service.maxOperationRetryTime;\n    function handler(_xhr, _text) {}\n    var requestInfo = new RequestInfo(url, method, handler, timeout);\n    requestInfo.successCodes = [200, 204];\n    requestInfo.errorHandler = objectErrorHandler(location);\n    return requestInfo;\n}\nfunction determineContentType_(metadata, blob) {\n    return metadata && metadata['contentType'] ||\n    blob && blob.type() ||\n    'application/octet-stream';\n}\nfunction metadataForUpload_(location, blob, metadata) {\n    var metadataClone = Object.assign({}, metadata);\n    metadataClone['fullPath'] = location.path;\n    metadataClone['size'] = blob.size();\n    if (!metadataClone['contentType']) {\n        metadataClone['contentType'] = determineContentType_(null, blob);\n    }\n    return metadataClone;\n}\nfunction multipartUpload(service, location, mappings, blob, metadata) {\n    var urlPart = location.bucketOnlyServerUrl();\n    var headers = {\n        'X-Goog-Upload-Protocol': 'multipart' };\n\n    function genBoundary() {\n        var str = '';\n        for (var i = 0; i < 2; i++) {\n            str = str + Math.random().toString().slice(2);\n        }\n        return str;\n    }\n    var boundary = genBoundary();\n    headers['Content-Type'] = 'multipart/related; boundary=' + boundary;\n    var metadata_ = metadataForUpload_(location, blob, metadata);\n    var metadataString = toResourceString(metadata_, mappings);\n    var preBlobPart = '--' +\n    boundary +\n    '\\r\\n' +\n    'Content-Type: application/json; charset=utf-8\\r\\n\\r\\n' +\n    metadataString +\n    '\\r\\n--' +\n    boundary +\n    '\\r\\n' +\n    'Content-Type: ' +\n    metadata_['contentType'] +\n    '\\r\\n\\r\\n';\n    var postBlobPart = '\\r\\n--' + boundary + '--';\n    var body = FbsBlob.getBlob(preBlobPart, blob, postBlobPart);\n    if (body === null) {\n        throw cannotSliceBlob();\n    }\n    var urlParams = { name: metadata_['fullPath'] };\n    var url = makeUrl(urlPart);\n    var method = 'POST';\n    var timeout = service.maxUploadRetryTime;\n    var requestInfo = new RequestInfo(url, method, metadataHandler(service, mappings), timeout);\n    requestInfo.urlParams = urlParams;\n    requestInfo.headers = headers;\n    requestInfo.body = body.uploadData();\n    requestInfo.errorHandler = sharedErrorHandler(location);\n    return requestInfo;\n}\n/**\r\n   * @param current The number of bytes that have been uploaded so far.\r\n   * @param total The total number of bytes in the upload.\r\n   * @param opt_finalized True if the server has finished the upload.\r\n   * @param opt_metadata The upload metadata, should\r\n   *     only be passed if opt_finalized is true.\r\n   * @struct\r\n   */\nvar ResumableUploadStatus = /** @class */function () {\n    function ResumableUploadStatus(current, total, finalized, metadata) {\n        this.current = current;\n        this.total = total;\n        this.finalized = !!finalized;\n        this.metadata = metadata || null;\n    }\n    return ResumableUploadStatus;\n}();\nfunction checkResumeHeader_(xhr, allowed) {\n    var status = null;\n    try {\n        status = xhr.getResponseHeader('X-Goog-Upload-Status');\n    }\n    catch (e) {\n        handlerCheck(false);\n    }\n    var allowedStatus = allowed || ['active'];\n    handlerCheck(!!status && allowedStatus.indexOf(status) !== -1);\n    return status;\n}\nfunction createResumableUpload(service, location, mappings, blob, metadata) {\n    var urlPart = location.bucketOnlyServerUrl();\n    var metadataForUpload = metadataForUpload_(location, blob, metadata);\n    var urlParams = { name: metadataForUpload['fullPath'] };\n    var url = makeUrl(urlPart);\n    var method = 'POST';\n    var headers = {\n        'X-Goog-Upload-Protocol': 'resumable',\n        'X-Goog-Upload-Command': 'start',\n        'X-Goog-Upload-Header-Content-Length': blob.size(),\n        'X-Goog-Upload-Header-Content-Type': metadataForUpload['contentType'],\n        'Content-Type': 'application/json; charset=utf-8' };\n\n    var body = toResourceString(metadataForUpload, mappings);\n    var timeout = service.maxUploadRetryTime;\n    function handler(xhr) {\n        checkResumeHeader_(xhr);\n        var url;\n        try {\n            url = xhr.getResponseHeader('X-Goog-Upload-URL');\n        }\n        catch (e) {\n            handlerCheck(false);\n        }\n        handlerCheck(isString(url));\n        return url;\n    }\n    var requestInfo = new RequestInfo(url, method, handler, timeout);\n    requestInfo.urlParams = urlParams;\n    requestInfo.headers = headers;\n    requestInfo.body = body;\n    requestInfo.errorHandler = sharedErrorHandler(location);\n    return requestInfo;\n}\n/**\r\n   * @param url From a call to fbs.requests.createResumableUpload.\r\n   */\nfunction getResumableUploadStatus(service, location, url, blob) {\n    var headers = { 'X-Goog-Upload-Command': 'query' };\n    function handler(xhr) {\n        var status = checkResumeHeader_(xhr, ['active', 'final']);\n        var sizeString = null;\n        try {\n            sizeString = xhr.getResponseHeader('X-Goog-Upload-Size-Received');\n        }\n        catch (e) {\n            handlerCheck(false);\n        }\n        if (!sizeString) {\n            // null or empty string\n            handlerCheck(false);\n        }\n        var size = Number(sizeString);\n        handlerCheck(!isNaN(size));\n        return new ResumableUploadStatus(size, blob.size(), status === 'final');\n    }\n    var method = 'POST';\n    var timeout = service.maxUploadRetryTime;\n    var requestInfo = new RequestInfo(url, method, handler, timeout);\n    requestInfo.headers = headers;\n    requestInfo.errorHandler = sharedErrorHandler(location);\n    return requestInfo;\n}\n/**\r\n   * Any uploads via the resumable upload API must transfer a number of bytes\r\n   * that is a multiple of this number.\r\n   */\nvar resumableUploadChunkSize = 256 * 1024;\n/**\r\n                                            * @param url From a call to fbs.requests.createResumableUpload.\r\n                                            * @param chunkSize Number of bytes to upload.\r\n                                            * @param status The previous status.\r\n                                            *     If not passed or null, we start from the beginning.\r\n                                            * @throws fbs.Error If the upload is already complete, the passed in status\r\n                                            *     has a final size inconsistent with the blob, or the blob cannot be sliced\r\n                                            *     for upload.\r\n                                            */\nfunction continueResumableUpload(location, service, url, blob, chunkSize, mappings, status, progressCallback) {\n    // TODO(andysoto): standardize on internal asserts\n    // assert(!(opt_status && opt_status.finalized));\n    var status_ = new ResumableUploadStatus(0, 0);\n    if (status) {\n        status_.current = status.current;\n        status_.total = status.total;\n    } else\n    {\n        status_.current = 0;\n        status_.total = blob.size();\n    }\n    if (blob.size() !== status_.total) {\n        throw serverFileWrongSize();\n    }\n    var bytesLeft = status_.total - status_.current;\n    var bytesToUpload = bytesLeft;\n    if (chunkSize > 0) {\n        bytesToUpload = Math.min(bytesToUpload, chunkSize);\n    }\n    var startByte = status_.current;\n    var endByte = startByte + bytesToUpload;\n    var uploadCommand = bytesToUpload === bytesLeft ? 'upload, finalize' : 'upload';\n    var headers = {\n        'X-Goog-Upload-Command': uploadCommand,\n        'X-Goog-Upload-Offset': status_.current };\n\n    var body = blob.slice(startByte, endByte);\n    if (body === null) {\n        throw cannotSliceBlob();\n    }\n    function handler(xhr, text) {\n        // TODO(andysoto): Verify the MD5 of each uploaded range:\n        // the 'x-range-md5' header comes back with status code 308 responses.\n        // We'll only be able to bail out though, because you can't re-upload a\n        // range that you previously uploaded.\n        var uploadStatus = checkResumeHeader_(xhr, ['active', 'final']);\n        var newCurrent = status_.current + bytesToUpload;\n        var size = blob.size();\n        var metadata;\n        if (uploadStatus === 'final') {\n            metadata = metadataHandler(service, mappings)(xhr, text);\n        } else\n        {\n            metadata = null;\n        }\n        return new ResumableUploadStatus(newCurrent, size, uploadStatus === 'final', metadata);\n    }\n    var method = 'POST';\n    var timeout = service.maxUploadRetryTime;\n    var requestInfo = new RequestInfo(url, method, handler, timeout);\n    requestInfo.headers = headers;\n    requestInfo.body = body.uploadData();\n    requestInfo.progressCallback = progressCallback || null;\n    requestInfo.errorHandler = sharedErrorHandler(location);\n    return requestInfo;\n}\n\n/**\r\n   * @license\r\n   * Copyright 2017 Google LLC\r\n   *\r\n   * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n   * you may not use this file except in compliance with the License.\r\n   * You may obtain a copy of the License at\r\n   *\r\n   *   http://www.apache.org/licenses/LICENSE-2.0\r\n   *\r\n   * Unless required by applicable law or agreed to in writing, software\r\n   * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n   * See the License for the specific language governing permissions and\r\n   * limitations under the License.\r\n   */\n/**\r\n       * @struct\r\n       */\nvar Observer = /** @class */function () {\n    function Observer(nextOrObserver, error, complete) {\n        var asFunctions = isFunction(nextOrObserver) ||\n        isDef(error) ||\n        isDef(complete);\n        if (asFunctions) {\n            this.next = nextOrObserver;\n            this.error = error || null;\n            this.complete = complete || null;\n        } else\n        {\n            var observer = nextOrObserver;\n            this.next = observer.next || null;\n            this.error = observer.error || null;\n            this.complete = observer.complete || null;\n        }\n    }\n    return Observer;\n}();\n\nvar UploadTaskSnapshot = /** @class */function () {\n    function UploadTaskSnapshot(bytesTransferred, totalBytes, state, metadata, task, ref) {\n        this.bytesTransferred = bytesTransferred;\n        this.totalBytes = totalBytes;\n        this.state = state;\n        this.metadata = metadata;\n        this.task = task;\n        this.ref = ref;\n    }\n    return UploadTaskSnapshot;\n}();\n\n/**\r\n      * @license\r\n      * Copyright 2017 Google LLC\r\n      *\r\n      * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n      * you may not use this file except in compliance with the License.\r\n      * You may obtain a copy of the License at\r\n      *\r\n      *   http://www.apache.org/licenses/LICENSE-2.0\r\n      *\r\n      * Unless required by applicable law or agreed to in writing, software\r\n      * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n      * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n      * See the License for the specific language governing permissions and\r\n      * limitations under the License.\r\n      */\n/**\r\n          * @param name Name of the function.\r\n          * @param specs Argument specs.\r\n          * @param passed The actual arguments passed to the function.\r\n          * @throws {fbs.Error} If the arguments are invalid.\r\n          */\nfunction validate(name, specs, passed) {\n    var minArgs = specs.length;\n    var maxArgs = specs.length;\n    for (var i = 0; i < specs.length; i++) {\n        if (specs[i].optional) {\n            minArgs = i;\n            break;\n        }\n    }\n    var validLength = minArgs <= passed.length && passed.length <= maxArgs;\n    if (!validLength) {\n        throw invalidArgumentCount(minArgs, maxArgs, name, passed.length);\n    }\n    for (var i = 0; i < passed.length; i++) {\n        try {\n            specs[i].validator(passed[i]);\n        }\n        catch (e) {\n            if (e instanceof Error) {\n                throw invalidArgument(i, name, e.message);\n            } else\n            {\n                throw invalidArgument(i, name, e);\n            }\n        }\n    }\n}\n/**\r\n   * @struct\r\n   */\nvar ArgSpec = /** @class */function () {\n    function ArgSpec(validator, optional) {\n        var self = this;\n        this.validator = function (p) {\n            if (self.optional && !isJustDef(p)) {\n                return;\n            }\n            validator(p);\n        };\n        this.optional = !!optional;\n    }\n    return ArgSpec;\n}();\nfunction and_(v1, v2) {\n    return function (p) {\n        v1(p);\n        v2(p);\n    };\n}\nfunction stringSpec(validator, optional) {\n    function stringValidator(p) {\n        if (!isString(p)) {\n            throw 'Expected string.';\n        }\n    }\n    var chainedValidator;\n    if (validator) {\n        chainedValidator = and_(stringValidator, validator);\n    } else\n    {\n        chainedValidator = stringValidator;\n    }\n    return new ArgSpec(chainedValidator, optional);\n}\nfunction uploadDataSpec() {\n    function validator(p) {\n        var valid = p instanceof Uint8Array ||\n        p instanceof ArrayBuffer ||\n        isNativeBlobDefined() && p instanceof Blob;\n        if (!valid) {\n            throw 'Expected Blob or File.';\n        }\n    }\n    return new ArgSpec(validator);\n}\nfunction metadataSpec(optional) {\n    return new ArgSpec(metadataValidator, optional);\n}\nfunction listOptionSpec(optional) {\n    return new ArgSpec(listOptionsValidator, optional);\n}\nfunction nonNegativeNumberSpec() {\n    function validator(p) {\n        var valid = isNumber(p) && p >= 0;\n        if (!valid) {\n            throw 'Expected a number 0 or greater.';\n        }\n    }\n    return new ArgSpec(validator);\n}\nfunction looseObjectSpec(validator, optional) {\n    function isLooseObjectValidator(p) {\n        var isLooseObject = p === null || isDef(p) && p instanceof Object;\n        if (!isLooseObject) {\n            throw 'Expected an Object.';\n        }\n        if (validator !== undefined && validator !== null) {\n            validator(p);\n        }\n    }\n    return new ArgSpec(isLooseObjectValidator, optional);\n}\nfunction nullFunctionSpec(optional) {\n    function validator(p) {\n        var valid = p === null || isFunction(p);\n        if (!valid) {\n            throw 'Expected a Function.';\n        }\n    }\n    return new ArgSpec(validator, optional);\n}\n\n/**\r\n   * @license\r\n   * Copyright 2017 Google LLC\r\n   *\r\n   * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n   * you may not use this file except in compliance with the License.\r\n   * You may obtain a copy of the License at\r\n   *\r\n   *   http://www.apache.org/licenses/LICENSE-2.0\r\n   *\r\n   * Unless required by applicable law or agreed to in writing, software\r\n   * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n   * See the License for the specific language governing permissions and\r\n   * limitations under the License.\r\n   */\n/**\r\n       * Returns a function that invokes f with its arguments asynchronously as a\r\n       * microtask, i.e. as soon as possible after the current script returns back\r\n       * into browser code.\r\n       */\n// eslint-disable-next-line @typescript-eslint/ban-types\nfunction async(f) {\n    return function () {\n        var argsToForward = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            argsToForward[_i] = arguments[_i];\n        }\n        // eslint-disable-next-line @typescript-eslint/no-floating-promises\n        Promise.resolve().then(function () {return f.apply(void 0, argsToForward);});\n    };\n}\n\n/**\r\n   * @license\r\n   * Copyright 2017 Google LLC\r\n   *\r\n   * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n   * you may not use this file except in compliance with the License.\r\n   * You may obtain a copy of the License at\r\n   *\r\n   *   http://www.apache.org/licenses/LICENSE-2.0\r\n   *\r\n   * Unless required by applicable law or agreed to in writing, software\r\n   * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n   * See the License for the specific language governing permissions and\r\n   * limitations under the License.\r\n   */\n/**\r\n       * Represents a blob being uploaded. Can be used to pause/resume/cancel the\r\n       * upload and manage callbacks for various events.\r\n       */\nvar UploadTask = /** @class */function () {\n    /**\r\n                                            * @param ref The firebaseStorage.Reference object this task came\r\n                                            *     from, untyped to avoid cyclic dependencies.\r\n                                            * @param blob The blob to upload.\r\n                                            */\n    function UploadTask(ref, service, location, mappings, blob, metadata) {\n        var _this = this;\n        if (metadata === void 0) {metadata = null;}\n        this.transferred_ = 0;\n        this.needToFetchStatus_ = false;\n        this.needToFetchMetadata_ = false;\n        this.observers_ = [];\n        this.error_ = null;\n        this.uploadUrl_ = null;\n        this.request_ = null;\n        this.chunkMultiplier_ = 1;\n        this.resolve_ = null;\n        this.reject_ = null;\n        this.ref_ = ref;\n        this.service_ = service;\n        this.location_ = location;\n        this.blob_ = blob;\n        this.metadata_ = metadata;\n        this.mappings_ = mappings;\n        this.resumable_ = this.shouldDoResumable_(this.blob_);\n        this.state_ = InternalTaskState.RUNNING;\n        this.errorHandler_ = function (error) {\n            _this.request_ = null;\n            _this.chunkMultiplier_ = 1;\n            if (error.codeEquals(Code.CANCELED)) {\n                _this.needToFetchStatus_ = true;\n                _this.completeTransitions_();\n            } else\n            {\n                _this.error_ = error;\n                _this.transition_(InternalTaskState.ERROR);\n            }\n        };\n        this.metadataErrorHandler_ = function (error) {\n            _this.request_ = null;\n            if (error.codeEquals(Code.CANCELED)) {\n                _this.completeTransitions_();\n            } else\n            {\n                _this.error_ = error;\n                _this.transition_(InternalTaskState.ERROR);\n            }\n        };\n        this.promise_ = new Promise(function (resolve, reject) {\n            _this.resolve_ = resolve;\n            _this.reject_ = reject;\n            _this.start_();\n        });\n        // Prevent uncaught rejections on the internal promise from bubbling out\n        // to the top level with a dummy handler.\n        this.promise_.then(null, function () {});\n    }\n    UploadTask.prototype.makeProgressCallback_ = function () {\n        var _this = this;\n        var sizeBefore = this.transferred_;\n        return function (loaded) {return _this.updateProgress_(sizeBefore + loaded);};\n    };\n    UploadTask.prototype.shouldDoResumable_ = function (blob) {\n        return blob.size() > 256 * 1024;\n    };\n    UploadTask.prototype.start_ = function () {\n        if (this.state_ !== InternalTaskState.RUNNING) {\n            // This can happen if someone pauses us in a resume callback, for example.\n            return;\n        }\n        if (this.request_ !== null) {\n            return;\n        }\n        if (this.resumable_) {\n            if (this.uploadUrl_ === null) {\n                this.createResumable_();\n            } else\n            {\n                if (this.needToFetchStatus_) {\n                    this.fetchStatus_();\n                } else\n                {\n                    if (this.needToFetchMetadata_) {\n                        // Happens if we miss the metadata on upload completion.\n                        this.fetchMetadata_();\n                    } else\n                    {\n                        this.continueUpload_();\n                    }\n                }\n            }\n        } else\n        {\n            this.oneShotUpload_();\n        }\n    };\n    UploadTask.prototype.resolveToken_ = function (callback) {\n        var _this = this;\n        // eslint-disable-next-line @typescript-eslint/no-floating-promises\n        this.service_.getAuthToken().then(function (authToken) {\n            switch (_this.state_) {\n                case InternalTaskState.RUNNING:\n                    callback(authToken);\n                    break;\n                case InternalTaskState.CANCELING:\n                    _this.transition_(InternalTaskState.CANCELED);\n                    break;\n                case InternalTaskState.PAUSING:\n                    _this.transition_(InternalTaskState.PAUSED);\n                    break;}\n\n        });\n    };\n    // TODO(andysoto): assert false\n    UploadTask.prototype.createResumable_ = function () {\n        var _this = this;\n        this.resolveToken_(function (authToken) {\n            var requestInfo = createResumableUpload(_this.service_, _this.location_, _this.mappings_, _this.blob_, _this.metadata_);\n            var createRequest = _this.service_.makeRequest(requestInfo, authToken);\n            _this.request_ = createRequest;\n            createRequest.getPromise().then(function (url) {\n                _this.request_ = null;\n                _this.uploadUrl_ = url;\n                _this.needToFetchStatus_ = false;\n                _this.completeTransitions_();\n            }, _this.errorHandler_);\n        });\n    };\n    UploadTask.prototype.fetchStatus_ = function () {\n        var _this = this;\n        // TODO(andysoto): assert(this.uploadUrl_ !== null);\n        var url = this.uploadUrl_;\n        this.resolveToken_(function (authToken) {\n            var requestInfo = getResumableUploadStatus(_this.service_, _this.location_, url, _this.blob_);\n            var statusRequest = _this.service_.makeRequest(requestInfo, authToken);\n            _this.request_ = statusRequest;\n            statusRequest.getPromise().then(function (status) {\n                status = status;\n                _this.request_ = null;\n                _this.updateProgress_(status.current);\n                _this.needToFetchStatus_ = false;\n                if (status.finalized) {\n                    _this.needToFetchMetadata_ = true;\n                }\n                _this.completeTransitions_();\n            }, _this.errorHandler_);\n        });\n    };\n    UploadTask.prototype.continueUpload_ = function () {\n        var _this = this;\n        var chunkSize = resumableUploadChunkSize * this.chunkMultiplier_;\n        var status = new ResumableUploadStatus(this.transferred_, this.blob_.size());\n        // TODO(andysoto): assert(this.uploadUrl_ !== null);\n        var url = this.uploadUrl_;\n        this.resolveToken_(function (authToken) {\n            var requestInfo;\n            try {\n                requestInfo = continueResumableUpload(_this.location_, _this.service_, url, _this.blob_, chunkSize, _this.mappings_, status, _this.makeProgressCallback_());\n            }\n            catch (e) {\n                _this.error_ = e;\n                _this.transition_(InternalTaskState.ERROR);\n                return;\n            }\n            var uploadRequest = _this.service_.makeRequest(requestInfo, authToken);\n            _this.request_ = uploadRequest;\n            uploadRequest.\n            getPromise().\n            then(function (newStatus) {\n                _this.increaseMultiplier_();\n                _this.request_ = null;\n                _this.updateProgress_(newStatus.current);\n                if (newStatus.finalized) {\n                    _this.metadata_ = newStatus.metadata;\n                    _this.transition_(InternalTaskState.SUCCESS);\n                } else\n                {\n                    _this.completeTransitions_();\n                }\n            }, _this.errorHandler_);\n        });\n    };\n    UploadTask.prototype.increaseMultiplier_ = function () {\n        var currentSize = resumableUploadChunkSize * this.chunkMultiplier_;\n        // Max chunk size is 32M.\n        if (currentSize < 32 * 1024 * 1024) {\n            this.chunkMultiplier_ *= 2;\n        }\n    };\n    UploadTask.prototype.fetchMetadata_ = function () {\n        var _this = this;\n        this.resolveToken_(function (authToken) {\n            var requestInfo = getMetadata(_this.service_, _this.location_, _this.mappings_);\n            var metadataRequest = _this.service_.makeRequest(requestInfo, authToken);\n            _this.request_ = metadataRequest;\n            metadataRequest.getPromise().then(function (metadata) {\n                _this.request_ = null;\n                _this.metadata_ = metadata;\n                _this.transition_(InternalTaskState.SUCCESS);\n            }, _this.metadataErrorHandler_);\n        });\n    };\n    UploadTask.prototype.oneShotUpload_ = function () {\n        var _this = this;\n        this.resolveToken_(function (authToken) {\n            var requestInfo = multipartUpload(_this.service_, _this.location_, _this.mappings_, _this.blob_, _this.metadata_);\n            var multipartRequest = _this.service_.makeRequest(requestInfo, authToken);\n            _this.request_ = multipartRequest;\n            multipartRequest.getPromise().then(function (metadata) {\n                _this.request_ = null;\n                _this.metadata_ = metadata;\n                _this.updateProgress_(_this.blob_.size());\n                _this.transition_(InternalTaskState.SUCCESS);\n            }, _this.errorHandler_);\n        });\n    };\n    UploadTask.prototype.updateProgress_ = function (transferred) {\n        var old = this.transferred_;\n        this.transferred_ = transferred;\n        // A progress update can make the \"transferred\" value smaller (e.g. a\n        // partial upload not completed by server, after which the \"transferred\"\n        // value may reset to the value at the beginning of the request).\n        if (this.transferred_ !== old) {\n            this.notifyObservers_();\n        }\n    };\n    UploadTask.prototype.transition_ = function (state) {\n        if (this.state_ === state) {\n            return;\n        }\n        switch (state) {\n            case InternalTaskState.CANCELING:\n                // TODO(andysoto):\n                // assert(this.state_ === InternalTaskState.RUNNING ||\n                //        this.state_ === InternalTaskState.PAUSING);\n                this.state_ = state;\n                if (this.request_ !== null) {\n                    this.request_.cancel();\n                }\n                break;\n            case InternalTaskState.PAUSING:\n                // TODO(andysoto):\n                // assert(this.state_ === InternalTaskState.RUNNING);\n                this.state_ = state;\n                if (this.request_ !== null) {\n                    this.request_.cancel();\n                }\n                break;\n            case InternalTaskState.RUNNING:\n                // TODO(andysoto):\n                // assert(this.state_ === InternalTaskState.PAUSED ||\n                //        this.state_ === InternalTaskState.PAUSING);\n                var wasPaused = this.state_ === InternalTaskState.PAUSED;\n                this.state_ = state;\n                if (wasPaused) {\n                    this.notifyObservers_();\n                    this.start_();\n                }\n                break;\n            case InternalTaskState.PAUSED:\n                // TODO(andysoto):\n                // assert(this.state_ === InternalTaskState.PAUSING);\n                this.state_ = state;\n                this.notifyObservers_();\n                break;\n            case InternalTaskState.CANCELED:\n                // TODO(andysoto):\n                // assert(this.state_ === InternalTaskState.PAUSED ||\n                //        this.state_ === InternalTaskState.CANCELING);\n                this.error_ = canceled();\n                this.state_ = state;\n                this.notifyObservers_();\n                break;\n            case InternalTaskState.ERROR:\n                // TODO(andysoto):\n                // assert(this.state_ === InternalTaskState.RUNNING ||\n                //        this.state_ === InternalTaskState.PAUSING ||\n                //        this.state_ === InternalTaskState.CANCELING);\n                this.state_ = state;\n                this.notifyObservers_();\n                break;\n            case InternalTaskState.SUCCESS:\n                // TODO(andysoto):\n                // assert(this.state_ === InternalTaskState.RUNNING ||\n                //        this.state_ === InternalTaskState.PAUSING ||\n                //        this.state_ === InternalTaskState.CANCELING);\n                this.state_ = state;\n                this.notifyObservers_();\n                break;}\n\n    };\n    UploadTask.prototype.completeTransitions_ = function () {\n        switch (this.state_) {\n            case InternalTaskState.PAUSING:\n                this.transition_(InternalTaskState.PAUSED);\n                break;\n            case InternalTaskState.CANCELING:\n                this.transition_(InternalTaskState.CANCELED);\n                break;\n            case InternalTaskState.RUNNING:\n                this.start_();\n                break;}\n\n    };\n    Object.defineProperty(UploadTask.prototype, \"snapshot\", {\n        get: function get() {\n            var externalState = taskStateFromInternalTaskState(this.state_);\n            return new UploadTaskSnapshot(this.transferred_, this.blob_.size(), externalState, this.metadata_, this, this.ref_);\n        },\n        enumerable: false,\n        configurable: true });\n\n    /**\r\n                                * Adds a callback for an event.\r\n                                * @param type The type of event to listen for.\r\n                                */\n    UploadTask.prototype.on = function (type, nextOrObserver, error, completed) {\n        function typeValidator() {\n            if (type !== TaskEvent.STATE_CHANGED) {\n                throw \"Expected one of the event types: [\" + TaskEvent.STATE_CHANGED + \"].\";\n            }\n        }\n        var nextOrObserverMessage = 'Expected a function or an Object with one of ' +\n        '`next`, `error`, `complete` properties.';\n        var nextValidator = nullFunctionSpec(true).validator;\n        var observerValidator = looseObjectSpec(null, true).validator;\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        function nextOrObserverValidator(p) {\n            try {\n                nextValidator(p);\n                return;\n            }\n            catch (e) {}\n            try {\n                observerValidator(p);\n                var anyDefined = isJustDef(p['next']) ||\n                isJustDef(p['error']) ||\n                isJustDef(p['complete']);\n                if (!anyDefined) {\n                    throw '';\n                }\n                return;\n            }\n            catch (e) {\n                throw nextOrObserverMessage;\n            }\n        }\n        var specs = [\n        stringSpec(typeValidator),\n        looseObjectSpec(nextOrObserverValidator, true),\n        nullFunctionSpec(true),\n        nullFunctionSpec(true)];\n\n        validate('on', specs, arguments);\n        var self = this;\n        function makeBinder(specs) {\n            function binder(nextOrObserver, error, complete) {\n                if (specs !== null) {\n                    validate('on', specs, arguments);\n                }\n                var observer = new Observer(nextOrObserver, error, completed);\n                self.addObserver_(observer);\n                return function () {\n                    self.removeObserver_(observer);\n                };\n            }\n            return binder;\n        }\n        function binderNextOrObserverValidator(p) {\n            if (p === null) {\n                throw nextOrObserverMessage;\n            }\n            nextOrObserverValidator(p);\n        }\n        var binderSpecs = [\n        looseObjectSpec(binderNextOrObserverValidator),\n        nullFunctionSpec(true),\n        nullFunctionSpec(true)];\n\n        var typeOnly = !(isJustDef(nextOrObserver) ||\n        isJustDef(error) ||\n        isJustDef(completed));\n        if (typeOnly) {\n            return makeBinder(binderSpecs);\n        } else\n        {\n            return makeBinder(null)(nextOrObserver, error, completed);\n        }\n    };\n    /**\r\n        * This object behaves like a Promise, and resolves with its snapshot data\r\n        * when the upload completes.\r\n        * @param onFulfilled The fulfillment callback. Promise chaining works as normal.\r\n        * @param onRejected The rejection callback.\r\n        */\n    UploadTask.prototype.then = function (onFulfilled, onRejected) {\n        // These casts are needed so that TypeScript can infer the types of the\n        // resulting Promise.\n        return this.promise_.then(onFulfilled, onRejected);\n    };\n    /**\r\n        * Equivalent to calling `then(null, onRejected)`.\r\n        */\n    UploadTask.prototype.catch = function (onRejected) {\n        return this.then(null, onRejected);\n    };\n    /**\r\n        * Adds the given observer.\r\n        */\n    UploadTask.prototype.addObserver_ = function (observer) {\n        this.observers_.push(observer);\n        this.notifyObserver_(observer);\n    };\n    /**\r\n        * Removes the given observer.\r\n        */\n    UploadTask.prototype.removeObserver_ = function (observer) {\n        var i = this.observers_.indexOf(observer);\n        if (i !== -1) {\n            this.observers_.splice(i, 1);\n        }\n    };\n    UploadTask.prototype.notifyObservers_ = function () {\n        var _this = this;\n        this.finishPromise_();\n        var observers = this.observers_.slice();\n        observers.forEach(function (observer) {\n            _this.notifyObserver_(observer);\n        });\n    };\n    UploadTask.prototype.finishPromise_ = function () {\n        if (this.resolve_ !== null) {\n            var triggered = true;\n            switch (taskStateFromInternalTaskState(this.state_)) {\n                case TaskState.SUCCESS:\n                    async(this.resolve_.bind(null, this.snapshot))();\n                    break;\n                case TaskState.CANCELED:\n                case TaskState.ERROR:\n                    var toCall = this.reject_;\n                    async(toCall.bind(null, this.error_))();\n                    break;\n                default:\n                    triggered = false;\n                    break;}\n\n            if (triggered) {\n                this.resolve_ = null;\n                this.reject_ = null;\n            }\n        }\n    };\n    UploadTask.prototype.notifyObserver_ = function (observer) {\n        var externalState = taskStateFromInternalTaskState(this.state_);\n        switch (externalState) {\n            case TaskState.RUNNING:\n            case TaskState.PAUSED:\n                if (observer.next) {\n                    async(observer.next.bind(observer, this.snapshot))();\n                }\n                break;\n            case TaskState.SUCCESS:\n                if (observer.complete) {\n                    async(observer.complete.bind(observer))();\n                }\n                break;\n            case TaskState.CANCELED:\n            case TaskState.ERROR:\n                if (observer.error) {\n                    async(observer.error.bind(observer, this.error_))();\n                }\n                break;\n            default:\n                // TODO(andysoto): assert(false);\n                if (observer.error) {\n                    async(observer.error.bind(observer, this.error_))();\n                }}\n\n    };\n    /**\r\n        * Resumes a paused task. Has no effect on a currently running or failed task.\r\n        * @return True if the operation took effect, false if ignored.\r\n        */\n    UploadTask.prototype.resume = function () {\n        validate('resume', [], arguments);\n        var valid = this.state_ === InternalTaskState.PAUSED ||\n        this.state_ === InternalTaskState.PAUSING;\n        if (valid) {\n            this.transition_(InternalTaskState.RUNNING);\n        }\n        return valid;\n    };\n    /**\r\n        * Pauses a currently running task. Has no effect on a paused or failed task.\r\n        * @return True if the operation took effect, false if ignored.\r\n        */\n    UploadTask.prototype.pause = function () {\n        validate('pause', [], arguments);\n        var valid = this.state_ === InternalTaskState.RUNNING;\n        if (valid) {\n            this.transition_(InternalTaskState.PAUSING);\n        }\n        return valid;\n    };\n    /**\r\n        * Cancels a currently running or paused task. Has no effect on a complete or\r\n        * failed task.\r\n        * @return True if the operation took effect, false if ignored.\r\n        */\n    UploadTask.prototype.cancel = function () {\n        validate('cancel', [], arguments);\n        var valid = this.state_ === InternalTaskState.RUNNING ||\n        this.state_ === InternalTaskState.PAUSING;\n        if (valid) {\n            this.transition_(InternalTaskState.CANCELING);\n        }\n        return valid;\n    };\n    return UploadTask;\n}();\n\n/**\r\n      * @license\r\n      * Copyright 2019 Google LLC\r\n      *\r\n      * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n      * you may not use this file except in compliance with the License.\r\n      * You may obtain a copy of the License at\r\n      *\r\n      *   http://www.apache.org/licenses/LICENSE-2.0\r\n      *\r\n      * Unless required by applicable law or agreed to in writing, software\r\n      * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n      * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n      * See the License for the specific language governing permissions and\r\n      * limitations under the License.\r\n      */\n/**\r\n          * Provides methods to interact with a bucket in the Firebase Storage service.\r\n          * @param location An fbs.location, or the URL at\r\n          *     which to base this object, in one of the following forms:\r\n          *         gs://<bucket>/<object-path>\r\n          *         http[s]://firebasestorage.googleapis.com/\r\n          *                     <api-version>/b/<bucket>/o/<object-path>\r\n          *     Any query or fragment strings will be ignored in the http[s]\r\n          *     format. If no value is passed, the storage object will use a URL based on\r\n          *     the project ID of the base firebase.App instance.\r\n          */\nvar Reference = /** @class */function () {\n    function Reference(service, location) {\n        this.service = service;\n        if (location instanceof Location) {\n            this.location = location;\n        } else\n        {\n            this.location = Location.makeFromUrl(location);\n        }\n    }\n    /**\r\n       * @return The URL for the bucket and path this object references,\r\n       *     in the form gs://<bucket>/<object-path>\r\n       * @override\r\n       */\n    Reference.prototype.toString = function () {\n        validate('toString', [], arguments);\n        return 'gs://' + this.location.bucket + '/' + this.location.path;\n    };\n    Reference.prototype.newRef = function (service, location) {\n        return new Reference(service, location);\n    };\n    Reference.prototype.mappings = function () {\n        return getMappings();\n    };\n    /**\r\n        * @return A reference to the object obtained by\r\n        *     appending childPath, removing any duplicate, beginning, or trailing\r\n        *     slashes.\r\n        */\n    Reference.prototype.child = function (childPath) {\n        validate('child', [stringSpec()], arguments);\n        var newPath = child(this.location.path, childPath);\n        var location = new Location(this.location.bucket, newPath);\n        return this.newRef(this.service, location);\n    };\n    Object.defineProperty(Reference.prototype, \"parent\", {\n        /**\r\n                                                            * @return A reference to the parent of the\r\n                                                            *     current object, or null if the current object is the root.\r\n                                                            */\n        get: function get() {\n            var newPath = parent(this.location.path);\n            if (newPath === null) {\n                return null;\n            }\n            var location = new Location(this.location.bucket, newPath);\n            return this.newRef(this.service, location);\n        },\n        enumerable: false,\n        configurable: true });\n\n    Object.defineProperty(Reference.prototype, \"root\", {\n        /**\r\n                                                          * @return An reference to the root of this\r\n                                                          *     object's bucket.\r\n                                                          */\n        get: function get() {\n            var location = new Location(this.location.bucket, '');\n            return this.newRef(this.service, location);\n        },\n        enumerable: false,\n        configurable: true });\n\n    Object.defineProperty(Reference.prototype, \"bucket\", {\n        get: function get() {\n            return this.location.bucket;\n        },\n        enumerable: false,\n        configurable: true });\n\n    Object.defineProperty(Reference.prototype, \"fullPath\", {\n        get: function get() {\n            return this.location.path;\n        },\n        enumerable: false,\n        configurable: true });\n\n    Object.defineProperty(Reference.prototype, \"name\", {\n        get: function get() {\n            return lastComponent(this.location.path);\n        },\n        enumerable: false,\n        configurable: true });\n\n    Object.defineProperty(Reference.prototype, \"storage\", {\n        get: function get() {\n            return this.service;\n        },\n        enumerable: false,\n        configurable: true });\n\n    /**\r\n                                * Uploads a blob to this object's location.\r\n                                * @param data The blob to upload.\r\n                                * @return An UploadTask that lets you control and\r\n                                *     observe the upload.\r\n                                */\n    Reference.prototype.put = function (data, metadata) {\n        if (metadata === void 0) {metadata = null;}\n        validate('put', [uploadDataSpec(), metadataSpec(true)], arguments);\n        this.throwIfRoot_('put');\n        return new UploadTask(this, this.service, this.location, this.mappings(), new FbsBlob(data), metadata);\n    };\n    /**\r\n        * Uploads a string to this object's location.\r\n        * @param value The string to upload.\r\n        * @param format The format of the string to upload.\r\n        * @return An UploadTask that lets you control and\r\n        *     observe the upload.\r\n        */\n    Reference.prototype.putString = function (value, format, metadata) {\n        if (format === void 0) {format = StringFormat.RAW;}\n        validate('putString', [stringSpec(), stringSpec(formatValidator, true), metadataSpec(true)], arguments);\n        this.throwIfRoot_('putString');\n        var data = dataFromString(format, value);\n        var metadataClone = Object.assign({}, metadata);\n        if (!isDef(metadataClone['contentType']) &&\n        isDef(data.contentType)) {\n            metadataClone['contentType'] = data.contentType;\n        }\n        return new UploadTask(this, this.service, this.location, this.mappings(), new FbsBlob(data.data, true), metadataClone);\n    };\n    /**\r\n        * Deletes the object at this location.\r\n        * @return A promise that resolves if the deletion succeeds.\r\n        */\n    Reference.prototype.delete = function () {\n        var _this = this;\n        validate('delete', [], arguments);\n        this.throwIfRoot_('delete');\n        return this.service.getAuthToken().then(function (authToken) {\n            var requestInfo = deleteObject(_this.service, _this.location);\n            return _this.service.makeRequest(requestInfo, authToken).getPromise();\n        });\n    };\n    /**\r\n        * List all items (files) and prefixes (folders) under this storage reference.\r\n        *\r\n        * This is a helper method for calling list() repeatedly until there are\r\n        * no more results. The default pagination size is 1000.\r\n        *\r\n        * Note: The results may not be consistent if objects are changed while this\r\n        * operation is running.\r\n        *\r\n        * Warning: listAll may potentially consume too many resources if there are\r\n        * too many results.\r\n        *\r\n        * @return A Promise that resolves with all the items and prefixes under\r\n        *      the current storage reference. `prefixes` contains references to\r\n        *      sub-directories and `items` contains references to objects in this\r\n        *      folder. `nextPageToken` is never returned.\r\n        */\n    Reference.prototype.listAll = function () {\n        validate('listAll', [], arguments);\n        var accumulator = {\n            prefixes: [],\n            items: [] };\n\n        return this.listAllHelper(accumulator).then(function () {return accumulator;});\n    };\n    Reference.prototype.listAllHelper = function (accumulator, pageToken) {\n        return (0, _tslib.__awaiter)(this, void 0, void 0, function () {\n            var opt, nextPage;\n            var _a, _b;\n            return (0, _tslib.__generator)(this, function (_c) {\n                switch (_c.label) {\n                    case 0:\n                        opt = {\n                            // maxResults is 1000 by default.\n                            pageToken: pageToken };\n\n                        return [4 /*yield*/, this.list(opt)];\n                    case 1:\n                        nextPage = _c.sent();\n                        (_a = accumulator.prefixes).push.apply(_a, nextPage.prefixes);\n                        (_b = accumulator.items).push.apply(_b, nextPage.items);\n                        if (!(nextPage.nextPageToken != null)) return [3 /*break*/, 3];\n                        return [4 /*yield*/, this.listAllHelper(accumulator, nextPage.nextPageToken)];\n                    case 2:\n                        _c.sent();\n                        _c.label = 3;\n                    case 3:return [2 /*return*/];}\n\n            });\n        });\n    };\n    /**\r\n        * List items (files) and prefixes (folders) under this storage reference.\r\n        *\r\n        * List API is only available for Firebase Rules Version 2.\r\n        *\r\n        * GCS is a key-blob store. Firebase Storage imposes the semantic of '/'\r\n        * delimited folder structure.\r\n        * Refer to GCS's List API if you want to learn more.\r\n        *\r\n        * To adhere to Firebase Rules's Semantics, Firebase Storage does not\r\n        * support objects whose paths end with \"/\" or contain two consecutive\r\n        * \"/\"s. Firebase Storage List API will filter these unsupported objects.\r\n        * list() may fail if there are too many unsupported objects in the bucket.\r\n        *\r\n        * @param options See ListOptions for details.\r\n        * @return A Promise that resolves with the items and prefixes.\r\n        *      `prefixes` contains references to sub-folders and `items`\r\n        *      contains references to objects in this folder. `nextPageToken`\r\n        *      can be used to get the rest of the results.\r\n        */\n    Reference.prototype.list = function (options) {\n        validate('list', [listOptionSpec(true)], arguments);\n        var self = this;\n        return this.service.getAuthToken().then(function (authToken) {\n            var op = options || {};\n            var requestInfo = list(self.service, self.location,\n            /*delimiter= */'/', op.pageToken, op.maxResults);\n            return self.service.makeRequest(requestInfo, authToken).getPromise();\n        });\n    };\n    /**\r\n        *     A promise that resolves with the metadata for this object. If this\r\n        *     object doesn't exist or metadata cannot be retreived, the promise is\r\n        *     rejected.\r\n        */\n    Reference.prototype.getMetadata = function () {\n        var _this = this;\n        validate('getMetadata', [], arguments);\n        this.throwIfRoot_('getMetadata');\n        return this.service.getAuthToken().then(function (authToken) {\n            var requestInfo = getMetadata(_this.service, _this.location, _this.mappings());\n            return _this.service.makeRequest(requestInfo, authToken).getPromise();\n        });\n    };\n    /**\r\n        * Updates the metadata for this object.\r\n        * @param metadata The new metadata for the object.\r\n        *     Only values that have been explicitly set will be changed. Explicitly\r\n        *     setting a value to null will remove the metadata.\r\n        * @return A promise that resolves\r\n        *     with the new metadata for this object.\r\n        *     @see firebaseStorage.Reference.prototype.getMetadata\r\n        */\n    Reference.prototype.updateMetadata = function (metadata) {\n        var _this = this;\n        validate('updateMetadata', [metadataSpec()], arguments);\n        this.throwIfRoot_('updateMetadata');\n        return this.service.getAuthToken().then(function (authToken) {\n            var requestInfo = updateMetadata(_this.service, _this.location, metadata, _this.mappings());\n            return _this.service.makeRequest(requestInfo, authToken).getPromise();\n        });\n    };\n    /**\r\n        * @return A promise that resolves with the download\r\n        *     URL for this object.\r\n        */\n    Reference.prototype.getDownloadURL = function () {\n        var _this = this;\n        validate('getDownloadURL', [], arguments);\n        this.throwIfRoot_('getDownloadURL');\n        return this.service.getAuthToken().then(function (authToken) {\n            var requestInfo = getDownloadUrl(_this.service, _this.location, _this.mappings());\n            return _this.service.\n            makeRequest(requestInfo, authToken).\n            getPromise().\n            then(function (url) {\n                if (url === null) {\n                    throw noDownloadURL();\n                }\n                return url;\n            });\n        });\n    };\n    Reference.prototype.throwIfRoot_ = function (name) {\n        if (this.location.path === '') {\n            throw invalidRootOperation(name);\n        }\n    };\n    return Reference;\n}();\n\n/**\r\n      * A request whose promise always fails.\r\n      * @struct\r\n      * @template T\r\n      */\nvar FailRequest = /** @class */function () {\n    function FailRequest(error) {\n        this.promise_ = Promise.reject(error);\n    }\n    /** @inheritDoc */\n    FailRequest.prototype.getPromise = function () {\n        return this.promise_;\n    };\n    /** @inheritDoc */\n    FailRequest.prototype.cancel = function (_appDelete) {\n    };\n    return FailRequest;\n}();\n\n/**\r\n      * @license\r\n      * Copyright 2017 Google LLC\r\n      *\r\n      * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n      * you may not use this file except in compliance with the License.\r\n      * You may obtain a copy of the License at\r\n      *\r\n      *   http://www.apache.org/licenses/LICENSE-2.0\r\n      *\r\n      * Unless required by applicable law or agreed to in writing, software\r\n      * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n      * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n      * See the License for the specific language governing permissions and\r\n      * limitations under the License.\r\n      */\n/**\r\n          * @param f May be invoked\r\n          *     before the function returns.\r\n          * @param callback Get all the arguments passed to the function\r\n          *     passed to f, including the initial boolean.\r\n          */\nfunction start(f,\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\ncallback, timeout) {\n    // TODO(andysoto): make this code cleaner (probably refactor into an actual\n    // type instead of a bunch of functions with state shared in the closure)\n    var waitSeconds = 1;\n    // Would type this as \"number\" but that doesn't work for Node so \\_()_/\n    // TODO: find a way to exclude Node type definition for storage because storage only works in browser\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    var timeoutId = null;\n    var hitTimeout = false;\n    var cancelState = 0;\n    function canceled() {\n        return cancelState === 2;\n    }\n    var triggeredCallback = false;\n    // TODO: This disable can be removed and the 'ignoreRestArgs' option added to\n    // the no-explicit-any rule when ESlint releases it.\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    function triggerCallback() {\n        var args = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            args[_i] = arguments[_i];\n        }\n        if (!triggeredCallback) {\n            triggeredCallback = true;\n            callback.apply(null, args);\n        }\n    }\n    function callWithDelay(millis) {\n        timeoutId = setTimeout(function () {\n            timeoutId = null;\n            f(handler, canceled());\n        }, millis);\n    }\n    // TODO: This disable can be removed and the 'ignoreRestArgs' option added to\n    // the no-explicit-any rule when ESlint releases it.\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    function handler(success) {\n        var args = [];\n        for (var _i = 1; _i < arguments.length; _i++) {\n            args[_i - 1] = arguments[_i];\n        }\n        if (triggeredCallback) {\n            return;\n        }\n        if (success) {\n            triggerCallback.call.apply(triggerCallback, (0, _tslib.__spreadArrays)([null, success], args));\n            return;\n        }\n        var mustStop = canceled() || hitTimeout;\n        if (mustStop) {\n            triggerCallback.call.apply(triggerCallback, (0, _tslib.__spreadArrays)([null, success], args));\n            return;\n        }\n        if (waitSeconds < 64) {\n            /* TODO(andysoto): don't back off so quickly if we know we're offline. */\n            waitSeconds *= 2;\n        }\n        var waitMillis;\n        if (cancelState === 1) {\n            cancelState = 2;\n            waitMillis = 0;\n        } else\n        {\n            waitMillis = (waitSeconds + Math.random()) * 1000;\n        }\n        callWithDelay(waitMillis);\n    }\n    var stopped = false;\n    function stop(wasTimeout) {\n        if (stopped) {\n            return;\n        }\n        stopped = true;\n        if (triggeredCallback) {\n            return;\n        }\n        if (timeoutId !== null) {\n            if (!wasTimeout) {\n                cancelState = 2;\n            }\n            clearTimeout(timeoutId);\n            callWithDelay(0);\n        } else\n        {\n            if (!wasTimeout) {\n                cancelState = 1;\n            }\n        }\n    }\n    callWithDelay(0);\n    setTimeout(function () {\n        hitTimeout = true;\n        stop(true);\n    }, timeout);\n    return stop;\n}\n/**\r\n   * Stops the retry loop from repeating.\r\n   * If the function is currently \"in between\" retries, it is invoked immediately\r\n   * with the second parameter as \"true\". Otherwise, it will be invoked once more\r\n   * after the current invocation finishes iff the current invocation would have\r\n   * triggered another retry.\r\n   */\nfunction stop(id) {\n    id(false);\n}\n\n/**\r\n   * @license\r\n   * Copyright 2017 Google LLC\r\n   *\r\n   * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n   * you may not use this file except in compliance with the License.\r\n   * You may obtain a copy of the License at\r\n   *\r\n   *   http://www.apache.org/licenses/LICENSE-2.0\r\n   *\r\n   * Unless required by applicable law or agreed to in writing, software\r\n   * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n   * See the License for the specific language governing permissions and\r\n   * limitations under the License.\r\n   */\n/**\r\n       * @struct\r\n       * @template T\r\n       */\nvar NetworkRequest = /** @class */function () {\n    function NetworkRequest(url, method, headers, body, successCodes, additionalRetryCodes, callback, errorCallback, timeout, progressCallback, pool) {\n        var _this = this;\n        this.pendingXhr_ = null;\n        this.backoffId_ = null;\n        this.canceled_ = false;\n        this.appDelete_ = false;\n        this.url_ = url;\n        this.method_ = method;\n        this.headers_ = headers;\n        this.body_ = body;\n        this.successCodes_ = successCodes.slice();\n        this.additionalRetryCodes_ = additionalRetryCodes.slice();\n        this.callback_ = callback;\n        this.errorCallback_ = errorCallback;\n        this.progressCallback_ = progressCallback;\n        this.timeout_ = timeout;\n        this.pool_ = pool;\n        this.promise_ = new Promise(function (resolve, reject) {\n            _this.resolve_ = resolve;\n            _this.reject_ = reject;\n            _this.start_();\n        });\n    }\n    /**\r\n       * Actually starts the retry loop.\r\n       */\n    NetworkRequest.prototype.start_ = function () {\n        var self = this;\n        function doTheRequest(backoffCallback, canceled) {\n            if (canceled) {\n                backoffCallback(false, new RequestEndStatus(false, null, true));\n                return;\n            }\n            var xhr = self.pool_.createXhrIo();\n            self.pendingXhr_ = xhr;\n            function progressListener(progressEvent) {\n                var loaded = progressEvent.loaded;\n                var total = progressEvent.lengthComputable ? progressEvent.total : -1;\n                if (self.progressCallback_ !== null) {\n                    self.progressCallback_(loaded, total);\n                }\n            }\n            if (self.progressCallback_ !== null) {\n                xhr.addUploadProgressListener(progressListener);\n            }\n            // eslint-disable-next-line @typescript-eslint/no-floating-promises\n            xhr.\n            send(self.url_, self.method_, self.body_, self.headers_).\n            then(function (xhr) {\n                if (self.progressCallback_ !== null) {\n                    xhr.removeUploadProgressListener(progressListener);\n                }\n                self.pendingXhr_ = null;\n                xhr = xhr;\n                var hitServer = xhr.getErrorCode() === ErrorCode.NO_ERROR;\n                var status = xhr.getStatus();\n                if (!hitServer || self.isRetryStatusCode_(status)) {\n                    var wasCanceled = xhr.getErrorCode() === ErrorCode.ABORT;\n                    backoffCallback(false, new RequestEndStatus(false, null, wasCanceled));\n                    return;\n                }\n                var successCode = self.successCodes_.indexOf(status) !== -1;\n                backoffCallback(true, new RequestEndStatus(successCode, xhr));\n            });\n        }\n        /**\r\n           * @param requestWentThrough True if the request eventually went\r\n           *     through, false if it hit the retry limit or was canceled.\r\n           */\n        function backoffDone(requestWentThrough, status) {\n            var resolve = self.resolve_;\n            var reject = self.reject_;\n            var xhr = status.xhr;\n            if (status.wasSuccessCode) {\n                try {\n                    var result = self.callback_(xhr, xhr.getResponseText());\n                    if (isJustDef(result)) {\n                        resolve(result);\n                    } else\n                    {\n                        resolve();\n                    }\n                }\n                catch (e) {\n                    reject(e);\n                }\n            } else\n            {\n                if (xhr !== null) {\n                    var err = unknown();\n                    err.setServerResponseProp(xhr.getResponseText());\n                    if (self.errorCallback_) {\n                        reject(self.errorCallback_(xhr, err));\n                    } else\n                    {\n                        reject(err);\n                    }\n                } else\n                {\n                    if (status.canceled) {\n                        var err = self.appDelete_ ? appDeleted() : canceled();\n                        reject(err);\n                    } else\n                    {\n                        var err = retryLimitExceeded();\n                        reject(err);\n                    }\n                }\n            }\n        }\n        if (this.canceled_) {\n            backoffDone(false, new RequestEndStatus(false, null, true));\n        } else\n        {\n            this.backoffId_ = start(doTheRequest, backoffDone, this.timeout_);\n        }\n    };\n    /** @inheritDoc */\n    NetworkRequest.prototype.getPromise = function () {\n        return this.promise_;\n    };\n    /** @inheritDoc */\n    NetworkRequest.prototype.cancel = function (appDelete) {\n        this.canceled_ = true;\n        this.appDelete_ = appDelete || false;\n        if (this.backoffId_ !== null) {\n            stop(this.backoffId_);\n        }\n        if (this.pendingXhr_ !== null) {\n            this.pendingXhr_.abort();\n        }\n    };\n    NetworkRequest.prototype.isRetryStatusCode_ = function (status) {\n        // The codes for which to retry came from this page:\n        // https://cloud.google.com/storage/docs/exponential-backoff\n        var isFiveHundredCode = status >= 500 && status < 600;\n        var extraRetryCodes = [\n        // Request Timeout: web server didn't receive full request in time.\n        408,\n        // Too Many Requests: you're getting rate-limited, basically.\n        429];\n\n        var isExtraRetryCode = extraRetryCodes.indexOf(status) !== -1;\n        var isRequestSpecificRetryCode = this.additionalRetryCodes_.indexOf(status) !== -1;\n        return isFiveHundredCode || isExtraRetryCode || isRequestSpecificRetryCode;\n    };\n    return NetworkRequest;\n}();\n/**\r\n      * A collection of information about the result of a network request.\r\n      * @param opt_canceled Defaults to false.\r\n      * @struct\r\n      */\nvar RequestEndStatus = /** @class */function () {\n    function RequestEndStatus(wasSuccessCode, xhr, canceled) {\n        this.wasSuccessCode = wasSuccessCode;\n        this.xhr = xhr;\n        this.canceled = !!canceled;\n    }\n    return RequestEndStatus;\n}();\nfunction addAuthHeader_(headers, authToken) {\n    if (authToken !== null && authToken.length > 0) {\n        headers['Authorization'] = 'Firebase ' + authToken;\n    }\n}\nfunction addVersionHeader_(headers) {\n    var version = typeof _app2.default !== 'undefined' ? _app2.default.SDK_VERSION : 'AppManager';\n    headers['X-Firebase-Storage-Version'] = 'webjs/' + version;\n}\nfunction addGmpidHeader_(headers, appId) {\n    if (appId) {\n        headers['X-Firebase-GMPID'] = appId;\n    }\n}\n/**\r\n   * @template T\r\n   */\nfunction makeRequest(requestInfo, appId, authToken, pool) {\n    var queryPart = makeQueryString(requestInfo.urlParams);\n    var url = requestInfo.url + queryPart;\n    var headers = Object.assign({}, requestInfo.headers);\n    addGmpidHeader_(headers, appId);\n    addAuthHeader_(headers, authToken);\n    addVersionHeader_(headers);\n    return new NetworkRequest(url, requestInfo.method, headers, requestInfo.body, requestInfo.successCodes, requestInfo.additionalRetryCodes, requestInfo.handler, requestInfo.errorHandler, requestInfo.timeout, requestInfo.progressCallback, pool);\n}\n\n/**\r\n   * @license\r\n   * Copyright 2017 Google LLC\r\n   *\r\n   * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n   * you may not use this file except in compliance with the License.\r\n   * You may obtain a copy of the License at\r\n   *\r\n   *   http://www.apache.org/licenses/LICENSE-2.0\r\n   *\r\n   * Unless required by applicable law or agreed to in writing, software\r\n   * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n   * See the License for the specific language governing permissions and\r\n   * limitations under the License.\r\n   */\n/**\r\n       * A service that provides firebaseStorage.Reference instances.\r\n       * @param opt_url gs:// url to a custom Storage Bucket\r\n       *\r\n       * @struct\r\n       */\nvar StorageService = /** @class */function () {\n    function StorageService(app, authProvider, pool, url) {\n        var _a;\n        this.bucket_ = null;\n        this.appId_ = null;\n        this.deleted_ = false;\n        this.app_ = app;\n        this.authProvider_ = authProvider;\n        this.maxOperationRetryTime_ = DEFAULT_MAX_OPERATION_RETRY_TIME;\n        this.maxUploadRetryTime_ = DEFAULT_MAX_UPLOAD_RETRY_TIME;\n        this.requests_ = new Set();\n        this.pool_ = pool;\n        if (url != null) {\n            this.bucket_ = Location.makeFromBucketSpec(url);\n        } else\n        {\n            this.bucket_ = StorageService.extractBucket_((_a = this.app_) === null || _a === void 0 ? void 0 : _a.options);\n        }\n        this.internals_ = new ServiceInternals(this);\n    }\n    StorageService.extractBucket_ = function (config) {\n        var bucketString = config === null || config === void 0 ? void 0 : config[CONFIG_STORAGE_BUCKET_KEY];\n        if (bucketString == null) {\n            return null;\n        }\n        return Location.makeFromBucketSpec(bucketString);\n    };\n    StorageService.prototype.getAuthToken = function () {\n        return (0, _tslib.__awaiter)(this, void 0, void 0, function () {\n            var auth, tokenData;\n            return (0, _tslib.__generator)(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        auth = this.authProvider_.getImmediate({ optional: true });\n                        if (!auth) return [3 /*break*/, 2];\n                        return [4 /*yield*/, auth.getToken()];\n                    case 1:\n                        tokenData = _a.sent();\n                        if (tokenData !== null) {\n                            return [2 /*return*/, tokenData.accessToken];\n                        }\n                        _a.label = 2;\n                    case 2:return [2 /*return*/, null];}\n\n            });\n        });\n    };\n    /**\r\n        * Stop running requests and prevent more from being created.\r\n        */\n    StorageService.prototype.deleteApp = function () {\n        this.deleted_ = true;\n        this.app_ = null;\n        this.requests_.forEach(function (request) {return request.cancel();});\n        this.requests_.clear();\n    };\n    /**\r\n        * Returns a new firebaseStorage.Reference object referencing this StorageService\r\n        * at the given Location.\r\n        * @param loc The Location.\r\n        * @return A firebaseStorage.Reference.\r\n        */\n    StorageService.prototype.makeStorageReference = function (loc) {\n        return new Reference(this, loc);\n    };\n    StorageService.prototype.makeRequest = function (requestInfo, authToken) {\n        var _this = this;\n        if (!this.deleted_) {\n            var request_1 = makeRequest(requestInfo, this.appId_, authToken, this.pool_);\n            this.requests_.add(request_1);\n            // Request removes itself from set when complete.\n            request_1.getPromise().then(function () {return _this.requests_.delete(request_1);}, function () {return _this.requests_.delete(request_1);});\n            return request_1;\n        } else\n        {\n            return new FailRequest(appDeleted());\n        }\n    };\n    /**\r\n        * Returns a firebaseStorage.Reference for the given path in the default\r\n        * bucket.\r\n        */\n    StorageService.prototype.ref = function (path) {\n        function validator(path) {\n            if (typeof path !== 'string') {\n                throw 'Path is not a string.';\n            }\n            if (/^[A-Za-z]+:\\/\\//.test(path)) {\n                throw 'Expected child path but got a URL, use refFromURL instead.';\n            }\n        }\n        validate('ref', [stringSpec(validator, true)], arguments);\n        if (this.bucket_ == null) {\n            throw new Error('No Storage Bucket defined in Firebase Options.');\n        }\n        var ref = new Reference(this, this.bucket_);\n        if (path != null) {\n            return ref.child(path);\n        } else\n        {\n            return ref;\n        }\n    };\n    /**\r\n        * Returns a firebaseStorage.Reference object for the given absolute URL,\r\n        * which must be a gs:// or http[s]:// URL.\r\n        */\n    StorageService.prototype.refFromURL = function (url) {\n        function validator(p) {\n            if (typeof p !== 'string') {\n                throw 'Path is not a string.';\n            }\n            if (!/^[A-Za-z]+:\\/\\//.test(p)) {\n                throw 'Expected full URL but got a child path, use ref instead.';\n            }\n            try {\n                Location.makeFromUrl(p);\n            }\n            catch (e) {\n                throw 'Expected valid full URL but got an invalid one.';\n            }\n        }\n        validate('refFromURL', [stringSpec(validator, false)], arguments);\n        return new Reference(this, url);\n    };\n    Object.defineProperty(StorageService.prototype, \"maxUploadRetryTime\", {\n        get: function get() {\n            return this.maxUploadRetryTime_;\n        },\n        enumerable: false,\n        configurable: true });\n\n    StorageService.prototype.setMaxUploadRetryTime = function (time) {\n        validate('setMaxUploadRetryTime', [nonNegativeNumberSpec()], arguments);\n        this.maxUploadRetryTime_ = time;\n    };\n    Object.defineProperty(StorageService.prototype, \"maxOperationRetryTime\", {\n        get: function get() {\n            return this.maxOperationRetryTime_;\n        },\n        enumerable: false,\n        configurable: true });\n\n    StorageService.prototype.setMaxOperationRetryTime = function (time) {\n        validate('setMaxOperationRetryTime', [nonNegativeNumberSpec()], arguments);\n        this.maxOperationRetryTime_ = time;\n    };\n    Object.defineProperty(StorageService.prototype, \"app\", {\n        get: function get() {\n            return this.app_;\n        },\n        enumerable: false,\n        configurable: true });\n\n    Object.defineProperty(StorageService.prototype, \"INTERNAL\", {\n        get: function get() {\n            return this.internals_;\n        },\n        enumerable: false,\n        configurable: true });\n\n    return StorageService;\n}();\n/**\r\n      * @struct\r\n      */\nvar ServiceInternals = /** @class */function () {\n    function ServiceInternals(service) {\n        this.service_ = service;\n    }\n    /**\r\n       * Called when the associated app is deleted.\r\n       */\n    ServiceInternals.prototype.delete = function () {\n        this.service_.deleteApp();\n        return Promise.resolve();\n    };\n    return ServiceInternals;\n}();\n\nvar name = \"@firebase/storage\";\nvar version = \"0.3.43\";\n\n/**\r\n                         * @license\r\n                         * Copyright 2017 Google LLC\r\n                         *\r\n                         * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n                         * you may not use this file except in compliance with the License.\r\n                         * You may obtain a copy of the License at\r\n                         *\r\n                         *   http://www.apache.org/licenses/LICENSE-2.0\r\n                         *\r\n                         * Unless required by applicable law or agreed to in writing, software\r\n                         * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n                         * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n                         * See the License for the specific language governing permissions and\r\n                         * limitations under the License.\r\n                         */\n/**\r\n                             * Type constant for Firebase Storage.\r\n                             */\nvar STORAGE_TYPE = 'storage';\nfunction factory(container, url) {\n    // Dependencies\n    var app = container.getProvider('app').getImmediate();\n    var authProvider = container.getProvider('auth-internal');\n    return new StorageService(app, authProvider, new XhrIoPool(), url);\n}\nfunction registerStorage(instance) {\n    var namespaceExports = {\n        // no-inline\n        TaskState: TaskState,\n        TaskEvent: TaskEvent,\n        StringFormat: StringFormat,\n        Storage: StorageService,\n        Reference: Reference };\n\n    instance.INTERNAL.registerComponent(new _component.Component(STORAGE_TYPE, factory, \"PUBLIC\" /* PUBLIC */).\n    setServiceProps(namespaceExports).\n    setMultipleInstances(true));\n    instance.registerVersion(name, version);\n}\nregisterStorage(_app2.default);exports.\n\nregisterStorage = registerStorage;\n//# sourceMappingURL=index.esm.js.map\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/@firebase/storage/dist/index.esm.js\n// module id = 21\n// module chunks = 0\n\n//# sourceURL=webpack:///./~/@firebase/storage/dist/index.esm.js?");

/***/ }),
/* 22 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("var _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) {return typeof obj;} : function (obj) {return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;};\n\nvar firebase = __webpack_require__(6);\n\nfunction _interopDefaultLegacy(e) {return e && (typeof e === 'undefined' ? 'undefined' : _typeof(e)) === 'object' && 'default' in e ? e : { 'default': e };}\n\nvar firebase__default = /*#__PURE__*/_interopDefaultLegacy(firebase);\n\nvar name = \"firebase\";\nvar version = \"7.24.0\";\n\n/**\r\n                         * @license\r\n                         * Copyright 2018 Google LLC\r\n                         *\r\n                         * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n                         * you may not use this file except in compliance with the License.\r\n                         * You may obtain a copy of the License at\r\n                         *\r\n                         *   http://www.apache.org/licenses/LICENSE-2.0\r\n                         *\r\n                         * Unless required by applicable law or agreed to in writing, software\r\n                         * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n                         * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n                         * See the License for the specific language governing permissions and\r\n                         * limitations under the License.\r\n                         */\nfirebase__default['default'].registerVersion(name, version, 'app');\n\nmodule.exports = firebase__default['default'];\n//# sourceMappingURL=index.cjs.js.map\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/firebase/app/dist/index.cjs.js\n// module id = 22\n// module chunks = 0\n\n//# sourceURL=webpack:///./~/firebase/app/dist/index.cjs.js?");

/***/ }),
/* 23 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("__webpack_require__(19);\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/firebase/auth/dist/index.esm.js\n// module id = 23\n// module chunks = 0\n\n//# sourceURL=webpack:///./~/firebase/auth/dist/index.esm.js?");

/***/ }),
/* 24 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("__webpack_require__(20);\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/firebase/database/dist/index.esm.js\n// module id = 24\n// module chunks = 0\n\n//# sourceURL=webpack:///./~/firebase/database/dist/index.esm.js?");

/***/ }),
/* 25 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("__webpack_require__(21);\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/firebase/storage/dist/index.esm.js\n// module id = 25\n// module chunks = 0\n\n//# sourceURL=webpack:///./~/firebase/storage/dist/index.esm.js?");

/***/ }),
/* 26 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("module.exports = function (module) {\n\tif (!module.webpackPolyfill) {\n\t\tmodule.deprecate = function () {};\n\t\tmodule.paths = [];\n\t\t// module.parent = undefined by default\n\t\tif (!module.children) module.children = [];\n\t\tObject.defineProperty(module, \"loaded\", {\n\t\t\tenumerable: true,\n\t\t\tget: function get() {\n\t\t\t\treturn module.l;\n\t\t\t} });\n\n\t\tObject.defineProperty(module, \"id\", {\n\t\t\tenumerable: true,\n\t\t\tget: function get() {\n\t\t\t\treturn module.i;\n\t\t\t} });\n\n\t\tmodule.webpackPolyfill = 1;\n\t}\n\treturn module;\n};\n\n//////////////////\n// WEBPACK FOOTER\n// (webpack)/buildin/module.js\n// module id = 26\n// module chunks = 0\n\n//# sourceURL=webpack:///(webpack)/buildin/module.js?");

/***/ }),
/* 27 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("Object.defineProperty(exports, \"__esModule\", { value: true });var _createClass = function () {function defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if (\"value\" in descriptor) descriptor.writable = true;Object.defineProperty(target, descriptor.key, descriptor);}}return function (Constructor, protoProps, staticProps) {if (protoProps) defineProperties(Constructor.prototype, protoProps);if (staticProps) defineProperties(Constructor, staticProps);return Constructor;};}();var _three = __webpack_require__(0);var THREE = _interopRequireWildcard(_three);\n\nvar _config = __webpack_require__(1);var _config2 = _interopRequireDefault(_config);function _interopRequireDefault(obj) {return obj && obj.__esModule ? obj : { default: obj };}function _interopRequireWildcard(obj) {if (obj && obj.__esModule) {return obj;} else {var newObj = {};if (obj != null) {for (var key in obj) {if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key];}}newObj.default = obj;return newObj;}}function _classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError(\"Cannot call a class as a function\");}}\n\n// Class that creates and updates the main camera\nvar Camera = function () {\n  function Camera(renderer) {var _this = this;_classCallCheck(this, Camera);\n    var width = renderer.domElement.width;\n    var height = renderer.domElement.height;\n\n    // Create and position a Perspective Camera\n    this.threeCamera = new THREE.PerspectiveCamera(_config2.default.camera.fov, width / height, _config2.default.camera.near, _config2.default.camera.far);\n    this.threeCamera.position.set(_config2.default.camera.posX, _config2.default.camera.posY, _config2.default.camera.posZ);\n\n    // Initial sizing\n    this.updateSize(renderer);\n\n    // Listeners\n    window.addEventListener('resize', function () {return _this.updateSize(renderer);}, false);\n  }_createClass(Camera, [{ key: 'updateSize', value: function updateSize(\n\n    renderer) {\n      // Multiply by dpr in case it is retina device\n      this.threeCamera.aspect = renderer.domElement.width / renderer.domElement.height;\n\n      // Always call updateProjectionMatrix on camera change\n      this.threeCamera.updateProjectionMatrix();\n    } }]);return Camera;}();exports.default = Camera;\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/js/app/components/camera.js\n// module id = 27\n// module chunks = 0\n\n//# sourceURL=webpack:///./src/js/app/components/camera.js?");

/***/ }),
/* 28 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("Object.defineProperty(exports, \"__esModule\", { value: true });var _createClass = function () {function defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if (\"value\" in descriptor) descriptor.writable = true;Object.defineProperty(target, descriptor.key, descriptor);}}return function (Constructor, protoProps, staticProps) {if (protoProps) defineProperties(Constructor.prototype, protoProps);if (staticProps) defineProperties(Constructor, staticProps);return Constructor;};}();var _three = __webpack_require__(0);var THREE = _interopRequireWildcard(_three);\n\nvar _orbitControls = __webpack_require__(43);var _orbitControls2 = _interopRequireDefault(_orbitControls);\nvar _config = __webpack_require__(1);var _config2 = _interopRequireDefault(_config);function _interopRequireDefault(obj) {return obj && obj.__esModule ? obj : { default: obj };}function _interopRequireWildcard(obj) {if (obj && obj.__esModule) {return obj;} else {var newObj = {};if (obj != null) {for (var key in obj) {if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key];}}newObj.default = obj;return newObj;}}function _classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError(\"Cannot call a class as a function\");}}\n\n// Controls based on orbit controls\nvar Controls = function () {\n  function Controls(camera, container) {_classCallCheck(this, Controls);\n    // Orbit controls first needs to pass in THREE to constructor\n    var orbitControls = new _orbitControls2.default(THREE);\n    this.threeControls = new orbitControls(camera, container);\n\n    // Controls are only in enabled via 'c' keypress\n    this.threeControls.enabled = true;\n\n    this.threeControls.mouseButtons = {\n      ORBIT: THREE.MOUSE.LEFT,\n      PAN: THREE.MOUSE.RIGHT,\n      ZOOM: THREE.MOUSE.MIDDLE };\n\n\n    this.init();\n  }_createClass(Controls, [{ key: 'disableZoom', value: function disableZoom()\n\n    {\n      this.threeControls.enableZoom = false;\n    } }, { key: 'enableZoom', value: function enableZoom()\n    {\n      this.threeControls.enableZoom = true;\n    } }, { key: 'disablePan', value: function disablePan()\n\n    {\n      this.threeControls.enablePan = false;\n    } }, { key: 'enablePan', value: function enablePan()\n    {\n      this.threeControls.enablePan = true;\n    } }, { key: 'disable', value: function disable()\n\n    {\n      this.threeControls.enabled = false;\n    } }, { key: 'enable', value: function enable()\n    {\n      this.threeControls.enabled = true;\n    } }, { key: 'init', value: function init()\n\n    {\n      this.threeControls.target.set(_config2.default.controls.target.x, _config2.default.controls.target.y, _config2.default.controls.target.z);\n      this.threeControls.autoRotate = _config2.default.controls.autoRotate;\n      this.threeControls.autoRotateSpeed = _config2.default.controls.autoRotateSpeed;\n      this.threeControls.rotateSpeed = _config2.default.controls.rotateSpeed;\n      this.threeControls.zoomSpeed = _config2.default.controls.zoomSpeed;\n      this.threeControls.minDistance = _config2.default.controls.minDistance;\n      this.threeControls.maxDistance = _config2.default.controls.maxDistance;\n      this.threeControls.minPolarAngle = _config2.default.controls.minPolarAngle;\n      this.threeControls.maxPolarAngle = _config2.default.controls.maxPolarAngle;\n      this.threeControls.enableDamping = _config2.default.controls.enableDamping;\n      this.threeControls.enableZoom = _config2.default.controls.enableZoom;\n      this.threeControls.dampingFactor = _config2.default.controls.dampingFactor;\n    } }]);return Controls;}();exports.default = Controls;\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/js/app/components/controls.js\n// module id = 28\n// module chunks = 0\n\n//# sourceURL=webpack:///./src/js/app/components/controls.js?");

/***/ }),
/* 29 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("Object.defineProperty(exports, \"__esModule\", { value: true });var _createClass = function () {function defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if (\"value\" in descriptor) descriptor.writable = true;Object.defineProperty(target, descriptor.key, descriptor);}}return function (Constructor, protoProps, staticProps) {if (protoProps) defineProperties(Constructor.prototype, protoProps);if (staticProps) defineProperties(Constructor, staticProps);return Constructor;};}();\nvar _three = __webpack_require__(0);var THREE = _interopRequireWildcard(_three);\n__webpack_require__(10);\n\nvar _config = __webpack_require__(1);var _config2 = _interopRequireDefault(_config);\nvar _helpers = __webpack_require__(2);var _helpers2 = _interopRequireDefault(_helpers);function _interopRequireDefault(obj) {return obj && obj.__esModule ? obj : { default: obj };}function _interopRequireWildcard(obj) {if (obj && obj.__esModule) {return obj;} else {var newObj = {};if (obj != null) {for (var key in obj) {if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key];}}newObj.default = obj;return newObj;}}function _classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError(\"Cannot call a class as a function\");}}var\n\nHeadObject = function () {\n  function HeadObject(main) {_classCallCheck(this, HeadObject);\n    this.locked = false;\n    this.type = 'HeadObject';\n    this.rotation = {};\n    this.radius = 60;\n    this.app = main;\n    this.roomCode = main.roomCode;\n\n    this.trajectory = null;\n    this.trajectoryClock = _config2.default.soundObject.defaultTrajectoryClock;\n    this.movementSpeed = _config2.default.soundObject.defaultMovementSpeed;\n    this.movementDirection = _config2.default.soundObject.defaultMovementDirection;\n    this.movementIncrement = null;\n    this.oldPosition = null;\n    this.hasBeenMoved = false;\n    this.lastPathPosition = new THREE.Vector3();\n\n    this.tangent = new THREE.Vector3();\n    this.axis = new THREE.Vector3();\n    this.up = new THREE.Vector3(0, 0, -1);\n    this.counter = 0;\n\n    var sphereGeometry = new THREE.SphereBufferGeometry(this.radius, 100, 100);\n    var sphereMaterial = new THREE.MeshBasicMaterial({\n      color: 0xFFFFFF,\n      opacity: 0,\n      transparent: true,\n      depthWrite: false });\n\n    this.sphere = new THREE.Mesh(sphereGeometry, sphereMaterial);\n    this.sphere.castShadow = false;\n\n    this.containerObject = new THREE.Object3D();\n    this.containerObject.add(this.sphere);\n    main.scene.add(this.containerObject);\n  }_createClass(HeadObject, [{ key: 'setActive', value: function setActive(\n\n    main) {\n      if (this.trajectory) {\n        this.trajectory.setActive();\n        this.trajectory.setMouseOffset(main.nonScaledMouse, main.mouse);\n      }\n    } }, { key: 'setInactive', value: function setInactive()\n\n    {\n      if (this.trajectory) {\n        this.trajectory.setInactive();\n      }\n    } }, { key: 'clear', value: function clear()\n\n    {\n      if (this.trajectory) {\n        this.app.removeSoundTrajectory(this.trajectory);\n        this.trajectory = null;\n        this.trajectoryClock = _config2.default.soundObject.defaultMovementSpeed;\n      }\n    } }, { key: 'isUnderMouse', value: function isUnderMouse(\n\n    ray) {\n      return ray.intersectObject(this.containerObject, true).length > 0;\n    } }, { key: 'select', value: function select(\n\n    main) {\n      this.nonScaledMouseOffsetY = main.nonScaledMouse.y;\n    } }, { key: 'move', value: function move(\n\n    main, isTrajectoryDragging) {\n      var pointer = void 0;\n\n      if (main.perspectiveView) {\n        var posY = _helpers2.default.mapRange(\n        main.nonScaledMouse.y - this.nonScaledMouseOffsetY,\n        -0.5,\n        0.5,\n        -200,\n        200);\n\n\n        pointer = this.containerObject.position;\n        if (pointer.y > -200 || pointer.y < 200) pointer.y += posY;\n\n        // clamp\n        pointer.y = Math.max(Math.min(pointer.y, 300), -300);\n\n        this.nonScaledMouseOffsetY = main.nonScaledMouse.y;\n      } else {\n        pointer = main.mouse;\n        pointer.y = this.containerObject.position.y;\n      }\n\n      if (this.trajectory) this.trajectory.move(pointer, main.nonScaledMouse, main.perspectiveView);\n\n      this.containerObject.position.copy(pointer);\n      this.app.isAllowMouseDrag = true;\n\n      if (!isTrajectoryDragging) {\n        this.hasBeenMoved = true;\n      }\n    } }, { key: 'setPosition', value: function setPosition(\n\n    position) {\n      this.containerObject.position.copy(position);\n    } }, { key: 'resetPosition', value: function resetPosition()\n\n    {\n      this.app.headObject.containerObject.position.setY(0);\n      this.app.head.position.setY(0);\n      this.app.altitudeHelper.position.copy(this.app.head.position);\n      this.app.altitudeHelper.position.y = 0;\n      this.app.axisHelper.position.copy(this.app.head.position);\n\n      // set the quaternion\n      var resetAxis = new THREE.Vector3(0, 0, -1);\n      this.containerObject.quaternion.setFromAxisAngle(resetAxis, 0);\n      this.app.head.quaternion.setFromAxisAngle(resetAxis, 0);\n      this.app.axisHelper.quaternion.setFromAxisAngle(resetAxis, 0);\n    } }, { key: 'calculateMovementSpeed', value: function calculateMovementSpeed()\n\n    {\n      if (this.trajectory) {\n        this.movementIncrement = this.movementSpeed / this.trajectory.spline.getLength(20);\n      }\n    } }, { key: 'updateSpeed', value: function updateSpeed(\n\n    rawSpeed) {\n      if (this.roomCode != null) {\n        this.app.dbRef.child('users').child(this.app.headKey.key).update({\n          speed: rawSpeed });\n\n      }\n    } }, { key: 'followTrajectory', value: function followTrajectory(\n\n    play) {var otherHead = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;\n      if (this.trajectory && play) {\n        this.trajectoryClock -= this.movementDirection * this.movementIncrement;\n\n        if (this.trajectoryClock >= 1) {\n          if (this.trajectory.spline.closed) {\n            this.trajectoryClock = 0;\n          } else {\n            this.movementDirection = -this.movementDirection;\n            this.trajectoryClock = 1;\n          }\n        }\n\n        if (this.trajectoryClock < 0) {\n          if (this.trajectory.spline.closed) {\n            this.trajectoryClock = 1;\n          } else {\n            this.movementDirection = -this.movementDirection;\n            this.trajectoryClock = 0;\n          }\n        }\n\n        var pointOnTrajectory = this.trajectory.spline.getPointAt(this.trajectoryClock);\n        this.containerObject.position.copy(pointOnTrajectory);\n\n        // get the tangent to the curve\n        this.tangent = this.trajectory.spline.getTangent(this.trajectoryClock).normalize();\n\n        // calculate the axis to rotate around\n        this.axis.crossVectors(this.up, this.tangent).normalize();\n\n        // calcluate the angle between the up vector and the tangent\n        var radians = Math.acos(this.up.dot(this.tangent));\n        // radians -= Math.PI;\n\n        // set the quaternion\n        this.containerObject.quaternion.setFromAxisAngle(this.axis, radians);\n        if (otherHead == null) {\n          // TODO: \n          this.app.head.quaternion.setFromAxisAngle(this.axis, radians);\n          this.app.axisHelper.quaternion.setFromAxisAngle(this.axis, radians);\n        } else {\n          otherHead.quaternion.setFromAxisAngle(this.axis, radians);\n        }\n\n        // this.counter = (this.counter >= 1) ? 0 : this.counter += 0.002;\n\n      }\n    } }, { key: 'toJSON', value: function toJSON()\n\n    {\n      return JSON.stringify({\n        position: this.containerObject.position,\n        rotation: this.rotation,\n        movementSpeed: this.movementSpeed,\n        trajectory: this.trajectory && this.trajectory.points || null });\n\n    } }, { key: 'fromJSON', value: function fromJSON(\n\n    json, importedData) {\n      var object = JSON.parse(json);\n      this.containerObject.position.copy(object.position);\n      this.rotation = object.rotation;\n      this.movementSpeed = object.movementSpeed;\n\n      this.app.axisHelper.position.copy(this.containerObject.position);\n      this.app.head.position.copy(this.containerObject.position);\n      this.app.axisHelper.rotation.y = this.rotation.y;\n      this.app.head.rotation.y = this.rotation.y;\n    } }]);return HeadObject;}();exports.default = HeadObject;\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/js/app/components/headobject.js\n// module id = 29\n// module chunks = 0\n\n//# sourceURL=webpack:///./src/js/app/components/headobject.js?");

/***/ }),
/* 30 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("Object.defineProperty(exports, \"__esModule\", { value: true });var _createClass = function () {function defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if (\"value\" in descriptor) descriptor.writable = true;Object.defineProperty(target, descriptor.key, descriptor);}}return function (Constructor, protoProps, staticProps) {if (protoProps) defineProperties(Constructor.prototype, protoProps);if (staticProps) defineProperties(Constructor, staticProps);return Constructor;};}();var _three = __webpack_require__(0);var THREE = _interopRequireWildcard(_three);\n\nvar _config = __webpack_require__(1);var _config2 = _interopRequireDefault(_config);function _interopRequireDefault(obj) {return obj && obj.__esModule ? obj : { default: obj };}function _interopRequireWildcard(obj) {if (obj && obj.__esModule) {return obj;} else {var newObj = {};if (obj != null) {for (var key in obj) {if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key];}}newObj.default = obj;return newObj;}}function _classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError(\"Cannot call a class as a function\");}}\n\n// Sets up and places all lights in scene\nvar Light = function () {\n  function Light(scene) {_classCallCheck(this, Light);\n    this.scene = scene;\n\n    this.init();\n  }_createClass(Light, [{ key: 'init', value: function init()\n\n    {\n      // Ambient\n      this.ambientLight = new THREE.AmbientLight(_config2.default.ambientLight.color);\n      this.ambientLight.visible = _config2.default.ambientLight.enabled;\n\n      // Point light\n      this.pointLight = new THREE.PointLight(_config2.default.pointLight.color, _config2.default.pointLight.intensity, _config2.default.pointLight.distance);\n      this.pointLight.position.set(_config2.default.pointLight.x, _config2.default.pointLight.y, _config2.default.pointLight.z);\n      this.pointLight.visible = _config2.default.pointLight.enabled;\n\n      // Directional light\n      this.directionalLight = new THREE.DirectionalLight(_config2.default.directionalLight.color, _config2.default.directionalLight.intensity);\n      this.directionalLight.position.set(_config2.default.directionalLight.x, _config2.default.directionalLight.y, _config2.default.directionalLight.z);\n      this.directionalLight.position.multiplyScalar(_config2.default.directionalLight.multiplyScalar);\n      this.directionalLight.visible = _config2.default.directionalLight.enabled;\n      this.directionalLight.color.setHSL(_config2.default.directionalLight.hue, _config2.default.directionalLight.saturation, _config2.default.directionalLight.lightness);\n\n      // Shadow map\n      this.directionalLight.castShadow = _config2.default.shadow.enabled;\n      this.directionalLight.shadow.bias = _config2.default.shadow.bias;\n      this.directionalLight.shadow.camera.near = _config2.default.shadow.near;\n      this.directionalLight.shadow.camera.far = _config2.default.shadow.far;\n      this.directionalLight.shadow.camera.left = _config2.default.shadow.left;\n      this.directionalLight.shadow.camera.right = _config2.default.shadow.right;\n      this.directionalLight.shadow.camera.top = _config2.default.shadow.top;\n      this.directionalLight.shadow.camera.bottom = _config2.default.shadow.bottom;\n      this.directionalLight.shadow.mapSize.width = _config2.default.shadow.mapWidth;\n      this.directionalLight.shadow.mapSize.height = _config2.default.shadow.mapHeight;\n\n      // Shadow camera helper\n      this.directionalLightHelper = new THREE.CameraHelper(this.directionalLight.shadow.camera);\n      this.directionalLightHelper.visible = _config2.default.shadow.helperEnabled;\n\n      // Hemisphere light\n      this.hemiLight = new THREE.HemisphereLight(_config2.default.hemiLight.color, _config2.default.hemiLight.groundColor, _config2.default.hemiLight.intensity);\n      this.hemiLight.position.set(_config2.default.hemiLight.x, _config2.default.hemiLight.y, _config2.default.hemiLight.z);\n      this.hemiLight.visible = _config2.default.hemiLight.enabled;\n    } }, { key: 'place', value: function place(\n\n    lightName) {\n      switch (lightName) {\n        case 'ambient':\n          this.scene.add(this.ambientLight);\n          break;\n\n        case 'directional':\n          this.scene.add(this.directionalLight);\n          this.scene.add(this.directionalLightHelper);\n          break;\n\n        case 'point':\n          this.scene.add(this.pointLight);\n          break;\n\n        case 'hemi':\n          this.scene.add(this.hemiLight);\n          break;}\n\n    } }]);return Light;}();exports.default = Light;\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/js/app/components/light.js\n// module id = 30\n// module chunks = 0\n\n//# sourceURL=webpack:///./src/js/app/components/light.js?");

/***/ }),
/* 31 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("Object.defineProperty(exports, \"__esModule\", { value: true });var _createClass = function () {function defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if (\"value\" in descriptor) descriptor.writable = true;Object.defineProperty(target, descriptor.key, descriptor);}}return function (Constructor, protoProps, staticProps) {if (protoProps) defineProperties(Constructor.prototype, protoProps);if (staticProps) defineProperties(Constructor, staticProps);return Constructor;};}();var _three = __webpack_require__(0);var THREE = _interopRequireWildcard(_three);\nvar _soundobject = __webpack_require__(4);var _soundobject2 = _interopRequireDefault(_soundobject);\nvar _soundtrajectory = __webpack_require__(15);var _soundtrajectory2 = _interopRequireDefault(_soundtrajectory);\nvar _soundzone = __webpack_require__(7);var _soundzone2 = _interopRequireDefault(_soundzone);\nvar _action = __webpack_require__(5);var _action2 = _interopRequireDefault(_action);function _interopRequireDefault(obj) {return obj && obj.__esModule ? obj : { default: obj };}function _interopRequireWildcard(obj) {if (obj && obj.__esModule) {return obj;} else {var newObj = {};if (obj != null) {for (var key in obj) {if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key];}}newObj.default = obj;return newObj;}}function _classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError(\"Cannot call a class as a function\");}}var\n\nPathDrawer = function () {\n  function PathDrawer(scene, main) {_classCallCheck(this, PathDrawer);\n    this.parentObject = null;\n    this.scene = scene;\n    this.points = [];\n    this.lines = [];\n    this.lastPoint = new THREE.Vector3();\n    this.isDrawing = false,\n\n    this.material = {\n      trajectory: new THREE.LineBasicMaterial({\n        linewidth: 2,\n        color: 0x999999 }),\n\n      zone: new THREE.LineBasicMaterial({\n        linewidth: 5,\n        color: 0xff1169 }) };\n\n\n\n  }_createClass(PathDrawer, [{ key: 'beginAt', value: function beginAt(\n\n    point, trajectoryContainerObject) {\n      this.isDrawing = true;\n      this.parentObject = trajectoryContainerObject || null;\n      this.lastPoint = point;\n      this.points = [point];\n    } }, { key: 'addPoint', value: function addPoint(\n\n    point) {\n      if (this.isDrawing) {// redundant check? just to be safe for now\n        var material = this.parentObject ?\n        this.material.trajectory :\n        this.material.zone;\n\n        var points = [];\n        points.push(this.lastPoint);\n        points.push(point);\n\n        // consider using line geometry for thicker line\n        var geometry = new THREE.BufferGeometry().setFromPoints(points);\n        var line = new THREE.Line(geometry, material);\n\n        this.lastPoint = point;\n        this.points.push(point);\n        this.lines.push(line);\n        this.scene.add(line);\n      }\n    } }, { key: 'createObject', value: function createObject(\n\n    main)\n    {var loader = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;var repeat = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;var currentUser = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : true;var trajectory = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : null;\n      if (this.isDrawing || loader) {\n        this.isDrawing = false;\n        var points = trajectory;\n        if (trajectory === null) {\n          points = simplify(this.points, 10, true);\n        }\n        var object = void 0;\n        if (this.parentObject) {\n          if (points.length >= 2) {\n            object = new _soundtrajectory2.default(main, points);\n            // if (main.isUserStudyLoading) object.turnInvisible();\n            object.points = points;\n            this.parentObject.trajectory = object;\n            object.parentSoundObject = this.parentObject;\n            main.soundTrajectories.push(object);\n            if (this.parentObject.type === 'SoundObject') {\n              // move add-cone to appropriate position\n              var guiHeight = document.getElementById('guis');\n              var baseParams = document.getElementsByClassName('baseParam');\n              if (guiHeight && baseParams.length > 0) {\n                guiHeight = guiHeight.scrollHeight;\n                baseParams = baseParams[0].scrollHeight;\n                if (document.getElementById('add-cone')) {\n                  var addButton = document.getElementById('add-cone');\n                  if (addButton.style.position == \"absolute\") {\n                    addButton.classList.add('add-cone-object-view');\n                    if (main.isEditingObject) {\n                      addButton.style.top = \"167.5px\";\n                    } else {\n                      addButton.style.top = \"228.51px\";\n                    }\n                  }\n                }\n              }\n            }\n            if (main.roomCode != null && currentUser) {\n              if (this.parentObject.type === 'SoundObject') {\n                main.dbRef.child('objects').child(this.parentObject.containerObject.name).update({\n                  trajectory: points });\n\n              } else {// head trajectory\n                main.dbRef.child('users').child(main.headKey.key).update({\n                  trajectory: points });\n\n              }\n            }\n            if (!repeat) {\n              main.undoableActionStack.push(new _action2.default(object, 'addSoundTrajectory'));\n            }\n          }\n        } else\n        {\n          if (points.length >= 3) {\n            object = new _soundzone2.default(main, points);\n            // if (main.isUserStudyLoading) object.turnInvisible();\n            object.checkPlayState(main);\n            main.soundZones.push(object);\n            if (main.roomCode == null) {\n              main.undoableActionStack.push(new _action2.default(object, 'addSoundZone'));\n            }\n          } else {\n            object = new _soundobject2.default(main);\n            // if (main.isUserStudyLoading) object.turnInvisible();\n            object.checkPlayState(main);\n            main.soundObjects.push(object);\n            if (main.roomCode == null) {\n              main.undoableActionStack.push(new _action2.default(object, 'addSoundObject'));\n            }\n          }\n        }\n\n        this.clear();\n\n        if (object) {\n          console.log(\"adding to scene\");\n          object.addToScene(this.scene);\n        }\n        return object;\n      } else\n      {\n        console.log('called createObject when not drawing');\n      }\n    } }, { key: 'clear', value: function clear()\n\n    {var _this = this;\n      this.parentObject = null;\n      this.lines.forEach(function (line) {\n        _this.scene.remove(line);\n      });\n      this.lines = [];\n      this.points = [];\n    } }]);return PathDrawer;}();exports.default = PathDrawer;\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/js/app/components/pathdrawer.js\n// module id = 31\n// module chunks = 0\n\n//# sourceURL=webpack:///./src/js/app/components/pathdrawer.js?");

/***/ }),
/* 32 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("Object.defineProperty(exports, \"__esModule\", { value: true });var _createClass = function () {function defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if (\"value\" in descriptor) descriptor.writable = true;Object.defineProperty(target, descriptor.key, descriptor);}}return function (Constructor, protoProps, staticProps) {if (protoProps) defineProperties(Constructor.prototype, protoProps);if (staticProps) defineProperties(Constructor, staticProps);return Constructor;};}();var _three = __webpack_require__(0);var THREE = _interopRequireWildcard(_three);\n\nvar _config = __webpack_require__(1);var _config2 = _interopRequireDefault(_config);function _interopRequireDefault(obj) {return obj && obj.__esModule ? obj : { default: obj };}function _interopRequireWildcard(obj) {if (obj && obj.__esModule) {return obj;} else {var newObj = {};if (obj != null) {for (var key in obj) {if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key];}}newObj.default = obj;return newObj;}}function _classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError(\"Cannot call a class as a function\");}}\n\n// Main webGL renderer class\nvar Renderer = function () {\n  function Renderer(scene, container) {var _this = this;_classCallCheck(this, Renderer);\n    // Properties\n    this.scene = scene;\n    this.container = container;\n\n    // Create WebGL renderer and set its antialias\n    this.threeRenderer = new THREE.WebGLRenderer({ antialias: true });\n\n    // Set clear color to fog to enable fog or to hex color for no fog\n    this.threeRenderer.setClearColor(0xf0f0f0);\n    this.threeRenderer.setPixelRatio(window.devicePixelRatio); // For retina\n\n    this.threeRenderer.autoClear = false;\n\n    // Appends canvas\n    container.appendChild(this.threeRenderer.domElement);\n\n    // Shadow map options\n    this.threeRenderer.shadowMap.enabled = true;\n    // this.threeRenderer.shadowMap.type = THREE.PCFSoftShadowMap;\n\n    // Get anisotropy for textures\n    _config2.default.maxAnisotropy = this.threeRenderer.capabilities.getMaxAnisotropy();\n\n    // Initial size update set to canvas container\n    this.updateSize();\n\n    // Listeners\n    document.addEventListener('DOMContentLoaded', function () {return _this.updateSize();}, false);\n    window.addEventListener('resize', function () {return _this.updateSize();}, false);\n  }_createClass(Renderer, [{ key: 'updateSize', value: function updateSize()\n\n    {\n      this.threeRenderer.setSize(this.container.offsetWidth, this.container.offsetHeight);\n    } }, { key: 'render', value: function render(\n\n    scene, camera) {\n      // Renders scene to canvas target\n      this.threeRenderer.clear();\n      this.threeRenderer.setViewport(0, 0, window.innerWidth, window.innerHeight);\n      this.threeRenderer.render(scene, camera);\n    } }]);return Renderer;}();exports.default = Renderer;\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/js/app/components/renderer.js\n// module id = 32\n// module chunks = 0\n\n//# sourceURL=webpack:///./src/js/app/components/renderer.js?");

/***/ }),
/* 33 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("Object.defineProperty(exports, \"__esModule\", { value: true });var _createClass = function () {function defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if (\"value\" in descriptor) descriptor.writable = true;Object.defineProperty(target, descriptor.key, descriptor);}}return function (Constructor, protoProps, staticProps) {if (protoProps) defineProperties(Constructor.prototype, protoProps);if (staticProps) defineProperties(Constructor, staticProps);return Constructor;};}();var _three = __webpack_require__(0);var THREE = _interopRequireWildcard(_three);\n\nvar _material = __webpack_require__(16);var _material2 = _interopRequireDefault(_material);\n\nvar _config = __webpack_require__(1);var _config2 = _interopRequireDefault(_config);function _interopRequireDefault(obj) {return obj && obj.__esModule ? obj : { default: obj };}function _interopRequireWildcard(obj) {if (obj && obj.__esModule) {return obj;} else {var newObj = {};if (obj != null) {for (var key in obj) {if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key];}}newObj.default = obj;return newObj;}}function _toConsumableArray(arr) {if (Array.isArray(arr)) {for (var i = 0, arr2 = Array(arr.length); i < arr.length; i++) {arr2[i] = arr[i];}return arr2;} else {return Array.from(arr);}}function _classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError(\"Cannot call a class as a function\");}}\n\n// This helper class can be used to create and then place geometry in the scene\nvar Geometry = function () {\n  function Geometry(scene) {_classCallCheck(this, Geometry);\n    this.scene = scene;\n    this.geo = null;\n  }_createClass(Geometry, [{ key: 'make', value: function make(\n\n    type) {var _this = this;\n      if (type == 'plane') {\n        return function (width, height) {var widthSegments = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 1;var heightSegments = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 1;\n          _this.geo = new THREE.PlaneGeometry(width, height, widthSegments, heightSegments);\n        };\n      }\n\n      if (type == 'sphere') {\n        return function (radius) {var widthSegments = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 32;var heightSegments = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 32;\n          _this.geo = new THREE.SphereGeometry(radius, widthSegments, heightSegments);\n        };\n      }\n    } }, { key: 'place', value: function place(\n\n    position, rotation) {var _mesh$position, _mesh$rotation;\n      var material = new _material2.default(0xffffff).standard;\n      var mesh = new THREE.Mesh(this.geo, material);\n\n      // Use ES6 spread to set position and rotation from passed in array\n      (_mesh$position = mesh.position).set.apply(_mesh$position, _toConsumableArray(position));\n      (_mesh$rotation = mesh.rotation).set.apply(_mesh$rotation, _toConsumableArray(rotation));\n\n      if (_config2.default.shadow.enabled) {\n        mesh.receiveShadow = true;\n      }\n\n      this.scene.add(mesh);\n    } }]);return Geometry;}();exports.default = Geometry;\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/js/app/helpers/geometry.js\n// module id = 33\n// module chunks = 0\n\n//# sourceURL=webpack:///./src/js/app/helpers/geometry.js?");

/***/ }),
/* 34 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("Object.defineProperty(exports, \"__esModule\", { value: true });var _three = __webpack_require__(0);var THREE = _interopRequireWildcard(_three);function _interopRequireWildcard(obj) {if (obj && obj.__esModule) {return obj;} else {var newObj = {};if (obj != null) {for (var key in obj) {if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key];}}newObj.default = obj;return newObj;}}function _classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError(\"Cannot call a class as a function\");}}\n\n// Simple mesh helper that shows edges, wireframes, and face and vertex normals\nvar MeshHelper =\nfunction MeshHelper(scene, mesh) {_classCallCheck(this, MeshHelper);\n  var wireframe = new THREE.WireframeGeometry(mesh.geometry);\n  var wireLine = new THREE.LineSegments(wireframe);\n  wireLine.material.depthTest = false;\n  wireLine.material.opacity = 0.25;\n  wireLine.material.transparent = true;\n  mesh.add(wireLine);\n\n  var edges = new THREE.EdgesGeometry(mesh.geometry);\n  var edgesLine = new THREE.LineSegments(edges);\n  edgesLine.material.depthTest = false;\n  edgesLine.material.opacity = 0.25;\n  edgesLine.material.transparent = true;\n  mesh.add(edgesLine);\n\n  scene.add(new THREE.BoxHelper(mesh));\n  scene.add(new THREE.FaceNormalsHelper(mesh, 2));\n  scene.add(new THREE.VertexNormalsHelper(mesh, 2));\n};exports.default = MeshHelper;\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/js/app/helpers/meshHelper.js\n// module id = 34\n// module chunks = 0\n\n//# sourceURL=webpack:///./src/js/app/helpers/meshHelper.js?");

/***/ }),
/* 35 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("Object.defineProperty(exports, \"__esModule\", { value: true });var _slicedToArray = function () {function sliceIterator(arr, i) {var _arr = [];var _n = true;var _d = false;var _e = undefined;try {for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) {_arr.push(_s.value);if (i && _arr.length === i) break;}} catch (err) {_d = true;_e = err;} finally {try {if (!_n && _i[\"return\"]) _i[\"return\"]();} finally {if (_d) throw _e;}}return _arr;}return function (arr, i) {if (Array.isArray(arr)) {return arr;} else if (Symbol.iterator in Object(arr)) {return sliceIterator(arr, i);} else {throw new TypeError(\"Invalid attempt to destructure non-iterable instance\");}};}();var _createClass = function () {function defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if (\"value\" in descriptor) descriptor.writable = true;Object.defineProperty(target, descriptor.key, descriptor);}}return function (Constructor, protoProps, staticProps) {if (protoProps) defineProperties(Constructor.prototype, protoProps);if (staticProps) defineProperties(Constructor, staticProps);return Constructor;};}(); // latest version of three.js as of 07/20/2022: 0.142.0\n// this app uses 0.87.1 of three.js\n\n\n\n\n\n\n\n\n// Components\n\n\n\n\n\n\n// Helpers\n\n\n// Model\n\n\n\n// Managers\n\n\n\n\n// data\n\n\n// Firebase\nvar _three = __webpack_require__(0);var THREE = _interopRequireWildcard(_three);var _tween = __webpack_require__(13);var _tween2 = _interopRequireDefault(_tween);var _objloader = __webpack_require__(42);var _objloader2 = _interopRequireDefault(_objloader);var _helpers = __webpack_require__(2);var _helpers2 = _interopRequireDefault(_helpers);var _headobject = __webpack_require__(29);var _headobject2 = _interopRequireDefault(_headobject);var _soundobject = __webpack_require__(4);var _soundobject2 = _interopRequireDefault(_soundobject);var _soundzone = __webpack_require__(7);var _soundzone2 = _interopRequireDefault(_soundzone);var _renderer = __webpack_require__(32);var _renderer2 = _interopRequireDefault(_renderer);var _camera = __webpack_require__(27);var _camera2 = _interopRequireDefault(_camera);var _light = __webpack_require__(30);var _light2 = _interopRequireDefault(_light);var _controls = __webpack_require__(28);var _controls2 = _interopRequireDefault(_controls);var _pathdrawer = __webpack_require__(31);var _pathdrawer2 = _interopRequireDefault(_pathdrawer);var _geometry = __webpack_require__(33);var _geometry2 = _interopRequireDefault(_geometry);var _model = __webpack_require__(39);var _model2 = _interopRequireDefault(_model);var _action = __webpack_require__(5);var _action2 = _interopRequireDefault(_action);var _interaction = __webpack_require__(38);var _interaction2 = _interopRequireDefault(_interaction);var _guiwindow = __webpack_require__(37);var _guiwindow2 = _interopRequireDefault(_guiwindow);var _SoundSearch = __webpack_require__(36);var _SoundSearch2 = _interopRequireDefault(_SoundSearch);var _config = __webpack_require__(1);var _config2 = _interopRequireDefault(_config);var _app = __webpack_require__(22);var firebase = _interopRequireWildcard(_app);\n__webpack_require__(23);\n__webpack_require__(24);\nvar _storage = __webpack_require__(25);function _interopRequireDefault(obj) {return obj && obj.__esModule ? obj : { default: obj };}function _interopRequireWildcard(obj) {if (obj && obj.__esModule) {return obj;} else {var newObj = {};if (obj != null) {for (var key in obj) {if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key];}}newObj.default = obj;return newObj;}}function _toConsumableArray(arr) {if (Array.isArray(arr)) {for (var i = 0, arr2 = Array(arr.length); i < arr.length; i++) {arr2[i] = arr[i];}return arr2;} else {return Array.from(arr);}}function _classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError(\"Cannot call a class as a function\");}}\n\n// Local vars for rStats\nvar rS = void 0,bS = void 0,glS = void 0,tS = void 0;\nvar TOLERANCE = 0.000001;\n\n// This class instantiates and ties all of the components together\n// starts the loading process and renders the main loop\nvar Main = function () {\n  function Main(container) {var _this = this;_classCallCheck(this, Main);\n    firebase.initializeApp(_config2.default.firebaseConfig);\n    // this.functions = firebase.functions();\n    this.database = firebase.database();\n    this.storage = firebase.storage();\n    this.dbRef = this.database.ref();\n    this.stoRef = this.storage.ref();\n    this.inviteCode = null;\n    (0, _objloader2.default)(THREE);\n    this.roomCode = null;\n    this.overrideTriangulate();\n    this.audioFiles = [];\n    this.setupAudio();\n    this.mouse = new THREE.Vector3();\n    this.nonScaledMouse = new THREE.Vector3();\n    this.ray = new THREE.Raycaster();\n    this.walkingRay = new THREE.Raycaster();\n\n    this.isMuted = false;\n    this.isPlaying = true;\n    this.isMouseDown = false;\n    this.isAddingTrajectory = false;\n    this.isAddingObject = false;\n    this.isEditingObject = false;\n    this.isUserStudyLoading = false;\n    this.isAllowMouseDrag = false;\n    this.isAddingSound = false;\n    this.trajectoryCache = {};\n\n    this.activeObject = null;\n    this.undoableActionStack = [];\n    this.redoableActionStack = [];\n\n    this.floor;\n    this.counter = 1;\n    this.movementSpeed = 10;\n    this.increment = 0.01;\n    this.direction = 1;\n\n    this.soundObjects = [];\n    this.soundTrajectories = [];\n    this.soundZones = [];\n    this.tempSoundTransfer;\n\n    this.loader;\n    this.moveForward = 0;\n    this.moveBackwards = 0;\n    this.yawLeft = 0;\n    this.yawRight = 0;\n    this.rotationSpeed = 0.05;\n\n    this.perspectiveView = false;\n    this.keyPressed = false;\n    this.tooltipShow = true;\n    this.movedHead = false;\n    this.addObjectLabel = true;\n    this.cameraHasLabel = true;\n\n    this.interactiveCone = null;\n\n    this.cameraDestination = new THREE.Vector3();\n\n    this.ray.params.Line.threshold = 10;\n\n    console.log(\"ray: \", this.ray);\n    // Set container property to container element\n    this.container = container;\n\n    // Start Three clock\n    this.clock = new THREE.Clock();\n\n    // Main scene creation\n    this.scene = new THREE.Scene();\n\n    // Add GridHelper\n    var grid = new THREE.GridHelper(_config2.default.grid.size, _config2.default.grid.divisions);\n    grid.position.y = -300;\n    grid.material.opacity = 0.25;\n    grid.material.transparent = true;\n    this.scene.add(grid);\n\n\n    /**\n                           * The X-Z raycasting plane for determining where on the floor\n                           * the user is clicking.\n                           */\n    var planeGeometry = new THREE.PlaneGeometry(_config2.default.grid.size * 2, _config2.default.grid.size * 2);\n    var planeMaterial = new THREE.MeshBasicMaterial({\n      color: 0xffffff,\n      side: THREE.BackSide,\n      visible: false });\n\n    this.floor = new THREE.Mesh(planeGeometry, planeMaterial);\n    this.floor.rotation.x = Math.PI / 2;\n    this.scene.add(this.floor);\n\n    var shadowFloor = new THREE.Mesh(planeGeometry.clone(), new THREE.MeshLambertMaterial({\n      color: 0xf0f0f0,\n      side: THREE.BackSide,\n      transparent: true,\n      opacity: 0.2 }));\n\n    shadowFloor.rotation.x = Math.PI / 2;\n    shadowFloor.position.y = -300;\n    shadowFloor.receiveShadow = true;\n    this.scene.add(shadowFloor);\n\n\n    // Get Device Pixel Ratio first for retina\n    if (window.devicePixelRatio) {\n      _config2.default.dpr = window.devicePixelRatio;\n    }\n\n    // Main renderer instantiation\n    this.renderer = new _renderer2.default(this.scene, container);\n\n    this.playBtnSrc = document.getElementById(\"play-button\").src;\n    this.pauseBtnSrc = document.getElementById(\"pause-button\").src;\n\n    // Components instantiation\n    this.camera = new _camera2.default(this.renderer.threeRenderer);\n    this.controls = new _controls2.default(this.camera.threeCamera, document);\n    this.loader = new THREE.OBJLoader();\n    this.light = new _light2.default(this.scene);\n\n    // Create and place lights in scene\n    ['ambient', 'directional'].forEach(function (l) {return _this.light.place(l);});\n\n    /**\n                                                                                      * Setting up interface to create object/zone/trajectory instances.\n                                                                                      */\n    this.path = new _pathdrawer2.default(this.scene, this);\n\n    new _interaction2.default(this, this.renderer.threeRenderer, this.scene, this.camera.threeCamera, this.controls.threeControls);\n\n    // Create user head\n    var dummyHead = new _model2.default(this.scene, this.loader);\n    dummyHead.load(false, false);\n    // set up object to represent head for trajectories\n    this.headObject = new _headobject2.default(this);\n\n    this.userHeads = {};\n\n    // AxisHelper for the Head Model\n    this.axisHelper = new THREE.AxesHelper(60);\n    this.axisHelper.rotation.y += Math.PI;\n    var lineMaterial = new THREE.LineDashedMaterial({\n      color: 0x888888,\n      dashSize: 30,\n      gapSize: 30 });\n\n\n    var points = [];\n    points.push(new THREE.Vector3(0, 0, -300));\n    points.push(new THREE.Vector3(0, 0, 300));\n\n    var lineGeometry = new THREE.BufferGeometry().setFromPoints(points);\n\n    // lineGeometry.computeLineDistances();\n    this.altitudeHelper = new THREE.Line(lineGeometry, lineMaterial);\n    this.altitudeHelper.computeLineDistances();\n    this.altitudeHelper.rotation.x = Math.PI / 2;\n    this.scene.add(this.altitudeHelper);\n    this.scene.add(this.axisHelper);\n\n    // ui elements\n    if (navigator.clipboard && window.isSecureContext) {\n      document.getElementById('container').style.display = 'inline-block';\n    }\n\n    document.getElementById('add-object-button').onclick = this.toggleAddObject.bind(this);\n    var self = this;\n\n    this.setupTooltips();\n\n    document.getElementById('play-pause-button').onclick = function () {\n      self.toggleGlobalPlay(this);\n    };\n    document.getElementById('undo').onclick = function () {\n      if (self.roomCode === null) self.undo();\n    };\n    document.getElementById('redo').onclick = function () {\n      if (self.roomCode === null) self.redo();\n    };\n    document.getElementById('collab').onclick = function () {\n      document.getElementById('roomcode').value = \"\";\n      if (self.roomCode != null) {\n        document.getElementById('invite-code').innerHTML = self.roomCode;\n      } else {\n        self.generateInviteCode();\n      }\n      // disable Undo and Redo buttons\n      var undo = document.getElementById('undo');\n      var redo = document.getElementById('redo');\n      undo.style.opacity = '0.5';\n      redo.style.opacity = '0.5';\n      undo.classList.remove('active');\n      redo.classList.remove('active');\n      undo.style.cursor = 'not-allowed';\n      redo.style.cursor = 'not-allowed';\n\n      document.getElementById('room-input').style.display = 'block';\n      document.getElementById('splashscreen').style.display = 'block';\n    };\n    document.getElementById('copy-code').onclick = function () {var _this2 = this;\n      if (self.roomCode && navigator.clipboard) {\n        this.innerHTML = 'Copied!';\n        this.style.color = 'white';\n        this.style.background = '#f44b76';\n        setTimeout(function () {\n          _this2.innerHTML = 'Copy';\n          _this2.style.background = 'white';\n          _this2.style.color = '#555';\n        }, 1000);\n        navigator.clipboard.writeText(self.roomCode);\n      }\n    };\n    document.getElementById('submit-splash').onclick = function () {var _this3 = this;\n      // if you join a room but you're already part of a room,\n      // you'll need to leave that room\n      var roomCode = document.getElementById('roomcode').value;\n\n      var success = function success() {\n        self.dbRef.off();\n        self.destroyFirebaseScene();\n        var oldRoomCode = self.roomCode ? self.roomCode : null;\n        var oldHeadKey = self.headKey ? self.headKey.key : null;\n        self.roomCode = roomCode;\n        if (self.audio.context.state == \"suspended\") {\n          self.audio.context.resume();\n        }\n        document.getElementById('room-input').style.display = 'none';\n        self.dbRef = self.database.ref(roomCode);\n        self.stoRef = self.storage.ref().child(roomCode);\n        self.setupFirebase();\n        self.database.ref(self.inviteCode).remove();\n        if (oldRoomCode && oldHeadKey) {\n          self.database.ref(oldRoomCode).child('users').child(oldHeadKey).remove();\n        }\n        document.getElementById('splashscreen').style.display = 'none';\n      };\n\n      if (roomCode == '') {\n        return alert('no code entered');\n      } else if (self.roomCode && roomCode == self.roomCode) {\n        return alert('You\\'re already in this room!');\n      } else {\n        this.value = 'Disabled';\n        // check if room exists\n        firebase.database().ref(roomCode).once('value', function (snapshot) {\n          if (snapshot.exists()) {\n            success();\n          } else {\n            _this3.value = 'Enabled';\n            return alert('Invalid room code. Please try again');\n          }\n        });\n      }\n    };\n    document.getElementById('exit-code').onclick = function () {\n      document.getElementById('splashscreen').style.display = 'none';\n    };\n    document.getElementById('save').onclick = function () {\n      this.data = self.export().then(function (data) {\n        var a = document.createElement('a');\n        a.href = data;\n        a.download = 'export.zip';\n\n        document.getElementById('save-status').style.display = 'none';\n        document.getElementById('save').style.pointerEvents = 'auto';\n        document.getElementById('save').style.opacity = \"1\";\n\n        a.click();\n      });\n    };\n    document.getElementById('load').onclick = function () {\n      if (self.audio.context.state == \"suspended\") self.audio.context.resume();\n      var i = document.getElementById('import');\n      i.click();\n      i.addEventListener('change', handleFiles, false);\n\n      function handleFiles() {\n        self.import(this.files[0]);\n      }\n    };\n\n    // document.getElementById('copy-button').onclick = function() {\n    //   self.copySelectedItem();\n    // }\n    document.getElementById('search-clear-search-button').onclick = function () {\n      self.toggleSearchBar(this);\n    };\n\n    this.cameraLabel = document.getElementById('camera-label');\n    this.cameraLabel.onclick = this.reset.bind(this);\n\n    this.cameraLabel.innerHTML = this.perspectiveView ? 'Altitude view' : 'Aerial view';\n\n    this.gui = new _guiwindow2.default(this);\n    this.soundSearch = new _SoundSearch2.default(this);\n\n    // Start render which does not wait for model fully loaded\n    this.container.querySelector('#loading').style.display = 'none';\n    this.render();\n\n    zip.workerScriptsPath = './assets/js/';\n\n    this.zipHelper = function () {\n      var zipFileEntry,\n      zipWriter,\n      writer,\n      URL = window.URL || window.webkitURL || window.mozURL;\n\n      return {\n        addFiles: function addFiles(files, oninit, onadd, onprogress, onend) {\n          var addIndex = 0;\n\n          function nextFile() {\n            var file = files[addIndex];\n            onadd(file);\n            zipWriter.add(\n            file.name,\n            new zip.BlobReader(file),\n            function () {\n              addIndex++;\n              if (addIndex < files.length) nextFile();else\n              onend();\n            },\n            onprogress);\n\n          }\n\n          function createZipWriter() {\n            zip.createWriter(\n            writer,\n            function (writer) {\n              zipWriter = writer;\n              oninit();\n              nextFile();\n            },\n            function (error) {\n              console.log(error);\n              document.getElementById('save-status').style.display = 'none';\n              document.getElementById('save').style.pointerEvents = 'auto';\n              document.getElementById('save').style.opacity = \"1\";\n            });\n\n          }\n\n          if (zipWriter) nextFile();\n          writer = new zip.BlobWriter();\n          createZipWriter();\n        },\n\n        getEntries: function getEntries(file, onend) {\n          zip.createReader(new zip.BlobReader(file), function (zipReader) {\n            zipReader.getEntries(onend);\n          }, function (error) {\n            console.log(error);\n            document.getElementById('load-status').style.display = 'none';\n            document.getElementById('load').style.pointerEvents = 'auto';\n            document.getElementById('load').style.opacity = \"1\";\n          });\n        },\n\n        getEntryFile: function getEntryFile(entry, onend, onprogress) {\n          var writer, zipFileEntry;\n\n          function getData() {\n            entry.getData(writer, function (blob) {\n              onend(entry.filename, blob);\n            }, onprogress);\n          }\n\n          writer = new zip.BlobWriter();\n          getData();\n        },\n\n        getBlobURL: function getBlobURL(callback) {\n          zipWriter.close(function (blob) {\n            var blobURL = URL.createObjectURL(blob);\n            callback(blobURL);\n            zipWriter = null;\n          });\n        },\n\n        getBlob: function getBlob(callback) {\n          zipWriter.close(callback);\n        } };\n\n    }();\n\n    _config2.default.isLoaded = true;\n  }_createClass(Main, [{ key: 'setupTooltips', value: function setupTooltips()\n\n    {\n      var self = this;\n      var gui = document.getElementById('guis');\n      document.getElementById('tooltip-label').onclick = function () {\n        self.toggleTooltip();\n      };\n      document.getElementById('add-object-button').onmouseenter = function () {\n        if (gui.style.opacity == 0) {\n          self.addObjectLabel = false;\n          self.showTooltip('help-add');\n        }\n      };\n      document.getElementById('add-object-button').onmouseleave = function () {\n        if (gui.style.opacity == 0) {\n          self.hideTooltip('help-add');\n        }\n      };\n      document.getElementById('camera-label').onmouseenter = function () {\n        self.cameraHasLabel = false;\n        self.showTooltip('help-camera');\n      };\n      document.getElementById('camera-label').onmouseleave = function () {\n        self.hideTooltip('help-camera');\n      };\n    } }, { key: 'render', value: function render()\n\n    {\n      // Call render function and pass in created scene and camera\n      this.renderer.render(this.scene, this.camera.threeCamera);\n\n      /* Camera tweening object update */\n      _tween2.default.update();\n\n      /* Updating camera controls. */\n      this.controls.threeControls.update();\n\n      /**\n                                             * Hands over the positioning of the listener node from the head model\n                                             * to the camera in object edit view\n                                             **/\n      if (this.isEditingObject) this.setListenerPosition(this.camera.threeCamera);\n\n      /**\n                                                                                    * Differentiating between perspective and bird's-eye views. If the camera is tilted\n                                                                                    * enough the perspective view is activated, restring user's placement of object in the\n                                                                                    * X-Z plane\n                                                                                    */\n      if (this.controls.threeControls.getPolarAngle() > 0.4) {\n        if (!this.perspectiveView) {\n          document.getElementById('help-camera').style.display = 'none';\n          this.perspectiveView = true;\n          this.cameraLabel.innerHTML = 'Altitude view';\n        }\n      } else if (this.perspectiveView) {\n        this.perspectiveView = false;\n        this.cameraLabel.innerHTML = 'Aerial view';\n      }\n\n      /* Checking if the user has walked into a sound zone in each frame. */\n      this.checkZones();\n\n      /* Updating the head model's position and orientation in each frame. */\n      this.updateDummyHead(this.headKey);\n\n      /**\n                                           * Stops an object trajectory motion if the used clicks onto a moving object\n                                           */\n      for (var i in this.soundObjects) {\n        if (!this.isMouseDown || this.soundObjects[i] !== this.activeObject) {\n          if (this.soundObjects[i].type === 'SoundObject') {\n            this.soundObjects[i].followTrajectory(this.isPlaying);\n          }\n        }\n      }\n\n      /* Making the GUI visible if an object is selected */\n      this.gui.display(this.activeObject);\n\n      this.animate(this);\n    } }, { key: 'animate', value: function animate(\n\n    classToBind) {var _this4 = this;var fps = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 60;\n      setTimeout(function () {\n        requestAnimationFrame(_this4.render.bind(classToBind));\n      }, 1000 / fps); // 60fps\n    } }, { key: 'setupFirebase', value: function setupFirebase()\n\n    {var _this5 = this;\n      this.headKey = this.dbRef.child('users').push();\n      this.headKey.set({\n        position: this.headObject.containerObject.position });\n\n      var self = this;\n      function createZone(child) {\n        var points = child.val().zone.map(function (posi) {\n          return new THREE.Vector3(posi.x, posi.y, posi.z);\n        });\n        var createdZone = new _soundzone2.default(self, points, child.key);\n        if (child.val().hasOwnProperty('sound')) {\n          self.stoRef.child('zones/' + child.key + '/' + child.val().sound).getDownloadURL().then(function (url) {\n            var request = new XMLHttpRequest();\n            request.responseType = 'blob';\n            request.onload = function (event) {\n              var soundFile = request.response;\n              soundFile.lastModifiedDate = new Date();\n              soundFile.name = child.val().sound;\n              // copy soundzone sound\n              createdZone.copySound(soundFile, child.val().volume, child.val().isPlaying, true);\n              // add soundfile name in html\n            };\n            request.open(\"GET\", url);\n            request.send();\n          });\n        }\n        createdZone.addToScene(self.scene, child.val().position);\n        // update zone\n        self.soundZones.push(createdZone);\n        return createdZone;\n      }\n\n      this.dbRef.child('users').child(this.headKey.key).onDisconnect().remove();\n      /*this.dbRef.onDisconnect().set(\n                                                                                   destroyFirebaseScene(),\n                                                                                   /*this.soundObjects.forEach((soundObject) => {\n                                                                                     soundObject.removeFromScene(this.scene);\n                                                                                   }),\n                                                                                   this.soundZones.forEach((soundZone) => {\n                                                                                     soundZone.removeFromScene(this.scene);\n                                                                                   }),\n                                                                                   this.soundObjects = [],\n                                                                                   this.soundZones = [],\n                                                                                   deleteObject(this.stoRef).then(() => {\n                                                                                     // File deleted successfully\n                                                                                   }).catch((error) => {\n                                                                                     // Uh-oh, an error occurred!\n                                                                                   }),\n                                                                                   )*/\n\n      this.gui.updateFirebaseDetails(this.dbRef, this.stoRef, this.headKey.key, this.roomCode);\n\n      function createHeadTrajectory(parent, fbChild) {\n        self.path.points = fbChild.val().trajectory.map(function (pos) {\n          return new THREE.Vector3(pos.x, pos.y, pos.z);\n        });\n        self.path.parentObject = parent;\n        self.path.createObject(self, true, true, false);\n        parent.trajectory.ownerHeadKey = fbChild.key;\n        parent.calculateMovementSpeed();\n      }\n\n      this.dbRef.child('globals').on('child_changed', function (child) {\n        if (child.val().lastEdit != _this5.headKey.key) {\n          if (!_this5.isPlaying) {\n            _this5.isPlaying = true;\n            var element = document.getElementById('play-pause-button');\n            element.innerHTML = 'Pause';\n            element.title = 'Pause';\n            _this5.audio.context.resume();\n          } else {\n            _this5.isPlaying = false;\n            var _element = document.getElementById('play-pause-button');\n            _element.innerHTML = 'Play';\n            _element.title = 'Play';\n            _this5.audio.context.suspend();\n          }\n          [].concat(_this5.soundObjects, _this5.soundZones).forEach(function (obj) {return obj.toggleAppearance(_this5);});\n        }\n      });\n\n      this.dbRef.child('users').on('child_added', function (child) {\n        if (child.key != _this5.headKey.key) {\n          var otherHead = new _model2.default(_this5.scene, _this5.loader);\n          var otherHeadObj = new _headobject2.default(_this5);\n          var name = 'user' + (Object.keys(_this5.userHeads).length + 1).toString();\n          if (child.val().trajectory) {\n            createHeadTrajectory(otherHeadObj, child);\n          }\n          otherHead.load(true, name, child.val().position, child.key, _this5.dbRef);\n          _this5.userHeads[child.key] = {\n            head: name,\n            otherHeadObject: otherHeadObj };\n\n        }\n      });\n\n      this.dbRef.child('users').on('child_changed', function (child) {\n        var pos = child.val().position;\n        if (Object.keys(_this5.userHeads).length > 0 && child.key != _this5.headKey.key) {\n          var newPos = new THREE.Vector3(pos.x, pos.y, pos.z);\n          // wait until object is loaded into the scene before searching\n          if (_this5.scene.getObjectByName(_this5.userHeads[child.key].head, true) == undefined) {\n            return;\n          }\n\n          var head = _this5.userHeads[child.key].otherHeadObject;\n          if (head.trajectory === null && child.val().trajectory) {\n            createHeadTrajectory(head, child);\n          }\n          if (head.trajectory == null && child.val().trajectory == null) {\n            _this5.scene.getObjectByName(_this5.userHeads[child.key].head, true).position.copy(newPos);\n          }\n          if (head.trajectory != null && head.trajectory != child.val().trajectory) {\n            if (child.val().trajectory != null) {\n              head.trajectory.splinePoints = child.val().trajectory.map(function (posi) {\n                return new THREE.Vector3(posi.x, posi.y, posi.z);\n              });\n              head.trajectory.updateTrajectory(true);\n              head.calculateMovementSpeed();\n            } else {\n              _this5.removeSoundTrajectory(head.trajectory);\n              head.trajectory = null;\n              _this5.scene.getObjectByName(_this5.userHeads[child.key].head, true).position.copy(newPos);\n            }\n          }\n          if (head.trajectory != null && child.val().speed) {\n            var speed = child.val().speed;\n            head.movementSpeed = Math.min(Math.max(-100, speed), 100);\n            head.calculateMovementSpeed();\n          }\n          if (head.rotation.y != child.val().rotation) {\n            var other = _this5.scene.getObjectByName(_this5.userHeads[child.key].head, true);\n            head.rotation.y = child.val().rotation;\n            other.rotation.y = head.rotation.y;\n          }\n        }\n      });\n\n      this.dbRef.child('users').on('child_removed', function (child) {\n        if (_this5.userHeads.hasOwnProperty(child.key)) {\n          _this5.scene.remove(_this5.scene.getObjectByName(_this5.userHeads[child.key].head, true));\n          // remove head trajectory\n          if (child.val().trajectory) {\n            _this5.removeSoundTrajectory(_this5.userHeads[child.key].otherHeadObject.trajectory);\n          }\n          delete _this5.userHeads[child.key];\n        }\n\n      });\n\n      this.dbRef.child('objects').on('child_added', function (child) {\n        if (child.val().lastEdit != _this5.headKey.key) {\n          var createdObj = null;\n          // add trajectory upon initial load\n          if (child.val().type == \"SoundObject\") {\n            createdObj = new _soundobject2.default(_this5, child.key);\n            if (child.val().sound) {\n              _this5.stoRef.child('soundObjects/' + child.key + '/' + child.val().sound).getDownloadURL().then(function (url) {\n                var request = new XMLHttpRequest();\n                request.responseType = 'blob';\n                request.onload = function (event) {\n                  var soundFile = request.response;\n                  soundFile.lastModifiedDate = new Date();\n                  soundFile.name = child.val().sound;\n                  createdObj.copyOmnisphereSound(soundFile, child.val().volume, true, child.val().isPlaying);\n                  // add soundfile name in html\n                };\n                request.open(\"GET\", url);\n                request.send();\n              });\n            }\n            createdObj.addToScene(_this5.scene, child.val().position);\n            _this5.soundObjects.push(createdObj);\n            if (child.val().trajectory) {\n              _this5.path.points = child.val().trajectory.map(function (posi) {\n                return new THREE.Vector3(posi.x, posi.y, posi.z);\n              });\n              _this5.path.parentObject = createdObj;\n              _this5.path.createObject(_this5, true, true, false);\n              createdObj.calculateMovementSpeed();\n            }\n          }\n        }\n        // putting these in here makes it so that the original object that created these won't get these made\n        _this5.dbRef.child('objects').child(child.key).child('cones').on('child_added', function (childC) {\n          // can only run after an object has been added\n          var self = _this5;\n          if (childC.val().lastEdit != _this5.headKey.key && childC.val().hasOwnProperty('sound')) {\n            var obj = _this5.soundObjects.find(function (object) {return (\n                object.containerObject.name == child.key);} //childC.val().parent\n            );\n            _this5.stoRef.child('soundObjects/' + child.key + '/' + childC.val().uuid + '/' + childC.val().sound).getDownloadURL().then(function (url) {\n              var request = new XMLHttpRequest();\n              request.responseType = 'blob';\n              request.onload = function (event) {\n                var soundFile = request.response;\n                soundFile.lastModifiedDate = new Date();\n                soundFile.name = childC.val().sound;\n                obj.copyConeSound(soundFile, childC.val().volume, childC.val().latitude,\n                childC.val().longitude, childC.val().spread, childC.val().uuid,\n                childC.val().isPlaying);\n              };\n              request.open(\"GET\", url);\n              request.send();\n            });\n          }\n        });\n\n        _this5.dbRef.child('objects').child(child.key).child('cones').on('child_changed', function (childC) {\n          var obj = _this5.soundObjects.find(function (object) {return (\n              object.containerObject.name == childC.val().parent);});\n\n          var index = obj.cones.findIndex(function (cone) {return (\n              cone.uuid == childC.val().uuid);});\n\n          var hasSoundUpdateSound = index != -1 && childC.val().hasOwnProperty('sound') &&\n          obj.cones[index].sound && obj.cones[index].filename != childC.val().sound;\n          if (childC.val().lastEdit != _this5.headKey.key && hasSoundUpdateSound) {\n            // sound exists but sound was changed\n            _this5.stoRef.child('soundObjects/' + childC.val().parent + '/' + childC.val().uuid + '/' + childC.val().sound).getDownloadURL().then(function (url) {\n              var request = new XMLHttpRequest();\n              request.responseType = 'blob';\n              request.onload = function (event) {\n                var soundFile = request.response;\n                soundFile.lastModifiedDate = new Date();\n                soundFile.name = childC.val().sound;\n                obj.copyConeSound(soundFile, childC.val().volume, childC.val().latitude,\n                childC.val().longitude, childC.val().spread, childC.val().uuid, childC.val().isPlaying, true);\n\n                var soundPicker = document.getElementById('guis').getElementsByClassName('cone')[index];\n                soundPicker.querySelector('.fcone').innerHTML = childC.val().sound;\n                soundPicker.querySelector('.fcone').defaultValue = childC.val().sound;\n              };\n              request.open(\"GET\", url);\n              request.send();\n            });\n          } else if (index != -1 && childC.val().lastEdit != _this5.headKey.key && obj.cones[index].sound && obj.cones[index].sound.state &&\n          childC.val().isPlaying == obj.cones[index].sound.state.isAudioPaused) {\n            // other child is paused\n            if (!childC.val().isPlaying) {\n              obj.stopConeSound(obj.cones[index]);\n              obj.cones[index].userSetPlay = false;\n            } else {\n              obj.playConeSound(obj.cones[index]);\n              obj.cones[index].userSetPlay = true;\n            }\n          }\n          var volume = childC.val().volume;\n          var spread = childC.val().spread;\n          var latitude = childC.val().latitude;\n          var longitude = childC.val().longitude;\n          if (index == -1) {\n            obj.objConeCache[childC.val().uuid] = {\n              volume: volume,\n              spread: spread,\n              latitude: latitude,\n              longitude: longitude };\n\n          }\n\n          // update sound properties: vol, sprd, long, lat\n          if (index != -1 && obj.cones[index].sound != null && childC.val().lastEdit != _this5.headKey.key) {\n            if (volume !== obj.cones[index].sound.volume.gain.value) {\n              obj.cones[index].sound.volume.gain.value = volume;\n              obj.changeLength(obj.cones[index]);\n            }\n            if (spread !== obj.cones[index].sound.spread) {\n              obj.cones[index].sound.spread = spread;\n              obj.changeWidth(obj.cones[index]);\n            }\n            obj.pointConeMagic(obj.cones[index], latitude, longitude);\n          }\n\n        });\n\n        _this5.dbRef.child('objects').child(child.key).child('cones').on('child_removed', function (childC) {\n          if (_this5.soundObjects.length > 0 && childC.val().lastEdit != _this5.headKey.key) {\n            var obj = _this5.soundObjects.find(function (object) {return (\n                object.containerObject.name == childC.val().parent);});\n\n            var index = obj.cones.findIndex(function (cone) {return (\n                cone.uuid == childC.val().uuid);});\n\n            obj.removeCone(obj.cones[index]);\n            _this5.activeObject = obj;\n            if (_this5.interactiveCone == null) {\n              var addButton = document.getElementById(\"add-cone\");\n              addButton.style.position = 'relative';\n              addButton.style.removeProperty('top');\n              // addButton.style.removeProperty('left');\n              addButton.firstChild.style.removeProperty('padding');\n              addButton.classList.remove('add-cone-object-view');\n            }\n          }\n\n        });\n      });\n\n      this.dbRef.child('zones').on('child_added', function (child) {\n        // at this point, it only has last edit in key\n        if (child.val().lastEdit != _this5.headKey.key && child.val().type == \"SoundZone\") {\n          if (child.val().type == \"SoundZone\") {\n            var zone = createZone(child);\n            if (_this5.activeObject != zone) {\n              zone.setInactive(_this5);\n            }\n          }\n        }\n      });\n\n      this.dbRef.child('objects').on('child_changed', function (child) {\n        if (\"position\" in child.val() && child.val().lastEdit != _this5.headKey.key) {\n          var pos = child.val().position;\n          var obj = _this5.soundObjects.find(function (object) {return (\n              object.containerObject.name == child.key);});\n\n          // don't move object for user while in edit mode\n          if (obj != null && obj != undefined) {\n            var nonTrajectoryPositionUpdate = false;\n            if (obj.trajectory === null && child.val().trajectory) {\n              var points = child.val().trajectory.map(function (posi) {\n                return new THREE.Vector3(posi.x, posi.y, posi.z);\n              });\n              if (!_this5.isEditingObject || _this5.isEditingObject && _this5.activeObject != obj) {\n                _this5.path.points = points;\n                _this5.path.parentObject = obj;\n                _this5.path.createObject(_this5, true, true, false);\n                obj.calculateMovementSpeed();\n              } else {\n                _this5.trajectoryCache[obj.containerObject.uuid] = points;\n                _this5.trajectoryCache['new'] = true;\n              }\n              nonTrajectoryPositionUpdate = true;\n            }\n\n            if (obj.trajectory == null && child.val().trajectory == null) {\n              if (!_this5.isEditingObject) {\n                obj.setPosition(new THREE.Vector3(pos.x, pos.y, pos.z));\n              } else {\n                _this5.trajectoryCache[obj.containerObject.uuid] = new THREE.Vector3(pos.x, pos.y, pos.z);\n              }\n              nonTrajectoryPositionUpdate = true;\n            }\n\n            var trajectoryEqual = true;\n            if (obj.trajectory) {\n              var length = obj.trajectory.points.length;\n              if (!child.val().hasOwnProperty('trajectory') || length !== child.val().trajectory.length) {\n                trajectoryEqual = false;\n              } else {\n                for (var i = 0; i < length; ++i) {\n                  if (obj.trajectory.points[i].x !== child.val().trajectory[i].x ||\n                  obj.trajectory.points[i].y !== child.val().trajectory[i].y ||\n                  obj.trajectory.points[i].z !== child.val().trajectory[i].z) {\n                    trajectoryEqual = false;\n                    break;\n                  }\n                }\n              }\n            }\n\n            if (obj.trajectory != null && !trajectoryEqual) {\n              if (child.val().trajectory != null) {\n                var trajectory = child.val().trajectory.map(function (posi) {\n                  return new THREE.Vector3(posi.x, posi.y, posi.z);\n                });\n\n                // pull updates and store aside until user is done editing object\n                if (!_this5.isEditingObject) {\n                  obj.trajectory.splinePoints = trajectory;\n                  obj.trajectory.points = trajectory;\n                  obj.trajectory.updateTrajectory(true);\n                  obj.calculateMovementSpeed();\n                } else {\n                  _this5.trajectoryCache[obj.containerObject.uuid] = trajectory;\n                  _this5.trajectoryCache['path'] = true;\n                }\n                // obj.trajectory.setCopyPosition(posVec);\n              } else {\n                var previousActiveObject = _this5.activeObject;\n                _this5.removeSoundTrajectory(obj.trajectory);\n                obj.trajectory = null;\n                _this5.activeObject = previousActiveObject;\n                // don't set the new position until out of edit object\n                if (!_this5.isEditingObject || _this5.isEditingObject && _this5.activeObject != obj) {\n                  obj.setPosition(new THREE.Vector3(pos.x, pos.y, pos.z));\n                } else {\n                  _this5.trajectoryCache[obj.containerObject.uuid] = new THREE.Vector3(pos.x, pos.y, pos.z);\n                }\n              }\n              nonTrajectoryPositionUpdate = true;\n            }\n\n            if (obj.trajectory != null && child.val().speed != null && child.val().speed != obj.movementSpeed) {\n              var speed = child.val().speed;\n              obj.movementSpeed = Math.min(Math.max(-100, speed), 100);\n              obj.calculateMovementSpeed();\n              nonTrajectoryPositionUpdate = true;\n            }\n\n            // update sound file if available\n            if (obj.filename != null && (!child.val().hasOwnProperty('sound') || child.val().sound == '') && obj.omniSphere.sound) {\n              nonTrajectoryPositionUpdate = true;\n              obj.disconnectSound();\n              var soundPicker = document.getElementById('guis').querySelector('#omnisphere-sound-loader');\n              soundPicker.querySelector('.valueSpan').innerHTML = 'None';\n              soundPicker.querySelector('.remove-file').style.display = 'none';\n            }\n\n            if (child.val().hasOwnProperty('sound') && child.val().sound != '' && obj.filename != child.val().sound && !obj.isAddingSound) {\n              nonTrajectoryPositionUpdate = true;\n              obj.isAddingSound = true;\n              _this5.stoRef.child('soundObjects/' + child.key + '/' + child.val().sound).getDownloadURL().then(function (url) {\n                var request = new XMLHttpRequest();\n                request.responseType = 'blob';\n                request.onload = function (event) {\n                  var soundFile = request.response;\n                  // Convert blob to File\n                  soundFile.lastModifiedDate = new Date();\n                  soundFile.name = child.val().sound;\n                  obj.copyOmnisphereSound(soundFile, child.val().volume, true, child.val().isPlaying);\n                  // replace soundFile name\n                  var soundPicker = document.getElementById('guis').querySelector('#omnisphere-sound-loader');\n                  if (soundPicker) {\n                    soundPicker.querySelector('.valueSpan').innerHTML = child.val().sound;\n                    soundPicker.querySelector('.valueSpan').defaultValue = child.val().sound;\n                    soundPicker.querySelector('.remove-file').style.display = 'inline-block';\n                  }\n                };\n                request.open(\"GET\", url);\n                request.send();\n              });\n            } else if (obj.omniSphere.sound && obj.omniSphere.sound.state && child.val().isPlaying == obj.omniSphere.sound.state.isAudioPaused) {\n              nonTrajectoryPositionUpdate = true;\n              if (!child.val().isPlaying) {\n                obj.stopSound();\n                obj.userSetPlay = false;\n              } else\n              {\n                // if isPlaying is false, it could either mean that a global pause is in place\n                // or it could also mean a global pause has been used before, just no sound\n                obj.playSound();\n                obj.userSetPlay = true;\n              }\n            }\n\n            if (obj.omniSphere.sound != null) {\n              obj.omniSphere.sound.volume.gain.value = child.val().volume;\n              obj.changeRadius();\n            }\n\n            if (!nonTrajectoryPositionUpdate && obj.trajectory != null && child.val().trajectoryPosition) {\n              obj.trajectoryClock = child.val().trajectoryPosition;\n            }\n          }\n        }\n      });\n\n      this.dbRef.child('zones').on('child_changed', function (child) {\n        var zone = _this5.soundZones.find(function (zone) {return (\n            zone.containerObject.name == child.key);});\n\n        // update position, sound, volume, rotation, scale\n        var zoneUp = false,rotUp = false,scaleUp = false;\n        var pos = child.val().position;\n        if (child.val().lastEdit != _this5.headKey.key && child.val().type == \"SoundZone\") {\n          var zonePos = zone.containerObject.position;\n          // update zonePosition\n          if (zonePos.x != pos.x || zonePos.y != pos.y || zonePos.z != pos.z) {\n            zone.containerObject.position.copy(new THREE.Vector3(pos.x, pos.y, pos.z));\n          }\n          // update rotation\n          if (zone.containerObject.rotation.y != child.val().rotation) {\n            zone.containerObject.rotation.y = child.val().rotation;\n            rotUp = true;\n          }\n          // update scale\n          if (zone.zoneScale != child.val().scale) {\n            zone.zoneScale = child.val().scale;\n            zone.updateZoneScale(child.val().prev, true);\n            scaleUp = true;\n          }\n          // update sound\n          if (zone.filename != null && (!child.val().hasOwnProperty('sound') || child.val().sound == '') && zone.sound) {\n            zone.clear();\n            var materialColor = _this5.isPlaying ? 0xFF1169 : 0x8F8F8F;\n            zone.shape.material.color.setHex(materialColor);\n            zone.filename = null;\n          }\n          if (child.val().hasOwnProperty('sound') && child.val().sound != '' && child.val().lastEdit != _this5.headKey.key &&\n          zone.filename != child.val().sound && !zone.isAddingSound) {\n            zone.isAddingSound = true;\n            _this5.stoRef.child('zones/' + child.key + '/' + child.val().sound).getDownloadURL().then(function (url) {\n              var request = new XMLHttpRequest();\n              request.responseType = 'blob';\n              request.onload = function (event) {\n                var soundFile = request.response;\n                // Convert blob to File\n                soundFile.lastModifiedDate = new Date();\n                soundFile.name = child.val().sound;\n                zone.copySound(soundFile, child.val().volume, child.val().isPlaying, true);\n                // replace soundFile name\n                var soundPicker = document.getElementById('guis').querySelector('#zone-sound');\n                if (soundPicker) {\n                  soundPicker.querySelector('.valueSpan').innerHTML = child.val().sound;\n                  soundPicker.querySelector('.valueSpan').defaultValue = child.val().sound;\n                  soundPicker.querySelector('.remove-file').style.display = 'inline-block';\n                }\n              };\n              request.open(\"GET\", url);\n              request.send();\n            });\n          } else if (child.val().lastEdit != _this5.headKey.key && zone.sound && zone.sound.state &&\n          child.val().isPlaying == zone.sound.state.isAudioPaused) {\n            if (!child.val().isPlaying) {\n              zone.stopSound();\n              zone.userSetPlay = false;\n            } else {\n              zone.playSound();\n              zone.userSetPlay = true;\n            }\n          }\n\n          // update volume\n          if (zone.sound != null && zone.sound.volume.gain.value != child.val().volume) {\n            zone.sound.source.volume.gain.value = child.val().volume;\n            zone.volume = child.val().volume;\n          }\n\n          // update zone points whenever movement occurs       \n          var zoneEqual = true;\n          if (zone.splinePoints.length !== child.val().zone.length) {\n            zoneEqual = false;\n          } else {\n            for (var i = 0; i < zone.splinePoints.length; ++i) {\n              if (zone.splinePoints[i].x !== child.val().zone[i].x ||\n              zone.splinePoints[i].y !== child.val().zone[i].y ||\n              zone.splinePoints[i].z !== child.val().zone[i].z) {\n                zoneEqual = false;\n                break;\n              }\n            }\n          }\n\n          if (!zoneEqual && !scaleUp && !rotUp) {\n            var previousSplinePoints = Array.from(zone.splinePoints);\n            zone.splinePoints = child.val().zone.map(function (posi) {\n              return new THREE.Vector3(posi.x, posi.y, posi.z);\n            });\n\n            var updateType = null;\n            var index = -1;\n            var findPoint = function findPoint(point, splinePointArray) {\n              return splinePointArray.find(function (p) {\n                return Math.abs(p.x - point.x) <= TOLERANCE && Math.abs(p.y - point.y) <= TOLERANCE &&\n                Math.abs(p.z - point.z) <= TOLERANCE;\n              });\n            };\n\n            var findIndex = function findIndex(p, splinePointArray) {\n              for (var _i = 0; _i < splinePointArray.length; ++_i) {\n                var currentPoint = splinePointArray[_i];\n                if (Math.abs(p.x - currentPoint.x) <= TOLERANCE && Math.abs(p.y - currentPoint.y) <= TOLERANCE &&\n                Math.abs(p.z - currentPoint.z) <= TOLERANCE) {\n                  return _i;\n                }\n              }\n              return -1;\n            };\n\n            if (previousSplinePoints.length < zone.splinePoints.length) {\n              updateType = 'add';\n              var difference = zone.splinePoints.filter(function (point) {return !findPoint(point, previousSplinePoints);});\n              index = findIndex(difference[0], zone.splinePoints);\n            } else if (previousSplinePoints.length > zone.splinePoints.length) {\n              updateType = 'delete';\n              var _difference = previousSplinePoints.filter(function (point) {return !findPoint(point, zone.splinePoints);});\n              index = findIndex(_difference[0], previousSplinePoints);\n            }\n\n            zone.updateZone({ updateType: updateType, index: index }, true);\n            zone.updatePointObjects();\n          }\n\n          if (rotUp || scaleUp) {\n            zone.updatePointObjects();\n            zone.updateZone(null, true);\n          }\n        }\n      });\n\n      this.dbRef.child('objects').on('child_removed', function (child) {\n        if (\"position\" in child.val()) {\n          var pos = child.val().position;\n          var obj = _this5.soundObjects.find(function (object) {return (\n              object.containerObject.name == child.key);});\n\n          if (obj != undefined) {\n            // remove trajectory if object has trajectory\n            if (obj.trajectory) {\n              _this5.removeSoundTrajectory(obj.trajectory);\n              obj.trajectory = null;\n              obj.setPosition(new THREE.Vector3(pos.x, pos.y, pos.z));\n            }\n            _this5.removeSoundObject(obj);\n            // close gui if in edit mode\n            if (_this5.isEditingObject && _this5.activeObject == obj) {\n              _this5.exitEditObjectView();\n            }\n            _this5.activeObject = null;\n          }\n        }\n      });\n\n      this.dbRef.child('zones').on('child_removed', function (child) {\n        var zone = _this5.soundZones.find(function (zone) {return zone.containerObject.name == child.key;});\n        if (zone != undefined) {\n          // delete audioFile\n          _this5.removeSoundZone(zone);\n          _this5.activeObject = null;\n        }\n      });\n    } }, { key: 'populateFirebaseScene', value: function populateFirebaseScene()\n\n    {var _this6 = this;\n      // push all soundObjects, trajectories, zones, sounds\n      // update firebase details for all items\n      this.soundObjects.forEach(function (soundObject) {\n        soundObject.updateFirebaseDetails(_this6.dbRef, _this6.stoRef, _this6.headKey, _this6.roomCode);\n      });\n      this.soundZones.forEach(function (soundZone) {\n        soundZone.updateFirebaseDetails(_this6.dbRef, _this6.stoRef, _this6.headKey, _this6.roomCode);\n      });\n      // upload head trajectory\n      if (this.headObject.trajectory) {\n        this.headObject.trajectory.updateFirebaseDetails(this.dbRef, this.stoRef, this.headKey, this.roomCode);\n      }\n    } }, { key: 'destroyFirebaseScene', value: function destroyFirebaseScene()\n\n\n    {var _this7 = this;\n      // destroy old firebase session and remove all soundobjects and cones\n      this.soundObjects.forEach(function (soundObject) {\n        soundObject.removeFromScene(_this7.scene);\n      });\n      this.soundZones.forEach(function (soundZone) {\n        soundZone.removeFromScene(_this7.scene);\n      });\n      this.soundObjects = [];\n      this.soundZones = [];\n      // remove other users heads\n      var keys = Object.entries(this.userHeads).map(function (o) {return o[0];});\n\n      keys.forEach(function (key) {\n        _this7.scene.remove(_this7.scene.getObjectByName(_this7.userHeads[key].head, true));\n        delete _this7.userHeads[key];\n      });\n      // reset our head position and rotation\n      this.headObject.setPosition(new THREE.Vector3(0, 0, 0));\n      // this.headObject.setRotation(new THREE.Vector3(0, 0, 0));\n    } }, { key: 'generateInviteCode', value: function generateInviteCode()\n\n    {var _this8 = this;\n      if (this.inviteCode === null) {\n        this.inviteCode = Math.random().toString(36).substr(2, 7).toUpperCase();\n        if (this.audio.context.state === \"suspended\") {\n          this.audio.context.resume();\n        }\n      }\n      var self = this;\n      // TODO: if there are 10 rooms already, prevent creation of invite code and\n      // give message saying too many rooms, check each time\n      firebase.database().ref(self.inviteCode).once('value', function (snapshot) {\n        if (!snapshot.exists()) {\n          document.getElementById('invite-code').innerHTML = self.inviteCode;\n          self.roomCode = self.inviteCode;\n          self.dbRef = self.database.ref(self.roomCode);\n          _this8.stoRef = self.storage.ref().child(self.roomCode);\n          _this8.dbRef.child('globals').child('sound').set({\n            globalIsPlaying: _this8.isPlaying });\n\n          self.setupFirebase();\n          self.populateFirebaseScene();\n        }\n      });\n    } }, { key: 'setupAudio', value: function setupAudio()\n\n    {\n      var a = {};\n      window.AudioContext = window.AudioContext || window.webkitAudioContext;\n\n      a.context = new AudioContext();\n      a.context.listener.setOrientation(0, 0, -1, 0, 1, 0);\n      a.context.listener.setPosition(0, 0, 0);\n      a.destination = a.context.createGain();\n      a.destination.connect(a.context.destination);\n\n      this.audio = a;\n      this.audio.context.suspend();\n    } }, { key: 'setListenerPosition', value: function setListenerPosition(\n\n    object) {\n      var q = new THREE.Vector3();\n      object.updateMatrixWorld();\n      q.setFromMatrixPosition(object.matrixWorld);\n      this.audio.context.listener.setPosition(q.x, q.y, q.z);\n\n      var m = object.matrix;\n      var mx = m.elements[12];\n      var my = m.elements[13];\n      var mz = m.elements[14];\n      m.elements[12] = m.elements[13] = m.elements[14] = 0;\n\n      var vec = new THREE.Vector3(0, 0, -1);\n      vec.applyMatrix4(m);\n      vec.normalize();\n\n      var up = new THREE.Vector3(0, -1, 0);\n      up.applyMatrix4(m);\n      up.normalize();\n\n      this.audio.context.listener.setOrientation(vec.x, vec.y, vec.z, up.x, up.y, up.z);\n\n      m.elements[12] = mx;\n      m.elements[13] = my;\n      m.elements[14] = mz;\n    }\n\n    /**\n       * Checks if the user has walked into a sound zone by raycasting from the\n       * head model's position onto each sound zone into scene and checking if there\n       * is a hit. The headmodel is first normalized to the horizontal plane since,\n       * with the introduction of head trajectories, the head model can move beneath\n       * this plane which causes the downwards raycas to miss the zone.\n       */ }, { key: 'checkZones', value: function checkZones()\n    {\n      if (this.soundZones.length > 0) {\n        var walkingRayVector = new THREE.Vector3(0, -1, 0);\n        var normalizedHeadVector = new THREE.Vector3(this.head.position.x, 1, this.head.position.z);\n        this.walkingRay.set(normalizedHeadVector, walkingRayVector);\n\n        for (var i in this.soundZones) {\n          var intersects = this.walkingRay.intersectObject(this.soundZones[i].shape);\n          if (intersects.length > 0) {\n            /**\n                                       * Flagging a zone \"under user\" to activate the audio file associated\n                                       * with the sound zone.\n                                       */\n            this.soundZones[i].underUser(this.audio);\n          } else {\n            var isRender = true;\n            this.soundZones[i].notUnderUser(this.audio, isRender);\n          }\n        }\n      }\n    } }, { key: 'tweenToObjectView', value: function tweenToObjectView()\n\n    {var _this9 = this;\n      if (this.isEditingObject) {\n        var vec = new THREE.Vector3().subVectors(this.camera.threeCamera.position, this.activeObject.containerObject.position);\n        vec.y = this.activeObject.containerObject.position.y;\n        this.cameraDestination = this.activeObject.containerObject.position.clone().addScaledVector(vec.normalize(), 500);\n\n        new _tween2.default.Tween(this.camera.threeCamera.position).\n        to(this.cameraDestination, 800).\n        start();\n\n        new _tween2.default.Tween(this.controls.threeControls.center).\n        to(this.activeObject.containerObject.position, 800).\n        start();\n\n        /**\n                  * Edit Object View only applies to sound objects. A Sound Object in the scene\n                  * is represented with 4 elements: Raycast Sphere Mesh, AxisHelper,\n                  * AltitudeHelper Line, and the containerObject which holds the omniSphere\n                  * and the cones. To make only the activeObject and nothing else in the scene,\n                  * first we set every object after scene defaults (i.e. grid, collider plane,\n                  * lights, edit view light box and camera helper) invisible. Then we find the\n                  * index of the raycast sphere that belongs to the active object and make\n                  * this and the following 3 object visible to bring the activeObject back\n                  * in the scene.\n                  **/\n\n        if (this.head) {\n          this.head.visible = false;\n          //this.head.children[0].material.opacity = 0.05;\n          this.axisHelper.visible = false;\n          this.altitudeHelper.visible = false;\n        }\n        this.gui.disableGlobalParameters();\n        [].concat(this.soundObjects, this.soundZones).forEach(function (object) {\n          if (object !== _this9.activeObject) {\n            if (object.type === \"SoundObject\") {\n              object.axisHelper.visible = false;\n              object.altitudeHelper.visible = false;\n              object.cones.forEach(function (cone) {return cone.material.opacity = 0.1;});\n              object.omniSphere.material.opacity = 0.2;\n            } else\n            if (object.type === \"SoundZone\") {\n              object.shape.material.opacity = 0.05;\n            }\n          }\n\n          if (object.type === \"SoundObject\") {\n            object.pause();\n            if (object === _this9.activeObject) {\n              object.axisHelper.visible = true;\n              object.axisHelper.visible = true;\n              object.altitudeHelper.visible = true;\n              object.cones.forEach(function (cone) {return cone.material.opacity = 0.8;});\n              object.omniSphere.material.opacity = 0.8;\n            }\n          }\n        });\n\n        /* lightbox effect */\n        this.renderer.threeRenderer.setClearColor(0xbbeeff);\n      }\n    } }, { key: 'enterEditObjectView', value: function enterEditObjectView()\n\n    {\n      this.toggleAddTrajectory(false);\n      document.getElementById('camera-label').style.display = 'none';\n\n      // disable panning in object view\n      this.controls.disablePan();\n      var trajectory = document.getElementById('add-trajectory');\n      if (trajectory) {\n        trajectory.style.display = 'none';\n      }\n      // disable copy/paste functionality\n      // document.getElementById('copy').style.pointerEvents = 'none';\n      // document.getElementById('copy').style.opacity = \"0.5\";\n\n      // move add cone button to position above\n\n      // slightly hacky fix: orbit controls tween works poorly from top view\n      if (this.controls.threeControls.getPolarAngle() < 0.01) {\n        this.controls.threeControls.constraint.rotateUp(-0.02);\n        this.controls.threeControls.update();\n      }\n\n      var addButton = document.getElementById('add-cone');\n      if (addButton && addButton.firstChild.style.padding != '1.5% 8px') {\n        addButton.firstChild.style.padding = '1.5% 8px';\n      }\n\n      if (!this.isEditingObject) {\n        this.isEditingObject = true;\n        this.isAddingObject = this.isAddingTrajectory = false;\n        this.originalCameraPosition = this.camera.threeCamera.position.clone();\n        this.originalCameraCenter = this.controls.threeControls.center.clone();\n        // make other user heads invisible\n        var _iteratorNormalCompletion = true;var _didIteratorError = false;var _iteratorError = undefined;try {for (var _iterator = Object.entries(this.userHeads)[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {var _step$value = _slicedToArray(_step.value, 2),key = _step$value[0],value = _step$value[1];\n            if (key !== this.headKey.key) {\n              var head = this.scene.getObjectByName(value['head'], true);\n              head.visible = false;\n              head.containerObject = false;\n            }\n          }} catch (err) {_didIteratorError = true;_iteratorError = err;} finally {try {if (!_iteratorNormalCompletion && _iterator.return) {_iterator.return();}} finally {if (_didIteratorError) {throw _iteratorError;}}}\n      }\n\n      if (this.activeObject.type == 'SoundTrajectory') {\n        // return control to parent sound object\n        this.activeObject.deselectPoint();\n        this.activeObject = this.activeObject.parentSoundObject;\n      }\n\n\n      this.tweenToObjectView();\n\n      if (this.tooltipShow) {\n        document.getElementById('help-head').style.display = 'none';\n        document.getElementById('help-camera').style.display = 'none';\n      }\n    } }, { key: 'exitEditObjectView', value: function exitEditObjectView(\n\n    reset) {\n      document.getElementById('camera-label').style.display = 'block';\n      var addTrajectory = document.getElementById('add-trajectory');\n\n      if (addTrajectory) {\n        addTrajectory.style.display = 'block';\n      }\n      // re-enable panning\n      this.controls.enablePan();\n\n      // re-enable copy-paste functionality\n      // document.getElementById('copy').style.pointerEvents = 'auto';\n      // document.getElementById('copy').style.opacity = \"1\";\n\n      if (this.gui.editor) {this.gui.exitEditorGui();}\n      this.isEditingObject = false;\n      if (this.head) {\n        this.head.visible = true;\n        this.axisHelper.visible = true;\n        this.altitudeHelper.visible = true;\n        // make other user heads invisible\n        var _iteratorNormalCompletion2 = true;var _didIteratorError2 = false;var _iteratorError2 = undefined;try {for (var _iterator2 = Object.entries(this.userHeads)[Symbol.iterator](), _step2; !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {var _step2$value = _slicedToArray(_step2.value, 2),key = _step2$value[0],value = _step2$value[1];\n            if (key !== this.headKey.key) {\n              var head = this.scene.getObjectByName(value['head'], true);\n              head.visible = true;\n              head.containerObject = true;\n            }\n          }} catch (err) {_didIteratorError2 = true;_iteratorError2 = err;} finally {try {if (!_iteratorNormalCompletion2 && _iterator2.return) {_iterator2.return();}} finally {if (_didIteratorError2) {throw _iteratorError2;}}}\n      }\n      this.gui.enableGlobalParameters();\n      [].concat(this.soundObjects, this.soundZones).forEach(function (object) {\n        if (object.type === \"SoundObject\") {\n          object.axisHelper.visible = true;\n          object.altitudeHelper.visible = true;\n          object.cones.forEach(function (cone) {return cone.material.opacity = 0.8;});\n          object.omniSphere.material.opacity = 0.8;\n          object.unpause();\n        } else\n        if (object.type === \"SoundZone\") {\n          object.shape.material.opacity = _helpers2.default.mapRange(object.volume, 0, 2, 0.05, 0.35);\n          // object.shape.visible = true;\n        }\n      });\n\n      if (!this.isAddingTrajectory && !this.isAddingObject && !reset) {\n        new _tween2.default.Tween(this.camera.threeCamera.position).\n        to(this.originalCameraPosition, 800).\n        start();\n\n        new _tween2.default.Tween(this.controls.threeControls.center).\n        to(this.originalCameraCenter, 800).\n        start();\n      }\n      /* turn off lightbox effect */\n      var uuid = this.activeObject.containerObject.uuid;\n      this.renderer.threeRenderer.setClearColor(0xf0f0f0);\n      if (uuid in this.trajectoryCache) {\n        if ('new' in this.trajectoryCache) {\n          this.path.points = this.trajectoryCache[uuid];\n          this.path.parentObject = this.activeObject;\n          this.path.createObject(this, true, true, false);\n          this.activeObject.calculateMovementSpeed();\n        } else\n        if ('path' in this.trajectoryCache) {\n          this.activeObject.trajectory.splinePoints = this.trajectoryCache[uuid];\n          this.activeObject.trajectory.points = this.trajectoryCache[uuid];\n          this.activeObject.trajectory.updateTrajectory(true);\n          this.activeObject.calculateMovementSpeed();\n        } else\n        {\n          this.activeObject.setPosition(this.trajectoryCache[uuid]);\n        }\n        this.trajectoryCache = {};\n      }\n      if (this.tooltipShow) {\n        if (!this.movedHead) {\n          document.getElementById('help-head').style.display = 'inline-block';\n        }\n        if (this.cameraHasLabel) {\n          document.getElementById('help-camera').style.display = 'inline-block';\n        }\n      }\n    } }, { key: 'reset', value: function reset()\n\n    {\n      var zoomAmount = this.camera.threeCamera.position.distanceTo(new THREE.Vector3(0, 0, 0));\n      if (this.isEditingObject) {\n        this.exitEditObjectView(true);\n      }\n      this.controls.threeControls.reset();\n      this.camera.threeCamera.position.set(0, zoomAmount, 0);\n    } }, { key: 'toggleAddTrajectory',\n\n\n\n\n\n\n\n\n\n    /**\n                                        * Sets the trajectory adding state on. If the scene is in perspective view when\n                                        * this is called, it will be reset to bird's eye.\n                                        */value: function toggleAddTrajectory(\n    state) {\n      var btn = document.querySelector('#add-trajectory > .button');\n      this.isAddingTrajectory = state === undefined ? !this.isAddingTrajectory : state;\n      if (this.isAddingTrajectory === true) {\n        btn.classList.toggle('active');\n        this.activeObject.oldPosition =\n        new THREE.Vector3(this.activeObject.containerObject.position.x,\n        this.activeObject.containerObject.position.y,\n        this.activeObject.containerObject.position.z);\n      }\n      var trajectoryElement = document.getElementById('add-trajectory');\n      if (trajectoryElement) {\n        trajectoryElement.classList.toggle('active', this.isAddingTrajectory);\n      }\n      this.isAllowMouseDrag = true;\n      this.reset();\n    }\n\n    /**\n       * Sets the object adding state on. If the scene is in perspective view when\n       * this is called, it will be reset to bird's eye.\n       */ }, { key: 'toggleAddObject', value: function toggleAddObject()\n    {\n      if (this.audio.context.state == \"suspended\") this.audio.context.resume();\n      this.isAddingObject = !this.isAddingObject;\n      if (this.isAddingTrajectory) {\n        this.toggleAddTrajectory(false);\n      }\n      this.reset();\n\n      var btn = document.getElementById('add-object-button');\n      btn.classList.toggle('active', this.isAddingObject);\n      btn.innerHTML = this.isAddingObject ? '' : '+';\n\n      document.getElementById('help-add').style.display = 'none';\n    }\n\n    /**\n       * Sets the the last clicked (active) object.\n       * Calls a \"secActive()\" function ob the selected object.\n       */ }, { key: 'setActiveObject', value: function setActiveObject(\n    obj) {\n      if (this.activeObject) {\n        this.activeObject.setInactive();\n      }\n\n      this.activeObject = obj;\n\n      if (obj) {\n        if (obj.cones && obj.cones.length > 0) {\n          this.interactiveCone = obj.cones[0];\n        }\n        obj.setActive(this);\n      }\n    }\n\n    /* Updates the user's head model's position and orientation in each frame. Also\n      updates collaborative user's head model preview for the user. */ }, { key: 'updateDummyHead', value: function updateDummyHead(\n    key) {\n      if (key != null) {\n        key = key.key;\n      }\n      this.head = this.scene.getObjectByName('dummyHead', true);\n      // for current user's head\n      if (this.head && (this.isAddingTrajectory && this.activeObject && this.activeObject.type == 'HeadObject' ||\n      this.isAllowMouseDrag && !this.headObject.trajectory ||\n      this.isMouseDown && this.headObject.trajectory && this.activeObject && this.activeObject.type == 'HeadObject') &&\n      !this.isEditingObject) {\n        // If adding trajectory, moving head using mouse, or moving head using mouse while on trajectory, head follows object\n        this.altitudeHelper.position.copy(this.headObject.containerObject.position);\n        this.altitudeHelper.position.y = 0;\n        this.axisHelper.position.copy(this.headObject.containerObject.position);\n        this.head.position.copy(this.headObject.containerObject.position);\n        this.axisHelper.rotation.y = this.headObject.rotation.y;\n        this.head.rotation.y = this.headObject.rotation.y;\n        this.setListenerPosition(this.head);\n\n      } else\n      if (this.head && this.headObject.trajectory && !this.isEditingObject) {\n        // If following trajectory, head follows object\n        this.headObject.followTrajectory(this.isPlaying);\n        this.altitudeHelper.position.copy(this.headObject.containerObject.position);\n        this.altitudeHelper.position.y = 0;\n        this.axisHelper.position.copy(this.headObject.containerObject.position);\n        this.head.position.copy(this.headObject.containerObject.position);\n        this.headObject.rotation.y = this.head.rotation.y;\n        this.setListenerPosition(this.head);\n      } else\n      if (this.head && !this.isEditingObject) {\n        // Object follow head\n        this.axisHelper.rotation.y += -this.yawLeft + this.yawRight;\n        this.head.rotation.y += -this.yawLeft + this.yawRight;\n        this.axisHelper.translateZ(-this.moveBackwards + this.moveForward);\n        this.head.translateZ(-this.moveBackwards + this.moveForward);\n        this.setListenerPosition(this.head);\n\n        this.headObject.containerObject.position.copy(this.head.position);\n        this.headObject.rotation.y = this.head.rotation.y;\n        this.altitudeHelper.position.copy(this.headObject.containerObject.position);\n        this.altitudeHelper.position.y = 0;\n      }\n      if (this.roomCode != null && this.head != null &&\n      this.headObject.trajectory == null && key != null) {\n        this.dbRef.child('users').child(key).update({\n          position: this.head.position,\n          rotation: this.head.rotation.y });\n\n      }\n      for (var keyVal in this.userHeads) {\n        var headObj = this.userHeads[keyVal].otherHeadObject;\n        if (headObj.trajectory != null) {\n          var name = this.userHeads[keyVal].head;\n          var other = this.scene.getObjectByName(name, true);\n          if (other == undefined) {\n            return;\n          }\n          headObj.followTrajectory(this.isPlaying, other);\n          other.position.copy(headObj.containerObject.position);\n          headObj.rotation.y = other.rotation.y;\n        }\n      }\n    } }, { key: 'setMousePosition', value: function setMousePosition(\n\n    event) {\n      var pointer = new THREE.Vector3();\n      pointer.set(event.clientX / window.innerWidth * 2 - 1, -(event.clientY / window.innerHeight) * 2 + 1);\n\n      this.nonScaledMouse = pointer;\n\n      this.ray.setFromCamera(pointer, this.camera.threeCamera);\n\n      var intersects = this.ray.intersectObject(this.floor);\n      if (intersects.length > 0) {\n        this.mouse = intersects[0].point;\n      }\n    } }, { key: 'toggleSearchBar', value: function toggleSearchBar()\n\n    {var element = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : null;\n      if (this.soundSearch.isShowing) {\n        this.soundSearch.hide();\n        if (element) {\n          element.innerHTML = 'Search for Sounds';\n        } else {\n          document.getElementById('search-clear-search-button').innerHTML = 'Search for Sounds';\n        }\n      } else\n      {\n        this.soundSearch.display();\n        element.innerHTML = 'Close Search Bar';\n      }\n    } }, { key: 'toggleGlobalPlay', value: function toggleGlobalPlay(\n\n    element) {var _this10 = this;\n      this.isPlaying = !this.isPlaying;\n      if (this.isPlaying) {\n        element.innerHTML = 'Pause';\n        element.title = 'Pause';\n        this.audio.context.resume();\n      } else {\n        element.innerHTML = 'Play';\n        element.title = 'Play';\n        this.audio.context.suspend();\n      }\n\n      [].concat(this.soundObjects, this.soundZones).forEach(function (obj) {return obj.toggleAppearance(_this10);});\n      if (this.roomCode != null) {\n        // TODO: must edit the cloud function on room deletion to also remove this globalIsPlaying value\n        this.dbRef.child('globals').child('sound').update({\n          globalIsPlaying: this.isPlaying,\n          lastEdit: this.headKey.key });\n\n      }\n    }\n\n    // TODO: Remove this function and its dependencies\n  }, { key: 'toggleGlobalMute', value: function toggleGlobalMute() {var _this11 = this;\n      this.isMuted = !this.isMuted;\n      [].concat(this.soundObjects, this.soundZones).forEach(function (sound) {return sound.checkMuteState(_this11);});\n    } }, { key: 'toggleTooltip', value: function toggleTooltip()\n\n    {\n      document.getElementById('tooltip-label').innerHTML = this.tooltipShow ? 'Enable Tooltips' : 'Disable Tooltips';\n      this.tooltipShow = !this.tooltipShow;\n      if (!this.tooltipShow) {// tooltip visible to invisible\n        // remove visible help bubbles\n        [].slice.call(document.getElementsByClassName('help-bubble')).forEach(function (element) {\n          element.style.display = 'none';\n        });\n      } else {// tooltip invisible to visible\n        if (!this.movedHead) {\n          document.getElementById('help-head').style.display = 'inline-block';\n        }\n        if (this.addObjectLabel) {\n          document.getElementById('help-add').style.display = 'inline-block';\n        }\n        if (this.cameraHasLabel) {\n          document.getElementById('help-camera').style.display = 'inline-block';\n        }\n      }\n    } }, { key: 'showTooltip', value: function showTooltip(\n\n    elementId) {\n      if (this.tooltipShow) {\n        document.getElementById(elementId).style.display = 'inline-block';\n      }\n    } }, { key: 'hideTooltip', value: function hideTooltip(\n\n    elementId) {\n      document.getElementById(elementId).style.display = 'none';\n    } }, { key: 'headObjectTooltip', value: function headObjectTooltip()\n\n    {\n      if (!this.isMouseDown && this.tooltipShow) {\n        if (this.headObject.isUnderMouse(this.ray)) {\n          var top = 0;\n          var left = 0;\n          this.movedHead = true;\n          var coreCameraPositionX = this.camera.threeCamera.position.x;\n          var coreCameraPositionY = this.camera.threeCamera.position.z;\n          if (!this.perspectiveView) {\n            if (this.headObject.containerObject.position.x <= coreCameraPositionX) {\n              left = Math.max(0, window.innerWidth / 2 + (this.headObject.containerObject.position.x - coreCameraPositionX) / 2.8709 + 50);\n            } else {\n              left = Math.min(window.innerWidth,\n              window.innerWidth / 2 + (this.headObject.containerObject.position.x - coreCameraPositionX) / 2.8709 - 350);\n            }\n\n            if (this.headObject.containerObject.position.z <= coreCameraPositionY) {\n              top = window.innerHeight / 2 - -1 * (this.headObject.containerObject.position.z - coreCameraPositionY) / 2.8709 + 35;\n            } else {\n              top = window.innerHeight / 2 + (this.headObject.containerObject.position.z - coreCameraPositionY) / 2.8709 - 80;\n            }\n            document.getElementById('help-head').style.left = left.toString() + 'px';\n            document.getElementById('help-head').style.top = top.toString() + 'px';\n            document.getElementById('help-head').style.marginLeft = 0;\n          } else if (this.perspectiveView) {\n            document.getElementById('help-head').style.left = \"50%\";\n            document.getElementById('help-head').style.top = \"40%\";\n          }\n          this.showTooltip('help-head');\n        } else {\n          if (this.movedHead) {\n            this.hideTooltip('help-head');\n          }\n        }\n      } else {\n        if (this.movedHead) {\n          this.hideTooltip('help-head');\n        }\n      }\n    } }, { key: 'muteAll', value: function muteAll(\n\n    excludedSounds) {var _this12 = this;\n      var sounds = [].concat(this.soundObjects, this.soundZones);\n\n      if (excludedSounds) {\n        excludedSounds = [].concat(excludedSounds);\n        sounds = sounds.filter(function (sound) {return excludedSounds.indexOf(sound) < 0;});\n      }\n\n      sounds.forEach(function (sound) {return sound.mute(_this12);});\n    } }, { key: 'unmuteAll', value: function unmuteAll(\n\n    excludedSounds) {var _this13 = this;\n      var sounds = [].concat(this.soundObjects, this.soundZones);\n\n      if (excludedSounds) {\n        excludedSounds = [].concat(excludedSounds);\n        sounds = sounds.filter(function (sound) {return excludedSounds.indexOf(sound) < 0;});\n      }\n\n      sounds.forEach(function (sound) {return sound.unmute(_this13);});\n    } }, { key: 'removeSoundZone', value: function removeSoundZone(\n\n    soundZone) {var flag = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : true;\n      var i = this.soundZones.indexOf(soundZone);\n      this.soundZones[i].notUnderUser(this.audio);\n      soundZone.removeFromScene(this.scene);\n      this.soundZones.splice(i, 1);\n      // if(flag)\n      //   this.undoableActionStack.push(new Action(soundZone, 'removeSoundZone'));\n    } }, { key: 'removeSoundObject', value: function removeSoundObject(\n\n    soundObject) {var flag = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : true;\n      soundObject.removeFromScene(this.scene);\n      var i = this.soundObjects.indexOf(soundObject);\n      this.soundObjects.splice(i, 1);\n      if (flag == \"combo\") {\n        if (soundObject.trajectory) {\n          this.removeSoundTrajectory(soundObject.trajectory, \"combo\");\n        }\n      }\n    } }, { key: 'removeCone', value: function removeCone(\n\n    object, cone) {var flag = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : true;\n      object.removeCone(cone);\n    } }, { key: 'removeSoundTrajectory', value: function removeSoundTrajectory(\n\n    soundTrajectory) {var flag = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : true;\n      if (soundTrajectory.parentSoundObject.hasBeenMoved) {\n        this.changeTrajectoryLocation(soundTrajectory.parentSoundObject.trajectory, soundTrajectory);\n        this.changeUndoRedoActions(soundTrajectory.parentSoundObject.containerObject.uuid, 'trajectoryPos', soundTrajectory);\n      }\n\n      soundTrajectory.parentSoundObject.lastPathPosition.copy(soundTrajectory.parentSoundObject.containerObject.position);\n      soundTrajectory.parentSoundObject.trajectory.removeFromScene(this.scene);\n      var i = this.soundTrajectories.indexOf(soundTrajectory);\n      this.soundTrajectories.splice(i, 1);\n\n      if (flag != \"gui\") {\n        soundTrajectory.parentSoundObject.trajectory = null;\n        var elem = document.getElementById('trajectory');\n        if (elem != null) {\n          elem.parentNode.removeChild(elem);\n        }\n        this.gui.addTrajectoryDialog();\n      }\n      this.activeObject = soundTrajectory.parentSoundObject;\n      if (this.activeObject.type === \"HeadObject\") {\n        this.activeObject.resetPosition();\n      } else if (this.activeObject.type === \"SoundTrajectory\" && this.activeObject.parentSoundObject.type === \"HeadObject\") {\n        this.activeObject.parentSoundObject.resetPosition();\n      }\n\n      if (flag == true) {\n        this.undoableActionStack.push(new _action2.default(soundTrajectory, 'removeSoundTrajectory'));\n      }\n\n    } }, { key: 'addSoundTrajectory', value: function addSoundTrajectory(\n\n    soundTrajectory, object) {var flag = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : true;\n      var delX = 0;\n      var delY = 0;\n      var delZ = 0;\n      var item = this.headObject;\n      if (object.type == 'SoundObject') {\n        item = this.findObject(object.containerObject.uuid, 'soundObject');\n      }\n\n      var currentPosition = item.containerObject.position;\n\n      // oldPosition is also the initial starting point of the trajectory path\n      if (item.hasBeenMoved && currentPosition != null && currentPosition != object.oldPosition) {\n        var newStartNode = { x: 0, y: 0, z: 0 };\n        newStartNode.x = currentPosition.x + (object.oldPosition.x - object.lastPathPosition.x);\n        newStartNode.y = currentPosition.y + (object.oldPosition.y - object.lastPathPosition.y);\n        newStartNode.z = currentPosition.z + (object.oldPosition.z - object.lastPathPosition.z);\n\n        delX = newStartNode.x - object.oldPosition.x;\n        delY = newStartNode.y - object.oldPosition.y;\n        delZ = newStartNode.z - object.oldPosition.z;\n\n        item.oldPosition.copy(newStartNode);\n      }\n\n      this.path.points = soundTrajectory.splinePoints.map(function (i) {return new THREE.Vector3(i.x + delX, i.y + delY, i.z + delZ);});\n      this.path.parentObject = object;\n      var newTrajectory = this.path.createObject(this, true, true);\n      this.soundTrajectories.push(newTrajectory);\n      this.changeTrajectoryLocation(newTrajectory, soundTrajectory);\n      if (item.hasBeenMoved) {\n        //this.changeTrajectoryLocation(newTrajectory, soundTrajectory);\n        this.changeUndoRedoActions(object.containerObject.uuid, 'trajectoryPos', soundTrajectory);\n        item.hasBeenMoved = false;\n      } else {\n        object.containerObject.position.copy(object.lastPathPosition);\n        item.containerObject.position.copy(object.lastPathPosition);\n      }\n      object.calculateMovementSpeed();\n    } }, { key: 'addSoundObject', value: function addSoundObject(\n\n    soundObject) {var flag = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : true;var trajectory = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : soundObject.trajectory;\n      soundObject.restoreToScene(this.scene);\n      this.soundObjects.push(soundObject);\n      if (trajectory) {\n        if (flag == true) {\n          this.addSoundTrajectory(trajectory, soundObject);\n        } else if (flag == \"combo\" || flag == false) {\n          this.addSoundTrajectory(trajectory, soundObject, false);\n        }\n      }\n    } }, { key: 'addSoundZone', value: function addSoundZone(\n\n    soundZone) {\n      soundZone.restoreToScene(this.scene);\n      this.soundZones.push(soundZone);\n    } }, { key: 'addCone', value: function addCone(\n\n    object, cone) {var flag = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : true;\n      object.restoreConeToScene(cone, object.coneSounds[cone.uuid]);\n    } }, { key: 'undo', value: function undo()\n\n    {\n      var cannotDo = false;\n\n      if (this.undoableActionStack.length > 0) {\n        var actionToUndo = this.undoableActionStack.pop();\n        switch (actionToUndo.actionType) {\n          case 'removeSoundObject':\n            if (this.doesObjectExist(actionToUndo.mainObject.containerObject.uuid, 'soundObject')) {\n              this.undo();\n            } else {\n              this.addSoundObject(actionToUndo.mainObject, false);\n              this.setActiveObject(actionToUndo.mainObject);\n            }\n            break;\n          case 'removeSoundZone':\n            this.addSoundZone(actionToUndo.mainObject);\n            this.setActiveObject(actionToUndo.mainObject);\n            break;\n          case 'addSoundObject':\n            if (this.soundObjects.length > 0) {\n              this.removeSoundObject(actionToUndo.mainObject, false);\n              this.activeObject = null;\n              this.reset();\n            } else {\n              cannotDo = true;\n            }\n            break;\n          case 'addSoundZone':\n            this.removeSoundZone(actionToUndo.mainObject, false);\n            this.activeObject = null;\n            break;\n          case 'removeSoundTrajectory':\n            this.addSoundTrajectory(actionToUndo.mainObject, actionToUndo.mainObject.parentSoundObject, false);\n            this.setActiveObject(actionToUndo.mainObject.parentSoundObject);\n            actionToUndo.mainObject.parentSoundObject.trajectory.setActive();\n            break;\n          case 'addSoundTrajectory':\n            actionToUndo.mainObject.parentSoundObject.trajectory.setInactive();\n            actionToUndo.mainObject.parentSoundObject.trajectory.turnInvisible();\n            this.removeSoundTrajectory(actionToUndo.mainObject, false);\n            this.setActiveObject(actionToUndo.mainObject);\n            break;\n          case 'removeFullObject':\n            this.addSoundObject(actionToUndo.mainObject, true, actionToUndo.secondary);\n            this.setActiveObject(actionToUndo.mainObject);\n            if (actionToUndo.mainObject.trajectory) {\n              actionToUndo.mainObject.trajectory.setActive();\n            }\n            break;\n          case 'addFullObject':\n            this.removeSoundObject(actionToUndo.mainObject, \"comboUndoRedo\");\n            this.activeObject = null;\n            this.reset();\n            break;\n          case 'addCone':\n            this.removeCone(actionToUndo.mainObject, actionToUndo.secondary, false);\n            this.setActiveObject(actionToUndo.mainObject);\n            break;\n          case 'removeCone':\n            this.addCone(actionToUndo.mainObject, actionToUndo.secondary, false);\n            break;\n          default:\n            console.log('no such action type exists for type ', actionToUndo.actionType);\n            break;}\n\n        if (!cannotDo) {\n          this.redoableActionStack.push(actionToUndo);\n        } else {\n          this.undo();\n        }\n      } else {\n        console.log('nothing to undo');\n      }\n    } }, { key: 'redo', value: function redo()\n\n    {\n      var cannotDo = false;\n\n      if (this.redoableActionStack.length > 0) {\n        var actionToDo = this.redoableActionStack.pop();\n        switch (actionToDo.actionType) {\n          case 'addSoundObject':\n            this.addSoundObject(actionToDo.mainObject, false);\n            this.setActiveObject(actionToDo.mainObject);\n            break;\n          case 'addSoundZone':\n            this.addSoundZone(actionToDo.mainObject);\n            this.setActiveObject(actionToDo.mainObject);\n            break;\n          case 'removeSoundObject':\n            if (!this.doesObjectExist(actionToDo.mainObject.containerObject.uuid, 'soundObject')) {\n              cannotDo = true;\n            } else {\n              this.removeSoundObject(actionToDo.mainObject, false);\n              this.activeObject = null;\n              this.reset();\n            }\n            break;\n          case 'removeSoundZone':\n            this.removeSoundZone(actionToDo.mainObject, false);\n            this.activeObject = null;\n            break;\n          case 'removeSoundTrajectory':\n            if (actionToDo.mainObject.parentSoundObject.trajectory == null) {\n              cannotDo = true;\n            } else {\n              actionToDo.mainObject.parentSoundObject.trajectory.setInactive();\n              actionToDo.mainObject.parentSoundObject.trajectory.turnInvisible();\n              this.removeSoundTrajectory(actionToDo.mainObject, false);\n              this.setActiveObject(actionToDo.mainObject);\n            }\n            break;\n          case 'addSoundTrajectory':\n            this.addSoundTrajectory(actionToDo.mainObject, actionToDo.mainObject.parentSoundObject, false);\n            this.setActiveObject(actionToDo.mainObject.parentSoundObject);\n            actionToDo.mainObject.parentSoundObject.trajectory.setActive();\n            break;\n          case 'removeFullObject':\n            if (!this.doesObjectExist(actionToDo.mainObject.containerObject.uuid, 'soundObject')) {\n              cannotDo = true;\n            } else {\n              this.removeSoundObject(actionToDo.mainObject, \"combo\");\n              this.activeObject = null;\n              this.reset();\n            }\n            break;\n          case 'addFullObject':\n            this.addSoundObject(actionToDo.mainObject, false, actionToDo.secondary);\n            this.setActiveObject(actionToDo.mainObject);\n            break;\n          case 'addCone':\n            this.addCone(actionToDo.mainObject, actionToDo.secondary, false);\n            break;\n          case 'removeCone':\n            if (actionToDo.mainObject == null && actionToDo.secondary == null) {\n              cannotDo = true;\n            } else {\n              this.removeCone(actionToDo.mainObject, actionToDo.secondary, false);\n              this.setActiveObject(actionToDo.mainObject);\n            }\n            break;\n          default:\n            console.log('no such action type exists for type ', actionToDo.actionType);\n            break;}\n\n        if (!cannotDo) {\n          this.undoableActionStack.push(actionToDo);\n        } else {\n          this.redo();\n        }\n      } else {\n        console.log(\"nothing to redo\");\n      }\n\n    } }, { key: 'clear', value: function clear()\n\n    {\n      var deleteEvent = new KeyboardEvent('keydown', {\n        \"bubbles\": true,\n        \"cancelable\": true,\n        \"key\": \"Backspace\",\n        \"code\": \"Backspace\",\n        \"keyCode\": 8 });\n\n      // delete all soundObjects\n      var counter = this.soundObjects.length - 1;\n      while (this.soundObjects.length != 0) {\n        this.activeObject = this.soundObjects[counter];\n        document.activeElement.dispatchEvent(deleteEvent);\n        counter -= 1;\n      }\n      // delete all soundZones\n      counter = this.soundZones.length - 1;\n      while (this.soundZones.length != 0) {\n        this.activeObject = this.soundZones[counter];\n        document.activeElement.dispatchEvent(deleteEvent);\n        counter -= 1;\n      }\n\n      // delete head trajectory\n      if (this.headObject.trajectory != null) {\n        this.removeSoundTrajectory(this.headObject.trajectory);\n      }\n    } }, { key: 'reattachConeSound', value: function reattachConeSound(\n\n    cone, sound) {\n      cone.sound = sound;\n    } }, { key: 'copySelectedItem', value: function copySelectedItem()\n\n    {\n      this.reset();\n      // function to make a copy of a sound object or sound zone\n      if (this.activeObject) {\n        if (this.activeObject.type == \"SoundObject\") {\n          var index = this.soundObjects.indexOf(this.activeObject);\n          var originalObj = this.soundObjects[index];\n\n          // Copy sound Object and Cones\n          var newObj = this.path.createObject(this, true);\n          newObj.copyObject(originalObj, this.mouse);\n          this.setActiveObject(newObj);\n\n          this.isAddingObject = false;\n\n          // Stick sound object to mouse and set down at mouse click point\n          this._moveObject = this.moveObject.bind(this);\n          this._placeObject = this.placeObject.bind(this, originalObj);\n          document.addEventListener('mousemove', this._moveObject, false);\n          document.addEventListener('mousedown', this._placeObject, false);\n        } else\n        if (this.activeObject.type == \"SoundZone\") {\n          var index = this.soundZones.indexOf(this.activeObject);\n          var originalObj = this.soundZones[index];\n\n          // Fakes drawing for zone creation\n          this.path.points = originalObj.splinePoints;\n\n          // Copy sound zone\n          var _newObj = this.path.createObject(this, true);\n          _newObj.copyObject(originalObj, this.mouse);\n\n          this.setActiveObject(_newObj);\n          this.isAddingObject = false;\n          this.activeObject.updateZone();\n\n          // Stick sound object to mouse and set down at mouse click point\n          this._moveObject = this.moveObject.bind(this);\n          this._placeObject = this.placeObject.bind(this, originalObj);\n          document.addEventListener('mousemove', this._moveObject, false);\n          document.addEventListener('mousedown', this._placeObject, false);\n          this.soundZones.push(_newObj);\n        }\n      }\n    } }, { key: 'moveObject', value: function moveObject()\n\n    {\n      // function to stick copied object to mouse\n      if (this.activeObject) {\n        this.activeObject.move(this, false);\n      }\n    } }, { key: 'placeObject', value: function placeObject(\n\n    originalObj) {\n      // function to set copied object down at mouse click point\n      document.removeEventListener('mousemove', this._moveObject, false);\n      document.removeEventListener('mousedown', this._placeObject, false);\n\n      // Copy and position soundobject trajectory\n      if (this.activeObject.type == \"SoundObject\" && originalObj.trajectory) {\n        this.path.points = originalObj.trajectory.splinePoints.map(function (i) {return new THREE.Vector3(i.x, i.y, i.z);});\n        this.path.parentObject = this.activeObject;\n        this.path.createObject(this, true);\n        this.activeObject.trajectory.setCopyPosition(this.mouse);\n        this.activeObject.calculateMovementSpeed();\n      }\n    } }, { key: 'findObject', value: function findObject(\n\n    uuid, type) {\n      if (type === 'soundObject') {\n        for (var i = 0; i < this.soundObjects.length; i++) {\n          if (this.soundObjects[i].containerObject.uuid == uuid) {\n            return this.soundObjects[i];\n          }\n        }\n      }\n      return null;\n    } }, { key: 'doesObjectExist', value: function doesObjectExist(\n\n    uuid, type) {\n      if (type === 'soundObject') {\n        for (var i = 0; i < this.soundObjects.length; i++) {\n          if (this.soundObjects[i].containerObject.uuid == uuid) {\n            return true;\n          }\n        }\n      }\n      return false;\n    } }, { key: 'changeUndoRedoActions', value: function changeUndoRedoActions(\n\n    uuid, change, object) {\n      if (change === 'trajectoryPos') {\n        this.undoableActionStack.forEach(function (action) {\n          if ((action.actionType == 'removeSoundTrajectory' || action.actionType == 'addSoundTrajectory') &&\n          action.mainObject.parentSoundObject.containerObject.uuid == uuid) {\n            action.mainObject = object;\n            action.mainObject.parentSoundObject.trajectory = action.mainObject;\n          }\n        });\n\n        this.redoableActionStack.forEach(function (action) {\n          if ((action.actionType == 'removeSoundTrajectory' || action.actionType == 'addSoundTrajectory') &&\n          action.mainObject.parentSoundObject.containerObject.uuid == uuid) {\n            action.mainObject = object;\n            action.mainObject.parentSoundObject.trajectory = action.mainObject;\n          }\n        });\n\n      }\n      //else if(change === 'trajectoryHead'){}\n    } }, { key: 'changeTrajectoryLocation', value: function changeTrajectoryLocation(\n\n    newTrajectory, oldTrajectory) {\n      Object.assign(oldTrajectory.pointObjects, newTrajectory.pointObjects);\n      Object.assign(oldTrajectory.points, newTrajectory.points);\n      Object.assign(oldTrajectory.spline, newTrajectory.spline);\n      Object.assign(oldTrajectory.splinePoints, newTrajectory.splinePoints);\n    } }, { key: 'areTrajectoryPointsEqual', value: function areTrajectoryPointsEqual(\n\n    newTrajectory, oldTrajectory) {\n      if (newTrajectory.length != oldTrajectory.length) {\n        return false;\n      } else {\n        for (var i = 0; i < newTrajectory.length; i++) {\n          if (newTrajectory[i].x != oldTrajectory[i].x ||\n          newTrajectory[i].y != oldTrajectory[i].y ||\n          newTrajectory[i].z != oldTrajectory[i].z) {\n            return false;\n          }\n        }\n      }\n      return true;\n    }\n\n    /**\n      overrides three.js triangulate with libtess.js algorithm for the conversion of a curve to a filled (2D) path. still doesn't produce desired behavior with some non-simple paths\n       adapted from libtess example page https://brendankenny.github.io/libtess.js/examples/simple_triangulation/index.html\n      */ }, { key: 'overrideTriangulate', value: function overrideTriangulate()\n\n    {\n      var tessy = function initTesselator() {\n        // function called for each vertex of tesselator output\n        function vertexCallback(data, polyVertArray) {\n          polyVertArray[polyVertArray.length] = data[0];\n          polyVertArray[polyVertArray.length] = data[1];\n        }\n        function begincallback(type) {\n          if (type !== libtess.primitiveType.GL_TRIANGLES) {\n            console.log('expected TRIANGLES but got type: ' + type);\n          }\n        }\n        function errorcallback(errno) {\n          console.log('error callback');\n          console.log('error number: ' + errno);\n        }\n        // callback for when segments intersect and must be split\n        function combinecallback(coords, data, weight) {\n          return [coords[0], coords[1], coords[2]];\n        }\n        function edgeCallback(flag) {\n          // don't really care about the flag, but need no-strip/no-fan behavior\n          // console.log('edge flag: ' + flag);\n        }\n\n        var tessy = new libtess.GluTesselator();\n        tessy.gluTessProperty(libtess.gluEnum.GLU_TESS_WINDING_RULE, libtess.windingRule.GLU_TESS_WINDING_NONZERO);\n        tessy.gluTessCallback(libtess.gluEnum.GLU_TESS_VERTEX_DATA, vertexCallback);\n        tessy.gluTessCallback(libtess.gluEnum.GLU_TESS_BEGIN, begincallback);\n        tessy.gluTessCallback(libtess.gluEnum.GLU_TESS_ERROR, errorcallback);\n        tessy.gluTessCallback(libtess.gluEnum.GLU_TESS_COMBINE, combinecallback);\n        tessy.gluTessCallback(libtess.gluEnum.GLU_TESS_EDGE_FLAG, edgeCallback);\n\n        return tessy;\n      }();\n\n      THREE.ShapeUtils.triangulate = function (contour, indices) {\n\n        if (contour.length < 3) return null;\n\n        var triangles = [];\n        var map = {};\n\n        var result = [];\n        var vertIndices = [];\n\n        // libtess will take 3d verts and flatten to a plane for tesselation\n        // since only doing 2d tesselation here, provide z=1 normal to skip\n        // iterating over verts only to get the same answer.\n        // comment out to test normal-generation code\n        tessy.gluTessNormal(0, 0, 1);\n\n        tessy.gluTessBeginPolygon(triangles);\n\n        // shape should be a single contour without holes anyway...\n        tessy.gluTessBeginContour();\n        contour.forEach(function (pt, i) {\n          var coord = [pt.x, pt.y, 0];\n          tessy.gluTessVertex(coord, coord);\n          map[coord[0] + ',' + coord[1]] = i; // store in map\n        });\n        tessy.gluTessEndContour();\n\n        // finish polygon\n        tessy.gluTessEndPolygon();\n\n        // use map to convert points back to triangles of contour\n        var nTri = triangles.length;\n\n        for (var i = 0; i < nTri; i += 6) {\n          var a = map[triangles[i] + ',' + triangles[i + 1]],\n          b = map[triangles[i + 2] + ',' + triangles[i + 3]],\n          c = map[triangles[i + 4] + ',' + triangles[i + 5]];\n\n          if (a == undefined || b == undefined || c == undefined) {continue;}\n          vertIndices.push([a, b, c]);\n          result.push([contour[a],\n          contour[b],\n          contour[c]]);\n        }\n\n        if (indices) return vertIndices;\n        return result;\n      };\n    } }, { key: 'export', value: function _export()\n\n    {\n      var zipHelper = this.zipHelper;\n      var that = this;\n\n      document.getElementById('save-status').style.display = 'block';\n      document.getElementById('save').style.pointerEvents = 'none';\n      document.getElementById('save').style.opacity = \"0.5\";\n\n      var promise = new Promise(function (resolve, reject) {\n        var files = [];\n\n        var addFile = function addFile(file) {\n          var fileExists = files.map(function (f) {return f.name;}).includes(file.name);\n          if (!fileExists) files.push(file);\n        };\n\n        var exportJSON = JSON.stringify({\n          camera: that.camera.threeCamera.toJSON(),\n          soundObjects: that.soundObjects.map(function (obj) {\n            if (obj.file) addFile(obj.file);\n\n            obj.cones.forEach(function (c) {\n              if (c.file) addFile(c.file);\n            });\n\n            return obj.toJSON();\n          }),\n          soundZones: that.soundZones.map(function (obj) {\n            if (obj.file) addFile(obj.file);\n            return obj.toJSON();\n          }),\n          headObject: [that.headObject.toJSON()] },\n        null, 2);\n\n        var configBlob = new Blob([exportJSON], { type: 'application/json' });\n        var configFile = new File([configBlob], 'config.json');\n        var exportFiles = files.concat([configFile]);\n\n        zipHelper.addFiles(\n        exportFiles,\n        function () {},\n        function (file) {},\n        function (current, total) {},\n        function () {\n          zipHelper.getBlobURL(function (blobURL) {\n            resolve(blobURL);\n          });\n        });\n\n      });\n\n      return promise;\n    } }, { key: 'import', value: function _import(\n\n    data) {var _this14 = this;\n      var zipHelper = this.zipHelper;\n      var files = {};\n      var promises = [];\n\n      document.getElementById('load-status').style.display = 'block';\n      document.getElementById('load').style.pointerEvents = 'none';\n      document.getElementById('load').style.opacity = \"0.5\";\n\n      zipHelper.getEntries(data, function (entries) {\n        promises = entries.map(function (entry) {\n          return new Promise(function (resolve, reject) {\n            zipHelper.getEntryFile(entry, function (filename, blob) {\n              var fileReader = new FileReader();\n              var fl = {};\n\n              fileReader.onload = function () {\n                if (filename === 'config.json') {\n                  fl[filename] = fileReader.result;\n                } else {\n                  fl[filename] = new File([fileReader.result], filename);\n                }\n\n                resolve(fl);\n              };\n\n              if (filename === 'config.json') {\n                fileReader.readAsText(blob);\n              } else {\n                fileReader.readAsArrayBuffer(blob);\n              }\n\n            }, function (current, total) {\n\n            });\n          });\n        });\n\n        Promise.all(promises).then(function (resolvedFiles) {\n          var importedData = Object.assign.apply(Object, _toConsumableArray(resolvedFiles));\n          var config = importedData['config.json'];\n\n          if (!config) {\n            alert('no config');\n            document.getElementById('load-status').style.display = 'none';\n            document.getElementById('load').style.pointerEvents = 'auto';\n            document.getElementById('load').style.opacity = \"1\";\n            return;\n          }\n\n          var json = JSON.parse(config);\n          var loader = new THREE.ObjectLoader();\n          var cam = loader.parse(json.camera);\n\n          json.soundObjects.forEach(function (obj) {\n            var parsed = JSON.parse(obj);\n\n            var newObj = _this14.path.createObject(_this14, true);\n            newObj.fromJSON(obj, importedData);\n            _this14.setActiveObject(newObj);\n            _this14.isAddingObject = false;\n\n            // Trajectory\n            if (parsed.trajectory) {\n              _this14.path.points = parsed.trajectory.map(function (i) {return new THREE.Vector3(i.x, i.y, i.z);});\n              _this14.path.parentObject = newObj;\n              _this14.path.createObject(_this14, true);\n              newObj.calculateMovementSpeed();\n            }\n          });\n\n          json.soundZones.forEach(function (obj) {\n            var object = JSON.parse(obj);\n\n            // Fakes drawing for zone creation\n            _this14.path.points = object.points;\n\n            var newObj = _this14.path.createObject(_this14, true);\n            newObj.fromJSON(obj, importedData);\n\n            _this14.setActiveObject(newObj);\n            _this14.isAddingObject = false;\n          });\n\n          json.headObject.forEach(function (obj) {\n            var parsed = JSON.parse(obj);\n            _this14.setActiveObject(_this14.headObject);\n\n            // Clear previous head trajectory\n            _this14.headObject.clear();\n\n            // Create new head object\n            _this14.headObject = new _headobject2.default(_this14);\n            _this14.headObject.fromJSON(obj, importedData);\n            _this14.setActiveObject(_this14.headObject);\n            _this14.isAddingObject = false;\n\n            // Trajectory\n            if (parsed.trajectory) {\n              _this14.path.points = parsed.trajectory.map(function (i) {return new THREE.Vector3(i.x, i.y, i.z);});\n              _this14.path.parentObject = _this14.headObject;\n              _this14.path.createObject(_this14, true);\n              _this14.headObject.calculateMovementSpeed();\n            }\n          });\n\n          _this14.setActiveObject(null);\n          _this14.camera.threeCamera.copy(cam);\n          _this14.camera.threeCamera.updateProjectionMatrix();\n\n          document.getElementById('load-status').style.display = 'none';\n          document.getElementById('load').style.pointerEvents = 'auto';\n          document.getElementById('load').style.opacity = \"1\";\n        });\n      });\n    } }, { key: 'audio', set: function set(audio) {this._audio = audio;}, get: function get() {return this._audio;} }]);return Main;}();exports.default = Main;\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/js/app/main.js\n// module id = 35\n// module chunks = 0\n\n//# sourceURL=webpack:///./src/js/app/main.js?");

/***/ }),
/* 36 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("Object.defineProperty(exports, \"__esModule\", { value: true });var _createClass = function () {function defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if (\"value\" in descriptor) descriptor.writable = true;Object.defineProperty(target, descriptor.key, descriptor);}}return function (Constructor, protoProps, staticProps) {if (protoProps) defineProperties(Constructor.prototype, protoProps);if (staticProps) defineProperties(Constructor, staticProps);return Constructor;};}();var _helpers = __webpack_require__(2);var _helpers2 = _interopRequireDefault(_helpers);\nvar _config = __webpack_require__(1);var _config2 = _interopRequireDefault(_config);function _interopRequireDefault(obj) {return obj && obj.__esModule ? obj : { default: obj };}function _classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError(\"Cannot call a class as a function\");}}var\n\nSoundSearch = function () {\n    function SoundSearch(main) {_classCallCheck(this, SoundSearch);\n        this.app = main;\n        this.container = document.getElementById('SoundSearch');\n        this.container.style.display = 'none';\n\n        this.results = [];\n        this.searchTerm = \"\";\n        this.maxReturn = 5;\n        this.uris = {\n            base: 'https://freesound.org/apiv2',\n            textSearch: '/search/text/',\n            download: '/sounds/<sound_id>/download/',\n            query: '?query=',\n            fields: '&fields=id,name,url,duration,download,previews',\n            sort: '&sort=score', // score, downloads_desc, rating_desc\n            auth: '&token=poblNq6udgd9950X4KNLyuBKPuNxBA27mxZsqh2y' };\n\n        this.token = \"poblNq6udgd9950X4KNLyuBKPuNxBA27mxZsqh2y\";\n\n        this.isShowing = false;\n    }\n\n    // ------- showing/hiding the overall gui ---------- //\n    _createClass(SoundSearch, [{ key: 'display', value: function display()\n        {\n            // Show search bar\n            var div = document.createElement(\"div\");\n            div.className = \"search-bar\";\n            div.id = \"search-bar\";\n\n            var node = document.createElement('span');\n            node.onmousedown = this.mouseIsDown.bind(this);\n            node.onkeydown = this.typingInput.bind(this);\n\n            var input = document.createElement('input');\n            input.type = 'text';\n            input.placeholder = \"Search sounds on freesound.org\";\n            input.id = \"search-input\";\n            input.disabled = false;\n            if (this.searchTerm != \"\") {\n                input.value = this.searchTerm;\n            }\n            node.appendChild(input);\n\n            div.appendChild(node);\n\n            this.container.appendChild(div);\n            this.container.style.display = 'inline-block';\n            this.isShowing = true;\n\n            // If there are previous results, show them\n            if (this.results.length > 0) {\n                this.displayResults();\n            }\n\n            window.addEventListener('click', this.clickAway.bind(this), false);\n            document.getElementById('search-input').addEventListener('keyup', function (e) {\n                this.checkInputState(e);\n            }.bind(this), false);\n        } }, { key: 'hide', value: function hide()\n\n        {\n            // this.clearResults();\n            this.container.innerHTML = '';\n            this.container.style.display = 'none';\n            this.isShowing = false;\n\n            // Disable right clicks and re-enable other controls\n            this.app.controls.enableZoom();\n            this.app.controls.enablePan();\n            document.removeEventListener('contextmenu', this.pausecontextmenu, true);\n        } }, { key: 'clickAway', value: function clickAway(\n\n        e) {\n            // Check if user is clicking on search area\n            var onSearchResults = document.getElementById('search-results') ? document.getElementById('search-results').contains(e.target) : false;\n            var onSearchBtn = document.getElementById('search-clear-search-button') ? document.getElementById('search-clear-search-button').contains(e.target) : false;\n            var onSearchBar = document.getElementById('search-bar') ? document.getElementById('search-bar').contains(e.target) : false;\n\n            // If user is not clicking on any of the search bar areas, hide menu\n            if (!(onSearchResults || onSearchBtn || onSearchBar)) {\n                this.isShowing = true;\n                this.app.toggleSearchBar();\n            }\n        } }, { key: 'mouseIsDown', value: function mouseIsDown()\n\n        {\n            this.app.controls.disable();\n        } }, { key: 'typingInput', value: function typingInput(\n\n        e) {\n            var inputValue = e.target.value;\n\n            // Check for enter and that value is a number\n            if (e.keyCode == 13) {\n                this.getFreeSounds(inputValue);\n                this.app.controls.enable();\n                this.searchTerm = inputValue;\n            }\n        } }, { key: 'getFreeSounds', value: function getFreeSounds(\n\n        searchTerm) {var _this = this;\n            // Format request url\n            var data = \"\";\n            var requestURL = this.uris.base + this.uris.textSearch + this.uris.query + searchTerm + this.uris.fields + this.uris.sort + this.uris.auth;\n\n            // Send API request to freesound.org\n            var request = new XMLHttpRequest();\n            request.open(\"GET\", requestURL);\n            request.send();\n            request.onload = function () {\n                if (request.status === 200) {\n                    data = JSON.parse(request.response);\n                    _this.results = [];\n                    _this.getResults(data);\n                } else\n                {\n                    console.log(\"error \" + String(request.status) + \" \" + String(request.statusText));\n                }\n            };\n\n            return data;\n        } }, { key: 'getResults', value: function getResults(\n\n        data) {\n            // Store returned JSON data\n            var maxReturn = 5;\n            for (var i = 0; i < data.results.length; ++i) {\n                if (i < this.maxReturn) {\n                    this.results.push({\n                        id: data.results[i].id,\n                        name: data.results[i].name,\n                        url: data.results[i].url,\n                        duration: data.results[i].duration,\n                        download: data.results[i].download,\n                        previews: data.results[i].previews });\n\n                } else\n                {\n                    break;\n                }\n            }\n\n            this.displayResults();\n        } }, { key: 'displayResults', value: function displayResults()\n\n        {\n            var existingResult = document.getElementById(\"search-results\");\n            if (existingResult) {\n                existingResult.remove();\n            }\n\n            var div = document.createElement(\"div\");\n            div.id = \"search-results\";\n            for (var i = 0; i < this.results.length; ++i) {\n                // Add audio title and audio link\n                var node = document.createElement('p');\n                node.id = \"search-result\";\n                node.innerHTML = this.results[i].name;\n\n                var download = \"<a id='download-link' href='\" +\n                this.results[i].previews[\"preview-lq-mp3\"] +\n                \"' download='audio.mp3' target='_blank'>\" +\n                this.results[i].name + \"</a>\";\n                node.innerHTML = download;\n\n                // Add audio player\n                var previewPlayer = document.createElement('div');\n                var audioHTML = \"<audio controls><source src='\" + this.results[i].previews[\"preview-lq-mp3\"] + \"' type='audio/mp3'></audio>\";\n                previewPlayer.id = \"audio-player\";\n                previewPlayer.innerHTML = audioHTML;\n                node.appendChild(document.createElement('br'));\n                node.appendChild(previewPlayer);\n\n                div.appendChild(node);\n\n                // Enable right clicks and disable other controls\n                this.app.controls.disableZoom();\n                this.app.controls.disablePan();\n                document.addEventListener('contextmenu', this.pausecontextmenu, true);\n            }\n            if (this.results.length === 0) {\n                // Show no results if none found\n                var node = document.createElement('p');\n                node.innerHTML = \"No results found\";\n                node.className = 'search-result';\n                node.style.padding = \"0 0 10px 0\";\n                div.appendChild(node);\n\n                // Disable right clicks and re-enable other controls\n                this.app.controls.enableZoom();\n                this.app.controls.enablePan();\n                document.removeEventListener('contextmenu', this.pausecontextmenu, true);\n            }\n\n            this.container.appendChild(div);\n        }\n\n        // Remove any existing results\n    }, { key: 'clearResults', value: function clearResults() {\n            var existingResult = document.getElementById(\"search-results\");\n            if (existingResult) {\n                existingResult.remove();\n            }\n\n            this.results = [];\n            this.searchTerm = \"\";\n        }\n\n        // Clear results if there is no search item\n    }, { key: 'checkInputState', value: function checkInputState(e) {\n            if (e.target.value.length == 0) {\n                this.clearResults();\n            }\n        }\n\n        // Enable/disable right-clicks\n    }, { key: 'pausecontextmenu', value: function pausecontextmenu(event) {\n            event.stopPropagation();\n        } }]);return SoundSearch;}();exports.default = SoundSearch;\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/js/app/managers/SoundSearch.js\n// module id = 36\n// module chunks = 0\n\n//# sourceURL=webpack:///./src/js/app/managers/SoundSearch.js?");

/***/ }),
/* 37 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("Object.defineProperty(exports, \"__esModule\", { value: true });var _createClass = function () {function defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if (\"value\" in descriptor) descriptor.writable = true;Object.defineProperty(target, descriptor.key, descriptor);}}return function (Constructor, protoProps, staticProps) {if (protoProps) defineProperties(Constructor.prototype, protoProps);if (staticProps) defineProperties(Constructor, staticProps);return Constructor;};}();var _helpers = __webpack_require__(2);var _helpers2 = _interopRequireDefault(_helpers);\nvar _action = __webpack_require__(5);var _action2 = _interopRequireDefault(_action);\nvar _config = __webpack_require__(1);var _config2 = _interopRequireDefault(_config);\nvar _soundobject = __webpack_require__(4);var _soundobject2 = _interopRequireDefault(_soundobject);function _interopRequireDefault(obj) {return obj && obj.__esModule ? obj : { default: obj };}function _classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError(\"Cannot call a class as a function\");}}var\n\nGUIWindow = function () {\n\tfunction GUIWindow(main) {_classCallCheck(this, GUIWindow);\n\t\tthis.id = null; // uuid of displayed \"shape\" or \"containerObject\"\n\t\tthis.obj = null; // the object whose information is being displayed\n\t\tthis.stoRef = main.stoRef;\n\t\tthis.dbRef = main.dbRef;\n\t\tthis.roomCode = main.roomCode;\n\t\tthis.headKey = null;\n\t\tthis.listeners = [];\n\n\t\tthis.undoableActionStack = main.undoableActionStack;\n\n\t\tthis.app = main;\n\t\tthis.container = document.getElementById('guis');\n\t\tthis.isDisabled = false;\n\t\tthis.display();\n\n\t\t// add listeners for dragging parameters\n\t\tdocument.addEventListener('mousemove', this.drag.bind(this));\n\t\tdocument.addEventListener('mouseup', this.stopDragging.bind(this));\n\t\tthis.dragEvent = {};\n\n\t\tthis.typeEvent = {};\n\t\tthis.clickEvent = {};\n\t}_createClass(GUIWindow, [{ key: 'updateFirebaseDetails', value: function updateFirebaseDetails(\n\n\t\tdbRef, stoRef, headKey, roomCode) {\n\t\t\tthis.headKey = headKey;\n\t\t\tthis.stoRef = stoRef;\n\t\t\tthis.dbRef = dbRef;\n\t\t\tthis.roomCode = roomCode;\n\t\t}\n\n\t\t// ------- showing/hiding the overall gui ---------- //\n\t}, { key: 'display', value: function display(\n\t\tobj) {\n\t\t\tif (obj) {\n\t\t\t\tthis.show(obj);\n\t\t\t} else\n\t\t\t{\n\t\t\t\tthis.hide();\n\t\t\t\tthis.id = this.obj = null;\n\t\t\t}\n\t\t}\n\n\t\t// disable/enable pointer events\n\t}, { key: 'disable', value: function disable() {\n\t\t\tthis.isDisabled = true;\n\t\t} }, { key: 'enable', value: function enable()\n\t\t{\n\t\t\tthis.isDisabled = false;\n\t\t}\n\n\t\t// clear gui and listeners\n\t}, { key: 'clear', value: function clear() {\n\t\t\tthis.container.innerHTML = '';\n\t\t\tthis.listeners = [];\n\t\t}\n\n\t\t// show gui\n\t}, { key: 'show', value: function show(obj) {\n\t\t\tif (!obj) {return;}\n\n\t\t\t// get details of object\n\t\t\tif (obj.type == 'SoundObject' || obj.type == 'SoundTrajectory' && obj.parentSoundObject.type == 'SoundObject') {\n\t\t\t\tif (obj.type == 'SoundTrajectory') {\n\t\t\t\t\tobj = obj.parentSoundObject;\n\t\t\t\t}\n\t\t\t\tif (this.id !== obj.containerObject.uuid) {\n\t\t\t\t\t// init a new gui\n\t\t\t\t\tthis.clear();\n\t\t\t\t\tthis.id = obj.containerObject.uuid;\n\t\t\t\t\tthis.obj = obj;\n\t\t\t\t\tthis.initObjectGUI(obj);\n\t\t\t\t} else\n\t\t\t\t{\n\t\t\t\t\t// read and update object parameters\n\t\t\t\t\tthis.updateObjectGUI(obj);\n\t\t\t\t}\n\t\t\t} else if (obj.type == 'SoundZone') {\n\t\t\t\tif (this.id !== obj.shape.uuid) {\n\t\t\t\t\t// init a new gui\n\t\t\t\t\tthis.clear();\n\t\t\t\t\tthis.id = obj.shape.uuid;\n\t\t\t\t\tthis.obj = obj;\n\t\t\t\t\tthis.initSoundzoneGUI(obj);\n\t\t\t\t} else\n\t\t\t\t{\n\t\t\t\t\t// read and update object parameters\n\t\t\t\t\tthis.updateSoundzoneGUI(obj);\n\t\t\t\t}\n\t\t\t} else if (obj.type == 'HeadObject' || obj.type == 'SoundTrajectory' && obj.parentSoundObject.type == 'HeadObject') {\n\t\t\t\tif (obj.type == 'SoundTrajectory') {\n\t\t\t\t\tobj = obj.parentSoundObject;\n\t\t\t\t}\n\t\t\t\tif (obj.containerObject.position && obj.rotation) {\n\t\t\t\t\tif (this.id !== obj.uuid) {\n\t\t\t\t\t\t// init a new gui\n\t\t\t\t\t\tthis.clear();\n\t\t\t\t\t\tthis.id = obj.uuid;\n\t\t\t\t\t\tthis.obj = obj;\n\t\t\t\t\t\tthis.initHeadGUI(obj);\n\t\t\t\t\t} else\n\t\t\t\t\t{\n\t\t\t\t\t\t// read and update object parameters\n\t\t\t\t\t\tthis.updateHeadGUI(obj);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tconsole.log('cannot show ui for type', obj.type);\n\t\t\t}\n\t\t\tthis.container.style.opacity = 1;\n\t\t\tthis.container.style.pointerEvents = this.isDisabled ? 'none' : 'auto';\n\t\t}\n\n\t\t// hide gui\n\t}, { key: 'hide', value: function hide() {\n\t\t\tthis.container.style.opacity = 0;\n\t\t\tthis.container.style.pointerEvents = 'none';\n\t\t\tthis.clear();\n\t\t}\n\n\t\t//----------- initiating objects --------- //\n\n\t\t// add navigation arrows\n\t}, { key: 'addNav', value: function addNav(e, elem) {\n\t\t\tvar arrow = document.createElement('div');\n\t\t\tarrow.className = 'nav nav-' + e.direction + ' nav-' + e.type;\n\n\t\t\tvar glyph = e.direction === 'left' ? '' : '';\n\n\t\t\tarrow.appendChild(document.createTextNode(glyph));\n\t\t\telem.appendChild(arrow);\n\t\t\tarrow.onclick = this.nav.bind(this, e);\n\t\t}\n\n\t\t// set up initial parameters for a sound object\n\t}, { key: 'initObjectGUI', value: function initObjectGUI(object) {var _this = this;\n\t\t\tvar mesh = object.containerObject;\n\t\t\tvar elem = this.addElem('OBJECT ' + (this.app.soundObjects.indexOf(object) + 1), true);\n\t\t\telem.style.fontWeight = 'bold';\n\t\t\tvar tempDb = this.dbRef;\n\t\t\tvar headKey = this.headKey;\n\t\t\tvar roomCode = this.roomCode;\n\t\t\tfunction setObjectPosition(component, dx) {\n\t\t\t\tvar destination = mesh.position.clone();\n\t\t\t\tdestination[component] += dx;\n\n\t\t\t\t// clamp y to [-300,300]\n\t\t\t\tdestination.y = Math.min(Math.max(-300, destination.y), 300);\n\n\t\t\t\t// move all child objects of the object\n\t\t\t\tobject.setPosition(destination);\n\n\t\t\t\tif (object.trajectory) {\n\t\t\t\t\t// move trajectory\n\t\t\t\t\tif (component === 'y') {\n\t\t\t\t\t\tobject.trajectory.splinePoints.forEach(function (pt) {\n\t\t\t\t\t\t\tpt[component] = Math.min(Math.max(-300, pt[component] + dx), 300);\n\t\t\t\t\t\t});\n\t\t\t\t\t\tobject.trajectory.updateTrajectory();\n\t\t\t\t\t} else\n\t\t\t\t\t{\n\t\t\t\t\t\tobject.trajectory.objects.forEach(function (obj) {\n\t\t\t\t\t\t\tobj.position[component] += dx;\n\t\t\t\t\t\t});\n\t\t\t\t\t\tobject.trajectory.splinePoints.forEach(function (pt) {\n\t\t\t\t\t\t\tpt[component] += dx;\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (roomCode != null) {\n\t\t\t\t\ttempDb.child('objects').child(object.containerObject.name).update({\n\t\t\t\t\t\tposition: destination,\n\t\t\t\t\t\tlastEdit: headKey });\n\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction changeAudioTime(dx) {\n\t\t\t\tif (object.omniSphere.sound && object.omniSphere.sound.state) {\n\t\t\t\t\tif (!object.omniSphere.sound.state.isAudioPaused) {\n\t\t\t\t\t\tobject.stopSound();\n\t\t\t\t\t}\n\t\t\t\t\tobject.omniSphere.sound.state.isChangingAudioTime = true;\n\n\t\t\t\t\t// Value sound be between 0 and duration of audio\n\t\t\t\t\tvar max = object.omniSphere.sound.state.duration;\n\t\t\t\t\tvar time = Math.max(Math.min(Math.floor(object.omniSphere.sound.state.currentTime + dx), max), 0);\n\n\t\t\t\t\t// Set current time and update paused at time\n\t\t\t\t\tobject.omniSphere.sound.state.currentTime = time;\n\t\t\t\t\tobject.omniSphere.sound.state.pausedAt = time * 1000;\n\n\t\t\t\t\t// Play/pause depending on global play/pause status\n\t\t\t\t\tif (object.userSetPlay) {\n\t\t\t\t\t\tobject.playSound();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction audioPlayPause() {\n\t\t\t\tif (object.omniSphere.sound && object.omniSphere.sound.state) {\n\t\t\t\t\tif (object.omniSphere.sound.state.isAudioPaused) {\n\t\t\t\t\t\tobject.playSound(true);\n\t\t\t\t\t\tobject.userSetPlay = true;\n\t\t\t\t\t} else\n\t\t\t\t\t{\n\t\t\t\t\t\tobject.stopSound(true);\n\t\t\t\t\t\tobject.userSetPlay = false;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction changeVolume(dx) {\n\t\t\t\tif (object.omniSphere.sound && object.omniSphere.sound.volume) {\n\t\t\t\t\t// clamp value to (0.05, 2)\n\t\t\t\t\tvar vol = Math.max(Math.min(object.omniSphere.sound.volume.gain.value + dx / 50, 2), 0.05);\n\t\t\t\t\tobject.omniSphere.sound.volume.gain.value = vol;\n\t\t\t\t\tobject.changeRadius(true);\n\t\t\t\t\tif (roomCode != null && object.isAddingSound) {\n\t\t\t\t\t\tobject.objCache.volume = vol;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.addParameter({\n\t\t\t\tproperty: 'File',\n\t\t\t\tvalue: object.omniSphere.sound ? object.omniSphere.sound.name.split('/').pop() : 'None',\n\t\t\t\ttype: 'file-input',\n\t\t\t\tdisplay: object.omniSphere.sound,\n\t\t\t\tevents: [{ type: 'click', callback: this.addSound.bind(this) }] },\n\t\t\telem).id = \"omnisphere-sound-loader\";\n\n\t\t\tthis.addParameter({\n\t\t\t\tproperty: 'Time',\n\t\t\t\tvalue: object.omniSphere.sound ? this.convertTime(object.omniSphere.sound.state.currentTime) : '0:00',\n\t\t\t\ttype: 'time',\n\t\t\t\tcls: 'time',\n\t\t\t\tbind: changeAudioTime,\n\t\t\t\tbindAdditional: audioPlayPause },\n\t\t\telem);\n\n\t\t\tthis.addParameter({\n\t\t\t\tproperty: 'Volume',\n\t\t\t\tvalue: object.omniSphere.sound && object.omniSphere.sound.volume ? object.omniSphere.sound.volume.gain.value : 'N/A',\n\t\t\t\ttype: 'number',\n\t\t\t\tcls: 'volume',\n\t\t\t\tbind: changeVolume },\n\t\t\telem);\n\n\t\t\t/* global object parameters */\n\t\t\tvar gElem = document.createElement('div');\n\t\t\tgElem.id = \"object-globals\";\n\t\t\telem.appendChild(gElem);\n\t\t\tgElem.style.display = this.app.isEditingObject ? 'none' : 'block';\n\n\t\t\tthis.addParameter({\n\t\t\t\tproperty: 'Position X',\n\t\t\t\tvalue: Number(mesh.position.x.toFixed(2)),\n\t\t\t\ttype: 'number',\n\t\t\t\tcls: 'x',\n\t\t\t\tbind: setObjectPosition.bind(this, \"x\") },\n\t\t\tgElem);\n\n\t\t\tthis.addParameter({\n\t\t\t\tproperty: 'Position Y',\n\t\t\t\tvalue: Number(mesh.position.z.toFixed(2)),\n\t\t\t\ttype: 'number',\n\t\t\t\tcls: 'z',\n\t\t\t\tbind: setObjectPosition.bind(this, \"z\") },\n\t\t\tgElem);\n\n\t\t\tthis.addParameter({\n\t\t\t\tproperty: 'Altitude',\n\t\t\t\tvalue: Number(mesh.position.y.toFixed(2)),\n\t\t\t\ttype: 'number',\n\t\t\t\tcls: 'y',\n\t\t\t\tbind: setObjectPosition.bind(this, \"y\") },\n\t\t\tgElem);\n\n\t\t\tvar guiHeight = 0;\n\t\t\t// insert cone window\n\t\t\tobject.cones.forEach(function (cone) {\n\t\t\t\tvar elem = _this.addCone(cone);\n\t\t\t\tguiHeight += elem.scrollHeight;\n\t\t\t});\n\n\t\t\t// \"add cone\" dialog\n\t\t\tvar addConeElem = this.addParameter({\n\t\t\t\tvalue: 'ADD CONE',\n\t\t\t\tbutton: true,\n\t\t\t\thasCones: object.cones.length > 0,\n\t\t\t\thasTrajectory: object.trajectory != null,\n\t\t\t\tevents: [{\n\t\t\t\t\ttype: 'click',\n\t\t\t\t\tcallback: this.addSound.bind(this) }] });\n\n\n\t\t\taddConeElem.id = 'add-cone';\n\n\t\t\tif (object.trajectory) {\n\t\t\t\tvar _elem = this.addTrajectory(object);\n\t\t\t} else\n\t\t\t{\n\t\t\t\tvar _elem2 = this.addTrajectoryDialog();\n\t\t\t}\n\n\t\t\tthis.addNav({ type: \"object\", direction: \"left\" }, elem);\n\t\t\tthis.addNav({ type: \"object\", direction: \"right\" }, elem);\n\t\t\tguiHeight = elem.scrollHeight + 35;\n\n\t\t\tif (object.cones.length > 0) {\n\t\t\t\t// addButton is initialized in addCone\n\t\t\t\taddConeElem.style.zIndex = \"20\";\n\t\t\t\taddConeElem.style.position = \"absolute\";\n\t\t\t\taddConeElem.classList.add('add-cone-object-view');\n\t\t\t\taddConeElem.firstChild.style.padding = '1.5% 8px';\n\t\t\t\tif (this.app.isEditingObject) {\n\t\t\t\t\taddConeElem.style.top = \"167.5px\";\n\t\t\t\t} else {\n\t\t\t\t\taddConeElem.style.top = \"228.51px\";\n\t\t\t\t}\n\t\t\t}\n\n\t\t}\n\n\t\t// \"add trajectory\" dialog\n\t}, { key: 'addTrajectoryDialog', value: function addTrajectoryDialog() {\n\t\t\tvar addTrajectoryElem = this.addParameter({\n\t\t\t\tvalue: 'ADD TRAJECTORY',\n\t\t\t\tbutton: true,\n\t\t\t\tevents: [{\n\t\t\t\t\ttype: 'click',\n\t\t\t\t\tcallback: this.app.toggleAddTrajectory.bind(this.app, true) }] });\n\n\n\t\t\taddTrajectoryElem.id = 'add-trajectory';\n\t\t\treturn addTrajectoryElem;\n\t\t}\n\n\t\t// set up initial parameters for a sound object cone\n\t}, { key: 'addCone', value: function addCone(cone) {var isVisible = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : true;\n\t\t\t// move add cone button over cone window\n\t\t\tvar addButton = document.getElementById('add-cone');\n\t\t\tif (addButton) {\n\t\t\t\taddButton.style.zIndex = \"20\";\n\t\t\t\taddButton.style.position = \"absolute\";\n\t\t\t\t// addButton.style.left = \"26.5%\";\n\n\t\t\t}\n\n\t\t\t// called every single time the object is clicked\n\t\t\tvar elem = this.addElem('', false, document.getElementById('add-cone'));\n\t\t\telem.id = 'cone-' + cone.id;\n\t\t\telem.className = 'cone';\n\t\t\tif (!isVisible) {\n\t\t\t\telem.style.display = 'none';\n\t\t\t}\n\n\t\t\t// set bg color\n\t\t\t// let hoverColor = cone.hoverColor();\n\t\t\t// console.log(\"get HSL: \", hoverColor.getHSL());\n\t\t\tvar color = cone.hoverColor();\n\t\t\tcolor.getHSL(cone.hoverColor());\n\n\t\t\tcolor.h *= 360;\n\t\t\tcolor.s *= 100;\n\t\t\tcolor.l = Math.max(color.l * 100, 70);\n\t\t\telem.style.backgroundColor = 'hsl(' + color.h + ',' + color.s + '%,' + color.l + '%)';\n\n\n\t\t\tvar object = this.obj;\n\t\t\tvar headKey = this.headKey;\n\t\t\tvar roomCode = this.roomCode;\n\n\t\t\tfunction changeAudioTime(dx) {\n\t\t\t\tif (cone.sound && cone.sound.state) {\n\t\t\t\t\tif (!cone.sound.state.isAudioPaused) {\n\t\t\t\t\t\tobject.stopConeSound(cone);\n\t\t\t\t\t}\n\t\t\t\t\tcone.sound.state.isChangingAudioTime = true;\n\n\t\t\t\t\t// Value sound be between 0 and duration of audio\n\t\t\t\t\tvar max = cone.sound.state.duration;\n\t\t\t\t\tvar time = Math.max(Math.min(Math.floor(cone.sound.state.currentTime + dx), max), 0);\n\n\t\t\t\t\t// Set current time and update paused at time\n\t\t\t\t\tcone.sound.state.currentTime = time;\n\t\t\t\t\tcone.sound.state.pausedAt = time * 1000;\n\n\t\t\t\t\t// Play/pause depending on global play/pause status\n\t\t\t\t\tif (cone.userSetPlay) {\n\t\t\t\t\t\tobject.playConeSound(cone);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction audioPlayPause() {\n\t\t\t\tif (cone.sound && cone.sound.state) {\n\t\t\t\t\tif (cone.sound.state.isAudioPaused) {\n\t\t\t\t\t\tobject.playConeSound(cone, true);\n\t\t\t\t\t\tcone.userSetPlay = true;\n\t\t\t\t\t} else\n\t\t\t\t\t{\n\t\t\t\t\t\tobject.stopConeSound(cone, true);\n\t\t\t\t\t\tcone.userSetPlay = false;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction changeVolume(dx) {\n\t\t\t\tif (cone.sound && cone.sound.volume) {\n\n\t\t\t\t\t// clamp value to (0.05, 2)\n\t\t\t\t\tvar volume = Math.max(Math.min(cone.sound.volume.gain.value + dx / 50, 2), 0.05);\n\n\t\t\t\t\tif (volume !== cone.sound.volume.gain.value) {\n\t\t\t\t\t\t// modify cone length\n\t\t\t\t\t\tcone.sound.volume.gain.value = volume;\n\t\t\t\t\t\tobject.changeLength(cone);\n\t\t\t\t\t\tif (roomCode != null) {\n\t\t\t\t\t\t\tif (object.finishUploadingSound) {\n\t\t\t\t\t\t\t\tvar updates = {\n\t\t\t\t\t\t\t\t\tvolume: volume,\n\t\t\t\t\t\t\t\t\tlastEdit: headKey };\n\n\t\t\t\t\t\t\t\tobject.dbRef.child('objects').child(object.containerObject.name).child('cones').child(cone.uuid).update(updates);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction changeSpread(dx) {\n\t\t\t\tif (cone.sound && cone.sound.spread) {\n\t\t\t\t\t// clamp value to (0.05,1)\n\t\t\t\t\tvar spread = Math.max(Math.min(cone.sound.spread + dx / 100, 1), 0.05);\n\n\t\t\t\t\tif (spread !== cone.sound.spread) {\n\t\t\t\t\t\t// modify cone width\n\t\t\t\t\t\tcone.sound.spread = spread;\n\t\t\t\t\t\tobject.changeWidth(cone);\n\t\t\t\t\t}\n\t\t\t\t\tif (roomCode != null) {\n\t\t\t\t\t\tif (object.finishUploadingSound) {\n\t\t\t\t\t\t\tvar updates = {\n\t\t\t\t\t\t\t\tspread: spread,\n\t\t\t\t\t\t\t\tlastEdit: headKey };\n\n\t\t\t\t\t\t\tobject.dbRef.child('objects').child(object.containerObject.name).child('cones').child(cone.uuid).update(updates);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction setConeRotation(component, dx) {\n\t\t\t\t// clamp lat/long values\n\t\t\t\tvar lat = cone.lat || 0.0001;\n\t\t\t\tvar long = cone.long || 0.0001;\n\n\t\t\t\tif (component === \"lat\") {\n\t\t\t\t\tif (long > 0) {\n\t\t\t\t\t\tlat -= dx * Math.PI / 180;\n\t\t\t\t\t} else\n\t\t\t\t\t{\n\t\t\t\t\t\tlat += dx * Math.PI / 180;\n\t\t\t\t\t}\n\t\t\t\t\tif (lat > Math.PI) {\n\t\t\t\t\t\tlat = Math.PI - lat;\n\t\t\t\t\t\tlong = -long;\n\t\t\t\t\t} else\n\t\t\t\t\tif (lat < -Math.PI) {\n\t\t\t\t\t\tlat = Math.PI - lat;\n\t\t\t\t\t\tlong = -long;\n\t\t\t\t\t}\n\t\t\t\t} else\n\t\t\t\t{\n\t\t\t\t\tlong += dx * Math.PI / 180;\n\t\t\t\t\tif (long > Math.PI * 2) {\n\t\t\t\t\t\tlong -= Math.PI * 2;\n\t\t\t\t\t} else\n\t\t\t\t\tif (long < -Math.PI * 2) {\n\t\t\t\t\t\tlong += Math.PI * 2;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tobject.pointConeMagic(cone, lat, long);\n\t\t\t\tif (roomCode != null) {\n\t\t\t\t\tif (object.finishUploadingSound) {\n\t\t\t\t\t\tvar updates = {\n\t\t\t\t\t\t\tlatitude: lat,\n\t\t\t\t\t\t\tlongitude: long,\n\t\t\t\t\t\t\tlastEdit: headKey };\n\n\t\t\t\t\t\tobject.dbRef.child('objects').child(object.containerObject.name).child('cones').child(cone.uuid).update(updates);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tvar deleteCone = this.addParameter({\n\t\t\t\tvalue: 'Delete',\n\t\t\t\tbutton: true,\n\t\t\t\tevents: [{\n\t\t\t\t\ttype: 'click',\n\t\t\t\t\tcallback: function () {\n\t\t\t\t\t\tif (this.roomCode != null) {\n\t\t\t\t\t\t\tobject.dbRef.child('objects').child(object.containerObject.name).child('cones').child(cone.uuid).update({\n\t\t\t\t\t\t\t\tsound: null,\n\t\t\t\t\t\t\t\tlastEdit: headKey });\n\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthis.app.undoableActionStack.push(new _action2.default(this.app.activeObject, 'removeCone'));\n\t\t\t\t\t\tthis.app.undoableActionStack[this.app.undoableActionStack.length - 1].secondary = this.app.interactiveCone;\n\t\t\t\t\t\tthis.app.removeCone(this.obj, cone);\n\t\t\t\t\t\tif (this.app.interactiveCone == null) {\n\t\t\t\t\t\t\tvar _addButton = document.getElementById(\"add-cone\");\n\t\t\t\t\t\t\t_addButton.style.position = 'relative';\n\t\t\t\t\t\t\t_addButton.style.removeProperty('top');\n\t\t\t\t\t\t\t_addButton.firstChild.style.removeProperty('padding');\n\t\t\t\t\t\t\t_addButton.classList.remove('add-cone-object-view');\n\t\t\t\t\t\t}\n\t\t\t\t\t}.bind(this) }] },\n\n\t\t\telem);\n\t\t\tdeleteCone.id = 'delete-cone';\n\n\t\t\tthis.addParameter({\n\t\t\t\tproperty: 'File',\n\t\t\t\tvalue: cone.filename,\n\t\t\t\tinnercls: 'cone',\n\t\t\t\tevents: [{\n\t\t\t\t\ttype: 'click',\n\t\t\t\t\tcallback: this.addSound.bind(this) }] },\n\n\t\t\telem);\n\t\t\tthis.addParameter({\n\t\t\t\tproperty: 'Time',\n\t\t\t\tvalue: this.convertTime(cone.sound.state.currentTime),\n\t\t\t\ttype: 'time',\n\t\t\t\tcls: 'time',\n\t\t\t\tbind: changeAudioTime,\n\t\t\t\tbindAdditional: audioPlayPause },\n\t\t\telem);\n\t\t\tthis.addParameter({\n\t\t\t\tproperty: 'Volume',\n\t\t\t\tvalue: Number(cone.sound.volume.gain.value.toFixed(3)),\n\t\t\t\ttype: 'number',\n\t\t\t\tcls: 'volume',\n\t\t\t\t// suffix: ' dB',\n\t\t\t\tbind: changeVolume },\n\t\t\telem);\n\t\t\tthis.addParameter({\n\t\t\t\tproperty: 'Spread',\n\t\t\t\tvalue: Number(cone.sound.spread.toFixed(3)),\n\t\t\t\ttype: 'number',\n\t\t\t\tcls: 'spread',\n\t\t\t\tbind: changeSpread },\n\t\t\telem);\n\t\t\tthis.addParameter({\n\t\t\t\tproperty: 'Longitude',\n\t\t\t\tvalue: Math.round(cone.long * 180 / Math.PI),\n\t\t\t\ttype: 'number',\n\t\t\t\tcls: 'long',\n\t\t\t\tsuffix: '',\n\t\t\t\tbind: setConeRotation.bind(this, \"long\") },\n\t\t\telem);\n\t\t\tthis.addParameter({\n\t\t\t\tproperty: 'Latitude',\n\t\t\t\tvalue: Math.round(cone.lat * 180 / Math.PI),\n\t\t\t\ttype: 'number',\n\t\t\t\tcls: 'lat',\n\t\t\t\tsuffix: '',\n\t\t\t\tbind: setConeRotation.bind(this, \"lat\") },\n\t\t\telem);\n\n\t\t\t/* Cone navigation */\n\t\t\tthis.addNav({ type: \"cone\", direction: \"left\" }, elem);\n\t\t\tthis.addNav({ type: \"cone\", direction: \"right\" }, elem);\n\t\t\t//let baseParams = document.getElementsByClassName('baseParam');\n\t\t\tvar baseParams = elem;\n\t\t\tvar guiHeight = document.getElementById('guis');\n\t\t\t// baseParams.length > 0\n\t\t\tif (guiHeight) {\n\t\t\t\tguiHeight = guiHeight.scrollHeight + 5;\n\t\t\t\tbaseParams = guiHeight - (elem.scrollHeight + 5) - 25;\n\t\t\t\t//baseParams = baseParams[0].scrollHeight;\n\n\t\t\t\tif (addButton && !addButton.classList.contains('add-cone-object-view')) {\n\t\t\t\t\taddButton.classList.add('add-cone-object-view');\n\t\t\t\t\taddButton.firstChild.style.padding = '1.5% 8px';\n\t\t\t\t}\n\t\t\t}\n\t\t\t// let button = document.querySelectorAll(\"#delete-cone > span\");\n\t\t\tvar deleteCones = document.querySelectorAll(\"#delete-cone\");\n\t\t\tvar button = deleteCones[deleteCones.length - 1].firstChild;\n\t\t\tbutton.style.fontWeight = \"normal\";\n\t\t\tbutton.style.backgroundColor = \"#f0f0f0\";\n\t\t\tbutton.style.color = \"#5d5e5d\";\n\t\t\tbutton.style.borderRadius = \"6px\";\n\t\t\tdeleteCones[deleteCones.length - 1].style.padding = \"0%\";\n\t\t\treturn elem;\n\t\t}\n\n\t\t// remove cone parameter window\n\t}, { key: 'removeCone', value: function removeCone(cone) {\n\t\t\tvar cones = this.container.getElementsByClassName('cone');\n\t\t\tfor (var i = 0; i < cones.length; ++i) {\n\t\t\t\tif (cones[i].id.split('-').pop() == cone.id) {\n\t\t\t\t\tcones[i].parentNode.removeChild(cones[i]);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// set up initial parameters for a sound object trajectory path\n\t}, { key: 'addTrajectory', value: function addTrajectory(object) {\n\t\t\tvar elem = this.addElem('TRAJECTORY');\n\t\t\telem.id = 'trajectory';\n\t\t\tvar dbRef = this.dbRef;\n\n\t\t\tfunction changePositionOnTrajectory(dx) {\n\t\t\t\tif (object.trajectory) {\n\t\t\t\t\tvar position = Math.max(Math.min(object.trajectoryClock + dx / 100, 1), 0);\n\t\t\t\t\tobject.trajectoryClock = position;\n\t\t\t\t\t// temporarily set speed to 0 while changing and restore back afterwards\n\t\t\t\t\tif (object.roomCode) {\n\t\t\t\t\t\tobject.dbRef.child('objects').child(object.containerObject.name).update({\n\t\t\t\t\t\t\ttrajectoryPosition: position });\n\n\t\t\t\t\t}\n\t\t\t\t\tif (object.movementSpeed != 0) {\n\t\t\t\t\t\tobject.oldTrajectorySpeed = object.movementSpeed;\n\t\t\t\t\t\tobject.movementSpeed = 0;\n\t\t\t\t\t\tobject.calculateMovementSpeed();\n\t\t\t\t\t\tobject.updateSpeed(object.movementSpeed);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tvar deleteTrajectory = this.addParameter({\n\t\t\t\tvalue: 'Delete',\n\t\t\t\tbutton: true,\n\t\t\t\tevents: [{\n\t\t\t\t\ttype: 'click',\n\t\t\t\t\tcallback: function () {\n\t\t\t\t\t\tthis.app.removeSoundTrajectory(object.trajectory, \"gui\");\n\t\t\t\t\t\tvar trajectory = Object.assign(object.trajectory, trajectory);\n\t\t\t\t\t\tthis.app.undoableActionStack.push(new _action2.default(trajectory, 'removeSoundTrajectory'));\n\t\t\t\t\t\tobject.trajectory = null;\n\t\t\t\t\t\tif (this.roomCode != null) {\n\t\t\t\t\t\t\tif (object.type == 'SoundObject') {\n\t\t\t\t\t\t\t\tthis.dbRef.child('objects').child(object.containerObject.name).update({\n\t\t\t\t\t\t\t\t\tposition: object.containerObject.position,\n\t\t\t\t\t\t\t\t\ttrajectory: null,\n\t\t\t\t\t\t\t\t\tlastEdit: this.headKey });\n\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tthis.dbRef.child('users').child(this.headKey).update({\n\t\t\t\t\t\t\t\t\tposition: object.containerObject.position,\n\t\t\t\t\t\t\t\t\ttrajectory: null });\n\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tobject.trajectoryClock = _config2.default.soundObject.defaultMovementSpeed;\n\t\t\t\t\t\telem.parentNode.removeChild(elem);\n\t\t\t\t\t\tvar guiHeight = document.getElementById('guis').scrollHeight;\n\t\t\t\t\t\tvar baseParams = document.getElementsByClassName('baseParam')[0].scrollHeight;\n\t\t\t\t\t\tvar addButton = document.getElementById('add-cone');\n\t\t\t\t\t\tif (object.type == 'SoundObject' && addButton.style.position == \"absolute\") {\n\t\t\t\t\t\t\tvar _addButton2 = document.getElementById('add-cone');\n\t\t\t\t\t\t\tif (_addButton2.style.position == \"absolute\") {\n\t\t\t\t\t\t\t\tif (this.app.isEditingObject) {\n\t\t\t\t\t\t\t\t\t_addButton2.style.top = \"167.5px\";\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t_addButton2.style.top = \"228.51px\";\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthis.addTrajectoryDialog();\n\t\t\t\t\t}.bind(this) }] },\n\n\t\t\telem);\n\t\t\tdeleteTrajectory.id = 'delete-trajectory';\n\t\t\tvar button = document.querySelector(\"#delete-trajectory > span\");\n\t\t\tbutton.style.fontWeight = \"normal\";\n\t\t\tbutton.style.backgroundColor = \"#f0f0f0\";\n\t\t\tbutton.style.color = \"#5d5e5d\";\n\t\t\tbutton.style.borderRadius = \"6px\";\n\t\t\tbutton.style.margin = '0 36% 4% 36%';\n\t\t\tdocument.getElementById('delete-trajectory').style.padding = \"0%\";\n\n\n\t\t\tthis.addParameter({\n\t\t\t\tproperty: 'Speed',\n\t\t\t\tvalue: object.movementSpeed,\n\t\t\t\t// suffix:' m/s',\n\t\t\t\ttype: 'number',\n\t\t\t\tcls: 'speed',\n\t\t\t\tbind: function bind(dx) {\n\t\t\t\t\tvar rawSpeed = object.movementSpeed + dx / 10;\n\t\t\t\t\tobject.movementSpeed = Math.min(Math.max(-100, rawSpeed), 100);\n\t\t\t\t\tobject.calculateMovementSpeed();\n\t\t\t\t\tobject.updateSpeed(rawSpeed);\n\t\t\t\t} },\n\t\t\telem);\n\n\t\t\tthis.addParameter({\n\t\t\t\tproperty: 'Position',\n\t\t\t\tvalue: object.trajectoryClock,\n\t\t\t\ttype: 'number',\n\t\t\t\tcls: 'position',\n\t\t\t\tbind: changePositionOnTrajectory,\n\t\t\t\tevents: [{ type: 'mouseup', callback: this.restoreMovementSpeed.bind(this, object) },\n\t\t\t\t{ type: 'click', callback: this.restoreMovementSpeed.bind(this, object) }] },\n\t\t\telem);\n\n\t\t\treturn elem;\n\t\t} }, { key: 'restoreMovementSpeed', value: function restoreMovementSpeed(\n\n\t\tobject) {\n\t\t\tif (object.trajectory && object.oldTrajectorySpeed) {\n\t\t\t\tobject.movementSpeed = object.oldTrajectorySpeed;\n\t\t\t\tobject.calculateMovementSpeed();\n\t\t\t\tobject.updateSpeed(object.movementSpeed);\n\t\t\t\tobject.oldTrajectorySpeed = null;\n\t\t\t}\n\t\t} // end of restoreMovementSpeed\n\t}, { key: 'disableGlobalParameters', value: function disableGlobalParameters()\n\t\t{\n\t\t\tvar global = document.getElementById('object-globals');\n\t\t\tif (global) {\n\t\t\t\tglobal.style.display = 'none';\n\t\t\t}\n\t\t} }, { key: 'enableGlobalParameters', value: function enableGlobalParameters()\n\t\t{\n\t\t\tvar global = document.getElementById('object-globals');\n\t\t\tif (global) {\n\t\t\t\tglobal.style.display = 'block';\n\t\t\t}\n\t\t}\n\n\t\t// set up initial parameters for a soundzone\n\t}, { key: 'initSoundzoneGUI', value: function initSoundzoneGUI(zone) {\n\t\t\tvar tempDb = this.dbRef;\n\t\t\tvar headKey = this.headKey;\n\t\t\tvar elem = this.addElem('Zone ' + (this.app.soundZones.indexOf(zone) + 1), false);\n\t\t\tvar roomCode = this.roomCode;\n\n\n\t\t\tfunction setZonePosition(component, dx) {\n\t\t\t\tzone.containerObject.position[component] += dx;\n\t\t\t\tif (roomCode != null) {\n\t\t\t\t\ttempDb.child('zones').child(zone.containerObject.name).update({\n\t\t\t\t\t\tposition: zone.containerObject.position,\n\t\t\t\t\t\tlastEdit: headKey });\n\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction setZoneRotation(dx) {\n\t\t\t\tvar rotation = zone.containerObject.rotation.y + dx * Math.PI / 180;\n\n\t\t\t\tif (rotation < Math.PI) {rotation += Math.PI * 2;}\n\t\t\t\tif (rotation > Math.PI) {rotation -= Math.PI * 2;}\n\t\t\t\tzone.containerObject.rotation.y = rotation;\n\t\t\t\tif (roomCode != null) {\n\t\t\t\t\tif (!zone.isAddingSound) {\n\t\t\t\t\t\ttempDb.child('zones').child(zone.containerObject.name).update({\n\t\t\t\t\t\t\trotation: rotation,\n\t\t\t\t\t\t\tlastEdit: headKey });\n\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction changeAudioTime(dx) {\n\t\t\t\tif (zone.sound && zone.sound.state) {\n\t\t\t\t\tzone.stopSound();\n\t\t\t\t\tzone.isChangingAudioTime = true;\n\n\t\t\t\t\t// Value sound be between 0 and duration of audio\n\t\t\t\t\tvar max = zone.sound.state.duration;\n\t\t\t\t\tvar time = Math.max(Math.min(Math.floor(zone.sound.state.currentTime + dx), max), 0);\n\n\t\t\t\t\t// Set current time and update paused at time\n\t\t\t\t\tzone.sound.state.currentTime = time;\n\t\t\t\t\tzone.sound.state.pausedAt = time * 1000;\n\n\t\t\t\t\t// Play/pause depending on global play/pause status\n\t\t\t\t\tif (zone.userSetPlay) {\n\t\t\t\t\t\tzone.playSound();\n\t\t\t\t\t}\n\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction audioPlayPause() {\n\t\t\t\tif (zone.sound && zone.sound.state) {\n\t\t\t\t\tif (zone.sound.state.isAudioPaused) {\n\t\t\t\t\t\tzone.playSound(true);\n\t\t\t\t\t\tzone.userSetPlay = true;\n\t\t\t\t\t} else\n\t\t\t\t\t{\n\t\t\t\t\t\tzone.stopSound(true);\n\t\t\t\t\t\tzone.userSetPlay = false;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction changeVolume(dx) {\n\t\t\t\tif (zone.sound) {\n\t\t\t\t\tvar volume = Math.max(Math.min(zone.sound.source.volume.gain.value + dx / 50, 2), 0.0);\n\t\t\t\t\tzone.shape.material.opacity = _helpers2.default.mapRange(volume, 0, 2, 0.05, 0.35);\n\t\t\t\t\tzone.volume = volume;\n\t\t\t\t\tzone.sound.source.volume.gain.value = volume;\n\t\t\t\t\tif (roomCode != null) {\n\t\t\t\t\t\tif (!zone.isAddingSound) {\n\t\t\t\t\t\t\ttempDb.child('zones').child(zone.containerObject.name).update({\n\t\t\t\t\t\t\t\tvolume: volume,\n\t\t\t\t\t\t\t\tlastEdit: headKey });\n\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction changeScale(dx) {\n\t\t\t\tvar prevScale = zone.zoneScale;\n\t\t\t\tvar scale = Math.max(Math.min(zone.zoneScale + dx / 50, 2), 0.5);\n\t\t\t\tzone.zoneScale = Number(scale.toFixed(2));\n\t\t\t\tzone.updateZoneScale(prevScale);\n\t\t\t\tif (roomCode != null) {\n\t\t\t\t\tif (!zone.isAddingSound) {\n\t\t\t\t\t\ttempDb.child('zones').child(zone.containerObject.name).update({\n\t\t\t\t\t\t\tscale: zone.zoneScale,\n\t\t\t\t\t\t\tprev: prevScale,\n\t\t\t\t\t\t\tlastEdit: headKey });\n\n\t\t\t\t\t} else {\n\t\t\t\t\t\tzone.cache.prev = prevScale;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tvar pos = zone.containerObject.position;\n\t\t\tthis.addParameter({\n\t\t\t\tproperty: 'File',\n\t\t\t\tvalue: zone.sound ? zone.sound.name.split('/').pop() : 'None',\n\t\t\t\ttype: 'file-input',\n\t\t\t\tdisplay: zone.sound,\n\t\t\t\tevents: [{ type: 'click', callback: this.addSound.bind(this) }] },\n\t\t\telem).id = \"zone-sound\";\n\n\t\t\tthis.addParameter({\n\t\t\t\tproperty: 'Time',\n\t\t\t\tvalue: zone.sound ? this.convertTime(zone.sound.state.currentTime) : '0:00',\n\t\t\t\ttype: 'time',\n\t\t\t\tcls: 'time',\n\t\t\t\tbind: changeAudioTime,\n\t\t\t\tbindAdditional: audioPlayPause },\n\t\t\telem);\n\n\t\t\tthis.addParameter({\n\t\t\t\tproperty: 'Volume',\n\t\t\t\tvalue: zone.sound ? zone.sound.source.volume.gain.value : 'N/A',\n\t\t\t\ttype: 'number',\n\t\t\t\tcls: 'volume',\n\t\t\t\tbind: changeVolume },\n\t\t\telem);\n\n\t\t\tthis.addParameter({\n\t\t\t\tproperty: 'Scale',\n\t\t\t\tvalue: zone.zoneScale,\n\t\t\t\ttype: 'number',\n\t\t\t\tcls: 'scale',\n\t\t\t\tbind: changeScale },\n\t\t\telem);\n\n\t\t\tthis.addParameter({\n\t\t\t\tproperty: 'Position X',\n\t\t\t\tvalue: Number(pos.x.toFixed(2)),\n\t\t\t\ttype: 'number',\n\t\t\t\tcls: 'x',\n\t\t\t\tbind: setZonePosition.bind(this, \"x\") },\n\t\t\telem);\n\n\t\t\tthis.addParameter({\n\t\t\t\tproperty: 'Position Y',\n\t\t\t\tvalue: Number(pos.z.toFixed(2)),\n\t\t\t\ttype: 'number',\n\t\t\t\tcls: 'z',\n\t\t\t\tbind: setZonePosition.bind(this, \"z\") },\n\t\t\telem);\n\n\t\t\tthis.addParameter({\n\t\t\t\tproperty: 'Rotation',\n\t\t\t\tvalue: Number((zone.containerObject.rotation.y * 180 / Math.PI).toFixed(2)),\n\t\t\t\ttype: 'number',\n\t\t\t\tcls: 'rotation',\n\t\t\t\tsuffix: '',\n\t\t\t\tbind: setZoneRotation.bind(this) },\n\t\t\telem);\n\n\t\t\tthis.addNav({ type: \"object\", direction: \"left\" }, elem);\n\t\t\tthis.addNav({ type: \"object\", direction: \"right\" }, elem);\n\t\t} }, { key: 'initHeadGUI', value: function initHeadGUI(\n\n\t\tobject) {\n\t\t\tvar elem = this.addElem('Head', false);\n\t\t\tvar roomCode = this.roomCode;\n\t\t\tfunction setObjectPosition(component, dx) {\n\t\t\t\tthis.app.isAllowMouseDrag = true;\n\t\t\t\tvar destination = object.containerObject.position.clone();\n\t\t\t\tdestination[component] += dx;\n\n\t\t\t\t// clamp y to [-300,300]\n\t\t\t\tdestination.y = Math.min(Math.max(-300, destination.y), 300);\n\n\t\t\t\t// move all child objects of the object\n\t\t\t\tobject.setPosition(destination);\n\n\t\t\t\tif (object.trajectory) {\n\t\t\t\t\t// move trajectory\n\t\t\t\t\tif (component === 'y') {\n\t\t\t\t\t\tobject.trajectory.splinePoints.forEach(function (pt) {\n\t\t\t\t\t\t\tpt[component] = Math.min(Math.max(-300, pt[component] + dx), 300);\n\t\t\t\t\t\t});\n\t\t\t\t\t\tobject.trajectory.updateTrajectory();\n\t\t\t\t\t} else\n\t\t\t\t\t{\n\t\t\t\t\t\tobject.trajectory.objects.forEach(function (obj) {\n\t\t\t\t\t\t\tobj.position[component] += dx;\n\t\t\t\t\t\t});\n\t\t\t\t\t\tobject.trajectory.splinePoints.forEach(function (pt) {\n\t\t\t\t\t\t\tpt[component] += dx;\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (roomCode != null) {\n\t\t\t\t\tthis.dbRef.child('users').child(this.headKey).update({\n\t\t\t\t\t\tposition: destination });\n\n\t\t\t\t}\n\t\t\t} //end setObjectPosition\n\n\t\t\tfunction setHeadRotation(dx) {\n\t\t\t\tthis.app.isAllowMouseDrag = true;\n\t\t\t\tvar rotation = object.rotation.y + dx * Math.PI / 180;\n\n\t\t\t\tif (rotation < Math.PI) {rotation += Math.PI * 2;}\n\t\t\t\tif (rotation > Math.PI) {rotation -= Math.PI * 2;}\n\t\t\t\tobject.rotation.y = rotation;\n\t\t\t\tif (roomCode != null) {\n\t\t\t\t\tthis.dbRef.child('users').child(this.headKey).update({\n\t\t\t\t\t\trotation: rotation });\n\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t/* global object parameters */\n\t\t\tvar gElem = document.createElement('div');\n\t\t\tgElem.id = \"object-globals\";\n\t\t\telem.appendChild(gElem);\n\t\t\tgElem.style.display = this.app.isEditingObject ? 'none' : 'block';\n\n\t\t\tthis.addParameter({\n\t\t\t\tproperty: 'Position X',\n\t\t\t\tvalue: Number(object.containerObject.position.x.toFixed(2)),\n\t\t\t\ttype: 'number',\n\t\t\t\tcls: 'x',\n\t\t\t\tbind: setObjectPosition.bind(this, \"x\") },\n\t\t\tgElem);\n\n\t\t\tthis.addParameter({\n\t\t\t\tproperty: 'Position Y',\n\t\t\t\tvalue: Number(object.containerObject.position.z.toFixed(2)),\n\t\t\t\ttype: 'number',\n\t\t\t\tcls: 'z',\n\t\t\t\tbind: setObjectPosition.bind(this, \"z\") },\n\t\t\tgElem);\n\n\t\t\tthis.addParameter({\n\t\t\t\tproperty: 'Altitude',\n\t\t\t\tvalue: Number(object.containerObject.position.y.toFixed(2)),\n\t\t\t\ttype: 'number',\n\t\t\t\tcls: 'y',\n\t\t\t\tbind: setObjectPosition.bind(this, \"y\") },\n\t\t\tgElem);\n\n\t\t\tthis.addParameter({\n\t\t\t\tproperty: 'Rotation',\n\t\t\t\tvalue: Number((object.rotation.y * 180 / Math.PI).toFixed(2)),\n\t\t\t\ttype: 'number',\n\t\t\t\tcls: 'rotation',\n\t\t\t\tsuffix: '',\n\t\t\t\tbind: setHeadRotation.bind(this) },\n\t\t\telem);\n\n\t\t\tif (object.trajectory) {\n\t\t\t\tthis.addTrajectory(object);\n\t\t\t} else\n\t\t\t{\n\t\t\t\tthis.addTrajectoryDialog();\n\t\t\t}\n\n\t\t\t/* Head navigation */\n\t\t\tthis.addNav({ type: \"head\", direction: \"left\" }, elem);\n\t\t\tthis.addNav({ type: \"head\", direction: \"right\" }, elem);\n\t\t}\n\n\n\t\t//----- updating objects -------//\n\n\t\t// update parameters of sound object\n\t}, { key: 'updateObjectGUI', value: function updateObjectGUI(object) {var _this2 = this;\n\n\t\t\t// update audio time\n\t\t\tvar time = this.container.querySelector('.time .value');\n\t\t\tthis.replaceTextContent(time, object.omniSphere.sound && object.omniSphere.sound.state ? this.convertTime(object.omniSphere.sound.state.currentTime) : '0:00');\n\n\t\t\t// update audio duration\n\t\t\tvar duration = this.container.querySelector('#duration');\n\t\t\tthis.replaceTextContent(duration, object.omniSphere.sound && object.omniSphere.sound.state ? this.convertTime(object.omniSphere.sound.state.duration) : '0:00');\n\n\t\t\t// update audio play/pause status\n\t\t\tvar audioPlay = this.container.querySelector('#audio-playback');\n\t\t\taudioPlay.src = object.omniSphere.sound && object.omniSphere.sound.state ? this.convertPlayPause(object.omniSphere.sound.state.isAudioPaused) : this.convertPlayPause(true);\n\t\t\taudioPlay.style.opacity = object.omniSphere.sound && object.omniSphere.sound.state ? '0.8' : '0.2';\n\n\t\t\t// update sound volume\n\t\t\tvar volume = this.container.querySelector('.volume .value');\n\t\t\tthis.replaceTextContent(volume, object.omniSphere.sound && object.omniSphere.sound.volume ? object.omniSphere.sound.volume.gain.value : 'N/A');\n\n\t\t\t// update position parameters\n\t\t\tvar pos = object.containerObject.position;\n\t\t\tvar x = this.container.querySelector('.x .value');\n\t\t\tvar y = this.container.querySelector('.y .value');\n\t\t\tvar z = this.container.querySelector('.z .value');\n\n\t\t\tthis.replaceTextContent(x, pos.x);\n\t\t\tthis.replaceTextContent(y, pos.y);\n\t\t\tthis.replaceTextContent(z, pos.z);\n\n\t\t\t// check if trajectory exists\n\t\t\tif (object.trajectory) {\n\t\t\t\t// check if option to add trajectory still exists\n\t\t\t\tvar addTrajectory = document.getElementById('add-trajectory');\n\t\t\t\tif (addTrajectory) {\n\t\t\t\t\tthis.container.removeChild(addTrajectory);\n\t\t\t\t\tthis.addTrajectory(object);\n\t\t\t\t} else\n\t\t\t\t{\n\t\t\t\t\t// update trajectory parameters\n\t\t\t\t\tvar speed = this.container.querySelector('.speed .value');\n\t\t\t\t\tif (speed && speed.innerHTML != 0 && object.movementSpeed != 0 || speed.innerHTML == 0 && object.movementSpeed != 0) {\n\t\t\t\t\t\tthis.replaceTextContent(speed, object.movementSpeed);\n\t\t\t\t\t}\n\n\t\t\t\t\tvar position = this.container.querySelector('.position .value');\n\t\t\t\t\tif (position) {\n\t\t\t\t\t\tthis.replaceTextContent(position, object.trajectoryClock);\n\t\t\t\t\t}\n\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// check if finished scrubbing through audio\n\t\t\tif (object.omniSphere.sound && object.omniSphere.sound.state.isChangingAudioTime && Object.keys(this.dragEvent).length === 0) {\n\t\t\t\tobject.omniSphere.sound.state.isChangingAudioTime = false;\n\t\t\t}\n\n\t\t\t// update number of cones\n\t\t\t// this.replaceTextContent(document.getElementById('cone-count').querySelector('.value'), object.cones.length);\n\n\t\t\t// get cone information\n\t\t\tif (object.cones && object.cones.length > 0) {\n\t\t\t\tvar addButton = document.getElementById('add-cone');\n\t\t\t\tif (!addButton.classList.contains('add-cone-object-view')) {\n\t\t\t\t\taddButton.classList.add('add-cone-object-view');\n\t\t\t\t}\n\n\n\t\t\t\tvar cones = this.container.getElementsByClassName('cone');\n\t\t\t\tthis.app.interactiveCone == this.app.interactiveCone || object.cones[0];\n\t\t\t\tobject.cones.forEach(function (cone, i) {\n\t\t\t\t\tif (cone === _this2.app.interactiveCone) {\n\t\t\t\t\t\tcones[i].style.display = 'block';\n\t\t\t\t\t\t_this2.replaceTextContent(cones[i].getElementsByTagName('h4')[0], 'CONE ' + (i + 1) + ' OF ' + object.cones.length);\n\t\t\t\t\t\t_this2.replaceTextContent(cones[i].querySelector('.lat .value'), cone.lat * 180 / Math.PI, 0);\n\t\t\t\t\t\t_this2.replaceTextContent(cones[i].querySelector('.long .value'), cone.long * 180 / Math.PI, 0);\n\t\t\t\t\t\t_this2.replaceTextContent(cones[i].querySelector('.volume .value'), cone.sound.volume.gain.value, 2, true);\n\t\t\t\t\t\t_this2.replaceTextContent(cones[i].querySelector('.spread .value'), cone.sound.spread, 2, true);\n\t\t\t\t\t\t_this2.replaceTextContent(cones[i].querySelector('.time .value'), _this2.convertTime(cone.sound.state.currentTime));\n\t\t\t\t\t\t_this2.replaceTextContent(cones[i].querySelector('#duration'), _this2.convertTime(cone.sound.state.duration));\n\t\t\t\t\t\tcones[i].querySelector('#audio-playback').src = _this2.convertPlayPause(cone.sound.state.isAudioPaused);\n\t\t\t\t\t\tcones[i].querySelector('#audio-playback').style.opacity = cone.sound && cone.sound.state ? '0.8' : '0.2';\n\t\t\t\t\t\tif (cone.sound.state.isChangingAudioTime && Object.keys(_this2.dragEvent).length === 0) {\n\t\t\t\t\t\t\tcone.sound.state.isChangingAudioTime = false;\n\t\t\t\t\t\t}\n\t\t\t\t\t} else\n\t\t\t\t\t{\n\t\t\t\t\t\tcones[i].style.display = 'none';\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t}\n\n\t\t// update parameters of sound zone\n\t}, { key: 'updateSoundzoneGUI', value: function updateSoundzoneGUI(zone) {\n\t\t\tvar pos = zone.containerObject.position;\n\t\t\tvar x = this.container.querySelector('.x .value');\n\t\t\tvar z = this.container.querySelector('.z .value');\n\t\t\tvar rotation = this.container.querySelector('.rotation .value');\n\t\t\tvar volume = this.container.querySelector('.volume .value');\n\t\t\tvar time = this.container.querySelector('.time .value');\n\t\t\tvar duration = this.container.querySelector('#duration');\n\t\t\tvar audioPlay = this.container.querySelector('#audio-playback');\n\t\t\tvar scale = this.container.querySelector('.scale .value');\n\n\t\t\tif (zone.sound && zone.sound.state && !zone.sound.state.isAudioPaused && !zone.isChangingAudioTime) {\n\t\t\t\tvar currentTime = (Date.now() - zone.sound.state.startedAt) / 1000;\n\t\t\t\tcurrentTime = currentTime % Math.floor(zone.sound.state.duration);\n\t\t\t\tzone.sound.state.currentTime = currentTime;\n\t\t\t}\n\n\t\t\t// check if finished scrubbing through audio\n\t\t\tif (zone.isChangingAudioTime && Object.keys(this.dragEvent).length === 0) {\n\t\t\t\tzone.isChangingAudioTime = false;\n\t\t\t}\n\n\t\t\tvar volumeValue = '';\n\t\t\tif (!zone.isPlaying) {\n\t\t\t\tvolumeValue = zone.volume ? zone.volume : 'N/A';\n\t\t\t} else\n\t\t\t{\n\t\t\t\tvolumeValue = zone.sound && zone.sound.source ? zone.sound.source.volume.gain.value : 'N/A';\n\t\t\t}\n\n\t\t\tthis.replaceTextContent(x, pos.x);\n\t\t\tthis.replaceTextContent(z, pos.z);\n\t\t\tthis.replaceTextContent(rotation, zone.containerObject.rotation.y * 180 / Math.PI);\n\t\t\tthis.replaceTextContent(volume, volumeValue);\n\t\t\tthis.replaceTextContent(time, zone.sound && zone.sound.state ? this.convertTime(zone.sound.state.currentTime) : '0:00');\n\t\t\tthis.replaceTextContent(duration, zone.sound && zone.sound.state ? this.convertTime(zone.sound.state.duration) : '0:00');\n\t\t\taudioPlay.src = zone.sound && zone.sound.state ? this.convertPlayPause(zone.sound.state.isAudioPaused) : this.convertPlayPause(true);\n\t\t\taudioPlay.style.opacity = zone.sound && zone.sound.state ? '0.8' : '0.2';\n\t\t\tthis.replaceTextContent(scale, zone.zoneScale, 2);\n\t\t}\n\n\t\t// update parameters of head\n\t}, { key: 'updateHeadGUI', value: function updateHeadGUI(object) {\n\n\t\t\t// update position parameters\n\t\t\tvar pos = object.containerObject.position;\n\t\t\tvar x = this.container.querySelector('.x .value');\n\t\t\tvar z = this.container.querySelector('.z .value');\n\t\t\tvar y = this.container.querySelector('.y .value');\n\t\t\tvar rotation = this.container.querySelector('.rotation .value');\n\t\t\tvar mouse = this.container.querySelector('.mouse .value');\n\n\t\t\tthis.replaceTextContent(x, pos.x);\n\t\t\tthis.replaceTextContent(z, pos.z);\n\t\t\tthis.replaceTextContent(y, pos.y);\n\n\t\t\tif (object.rotation.y < Math.PI) {object.rotation.y += Math.PI * 2;}\n\t\t\tif (object.rotation.y > Math.PI) {object.rotation.y -= Math.PI * 2;}\n\t\t\tthis.replaceTextContent(rotation, object.rotation.y * 180 / Math.PI);\n\n\t\t\t// check if trajectory exists\n\t\t\tif (object.trajectory) {\n\n\t\t\t\t// check if option to add trajectory still exists\n\t\t\t\tvar addTrajectory = document.getElementById('add-trajectory');\n\t\t\t\tif (addTrajectory) {\n\t\t\t\t\tthis.container.removeChild(addTrajectory);\n\t\t\t\t\tthis.addTrajectory(object);\n\t\t\t\t} else\n\t\t\t\t{\n\t\t\t\t\t// update trajectory parameters\n\t\t\t\t\tvar speed = this.container.querySelector('.speed .value');\n\t\t\t\t\t// && (speed.innerHTML != 0 && object.movementSpeed != 0) || (speed.innerHTML == 0 && object.movementSpeed != 0)\n\t\t\t\t\tif (speed) {\n\t\t\t\t\t\tthis.replaceTextContent(speed, object.movementSpeed);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// ------------ event callbacks ------------ //\n\t\t// attach a sound to an object\n\t}, { key: 'addSound', value: function addSound(e) {\n\t\t\tvar obj = this.obj;\n\t\t\tvar span = e.target;\n\t\t\tvar input = document.getElementById('soundPicker');\n\t\t\t// listen to click\n\t\t\tvar self = this;\n\t\t\tinput.onchange = function (e) {\n\t\t\t\tvar file = e.target.files[0];\n\n\t\t\t\tinput.parentNode.reset();\n\n\t\t\t\tif (file && Math.round(file.size / 1024) <= 51200) {\n\t\t\t\t\t// load sound onto obect\n\t\t\t\t\tswitch (obj.type) {\n\t\t\t\t\t\tcase 'SoundTrajectory':\n\t\t\t\t\t\t\tobj = obj.parentSoundObject;\n\n\t\t\t\t\t\tcase 'SoundObject':\n\t\t\t\t\t\t\t// check if sound is attaching to omnisphere or cone\n\t\t\t\t\t\t\tif (span.parentNode.id === 'omnisphere-sound-loader') {\n\t\t\t\t\t\t\t\tobj.loadSound(file, self.app.audio, self.app.isMuted, obj).then(function (sound) {\n\t\t\t\t\t\t\t\t\tif (obj.omniSphere.sound && obj.omniSphere.sound.volume) {\n\t\t\t\t\t\t\t\t\t\t// copy properties of previous sound\n\t\t\t\t\t\t\t\t\t\tsound.volume.gain.value = obj.omniSphere.sound.volume.gain.value;\n\t\t\t\t\t\t\t\t\t\tsound.panner.refDistance = obj.omniSphere.sound.panner.refDistance;\n\t\t\t\t\t\t\t\t\t\tsound.panner.distanceModel = obj.omniSphere.sound.panner.distanceModel;\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\tobj.omniSphere.sound = sound;\n\t\t\t\t\t\t\t\t\tobj.omniSphere.sound.name = file.name;\n\t\t\t\t\t\t\t\t\tself.replaceTextContent(span, file.name);\n\t\t\t\t\t\t\t\t\tobj.setAudioPosition(obj.omniSphere);\n\t\t\t\t\t\t\t\t\tspan.nextSibling.style.display = 'inline-block';\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t} else {var\n\n\n\n\n\n\n\n\n\t\t\t\t\t\t\t\tattachCone = function attachCone(storageRef) {\n\t\t\t\t\t\t\t\t\tobj.loadSound(file, self.app.audio, self.app.isMuted, cone).then(function (sound) {\n\t\t\t\t\t\t\t\t\t\tif (obj.cones.length <= 0 && self.roomCode != null) {\n\t\t\t\t\t\t\t\t\t\t\tobj.dbRef.child('objects').child('cones').push();\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\tvar objectName = obj.containerObject.name;\n\t\t\t\t\t\t\t\t\t\tvar values = {\n\t\t\t\t\t\t\t\t\t\t\tvolume: 1,\n\t\t\t\t\t\t\t\t\t\t\tspread: 0.5,\n\t\t\t\t\t\t\t\t\t\t\tlongitude: 0,\n\t\t\t\t\t\t\t\t\t\t\tlatitude: 0,\n\t\t\t\t\t\t\t\t\t\t\tkey: obj.headKey };\n\n\t\t\t\t\t\t\t\t\t\tif (cone) {\n\t\t\t\t\t\t\t\t\t\t\t// copy properties of previous cone\n\t\t\t\t\t\t\t\t\t\t\tobj.applySoundToCone(cone, sound);\n\t\t\t\t\t\t\t\t\t\t\tobj.setAudioPosition(cone);\n\t\t\t\t\t\t\t\t\t\t\t// replace text with file name\n\t\t\t\t\t\t\t\t\t\t\tcone.filename = file.name;\n\t\t\t\t\t\t\t\t\t\t\tself.app.interactiveCone = cone;\n\t\t\t\t\t\t\t\t\t\t\tself.replaceTextContent(span, file.name);\n\n\t\t\t\t\t\t\t\t\t\t\tvar materialColor = self.app.isPlaying ? cone.baseColor.getHex() : 0x8F8F8F;\n\t\t\t\t\t\t\t\t\t\t\tcone.material.color.setHex(materialColor);\n\n\t\t\t\t\t\t\t\t\t\t\t// only play if global play\n\t\t\t\t\t\t\t\t\t\t\tif (!self.app.isPlaying) {\n\t\t\t\t\t\t\t\t\t\t\t\tobj.stopConeSound(cone);\n\t\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t\tvalues.volume = cone.sound.volume.gain.value;\n\t\t\t\t\t\t\t\t\t\t\tvalues.spread = cone.sound.spread;\n\t\t\t\t\t\t\t\t\t\t\tvalues.longitude = cone.long;\n\t\t\t\t\t\t\t\t\t\t\tvalues.latitude = cone.lat;\n\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\tcone = obj.createCone(sound);\n\t\t\t\t\t\t\t\t\t\t\tcone.file = file;\n\t\t\t\t\t\t\t\t\t\t\tcone.filename = file.name;\n\t\t\t\t\t\t\t\t\t\t\tself.addCone(cone);\n\n\t\t\t\t\t\t\t\t\t\t\t// parallel structure to hold sounds for forwarding out\n\t\t\t\t\t\t\t\t\t\t\tvar copySound = new Object();\n\t\t\t\t\t\t\t\t\t\t\t// copy by value instead of reference to protect against remove case\n\t\t\t\t\t\t\t\t\t\t\tobj.coneSounds[cone.uuid] = Object.assign(copySound, cone.sound);\n\n\t\t\t\t\t\t\t\t\t\t\tself.app.undoableActionStack.push(new _action2.default(obj, 'addCone'));\n\t\t\t\t\t\t\t\t\t\t\tself.app.undoableActionStack[self.app.undoableActionStack.length - 1].secondary = cone;\n\t\t\t\t\t\t\t\t\t\t\tself.app.interactiveCone = cone;\n\n\t\t\t\t\t\t\t\t\t\t\t// point cone at camera\n\t\t\t\t\t\t\t\t\t\t\tobj.pointCone(cone, self.app.camera.threeCamera.position);\n\t\t\t\t\t\t\t\t\t\t\tvalues.longitude = cone.long;\n\t\t\t\t\t\t\t\t\t\t\tvalues.latitude = cone.lat;\n\t\t\t\t\t\t\t\t\t\t\t// if (!self.app.isPlaying) {\n\t\t\t\t\t\t\t\t\t\t\t//   obj.stopConeSound(cone);\n\t\t\t\t\t\t\t\t\t\t\t// }\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\tif (self.roomCode != null) {\n\t\t\t\t\t\t\t\t\t\t\tvar coneUUID = cone.uuid;\n\t\t\t\t\t\t\t\t\t\t\tvar isConePlaying = !cone.sound.state.isAudioPaused;\n\t\t\t\t\t\t\t\t\t\t\tvar upload = storageRef.child('soundObjects/' + objectName + '/' + coneUUID + '/' + file.name).put(file);\n\t\t\t\t\t\t\t\t\t\t\tvar tempRef = obj.dbRef;\n\t\t\t\t\t\t\t\t\t\t\tobj.finishUploadingSound = false;\n\t\t\t\t\t\t\t\t\t\t\tupload.on('state_changed', function (snapshot) {\n\t\t\t\t\t\t\t\t\t\t\t\tvar progress = snapshot.bytesTransferred / snapshot.totalBytes * 100;\n\t\t\t\t\t\t\t\t\t\t\t\tconsole.log('Upload is ' + progress + '% done');\n\t\t\t\t\t\t\t\t\t\t\t}, function (error) {\n\t\t\t\t\t\t\t\t\t\t\t\tconsole.log('Problem uploading file');\n\t\t\t\t\t\t\t\t\t\t\t}, function () {\n\t\t\t\t\t\t\t\t\t\t\t\ttempRef.child('objects').child(obj.containerObject.name).child('cones').child(coneUUID).update({\n\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"cone\",\n\t\t\t\t\t\t\t\t\t\t\t\t\tparent: obj.containerObject.name,\n\t\t\t\t\t\t\t\t\t\t\t\t\tuuid: cone.uuid,\n\t\t\t\t\t\t\t\t\t\t\t\t\tsound: file.name,\n\t\t\t\t\t\t\t\t\t\t\t\t\tvolume: cone.sound.volume.gain.value,\n\t\t\t\t\t\t\t\t\t\t\t\t\tspread: cone.sound.spread,\n\t\t\t\t\t\t\t\t\t\t\t\t\tlongitude: cone.long,\n\t\t\t\t\t\t\t\t\t\t\t\t\tlatitude: cone.lat,\n\t\t\t\t\t\t\t\t\t\t\t\t\tlastEdit: values.key,\n\t\t\t\t\t\t\t\t\t\t\t\t\tisPlaying: isConePlaying });\n\n\t\t\t\t\t\t\t\t\t\t\t\tobj.finishUploadingSound = true;\n\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\tvar addButton = document.getElementById('add-cone');\n\t\t\t\t\t\t\t\t\t\taddButton.classList.add('add-cone-object-view');\n\t\t\t\t\t\t\t\t\t\tif (addButton.style.position == \"absolute\") {\n\t\t\t\t\t\t\t\t\t\t\tif (self.app.isEditingObject) {\n\t\t\t\t\t\t\t\t\t\t\t\taddButton.style.top = \"167.5px\";\n\t\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\t\taddButton.style.top = \"228.51px\";\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\t// hard-coded the timeout but create the sound\n\t\t\t\t\t\t\t\t// after the tween is finished\n\t\t\t\t\t\t\t\t// replace sound attached to existing cone\n\t\t\t\t\t\t\t\tvar text = span.innerText || span.textContent;var cone = null;if (obj.cones && obj.cones.length > 0 && text) {cone = obj.cones.find(function (c) {return c.filename === text;});}if (!cone && !self.app.isEditingObject) {self.toggleEditObject();\n\t\t\t\t\t\t\t\t\twindow.setTimeout(attachCone.bind(null, self.stoRef), 800);\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tattachCone(self.stoRef);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tcase 'SoundZone':\n\t\t\t\t\t\t\t// add sound to zone\n\t\t\t\t\t\t\tvar oldIsAudioPaused = false;\n\t\t\t\t\t\t\tif (obj.sound) {\n\t\t\t\t\t\t\t\toldIsAudioPaused = obj.sound.state.isAudioPaused;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tobj.clear();\n\t\t\t\t\t\t\tobj.loadSound(file, self.app.audio, self.app.isMuted).then(function (sound) {\n\t\t\t\t\t\t\t\tif (!self.app.isMuted) {\n\t\t\t\t\t\t\t\t\tobj.playSound();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tif (oldIsAudioPaused) {\n\t\t\t\t\t\t\t\t\tobj.sound.state.isAudioPaused = true;\n\t\t\t\t\t\t\t\t\tobj.shape.material.color.setHex(0x8F8F8F);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tself.replaceTextContent(span, file.name);\n\t\t\t\t\t\t\tspan.nextSibling.style.display = 'inline-block';\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\tbreak;}\n\n\t\t\t\t} else {\n\t\t\t\t\talert('File too large. Please select a file under 50 MB');\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tinput.click();\n\t\t} }, { key: 'detachSound', value: function detachSound(\n\n\t\tfileSpan, removeSpan) {\n\t\t\tfileSpan.innerHTML = 'None';\n\t\t\tremoveSpan.style.display = 'none';\n\t\t\tvar filename = this.obj.filename;\n\n\t\t\tif (this.obj.type === \"SoundObject\") {\n\t\t\t\tthis.obj.disconnectSound();\n\t\t\t\tthis.obj.filename = null;\n\t\t\t\tif (this.roomCode != null) {\n\t\t\t\t\tthis.dbRef.child('objects').child(this.obj.containerObject.name).update({\n\t\t\t\t\t\tsound: null,\n\t\t\t\t\t\tisPlaying: null,\n\t\t\t\t\t\tlastEdit: this.headKey });\n\n\t\t\t\t\tthis.stoRef.child('soundObjects/' + this.obj.containerObject.name + '/' + filename).delete().then(function () {\n\t\t\t\t\t\tconsole.log(\"deleted file successfully\");\n\t\t\t\t\t}).catch(function (error) {\n\t\t\t\t\t\tconsole.log(error);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (this.obj.type === \"SoundZone\") {\n\t\t\t\tvar _filename = this.obj.filename;\n\t\t\t\tthis.obj.clear();\n\n\t\t\t\tvar materialColor = this.app.isPlaying ? 0xFF1169 : 0x8F8F8F;\n\t\t\t\tthis.obj.shape.material.color.setHex(materialColor);\n\t\t\t\tif (this.roomCode != null) {\n\t\t\t\t\tthis.dbRef.child('zones').child(this.obj.containerObject.name).update({\n\t\t\t\t\t\tsound: null,\n\t\t\t\t\t\tisPlaying: null,\n\t\t\t\t\t\tlastEdit: this.headKey });\n\n\t\t\t\t\tthis.stoRef.child('zones/' + this.obj.containerObject.name + '/' + _filename).delete().then(function () {\n\t\t\t\t\t\tconsole.log(\"deleted file successfully\");\n\t\t\t\t\t}).catch(function (error) {\n\t\t\t\t\t\tconsole.log(error);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tthis.obj.filename = null;\n\t\t\t}\n\t\t}\n\n\t\t// move into/out of object edit mode\n\t}, { key: 'toggleEditObject', value: function toggleEditObject() {\n\t\t\tif (!this.app.isEditingObject) {\n\t\t\t\tvar span = this.container.querySelector('.edit-toggle .value');\n\t\t\t\tthis.editor = span;\n\t\t\t\tthis.container.classList.add('editor');\n\t\t\t\tthis.replaceTextContent(span, 'Zoom Out');\n\t\t\t\t// Mutes the objects besides the one being edited\n\t\t\t\tthis.app.muteAll(this.app.activeObject);\n\n\t\t\t\t// disable duplicate functionality\n\t\t\t\tthis.toggleClass('#guis', '.baseParam > h4 .center-panel', 'disabled-color', false);\n\t\t\t\tthis.toggleClass('#guis', '.baseParam > h4 .center-panel > span', 'not-allowed', false, 'cursor');\n\n\t\t\t\tvar addButton = document.getElementById('add-cone');\n\n\t\t\t\tthis.app.enterEditObjectView();\n\n\t\t\t\t// once entered object view, these values should reflect new changes\n\t\t\t\tvar guiHeight = document.getElementById('guis').scrollHeight + 20;\n\t\t\t\tvar baseParams = document.getElementsByClassName('baseParam')[0].scrollHeight;\n\n\t\t\t\tif (addButton.style.position == 'absolute' && addButton.style.position.length > 0) {\n\t\t\t\t\taddButton.style.top = \"167.5px\";\n\t\t\t\t}\n\n\t\t\t} else\n\t\t\t{\n\t\t\t\t// re-enable duplicate functionality, move out of object edit mode\n\t\t\t\tthis.toggleClass('#guis', '.baseParam > h4 .center-panel', false, 'disabled-color');\n\t\t\t\tthis.toggleClass('#guis', '.baseParam > h4 .center-panel > span', 'pointer', false, 'cursor');\n\n\t\t\t\tthis.app.exitEditObjectView();\n\t\t\t\tvar _guiHeight = document.getElementById('guis').scrollHeight;\n\t\t\t\tvar _baseParams = document.getElementsByClassName('baseParam')[0].scrollHeight;\n\t\t\t\t// move add cone button down to match menu\n\t\t\t\tvar _addButton3 = document.getElementById('add-cone');\n\n\t\t\t\tif (_addButton3.style.position == 'absolute' && _addButton3.style.position.length > 0) {\n\t\t\t\t\t_addButton3.style.top = \"228.51px\";\n\t\t\t\t}\n\t\t\t}\n\t\t} }, { key: 'deleteObject', value: function deleteObject()\n\n\t\t{\n\t\t\tthis.app.interactiveCone = false;\n\t\t\tif (this.app.activeObject.type == 'SoundTrajectory') {\n\t\t\t\tthis.app.activeObject = this.app.activeObject.parentSoundObject;\n\t\t\t}\n\t\t\t// ensure to delete object, not the trajectory lol\n\t\t\tvar keyboardEvent = new KeyboardEvent(\"keydown\", {\n\t\t\t\tbubbles: true,\n\t\t\t\tcancelable: true,\n\t\t\t\tchar: \"Backspace\",\n\t\t\t\tkey: \"Backspace\",\n\t\t\t\tshiftKey: false,\n\t\t\t\tkeyCode: 8 });\n\n\t\t\tkeyboardEvent.simulate = true;\n\t\t\tdocument.dispatchEvent(keyboardEvent);\n\t\t} }, { key: 'exitEditorGui', value: function exitEditorGui()\n\n\t\t{\n\t\t\tthis.app.unmuteAll();\n\t\t\tvar span = this.container.querySelector('.edit-toggle .value');\n\t\t\tthis.editor = null;\n\t\t\tthis.container.classList.remove('editor');\n\t\t\tthis.replaceTextContent(span, 'Zoom In');\n\t\t} }, { key: 'copyItem', value: function copyItem()\n\n\t\t{\n\t\t\tif (!this.app.isEditingObject) {\n\t\t\t\tthis.app.copySelectedItem();\n\t\t\t}\n\t\t} }, { key: 'toggleClass', value: function toggleClass(\n\n\t\tbaseProperties, className, optionToAdd, optionToRemove) {var singleOperation = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : null;\n\t\t\tvar container = document.querySelector(baseProperties);\n\t\t\tvar propertyElems = container.querySelectorAll(className);var _iteratorNormalCompletion = true;var _didIteratorError = false;var _iteratorError = undefined;try {\n\t\t\t\tfor (var _iterator = propertyElems[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {var element = _step.value;\n\t\t\t\t\tif (singleOperation) {\n\t\t\t\t\t\telement.style[singleOperation] = optionToAdd;\n\t\t\t\t\t}\n\t\t\t\t\tvar classList = element.classList;\n\t\t\t\t\tif (optionToRemove) {\n\t\t\t\t\t\tclassList.remove(optionToRemove);\n\t\t\t\t\t}\n\t\t\t\t\tif (optionToAdd) {\n\t\t\t\t\t\tclassList.add(optionToAdd);\n\t\t\t\t\t}\n\n\t\t\t\t}} catch (err) {_didIteratorError = true;_iteratorError = err;} finally {try {if (!_iteratorNormalCompletion && _iterator.return) {_iterator.return();}} finally {if (_didIteratorError) {throw _iteratorError;}}}\n\n\t\t} }, { key: 'toggleAllowMouseDrag', value: function toggleAllowMouseDrag()\n\n\n\t\t{\n\t\t\tthis.app.isAllowMouseDrag = !this.app.isAllowMouseDrag;\n\t\t} }, { key: 'convertPlayPause', value: function convertPlayPause(\n\n\t\tisAudioPaused) {\n\t\t\tif (isAudioPaused) {\n\t\t\t\treturn this.app.playBtnSrc;\n\t\t\t}\n\t\t\treturn this.app.pauseBtnSrc;\n\t\t} }, { key: 'convertTime', value: function convertTime(\n\n\t\tinputTime) {\n\t\t\tvar seconds = Math.floor(Math.round(inputTime) % 60);\n\t\t\tif (seconds < 10) {\n\t\t\t\tseconds = \"0\" + seconds;\n\t\t\t}\n\t\t\tvar minutes = Math.floor(Math.round(inputTime) / 60);\n\t\t\treturn minutes + \":\" + seconds;\n\t\t} }, { key: 'changeAudioPlay', value: function changeAudioPlay(\n\n\t\te) {\n\t\t\tvar l = this.listeners.find(function (l) {return l.elem === e.target || l.elem === e.target.parentNode;});\n\n\t\t\tif (l && l.callback) {\n\t\t\t\tthis.clickEvent.call = l.callback;\n\t\t\t\tthis.clickEvent.call();\n\t\t\t}\n\t\t}\n\n\t\t// switch between different cones and objects\n\t}, { key: 'nav', value: function nav(e) {\n\t\t\tif (e.type === 'cone') {\n\t\t\t\tvar i = this.obj.cones.indexOf(this.app.interactiveCone);\n\t\t\t\tif (i > -1) {\n\t\t\t\t\ti = e.direction === 'left' ? i - 1 + this.obj.cones.length : i + 1;\n\t\t\t\t\tthis.app.interactiveCone = this.obj.cones[i % this.obj.cones.length];\n\t\t\t\t}\n\t\t\t} else\n\t\t\t{\n\t\t\t\tvar everyObject = [].concat(this.app.soundObjects, this.app.soundZones);\n\t\t\t\tif (!this.app.isEditingObject) {\n\t\t\t\t\teveryObject.push(this.app.headObject);\n\t\t\t\t}\n\t\t\t\tvar _i = everyObject.indexOf(this.obj);\n\t\t\t\tif (_i > -1) {\n\t\t\t\t\t_i = e.direction === 'left' ? _i - 1 + everyObject.length : _i + 1;\n\t\t\t\t\tthis.app.setActiveObject(everyObject[_i % everyObject.length]);\n\t\t\t\t\tthis.app.tweenToObjectView();\n\t\t\t\t}\n\t\t\t}\n\t\t} }, { key: 'startDragging', value: function startDragging(\n\n\t\te) {\n\t\t\tthis.app.controls.disable();\n\n\t\t\tvar l = this.listeners.find(function (l) {return l.elem === e.target || l.elem === e.target.parentNode;});\n\n\t\t\tif (l && l.callback) {\n\t\t\t\tthis.dragEvent.call = l.callback;\n\t\t\t\tthis.dragEvent.editing = e.target;\n\t\t\t\tthis.dragEvent.x = e.x;\n\t\t\t}\n\t\t} }, { key: 'drag', value: function drag(\n\t\te) {\n\t\t\tif (!this.dragEvent.editing) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar dx = e.x == undefined ? e.movementX : e.x - this.dragEvent.x;\n\t\t\tthis.dragEvent.x = e.x;\n\t\t\tthis.dragEvent.call(dx);\n\t\t} }, { key: 'stopDragging', value: function stopDragging(\n\t\te) {\n\t\t\tif (!this.dragEvent.editing) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.dragEvent = {};\n\t\t\tthis.app.controls.enable();\n\t\t} }, { key: 'typingInput', value: function typingInput(\n\n\t\te) {\n\t\t\tvar keyCode = e.keyCode ? e.keyCode : e.which;\n\n\t\t\tvar charStr = String.fromCharCode(keyCode);\n\n\t\t\tvar valid =\n\t\t\tkeyCode > 47 && keyCode < 58 || // number keys\n\t\t\tkeyCode == 13 || // return key\n\t\t\tcharStr == '-' || charStr == '.'; // negative sign and decimal\n\n\t\t\tif (!valid && this.roomCode != null) {\n\t\t\t\te.preventDefault();\n\t\t\t\te.target.blur();\n\t\t\t}\n\n\t\t\tvar inputValue = e.target.value;\n\n\t\t\t// Check for enter and that value is a number\n\t\t\tif (e.keyCode == 13 && !isNaN(inputValue)) {\n\t\t\t\tvar l = this.listeners.find(function (l) {return l.elem === e.target || l.elem === e.target.parentNode;});\n\n\t\t\t\t// Adjust for dx for drag versus straight input\n\t\t\t\tvar factor = 1;\n\t\t\t\tif (e.target.parentNode.parentNode.className === \"volume\") {\n\t\t\t\t\tfactor = 50;\n\t\t\t\t} else\n\t\t\t\tif (e.target.parentNode.parentNode.className === \"speed\") {\n\t\t\t\t\tfactor = 10;\n\t\t\t\t} else\n\t\t\t\tif (e.target.parentNode.parentNode.className === \"spread\") {\n\t\t\t\t\tfactor = 100;\n\t\t\t\t} else\n\t\t\t\tif (e.target.parentNode.parentNode.className === \"scale\") {\n\t\t\t\t\tfactor = 50;\n\t\t\t\t}\n\t\t\t\tvar dx = (inputValue - e.target.defaultValue) * factor;\n\n\t\t\t\t// Apply change\n\t\t\t\tif (l && l.callback) {\n\t\t\t\t\tthis.typeEvent.call = l.callback;\n\t\t\t\t\tthis.typeEvent.call(dx);\n\t\t\t\t\tthis.display();\n\t\t\t\t}\n\t\t\t}\n\t\t} }, { key: 'addSwipeEvents', value: function addSwipeEvents(\n\n\t\tdiv, title, isObject) {\n\t\t\t// add touch interactions\n\t\t\tvar x = null,\n\t\t\ty = null,\n\t\t\tdx = null,\n\t\t\tdy = null;\n\t\t\tvar controls = this.app.controls;\n\t\t\ttitle.onmousedown = function (e) {\n\t\t\t\tx = e.clientX;\n\t\t\t\ty = e.clientY;\n\t\t\t\tcontrols.disable();\n\t\t\t};\n\n\t\t\tdiv.onmousemove = function (e) {\n\t\t\t\tif (x == null || y == null) {return;}\n\t\t\t\tdx = e.clientX - x;\n\t\t\t\tdy = e.clientY - y;\n\t\t\t\tif (Math.abs(dx) > 15) {\n\t\t\t\t\tif (dx > 0) {\n\t\t\t\t\t\ttitle.style.marginLeft = Math.min(dx - 10 / 2, 50) + 'px';\n\t\t\t\t\t} else\n\t\t\t\t\t{\n\t\t\t\t\t\ttitle.style.marginLeft = Math.max(dx + 10 / 2, -50) + 'px';\n\t\t\t\t\t}\n\t\t\t\t} else\n\t\t\t\t{\n\t\t\t\t\ttitle.style.marginLeft = 0;\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tvar self = this;\n\n\t\t\tdiv.onmouseup = function () {\n\t\t\t\tif (x == null || y == null) {return;}\n\t\t\t\ttitle.style.marginLeft = 0;\n\t\t\t\tif (Math.abs(dx) >= 40) {\n\t\t\t\t\tvar direction = dx < 0 ? \"left\" : \"right\";\n\t\t\t\t\tvar objectType = isObject ? \"object\" : \"cone\";\n\t\t\t\t\tself.nav({ direction: direction, type: objectType });\n\t\t\t\t}\n\t\t\t\tx = y = dx = dy = null;\n\t\t\t\tcontrols.enable();\n\t\t\t};\n\n\t\t\tdiv.onmouseleave = function (e) {\n\t\t\t\tif (x == null || y == null) {return;}\n\t\t\t\tif (e.target.parentNode != div) {\n\t\t\t\t\tdiv.onmouseup();\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\t\t//---------- dom building blocks -----------//\n\t\t// add a new div\n\t}, { key: 'addElem', value: function addElem(name, addEditParameter, siblingAfter) {\n\t\t\tvar div = document.createElement('div');\n\t\t\tdiv.classList += 'baseParam';\n\t\t\tvar title = document.createElement('h4');\n\t\t\tvar p = document.createElement('span');\n\t\t\tp.appendChild(document.createTextNode(name));\n\t\t\tp.style.fontWeight = 'bold';\n\t\t\tp.style.display = 'block';\n\t\t\tp.style.marginBottom = '0.8em';\n\t\t\tp.className += ' title';\n\t\t\ttitle.appendChild(p);\n\t\t\tdiv.appendChild(title);\n\t\t\tthis.container.insertBefore(div, siblingAfter || null);\n\t\t\tif (addEditParameter) {\n\t\t\t\t// add three horizontal parameters for editing: Zoom, Duplicate, Delete\n\t\t\t\tthis.addParameter({\n\t\t\t\t\tvalue: this.app.isEditingObject ? 'Zoom Out' : 'Zoom In',\n\t\t\t\t\tcls: 'edit-toggle top-gui left-panel',\n\t\t\t\t\tevents: [{\n\t\t\t\t\t\ttype: 'click',\n\t\t\t\t\t\tcallback: this.toggleEditObject.bind(this) }] },\n\n\t\t\t\ttitle);\n\n\t\t\t\tthis.addParameter({\n\t\t\t\t\tvalue: 'Duplicate',\n\t\t\t\t\tcls: 'top-gui center-panel',\n\t\t\t\t\tevents: [{\n\t\t\t\t\t\ttype: 'click',\n\t\t\t\t\t\tcallback: this.copyItem.bind(this) }] },\n\n\t\t\t\ttitle);\n\n\t\t\t\tthis.addParameter({\n\t\t\t\t\tvalue: 'Delete',\n\t\t\t\t\tcls: 'top-gui right-panel',\n\t\t\t\t\tevents: [{\n\t\t\t\t\t\ttype: 'click',\n\t\t\t\t\t\tcallback: this.deleteObject.bind(this) }] },\n\n\t\t\t\ttitle);\n\n\n\t\t\t}\n\n\t\t\tif (addEditParameter || siblingAfter) {\n\t\t\t\t// TODO: prevent Swipe Event to head in edit mode\n\t\t\t\tthis.addSwipeEvents(div, title, addEditParameter);\n\t\t\t}\n\t\t\treturn div;\n\t\t}\n\n\t\t// add a line for the parameter in the UI\n\t\t// parameter p can contain properties:\n\t\t//      property\n\t\t//      value\n\t\t//      cls:     class name for quicker dom access\n\t\t//      type:    number, file, etc?\n\t\t//      suffix:  a string to be appended to the value\n\t\t//      events:  array of event names & callback functions\n\t}, { key: 'addParameter', value: function addParameter(p, container) {\n\t\t\tcontainer = container || this.container;\n\n\t\t\tvar div = document.createElement('div');\n\t\t\tif (p.cls) {div.className = p.cls;}\n\t\t\tif (p.button) {div.style.padding = \"4%\";}\n\t\t\tvar prop = document.createElement('span');\n\t\t\tprop.className = 'property'; // fade-gray-text';\n\t\t\tprop.appendChild(document.createTextNode(p.property));\n\n\t\t\tvar val = document.createElement('span');\n\t\t\tval.className = 'valueSpan';\n\n\t\t\tif (!p.button) {\n\t\t\t\tval.style.maxWidth = \"max-width: 90px;\";\n\t\t\t}\n\n\t\t\tif (p.type === 'number' || p.type === 'time') {\n\t\t\t\tval.style.cursor = 'ew-resize';\n\t\t\t}\n\n\t\t\tif (p.events) {\n\t\t\t\tp.events.forEach(function (evt) {\n\t\t\t\t\tif (!evt.target) {\n\t\t\t\t\t\tval['on' + evt.type] = evt.callback;\n\t\t\t\t\t} else\n\t\t\t\t\t{\n\t\t\t\t\t\tevt.target.addEventListener(evt.type, evt.callback);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t\t// shortcut to apply \"startDragging\" mousedown event\n\t\t\tif (p.bind) {\n\t\t\t\tval.onmousedown = this.startDragging.bind(this);\n\t\t\t\tval.onkeypress = this.typingInput.bind(this);\n\t\t\t\tthis.listeners.push({\n\t\t\t\t\telem: val,\n\t\t\t\t\tcallback: p.bind });\n\n\t\t\t}\n\n\t\t\t// Create an input text box if is a number\n\t\t\tif (p.type === 'number') {\n\t\t\t\tvar input = document.createElement('input');\n\t\t\t\tinput.type = 'text';\n\t\t\t\tinput.className = 'value';\n\t\t\t\tinput.size = '8';\n\t\t\t\tinput.defaultValue = p.value;\n\t\t\t\tinput.disabled = false;\n\t\t\t\tinput.style.color = \"#5d5e5d\";\n\t\t\t\tval.appendChild(input);\n\n\t\t\t\tif (p.suffix) {\n\t\t\t\t\tvar text = document.createTextNode(p.suffix);\n\t\t\t\t\tval.appendChild(text);\n\t\t\t\t\tinput.after(text);\n\t\t\t\t}\n\t\t\t} else\n\t\t\tif (p.type === 'time') {\n\t\t\t\t// Creating element to show audio playback\n\t\t\t\tvar span = document.createElement('span');\n\t\t\t\tspan.className = 'value';\n\t\t\t\tspan.style.fontWeight = 'normal';\n\t\t\t\tspan.id = 'time';\n\t\t\t\tspan.appendChild(document.createTextNode(p.value));\n\t\t\t\tval.appendChild(span);\n\n\t\t\t\tvar durationSpan = document.createElement('span');\n\t\t\t\tdurationSpan.style.fontWeight = 'normal';\n\t\t\t\tdurationSpan.id = \"duration\";\n\t\t\t\tdurationSpan.className = 'value';\n\t\t\t\tdurationSpan.innerHTML = '0:00';\n\n\t\t\t\tspan.after(document.createTextNode('\\xA0\\xA0'));\n\t\t\t\tspan.after(durationSpan);\n\t\t\t\tspan.after(document.createTextNode(\"/\"));\n\n\t\t\t\t// Append play/pause button\n\t\t\t\tvar audioVal = document.createElement('span');\n\t\t\t\taudioVal.className = 'valueSpan';\n\n\t\t\t\tvar audioBtn = document.createElement('img');\n\t\t\t\taudioBtn.id = \"audio-playback\";\n\t\t\t\taudioBtn.style.height = \"12px\";\n\t\t\t\taudioBtn.style.width = \"12px\";\n\t\t\t\taudioBtn.style.opacity = \"0.2\";\n\t\t\t\taudioBtn.src = this.convertPlayPause(true);\n\n\t\t\t\taudioVal.appendChild(audioBtn);\n\n\t\t\t\t// Attach play/pause button events if have additional binding\n\t\t\t\tif (p.bindAdditional) {\n\t\t\t\t\taudioVal.onclick = this.changeAudioPlay.bind(this);\n\t\t\t\t\tthis.listeners.push({\n\t\t\t\t\t\telem: audioVal,\n\t\t\t\t\t\tcallback: p.bindAdditional });\n\n\t\t\t\t}\n\t\t\t} else\n\n\t\t\t{\n\t\t\t\tif (p.suffix) {\n\t\t\t\t\tvar span = document.createElement('span');\n\t\t\t\t\tspan.className = 'value';\n\t\t\t\t\tspan.appendChild(document.createTextNode(p.value));\n\t\t\t\t\tval.appendChild(span);\n\t\t\t\t\tval.appendChild(document.createTextNode(p.suffix));\n\t\t\t\t} else\n\t\t\t\t{\n\t\t\t\t\tval.appendChild(document.createTextNode(p.value));\n\t\t\t\t\tval.className += ' value';\n\t\t\t\t\tif (p.button) {\n\t\t\t\t\t\tval.className += ' button';\n\t\t\t\t\t\tval.style.fontWeight = 'bold';\n\n\t\t\t\t\t\t// TODO: change solution to add extra bottom padding for last element in menu\n\t\t\t\t\t\tif (p.value[4] == 'T') {\n\t\t\t\t\t\t\tdiv.style.paddingBottom = '15px';\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif (p.innercls) {\n\t\t\t\t\t\tval.className += ' f' + p.innercls;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\n\t\t\t// append all values to dom\n\t\t\tif (p.property != undefined) {div.appendChild(prop);}\n\t\t\tif (p.value != undefined) {div.appendChild(val);}\n\t\t\tif (p.type === 'time') {div.appendChild(audioVal);}\n\n\t\t\tif (p.type == 'file-input') {\n\t\t\t\tval.style.fontWeight = 'normal';\n\t\t\t\tvar removeFile = document.createElement('span');\n\t\t\t\tremoveFile.appendChild(document.createTextNode(''));\n\t\t\t\tremoveFile.className = 'remove-file';\n\t\t\t\tdiv.appendChild(removeFile);\n\n\t\t\t\tremoveFile.style.display = p.display ? 'inline-block' : 'none';\n\t\t\t\tremoveFile.onclick = this.detachSound.bind(this, val, removeFile);\n\t\t\t}\n\n\t\t\tcontainer.append(div);\n\t\t\treturn div;\n\t\t}\n\n\t\t// updating text in html\n\t}, { key: 'replaceTextContent', value: function replaceTextContent(parent, text, sigfigs, float) {\n\t\t\t// while(parent.firstChild) { parent.removeChild(parent.firstChild); }\n\t\t\tif (!isNaN(text)) {\n\t\t\t\tif (isNaN(sigfigs)) {\n\t\t\t\t\ttext = (+text).toFixed(2);\n\t\t\t\t} else\n\t\t\t\t{\n\t\t\t\t\ttext = (+text).toFixed(sigfigs);\n\t\t\t\t}\n\t\t\t\tif (!float) text = +text;\n\t\t\t}\n\t\t\tparent.innerHTML = text;\n\t\t\tparent.defaultValue = text;\n\t\t\t// parent.appendChild(document.createTextNode(text));\n\t\t} }]);return GUIWindow;}();exports.default = GUIWindow;\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/js/app/managers/guiwindow.js\n// module id = 37\n// module chunks = 0\n\n//# sourceURL=webpack:///./src/js/app/managers/guiwindow.js?");

/***/ }),
/* 38 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("Object.defineProperty(exports, \"__esModule\", { value: true });var _createClass = function () {function defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if (\"value\" in descriptor) descriptor.writable = true;Object.defineProperty(target, descriptor.key, descriptor);}}return function (Constructor, protoProps, staticProps) {if (protoProps) defineProperties(Constructor.prototype, protoProps);if (staticProps) defineProperties(Constructor, staticProps);return Constructor;};}();var _three = __webpack_require__(0);var THREE = _interopRequireWildcard(_three);\nvar _keyboard = __webpack_require__(41);var _keyboard2 = _interopRequireDefault(_keyboard);\nvar _config = __webpack_require__(1);var _config2 = _interopRequireDefault(_config);\nvar _action = __webpack_require__(5);var _action2 = _interopRequireDefault(_action);\nvar _soundobject = __webpack_require__(4);var _soundobject2 = _interopRequireDefault(_soundobject);\nvar _soundzone = __webpack_require__(7);var _soundzone2 = _interopRequireDefault(_soundzone);function _interopRequireDefault(obj) {return obj && obj.__esModule ? obj : { default: obj };}function _interopRequireWildcard(obj) {if (obj && obj.__esModule) {return obj;} else {var newObj = {};if (obj != null) {for (var key in obj) {if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key];}}newObj.default = obj;return newObj;}}function _classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError(\"Cannot call a class as a function\");}}\n\n// Manages all input interactions\nvar Interaction = function () {\n  function Interaction(main, renderer, scene, camera, controls) {var _this = this;_classCallCheck(this, Interaction);\n    // Firebase\n    this.stoRef = main.stoRef;\n    this.dbRef = main.dbRef;\n    this.roomCode = main.roomCode;\n\n    // Properties\n    this.renderer = renderer;\n    this.scene = scene;\n    this.camera = camera;\n    this.controls = controls;\n    this.timeout = null;\n\n    // Instantiate keyboard helper\n    this.keyboard = new _keyboard2.default();\n\n    // Listeners\n    // Mouse events\n\n    this.renderer.domElement.addEventListener('mousemove', function (event) {return _this.onMouseMove(main, event);}, false);\n    this.renderer.domElement.addEventListener('mouseleave', function (event) {return _this.onMouseUp(main, event, false);}, false);\n    this.renderer.domElement.addEventListener('mouseover', function (event) {return _this.onMouseOver(event);}, false);\n    this.renderer.domElement.addEventListener('mouseup', function (event) {return _this.onMouseUp(main, event, true);}, false);\n    this.renderer.domElement.addEventListener('mousedown', function (event) {return _this.onMouseDown(main, event);}, false);\n\n    this.roomInput = document.getElementById('splashscreen');\n\n    this.pasteController = {\n      Meta: false,\n      v: false };\n\n    this.clickingOnCone = false;\n\n    // Keyboard events\n    this.keyboard.domElement.addEventListener('keydown', function (event) {\n      if (_this.roomInput.style.display == 'block') {\n        var codeEntry = document.getElementById('roomcode');\n        if (_this.keyboard.eventMatches(event, 'meta')) {\n          _this.pasteController['Meta'] = true;\n        }\n        if (_this.keyboard.eventMatches(event, 'v')) {\n          _this.pasteController['v'] = true;\n        }\n\n        if (_this.keyboard.eventMatches(event, 'backspace') ||\n        _this.keyboard.eventMatches(event, 'delete')) {\n          if (codeEntry.value.length > 0) {\n            codeEntry.value = codeEntry.value.slice(0, -1);\n          }\n        } else if (_this.pasteController['Meta'] && _this.pasteController['v']) {\n          if (navigator.clipboard && window.isSecureContext) {\n            navigator.clipboard.readText().then(function (text) {\n              codeEntry.value = text;\n            });\n          }\n        } else if (codeEntry.value.length < 7 && event.which) {\n          var keycode = event.which;\n          if (keycode > 47 && keycode < 58 ||\n          keycode > 64 && keycode < 91 ||\n          keycode > 95 && keycode < 112) {\n            codeEntry.value += String.fromCharCode(keycode);\n          }\n        }\n        return;\n      }\n\n      if (event.simulate || event.target.tagName === \"BODY\" && !event.ctrlKey && !event.metaKey) {\n\n        // Only once\n        if (event.repeat) {\n          return;\n        }\n\n        if (event.metaKey) {\n          return false;\n        }\n\n        if (_this.keyboard.eventMatches(event, 'w')) {\n          document.getElementById('help-head').style.display = 'none';\n          main.moveForward = 1 * main.movementSpeed;\n          main.isAllowMouseDrag = false;\n        }\n\n        if (_this.keyboard.eventMatches(event, 'a')) {\n          document.getElementById('help-head').style.display = 'none';\n          main.yawRight = 1 * main.rotationSpeed;\n          main.isAllowMouseDrag = false;\n        }\n\n        if (_this.keyboard.eventMatches(event, 'd')) {\n          document.getElementById('help-head').style.display = 'none';\n          main.yawLeft = 1 * main.rotationSpeed;\n          main.isAllowMouseDrag = false;\n        }\n\n        if (_this.keyboard.eventMatches(event, 's')) {\n          document.getElementById('help-head').style.display = 'none';\n          main.moveBackwards = 1 * main.movementSpeed;\n          main.isAllowMouseDrag = false;\n        }\n\n        if (_this.keyboard.eventMatches(event, 'backspace') ||\n        _this.keyboard.eventMatches(event, 'delete')) {\n          if (main.activeObject && main.activeObject.type === 'SoundTrajectory') {\n            if (main.activeObject.selectedPoint && main.activeObject.splinePoints.length > 2) {\n              main.activeObject.removePoint();\n            }\n          }\n\n          if (main.activeObject && main.activeObject.type === 'SoundZone') {\n            if (main.activeObject.selectedPoint && main.activeObject.splinePoints.length > 3) {\n              main.activeObject.removePoint();\n            } else {\n              main.undoableActionStack.push(new _action2.default(main.activeObject, 'removeSoundZone'));\n              main.removeSoundZone(main.activeObject);\n              main.activeObject = null;\n            }\n          }\n\n          if (main.activeObject && main.activeObject.type === 'SoundObject') {\n            if (main.isEditingObject) {\n              if (main.interactiveCone) {\n                main.undoableActionStack.push(new _action2.default(main.activeObject, 'removeCone'));\n                main.undoableActionStack[main.undoableActionStack.length - 1].secondary = main.interactiveCone;\n                main.removeCone(main.activeObject, main.interactiveCone);\n              } else {\n                // toggle out\n                main.exitEditObjectView();\n\n                main.undoableActionStack.push(new _action2.default(main.activeObject, 'removeFullObject'));\n                main.undoableActionStack[main.undoableActionStack.length - 1].secondary = main.activeObject.trajectory;\n\n                if (main.activeObject.trajectory) {\n                  main.removeSoundTrajectory(main.activeObject.trajectory);\n                }\n                main.removeSoundObject(main.activeObject);\n                main.activeObject = null;\n              }\n            } else\n            {\n              main.undoableActionStack.push(new _action2.default(main.activeObject, 'removeFullObject'));\n              main.undoableActionStack[main.undoableActionStack.length - 1].secondary = main.activeObject.trajectory;\n\n              if (main.activeObject.trajectory) {\n                main.removeSoundTrajectory(main.activeObject.trajectory);\n              }\n\n              main.removeSoundObject(main.activeObject);\n\n              main.activeObject = null;\n            }\n          }\n        }\n\n        if (_this.keyboard.eventMatches(event, 'bracket-left')) {\n          main.undo();\n        }\n\n        if (_this.keyboard.eventMatches(event, 'bracket-right')) {\n          main.redo();\n        }\n\n        if (_config2.default.isDev) {\n          if (_this.keyboard.eventMatches(event, 'h')) {\n            var base = document.getElementsByClassName('rs-base')[0];\n\n            if (base.style.display === 'none') base.style.display = 'block';else\n            base.style.display = 'none';\n          }\n        }\n      }\n    });\n\n    this.keyboard.domElement.addEventListener('keyup', function (event) {\n      // Only once\n      if (event.repeat) {\n        return;\n      }\n\n      if (event.metaKey) {\n        return false;\n      }\n\n      if (_this.keyboard.eventMatches(event, 'w')) {\n        main.moveForward = 0;\n        main.movedHead = true;\n      }\n\n      if (_this.keyboard.eventMatches(event, 'a')) {\n        main.yawRight = 0;\n        main.movedHead = true;\n      }\n\n      if (_this.keyboard.eventMatches(event, 'd')) {\n        main.yawLeft = 0;\n        main.movedHead = true;\n      }\n\n      if (_this.keyboard.eventMatches(event, 's')) {\n        main.moveBackwards = 0;\n        main.movedHead = true;\n      }\n\n      if (_this.keyboard.eventMatches(event, 'meta')) {\n        _this.pasteController['Meta'] = false;\n      }\n\n      if (_this.keyboard.eventMatches(event, 'v')) {\n        _this.pasteController['v'] = false;\n      }\n\n      // if (this.keyboard.eventMatches(event, 'r')) {\n      //   main.reset(true);\n      // }\n\n      if (_this.keyboard.eventMatches(event, 'u')) {\n        main.isUserStudyLoading = !main.isUserStudyLoading;\n        document.getElementById('help-add').style.display = 'none';\n        document.getElementById('help-camera').style.display = 'none';\n        document.getElementById('help-head').style.display = 'none';\n      }\n    });\n  }_createClass(Interaction, [{ key: 'onMouseOver', value: function onMouseOver(\n\n    event) {\n      event.preventDefault();\n\n      _config2.default.isMouseOver = true;\n    } }, { key: 'onMouseLeave', value: function onMouseLeave(\n\n    event) {\n      event.preventDefault();\n      _config2.default.isMouseOver = false;\n    } }, { key: 'onMouseMove', value: function onMouseMove(\n\n    main, event) {\n      event.preventDefault();\n\n      clearTimeout(this.timeout);\n      this.timeout = setTimeout(function () {_config2.default.isMouseMoving = false;}, 200);\n\n      _config2.default.isMouseMoving = true;\n\n      main.setMousePosition(event);\n      if (main.isMouseDown === true && !main.isEditingObject) {\n        if (main.isAddingTrajectory === true) {\n          if (main.activeObject.type === 'SoundObject' || main.activeObject.type === 'HeadObject') {\n            main.mouse.y = main.activeObject.containerObject.position.y;\n            main.path.addPoint(main.mouse);\n          }\n        }\n\n        if (main.isAddingObject === true) {\n          main.path.addPoint(main.mouse);\n        }\n\n        if (main.activeObject) {\n          if (main.activeObject.type === 'SoundTrajectory') {\n            main.activeObject.move(main.mouse, main.nonScaledMouse, main.perspectiveView);\n          } else\n          if (main.isAddingTrajectory === true && main.activeObject.type === 'SoundObject') {\n            main.activeObject.move(main, true);\n          } else\n          {\n            main.activeObject.move(main, false);\n          }\n        }\n      } //end if(main.isMouseDown...)\n\n      // show cursor on hover\n      else if (!main.isEditingObject && main.activeObject) {\n          // make sure object to raycast to is the trajectory\n          var obj = main.activeObject;\n          if (obj.type === 'SoundObject' || obj.type === 'HeadObject') {\n            if (obj.trajectory) {\n              obj = obj.trajectory;\n            } else\n            if (obj.type === 'HeadObject') {\n              main.headObjectTooltip();\n              return;\n            }\n          }\n\n          switch (obj.type) {\n            case 'SoundTrajectory':\n            case 'SoundZone':\n              var intersection = obj.objectUnderMouse(main.ray);\n              if (intersection) {\n                obj.showCursor(intersection.object, intersection.point);\n              } else\n              {\n                obj.hideCursor();\n              }\n              break;\n            default:\n              break;}\n\n\n        }\n\n      if (main.isEditingObject) {\n        var intersect3 = void 0;\n\n        // make sure the mouseisdown over the cone\n        if (main.isMouseDown && this.clickingOnCone) {\n          // point cone towards mouse pointer\n          intersect3 = main.ray.intersectObject(main.activeObject.raycastSphere)[0];\n\n          if (main.interactiveCone != null && intersect3) {\n            var longlat = main.activeObject.pointCone(main.interactiveCone, intersect3.point);\n            // update Firebase with new latitude and longitude\n            if (main.roomCode) {\n              if (main.activeObject.finishUploadingSound) {\n                main.activeObject.dbRef.child('objects').child(main.activeObject.containerObject.name).child('cones').child(main.interactiveCone.uuid).update({\n                  longitude: longlat[0],\n                  latitude: longlat[1],\n                  lastEdit: main.headKey.key });\n\n              }\n            }\n          }\n        } else\n        {\n          intersect3 = main.ray.intersectObjects(main.activeObject.cones)[0];\n\n          // temp set color on hover\n          main.activeObject.cones.forEach(function (cone) {\n            if (intersect3 && intersect3.object.uuid === cone.uuid) {\n              cone.isHighlighted = true;\n              cone.material.color.set(cone.hoverColor());\n            } else\n            if (cone.isHighlighted) {\n              cone.isHighlighted = false;\n              var materialColor = cone.userSetPlay ? cone.baseColor : 0x8F8F8F;\n              cone.material.color.set(materialColor);\n            }\n          });\n        }\n      } //end if(main.isEditingObject)\n      main.headObjectTooltip();\n    } }, { key: 'onMouseUp', value: function onMouseUp(\n\n    main, event, hasFocus) {\n      // turn gui pointer events back on\n      main.gui.enable();\n      document.getElementById('GlobalContainer').style.pointerEvents = 'auto';\n\n      // turn controls back on\n      main.controls.enable();\n      this.clickingOnCone = false;\n      // mouse leaves the container\n      if (!hasFocus) {_config2.default.isMouseOver = false;}\n      if (main.isMouseDown === false) {return;}\n\n      // actual mouseup interaction\n      main.setMousePosition(event);\n      var obj = void 0;\n\n      if (main.isAddingTrajectory) {\n        obj = main.path.createObject(main);\n        if (main.roomCode) {\n          obj.ownerHeadKey = main.headKey.key;\n        }\n\n        main.toggleAddTrajectory(false);\n      }\n\n      if (main.isAddingObject) {\n        obj = main.path.createObject(main);\n\n        main.setActiveObject(obj);\n        main.toggleAddObject();\n        main.isAddingObject = false;\n      }\n\n\n      if (main.isEditingObject) {\n        if (main.interactiveCone) {\n          main.interactiveCone.material.color.set(main.interactiveCone.baseColor);\n        }\n      }\n      main.isMouseDown = false;\n\n      for (var i in main.soundObjects) {\n        if (main.soundObjects[i].type === 'SoundObject') main.soundObjects[i].calculateMovementSpeed();\n      }\n\n      if (main.headObject.trajectory) {\n        main.headObject.calculateMovementSpeed();\n      }\n    } }, { key: 'onMouseDown', value: function onMouseDown(\n\n    main) {\n      if (this.roomInput.style.display == 'block') {\n        document.getElementById('splashscreen').style.display = 'none';\n      }\n      // turn gui events off when interacting with scene objects\n      main.gui.disable();\n      document.getElementById('GlobalContainer').style.pointerEvents = 'none';\n\n      /**\n                                                                                * !keyPressed is added to avoid interaction with object when the camera\n                                                                                * is being rotated. It can (should) be changed into a flag more specific\n                                                                                * to this action.\n                                                                                */\n\n      if (!main.keyPressed) {\n        main.isMouseDown = true;\n\n        /**\n                                  * Create a collection array of all the object in the scene and check if\n                                  * any of these objects isUnderMouse (a function which is passed our raycaster).\n                                  *\n                                  * If there is indeed an intersected object, set it as the activeObject.\n                                  */\n        var everyComponent = [].concat(main.soundObjects, main.headObject, main.soundTrajectories, main.soundZones);\n        var intersectObjects = everyComponent.filter(function (obj) {\n          return obj.isUnderMouse(main.ray);\n        });\n\n        // if adding trajectory, check that mousedown is valid\n        main.isAddingTrajectory = main.isAddingTrajectory && intersectObjects[0] === main.activeObject;\n\n        // set activeObject to intersected object\n\n        if (!main.isEditingObject) {\n          if (intersectObjects.length > 0 && !main.isAddingObject) {\n            // if soundzones overlap, keep last selected\n            if (intersectObjects[0].type !== 'SoundTrajectory' && !(main.activeObject && main.activeObject.type === 'SoundZone' && intersectObjects[0].type === 'SoundZone' && intersectObjects.indexOf(main.activeObject) > -1)) {\n              main.setActiveObject(intersectObjects[0]);\n            } else\n            if (intersectObjects[0].type === 'SoundTrajectory') {\n              if (main.roomCode == null || intersectObjects[0].parentSoundObject.type !== 'HeadObject' || intersectObjects[0].parentSoundObject.type === 'HeadObject' && main.roomCode && intersectObjects[0].ownerHeadKey == main.headKey.key) {\n                main.setActiveObject(intersectObjects[0]);\n              }\n            }\n          } else\n          {\n            main.setActiveObject(null);\n          }\n        }\n        // disable controls when add or moving an object\n        if (main.isAddingTrajectory || main.isAddingObject || main.activeObject && !main.isEditingObject) {\n          main.controls.disable();\n        }\n\n        /**\n           * If adding a trajectory, ask the trajectory interface to initate a new\n           * trajectory at the mouse position determined in setMousePosition()\n           *\n           * Same for the zone.\n           */\n        if (main.isAddingTrajectory) {\n          main.mouse.y = main.activeObject.containerObject.position.y;\n          main.path.beginAt(main.mouse, main.activeObject);\n        }\n\n        if (main.isAddingObject) {\n          main.path.beginAt(main.mouse);\n        }\n\n        /* If the most recent active object interacted with again, select it: */\n        if (main.activeObject && main.activeObject.isUnderMouse(main.ray)) {\n          // click inside active object\n          if (main.activeObject.type != 'SoundObject' && main.activeObject.type != 'HeadObject') {\n            var intersect = main.activeObject.objectUnderMouse(main.ray);\n            main.activeObject.select(intersect, main);\n          } else {\n            main.activeObject.select(main);\n          }\n        }\n\n        /**\n           * In object edit mode a different interaction scheme is followed.\n           */\n        if (main.isEditingObject) {\n          if (!main.activeObject || !main.activeObject.cones) {\n            console.log('wheres my cone :(', main.activeObject); //error check\n          }\n\n          var intersect2 = main.ray.intersectObjects(main.activeObject.cones)[0];\n          if (intersect2) {\n            this.clickingOnCone = true;\n            main.interactiveCone = intersect2.object;\n            main.controls.disable();\n          }\n          // else {\n          //   main.interactiveCone = null;\n          // }\n        }\n      }\n    } }]);return Interaction;}();exports.default = Interaction;\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/js/app/managers/interaction.js\n// module id = 38\n// module chunks = 0\n\n//# sourceURL=webpack:///./src/js/app/managers/interaction.js?");

/***/ }),
/* 39 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("Object.defineProperty(exports, \"__esModule\", { value: true });var _createClass = function () {function defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if (\"value\" in descriptor) descriptor.writable = true;Object.defineProperty(target, descriptor.key, descriptor);}}return function (Constructor, protoProps, staticProps) {if (protoProps) defineProperties(Constructor.prototype, protoProps);if (staticProps) defineProperties(Constructor, staticProps);return Constructor;};}();var _three = __webpack_require__(0);var THREE = _interopRequireWildcard(_three);\n\nvar _material = __webpack_require__(16);var _material2 = _interopRequireDefault(_material);\nvar _meshHelper = __webpack_require__(34);var _meshHelper2 = _interopRequireDefault(_meshHelper);\nvar _helpers = __webpack_require__(2);var _helpers2 = _interopRequireDefault(_helpers);\nvar _config = __webpack_require__(1);var _config2 = _interopRequireDefault(_config);function _interopRequireDefault(obj) {return obj && obj.__esModule ? obj : { default: obj };}function _interopRequireWildcard(obj) {if (obj && obj.__esModule) {return obj;} else {var newObj = {};if (obj != null) {for (var key in obj) {if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key];}}newObj.default = obj;return newObj;}}function _classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError(\"Cannot call a class as a function\");}}\n\n// Loads in a single object from the config file\nvar Model = function () {\n  function Model(scene, loader) {_classCallCheck(this, Model);\n    this.scene = scene;\n\n    // Manager is passed in to loader to determine when loading done in main\n    this.loader = loader;\n    this.obj = null;\n  }_createClass(Model, [{ key: 'load', value: function load(\n\n    locked) {var name = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;var pos = arguments[2];var _this = this;var otherHeadKey = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : null;var dbRef = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : null;\n      // Load model with ObjectLoader\n      this.loader.load(_config2.default.model.path, function (obj) {\n        obj.traverse(function (child) {\n          if (child instanceof THREE.Mesh) {\n            // Create material for mesh and set its map to texture by name from preloaded textures\n            var color = '0x';\n            if (locked) {\n              color = _this.getRandomColor();\n            } else {\n              color = 0x44aaff;\n            }\n            var material = new _material2.default(color).basic;\n            child.material = material;\n            material.transparent = true;\n            if (locked) {\n              material.opacity = 0.5;\n            } else {\n              material.opacity = 0.8;\n            }\n\n            // Set to cast and receive shadow if enabled\n            if (_config2.default.shadow.enabled) {\n              child.receiveShadow = true;\n              child.castShadow = true;\n            }\n          }\n        });\n\n        // Set prop to obj\n        _this.obj = obj;\n\n        obj.name = name;\n        if (!name) {\n          obj.name = 'dummyHead';\n        }\n\n        if (!locked) {\n          obj.position.y = 0; // necessary for raycasting onto the zone shape\n        } else {\n          obj.position.copy(new THREE.Vector3(pos.x, pos.y, pos.z));\n        }\n\n        obj.rotation.y += Math.PI;\n        obj.scale.multiplyScalar(_config2.default.model.scale);\n\n        _this.scene.add(obj);\n        if (dbRef != null) {\n          dbRef.child('users').child(otherHeadKey).update({});\n        }\n      });\n    } }, { key: 'getRandomColor', value: function getRandomColor()\n\n    {\n      var letters = '0123456789ABCDEF';\n      var color = '#';\n      for (var i = 0; i < 6; i++) {\n        color += letters[Math.floor(Math.random() * 16)];\n      }\n      return color;\n    } }]);return Model;}();exports.default = Model;\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/js/app/model/model.js\n// module id = 39\n// module chunks = 0\n\n//# sourceURL=webpack:///./src/js/app/model/model.js?");

/***/ }),
/* 40 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("Object.defineProperty(exports, \"__esModule\", { value: true }); /**\n                                                                             * @author alteredq / http://alteredqualia.com/\n                                                                             * @author mr.doob / http://mrdoob.com/\n                                                                             */exports.default =\n\n{\n  canvas: !!window.CanvasRenderingContext2D,\n  webgl: function () {\n    try {\n      var canvas = document.createElement('canvas');\n\n      return !!(window.WebGLRenderingContext && (canvas.getContext('webgl') || canvas.getContext('experimental-webgl')));\n    } catch (e) {\n      return false;\n    }\n  }(),\n\n  workers: !!window.Worker,\n  fileapi: window.File && window.FileReader && window.FileList && window.Blob,\n\n  getWebGLErrorMessage: function getWebGLErrorMessage() {\n    var element = document.createElement('div');\n    element.id = 'webgl-error-message';\n    element.style.fontFamily = 'monospace';\n    element.style.fontSize = '13px';\n    element.style.fontWeight = 'normal';\n    element.style.textAlign = 'center';\n    element.style.background = '#fff';\n    element.style.color = '#000';\n    element.style.padding = '1.5em';\n    element.style.width = '400px';\n    element.style.margin = '5em auto 0';\n\n    if (!this.webgl) {\n      element.innerHTML = window.WebGLRenderingContext ? [\n      'Your graphics card does not seem to support <a href=\"http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation\" style=\"color:#000000\">WebGL</a>.<br />',\n      'Find out how to get it <a href=\"http://get.webgl.org/\" style=\"color:#000000\">here</a>.'].\n      join('\\n') : [\n      'Your browser does not seem to support <a href=\"http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation\" style=\"color:#000000\">WebGL</a>.<br/>',\n      'Find out how to get it <a href=\"http://get.webgl.org/\" style=\"color:#000000\">here</a>.'].\n      join('\\n');\n    }\n\n    return element;\n  },\n\n  addGetWebGLMessage: function addGetWebGLMessage(parameters) {\n    var parent, id, element;\n\n    parameters = parameters || {};\n\n    parent = parameters.parent !== undefined ? parameters.parent : document.body;\n    id = parameters.id !== undefined ? parameters.id : 'oldie';\n\n    element = this.getWebGLErrorMessage();\n    element.id = id;\n\n    parent.appendChild(element);\n  } };\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/js/utils/detector.js\n// module id = 40\n// module chunks = 0\n\n//# sourceURL=webpack:///./src/js/utils/detector.js?");

/***/ }),
/* 41 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("Object.defineProperty(exports, \"__esModule\", { value: true });var _createClass = function () {function defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if (\"value\" in descriptor) descriptor.writable = true;Object.defineProperty(target, descriptor.key, descriptor);}}return function (Constructor, protoProps, staticProps) {if (protoProps) defineProperties(Constructor.prototype, protoProps);if (staticProps) defineProperties(Constructor, staticProps);return Constructor;};}();function _classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError(\"Cannot call a class as a function\");}}var ALIAS = {\n  'left': 37,\n  'up': 38,\n  'right': 39,\n  'down': 40,\n  'space': 32,\n  'tab': 9,\n  'backspace': 8,\n  'delete': 46,\n  'escape': 27,\n  'bracket-left': 219,\n  'bracket-right': 221,\n  'meta': 91 };var\n\n\nKeyboard = function () {\n  function Keyboard(domElement) {var _this = this;_classCallCheck(this, Keyboard);\n    this.domElement = domElement || document;\n    this.keyCodes = {};\n\n    // bind keyEvents\n    this.domElement.addEventListener('keydown', function (event) {return _this.onKeyChange(event);}, false);\n    this.domElement.addEventListener('keyup', function (event) {return _this.onKeyChange(event);}, false);\n\n    // bind window blur\n    window.addEventListener('blur', function () {return _this.onBlur;}, false);\n  }_createClass(Keyboard, [{ key: 'destroy', value: function destroy()\n\n    {var _this2 = this;\n      this.domElement.removeEventListener('keydown', function (event) {return _this2.onKeyChange(event);}, false);\n      this.domElement.removeEventListener('keyup', function (event) {return _this2.onKeyChange(event);}, false);\n\n      // unbind window blur event\n      window.removeEventListener('blur', function () {return _this2.onBlur;}, false);\n    } }, { key: 'onBlur', value: function onBlur()\n\n    {\n      for (var prop in this.keyCodes) {\n        this.keyCodes[prop] = false;}\n    } }, { key: 'onKeyChange', value: function onKeyChange(\n\n    event) {\n      // log to debug\n      //console.log('onKeyChange', event, event.keyCode, event.shiftKey, event.ctrlKey, event.altKey, event.metaKey)\n\n      // update this.keyCodes\n      var keyCode = event.keyCode;\n      this.keyCodes[keyCode] = event.type === 'keydown';\n    } }, { key: 'pressed', value: function pressed(\n\n    keyDesc) {\n      var keys = keyDesc.split('+');\n      for (var i = 0; i < keys.length; i++) {\n        var key = keys[i];\n        var pressed = false;\n        if (Object.keys(ALIAS).indexOf(key) != -1) {\n          pressed = this.keyCodes[ALIAS[key]];\n        } else {\n          pressed = this.keyCodes[key.toUpperCase().charCodeAt(0)];\n        }\n        if (!pressed)\n        return false;\n      }\n\n      return true;\n    } }, { key: 'eventMatches', value: function eventMatches(\n\n    event, keyDesc) {\n      var aliases = ALIAS;\n      var aliasKeys = Object.keys(aliases);\n      var keys = keyDesc.split('+');\n      // log to debug\n      // console.log('eventMatches', event, event.keyCode, event.shiftKey, event.ctrlKey, event.altKey, event.metaKey)\n      for (var i = 0; i < keys.length; i++) {\n        var key = keys[i];\n        var pressed = false;\n        if (key === 'shift') {\n          pressed = event.shiftKey ? true : false;\n        } else if (key === 'ctrl') {\n          pressed = event.ctrlKey ? true : false;\n        } else if (key === 'alt') {\n          pressed = event.altKey ? true : false;\n        } else if (key === 'meta') {\n          pressed = event.metaKey ? true : false;\n        } else if (aliasKeys.indexOf(key) !== -1) {\n          pressed = event.keyCode === aliases[key];\n        } else if (event.keyCode === key.toUpperCase().charCodeAt(0)) {\n          pressed = true;\n        }\n        if (!pressed)\n        return false;\n\n      }\n      return true;\n    } }]);return Keyboard;}();exports.default = Keyboard;\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/js/utils/keyboard.js\n// module id = 41\n// module chunks = 0\n\n//# sourceURL=webpack:///./src/js/utils/keyboard.js?");

/***/ }),
/* 42 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval(" /**\n               * @author mrdoob / http://mrdoob.com/\n               */\nmodule.exports = function (THREE) {\n  THREE.OBJLoader = function (manager) {\n\n    this.manager = manager !== undefined ? manager : THREE.DefaultLoadingManager;\n\n    this.materials = null;\n\n    this.regexp = {\n      // v float float float\n      vertex_pattern: /^v\\s+([\\d|\\.|\\+|\\-|e|E]+)\\s+([\\d|\\.|\\+|\\-|e|E]+)\\s+([\\d|\\.|\\+|\\-|e|E]+)/,\n      // vn float float float\n      normal_pattern: /^vn\\s+([\\d|\\.|\\+|\\-|e|E]+)\\s+([\\d|\\.|\\+|\\-|e|E]+)\\s+([\\d|\\.|\\+|\\-|e|E]+)/,\n      // vt float float\n      uv_pattern: /^vt\\s+([\\d|\\.|\\+|\\-|e|E]+)\\s+([\\d|\\.|\\+|\\-|e|E]+)/,\n      // f vertex vertex vertex\n      face_vertex: /^f\\s+(-?\\d+)\\s+(-?\\d+)\\s+(-?\\d+)(?:\\s+(-?\\d+))?/,\n      // f vertex/uv vertex/uv vertex/uv\n      face_vertex_uv: /^f\\s+(-?\\d+)\\/(-?\\d+)\\s+(-?\\d+)\\/(-?\\d+)\\s+(-?\\d+)\\/(-?\\d+)(?:\\s+(-?\\d+)\\/(-?\\d+))?/,\n      // f vertex/uv/normal vertex/uv/normal vertex/uv/normal\n      face_vertex_uv_normal: /^f\\s+(-?\\d+)\\/(-?\\d+)\\/(-?\\d+)\\s+(-?\\d+)\\/(-?\\d+)\\/(-?\\d+)\\s+(-?\\d+)\\/(-?\\d+)\\/(-?\\d+)(?:\\s+(-?\\d+)\\/(-?\\d+)\\/(-?\\d+))?/,\n      // f vertex//normal vertex//normal vertex//normal\n      face_vertex_normal: /^f\\s+(-?\\d+)\\/\\/(-?\\d+)\\s+(-?\\d+)\\/\\/(-?\\d+)\\s+(-?\\d+)\\/\\/(-?\\d+)(?:\\s+(-?\\d+)\\/\\/(-?\\d+))?/,\n      // o object_name | g group_name\n      object_pattern: /^[og]\\s*(.+)?/,\n      // s boolean\n      smoothing_pattern: /^s\\s+(\\d+|on|off)/,\n      // mtllib file_reference\n      material_library_pattern: /^mtllib /,\n      // usemtl material_name\n      material_use_pattern: /^usemtl / };\n\n\n  };\n\n  THREE.OBJLoader.prototype = {\n\n    constructor: THREE.OBJLoader,\n\n    load: function load(url, onLoad, onProgress, onError) {\n\n      var scope = this;\n\n      var loader = new THREE.FileLoader(scope.manager);\n      loader.setPath(this.path);\n      loader.load(url, function (text) {\n\n        onLoad(scope.parse(text));\n\n      }, onProgress, onError);\n\n    },\n\n    setPath: function setPath(value) {\n\n      this.path = value;\n\n    },\n\n    setMaterials: function setMaterials(materials) {\n\n      this.materials = materials;\n\n    },\n\n    _createParserState: function _createParserState() {\n\n      var state = {\n        objects: [],\n        object: {},\n\n        vertices: [],\n        normals: [],\n        uvs: [],\n\n        materialLibraries: [],\n\n        startObject: function startObject(name, fromDeclaration) {\n\n          // If the current object (initial from reset) is not from a g/o declaration in the parsed\n          // file. We need to use it for the first parsed g/o to keep things in sync.\n          if (this.object && this.object.fromDeclaration === false) {\n\n            this.object.name = name;\n            this.object.fromDeclaration = fromDeclaration !== false;\n            return;\n\n          }\n\n          var previousMaterial = this.object && typeof this.object.currentMaterial === 'function' ? this.object.currentMaterial() : undefined;\n\n          if (this.object && typeof this.object._finalize === 'function') {\n\n            this.object._finalize(true);\n\n          }\n\n          this.object = {\n            name: name || '',\n            fromDeclaration: fromDeclaration !== false,\n\n            geometry: {\n              vertices: [],\n              normals: [],\n              uvs: [] },\n\n            materials: [],\n            smooth: true,\n\n            startMaterial: function startMaterial(name, libraries) {\n\n              var previous = this._finalize(false);\n\n              // New usemtl declaration overwrites an inherited material, except if faces were declared\n              // after the material, then it must be preserved for proper MultiMaterial continuation.\n              if (previous && (previous.inherited || previous.groupCount <= 0)) {\n\n                this.materials.splice(previous.index, 1);\n\n              }\n\n              var material = {\n                index: this.materials.length,\n                name: name || '',\n                mtllib: Array.isArray(libraries) && libraries.length > 0 ? libraries[libraries.length - 1] : '',\n                smooth: previous !== undefined ? previous.smooth : this.smooth,\n                groupStart: previous !== undefined ? previous.groupEnd : 0,\n                groupEnd: -1,\n                groupCount: -1,\n                inherited: false,\n\n                clone: function clone(index) {\n                  var cloned = {\n                    index: typeof index === 'number' ? index : this.index,\n                    name: this.name,\n                    mtllib: this.mtllib,\n                    smooth: this.smooth,\n                    groupStart: 0,\n                    groupEnd: -1,\n                    groupCount: -1,\n                    inherited: false };\n\n                  cloned.clone = this.clone.bind(cloned);\n                  return cloned;\n                } };\n\n\n              this.materials.push(material);\n\n              return material;\n\n            },\n\n            currentMaterial: function currentMaterial() {\n\n              if (this.materials.length > 0) {\n                return this.materials[this.materials.length - 1];\n              }\n\n              return undefined;\n\n            },\n\n            _finalize: function _finalize(end) {\n\n              var lastMultiMaterial = this.currentMaterial();\n              if (lastMultiMaterial && lastMultiMaterial.groupEnd === -1) {\n\n                lastMultiMaterial.groupEnd = this.geometry.vertices.length / 3;\n                lastMultiMaterial.groupCount = lastMultiMaterial.groupEnd - lastMultiMaterial.groupStart;\n                lastMultiMaterial.inherited = false;\n\n              }\n\n              // Ignore objects tail materials if no face declarations followed them before a new o/g started.\n              if (end && this.materials.length > 1) {\n\n                for (var mi = this.materials.length - 1; mi >= 0; mi--) {\n                  if (this.materials[mi].groupCount <= 0) {\n                    this.materials.splice(mi, 1);\n                  }\n                }\n\n              }\n\n              // Guarantee at least one empty material, this makes the creation later more straight forward.\n              if (end && this.materials.length === 0) {\n\n                this.materials.push({\n                  name: '',\n                  smooth: this.smooth });\n\n\n              }\n\n              return lastMultiMaterial;\n\n            } };\n\n\n          // Inherit previous objects material.\n          // Spec tells us that a declared material must be set to all objects until a new material is declared.\n          // If a usemtl declaration is encountered while this new object is being parsed, it will\n          // overwrite the inherited material. Exception being that there was already face declarations\n          // to the inherited material, then it will be preserved for proper MultiMaterial continuation.\n\n          if (previousMaterial && previousMaterial.name && typeof previousMaterial.clone === \"function\") {\n\n            var declared = previousMaterial.clone(0);\n            declared.inherited = true;\n            this.object.materials.push(declared);\n\n          }\n\n          this.objects.push(this.object);\n\n        },\n\n        finalize: function finalize() {\n\n          if (this.object && typeof this.object._finalize === 'function') {\n\n            this.object._finalize(true);\n\n          }\n\n        },\n\n        parseVertexIndex: function parseVertexIndex(value, len) {\n\n          var index = parseInt(value, 10);\n          return (index >= 0 ? index - 1 : index + len / 3) * 3;\n\n        },\n\n        parseNormalIndex: function parseNormalIndex(value, len) {\n\n          var index = parseInt(value, 10);\n          return (index >= 0 ? index - 1 : index + len / 3) * 3;\n\n        },\n\n        parseUVIndex: function parseUVIndex(value, len) {\n\n          var index = parseInt(value, 10);\n          return (index >= 0 ? index - 1 : index + len / 2) * 2;\n\n        },\n\n        addVertex: function addVertex(a, b, c) {\n\n          var src = this.vertices;\n          var dst = this.object.geometry.vertices;\n\n          dst.push(src[a + 0]);\n          dst.push(src[a + 1]);\n          dst.push(src[a + 2]);\n          dst.push(src[b + 0]);\n          dst.push(src[b + 1]);\n          dst.push(src[b + 2]);\n          dst.push(src[c + 0]);\n          dst.push(src[c + 1]);\n          dst.push(src[c + 2]);\n\n        },\n\n        addVertexLine: function addVertexLine(a) {\n\n          var src = this.vertices;\n          var dst = this.object.geometry.vertices;\n\n          dst.push(src[a + 0]);\n          dst.push(src[a + 1]);\n          dst.push(src[a + 2]);\n\n        },\n\n        addNormal: function addNormal(a, b, c) {\n\n          var src = this.normals;\n          var dst = this.object.geometry.normals;\n\n          dst.push(src[a + 0]);\n          dst.push(src[a + 1]);\n          dst.push(src[a + 2]);\n          dst.push(src[b + 0]);\n          dst.push(src[b + 1]);\n          dst.push(src[b + 2]);\n          dst.push(src[c + 0]);\n          dst.push(src[c + 1]);\n          dst.push(src[c + 2]);\n\n        },\n\n        addUV: function addUV(a, b, c) {\n\n          var src = this.uvs;\n          var dst = this.object.geometry.uvs;\n\n          dst.push(src[a + 0]);\n          dst.push(src[a + 1]);\n          dst.push(src[b + 0]);\n          dst.push(src[b + 1]);\n          dst.push(src[c + 0]);\n          dst.push(src[c + 1]);\n\n        },\n\n        addUVLine: function addUVLine(a) {\n\n          var src = this.uvs;\n          var dst = this.object.geometry.uvs;\n\n          dst.push(src[a + 0]);\n          dst.push(src[a + 1]);\n\n        },\n\n        addFace: function addFace(a, b, c, d, ua, ub, uc, ud, na, nb, nc, nd) {\n\n          var vLen = this.vertices.length;\n\n          var ia = this.parseVertexIndex(a, vLen);\n          var ib = this.parseVertexIndex(b, vLen);\n          var ic = this.parseVertexIndex(c, vLen);\n          var id;\n\n          if (d === undefined) {\n\n            this.addVertex(ia, ib, ic);\n\n          } else {\n\n            id = this.parseVertexIndex(d, vLen);\n\n            this.addVertex(ia, ib, id);\n            this.addVertex(ib, ic, id);\n\n          }\n\n          if (ua !== undefined) {\n\n            var uvLen = this.uvs.length;\n\n            ia = this.parseUVIndex(ua, uvLen);\n            ib = this.parseUVIndex(ub, uvLen);\n            ic = this.parseUVIndex(uc, uvLen);\n\n            if (d === undefined) {\n\n              this.addUV(ia, ib, ic);\n\n            } else {\n\n              id = this.parseUVIndex(ud, uvLen);\n\n              this.addUV(ia, ib, id);\n              this.addUV(ib, ic, id);\n\n            }\n\n          }\n\n          if (na !== undefined) {\n\n            // Normals are many times the same. If so, skip function call and parseInt.\n            var nLen = this.normals.length;\n            ia = this.parseNormalIndex(na, nLen);\n\n            ib = na === nb ? ia : this.parseNormalIndex(nb, nLen);\n            ic = na === nc ? ia : this.parseNormalIndex(nc, nLen);\n\n            if (d === undefined) {\n\n              this.addNormal(ia, ib, ic);\n\n            } else {\n\n              id = this.parseNormalIndex(nd, nLen);\n\n              this.addNormal(ia, ib, id);\n              this.addNormal(ib, ic, id);\n\n            }\n\n          }\n\n        },\n\n        addLineGeometry: function addLineGeometry(vertices, uvs) {\n\n          this.object.geometry.type = 'Line';\n\n          var vLen = this.vertices.length;\n          var uvLen = this.uvs.length;\n\n          for (var vi = 0, l = vertices.length; vi < l; vi++) {\n\n            this.addVertexLine(this.parseVertexIndex(vertices[vi], vLen));\n\n          }\n\n          for (var uvi = 0, l = uvs.length; uvi < l; uvi++) {\n\n            this.addUVLine(this.parseUVIndex(uvs[uvi], uvLen));\n\n          }\n\n        } };\n\n\n\n      state.startObject('', false);\n\n      return state;\n\n    },\n\n    parse: function parse(text) {\n\n      console.time('OBJLoader');\n\n      var state = this._createParserState();\n\n      if (text.indexOf('\\r\\n') !== -1) {\n\n        // This is faster than String.split with regex that splits on both\n        text = text.replace(/\\r\\n/g, '\\n');\n\n      }\n\n      if (text.indexOf('\\\\\\n') !== -1) {\n\n        // join lines separated by a line continuation character (\\)\n        text = text.replace(/\\\\\\n/g, '');\n\n      }\n\n      var lines = text.split('\\n');\n      var line = '',lineFirstChar = '',lineSecondChar = '';\n      var lineLength = 0;\n      var result = [];\n\n      // Faster to just trim left side of the line. Use if available.\n      var trimLeft = typeof ''.trimLeft === 'function';\n\n      for (var i = 0, l = lines.length; i < l; i++) {\n\n        line = lines[i];\n\n        line = trimLeft ? line.trimLeft() : line.trim();\n\n        lineLength = line.length;\n\n        if (lineLength === 0) continue;\n\n        lineFirstChar = line.charAt(0);\n\n        // @todo invoke passed in handler if any\n        if (lineFirstChar === '#') continue;\n\n        if (lineFirstChar === 'v') {\n\n          lineSecondChar = line.charAt(1);\n\n          if (lineSecondChar === ' ' && (result = this.regexp.vertex_pattern.exec(line)) !== null) {\n\n            // 0                  1      2      3\n            // [\"v 1.0 2.0 3.0\", \"1.0\", \"2.0\", \"3.0\"]\n\n            state.vertices.push(\n            parseFloat(result[1]),\n            parseFloat(result[2]),\n            parseFloat(result[3]));\n\n\n          } else if (lineSecondChar === 'n' && (result = this.regexp.normal_pattern.exec(line)) !== null) {\n\n            // 0                   1      2      3\n            // [\"vn 1.0 2.0 3.0\", \"1.0\", \"2.0\", \"3.0\"]\n\n            state.normals.push(\n            parseFloat(result[1]),\n            parseFloat(result[2]),\n            parseFloat(result[3]));\n\n\n          } else if (lineSecondChar === 't' && (result = this.regexp.uv_pattern.exec(line)) !== null) {\n\n            // 0               1      2\n            // [\"vt 0.1 0.2\", \"0.1\", \"0.2\"]\n\n            state.uvs.push(\n            parseFloat(result[1]),\n            parseFloat(result[2]));\n\n\n          } else {\n\n            throw new Error(\"Unexpected vertex/normal/uv line: '\" + line + \"'\");\n\n          }\n\n        } else if (lineFirstChar === \"f\") {\n\n          if ((result = this.regexp.face_vertex_uv_normal.exec(line)) !== null) {\n\n            // f vertex/uv/normal vertex/uv/normal vertex/uv/normal\n            // 0                        1    2    3    4    5    6    7    8    9   10         11         12\n            // [\"f 1/1/1 2/2/2 3/3/3\", \"1\", \"1\", \"1\", \"2\", \"2\", \"2\", \"3\", \"3\", \"3\", undefined, undefined, undefined]\n\n            state.addFace(\n            result[1], result[4], result[7], result[10],\n            result[2], result[5], result[8], result[11],\n            result[3], result[6], result[9], result[12]);\n\n\n          } else if ((result = this.regexp.face_vertex_uv.exec(line)) !== null) {\n\n            // f vertex/uv vertex/uv vertex/uv\n            // 0                  1    2    3    4    5    6   7          8\n            // [\"f 1/1 2/2 3/3\", \"1\", \"1\", \"2\", \"2\", \"3\", \"3\", undefined, undefined]\n\n            state.addFace(\n            result[1], result[3], result[5], result[7],\n            result[2], result[4], result[6], result[8]);\n\n\n          } else if ((result = this.regexp.face_vertex_normal.exec(line)) !== null) {\n\n            // f vertex//normal vertex//normal vertex//normal\n            // 0                     1    2    3    4    5    6   7          8\n            // [\"f 1//1 2//2 3//3\", \"1\", \"1\", \"2\", \"2\", \"3\", \"3\", undefined, undefined]\n\n            state.addFace(\n            result[1], result[3], result[5], result[7],\n            undefined, undefined, undefined, undefined,\n            result[2], result[4], result[6], result[8]);\n\n\n          } else if ((result = this.regexp.face_vertex.exec(line)) !== null) {\n\n            // f vertex vertex vertex\n            // 0            1    2    3   4\n            // [\"f 1 2 3\", \"1\", \"2\", \"3\", undefined]\n\n            state.addFace(\n            result[1], result[2], result[3], result[4]);\n\n\n          } else {\n\n            throw new Error(\"Unexpected face line: '\" + line + \"'\");\n\n          }\n\n        } else if (lineFirstChar === \"l\") {\n\n          var lineParts = line.substring(1).trim().split(\" \");\n          var lineVertices = [],lineUVs = [];\n\n          if (line.indexOf(\"/\") === -1) {\n\n            lineVertices = lineParts;\n\n          } else {\n\n            for (var li = 0, llen = lineParts.length; li < llen; li++) {\n\n              var parts = lineParts[li].split(\"/\");\n\n              if (parts[0] !== \"\") lineVertices.push(parts[0]);\n              if (parts[1] !== \"\") lineUVs.push(parts[1]);\n\n            }\n\n          }\n          state.addLineGeometry(lineVertices, lineUVs);\n\n        } else if ((result = this.regexp.object_pattern.exec(line)) !== null) {\n\n          // o object_name\n          // or\n          // g group_name\n\n          // WORKAROUND: https://bugs.chromium.org/p/v8/issues/detail?id=2869\n          // var name = result[ 0 ].substr( 1 ).trim();\n          var name = (\" \" + result[0].substr(1).trim()).substr(1);\n\n          state.startObject(name);\n\n        } else if (this.regexp.material_use_pattern.test(line)) {\n\n          // material\n\n          state.object.startMaterial(line.substring(7).trim(), state.materialLibraries);\n\n        } else if (this.regexp.material_library_pattern.test(line)) {\n\n          // mtl file\n\n          state.materialLibraries.push(line.substring(7).trim());\n\n        } else if ((result = this.regexp.smoothing_pattern.exec(line)) !== null) {\n\n          // smooth shading\n\n          // @todo Handle files that have varying smooth values for a set of faces inside one geometry,\n          // but does not define a usemtl for each face set.\n          // This should be detected and a dummy material created (later MultiMaterial and geometry groups).\n          // This requires some care to not create extra material on each smooth value for \"normal\" obj files.\n          // where explicit usemtl defines geometry groups.\n          // Example asset: examples/models/obj/cerberus/Cerberus.obj\n\n          var value = result[1].trim().toLowerCase();\n          state.object.smooth = value === '1' || value === 'on';\n\n          var material = state.object.currentMaterial();\n          if (material) {\n\n            material.smooth = state.object.smooth;\n\n          }\n\n        } else {\n\n          // Handle null terminated files without exception\n          if (line === '\\0') continue;\n\n          throw new Error(\"Unexpected line: '\" + line + \"'\");\n\n        }\n\n      }\n\n      state.finalize();\n\n      var container = new THREE.Group();\n      container.materialLibraries = [].concat(state.materialLibraries);\n\n      for (var i = 0, l = state.objects.length; i < l; i++) {\n\n        var object = state.objects[i];\n        var geometry = object.geometry;\n        var materials = object.materials;\n        var isLine = geometry.type === 'Line';\n\n        // Skip o/g line declarations that did not follow with any faces\n        if (geometry.vertices.length === 0) continue;\n\n        var buffergeometry = new THREE.BufferGeometry();\n\n        buffergeometry.setAttribute('position', new THREE.BufferAttribute(new Float32Array(geometry.vertices), 3));\n\n        if (geometry.normals.length > 0) {\n\n          buffergeometry.setAttribute('normal', new THREE.BufferAttribute(new Float32Array(geometry.normals), 3));\n\n        } else {\n\n          buffergeometry.computeVertexNormals();\n\n        }\n\n        if (geometry.uvs.length > 0) {\n\n          buffergeometry.setAttribute('uv', new THREE.BufferAttribute(new Float32Array(geometry.uvs), 2));\n\n        }\n\n        // Create materials\n\n        var createdMaterials = [];\n\n        for (var mi = 0, miLen = materials.length; mi < miLen; mi++) {\n\n          var sourceMaterial = materials[mi];\n          var material = undefined;\n\n          if (this.materials !== null) {\n\n            material = this.materials.create(sourceMaterial.name);\n\n            // mtl etc. loaders probably can't create line materials correctly, copy properties to a line material.\n            if (isLine && material && !(material instanceof THREE.LineBasicMaterial)) {\n\n              var materialLine = new THREE.LineBasicMaterial();\n              materialLine.copy(material);\n              material = materialLine;\n\n            }\n\n          }\n\n          if (!material) {\n\n            material = !isLine ? new THREE.MeshPhongMaterial() : new THREE.LineBasicMaterial();\n            material.name = sourceMaterial.name;\n\n          }\n\n          material.shading = sourceMaterial.smooth ? THREE.SmoothShading : THREE.FlatShading;\n\n          createdMaterials.push(material);\n\n        }\n\n        // Create mesh\n\n        var mesh;\n\n        if (createdMaterials.length > 1) {\n\n          for (var mi = 0, miLen = materials.length; mi < miLen; mi++) {\n\n            var sourceMaterial = materials[mi];\n            buffergeometry.addGroup(sourceMaterial.groupStart, sourceMaterial.groupCount, mi);\n\n          }\n\n          var multiMaterial = new THREE.MultiMaterial(createdMaterials);\n          mesh = !isLine ? new THREE.Mesh(buffergeometry, multiMaterial) : new THREE.LineSegments(buffergeometry, multiMaterial);\n\n        } else {\n\n          mesh = !isLine ? new THREE.Mesh(buffergeometry, createdMaterials[0]) : new THREE.LineSegments(buffergeometry, createdMaterials[0]);\n        }\n\n        mesh.name = object.name;\n\n        container.add(mesh);\n\n      }\n\n      console.timeEnd('OBJLoader');\n\n      return container;\n\n    } };\n\n\n};\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/js/utils/objloader.js\n// module id = 42\n// module chunks = 0\n\n//# sourceURL=webpack:///./src/js/utils/objloader.js?");

/***/ }),
/* 43 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("module.exports = function (THREE) {\n  var MOUSE = THREE.MOUSE;\n  if (!MOUSE)\n  MOUSE = { LEFT: 0, MIDDLE: 1, RIGHT: 2 };\n\n  /**\n                                             * @author qiao / https://github.com/qiao\n                                             * @author mrdoob / http://mrdoob.com\n                                             * @author alteredq / http://alteredqualia.com/\n                                             * @author WestLangley / http://github.com/WestLangley\n                                             * @author erich666 / http://erichaines.com\n                                             */\n  /*global THREE, console */\n\n  function OrbitConstraint(object) {\n\n    this.object = object;\n\n    // \"target\" sets the location of focus, where the object orbits around\n    // and where it pans with respect to.\n    this.target = new THREE.Vector3();\n\n    // Limits to how far you can dolly in and out ( PerspectiveCamera only )\n    this.minDistance = 0;\n    this.maxDistance = Infinity;\n\n    // Limits to how far you can zoom in and out ( OrthographicCamera only )\n    this.minZoom = 0;\n    this.maxZoom = Infinity;\n\n    // How far you can orbit vertically, upper and lower limits.\n    // Range is 0 to Math.PI radians.\n    this.minPolarAngle = 0; // radians\n    this.maxPolarAngle = Math.PI; // radians\n\n    // How far you can orbit horizontally, upper and lower limits.\n    // If set, must be a sub-interval of the interval [ - Math.PI, Math.PI ].\n    this.minAzimuthAngle = -Infinity; // radians\n    this.maxAzimuthAngle = Infinity; // radians\n\n    // Set to true to enable damping (inertia)\n    // If damping is enabled, you must call controls.update() in your animation loop\n    this.enableDamping = false;\n    this.dampingFactor = 0.25;\n\n    ////////////\n    // internals\n\n    var scope = this;\n\n    var EPS = 0.000001;\n\n    // Current position in spherical coordinate system.\n    var theta;\n    var phi;\n\n    // Pending changes\n    var phiDelta = 0;\n    var thetaDelta = 0;\n    var scale = 1;\n    var panOffset = new THREE.Vector3();\n    var zoomChanged = false;\n\n    // API\n\n    this.getPolarAngle = function () {\n\n      return phi;\n\n    };\n\n    this.getAzimuthalAngle = function () {\n\n      return theta;\n\n    };\n\n    this.rotateLeft = function (angle) {\n\n      thetaDelta -= angle;\n\n    };\n\n    this.rotateUp = function (angle) {\n\n      phiDelta -= angle;\n\n    };\n\n    // pass in distance in world space to move left\n    this.panLeft = function () {\n\n      var v = new THREE.Vector3();\n\n      return function panLeft(distance) {\n\n        var te = this.object.matrix.elements;\n\n        // get X column of matrix\n        v.set(te[0], te[1], te[2]);\n        v.multiplyScalar(-distance);\n\n        panOffset.add(v);\n\n      };\n\n    }();\n\n    // pass in distance in world space to move up\n    this.panUp = function () {\n\n      var v = new THREE.Vector3();\n\n      return function panUp(distance) {\n\n        var te = this.object.matrix.elements;\n\n        // get Y column of matrix\n        v.set(te[4], te[5], te[6]);\n        v.multiplyScalar(distance);\n\n        panOffset.add(v);\n\n      };\n\n    }();\n\n    // pass in x,y of change desired in pixel space,\n    // right and down are positive\n    this.pan = function (deltaX, deltaY, screenWidth, screenHeight) {\n\n      if (scope.object instanceof THREE.PerspectiveCamera) {\n\n        // perspective\n        var position = scope.object.position;\n        var offset = position.clone().sub(scope.target);\n        var targetDistance = offset.length();\n\n        // half of the fov is center to top of screen\n        targetDistance *= Math.tan(scope.object.fov / 2 * Math.PI / 180.0);\n\n        // we actually don't use screenWidth, since perspective camera is fixed to screen height\n        scope.panLeft(2 * deltaX * targetDistance / screenHeight);\n        scope.panUp(2 * deltaY * targetDistance / screenHeight);\n\n      } else if (scope.object instanceof THREE.OrthographicCamera) {\n\n        // orthographic\n        scope.panLeft(deltaX * (scope.object.right - scope.object.left) / screenWidth);\n        scope.panUp(deltaY * (scope.object.top - scope.object.bottom) / screenHeight);\n\n      } else {\n\n        // camera neither orthographic or perspective\n        console.warn('WARNING: OrbitControls.js encountered an unknown camera type - pan disabled.');\n\n      }\n\n    };\n\n    this.dollyIn = function (dollyScale) {\n\n      if (scope.object instanceof THREE.PerspectiveCamera) {\n\n        scale /= dollyScale;\n\n      } else if (scope.object instanceof THREE.OrthographicCamera) {\n\n        scope.object.zoom = Math.max(this.minZoom, Math.min(this.maxZoom, this.object.zoom * dollyScale));\n        scope.object.updateProjectionMatrix();\n        zoomChanged = true;\n\n      } else {\n\n        console.warn('WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled.');\n\n      }\n\n    };\n\n    this.dollyOut = function (dollyScale) {\n\n      if (scope.object instanceof THREE.PerspectiveCamera) {\n\n        scale *= dollyScale;\n\n      } else if (scope.object instanceof THREE.OrthographicCamera) {\n\n        scope.object.zoom = Math.max(this.minZoom, Math.min(this.maxZoom, this.object.zoom / dollyScale));\n        scope.object.updateProjectionMatrix();\n        zoomChanged = true;\n\n      } else {\n\n        console.warn('WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled.');\n\n      }\n\n    };\n\n    this.update = function () {\n\n      var offset = new THREE.Vector3();\n\n      // so camera.up is the orbit axis\n      var quat = new THREE.Quaternion().setFromUnitVectors(object.up, new THREE.Vector3(0, 1, 0));\n      var quatInverse = quat.clone().invert();\n\n      var lastPosition = new THREE.Vector3();\n      var lastQuaternion = new THREE.Quaternion();\n\n      return function () {\n\n        var position = this.object.position;\n\n        offset.copy(position).sub(this.target);\n\n        // rotate offset to \"y-axis-is-up\" space\n        offset.applyQuaternion(quat);\n\n        // angle from z-axis around y-axis\n\n        theta = Math.atan2(offset.x, offset.z);\n\n        // angle from y-axis\n\n        phi = Math.atan2(Math.sqrt(offset.x * offset.x + offset.z * offset.z), offset.y);\n\n        theta += thetaDelta;\n        phi += phiDelta;\n\n        // restrict theta to be between desired limits\n        theta = Math.max(this.minAzimuthAngle, Math.min(this.maxAzimuthAngle, theta));\n\n        // restrict phi to be between desired limits\n        phi = Math.max(this.minPolarAngle, Math.min(this.maxPolarAngle, phi));\n\n        // restrict phi to be betwee EPS and PI-EPS\n        phi = Math.max(EPS, Math.min(Math.PI - EPS, phi));\n\n        var radius = offset.length() * scale;\n\n        // restrict radius to be between desired limits\n        radius = Math.max(this.minDistance, Math.min(this.maxDistance, radius));\n\n        // move target to panned location\n        this.target.add(panOffset);\n\n        offset.x = radius * Math.sin(phi) * Math.sin(theta);\n        offset.y = radius * Math.cos(phi);\n        offset.z = radius * Math.sin(phi) * Math.cos(theta);\n\n        // rotate offset back to \"camera-up-vector-is-up\" space\n        offset.applyQuaternion(quatInverse);\n\n        position.copy(this.target).add(offset);\n\n        this.object.lookAt(this.target);\n\n        if (this.enableDamping === true) {\n\n          thetaDelta *= 1 - this.dampingFactor;\n          phiDelta *= 1 - this.dampingFactor;\n\n        } else {\n\n          thetaDelta = 0;\n          phiDelta = 0;\n\n        }\n\n        scale = 1;\n        panOffset.set(0, 0, 0);\n\n        // update condition is:\n        // min(camera displacement, camera rotation in radians)^2 > EPS\n        // using small-angle approximation cos(x/2) = 1 - x^2 / 8\n\n        if (zoomChanged ||\n        lastPosition.distanceToSquared(this.object.position) > EPS ||\n        8 * (1 - lastQuaternion.dot(this.object.quaternion)) > EPS) {\n\n          lastPosition.copy(this.object.position);\n          lastQuaternion.copy(this.object.quaternion);\n          zoomChanged = false;\n\n          return true;\n\n        }\n\n        return false;\n\n      };\n\n    }();\n\n  };\n\n\n  // This set of controls performs orbiting, dollying (zooming), and panning. It maintains\n  // the \"up\" direction as +Y, unlike the TrackballControls. Touch on tablet and phones is\n  // supported.\n  //\n  //    Orbit - left mouse / touch: one finger move\n  //    Zoom - middle mouse, or mousewheel / touch: two finger spread or squish\n  //    Pan - right mouse, or arrow keys / touch: three finter swipe\n\n  function OrbitControls(object, domElement) {\n\n    var constraint = new OrbitConstraint(object);\n\n    this.domElement = domElement !== undefined ? domElement : document;\n\n    // API\n\n    Object.defineProperty(this, 'constraint', {\n\n      get: function get() {\n\n        return constraint;\n\n      } });\n\n\n\n    this.getPolarAngle = function () {\n\n      return constraint.getPolarAngle();\n\n    };\n\n    this.getAzimuthalAngle = function () {\n\n      return constraint.getAzimuthalAngle();\n\n    };\n\n    // Set to false to disable this control\n    this.enabled = true;\n\n    // center is old, deprecated; use \"target\" instead\n    this.center = this.target;\n\n    // This option actually enables dollying in and out; left as \"zoom\" for\n    // backwards compatibility.\n    // Set to false to disable zooming\n    this.enableZoom = true;\n    this.zoomSpeed = 1.0;\n\n    // Set to false to disable rotating\n    this.enableRotate = true;\n    this.rotateSpeed = 1.0;\n\n    // Set to false to disable panning\n    this.enablePan = true;\n    this.keyPanSpeed = 7.0; // pixels moved per arrow key push\n\n    // Set to true to automatically rotate around the target\n    // If auto-rotate is enabled, you must call controls.update() in your animation loop\n    this.autoRotate = false;\n    this.autoRotateSpeed = 2.0; // 30 seconds per round when fps is 60\n\n    // Set to false to disable use of the keys\n    this.enableKeys = true;\n\n    // The four arrow keys\n    this.keys = { LEFT: 37, UP: 38, RIGHT: 39, BOTTOM: 40 };\n\n    // Mouse buttons\n    this.mouseButtons = { ORBIT: THREE.MOUSE.LEFT, ZOOM: THREE.MOUSE.MIDDLE, PAN: THREE.MOUSE.RIGHT };\n\n    ////////////\n    // internals\n\n    var scope = this;\n\n    var rotateStart = new THREE.Vector2();\n    var rotateEnd = new THREE.Vector2();\n    var rotateDelta = new THREE.Vector2();\n\n    var panStart = new THREE.Vector2();\n    var panEnd = new THREE.Vector2();\n    var panDelta = new THREE.Vector2();\n\n    var dollyStart = new THREE.Vector2();\n    var dollyEnd = new THREE.Vector2();\n    var dollyDelta = new THREE.Vector2();\n\n    var STATE = { NONE: -1, ROTATE: 0, DOLLY: 1, PAN: 2, TOUCH_ROTATE: 3, TOUCH_DOLLY: 4, TOUCH_PAN: 5 };\n\n    var state = STATE.NONE;\n\n    // for reset\n\n    this.target0 = this.target.clone();\n    this.position0 = this.object.position.clone();\n    this.zoom0 = this.object.zoom;\n\n    // events\n\n    var changeEvent = { type: 'change' };\n    var startEvent = { type: 'start' };\n    var endEvent = { type: 'end' };\n\n    // pass in x,y of change desired in pixel space,\n    // right and down are positive\n    function pan(deltaX, deltaY) {\n\n      var element = scope.domElement === document ? scope.domElement.body : scope.domElement;\n\n      constraint.pan(deltaX, deltaY, element.clientWidth, element.clientHeight);\n\n    }\n\n    this.update = function () {\n\n      if (this.autoRotate && state === STATE.NONE) {\n\n        constraint.rotateLeft(getAutoRotationAngle());\n\n      }\n\n      if (constraint.update() === true) {\n\n        this.dispatchEvent(changeEvent);\n\n      }\n\n    };\n\n    this.reset = function () {\n\n      state = STATE.NONE;\n\n      this.target.copy(this.target0);\n      this.object.position.copy(this.position0);\n      this.object.zoom = this.zoom0;\n\n      this.object.updateProjectionMatrix();\n      this.dispatchEvent(changeEvent);\n\n      this.update();\n\n    };\n\n    function getAutoRotationAngle() {\n\n      return 2 * Math.PI / 60 / 60 * scope.autoRotateSpeed;\n\n    }\n\n    function getZoomScale() {\n\n      return Math.pow(0.95, scope.zoomSpeed);\n\n    }\n\n    function onMouseDown(event) {\n\n      if (scope.enabled === false) return;\n\n      event.preventDefault();\n\n      if (event.button === scope.mouseButtons.ORBIT) {\n\n        if (scope.enableRotate === false) return;\n\n        state = STATE.ROTATE;\n\n        rotateStart.set(event.clientX, event.clientY);\n\n      } else if (event.button === scope.mouseButtons.ZOOM) {\n\n        if (scope.enableZoom === false) return;\n\n        state = STATE.DOLLY;\n\n        dollyStart.set(event.clientX, event.clientY);\n\n      } else if (event.button === scope.mouseButtons.PAN) {\n\n        if (scope.enablePan === false) return;\n\n        state = STATE.PAN;\n\n        panStart.set(event.clientX, event.clientY);\n\n      }\n\n      if (state !== STATE.NONE) {\n\n        document.addEventListener('mousemove', onMouseMove, false);\n        document.addEventListener('mouseup', onMouseUp, false);\n        scope.dispatchEvent(startEvent);\n\n      }\n\n    }\n\n    function onMouseMove(event) {\n\n      if (scope.enabled === false) return;\n\n      event.preventDefault();\n\n      var element = scope.domElement === document ? scope.domElement.body : scope.domElement;\n\n      if (state === STATE.ROTATE) {\n\n        if (scope.enableRotate === false) return;\n\n        rotateEnd.set(event.clientX, event.clientY);\n        rotateDelta.subVectors(rotateEnd, rotateStart);\n\n        // rotating across whole screen goes 360 degrees around\n        constraint.rotateLeft(2 * Math.PI * rotateDelta.x / element.clientWidth * scope.rotateSpeed);\n\n        // rotating up and down along whole screen attempts to go 360, but limited to 180\n        constraint.rotateUp(2 * Math.PI * rotateDelta.y / element.clientHeight * scope.rotateSpeed);\n\n        rotateStart.copy(rotateEnd);\n\n      } else if (state === STATE.DOLLY) {\n\n        if (scope.enableZoom === false) return;\n\n        dollyEnd.set(event.clientX, event.clientY);\n        dollyDelta.subVectors(dollyEnd, dollyStart);\n\n        if (dollyDelta.y > 0) {\n\n          constraint.dollyIn(getZoomScale());\n\n        } else if (dollyDelta.y < 0) {\n\n          constraint.dollyOut(getZoomScale());\n\n        }\n\n        dollyStart.copy(dollyEnd);\n\n      } else if (state === STATE.PAN) {\n\n        if (scope.enablePan === false) return;\n\n        panEnd.set(event.clientX, event.clientY);\n        panDelta.subVectors(panEnd, panStart);\n\n        pan(panDelta.x, panDelta.y);\n\n        panStart.copy(panEnd);\n\n      }\n\n      if (state !== STATE.NONE) scope.update();\n\n    }\n\n    function onMouseUp() /* event */{\n\n      if (scope.enabled === false) return;\n\n      document.removeEventListener('mousemove', onMouseMove, false);\n      document.removeEventListener('mouseup', onMouseUp, false);\n      scope.dispatchEvent(endEvent);\n      state = STATE.NONE;\n\n    }\n\n    function onMouseWheel(event) {\n\n      if (scope.enabled === false || scope.enableZoom === false || state !== STATE.NONE) return;\n\n      event.preventDefault();\n      event.stopPropagation();\n\n      var delta = 0;\n\n      if (event.wheelDelta !== undefined) {\n\n        // WebKit / Opera / Explorer 9\n\n        delta = event.wheelDelta;\n\n      } else if (event.detail !== undefined) {\n\n        // Firefox\n\n        delta = -event.detail;\n\n      }\n\n      if (delta > 0) {\n\n        constraint.dollyOut(getZoomScale());\n\n      } else if (delta < 0) {\n\n        constraint.dollyIn(getZoomScale());\n\n      }\n\n      scope.update();\n      scope.dispatchEvent(startEvent);\n      scope.dispatchEvent(endEvent);\n\n    }\n\n    function onKeyDown(event) {\n\n      if (scope.enabled === false || scope.enableKeys === false || scope.enablePan === false) return;\n\n      switch (event.keyCode) {\n\n        case scope.keys.UP:\n          pan(0, scope.keyPanSpeed);\n          scope.update();\n          break;\n\n        case scope.keys.BOTTOM:\n          pan(0, -scope.keyPanSpeed);\n          scope.update();\n          break;\n\n        case scope.keys.LEFT:\n          pan(scope.keyPanSpeed, 0);\n          scope.update();\n          break;\n\n        case scope.keys.RIGHT:\n          pan(-scope.keyPanSpeed, 0);\n          scope.update();\n          break;}\n\n\n\n    }\n\n    function touchstart(event) {\n\n      if (scope.enabled === false) return;\n\n      switch (event.touches.length) {\n\n        case 1: // one-fingered touch: rotate\n\n          if (scope.enableRotate === false) return;\n\n          state = STATE.TOUCH_ROTATE;\n\n          rotateStart.set(event.touches[0].pageX, event.touches[0].pageY);\n          break;\n\n        case 2: // two-fingered touch: dolly\n\n          if (scope.enableZoom === false) return;\n\n          state = STATE.TOUCH_DOLLY;\n\n          var dx = event.touches[0].pageX - event.touches[1].pageX;\n          var dy = event.touches[0].pageY - event.touches[1].pageY;\n          var distance = Math.sqrt(dx * dx + dy * dy);\n          dollyStart.set(0, distance);\n          break;\n\n        case 3: // three-fingered touch: pan\n\n          if (scope.enablePan === false) return;\n\n          state = STATE.TOUCH_PAN;\n\n          panStart.set(event.touches[0].pageX, event.touches[0].pageY);\n          break;\n\n        default:\n\n          state = STATE.NONE;}\n\n\n\n      if (state !== STATE.NONE) scope.dispatchEvent(startEvent);\n\n    }\n\n    function touchmove(event) {\n\n      if (scope.enabled === false) return;\n\n      event.preventDefault();\n      event.stopPropagation();\n\n      var element = scope.domElement === document ? scope.domElement.body : scope.domElement;\n\n      switch (event.touches.length) {\n\n        case 1: // one-fingered touch: rotate\n\n          if (scope.enableRotate === false) return;\n          if (state !== STATE.TOUCH_ROTATE) return;\n\n          rotateEnd.set(event.touches[0].pageX, event.touches[0].pageY);\n          rotateDelta.subVectors(rotateEnd, rotateStart);\n\n          // rotating across whole screen goes 360 degrees around\n          constraint.rotateLeft(2 * Math.PI * rotateDelta.x / element.clientWidth * scope.rotateSpeed);\n          // rotating up and down along whole screen attempts to go 360, but limited to 180\n          constraint.rotateUp(2 * Math.PI * rotateDelta.y / element.clientHeight * scope.rotateSpeed);\n\n          rotateStart.copy(rotateEnd);\n\n          scope.update();\n          break;\n\n        case 2: // two-fingered touch: dolly\n\n          if (scope.enableZoom === false) return;\n          if (state !== STATE.TOUCH_DOLLY) return;\n\n          var dx = event.touches[0].pageX - event.touches[1].pageX;\n          var dy = event.touches[0].pageY - event.touches[1].pageY;\n          var distance = Math.sqrt(dx * dx + dy * dy);\n\n          dollyEnd.set(0, distance);\n          dollyDelta.subVectors(dollyEnd, dollyStart);\n\n          if (dollyDelta.y > 0) {\n\n            constraint.dollyOut(getZoomScale());\n\n          } else if (dollyDelta.y < 0) {\n\n            constraint.dollyIn(getZoomScale());\n\n          }\n\n          dollyStart.copy(dollyEnd);\n\n          scope.update();\n          break;\n\n        case 3: // three-fingered touch: pan\n\n          if (scope.enablePan === false) return;\n          if (state !== STATE.TOUCH_PAN) return;\n\n          panEnd.set(event.touches[0].pageX, event.touches[0].pageY);\n          panDelta.subVectors(panEnd, panStart);\n\n          pan(panDelta.x, panDelta.y);\n\n          panStart.copy(panEnd);\n\n          scope.update();\n          break;\n\n        default:\n\n          state = STATE.NONE;}\n\n\n\n    }\n\n    function touchend() /* event */{\n\n      if (scope.enabled === false) return;\n\n      scope.dispatchEvent(endEvent);\n      state = STATE.NONE;\n\n    }\n\n    function contextmenu(event) {\n\n      event.preventDefault();\n\n    }\n\n    this.dispose = function () {\n\n      this.domElement.removeEventListener('contextmenu', contextmenu, false);\n      this.domElement.removeEventListener('mousedown', onMouseDown, false);\n      this.domElement.removeEventListener('mousewheel', onMouseWheel, false);\n      this.domElement.removeEventListener('MozMousePixelScroll', onMouseWheel, false); // firefox\n\n      this.domElement.removeEventListener('touchstart', touchstart, false);\n      this.domElement.removeEventListener('touchend', touchend, false);\n      this.domElement.removeEventListener('touchmove', touchmove, false);\n\n      document.removeEventListener('mousemove', onMouseMove, false);\n      document.removeEventListener('mouseup', onMouseUp, false);\n\n      window.removeEventListener('keydown', onKeyDown, false);\n\n    };\n\n    this.domElement.addEventListener('contextmenu', contextmenu, false);\n\n    this.domElement.addEventListener('mousedown', onMouseDown, false);\n    this.domElement.addEventListener('mousewheel', onMouseWheel, false);\n    this.domElement.addEventListener('MozMousePixelScroll', onMouseWheel, false); // firefox\n\n    this.domElement.addEventListener('touchstart', touchstart, false);\n    this.domElement.addEventListener('touchend', touchend, false);\n    this.domElement.addEventListener('touchmove', touchmove, false);\n\n    window.addEventListener('keydown', onKeyDown, false);\n\n    // force an update at start\n    this.update();\n\n  };\n\n  OrbitControls.prototype = Object.create(THREE.EventDispatcher.prototype);\n  OrbitControls.prototype.constructor = OrbitControls;\n\n  Object.defineProperties(OrbitControls.prototype, {\n\n    object: {\n\n      get: function get() {\n\n        return this.constraint.object;\n\n      } },\n\n\n\n    target: {\n\n      get: function get() {\n\n        return this.constraint.target;\n\n      },\n\n      set: function set(value) {\n\n        console.warn('THREE.OrbitControls: target is now immutable. Use target.set() instead.');\n        this.constraint.target.copy(value);\n\n      } },\n\n\n\n    minDistance: {\n\n      get: function get() {\n\n        return this.constraint.minDistance;\n\n      },\n\n      set: function set(value) {\n\n        this.constraint.minDistance = value;\n\n      } },\n\n\n\n    maxDistance: {\n\n      get: function get() {\n\n        return this.constraint.maxDistance;\n\n      },\n\n      set: function set(value) {\n\n        this.constraint.maxDistance = value;\n\n      } },\n\n\n\n    minZoom: {\n\n      get: function get() {\n\n        return this.constraint.minZoom;\n\n      },\n\n      set: function set(value) {\n\n        this.constraint.minZoom = value;\n\n      } },\n\n\n\n    maxZoom: {\n\n      get: function get() {\n\n        return this.constraint.maxZoom;\n\n      },\n\n      set: function set(value) {\n\n        this.constraint.maxZoom = value;\n\n      } },\n\n\n\n    minPolarAngle: {\n\n      get: function get() {\n\n        return this.constraint.minPolarAngle;\n\n      },\n\n      set: function set(value) {\n\n        this.constraint.minPolarAngle = value;\n\n      } },\n\n\n\n    maxPolarAngle: {\n\n      get: function get() {\n\n        return this.constraint.maxPolarAngle;\n\n      },\n\n      set: function set(value) {\n\n        this.constraint.maxPolarAngle = value;\n\n      } },\n\n\n\n    minAzimuthAngle: {\n\n      get: function get() {\n\n        return this.constraint.minAzimuthAngle;\n\n      },\n\n      set: function set(value) {\n\n        this.constraint.minAzimuthAngle = value;\n\n      } },\n\n\n\n    maxAzimuthAngle: {\n\n      get: function get() {\n\n        return this.constraint.maxAzimuthAngle;\n\n      },\n\n      set: function set(value) {\n\n        this.constraint.maxAzimuthAngle = value;\n\n      } },\n\n\n\n    enableDamping: {\n\n      get: function get() {\n\n        return this.constraint.enableDamping;\n\n      },\n\n      set: function set(value) {\n\n        this.constraint.enableDamping = value;\n\n      } },\n\n\n\n    dampingFactor: {\n\n      get: function get() {\n\n        return this.constraint.dampingFactor;\n\n      },\n\n      set: function set(value) {\n\n        this.constraint.dampingFactor = value;\n\n      } },\n\n\n\n    // backward compatibility\n\n    noZoom: {\n\n      get: function get() {\n\n        console.warn('THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead.');\n        return !this.enableZoom;\n\n      },\n\n      set: function set(value) {\n\n        console.warn('THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead.');\n        this.enableZoom = !value;\n\n      } },\n\n\n\n    noRotate: {\n\n      get: function get() {\n\n        console.warn('THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead.');\n        return !this.enableRotate;\n\n      },\n\n      set: function set(value) {\n\n        console.warn('THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead.');\n        this.enableRotate = !value;\n\n      } },\n\n\n\n    noPan: {\n\n      get: function get() {\n\n        console.warn('THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead.');\n        return !this.enablePan;\n\n      },\n\n      set: function set(value) {\n\n        console.warn('THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead.');\n        this.enablePan = !value;\n\n      } },\n\n\n\n    noKeys: {\n\n      get: function get() {\n\n        console.warn('THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead.');\n        return !this.enableKeys;\n\n      },\n\n      set: function set(value) {\n\n        console.warn('THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead.');\n        this.enableKeys = !value;\n\n      } },\n\n\n\n    staticMoving: {\n\n      get: function get() {\n\n        console.warn('THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead.');\n        return !this.constraint.enableDamping;\n\n      },\n\n      set: function set(value) {\n\n        console.warn('THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead.');\n        this.constraint.enableDamping = !value;\n\n      } },\n\n\n\n    dynamicDampingFactor: {\n\n      get: function get() {\n\n        console.warn('THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead.');\n        return this.constraint.dampingFactor;\n\n      },\n\n      set: function set(value) {\n\n        console.warn('THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead.');\n        this.constraint.dampingFactor = value;\n\n      } } });\n\n\n\n\n\n  return OrbitControls;\n};\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/js/utils/orbitControls.js\n// module id = 43\n// module chunks = 0\n\n//# sourceURL=webpack:///./src/js/utils/orbitControls.js?");

/***/ }),
/* 44 */
/***/ (function(module, exports, __webpack_require__) {

eval("__webpack_require__(17);\nmodule.exports = __webpack_require__(18);\n\n\n//////////////////\n// WEBPACK FOOTER\n// multi ./~/regenerator-runtime/runtime.js ./src/js/app.js\n// module id = 44\n// module chunks = 0\n\n//# sourceURL=webpack:///multi_./~/regenerator-runtime/runtime.js_./src/js/app.js?");

/***/ })
/******/ ]);